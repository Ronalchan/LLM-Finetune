issue_id,text_id,text,code,label,matching_category
538721,1,"http://mxr.mozilla.org/mozilla-central/source/layout/reftests/svg/smil/reftest.list#91
fails == anim-strokewidth-1xml.svg anim-standard-ref.svg # bug 436267
This isn't an SMIL bug :)  What's the correct bug for animating strokewidth?",QUESTION,0,FULL_TEXT
538721,2,It is probably a typo for bug 436276 but that's wrong too as strokeWidth is a length. I'd say bug 534028 makes more sense as a dependency.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
538721,3,"Thanks for the report, Jesse!
Robert is correct on both counts. (FWIW, in bug 436276, I intended ""non-length"" to mean ""non-nsSVGLength2"" -- and strokeWidth is non-nsSVGLength2. Hence the dependency on that bug).
In any case, bug 534028 is more granular, and when it's fixed, this test will pass.  So that's indeed a better bug # to reference there.
Fixed:
http://hg.mozilla.org/mozilla-central/rev/2ac64027f304",CODE_IMPLEMENTATION,1,FULL_TOKEN
551837,1,"Just by adding ""__arm__"" to the i386 #ifdef in js_DoubleToECMAInt32 seems to get us a 5% performance improvement on Cortex-A8. The i386 code in the block looks fairly generic so I don't see any harm in doing this (though it does require IEEE format doubles). It may also benefit x64, but I have no idea about how x64 handles floating-point and there may be some reason why it won't work.
5% seems surprisingly large (and may just indicate an anomalous result), so I want to investigate further before filing a patch, but there's certainly something we can do here. Also, if the function really does take as much profile time as the improvement would suggest, it may be worth hand-writing some assembly to do this (unless the compiler output is already good).
Also, js_DoubleToECMAUint32 is a potential target, so I'll have a look at that one too.",PROBLEM_MOTIVATION,0,FULL_TOKEN
551837,2,"I should add that the 5% improvement is on SunSpider on the JS shell, using Trace Monkey.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
551837,3,"No such luck; I get some failing trace-tests with this, so there must be something non-portable in the i386 code. I will investigate and provide something similar for ARM.",SOLUTION_REVIEW,1,FULL_TEXT
551837,4,"Created attachment 441050
Optimized DoubleToECMAInt32 for ARM.
 * I don't like using assembly in this way, particularly outside the back-ends, but I couldn't get close to the performance of this routine using pure C. I do have a C version which still provides an excellent improvement over the slow path, and it should also work for any little-endian IEEE-754 system.
 * I've added many comments to my assembly to try to explain what's going on, but this does make the code look somewhat long (even though the output is tiny). Suggestions are welcome! The comments are important; I don't want this to be a write-only routine, and this kind of assembly algorithm can get unreadable pretty quickly.
 * I get a 5.5% performance improvement on A8 with this patch. That's rather surprising, considering that it's only one function, but I won't complain! (My pure C implementation is 3.9% faster than the slow-path on A8.)
 * I tested the routine in a standalone harness to ensure that all the code-paths were exercised. It appears functionally equivalent to the slow path.",CODE_IMPLEMENTATION,1,FULL_TOKEN
551837,5,Very nice. Do you think we should use your C version on Intel as well?,CODE_REVIEW,0,FULL_TEXT
551837,6,"Created attachment 441439
Little-endian, IEEE-754 C implementation.
It's unlikely to outperform the optimized i386 version, but it might be worth a try. I've attached it for reference, but note that it isn't at all polished in its current state, and it's in the form of a C function, not a patch. (I didn't generate a patch when I tested it in the JS engine, but the code is the same.)",CODE_IMPLEMENTATION,1,FULL_TEXT
551837,7,"Comment on attachment 441050
Optimized DoubleToECMAInt32 for ARM.
Looks great to me -- should figure out what to do with the C version, since it sounds like that could be useful on non-x86 platforms where we don't have an optimized version.",CODE_REVIEW,0,FULL_TEXT
551837,8,"Yep, indeed, though I'm concerned about introducing many code paths to maintain and test. We now have i386, ARM, generic, and potentially a IEEE-754 routine, and if we end up optimizing other routines we will quickly bloat the source files with #if blocks.
I think the best way to handle this, if it becomes a common optimization trick, would be to have something equivalent to the NativeARCH files so that fast-paths can be implemented for each platform. We can combine that with macros to allow tidy fall-backs to slow, but platform-agnostic paths. In any case, that's a subject for another bug, so I'll get this pushed as-is for now.",CLARIFICATION,0,FULL_TOKEN
551837,9,http://hg.mozilla.org/tracemonkey/rev/e8dfe85fca00,UNCODED,0,UNMATCHED
551837,10,http://hg.mozilla.org/mozilla-central/rev/e8dfe85fca00,UNCODED,0,UNMATCHED
552914,1,"Created attachment 433027
Patch v1.0
nsEditor::mFlags is set only when nsEditor::Init() is called.
nsPlaintextEditor::SetFlags() and nsHTMLEditor::SetFlags() don't call nsEditor::SetFlags(), so, nsEditor::mFlags are not modified forever.
I guess that this makes a problem after type attribute or readonly attribute of <input> element is modified and some code path which refer nsEditor::mFlags run. However, I'm not sure there are actual problems.
My patch removes nsEditor::mFlags. It's not needed. And the code should check the flags via GetFlags() method.
My patch also removes a special code for unix password editor in ForceCompositionEnd() which has never needed right now because we support ime-mode CSS property. So, even if the editor is password field, nsIWidget::ResetInputState() should be called at that time.",CODE_IMPLEMENTATION,1,FULL_TOKEN
552914,2,"Comment on attachment 433027
Patch v1.0
smaug, can you review this? I requested to perterv, but there are no replies...",CODE_REVIEW_REQUEST,0,FULL_TEXT
552914,3,"Comment on attachment 433027
Patch v1.0
I don't understand this method. Nothing seems to call it ever.
So you are, at least in theory, changing the behavior here.
Have you tested password fields with IME?
I think I would do this in different way.
Really start use nsEditor::mFlags always, and remove mFlags from nsTextEditRules.
nsTextEditRules can always access nsEditor::mFlags when needed.
Or is there some reason to not use nsEditor::mFlags, but nsTextEditRules::mFlags?",CODE_REVIEW,0,FULL_TOKEN
552914,4,"Created attachment 435856
Patch v2.0
yeah, but I removed the change from the patch. I'll post the patch in separated bug.
I agree.
And I found a bug:
The condition is always false, but the comment doesn't expect so, of course. I replaced all flag checking to the new accessor methods for suppressing the mistake.",CODE_IMPLEMENTATION,1,FULL_TEXT
552914,5,"Comment on attachment 435856
Patch v2.0
Perhaps this could be called
PRBool UseAsyncUpdate() const
Maybe just
PRBool NoCSS() const
Maybe just 
PRBool DontEchoPassword() const
I think you could make nsEditorListener::mEditor to be
type nsEditor. Currently it is nsIEditor. That way you wouldn't need the static_cast.
Though, it is possible that you'd need a static_cast then elsewhere. But try and see
what leads to easiest-to-read code.
If mEditor was nsEditor, this QI wouldn't be needed.
DontEchoPassword()?",CODE_REVIEW,0,FULL_TOKEN
552914,6,"Created attachment 438372
Patch v3.0
O.K. But I'll post the patch in another new bug.",STATUS_UPDATE,0,FULL_TEXT
552914,7,"http://hg.mozilla.org/mozilla-central/rev/97aec61ae55f
I'll file a bug for the previous comment.",NEW_ISSUE_FILING,0,FULL_TEXT
554061,1,"Created attachment 433939
screenshot before/after mouse-over
maybe regression by bug 538187 and/or bug 508482",UNCODED,0,UNMATCHED
554061,2,The menus are greyed out on startup using the default theme.  Mousing over them will put them back into the normal state.,UNCODED,0,UNMATCHED
554061,3,"Customize Toolbar and Done, make them into the normal state",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
554061,4,"Yes Alice that is true, but you have to do it everytime you restart Minefield.",SOLUTION_REVIEW,1,FULL_TEXT
554061,5,"Also, the menu bar is not highlighted ever with any other theme.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
554061,6,"This just showed up in shredder too.
Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.3a4pre) Gecko/20100322 Shredder/3.2a1pre",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
554061,7,"I'm not sure what to do here. We don't restyle the document because HasDocumentStateDependentStyle doesn't find the :-moz-window-inactive rule because it's in an XBL stylesheet. For normal content state changes we can inspect XBL stylesheets because we can get the binding from the content node (in nsBindingManager::WalkRules), but when the document state changes we only have the root node and no way of getting to the right binding.
Does this mean we'll have to iterate over the whole content tree whenever the document state changes?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
554061,8,I think this is toolkit bug. (and also in seamonkey 2.1 nightlies),ADDITIONAL_CONSIDERATION,0,FULL_TEXT
554061,9,View Source window is also affected and exhibits the same behavior.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
554061,10,*** Bug 554574 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
554061,11,*** Bug 554627 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
554061,12,"It seems like we'd only have to iterate over all XBL binding style sheets in the document... and that the binding manager itself could coalesce all the document state bits into one for all of them.
We'd probably need a different WalkRuleProcessors mechanism to do this, though.",SOLUTION_REVIEW,1,FULL_TOKEN
554061,13,"As i noted in bug 554574, the gray text only changes permanently to black if the window is in the foreground.  if you have two windows and the one in the background has its menu mouse-over'd it will go back to gray",REQUIREMENT,0,FULL_TOKEN
554061,14,"Created attachment 434724
v1",UNCODED,0,UNMATCHED
554061,15,"Comment on attachment 434724
v1
r=dbaron",CODE_REVIEW,0,FULL_TEXT
554061,16,http://hg.mozilla.org/mozilla-central/rev/df1c1421e2a5,UNCODED,0,UNMATCHED
554061,17,"Darn, I was hoping this would fix the problem with themes other than default, but it does not.  Any chance of that happening or do all the themes need to be changed?",QUESTION,0,FULL_TOKEN
554061,18,All themes need to be changed. Sorry for that.,ANSWER_TO_QUESTION,0,FULL_TEXT
554061,19,"Something we should mention on MDC, or?",QUESTION,0,FULL_TEXT
554061,20,"Bug 508482 needs to be documented, not this bug, as far as I can see.",ANSWER_TO_QUESTION,0,FULL_TEXT
554061,21,"Verified fixed in Shredder 3.2a1pre and SeaMonkey 2.1a1pre nightly builds.
[Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.3a4pre) Gecko/20100326 SeaMonkey/2.1a1pre]",SOLUTION_VERIFICATION,0,FULL_TEXT
558970,1,"Created attachment 438648
Patch v1.0
separated from bug 552914.
Current nsEditorEventListener stores the editor as nsIEditor. However, if we change this to nsEditor, we can remove may casts and QIs.
And also we can remove null check of mEditor because it's set at constructor. And it's never modified, so, it always valid pointer.
There are some random thought.
1. nsEditorEventListener::KeyPress() still QIs nsIPlaintextEditor.
nsEditorEventListener is for nsEditor, so, we shouldn't store the editor as nsPlaintextEditor I think. 
I think that we should move HandleKeyPress() from nsIPlaintextEditor to nsIEditor. Besides, nsIPlaintextEditor should inherit nsIEditor. Then, we don't change the interfaces actually. (And also we can move the flags of nsIPlaintextEditor to nsIEditor too)
If we do so, we can move the contents of nsEditorEventListener::KeyPress() to nsEditor::HandleKeyPress() and nsPlaintextEditor::HandleKeyPress().
# But I'm not sure whether the method should be defined in idl because there are not merits of it being scriptable.
2. nsEditorEventListener::MouseClick() still QIs nsIEditorMailSupport.
nsIEditorMailSupport is implemented nsPlaintextEditor, so, the contents of nsEditorEventListener can be moved to nsEditor::HandleMouseClick() and nsPlaintextEditor::HandleMouseClick() like HandleKeyPress().",CODE_IMPLEMENTATION,1,FULL_TOKEN
558970,2,"Created attachment 438649
Patch v1.0 (-w)",UNCODED,0,UNMATCHED
558970,3,"Comment on attachment 438648
Patch v1.0
I'm hoping to get a bit different patch.
Ping me on IRC if you have any questions.",CODE_REVIEW,0,FULL_TOKEN
558970,4,"Created attachment 439468
Patch v2.0
nsEditorEventListener can connect/disconect to editor now.
All public methods should check whether mEditor is null or not, but protected/private methods should check as assertion.
The listener installation code and uninstallation code are moved to nsEditorEventListener, by this change, we can uninstall the listener certainly when it's discorrected.",CODE_IMPLEMENTATION,1,FULL_TOKEN
558970,5,"Created attachment 439469
Patch v2.0 (-w)",UNCODED,0,UNMATCHED
558970,6,"Comment on attachment 439468
Patch v2.0
Just return early if !sysGroup  || !elmP.
NS_ENSURE_STATE(sysGroup && elmP);
Same here. Just return some error code if !target
No need for NS_ENSURE_TRUE check here.
No need for NS_ENSURE_TRUE check here.
No need for NS_ENSURE_TRUE check here.
No need for NS_ENSURE_TRUE check here.
No need for NS_ENSURE_TRUE check here.
No need for NS_ENSURE_TRUE check here.
Could you file a followup for this.
I think HTMLEditor should be listening for contextmenu event.
I don't understand this.
why you need ConnectToHTMLEditor? 
r+ if you fix all the comments and either explain or fix ConnectToHTMLEditor handling.",CODE_REVIEW,0,FULL_TOKEN
558970,7,"It guarantees that the mEditor is nsHTMLEditor or its sub class. If I remove this, we need to QI in nsHTMLEditorEventListener instead of cast by GetHTMLEditor.",ANSWER_TO_QUESTION,0,FULL_TEXT
558970,8,"But only nsHTMLEditor should create nsHTMLEditorEventListener.
So you know that editor is nsHTMLEditor.",CLARIFICATION,0,FULL_TOKEN
558970,9,"Currently, yes. However, isn't it risky in future? If you don't mind that, I'll just remove it.",QUESTION,0,FULL_TEXT
558970,10,"Perhaps you could just add an ifdef DEBUG block to somewhere to check that
nsHTMLEditorEventListener is connected to HTMLEditor?
That should be enough to capture possible problems in the future.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
558970,11,"Ah, sounds good. I'll do it before landing the new patch tomorrow.",STATUS_UPDATE,0,FULL_TEXT
558970,12,"Created attachment 439869
Patch v2.1",UNCODED,0,UNMATCHED
558970,13,"I don't understand this well. Looks like nsHTMLEditorEventListener can listen ""contextmenu"" event by nsIDOMContextMenuListener. The argument of nsIDOMContextMenuListener::ContextMenu() is the cause of opening the context menu, right?
I'm not sure the event comes before or after the event. If it comes before the event, it should prevent the default of the mouse event. But if it comes after the event, looks like mouse down handler still needs to check the event is opening context menu or not for Mac. So, I don't understand if latter is correct.",SOLUTION_REVIEW,1,FULL_TOKEN
558970,14,"Well, just file a followup bug ""Sort out editor's contextmenu/mouse event handling""
or something like that.",NEW_ISSUE_FILING,0,FULL_TOKEN
558970,15,"http://hg.mozilla.org/mozilla-central/rev/d7085006cb18
I'll file the bug.",UNCODED,0,UNMATCHED
558970,16,I filed bug 560201.,NEW_ISSUE_FILING,0,FULL_TEXT
561168,1,"Canvas needs to use a custom Layer for rendering, so that the compositing can be hardware accelerated where possible (e.g. WebGL).",PROBLEM_MOTIVATION,0,FULL_TEXT
561168,2,"Created attachment 440844
first pass
Here's the first pass at this; posting up here to get feedback, because for some reason invalidation doesn't work.  The canvas is drawn at the correct spot, but only get invalidates if I scroll around and reveal the new areas.
However, with layers, scrolling is broken in general, so is this just more of the same problem?",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,3,"I don't think so, normal scrolling is broken because ScrollWindowEx doesn't work. It should in theory have nothing to do with invalidation.",ANSWER_TO_QUESTION,0,FULL_TEXT
561168,4,"Move GetLayerManagerForDoc to nsLayoutUtils and share it please!
+  nsIntRect mUpdatedRect;
You don't need this. Updated can be a no-op for BasicCanvasLayer.",CODE_REVIEW,0,FULL_TOKEN
561168,5,"Created attachment 443133
patch 1: basic CanvasLayer + 2D code
- Implement basic CanvasLayer (gfxASurface only)
- Teach 2D context how to return a CanvasLayer
- move nsHTMLCanvasElement.h into public dir
- teach HTMLCanvasFrame how to render using layers",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,6,"Created attachment 443134
patch 2: remove nsICanvasElement
- move nsICanvasElement functionality into nsHTMLCanvasElement
- create nsICanvasElementExternal, for outside-of-layout consumers",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,7,"Created attachment 443135
patch 3: WebGL/pbuffers on OSX
- fix some refcounting issues
- add support for creating pbuffers on OSX
- move WebGL to GLContext pbuffers on OSX",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,8,"Created attachment 443136
patch 4: add WGL pbuffer support
- add GLContext pbuffer support for Win32, use it in WebGL",CODE_IMPLEMENTATION,1,FULL_TEXT
561168,9,"Created attachment 443137
patch 5: cleanup
A bunch of cleanup from earlier patches; remove obsolete WebGL pbuffer interfaces, remove non-layers code paths from canvas.
Things that are still to do:
- Linux pbuffers
- Use the context attribs in pbuffers better, and teach webgl how to request the proper ones
- Check callers of RenderContextsExternal (such as d&d code) to make sure that they still work",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,10,"Created attachment 443138
patch 5: cleanup
(Forgot to qrefresh patch 5 before attaching, this is the real one)",CODE_IMPLEMENTATION,1,FULL_TEXT
561168,11,"Your lack of 'a' prefixes on parameters makes me itch. I will let it slide on the canvas rendering context code, but not elsewhere in content/ or in layers.
+/* XXX move into nsContentUtils */
This needs to actually move into nsContentUtils :-).
Also the version in nsHTMLMediaElement has improved, so you should move that one to nsContentUtils.
+    PRBool mIsOpaque;
We don't need this. You can just use mIsOpaqueContent/SetIsOpaqueContent that the layer already has.
+  virtual void Initialize(const Data& aData) = 0;
+  virtual void Updated(const nsIntRect& aRect) = 0;
Document these --- and CanvasLayer itself.
+  NS_ASSERTION(mUpdatedRect.IsEmpty(), ""CanvasLayer::Updated called more than once during a transaction!"");
+  NS_ASSERTION(mUpdatedRect.IsEmpty() || mBounds.Contains(mUpdatedRect), ""CanvasLayer: Updated rect bigger than bounds!"");
Break these lines ... think of the teletypes!
+  nsIntRect mBounds;
We only need an nsIntSize here, right?
+  nsIntRect mUpdatedRect;
We don't need this in BasicLayers, so I would just not have it at all.
Shouldn't we be calling Updated() somewhere?
+#if 0
   void PaintVideo(nsIRenderingContext& aRenderingContext,
                    const nsRect& aDirtyRect, nsPoint aPt);
-                              
+#endif
Er ... lose this?",CODE_REVIEW,0,FULL_TOKEN
561168,12,"+ * This interface contains methods that are needed outside of the content/layout
+ * modules, specifically widget.  It should eventually go away when we support
+ * libxul builds, and nsHTMLCanvasElement be used directly.
+ *
+ * Code internal to content/layout should /never/ use this interface; if the
+ * same functionality is needed in both places, two separate methods should be
+ * used.
I think the correct thing to do would be to move Aero Peek out of widget. We could put the interfaces in xpcom/system and the implementation in toolkit/system.",UNCODED,0,UNMATCHED
561168,13,"Oops, disregard comment #11. I see we need that for the drag code, not Aero Peek.",UNCODED,0,UNMATCHED
561168,14,"Patch 2 contains your LayerManagerOGL canvas implemention, shouldn't that be in patch 1 or its own patch?",QUESTION,0,FULL_TEXT
561168,15,Will this help bug 520776?,QUESTION,0,FULL_TEXT
561168,16,"Bas, roc, do you guys mind if I just merge all the patches?  (With the large file removal patch kept separate still.)  Would be easier to make changes as the patches really build on top of one another and aren't discrete chunks of work.
Martijn, nope, that's an issue with Linux.",QUESTION,0,FULL_TOKEN
561168,17,"Comment on attachment 443133
patch 1: basic CanvasLayer + 2D code
Presumably debug code :-)
We probably want to either return here, in case we want this check in release builds (I suspect we do), or assert, because right now this would be a pointless if in a release build.
If we require it to be empty, wouldn't assigning be cheaper than Union? It would save us a little bit of if-ing in UnionRect.",CODE_REVIEW,0,FULL_TEXT
561168,18,I'd actually like that. It would make it easier to review as well.,ANSWER_TO_QUESTION,0,FULL_TEXT
561168,19,"Generally a single big patch is harder to review, but if it's a lot of work to produce cleanly separated patches, I'm willing to review a big patch.",ANSWER_TO_QUESTION,0,FULL_TEXT
561168,20,"Created attachment 444506
updated and marged
This merges the patches and updates them with review comments.  It can largely be reviewed in toplevel chunks -- that is, per directory/directory group.
mUpdatedRect and friends are easier to keep as a rect than a Size due to unioning/clipping/etc.  In the future I think it might be possible to call updated more than once before finalization, hence the checks, though maybe I need to think through that a little more.",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,21,"-        persist=""screenX screenY width height sizemode""> 
+        persist=""screenX screenY width height sizemode""
+	>
Discard this hunk
@@ -1781,6 +1799,7 @@ public:
   ~nsAutoScriptBlocker() {
     nsContentUtils::RemoveScriptBlocker();
   }
+
and this one
@@ -5980,3 +6031,4 @@ nsIContentUtils::IsSafeToRunScript()
 {
   return nsContentUtils::IsSafeToRunScript();
 }
+
and this one
+  NS_IMETHOD RenderContextsExternal (gfxContext *ctx, gfxPattern::GraphicsFilter aFilter) = 0;
unnecessary space before (
 WebGLContext::Render(gfxContext *ctx, gfxPattern::GraphicsFilter f)
 {
...
+    return NS_ERROR_NOT_IMPLEMENTED;
Hmm ... shouldn't this be fixed before checking in? I assume this gets called when we use the canvas as an image source via nsLayoutUtils::SurfaceForElement?
+    //    if (mCanvasLayer)
+    //        return mCanvasLayer;
Might as well remove this
+    // This flush is required
+    MakeContextCurrent();
+    gl->fFlush();
why is it required?
+    nsRefPtr<layers::CanvasLayer> mCanvasLayer;
Not used, remove. Even with retained layers, you will not be remembering your layer directly, you'll ask the FrameLayerBuilder (new class) for your old layer.
+    canvasLayer->SetIsOpaqueContent(PR_FALSE);
Should probably respect the canvas opaque attribute. Maybe instead of the canvas context exporting GetCanvasLayer, it should be GetCanvasData, returning a CanvasLayer::Data that the caller creates a layer for? Then the rest of the layer initialization can be shared across contexts.
+    nsRefPtr<CanvasLayer> mCanvasLayer;
Don't have this here in the 2D context either. Just create a new one every time.
+      nsCOMPtr<nsIContent> content = do_QueryInterface(static_cast<nsIDOMHTMLCanvasElement*>(mCanvasElement));
+    nsCOMPtr<nsIContent> content = do_QueryInterface(static_cast<nsIDOMHTMLCanvasElement*>(mCanvasElement));
+    nsCOMPtr<nsIContent> content = do_QueryInterface(static_cast<nsIDOMHTMLCanvasElement*>(mCanvasElement));
teletype issue
+    //    if (mCanvasLayer)
+    //        return mCanvasLayer;
remove
+  } else {
+    nsRect r = frame->GetRect();
+    r.x = r.y = 0;
+    frame->Invalidate(r);
Should invalidate just the content area, so invalidate GetContentRect() - GetPosition().
nsHTMLCanvasElement::GetCanvasLayer should take a layer manager as a parameter instead of using LayerManagerForDocument. You might be asked to create a canvas layer for a different layer manager than the one being used to render the browser window (e.g., if someone does drawWindow to an arbitrary Thebes context).
+  struct Data {
+      Data()
+  : mSurface(nsnull), mGLContext(nsnull)
+      { }
Fix indent!!
+   * CONSTRUCTION PHASE ONLY
+   * Initialize this CanvasLayer with the given data.  The data must
+   * have either mSurface or mGLContext initialized (but not both), as
+   * well as mSize.
+   */
Say that this can only be called once?
+   * CONSTRUCTION PHASE ONLY
+   * Notify this CanvasLayer that the rectangle given by aRect
+   * has been updated, and any work that needs to be done
+   * to bring the contents from the Surface/GLContext to the
+   * Layer in preparation for compositing should be performed.
+   */
Say that the canvas buffer contents must not be modified during the layer transaction? That gives the implementation the flexiblity to avoid copying buffer data unless/until it needs it after the end of the transaction.
+  if (aData.mSurface) {
+    mSurface = aData.mSurface;
Assert here that aData.mGLContext is null
+  mSurface = aData.mSurface;
delete
+  if (mGLContext) {
+    nsRefPtr<gfxImageSurface> isurf =
+      new gfxImageSurface(gfxIntSize(mBounds.width, mBounds.height),
+                          IsOpaqueContent() ? gfxASurface::ImageFormatRGB24 : gfxASurface::ImageFormatARGB32);
+    if (!isurf || isurf->CairoStatus() != 0) {
+      return;
+    }
+
+    mGLContext->MakeCurrent();
+    mGLContext->fReadPixels(0, 0, mBounds.width, mBounds.height,
+                            LOCAL_GL_BGRA, LOCAL_GL_UNSIGNED_INT_8_8_8_8_REV,
+                            isurf->Data());
Shouldn't we only be reading back mUpdatedRect, or something like that? Is that future work? Probably deserves a comment at least.
I think the readback should happen during ::Paint, though (if mUpdatedRect is non-empty).
+    //gfxUtils::PermultiplyImageSurface(isurf);
What's this about? Do we need to premultiply?
+CanvasLayerOGL::Initialize(const Data& aData)
+{
+  NS_ASSERTION(mSurface == nsnull, ""BasicCanvasLayer::Initialize called twice!"");
+
+  mUpdatedRect.Empty();
Shouldn't need to set the rect to empty here, it starts empty
I'm sad that we need platform-specific pbuffer code here, but I know nothing about this so I have nothing else to suggest.
Like for BasicLayers, I think the CanvasLayerOGL code should defer all the real work until RenderLayer in case there are multiple Updated calls. Seems simpler that way anyway.
+      fprintf (stderr, ""Error: %d %x %p\n"", err, err, (void*) mGLContext->GetNativeData(GLContext::NativePBuffer)); fflush(stderr);
+const GLContextProvider::ContextFormat GLContextProvider::ContextFormat::BasicRGBA32Format(GLContextProvider::ContextFormat::BasicRGBA32);
+#define A2_(_x,_y)  do { attribs.AppendElement((CGLPixelFormatAttribute) _x); attribs.AppendElement((CGLPixelFormatAttribute) _y); } while(0)
wrap somewhere
+LibrarySymbolLoader::LoadSymbols(SymLoadStruct *firstStruct, bool tryplatform, const char *prefix)
PRBool
Looks like all the GLContext code needs to be using a* parameter names
+    mInitialized = (bool) LoadSymbols(&symbols[0], trygl, prefix);
Just change mInitialized to PRBool
Personally I suspect the A1/A2 macros aren't worth it...
Shouldn't nsHTMLCanvasFrame::GetCanvasSize return 0,0 for errors?",CODE_REVIEW,0,FULL_TOKEN
561168,22,"Created attachment 444923
updated, v3
Updated with review comments.  Note that this omits all the pure-file removals.",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,23,"Created attachment 444924
file removals patch
just the file removals",CODE_IMPLEMENTATION,1,FULL_TEXT
561168,24,"Oh, some comments on the patch:
WebGL specifies a different mechanism for opaqueness (one that we'll want to transition our 2d stuff to as well); we just don't implement it yet.  So currently webgl canvases can't be opaque, hence why this is always PR_FALSE for now.
Whoops, yes; I implemented gfxUtils::PremultiplyImageSurface based on the fast premult/unpremult code we had in Canvas 2D.  I couldn't convert that code to it since it actually premults/unpremults between an image surface and a raw buffer.  It could be fixed with a bit of wrapping of the raw data in an image surface, but I didn't do that here.",ANSWER_TO_QUESTION,0,FULL_TOKEN
561168,25,"Comment on attachment 444923
updated, v3
+  NS_IMETHOD RenderContextsExternal (gfxContext *ctx, gfxPattern::GraphicsFilter aFilter) = 0;
Unnecessary space before (
+    nsRefPtr<gfxImageSurface> surf = new gfxImageSurface(gfxIntSize(mWidth, mHeight),
+                                                         gfxASurface::ImageFormatARGB32);
+    if (surf->CairoStatus() != 0)
+        return NS_ERROR_FAILURE;
 
-        int bwidth = mGLPbuffer->Width();
-        int bheight = mGLPbuffer->Height();
+    MakeContextCurrent();
+    gl->fReadPixels(0, 0, mWidth, mHeight,
+                    LOCAL_GL_BGRA,
+                    LOCAL_GL_UNSIGNED_INT_8_8_8_8_REV,
+                    surf->Data());
Can you ASSERT that surf->Stride() is what you expect?
+    nsRefPtr<layers::CanvasLayer> mCanvasLayer;
You removed all uses of mCanvasLayer, but you still need to remove this declaration.
+    if (!LibrarySymbolLoader::LoadSymbols(mOGLLibrary, &pbufferSymbols[0], (LibrarySymbolLoader::PlatformLookupFunction)fGetProcAddress)) {
+        // this isn't an error, just means that pbuffers aren't supported
+        fCreatePbuffer = nsnull;
+    }
+
+    if (!LibrarySymbolLoader::LoadSymbols(mOGLLibrary, &pixFmtSymbols[0], (LibrarySymbolLoader::PlatformLookupFunction)fGetProcAddress)) {
Teletype
+    // the future we should use mUpdatedRect, thoug hwith WebGL we don't
Fix typo",CODE_REVIEW,0,90_PCT_MATCH
561168,26,"Created attachment 445006
y-axis flipping followup
Small followup -- fixes y-axis flip issues when rendering WebGL using BasicLayers.  WebGL is rendered correctly when using OpenGL layers, but normal 2d canvases will be flipped upside down -- I'll fix this next, but it's going to depend on bug 565435 being fixed, since I have to fiddle with texcoords.  Might take a day or two.  I don't think it's an issue for now, since we don't have accelerated rendering for the browser window currently.",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,27,"Created attachment 445806
filter followup
and one more followup -- the image-rendering mode was being ignored.  try server run going again, this was the only reftest that failed last time.",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,28,"WebGLArray.h was removed from the EXPORTS in content/canvas/public/Makefile.in, but the file itself sits still in said directory and is an #include dependency for WebGLContextNotSupported.cpp. The build breaks due to not finding the header file. I commented #include WebGLArray.h out and WebGLContextNotSupported.cpp was compiled successfully. Dunno if that's the right fix as another possibility would be to add WebGLArray.h back to the EXPORTS in the Makefile. Please give me a hint that I can open a follow-up bug with a proper fix. I'm building on OS/2 w/o WebGL dissabled (of course), thanks.",SOLUTION_VERIFICATION,0,FULL_TEXT
561168,29,"Nope, that's the right fix -- missed that while I was munging removals.  Just pushed a fix.",CODE_IMPLEMENTATION,1,FULL_TOKEN
561168,30,"http://hg.mozilla.org/mozilla-central/rev/d29a248fb5a9
http://hg.mozilla.org/mozilla-central/rev/e11ef37d8108
http://hg.mozilla.org/mozilla-central/rev/f3d0956d3413
http://hg.mozilla.org/mozilla-central/rev/56f033dd888a
http://hg.mozilla.org/mozilla-central/rev/652733ce0792
http://hg.mozilla.org/mozilla-central/rev/89b1ef9ebec3",UNCODED,0,UNMATCHED
561168,31,"Sorry, it appears that you removed to much here:
weakld: error: Unresolved symbol (UNDEF) '_kDOMClassInfo_WebGLFramebuffer_interf
aces'.
weakld: info: The symbol is referenced by:
    E:\mozbuild4\mozilla\dom\base\jsdombase_s.lib(nsDOMClassInfo.o)
and so on
 DOMCI_DATA(CanvasRenderingContextWebGL, void)
-DOMCI_DATA(WebGLBuffer, void)
-DOMCI_DATA(WebGLTexture, void)
-DOMCI_DATA(WebGLProgram, void)
-DOMCI_DATA(WebGLShader, void)
-DOMCI_DATA(WebGLFramebuffer, void)
-DOMCI_DATA(WebGLRenderbuffer, void)
These lines have to be added back",CODE_REVIEW,0,FULL_TOKEN
561168,32,*** Bug 565321 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
576837,1,"/[C-\s]/;
YARR: accepts it
OLD:  ""invalid range in character class""",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
576837,2,Same with /[f-\d]/,REPRODUCTION_ATTEMPT,0,FULL_TEXT
576837,3,"TL;DR: YARR wrong. Will fix.
YARR treats the dash as being a member of the character class (brackets) when it precedes a built-in character class (like \s).
js> /[C-\s]/.exec(' ') 
["" ""]
js> /[C-\s]/.exec('-') 
[""-""]
This string is accepted by the grammar by the following derivation, so it's not a syntax error due to the grammar:
...
-> Atom
-> CharacterClass
-> ""["" ClassRanges ""]""                    (remaining: ""C-\s"")
-> NonEmptyClassRanges
-> ClassAtom ""-"" ClassAtom ClassRanges
-> ClassAtom ""-"" ClassAtom [empty]
-> ClassAtomNoDash ""-"" ClassAtomNoDash
-> SourceCharacter ""-"" ""\"" ClassEscape
-> ""C"" ""-"" ""\"" CharacterClassEscape
-> ""C"" ""-"" ""\"" ""s""                        (accepted)
However, 15.10 tacks additional restrictions onto the grammar; namely, ECMAScriptv5 15.10.2.15 production NonemptyClassRanges :: ClassAtom - ClassAtom ClassRanges calls the abstract operation CharacterRange(A, B) in step 4, and CharacterRange step 1 says that if B does not contain exactly one character then a SyntaxError must be thrown, and all the builtin character classes contain more than one character.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
576837,4,"Created attachment 482286
Fix character class range with builtin character class on RHS.
Produces the same error message for us as the rest of the character class badnesses, but I added a new error code for upstreamy goodness.",CODE_IMPLEMENTATION,1,FULL_TEXT
576837,5,"Comment on attachment 482286
Fix character class range with builtin character class on RHS.
[jwalden@find-waldo-now src]$ dbg/js
js> /[C-\s]/.exec(""-"")
invalid range in character class
js> /[\s-C]/.exec(""-"")
[""-""]
Test needs to make sure to address the reversed cases, too.",CODE_REVIEW,0,FULL_TOKEN
576837,6,"The restrictions on ClassAtomNoDash are also not enforced because the character class parser is a very simple DFA. Any non-descending single-character range is considered valid. Check out this awesome pattern:
/[--/]/.exec('.') 
["".""]",CLARIFICATION,0,FULL_TOKEN
576837,7,"Sorry, that pattern is actually valid! The restrictions on ClassAtomNoDash's SourceCharacter (but not one of '\' or ']' or '-') are still suspect, just have to come up with a pattern that triggers it.",CLARIFICATION,0,FULL_TEXT
576837,8,"Eh, I think it's okay. Expanding the productions under NonEmptyClassRanges, you get the following regular patterns, with CA short for ClassAtom, CAND short for ClassAtomNoDash, and ... indicating a permitted top-level recursion:
CA
CA CA
CA CAND* CA
CA CAND - CA ...
CA - CA ...
CA CAND - CA ...
The semantic errors for the |CAND - CA| and |CA - CA| forms are the same, so we should be able to figure out all the appropriate places for a dash with mode bits, as we do now. I'll just fix the error and shut up now. :-)",CLARIFICATION,0,FULL_TOKEN
576837,9,"Created attachment 485837
Fix character class range with builtin character class on any side.
No need to cache/flush the character class like we do the unescaped characters, since a range with a builtin character class in it is always a syntax error.",CODE_IMPLEMENTATION,1,FULL_TEXT
576837,10,"Comment on attachment 485837
Fix character class range with builtin character class on any side.
Hmm, I think /\s\w-\W/ should be failing as well.",CODE_REVIEW,0,FULL_TEXT
576837,11,"Comment on attachment 485837
Fix character class range with builtin character class on any side.
That's because I didn't put it in a character class. Duh. (One of those days.)",CLARIFICATION,0,FULL_TEXT
576837,12,"Comment on attachment 485837
Fix character class range with builtin character class on any side.
Plain true/false don't do it for me for readability, suggest checkRangeValid/checkRangeInvalid methods forwarding to one common method.
Add in some tests with \b and \B since those aren't treated as character class escapes.
Good style appears to suggest m_sawCharacterClass, to make upstreaming easier.
As far as good style goes, it appears that this code parenthesizes equality expressions that aren't the whole of conditions -- so |((m_character == '-') && m_sawCharacterClass)|.
I think this would be more readable if you didn't put the sawCharacterClass in the else-block.  It makes more sense (even if one doesn't subscribe to else-after-return being evil) to say that *if* the just-passed character class starts a range, *then* it's an error and you exit.  But the sawCharacterClass assignment applies to both arms of the if below, so it seems it makes more sense to something like this:
(Add parentheses per the earlier comment.)
I had trouble understanding both parts of your condition here -- suggest adding something noting that the first part handles things like [a-\d] and the second part handles things like [\w-\s].  For that matter, the most obvious place for any of these checks, in |case cachedCharacter|, is only hit (I think) in the case of [\w-a] or [\w-\b] -- may as well add a comment to that effect there, too.",CODE_REVIEW,0,FULL_TOKEN
576837,13,"For what it's worth, I found the intricate handoffs between parsing escapes, parsing non-escapes, and the state of CharacterClassDelegate to be way too confusing.  But I am loath to suggest significant adjustment as it seems likely to complicate the maintenance burden upstream updates would cause in concert with such changes.",CODE_REVIEW,0,FULL_TOKEN
576837,14,http://hg.mozilla.org/tracemonkey/rev/8ae5fce0f19b,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
576837,15,"Backout: http://hg.mozilla.org/tracemonkey/rev/f4444a398ec1
Somehow I missed bug 351463: with a hyphen between two character classes we are intentionally not compliant to the spec.",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
576837,16,http://hg.mozilla.org/mozilla-central/rev/8ae5fce0f19b,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
576837,17,Reopening because it was backed out -- I still have to follow up by committing with the two-character-class range removed as a syntax error.,STATUS_UPDATE,0,FULL_TEXT
576837,18,It looks like this bug was almost fixed. What's left to do on it?,QUESTION,0,FULL_TEXT
576837,19,"I made us conform to our old, 1.9.2 behavior, so the m_sawCharacterClass was unnecessary after all.
http://hg.mozilla.org/tracemonkey/rev/08f2504e5f44",CODE_IMPLEMENTATION,1,FULL_TEXT
576837,20,http://hg.mozilla.org/mozilla-central/rev/08f2504e5f44,UNCODED,0,UNMATCHED
577462,1,"Created attachment 456428
Use GetDC where we can
For opaque SYSTEMMEM textures we can call the GetDC method on the primary surface to draw directly to a DC. We should use this for layers where mIsOpaqueContent is true.",CODE_IMPLEMENTATION,1,FULL_TEXT
577462,2,Ignore the accelerated=11 part in the beginning =),UNCODED,0,UNMATCHED
577462,3,"Created attachment 456644
Use GetDC where we can v2
Updated to use a UseOpaqueSurface function taken from the BasicLayers code.",CODE_IMPLEMENTATION,1,FULL_TEXT
577462,4,"Comment on attachment 456644
Use GetDC where we can v2
Someplace you should put a comment that says that GetDC is not supported
on surfaces of D3DFMT_A8R8G8B8 format and that that's the motivation
for splitting things out here.",CODE_REVIEW,0,FULL_TOKEN
577462,5,Pushed http://hg.mozilla.org/mozilla-central/rev/30984290515f.,UNCODED,0,UNMATCHED
577462,6,Pushed http://hg.mozilla.org/mozilla-central/rev/7ea77e6340c4.,UNCODED,0,UNMATCHED
590389,1,We cannot use nsIUnicodeEncoder / nsIUnicodeDecoder interface from script.  so getUnicode* methods should not scriptable.,PROBLEM_MOTIVATION,0,FULL_TOKEN
590389,2,"Created attachment 532552
fix",UNCODED,0,UNMATCHED
590389,3,http://hg.mozilla.org/mozilla-central/rev/177b41f10269,UNCODED,0,UNMATCHED
596726,1,"User-Agent:       Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.9) Gecko/20100824 Firefox/3.6.9
Build Identifier: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.9) Gecko/20100824 Firefox/3.6.9
See the attached URL for a working example of the problem which appeared in Firefox 3.6.9.
If a <pre> has contentEditable=true, deleting the first character on a line will bring that line up to the previous line.  Similarly, trying to enter a character with the caret at the beginning of a blank line will actually add the character to the next line.
The demo url is the best explanation of this.
Reproducible: Always
Steps to Reproduce:
1. Click inside a contentEditable div
2. Delete the first character of any line
Or
3.  Add a character at the beginning of a blank line.
Actual Results:  
Deleting the first character of a line moves the rest of the line to the end of the previous line.
Adding a character to the beginning of a blank line actually adds it to the beginning of the next line.
Expected Results:  
Characters should be inserted and deleted without changing surrounding lines.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
596726,2,Seems to be WFM on Trunk on WinXP (Mozilla/5.0 (Windows NT 5.1; rv:2.0b6pre) Gecko/20100913 Firefox/4.0b6pre ID:20100913041656).,REPRODUCTION_ATTEMPT,0,FULL_TEXT
596726,3,This has been fixed on trunk by some of the patches that I landed as part of the work in bug 240933.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
597389,1,"Created attachment 476234
Patch v1.0
1. Load above page with Fx3.6 and Flash Player 10.1.x.x
2. Click a link in the Flash Player which is center of the page (the radio program list)
Then, you cannot use non-Roman keyboard layout on Fx.
Flash Player disables non-Roman keyboard layout and if you click the link, Flash Player doesn't recover the keyboard layout state when it's destroying. Gecko stores latest keyboard layout state when Gecko changes it because 10.4 doesn't provide any APIs for getting the state. And Gecko reduces unnecessary API call at nsTSMManager::SetRomanKeyboardsOnly(). Therefore, Gecko doesn't restore the keyboard state until Gecko's password field gets focus.
# NOTE #1: This bug isn't reproduced on Minefield, probably, the reason is that Minefield uses new APIs which are usable 10.5 and later.
# NOTE #2: This bug isn't reproduced with Flash Player 10.0.x.x. So, this is a regression of Flash Player.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
597389,2,"This bug can be reproduced on Fx3.5 too. However, it's going to be dropped but SeaMonkey is going to continue to use 1.9.1 for a while. So, we should fix this bug on 1.9.1 too.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
597389,3,"I can't reproduce this bug (testing in FF 3.6.9 on OS X 10.5.8) ... or
at least I don't think I can.
Here's what I did:
1) Load this bug's URL (http://www.tbs.co.jp/radio/todays954/) and
   click somewhere in the Flash object.
   Notice that it's no longer possible to choose Kotoeri Hiragana or
   Katakana from the ""flags"" menu (those choices are greyed out).
2) Click elsewhere in the page.
   Now it's once again possible to choose Hiragana or Katakana.
3) Click on the Flash object -- Hiragana and Katakana are greyed out.
4) Switch tabs -- Hiragana and Katakana are no longer greyed out.
5) Switch back to the tab with http://www.tbs.co.jp/radio/todays954/
   in it -- Hiragana and Katakana are still not	greyed out.
6) Click on the Flash object -- Hiragana and Katakana are greyed out.
7) Close the current tab (with http://www.tbs.co.jp/radio/todays954/
   in it) -- Hiragana and Katakana are no longer greyed out.
Later I'll try it on OS X 10.6.4.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
597389,4,"(Following up comment #3)
I get the same results on OS X 10.6.4.
By the way, on both OS versions I tested with en-US Firefox and the preferred language was set to English.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
597389,5,"Click a link in the Flash Object. Then, you'll open a page on current tab. Then, the keyboard layout limitation isn't canceled.
I can reproduced this bug on 10.5 and 10.6. The original reporter in Japan said that he/she can reproduce this bug on 10.4 too.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
597389,6,CC'ing Charles because it appears it might also be a Flash regression,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
597389,7,"OK, thanks.  Now I can reproduce it.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
597389,8,"Comment on attachment 476234
Patch v1.0
This looks fine to me.",CODE_REVIEW,0,FULL_TEXT
597389,9,"Comment on attachment 476234
Patch v1.0
Thank you, Steven.
This patch just removes an optimizing code for reducing API call. I think that this change doesn't affect to performance.",CODE_REVIEW,0,FULL_TEXT
597389,10,NOTE: the method is called at focus moving only when IME state is changed by new focused content.,CODE_REVIEW,0,FULL_TEXT
597389,11,"Comment on attachment 476234
Patch v1.0
Approved for 1.9.2.11 and 1.9.1.14, a=dveditz for release-drivers",CODE_REVIEW,0,FULL_TEXT
597389,12,"http://hg.mozilla.org/releases/mozilla-1.9.2/rev/c0c261de23ec
http://hg.mozilla.org/releases/mozilla-1.9.1/rev/e532600954d0",UNCODED,0,UNMATCHED
597389,13,Verified fixed in 1.9.2 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.2.11pre) Gecko/20100923 Namoroka/3.6.11pre. Verified fixed in 1.9.1 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.14pre) Gecko/20100923 Shiretoko/3.5.14pre.,SOLUTION_VERIFICATION,0,FULL_TEXT
601912,1,"User-Agent:       Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10 (.NET CLR 3.5.30729)
Build Identifier: Mozilla/5.0 (en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10
HTML 5's <li> reversed attribute is ignored. It was supposed to reverse the list numbering.
Reproducible: Always",PROBLEM_DESCRIPTION,0,FULL_TEXT
601912,2,"I hope that you have tested this with FF4beta and not only with 3.6.x ?
Please attach a testcase if you get this with FF4.6beta6 or later",TESTCASE_REQUEST,0,FULL_TEXT
601912,3,"<html><body>
<ol reversed>
<li>3</li>
<li>2</li>
<li>1</li>
</ol>
</body></html>
prints:
1. 3
2. 2
3. 1
but it should print:
3. 3
2. 2
1. 1",TEST_CASES,0,FULL_TOKEN
601912,4,"I'm not crazy about this feature; we'd need to extend the CSS counter model to do this, and it's complicated enough already.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
601912,5,Confirming: not implemented in FF4b10.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
601912,6,"Created attachment 509082
Test case: OL lists with start, value, and reversed attributes
Firefox 4 implements:
- <ol start=integer> (with positive and negative integers),
- <li value=integer> (likewise).
Doesn't implement:
- <ol reversed>",TEST_CASES,0,FULL_TOKEN
601912,7,"Created attachment 509097
Test case: changing start value or count order with CSS
This test case illustrates that you can, with CSS:
- start an ordered list with a specific value (same as HTML start attribute),
- count in bigger increments (no HTML equivalent that I know of),
- count backwards (i.e. in negative increments).
But you can't:
- use CSS to count backwards (countdown style) unless you already know the number of items and you hardcode that value in your CSS.",TEST_CASES,0,FULL_TOKEN
601912,8,"David, if we don't think this should be in the spec we should push back on the spec.  Letting it stay in the spec but not implementing is the worst of both worlds...",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
601912,9,"Created attachment 637531
Implement <ol reversed>.",UNCODED,0,UNMATCHED
601912,10,"Boris, could you update content/html/content/test/test_ol_attributes_reflection.html?",CODE_UPDATE_REQUEST,0,FULL_TEXT
601912,11,It's in the diff!,CLARIFICATION,0,FULL_TEXT
601912,12,Damn! I checked but haven't seen it :( I will double-check next time!,UNCODED,0,UNMATCHED
601912,13,What handles renumbering when new items are appended?  Do you have tests for that?,QUESTION,0,FULL_TOKEN
601912,14,"There's a RenumberLists() call in nsBlockFrame::Reflow that handles it.
I'll add a test for this.",STATUS_UPDATE,0,FULL_TEXT
601912,15,Is this a typo?,CODE_REVIEW,0,FULL_TEXT
601912,16,"Created attachment 637559
With a test for appending",UNCODED,0,UNMATCHED
601912,17,"Yes, fixed.  Doesn't affect anything, of course.",ANSWER_TO_QUESTION,0,FULL_TOKEN
601912,18,"Created attachment 640083
With some assertions also fixed so this passes tests",UNCODED,0,UNMATCHED
601912,19,"Created attachment 642184
Implement <ol reversed>.",UNCODED,0,UNMATCHED
601912,20,"Comment on attachment 642184
Implement <ol reversed>.
Hoping it's ok if I transfer this review request to you; if not, send it back.",CODE_REVIEW,0,FULL_TEXT
601912,21,"bz, would you mind posting an unbitrotted version of this?
(Planning to review this in the next couple of days -- ideally, I'd prefer to review & try running with an up-to-date version.  The posted patch was from before the stdint & nullptr switchovers, I believe, so it doesn't apply at the moment. Not sure if there's other bitrot beyond that, as well.)",CLARIFICATION,0,FULL_TEXT
601912,22,"Created attachment 659366
With the various mass-changes applied
Sure thing!",CODE_IMPLEMENTATION,1,FULL_TEXT
601912,23,"Comment on attachment 659366
With the various mass-changes applied
[...]
This probably wants to check Tag(), too, something like this:
  if (nsGkAtoms::start == aAttribute || 
      (nsGkAtoms::reversed == aAttribute && nsGkAtoms::ol == mContent->Tag()) {
since reversed only has an effect on <ol> elements -- right?  (Later in this patch, you check Tag() in the same spot where you check for reversed)
(I don't imagine this will affect behavior, but it should just save us some unnecessary notifications)
[...]
Maybe add a MOZ_ASSERT(hc, ...) there to document what that comment's claiming?  Then if FrameStartsCounterScope() gets a bug at some point, we'll get a helpful assertion-failure instead of a mysterious segfault.
s/lis/list/
I wonder if we might even want to make this ""ordinal -= increment"" instead of ""++ordinal""? (and check ""increment < 0"" instead of ""== -1"" in the ""else if"" check above it)
That way, abritrary increment values should Just Work (e.g. if the WHATWG introduces ""<ol increment=""3"" reversed>"" at some point in the future)
That could be premature generalization, though -- the existing code is good too.
[...]
Might be worth asserting that aIncrement is either 1 or -1 here, just as a sanity-check, since (for now) those are the only values that we're expecting to add.
It's probably worth having a test where we wrap past 0 into negative territory, too -- like this test, but with start=""1"" maybe?
Also, since this is actual feature-work (rather than a random-bugfix), these tests probably deserve ""real"" names instead of ""601912-*"", and they probably want to live in layout/reftests/list-item/ instead of layout/reftests/bugs.
Also: I noticed that http://blog.whatwg.org/reverse-ordered-lists mentions that XHTML needs this to be specified as <ol reversed=""reversed""> -- does that work right now?  (and do we reject other values for the ""reversed"" attribute in XHTML, as it sounds like we should?)
It'd probably be good to add XHTML reftests showing that reversed=""reversed"" works and reversed=""anything_else"" is ignored.
r=me with the above addressed.",QUESTION,0,FULL_TOKEN
601912,24,"That's an authoring conformance requirement because <ol reversed> is not valid XML.
Technically, in HTML (non-XHTML) there are only two valid ways of writing this: <ol reversed> and <ol reversed=""reversed"">.  Again, as an authoring conformance requirement.
The UA conformance requirement is the same for HTML and XHTML, and is given at http://www.whatwg.org/specs/web-apps/current-work/multipage/grouping-content.html#attr-ol-reversed and following.  Note that all that text talks just about whether the attribute is set at all, not what values it's set to.  That's just how boolean attributes work in HTML.
I addressed the rest of the comments.",ANSWER_TO_QUESTION,0,FULL_TOKEN
601912,25,https://hg.mozilla.org/integration/mozilla-inbound/rev/f083c0a666d3,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
601912,26,https://hg.mozilla.org/mozilla-central/rev/f083c0a666d3,UNCODED,0,UNMATCHED
601912,27,"Updated:
https://developer.mozilla.org/en-US/docs/HTML/Element/ol
and
https://developer.mozilla.org/en-US/docs/Firefox_18_for_developers",UNCODED,0,UNMATCHED
601912,28,(To be pedantic: <ol reversed=''> is valid in both HTML and XML.),UNCODED,0,UNMATCHED
601999,1,"Created attachment 480993
testcase (crashes Firefox when loaded)
(Split from bug 550306)
I'm hitting this a lot, and it's hard to distinguish too-much-recursion crashes from each other, so this makes fuzzing difficult.",PROBLEM_MOTIVATION,0,FULL_TEXT
601999,2,"    Relevant stack bit:
    169 PresShell::FlushPendingNotifications(mozFlushType) + 706
    (nsPresShell.cpp:4800)
    170 PresShell::HandlePostedReflowCallbacks(int) + 250 (nsPresShell.cpp:4692)
    171 PresShell::DidDoReflow(int) + 40 (nsPresShell.cpp:7215)
    172 PresShell::ProcessReflowCommands(int) + 419 (nsPresShell.cpp:7479)
    173 PresShell::FlushPendingNotifications(mozFlushType) + 706
    (nsPresShell.cpp:4800)",UNCODED,0,UNMATCHED
601999,3,The obvious question: which reflow callback is it?,INFO_REQUEST,0,FULL_TEXT
601999,4,"It's this reflow callback for the nsHTMLScrollFrame (inside the <select> element), which gets registered here:
826   // Restore the old scroll position, for now, even if that's not valid anymore
827   // because we changed size. We'll fix it up in a post-reflow callback, because
828   // our current size may only be temporary (e.g. we're compute XUL desired sizes).
829   PlaceScrollArea(state, oldScrollPosition);
830   if (!mInner.mPostedReflowCallback) {
831     // Make sure we'll try scrolling to restored position
832     PresContext()->PresShell()->PostReflowCallback(&mInner);
http://hg.mozilla.org/mozilla-central/annotate/882525a98119/layout/generic/nsGfxScrollFrame.cpp#l825
The callback function itself is nsGfxScrollFrameInner::ReflowFinished
http://hg.mozilla.org/mozilla-central/annotate/882525a98119/layout/generic/nsGfxScrollFrame.cpp#l2873
Regression range for this bug:
  20100813031312 d5e211bdd793
  20100814030707 656d99ca089c
http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=d5e211bdd793&tochange=656d99ca089c
The lowest push in that range looks most related:
http://hg.mozilla.org/mozilla-central/pushloghtml?changeset=29114207a571",ANSWER_TO_QUESTION,0,FULL_TOKEN
601999,5,"Hm, I take that back -- a targeted build at that push is unaffected.
Now I'm suspecting this cset:
 http://hg.mozilla.org/mozilla-central/rev/1bf9a4c8c8b4
 Bug 572689 - Make nsSVGRenderingObservers observe elements instead of frames
I think something like this is going on: we reflow our scrollframe, and that invalidates the filter (which the scrollframe is a part of), and that triggers a reflow of the frames to which the filter is applied (including the scrollframe). This continues in a death-spiral.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
601999,6,"Created attachment 486696
testcase 2 (crashes firefox when loaded)
Here's a somewhat-simpler testcase with an explicit scrollframe (using ""overflow-x: scroll"" instead of <select>).
In this testcase, the filter itself & the element to which it applies are both just the div with ""overflow-x"" (rather than the entire document).",TEST_CASES,0,FULL_TOKEN
601999,7,"OK -- the first affected changeset is 4a50f3c34d5a, and the crash goes away if I comment out this line that was added in that changeset:
http://hg.mozilla.org/mozilla-central/diff/4a50f3c34d5a/layout/generic/nsFrame.cpp",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
601999,8,"NOTE: up until the changeset in Comment 6, mozilla-central only had one call to nsSVGEffects::InvalidateDirectRenderingObservers -- in nsFrame::DestroyFrom(nsIFrame* aDestructRoot).",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
601999,9,"So I see a few possible strategies here:
 A. Remove the line mentioned in Comment 6.
 B. Check for cycles in nsSVGRenderingObserver::InvalidateViaReferencedElement
 C. Check for cycles in nsSVGEffects::AddRenderingObserver
I just tried (A) -- removing the regressing line -- on TryServer, and it doesn't actually break any unit tests, which is encouraging.  I'm guessing it'd be possible to construct a -moz-element testcase that would end up painting stale data as a result of that change, but I'm not immediately sure what that testcase would look like.
(B) and (C) might be better for correctness, but I'm not entirely sure how to best check for cycles there. Maybe we'd disallow rendering-observer-notifications being sent to an element from any of its ancestors?  And even if that's the right thing to do, it could still be undesirable perf-wise (it'd make us walk the DOM tree on every InvalidateViaReferencedElement or AddRenderingObserver call).
Also: I'm not sure that (C) would work after tree-surgery -- i.e. when we re-parent an element, do we un-register and then re-register it as a rendering observer?  If not, then you could still construct testcases that fail here, if they just do some node-reparenting at the last minute.
I tend to lean towards strategy (A), but I'm open to suggestions/advice.  (Maybe there's another obvious solution I'm missing?)",SOLUTION_REVIEW,1,FULL_TOKEN
601999,10,"Created attachment 488050
fix: delete regressing line
This is ""Strategy A"" from comment 8. (delete the regressing line)
Includes a crashtest from this bug & one from related bug 587336, both of which fail (hang or crash) pre-patching but pass post-patching.",CODE_IMPLEMENTATION,1,FULL_TOKEN
601999,11,"Comment on attachment 488050
fix: delete regressing line
mstange, I'd appreciate any thoughts you have on this, if you get a chance (in particular, what it might break, & if any better fix-strategies jump out at you).",CODE_REVIEW_REQUEST,0,FULL_TEXT
601999,12,"I think we need that wherever -moz-element needs to observe changes in the rendering of an HTML element.
Why is invalidation triggering a reflow?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
601999,13,"Not sure off the top of my head -- I've been working with the testcases in bug 587336 more recently than the testcases here.  However, just a restyle is sufficient to cause problems, in that bug's testcases -- see e.g. the stack in attachment 486783. (& description in bug 587336 comment 4).",ANSWER_TO_QUESTION,0,90_PCT_MATCH
601999,14,"So to answer comment 11 a little better -- what happens in the testcase here is basically the following:
 (1) We're reflowing the page
 (2) When we reflow the scrollFrame's child-block-frame, that triggers the InvalidateDirectRenderingObservers call from Ccomment 6
 (3) That uses NS_UpdateHint to request an (asynchronous) reflow.
 (4) At the end of our current reflow, we call HandlePostedReflowCallbacks, which runs a callback to update our scroll frame's scrollbars. (noted in comment 3)
 (5) That callback returns true, which makes us call FlushPendingNotifications at the last line of HandlePostedReflowCallbacks.
 (6) This flush makes us synchronously run the reflow that we'd requested in Step 3.
   (Return to step 1; repeat until stack is exhausted)",ANSWER_TO_QUESTION,0,FULL_TOKEN
601999,15,"Meant to reference this code (nsSVGFilterProperty::DoUpdate) for this step:
http://mxr.mozilla.org/mozilla-central/source/layout/svg/base/src/nsSVGEffects.cpp?mark=276-278#265",CLARIFICATION,0,FULL_TOKEN
601999,16,"OK, the reason we're doing that is to ensure that the ancestors' overflow areas are updated. But during reflow that's going to happen anyway. So we need to suppress that additional reflow request when the frame affected is currently being reflowed. I think you can just check FRAME_IN_REFLOW somewhere.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
601999,17,"Created attachment 488377
fix v2
Here's a fix along the lines of comment 15 (just guarding the NS_UpdateHint call with a NS_FRAME_IN_REFLOW state-check.)
This fixes this bug's testcases, but not Bug 587336's testcases -- Bug 587336 is going to need its own patch.",CODE_IMPLEMENTATION,1,FULL_TOKEN
601999,18,"Thanks for looking into this, Daniel, and sorry that I didn't speak up sooner.
Uh oh, shame on me for lack of test coverage. I'll write a test that would break asap.
The call to InvalidateDirectRenderingObservers has the purpose of invalidating (purely visually) any elements that use the current element as a -moz-element paint server. The fact that it can also cause reflows is unfortunate, and in fact it's never necessary, at least not from nsIFrame::InvalidateInternal. (It is necessary when, for example, a filter's overflow actually changes, but then we're notified elsewhere and don't need to do anything in InvalidateInternal.)
Maybe we should split rendering observers into two types? One ""visual"" type for -moz-element and another for filters, masks, etc. Then we'd only invalidate visual observers from nsIFrame::InvalidateInternal, which must not cause reflows, and the problem is gone.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
601999,19,"Daniel, do you think the approach I suggested in the last comment would fix bug 587336, too?
I mean, the patches here and in bug 587336 are fine, but maybe the fact that we're unnecessarily triggering restyles during invalidation at all has caused more bugs of this kind which we don't know about yet. Restoring the pre-bug 506826 state might be the less risky approach.",CLARIFICATION,0,FULL_TEXT
601999,20,"That would work, and I'd definitely take a patch for that.
However, one of our post-FF4 priorities is to rework invalidation to compare ""before"" and ""after"" display lists instead of using the nsIFrame::Invalidate machinery. That will make all these issues go away, or at least behave very differently.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
601999,21,"Thanks for the feedback, Markus!  Your suggestion sounds promising, but I personally am a little hesitant to implement that change, when there's a more targeted fix available, primarily because:
 - it sounds like it could be somewhat risky, this late in the game (for the potential benefit)
 - any other as-yet-undetected bugs of this sort are likely to be sg:dos at worst (infinite loops)
 - as roc pointed out, the situation here will change post-Firefox 4
 - there are other blockers that need my attention :)
So, I'd lean towards sticking with the fix strategies in the patches attached here and on bug 587336, and then perhaps implementing Markus's suggestion in a separate bug if anyone can get to it, but probably not blocking the Firefox 4 release on that. Does that sound reasonable?",SOLUTION_REVIEW,1,FULL_TOKEN
601999,22,It does to me.,ANSWER_TO_QUESTION,0,FULL_TEXT
601999,23,Landed: http://hg.mozilla.org/mozilla-central/rev/3dac4e710157,UNCODED,0,UNMATCHED
601999,24,Sure. Thanks!,UNCODED,0,UNMATCHED
626855,1,"STR with Fennec:
1) Open http://www.htmlcodetutorial.com/frames/frameset.html
2) Try to scroll (in a debug build)",S2R,0,FULL_TOKEN
626855,2,"Created attachment 504880
Crash: trying to scroll HTML page with frameset",PROBLEM_DESCRIPTION,0,FULL_TEXT
626855,3,"Comment on attachment 504880
Crash: trying to scroll HTML page with frameset
Layers were not properly getting their scroll IDs updated if there is no root scroll pane for a presshell. This happens for <framesets> at least.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
626855,4,"To potential approvers: patch is low risk, and fixes panning for sites without scroll frames.",CLARIFICATION,0,FULL_TEXT
626855,5,Pushed http://hg.mozilla.org/mozilla-central/rev/b22bb39e834f,UNCODED,0,UNMATCHED
627984,1,"This asserts in interpreter/-m/-j:
--
var o = Array;
o.p = function() {};
o.watch('p', function() { }); 
for(var x in o) { 
    o[x]; 
}
delete o.p;
o.p = function() {};
print(o.p);
--
Assertion failure: isObject(), at ../jsvalue.h:602",TEST_CASES,0,FULL_TOKEN
627984,2,"Created attachment 506096
Stacktrace",UNCODED,0,UNMATCHED
627984,3,"Reduced further:
--
var o = Array;
o.watch('p', function() { }); 
for(var x in o) {  };
delete o.p;
o.p = function() {};
print(o.p);
--",TEST_CASES,0,FULL_TOKEN
627984,4,"The first bad revision is:
changeset:   58560:52d20032116a
user:        Jason Orendorff <jorendorff@mozilla.com>
date:        Thu Dec 09 12:04:35 2010 -0600
summary:     Bug 614051 - TM: wrong behavior setting existing properties to joined function object values again. r=brendan.",UNCODED,0,UNMATCHED
627984,5,security sensitive per jandem's request.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
627984,6,"This one crashes with -j in a release build:
--
var o = Array;
o.watch('p', function() { }); 
for(var x in o) {};
delete o.p;
o.p = function() {};
for(var i=0; i<20; i++) {
    print(o.p);
}
--
Stack trace:
Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_PROTECTION_FAILURE at address: 0x0000001c
0x00194fea in js::MethodReadBarrier ()
(gdb) bt
#0  0x00194fea in js::MethodReadBarrier ()
#1  0x00382f08 in ?? ()
#2  0x001b326c in js::ExecuteTree ()
Previous frame inner to this frame (gdb could not unwind past this frame)",STACK_TRACE,0,FULL_TOKEN
627984,7,"This seems relatively obscure, and seems not to be sg:critical, so that this late, I think it only needs to be a softblocker.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
627984,8,The branded shape and the slot holding the method are out of sync here. This is at least pretty scary.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
627984,9,"var o = Array;
o.p = function() {};
o.watch('p', function() { });
Object.keys(o);
delete o.p;
o.p = function() {};
print(o.p);
The iteration seems necessary here (keys), I don't know why.",TEST_CASES,0,FULL_TOKEN
627984,10,"Object.keys triggers the resolve hook on Array. This simplified test case crashes too:
var o = Array;
o.p = function() {};
o.watch('p', function() { });
o.length;
delete o.p;
o.p = function() {};
print(o.p);
Looks like we mess up the write barrier here. Watch sets a getter which makes shape no longer say yes to ""isMethod"", and resolving another method on that causes bad things. Pretty sketchy stuff.",TEST_CASES,0,FULL_TOKEN
627984,11,"No resolve hook needed. Just adding another function (which causes rebranding) will do it.
var o = ({});
o.p = function() {};
o.watch('p', function() { });
o.q = function() {}
delete o.p;
o.p = function() {};
print(o.p);",TEST_CASES,0,FULL_TOKEN
627984,12,"This is the state right before we hit the methodReadBarrier in print(o.p). The object has clearly not the right method value in the slot:
Breakpoint 4, JSObject::methodReadBarrier (this=0x100d0d068, cx=0x1008130e0, shape=@0x10111a5c8, vp=0x7fff5fbfede0) at jsobjinlines.h:165
165	    if (!js_SetPropertyHelper(cx, this, shape.id, 0, vp, false))
(gdb) call js_DumpObject(this)
object 0x100d0d068
class 0x100438ea0 Object
flags: method_barrier inDictionaryMode hasPropertyTable
properties:
    enumerate method(0x100d0bd80) ""p"": slot 2
    enumerate method(0x100d0bd00) ""q"": slot 1
proto <Object at 0x100d030d8>
parent <global object at 0x100d03048>
slots:
   0 = undefined
   1 = <unnamed function (x.js:4) at 0x100d0bd00 (JSFunction at 0x100d0bd00)>
   2 = undefined
(gdb)",ERROR_MESSAGE,0,FULL_TOKEN
627984,13,"We call the watch point in SetMethod after we have updated the shape and then write that value into the slot. The watch point returns undefined and that value is written. It might be possible to trick the property cache into calling the wrong function with this:
(gdb) s
obj_watch_handler (cx=0x1008130e0, obj=0x100d0d068, id={asBits = 4299215808}, old={asBits = 18444773748872577024, debugView = {payload47 = 0, tag = JSVAL_TAG_UNDEFINED}, s = {payload = {i32 = 0, u32 = 0, why = JS_ARRAY_HOLE, word = 18444773748872577024}}, asDouble = -nan(0x9000000000000), asPtr = 0xfff9000000000000}, nvp=0x7fff5fbfed90, closure=0x100d0e058) at ../jsobj.cpp:1310
1310	    callable = (JSObject *) closure;
(gdb) n
1312	    callbacks = JS_GetSecurityCallbacks(cx);
(gdb) n
1313	    if (callbacks && callbacks->findObjectPrincipals) {
(gdb) n
1332	    key.obj = obj;
(gdb) n
1333	    key.id = id;
(gdb) n
1334	    if (!js_StartResolving(cx, &key, JSRESFLAG_WATCH, &entry))
(gdb) n
1336	    if (!entry)
(gdb) n
1338	    generation = cx->resolvingTable->generation;
(gdb) n
1340	    argv[0] = IdToValue(id);
(gdb) n
1341	    argv[1] = Valueify(old);
(gdb) n
1342	    argv[2] = Valueify(*nvp);
(gdb) n
1343	    ok = ExternalInvoke(cx, obj, ObjectOrNullValue(callable), 3, argv, Valueify(nvp));
(gdb) p *nvp
$63 = {
  asBits = 18445477440623000960, 
  debugView = {
    payload47 = 4308647296, 
    tag = JSVAL_TAG_OBJECT
  }, 
  s = {
    payload = {
      i32 = 13680000, 
      u32 = 13680000, 
      why = 13680000, 
      word = 18445477440623000960
    }
  }, 
  asDouble = -nan(0xb800100d0bd80), 
  asPtr = 0xfffb800100d0bd80
}
(gdb) n
1344	    js_StopResolving(cx, &key, JSRESFLAG_WATCH, entry, generation);
(gdb) p *nvp
$64 = {
  asBits = 18444773748872577024, 
  debugView = {
    payload47 = 0, 
    tag = JSVAL_TAG_UNDEFINED
  }, 
  s = {
    payload = {
      i32 = 0, 
      u32 = 0, 
      why = JS_ARRAY_HOLE, 
      word = 18444773748872577024
    }
  }, 
  asDouble = -nan(0x9000000000000), 
  asPtr = 0xfff9000000000000
}
(gdb) 
(gdb) l
5662	                getter = CastAsPropertyOp(funobj);
5663	            }
5664	        }
5665	
5666	        shape = obj->putProperty(cx, id, getter, setter, SHAPE_INVALID_SLOT,
5667	                                 attrs, flags, shortid);
5668	        if (!shape)
5669	            return JS_FALSE;
5670	
5671	        if (defineHow & JSDNP_CACHE_RESULT)
(gdb) n
5668	        if (!shape)
(gdb) n
5671	        if (defineHow & JSDNP_CACHE_RESULT)
(gdb) n
5672	            TRACE_1(AddProperty, obj);
(gdb) l
5667	                                 attrs, flags, shortid);
5668	        if (!shape)
5669	            return JS_FALSE;
5670	
5671	        if (defineHow & JSDNP_CACHE_RESULT)
5672	            TRACE_1(AddProperty, obj);
5673	
5674	        /*
5675	         * Initialize the new property value (passed to setter) to undefined.
5676	         * Note that we store before calling addProperty, to match the order
(gdb) n
5679	        if (obj->containsSlot(shape->slot))
(gdb) n
5680	            obj->nativeSetSlot(shape->slot, UndefinedValue());
(gdb) n
5683	        if (!CallAddPropertyHook(cx, clasp, obj, shape, vp)) {
(gdb) p *vp
$54 = {
  data = {
    asBits = 18445477440623000960, 
    debugView = {
      payload47 = 4308647296, 
      tag = JSVAL_TAG_OBJECT
    }, 
    s = {
      payload = {
        i32 = 13680000, 
        u32 = 13680000, 
        why = 13680000, 
        word = 18445477440623000960
      }
    }, 
    asDouble = -nan(0xb800100d0bd80), 
    asPtr = 0xfffb800100d0bd80
  }
}
(gdb) call js_DumpValue(*vp)
<unnamed function (x.js:6) at 0x100d0bd80 (JSFunction at 0x100d0bd80)>
(gdb) s
CallAddPropertyHook (cx=0x1008130e0, clasp=0x100438ea0, obj=0x100d0d068, shape=0x10111a5c8, vp=0x7fff5fbfed90) at ../jsobj.cpp:4576
4576	    if (clasp->addProperty != PropertyStub) {
(gdb) n
4586	    return true;
(gdb) fin
Run till exit from #0  CallAddPropertyHook (cx=0x1008130e0, clasp=0x100438ea0, obj=0x100d0d068, shape=0x10111a5c8, vp=0x7fff5fbfed90) at ../jsobj.cpp:4586
0x0000000100106c62 in js_SetPropertyHelper (cx=0x1008130e0, obj=0x100d0d068, id={asBits = 4299215808}, defineHow=5, vp=0x7fff5fbfed90, strict=0) at ../jsobj.cpp:5683
5683	        if (!CallAddPropertyHook(cx, clasp, obj, shape, vp)) {
Value returned is $55 = true
(gdb) n
5687	        added = true;
(gdb) p *vp
$56 = {
  data = {
    asBits = 18445477440623000960, 
    debugView = {
      payload47 = 4308647296, 
      tag = JSVAL_TAG_OBJECT
    }, 
    s = {
      payload = {
        i32 = 13680000, 
        u32 = 13680000, 
        why = 13680000, 
        word = 18445477440623000960
      }
    }, 
    asDouble = -nan(0xb800100d0bd80), 
    asPtr = 0xfffb800100d0bd80
  }
}
(gdb) n
5690	    if (defineHow & JSDNP_CACHE_RESULT)
(gdb) n
5691	        JS_PROPERTY_CACHE(cx).fill(cx, obj, 0, 0, obj, shape, added);
(gdb) n
5693	    return js_NativeSet(cx, obj, shape, added, vp);",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
627984,14,"There is a bunch of bugs here actually. In js_NativeSet we never trigger the method write barrier if a property is added (added=true), because we think that can't cause a shape change, but that's not true for watchpoint setters which fire for additions as well since they are persistent. So in other words watch makes our write barrier more expensive in general. Super lame.
There is a second bug. The slot is initialized to undefined when we call the setter, so even if we would call the method write barrier it would see undefined (old) == undefined (new) and not brand.
I think this is all pretty seriously broken and all sorts of unsafe. I vote for a hard blocker. This probably wants jorendorff or brendan, though I think I can fix it if push comes to shove.",SOLUTION_REVIEW,1,FULL_TOKEN
627984,15,What a mess.,UNCODED,0,UNMATCHED
627984,16,"OK. My first instinct here was to trigger the method *read* barrier in UpdateWatchpointShape. If a method property would be watched, the barrier would convert it an ordinary data property. Then you would watch that.
But that would go seriously against the grain, because UpdateWatchpointShape gets called at a point where the method property has been added, but before the slot is filled.
So for now watchpoints need to know about the method barrier. (Which after all is only consistent. They know about everything else.)
I have a sort of patch, but unfortunately the assertions I'm trying to add keep failing, and I'm out of time for the day.",SOLUTION_REVIEW,1,FULL_TOKEN
627984,17,"Elaborating a little on comment 16:
There are three bugs I know very clearly how to fix.
1. js_watch_set passes the property's old slot value (the one we're about to overwrite) to wp->handler without checking to see if the property is a method. If it's a method, the old value is an uncloned function object that must not be exposed to script! The fix is for js_watch_set to trip the read barrier before calling wp->handler.
2. js_watch_set can get called at an unfortunate time. The order of adding a data property, such as a method, is like this:
    - add the shape to the object
    - call the setter
    - store the value in the slot
So suppose we watch a property, then delete it, and then use JSOP_INITMETHOD to create it again. Here's what happens:
    - add the (watched method) shape to the object
    - call js_watch_set, which calls wp->handler
    - store the uncloned function object in the slot
Note js_watch_set is called *after* the METHOD property is added to obj but *before* the slot is assigned. So the slot value is undefined. To my mind, this state is a violation of the method invariant. We do not want to be calling back into the interpreter with the object in that state. The fix, again, is for js_watch_set to trip the method barrier before calling wp->handler.
3. The watchpoint handler could delete the property and re-add it as a method property again. Then whatever value it returns must not be stored in the slot of that method property; it would violate the method invariant. So after the handler returns, we probably need to call methodWriteBarrier. (This one I'm not quite sure about.)
There are also at least 2 other issues:
4. Bug 631723 - Deleted watchpoints can make obj->addProperty/putProperty return a shape not in obj.
5. If wp->handler deletes the property, wp->shape is not set to NULL. I think I have seen wp->shape be wrong (that is, != obj->nativeLookup(propid)) in other circumstances, too, which would be bad. This needs another look, possibly in a follow-up bug.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
627984,18,"6. js_NativeSet skips the slot write if the before and after shape of the property are different. This means that unwatching from a watchpoint can cause the slot write to be skipped:
var obj = {m: 'o'};
var other = {a: 1};
obj.watch(""m"", function (id, oldval, newval) { 
        delete other.a;
        obj.unwatch('m');
        return newval;
    });
obj.m = 'n';  // since the watchpoint unconditionally returns newval,
              // this value should not be lost
assertEq(obj.m, 'n');  // FAILS
Similarly, scripts can detect the transition to dictionary mode (which re-creates all Shapes) this way.
var N = 129;
var obj = {m: ""fail""};
var other = {a: 1};
obj.watch(""m"", function (id, oldval, newval) {
        for (var j = 0; j < N; j++)
            obj['x' + j] = 0;
        delete other.a;
        return newval;
    });
obj.m = 'ok';
assertEq(obj.m, 'ok');  // FAILS when N >= 128",SOLUTION_REVIEW,1,FULL_TOKEN
627984,19,"To clarify a little on comment 17 item 2,",UNCODED,0,UNMATCHED
627984,20,"Kindly disregard comment 19. My clarification wasn't going to be correct anyway. (If item 2 isn't clear, wait for the patch -- there's a test.)
I found another bug.
7. A method is ostensibly an ordinary data property--but getting its value the first time will trigger a watchpoint on that property.
  var obj = {m: function () {}};
  obj.watch(""m"", function () { throw 'FAIL'; });
  var f = obj.m;  // FAIL
Patch coming!",SOLUTION_REVIEW,1,FULL_TOKEN
627984,21,"Created attachment 510780
v1
This patch applies on top of the patches in bug 631723 and bug 631305.
This patch does not address comment 17 item 5 or comment 18 item 6. I will file follow-up bugs for those.",CODE_IMPLEMENTATION,1,FULL_TOKEN
627984,22,"Wow, what a mess indeed. Sorry I forgot about watchpoints when doing the method stuff.
Could you fix sevearl of these bugs before the js_watch_set setter is invoked, in js_UpdateWatchpointsForShape? Joined methods are an optimization, so deoptimizing as soon as there's sign of a watchpoint seems fine, and it looks from this patch like it would be simpler.
/be",CODE_UPDATE_REQUEST,0,FULL_TOKEN
627984,23,"Brendan and I talked about this on IRC yesterday or the day before.
Two reasons not to do it that way: first, js_UpdateWatchpointsForShape is called at a weird time; the method property exists but the slot isn't populated yet. No big deal; I could populate the slot from shape->methodValue(), then trip the read barrier.
Second, and more importantly, js_UpdateWatchpointsForShape's relevant caller (js_SetPropertyHelper) doesn't expect it to trip the read barrier, so it will unconditionally write the noncloned function to the slot. To avoid that, the caller would have to check whether js_UpdateWatchpointsForShape changed the shape. That adds a branch to the no-watchpoint path, and it complicates code outside jsdbgapi.cpp.
So I put the added complexity in js_watch_set, which seemed more consistent with the design.",SOLUTION_REVIEW,1,FULL_TOKEN
627984,24,"Jason's right, the ancient watchpoint design, which predates user-defined setters, tries to modularize watchpoints by putting their overhead behind a setter wrapper. This hasn't aged particularly well. His preferred approach would add a few
    if (JS_UNLIKELY(obj->watched())) { // obj->flags & WATCHED
        . . .
    }
clauses. Sounds worth filing and doing after fx4.
/be",SOLUTION_REVIEW,1,FULL_TOKEN
627984,25,"Comment on attachment 510780
v1
Nit: spaces around --, should rewrap nicely.
Uncomment (fix if needed?) or remove.
Super-duper-nit: no need to parenthesize the whole ?: expression.
Would wrap better if written
                    /*
                     * It is not the setter's job to call methodWriteBarrier,
                     * but js_watch_set must do so, because the caller will be
                     * fooled into not doing it: shape does *not* have the
                     * default setter and therefore seems not to be a method.
                     */
Great work, r=me. Thanks for diving on this grenade.
/be",CODE_REVIEW,0,FULL_TOKEN
627984,26,"I will land this as soon as bug 631723 gets review.
The second assertion passes the whole test suite, so I'll uncomment it.
The first assertion can be tripped, and not only that, I found another assertion in js_watch_set that can also be tripped. Filed bug 633637. I'm removing the trippable assertions from this patch for now.",ANSWER_TO_QUESTION,0,FULL_TOKEN
627984,27,http://hg.mozilla.org/tracemonkey/rev/589bb166be02,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
627984,28,"cdleary-bot mozilla-central merge info:
http://hg.mozilla.org/mozilla-central/rev/589bb166be02",UNCODED,0,UNMATCHED
627984,29,"Given gal's analysis and several agreements that the code was a mess, is [sg:critical?] more accurate a severity rating?",QUESTION,0,FULL_TEXT
627984,30,"The issues pointed out in comment 0 and ultimately fixed in this bug are correctness bugs, so this bug isn't sg:anything per se.
However several of the comments here, particularly comment 17 item 4, point to bug 631723, which is [sg:critical?]. So I'm not sure this should be opened.
(Given all that, I'm really not sure what should be done to this bug exactly.)",ANSWER_TO_QUESTION,0,FULL_TOKEN
627984,31,A testcase for this bug was automatically identified at js/src/tests/js1_8_5/extensions/regress-627984-6.js.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
634654,1,Splitting this off from the toSource cache lazy-construction patch in bug 614155.,FILED_FROM_OTHER_ISSUE,0,FULL_TEXT
634654,2,"Instrumenting RegExp::create and visiting a bunch of high-profile sites for some informal profiling I got:
atomized regexp sources:                 473
non-atomized regexp sources:            7863
So 94% of the sources were not atomized. I'll go with the atomize-and-cache approach and time how many cycles we spend atomizing versus our regexp cache hit rate on a similar workload.",PROBLEM_MOTIVATION,0,FULL_TOKEN
634654,3,"So with the tabs: GMail, GReader, Tech Crunch, Twitter, and CAD comic I get the following stats:
RegExpCache stats:
  hits:                  2244
  flagMisses:              34
  constructs:              24
  lookups:               3979
  removals:                23
  puts:                  1759
Which is a hearty 56% hit rate. When I switch the protocol to only put cache entries that are atomized (and only do lookups for atomized strings) I get:
RegExpCache stats:
  hits:                    72
  flagMisses:               0
  constructs:              19
  lookups:                112
  removals:                 3
  puts:                    59
So atomizing the strings makes this cache useful. I'll rdtsc the atomization overhead.",PROBLEM_REVIEW,0,FULL_TOKEN
634654,4,An interesting observation: when we create regexps from literals in the source text the parser creates a regexp from the jschar token buffer. The string generated from this jschar run is not atomized! I'll try to re-run the measurements with those literal-derived strings atomized and see how things change.,PROBLEM_REVIEW,0,FULL_TEXT
634654,5,"Created attachment 516796
WIP: RegExp cache.
RegExpCache stats:
  hits:                  1804
  flagMisses:              34
  constructs:              36
  lookups:               3572
  removals:                 4
  puts:                  1804
  nonAtoms:              2443
We get a nice hit rate among the atoms, but there is a large number of non-atoms we may be missing.
Here is a map from patterns to hits-that-we-miss-out-on:
{'#((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '&amp;': 19,
 '(^(?:.|\\r|\\n)*?)#((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '(^(?:.|\\r|\\n)*?):((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?:\\(([\'""]?)((?:\\([^\\)]+\\)|[^\\(\\)]*)+)\\3\\))?(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '(^(?:.|\\r|\\n)*?):(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '(^(?:.|\\r|\\n)*?)\\.((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '(^(?:.|\\r|\\n)*?)\\[name=[\'""]*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)[\'""]*\\](?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '(^(?:.|\\r|\\n)*?)^((?:[\\w\\u00c0-\\uFFFF\\*\\-]|\\\\.)+)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '(^|.)facebook.(com)([^.]*)$': 19,
 '(^|\\.)(\\.|$)': 421,
 '(^|\\s)addthis_counter(\\s|$)': 1,
 '(^|\\s)hidden_elem(?:\\s|$)': 1,
 ':((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?:\\(([\'""]?)((?:\\([^\\)]+\\)|[^\\(\\)]*)+)\\2\\))?(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 ':(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^-]|$)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 ':(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^\\-]|$)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 ':(only|nth|last|first)-child(?:\\((even|odd|[\\dn+-]*)\\))?(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '\\%\\{tweets\\}': 20,
 '\\%\\{url\\}': 41,
 '\\+': 39,
 '\\.((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '\\[name=[\'""]*((?:[\\w\\u00c0-\\uFFFF\\-]|\\\\.)+)[\'""]*\\](?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '\\bgbg0l\\b': 20,
 '\\bgbgt\\b': 23,
 '\\bgbgtd\\b': 20,
 '\\bgbkc\\b': 2,
 '\\bgbmt\\b': 20,
 '\\bgbzt\\b': 29,
 '\\s*[,;]$': 1,
 '^((?:[\\w\\u00c0-\\uFFFF\\*\\-]|\\\\.)+)(?![^\\[]*\\])(?![^\\(]*\\))': 1,
 '^(?:([^:\\/?#.]+):)?(?:\\/\\/(?:([^\\/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$': 2,
 '^([\\[\\]])$': 119,
 '^,': 20,
 '^Yahoo Application State Plugin$': 1,
 '^[\\s]+|[\\s]+$': 2}
What's interesting about this set is that we can get 796 of the 834 potential non-atom hits if we only atomize strings of length 16-or-less. That may be a decent compromise to avoid atomization overheads.",CODE_IMPLEMENTATION,1,FULL_TOKEN
634654,6,"Created attachment 565763
WIP: Cache |RegExpPrivate|s.
Puts a RegExpPrivate cache on the ThreadData for JSAtom sources only. Hurray immutability!
I want to do a little bit of browsing-in-the-name-of-science before I put it up for review. Particularly, I want to see how many non-atom sources we ""could have hit on if we cached those"" and how much memory overhead that produces.",CODE_IMPLEMENTATION,1,FULL_TOKEN
634654,7,"Oh, and I still have to add a purge-to-size mechanism. (That's how we emulate HashTable shrink-to-size these days.) The number of entries will drop to zero on GC later due to bug 673189.",STATUS_UPDATE,0,FULL_TEXT
634654,8,"Created attachment 565810
Top offenders.
My benchmark was to run an already-atomized-only cache and instrument RegExpPrivate creation. I was a lot more scientific this time, and it had very interesting results.
Opening the following 6 sites from session restore: Twitter, GReader, GMail, TechCrunch, Facebook, and Delicious, the hit rate was miserable.
22112 events
62 hits, 22050 misses (0.28 % hit ratio)
As the text file shows, we get nice contributions from GMail, Twitter's pheonix-core thing and even our own nsSessionStore. The nsSessionStore is due to not atomizing regexp sources out of XDR, which (NOTE REVIEWER! :-) I will fix in this bug.
All of these top offenders were uncacheable due to being non-atoms. If we atomize all of these patterns that are less than 16 chars. If we atomize strings we see with <= 16 chars we should hit a nice speed/usage tradeoff at a 98.3% hit rate for this workload.
Upcoming science: time the aggregate atomization overhead, dump code sizes as well so we can know how much duplication we're talking about eliminating.",SOLUTION_VERIFICATION,0,FULL_TOKEN
634654,9,"Also, (for verification) inspecting the GMail js file by hand I see 31 instances where RegExp is called directly (despite minification), at least in a handful of cases with tiny literal strings.",SOLUTION_VERIFICATION,0,FULL_TEXT
634654,10,"This is very interesting data. Is the bug title correct, assuming that TM refers to TraceMonkey, that this bug is for TM only? IIUC TM is disabled when TI is enabled, and is set to go away entirely when IM is ready.",QUESTION,0,FULL_TEXT
634654,11,Looking at the code this patch is not TraceMonkey related. Putting TM in front of bugs was some weird thing being done back in these days.,ANSWER_TO_QUESTION,0,FULL_TEXT
634654,12,"I made the chars we read out of the token stream and the strings we XDR decode into atoms and we look good hit rate wise:
21787 events
20526 hits, 1261 misses (94.21% hit ratio)
kind        | count
------------+------
cold        | 648  
hit         | 20526
eviction    | 22   
uncacheable | 591
Since we were be creating fresh JSStrings for those token-stream-read creations the atomizing should have added very little overhead, but I'll make an opt build to time it just to be sure.
Without any purging we keep a ~2.5K hash table around to cache all the values. Half the RegExpPrivates that exist are there because they're non-atom sources, so I still need more memory usage and execution time data -- maybe atomizing more things would be worth it to reduce the duplication.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
634654,13,"Duplicate code savings: sum: 183,668B; avg per RegExpPrivate: 895.94; stddev: 3,087.15
At least in my benchmark the code savings is negligible. We can always atomize more stuff later if we find that's a win in the real world, and just caching the naturally atomized stuff is better than what we have now. Will have a patch with purging soon.",STATUS_UPDATE,0,FULL_TOKEN
634654,14,"Created attachment 565841
WIP: cache with purging.
This is close to done, but I have to fix a few things that are bothering me:
1) I'm pretty sure this assertion method doesn't work with background sweeping. I *could* deallocate the cache pre-mark and assume refcounting correctness, but the debug refcounting assertions are nice. I either have to figure out a way to do it in JS_THREADSAFE that doesn't make your eyes bleed, or only perform the assertions when !JS_THREADSAFE (which seems undesirable).
2) The string regexp methods are violating the RegExpPrivate boundary quite heavily in order to avoid creating a RegExpObject. This leads to more annoying problems in the refcount assertions where I have to say, ""check that the string regexp methods are appropriate messing around with RegExpPrivates behind our back,"" which is gross.
3) Switch the RegExpPrivates from taking JSContext parameters to JSRuntime parameters now that they live in the ThreadData.
4) There's too many scary verbs on the RegExp data structures... purge, finalize, reset, decref. If I can't consolidate any of those verbs they at least need a big comment at the top of RegExpObject.h to say how they all work together with the ThreadData cache.",CODE_IMPLEMENTATION,1,FULL_TOKEN
634654,15,"(Oh, and it passes shell tests in that form.)",SOLUTION_VERIFICATION,0,FULL_TEXT
634654,16,billm pointed out that it does because we don't background finalize anything with clasp->finalize.,CLARIFICATION,0,FULL_TEXT
634654,17,"Created attachment 566104
WIP: cache with purging.
Looks like this is passing jsreftests. Interesting note to self: you can't legitimately free up memory from a thread-data level cache when you're doing compartmental GCs.
Pushed to try.",CODE_IMPLEMENTATION,1,FULL_TOKEN
634654,18,Looks good on try. Will post for review this afternoon.,SOLUTION_VERIFICATION,0,FULL_TEXT
634654,19,"Created attachment 566392
Cache |RegExpPrivate|s, purge cache on global GC.
Depends on laziness patch from bug 673188.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
634654,20,"(Sorry luke, didn't qref the removal of that one fprintf chunk!)",UNCODED,0,UNMATCHED
634654,21,"Comment on attachment 566392
Cache |RegExpPrivate|s, purge cache on global GC.
Waldo said he would be willing to take this review (and his review queue is less loaded).",STATUS_UPDATE,0,FULL_TEXT
634654,22,"Comment on attachment 566392
Cache |RegExpPrivate|s, purge cache on global GC.
Review of attachment 566392:
-----------------------------------------------------------------
The RegExpObjectBuilder idiom feels weird to me.  Maybe it's the name that feels strange.  I don't know.  My concerns about it are not coherent enough to suggest something better.
::: js/src/jscntxt.cpp
@@ +163,5 @@
If delete_ is null-safe I'd remove the null-check.
@@ +367,5 @@
{ on new line.
::: js/src/jscntxt.h
@@ +1255,5 @@
File a bug to remove JS_THREAD_DATA in favor of this?  I've wanted to do this for a long time, never was touching close enough code to actually do it.
::: js/src/jsstr.cpp
@@ +1266,5 @@
An overview comment for why this class exists would be nice.  It's not entirely obvious to me, at a skim of its uses.
@@ +1280,5 @@
Wouldn't operator bool be worth adding to DebugOnly as well?
::: js/src/vm/RegExpObject.cpp
@@ +104,5 @@
If this is a RegExpObject, shouldn't we have a method to do this, that takes in an AIR<>, rather than do it all manually here?
The free-floating decrefs here (and increfs in callers) are not happy-making.  I assume the semantics here are that the caller passes ownership of his reference to this function, which is then responsible for decrementing it at the appropriate time (either now, in case of error, or later when the reobj dies)?  I suspect based on the name this is what WebKit's PassRefPtr (?) templates are for; maybe we should have something similar.
@@ +151,5 @@
if (RegExpPrivate *...)
::: js/src/vm/RegExpObject.h
@@ +81,5 @@
If you're renaming arguments, ts here should be tokenStream.
That said, why are you removing the line break between return type and methodname?  I find the other alignment more readable given how many different arguments this function takes.",CODE_REVIEW,0,FULL_TOKEN
634654,23,Thanks for the review Waldo! Just going to finish investigating bug 696524 before I land this so we don't muddle up the results.,STATUS_UPDATE,0,FULL_TEXT
634654,24,"https://hg.mozilla.org/integration/mozilla-inbound/rev/366d80e91816
The small V8 regression was due to some regexp compilation being duplicated in v8-regexp. The cache largely fixes that issue, but it still gets cleared out and recompiles regexps about 6 times during v8-regexp. This at least gets our regexp score back where it was, but there's followup work we can do by only purging on a GC_SHRINK (thereby not clearing out compiled regexps during v8-regexp). That'll be left to the v8-regexp investigation bug.",CODE_IMPLEMENTATION,1,FULL_TOKEN
634654,25,https://hg.mozilla.org/mozilla-central/rev/366d80e91816,UNCODED,0,UNMATCHED
634654,26,*** Bug 673189 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
642412,1,"TI+JM is slower than trunk JM on all Kraken crypto tests. TI and JM should do very well on crypto tests, so I'd like to investigate what's happening here. 
TI is also slower on SS crypto-aes, it's probably related.",PROBLEM_MOTIVATION,0,FULL_TOKEN
642412,2,"I started analyzing pbkdf2. According to Shark we spend at least 8% in stubs::SetElem. Most of the time is spent inside sjcl.hash.sha256.prototype.C. This function has many setelem's, the most important one is inside the loop, something like this:
b = d[a & 15] = (int + int) | 0;
Type inference output:
#35:00285:  zero
  type 0: int
#35:00286:  bitor
  type 0: int
#35:00287:  setelem
  type 0: int
  monitored
I think this is bug 621937 (JM not generating IC's for monitored setelem)",PROBLEM_REVIEW,0,FULL_TOKEN
642412,3,"Created attachment 519915
Standalone pbkdf2 benchmark
This is a beautified, single-file version of stanford-crypto-pbkdf2.",PROBLEM_REVIEW,0,FULL_TEXT
642412,4,"Brian, the type information for function C (line 344) is really bad. I'm not sure why but the type of all locals, arg and this is all ""unknown"". Better type information may get rid of the monitored setelem and is needed to make this benchmark fast.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
642412,5,"First step, assume that arithmetic involving objects produces integers (rather than unknown values), monitor double/string/XML results dynamically.
http://hg.mozilla.org/projects/jaegermonkey/rev/897c257e5405",CODE_IMPLEMENTATION,1,FULL_TOKEN
642412,6,"Several fixes to inference precision.  These mostly fall into the category of not overapproximating to capture the behavior of an unlikely event (calling a non-function, indexing an object with a non-integer), but waiting for it to happen dynamically.
http://hg.mozilla.org/projects/jaegermonkey/rev/a900619f0e04
http://hg.mozilla.org/projects/jaegermonkey/rev/bff02e9994e3
http://hg.mozilla.org/projects/jaegermonkey/rev/ac5f63354ab2
http://hg.mozilla.org/projects/jaegermonkey/rev/b48f1d51c6f5
There is still some imprecision because of a few accesses to Math which are JSOP_NAME rather than GNAME.  That can be fixed similarly to how we do monitored SETNAME/SETPROP, will file separately.  For now adding '| 0' to the calls to Math.round and Math.floor should fix precision.  I get these times:
JM+TI (old): 691
JM+TI (new): 438
JM: 474
JM+TM: 345
V8: 229
Looking at shark, JM seems to be getting killed by the slow paths it takes for the '(...) | 0' operations in C's inner loop.  We try to branchTruncateToInt32 on these, but on average about 1.5 times per iteration this truncation fails (the double does not fit in an int32) and we take I think a very expensive slow path.  We could instead call an infallible native like the tracer does, but to get to V8's performance I think we should instead generate inline code which is good enough to capture the large finite doubles being truncated here.",CODE_IMPLEMENTATION,1,FULL_TOKEN
642412,7,"The patch in bug 643037 fixes the truncate-double paths and brings the JM+TI time down to 361 (still with the modification to the Math calls).  Other things that should help:
1. Know that 'a' is an integer within the loop in the C function.  It is initially an array but is then reused as an integer.  Could use SSA-style techniques to add some flow sensitivity to let the inference distinguish its uses, or (probably better) make a Crankshaft-style speculation it is an integer within the loop body and hoist a check to the loop header.  This is worth about 20ms (easy to test by hand).
2. Hoist array bounds checks and LICM the slots pointer computation on the 'd' array.
3. Regalloc tuning on the loop, get another GPR (heavy register pressure here).
4. Typed natives or inline code for various Array natives.  Shark thinks we spend a decent amount of time in these.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
642412,8,"Get precise type information for the results of JSOP_NAME/JSOP_CALLNAME (358ms on the unmodified test).
http://hg.mozilla.org/projects/jaegermonkey/rev/9ee17aa5f938
This exposed an existing bug in the recompilation mechanism, where we would convert integer slots to doubles even if the recompiled code knew they were integers.  The FrameState can be either more or less precise than the inferred types, and we only require args/locals inferred as int|double to be doubles at join points (the revised algorithm only uses the FrameState, not the inferred types, to figure out what needs repatching, and is a good deal cleaner).
http://hg.mozilla.org/projects/jaegermonkey/rev/7154281e487b",CODE_IMPLEMENTATION,1,FULL_TOKEN
642412,9,We're still slower than V8 on these tests but the info in this bug is unlikely to help much.,SOLUTION_VERIFICATION,0,FULL_TEXT
659018,1,"User-Agent:       Mozilla/5.0 (X11; Linux x86_64; rv:2.0.0) Gecko/20100101 Firefox/4.0
Build Identifier: Thunderbird 3.4a1pre
When the inbox is refreshed in Thunderbird and the number of unread messages changes, the inbox label (and consequently the name of its accessible) changes, but a property-changed::accessible-name is not fired.  This causes problems with Orca and AT-SPI2 since AT-SPI expects to receive the event and continues to read the old cached value (unless AT-SPI 2.0.2 or later is used and setCacheMask is called to disable caching of the name--I plan on proposing that Orca do this for now as a work-around).
As I was testing, I saw the property-changed event being fired when I had the setCacheMask work-around in place but not when I did not have it included, so either this only happens sometimes or the event can be triggered somehow (perhaps calling atk_object_get_name on the accessible triggers the event).  I'm marking this as ""happens sometimes"" since I'm not entirely sure which is the case.
Reproducible: Sometimes
Steps to Reproduce:
1. Start Orca.  If there is a setCacheMask call in the Thunderbird script, then remove it.
2. Open Thunderbird.
3. Do something to cause the number of unread inbox messages to change.
Actual Results:  
Orca continues to read the old inbox label.
Expected Results:  
I would have expected Thunderbird to send a property-changed::accessible-name when the label gets updated, so Orca would read the new label when it gains focus.  Note that it should also be possible to reproduce this with Accerciser using similar steps.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
659018,2,"FWIW, NVDA always picks up the change in unread messages on Windows.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
659018,3,I think we are not handling nsIAccessibleEvent::EVENT_NAME_CHANGE on the atk code.,PROBLEM_REVIEW,0,FULL_TEXT
659018,4,"correct, we could use this event to update atk name (atk_object_set_name), I think this should emit this event automatically.
Fernando, Trevor, can you take it?",ASSIGNEE_REQUEST,0,FULL_TEXT
659018,5,"Created attachment 539725
patch
atk_set_name() sends the proper event for us, so on a name change event we can just see if the name has actually changed and if so set it causing atk to send the signal for us.",CODE_IMPLEMENTATION,1,FULL_TEXT
659018,6,"Comment on attachment 539725
patch
Review of attachment 539725:
-----------------------------------------------------------------
::: accessible/src/atk/nsAccessibleWrap.cpp
@@ +1082,5 @@
does it really make sense to check whether name weren't changed? I'd guess this can happen iff atk name was requested before we handled the event. Do you handle this case?",QUESTION,0,FULL_TEXT
659018,7,"I think the cost is pretty low, and it ensures that we don't have a race like you describe where we send an event say the name has changed when it actually hasn't.  I'm not sure what you mean by the do you handle this case question.  If your asking why I make the check then I think, if something else not sure.",ANSWER_TO_QUESTION,0,FULL_TOKEN
659018,8,"Comment on attachment 539725
patch
ok, r=me",CODE_REVIEW,0,FULL_TEXT
659018,9,http://hg.mozilla.org/mozilla-central/rev/b7a93f1279b7,UNCODED,0,UNMATCHED
659018,10,*** Bug 493685 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
670853,1,"After chat with Jamie we agreed that it's worth to use mixed state for undetermined progressmeters (both HTML and XUL) to allow AT distinguish determined vs undetermined progressmeters.
Any thoughts?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
670853,2,"btw, :indeterminate pseudo-class should be used to implement this state.",REQUIREMENT,0,FULL_TEXT
670853,3,"Fixing summary. Hope you don't mind, Alex. :)",ISSUE_METADATA_CHANGE,0,FULL_TEXT
670853,4,"I'm grateful, and thank you :)",UNCODED,0,UNMATCHED
670853,5,"For ARIA indeterminate progressbars (where no aria-valuetext or aria-valuenow is set), Firefox returns S_FALSE from IAccessible::get_accValue instead of S_OK. XUL/HTML progressbars should probably do the same thing for consistency. Perhaps they already do?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
670853,6,"Not sure off hand. Did you notice a bug?
Alexander, GFB?",QUESTION,0,FULL_TOKEN
670853,7,"1) implement NativeState (defined at nsAccessible) for ProgressMeterAccessible (http://mxr.mozilla.org/mozilla-central/source/accessible/src/base/nsFormControlAccessible.h#65)
2) check if no aria-valuenow or value attribute (see ProgressMeterAccessible<Max>::GetCurrentValue) then expose state::MIXED
3) add states/test_controls.html mochitest (see http://mxr.mozilla.org/mozilla-central/source/accessible/tests/mochitest/states/test_inputs.html?force=1 for idea)
and add a test for <progress></progress> element",REQUIREMENT,0,FULL_TOKEN
670853,8,I'll file a separate bug for ARIA,STATUS_UPDATE,0,FULL_TEXT
670853,9,"Created attachment 611270
Patch v1
Everything works except one of the mochitests fails because it checks for a mixed element being checkable. Since that doesn't appear to make sense if we add this patch, should I remove that from states.js?",CODE_IMPLEMENTATION,1,FULL_TEXT
670853,10,please add progress bar role check instead (i.e. do not check checkable state if role is progress bar).,ANSWER_TO_QUESTION,0,FULL_TEXT
670853,11,"Comment on attachment 611270
Patch v1
Review of attachment 611270:
-----------------------------------------------------------------
Looks good. I would just add some comments explaining what is happening and why. And as Alex says the ""MIXED is CHECKABLE"" test should also check for appropriate roles.
::: accessible/src/base/nsFormControlAccessible.cpp
@@ +90,5 @@
I think a comment here explaining the rationale makes sense.
::: accessible/tests/mochitest/states/test_controls.html
@@ +14,5 @@
Human-readable comments before each test of what state we are expecting, and why.",CODE_REVIEW,0,FULL_TEXT
670853,12,"Created attachment 611684
Patch v2
I added the comments, but I wasn't sure how to go about checking for the role when testing the state. If I add the check in states.js, then doesn't states.js depend on roles.js (and thus many tests have to be updated to include role.js)? Is this the right approach?",CODE_IMPLEMENTATION,1,FULL_TEXT
670853,13,"yes
maybe not many of them
well, we do that, maybe it's not super nice but it's hard to keep things separately.",ANSWER_TO_QUESTION,0,FULL_TEXT
670853,14,"Created attachment 612038
Patch v3
All tests updated.",CODE_IMPLEMENTATION,1,FULL_TEXT
670853,15,"Comment on attachment 612038
Patch v3
Review of attachment 612038:
-----------------------------------------------------------------
::: accessible/src/base/nsFormControlAccessible.cpp
@@ +90,5 @@
you know, just remove this ARIA thing (sorry for saying before to do that). ARIA part should take care about accessible state (bug 740851). In either case NativeState() is about markup, not about ARIA.
::: accessible/tests/mochitest/states/test_controls.html
@@ +22,5 @@
please comment out ""progress3"" test and add todo like
todo(false, ""we should respect ARIA"");",CODE_REVIEW,0,FULL_TOKEN
670853,16,"Created attachment 612359
Patch v4
ARIA value removed",CODE_IMPLEMENTATION,1,FULL_TEXT
670853,17,"Comment on attachment 612359
Patch v4
Looks right. It is unfortunate that for 2 lines you need to pull in role.js every time you use states.js. Maybe the simple role stuff could go in common.js? But that is not related to this bug.",CODE_REVIEW,0,FULL_TEXT
670853,18,if js would have #include option :) then I would include role.js and states.js into common.js.,CODE_REVIEW,0,FULL_TEXT
670853,19,https://hg.mozilla.org/integration/mozilla-inbound/rev/a85db096112e,UNCODED,0,UNMATCHED
670853,20,http://hg.mozilla.org/mozilla-central/rev/a85db096112e,UNCODED,0,UNMATCHED
674446,1,"Created attachment 548676
add logging
The attached patch helped me debug why my build was not starting on 10.5. I tried to change fprintf to PR_LOG, but got undefined references to _PR_LogPrint.",CODE_IMPLEMENTATION,1,FULL_TEXT
674446,2,"Comment on attachment 548676
add logging
While you're here, I'd suggest to add similar logging to nsGlueLinkingDlopen.cpp and nsGlueLinkingWin.cpp. (And it's expected you can't use PR_LOG: nspr is not available from the xpcom standalone glue).
Note that I'm not an xpcom peer.",CODE_REVIEW,0,FULL_TEXT
674446,3,"Created attachment 548782
Also add logging to the dlopen case
The Windows file already has error handling, this adding logging to OS X and dlopen.",CODE_IMPLEMENTATION,1,FULL_TEXT
674446,4,Let's get this landed when all of the patches have been reviewed.,STATUS_UPDATE,0,FULL_TEXT
674446,5,"Mike, Benjamin r+ the previous patch. The current one adds the extra logging you asked for. Is it OK?",CODE_REVIEW_REQUEST,0,FULL_TEXT
674446,6,Pushed to inbound.,CODE_REVIEW,0,FULL_TEXT
674446,7,http://hg.mozilla.org/mozilla-central/rev/d20e5ec041a4,UNCODED,0,UNMATCHED
674609,1,"TI uses about 15% more memory than m-c for storing scripts.  About 1/2 to 2/3 of this overhead is the extra 2 byte tag on each property access indexing into the observed type sets for the script, the rest is an increase in sizeof(JSScript) by five words.  The property access overhead can be eliminated either by doing a binary search for the type set on each property access in the interpreter or by requiring all interpreted scripts to have gone through bytecode analysis, which can index the type sets in storage that will be wiped out on GC.  Inclined to go with the latter here.  The sizeof(JSScript) increase can be reduced to two words, by combining two of the fields into a union (function and global, as the global can be determined from the script's function) and moving the others into a now-heap-allocated TypeScript.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
674609,2,"Created attachment 549142
patch
Remove the two byte typeset tag following every property read and call op, and require analysis of the bytecode in such scripts when they are interpreted (should be cheap to do, need to see how it affects the inference-pools memory).  Refactor TypeScript to be heap-allocated rather than embedded in JSScript, and reduce the size of JSScript by three words.  This patch touches a lot of code outside of inference in simple ways, should just need to be skimmed for review.
http://hg.mozilla.org/projects/jaegermonkey/rev/65c33bba9d01",CODE_IMPLEMENTATION,1,FULL_TOKEN
675961,1,"from bug 664344 - a description of receiving first-frag, ping, last-frag causing multiple pongs in response along with general wonkiness.
problem is in removing the ping from the fragment frame, length reset to 0 before a calculation was made.
1 line fix.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
675961,2,"Created attachment 550099
patch 1
This fixes tests 3.6 and 3.7 from https://github.com/oberstet/Autobahn",CODE_IMPLEMENTATION,1,FULL_TEXT
675961,3,http://hg.mozilla.org/integration/mozilla-inbound/rev/840fd3069d1f,UNCODED,0,UNMATCHED
675961,4,http://hg.mozilla.org/mozilla-central/rev/840fd3069d1f,UNCODED,0,UNMATCHED
676248,1,"We did this in bug 596303 but backed it out for performance reasons.
However, we'll need it for bug 675410 and bug 676241.
I think I've tracked down the real reasons why making the GL context transparent regressed performance:
 - it seems to force on V-Sync
 - we start repainting window background behind our GL context
Every time we touch the window buffer (like when repainting the window background), something tries to sync the window buffer surface with the GL context surface and blocks on GL flush completion.
We can work around that by moving our GL repaints away from setNeedsDisplay and drawRect. Then we'll no longer redraw the window background unnecessarily and we'll no longer block on anything.
But until we can activate V-Sync (bug 555834), we can't make the context transparent.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
676248,2,"Created attachment 675320
make it transparent
No idea who to ask for review but since I'm making Josh review the rest of the work for bug 675410, he gets this one too.",CODE_REVIEW_REQUEST,0,FULL_TEXT
676248,3,"OpenGL V-Sync has already been enabled in bug 748816, so this shouldn't regress anything as soon as we have bug 676250.",STATUS_UPDATE,0,FULL_TEXT
676248,4,"Comment on attachment 675320
make it transparent
I'm ok with this patch if it doesn't regress performance. If it does regress performance we should quantify it first.
Have you had a chance to compare some profiles before or after for operations like 60Hz compositing and resizing? I find them very informative when we're changing a significant code paths.",CODE_REVIEW,0,FULL_TOKEN
676248,5,"Don't neglect us 120Hz computer monitor owners please.  Asus VG236H, Asus VG278H, Samsung S23A700D, Benq XL2420T, Acer GD235Hz.
Perhaps a window.mozMaxFrameRate = 120 setting, to allow us JavaScript programmers to let everything in the browser take advantage of the rate.  Ideally, I prefer the Chrome behaviour (automatically allow requestAnimFrame to run at 120Hz), but I'll settle for Internet Explorer behaviour (sync to VSYNC but only at 60Hz, skip every other VSYNC at 120Hz), as long as I can access a JavaScript properties to control the VSYNC and the internal framelimit (window.mozMaxFrameRate = 120 and window.mozSyncOnVsync = true)",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
676248,6,"Yes, and I haven't found any regressions.",ANSWER_TO_QUESTION,0,FULL_TEXT
676248,7,Sorry I missed your comment. 60Hz in this context was not in any ways an upper bound. Proper vsync is very important to us but we need to solve some other bugs first.,CLARIFICATION,0,FULL_TEXT
676248,8,"Understood.  For some context, Webkit browsers such as Chrome synchronizes with VSYNC pretty well at all refresh rates, from 50 Hz all the way to beyond 144 Hz; yielding flawless-looking 144fps@144Hz operation.   From what I know, FireFox has an artifical 60fps framelimit for all rendering (not just Canvas2D or WebGL) that affects fluidity on non-60Hz displays.",CLARIFICATION,0,FULL_TOKEN
676248,9,"Created attachment 721448
Patch v1.1 (r+'d by bgirard)
I've de-bitrotted this patch, and I ran some profiles with and without the patch.
I ran this demo: https://developer.mozilla.org/en-US/demos/detail/kai-opua
And rotated the camera around a bit, and then resized the window.
Here's the profile without the patch:
http://people.mozilla.com/~bgirard/cleopatra/#report=712ceb292adfe496b85233e2b88d1a1773083593
and here's the profile with the patch:
http://people.mozilla.com/~bgirard/cleopatra/#report=dc05af436747e583332d9dcb5cfa33245ab9e2da
Does anything in there strike you as particularly worrying in terms of performance?",CODE_IMPLEMENTATION,1,FULL_TOKEN
676248,10,"Yes, our 'refresh driver' is not actually what it says it is, and it gives us jittery 60Hz timings, regardless of display refresh rate. If we enable vsync on non-60Hz displays, the effects could be especially nasty.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
676248,11,Sadly the profile are JS bound and don't have full stacks. I did notice that both builds are spending 6% getting timestamp under LayerManagerOGL::Render but I can't find the caller without full stacks. This patch doesn't appear to make these profiles worse but it's hard to tell for sure.,ANSWER_TO_QUESTION,0,FULL_TEXT
676248,12,Is there any way I can get you full stacks?,QUESTION,0,FULL_TEXT
676248,13,Lets land this and I'll keep an eye for changes in profiles. In the long run this will fix the titlebar drawing which will help performance.,ANSWER_TO_QUESTION,0,FULL_TEXT
676248,14,Done. Landed on mozilla-inbound as https://hg.mozilla.org/integration/mozilla-inbound/rev/635e926d9e4f,STATUS_UPDATE,0,FULL_TEXT
676248,15,https://hg.mozilla.org/mozilla-central/rev/635e926d9e4f,UNCODED,0,UNMATCHED
677173,1,"Steps to Reproduce
---------------------------------------
1. go to http://dev.openclic.fr/
2. click on arrows arround the photo
3.
What should have happened:
---------------------------------------
Photos should slide (using css -moz-transition)
What actually happened:
----------------------------------------
they don't",S2R,0,FULL_TOKEN
677173,2,"Regression window(m-c hourly):
Works:
http://hg.mozilla.org/mozilla-central/rev/3735fb1cd5ef
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:8.0a1) Gecko/20110803 Firefox/8.0a1 ID:20110803030753
Fails:
http://hg.mozilla.org/mozilla-central/rev/c35c69e1ce99
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:8.0a1) Gecko/20110803 Firefox/8.0a1 ID:20110803015018
Pushlog:
http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=3735fb1cd5ef&tochange=c35c69e1ce99
Regression window(m-i hourly):
Works:
http://hg.mozilla.org/integration/mozilla-inbound/rev/29232fea6e19
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:8.0a1) Gecko/20110802 Firefox/8.0a1 ID:20110802200330
Fails:
http://hg.mozilla.org/integration/mozilla-inbound/rev/166f4f247772
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:8.0a1) Gecko/20110802 Firefox/8.0a1 ID:20110802200834
Pushlog:
http://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=29232fea6e19&tochange=166f4f247772
Triggered by:
Bug 505115 - CSS3 3D-Transforms",UNCODED,0,UNMATCHED
677173,3,"From http://dev.openclic.fr/css/all.css:
  html.no-csstransforms .slideshow.horizontal > ol.slides > li.current {
    left:0;
  }
  html.csstransforms.no-csstransforms3d .slideshow.horizontal > ol.slides >
   li.current {
    -moz-transform:translateX(0);
    -webkit-transform:translateX(0);
    -o-transform:translateX(0);
    -ms-transform:translateX(0);
    transform:translateX(0);
  }
  html.csstransforms3d .slideshow.horizontal > ol.slides > li.current {
    -webkit-transform:translate3d(0, 0, 0);
    transform:translate3d(0, 0, 0);
  }
So the site assumes that if .csstransforms3d is set then the browser must be either WebKit or implement unprefixed 3D transforms.
Unfortunately, that class _is_ set in a current nightly, because the site is using Modernizr, which looks for a ""MozPerspective"" property, which we now have as a result of the patches in bug 505115.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
677173,4,"I sent them mail, but if someone who can write French sanely wants to do that too, that would be great!",UNCODED,0,UNMATCHED
677173,5,"What do you want to translate in french? I'm one of the devs of this website if you mean us by ""them"".
Here is your explanation translated (in case it's what you want to translate) :
Donc, le site considre que si .csstransforms3d est dfini, le navigateur doit tre WebKit ou implmenter les transformations 3D sans prfixe.
Malheureusement, cette classe EST dfinie avec la nightly actuelle puisque le site utilise Modernizr, qui cherche la proprit ""MozPerspective"" qui, comme nous le savons, donne le rsultat des patches du bug 505115.
I supposed the ""now"" in the last line is a ""know"".",UNCODED,0,UNMATCHED
677173,6,"Yep, that's exactly what I meant by ""them"".  If you're here, then there's no point translating anything to French as long as you're happy reading my English.  Not much point in me sending feedback through the form on the site if you're reading this bug already.  :)
No, it's ""now"".  As in, we did not use to have it, and now we do have it.
I suspect that just adding a -moz-transform:translate3d to that last CSS block from comment 2 and likewise for the other several places this selector pattern appears should help.  You should probably add the -o- and -ms- versions too.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
677173,7,"That's what I guessed reading you. I'm the server-side dev/admin so I haven't dug enough.
Anyway, it's a great news to see 3D transforms available in Firefox!
I will make the needed changes tomorrow.
I hope there are not too much webkitists like my client-side dev. It may cause trouble when ffx 8 will be the rc (I'm the Linux-Mozillist of the team ).
""...no point... Not much point..."", I'll probably be happy to read your english for a while as it shows me how to improve my own. :)
By the way, the last sentence becomes :
Malheureusement, cette classe EST dfinie avec la nightly actuelle puisque le site utilise Modernizr, qui cherche la proprit ""MozPerspective"" que nous avons depuis les patches du bug 505115.
Thank you very much for your lights.",UNCODED,0,UNMATCHED
677173,8,"Thanks!
Yeah, that's what we have a 3-month testing period for. :)",UNCODED,0,UNMATCHED
677173,9,"I added the rules to the css :
html.csstransforms3d .slideshow.horizontal > ol.slides > li.current {
	-webkit-transform:translate3d(0, 0, 0);
	-moz-transform:translate3d(0, 0, 0);
	-o-transform:translate3d(0, 0, 0);
	-ms-transform:translate3d(0, 0, 0);
	transform:translate3d(0, 0, 0);
}
Nothing changed... The slides don't move. And firebug doesn't show the rule.
Let's be patient!",SOLUTION_REVIEW,1,FULL_TOKEN
677173,10,"Hmm.  That's a problem on our end.  It looks like all.js has:
  pref(""layout.3d-transforms.enabled, false);
(ignoring for the moment that it's missing a '""' there) but the IDL properties are added unconditionally.  That's not good.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
677173,11,"I added it via about:config.
There is no animation but the photos move. If I change too much times, ffx chrashes.",SOLUTION_REVIEW,1,FULL_TOKEN
677173,12,Adding crash signature so it gets picked up on the Socorro side.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
677173,13,This bug is not about a crash.,CLARIFICATION,0,FULL_TEXT
677173,14,"Created attachment 553088
Remove the IDL properties for now",UNCODED,0,UNMATCHED
677173,15,"Comment on attachment 553088
Remove the IDL properties for now
r=dbaron
Sorry for the delay getting to this.
We need to get this in on aurora to fix the fact that something that was supposed to be disabled wasn't fully disabled.",CODE_REVIEW,0,FULL_TOKEN
677173,16,http://hg.mozilla.org/integration/mozilla-inbound/rev/6409a44ecb17,UNCODED,0,UNMATCHED
677173,17,http://hg.mozilla.org/releases/mozilla-aurora/rev/e55d507e6a6b,UNCODED,0,UNMATCHED
677173,18,"Backed on Aurora and Inbound because of test failures:
hg.mozilla.org/releases/mozilla-aurora/rev/ebe4b5370436
https://hg.mozilla.org/integration/mozilla-inbound/rev/2586082fbd94",SOLUTION_VERIFICATION,0,FULL_TOKEN
677173,19,"This is failing lots of tests because the properties still exist in property_database.js. I've tried removing those too, but multiple tests also check css_properties.js and fail there.
Any idea how we can get these tests to pass?",QUESTION,0,FULL_TEXT
677173,20,"Does it work if you:
 * comment out the bits of property_database.js
 * hack ListCSSProperties.cpp to exclude them?",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TOKEN
677173,21,"Created attachment 555325
Remove the IDL properties for now v2
Looks like it does, yes. Thanks!
Try push: http://tbpl.allizom.org/?tree=Try&usebuildbot=1&pusher=mwoodrow@mozilla.com",CODE_IMPLEMENTATION,1,FULL_TOKEN
677173,22,"Created attachment 556341
Remove the IDL properties for now - mozilla-central
Also remove the -moz-transform-style properties on mozilla-central",CODE_IMPLEMENTATION,1,FULL_TEXT
677173,23,"Comment on attachment 555325
Remove the IDL properties for now v2
r=dbaron",UNCODED,0,UNMATCHED
677173,24,"Comment on attachment 556341
Remove the IDL properties for now - mozilla-central
r=dbaron",UNCODED,0,UNMATCHED
677173,25,Landed on inbound: http://hg.mozilla.org/integration/mozilla-inbound/rev/0c6cbf58eaa0,UNCODED,0,UNMATCHED
677173,26,And on Aurora: http://hg.mozilla.org/releases/mozilla-aurora/rev/03b0d42603f8,UNCODED,0,UNMATCHED
677173,27,http://hg.mozilla.org/mozilla-central/rev/0c6cbf58eaa0,UNCODED,0,UNMATCHED
677173,28,"Cannot reproduce on Firefox 6.0.2 Linux using the testcase in the original comment. Based on check-ins I don't think this should be fixed in 6.0.2.
Can someone please either confirm that 6.0.2 is fixed or provide a test case which reproduces this bug so that QA can verify? Thanks.",VERIFICATION_REQUEST,0,FULL_TEXT
677173,29,The CSS 3d-transforms patches that caused this bug never landed on 6.,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
677173,30,"Mozilla/5.0 (X11; Linux i686; rv:8.0) Gecko/20100101 Firefox/8.0
Mozilla/5.0 (X11; Linux i686; rv:9.0a2) Gecko/20111007 Firefox/9.0a2
Mozilla/5.0 (X11; Linux i686; rv:10.0a1) Gecko/20111007 Firefox/10.0a1
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:8.0) Gecko/20100101 Firefox/8.0
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0a2) Gecko/20111004 Firefox/9.0a2 
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:10.0a1) Gecko/20111005 Firefox/10.0a1
Mozilla/5.0 (Windows NT 5.1; rv:8.0) Gecko/20100101 Firefox/8.0
Mozilla/5.0 (Windows NT 5.1; rv:9.0a2) Gecko/20111006 Firefox/9.0a2
Mozilla/5.0 (Windows NT 5.1; rv:10.0a1) Gecko/20111006 Firefox/10.0a1
Mozilla/5.0 (Windows NT 6.1; rv:8.0) Gecko/20100101 Firefox/8.0
Mozilla/5.0 (Windows NT 6.1; rv:9.0a2) Gecko/20111006 Firefox/9.0a2
Mozilla/5.0 (Windows NT 6.1; rv:10.0a1) Gecko/20111006 Firefox/10.0a1
Photos at link mentioned in bug description slide using the -moz-transition properties; Firebug shows the following rules:
-moz-transition-duration: 0.3s
-moz-transition-property: margin",SOLUTION_VERIFICATION,0,FULL_TOKEN
687929,1,"1. https://crypto.cat/?c=test
2. Shutdown
3. Crash Aurora/8, Nightly/9 - Windows, Mac, Linux - Debug at least. Beta does not crash.
Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_PROTECTION_FAILURE at address: 0x000000fc
0x06d01633 in JS_BeginRequest (cx=0x0) at /work/mozilla/builds/nightly/mozilla/js/src/jsapi.cpp:899
899	    cx->outstandingRequests++;
(gdb) bt
#0  0x06d01633 in JS_BeginRequest (cx=0x0) at /work/mozilla/builds/nightly/mozilla/js/src/jsapi.cpp:899
#1  0x066e3050 in JSAutoRequest::JSAutoRequest (this=0xbfffcffc, cx=0x0, _notifier=@0xbfffd008) at jsapi.h:794
#2  0x05bb6dbe in mozilla::dom::workers::RuntimeService::ResumeWorkersForWindow (this=0x27f1e5a0, aCx=0x0, aWindow=0x24d047f0) at /work/mozilla/builds/nightly/mozilla/dom/workers/RuntimeService.cpp:1064
#3  0x05bb6ea0 in mozilla::dom::workers::ResumeWorkersForWindow (aCx=0x0, aWindow=0x24d047f0) at /work/mozilla/builds/nightly/mozilla/dom/workers/RuntimeService.cpp:460",ERROR_MESSAGE,0,FULL_TOKEN
687929,2,Almost certainly a regression from the workers rewrite.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
687929,3,"Full stack:
mozjs.dll!JS_BeginRequest(JSContext * cx)
xul.dll!JSAutoRequest::JSAutoRequest(JSContext * cx)
xul.dll!mozilla::dom::workers::RuntimeService::ResumeWorkersForWindow(JSContext * aCx, nsPIDOMWindow * aWindow)
xul.dll!mozilla::dom::workers::ResumeWorkersForWindow(JSContext * aCx, nsPIDOMWindow * aWindow)
xul.dll!nsGlobalWindow::ResumeTimeouts(int aThawChildren)
xul.dll!nsResumeTimeoutsEvent::Run()
xul.dll!nsThread::ProcessNextEvent(int mayWait, int * result)
...
xul.dll!XRE_main(int argc, char * * argv, const nsXREAppData * aAppData)
This one is simple, just need to make sure ResumeWorkersForWindow can handle a null context. It's not really needed, but if we have one we need a request.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
687929,4,I hafve someone here who encountered this after upgrading to 8.0. Crash report: https://crash-stats.mozilla.com/report/index/bp-0eef12a6-2e84-49c5-949f-8a1102111119,REPRODUCTION_ATTEMPT,0,FULL_TEXT
687929,5,"In regards to comment #3, the user is reliably able to reproduce this on http://www.cuetools.net/wiki/Main_Page. When he opens a link in a new window, he gets this crash. Latest report:
https://crash-stats.mozilla.com/report/index/bp-f23cf359-d6cf-4dc3-af1a-5d2ab2111122",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
687929,6,"The same person reports this crash still being present in Aurora for him. Latest report: https://crash-stats.mozilla.com/report/index/bp-ab204c45-08b7-4cb4-a2e0-864822111205.
Requesting tracking to get this one on the radar.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
687929,7,"#192 in 8.0.1, and #45 in 9.0b4. Tracking for FF9/10.",STATUS_UPDATE,0,FULL_TEXT
687929,8,"Created attachment 579934
Patch. v1
Simple.",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
687929,9,https://hg.mozilla.org/integration/mozilla-inbound/rev/21aac86d6658,UNCODED,0,UNMATCHED
687929,10,https://hg.mozilla.org/mozilla-central/rev/21aac86d6658,UNCODED,0,UNMATCHED
687929,11,"Ben, would it make sense to request that this be allowed to land on Aurora and possibly even Beta since it fixes a crash?",QUESTION,0,FULL_TEXT
687929,12,"Comment on attachment 579934
Patch. v1
This patch is very simple (low risk) and fixes a reproducible crash currently being tracked for FF 9 and FF 10 (high reward).",CODE_REVIEW,0,FULL_TEXT
687929,13,"Comment on attachment 579934
Patch. v1
[Triage Comment]
Minusing for beta because of how late we are in the cycle, but let's land this on aurora.",CODE_REVIEW,0,FULL_TEXT
687929,14,https://hg.mozilla.org/releases/mozilla-aurora/rev/20ba8e63ed68,UNCODED,0,UNMATCHED
687929,15,"I see no crashes on Firefox 10b1:
Mozilla/5.0 (Windows NT 6.1; rv:10.0) Gecko/20100101 Firefox/10.0
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0) Gecko/20100101 Firefox/10.0
Mozilla/5.0 (X11; Linux i686; rv:10.0) Gecko/20100101 Firefox/10.0
Mozilla/5.0 (X11; Linux x86_64; rv:10.0) Gecko/20100101 Firefox/10.0
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:10.0) Gecko/20100101 Firefox/10.0
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.7; rv:10.0) Gecko/20100101 Firefox/10.0
ftp://ftp.mozilla.org/pub/firefox/nightly/2011/12/2011-12-28-mozilla-beta-debug/firefox-10.0.en-US.debug-mac.dmg
ftp://ftp.mozilla.org/pub/firefox/nightly/2011/12/2011-12-28-mozilla-beta-debug/firefox-10.0.en-US.debug-linux-i686.tar.bz2
This is verified fixed on 10b1.",SOLUTION_VERIFICATION,0,FULL_TOKEN
687929,16,Don't forget to also set the status-firefox10 flag to verified.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
687929,17,*** Bug 721191 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
691184,1,"Tested by
http://www.w3c-test.org/html/tests/submission/PhilipTaylor/canvas/2d.text.align.invalid.html
http://www.w3c-test.org/html/tests/submission/PhilipTaylor/canvas/2d.text.baseline.invalid.html",UNCODED,0,UNMATCHED
691184,2,"I'll fix it, unless you'd like to... I've got the tests locally.",STATUS_UPDATE,0,FULL_TEXT
691184,3,"Created attachment 565276
Patch v1
https://tbpl.mozilla.org/?tree=Try&rev=b3000af72f01",UNCODED,0,UNMATCHED
691184,4,"Created attachment 565286
Tests
Tests I promised.",CODE_IMPLEMENTATION,1,FULL_TEXT
691184,5,"Ah sorry I thought you meant you had the Philip Taylor tests locally, rather than an updated test_canvas.html. Thanks!",CLARIFICATION,0,FULL_TEXT
691184,6,"No problem, I should have expressed myself more clearly. (I've been working on updating these tests, and I'd rather get closer to my expected end-result than farther away from it :).)",STATUS_UPDATE,0,FULL_TEXT
691184,7,"Created attachment 565389
Patch v1 (minus tests)
https://tbpl.mozilla.org/?tree=Try&rev=19fdc5b8499f
(with Ms2ger's test changeset this time)",CODE_IMPLEMENTATION,1,FULL_TOKEN
691184,8,"Well it meant I finally ventured into the world of Mochitests for the first time (yeah long overdue!) in creating the v1 patch, so was fairly constructive regardless :-)",UNCODED,0,UNMATCHED
691184,9,"Comment on attachment 565389
Patch v1 (minus tests)
The spec is bad, but I don't care enough to complain.",CODE_REVIEW,0,FULL_TEXT
691184,10,"Thanks for the fast review :-)
https://hg.mozilla.org/integration/mozilla-inbound/rev/d5c6d21109da
https://hg.mozilla.org/integration/mozilla-inbound/rev/45249d949463",UNCODED,0,UNMATCHED
691184,11,"https://hg.mozilla.org/mozilla-central/rev/d5c6d21109da
https://hg.mozilla.org/mozilla-central/rev/45249d949463",UNCODED,0,UNMATCHED
695213,1,"Created attachment 567610
patch
This is nice to have.",CODE_IMPLEMENTATION,1,FULL_TEXT
695213,2,https://hg.mozilla.org/integration/mozilla-inbound/rev/cb1c23bd837b,UNCODED,0,UNMATCHED
695213,3,https://hg.mozilla.org/mozilla-central/rev/cb1c23bd837b,UNCODED,0,UNMATCHED
696748,1,"The following test crashes on mozilla-central revision e79245e249c4 (options -m -n -a), armv7-a arch only:
try {
this.watch(""b"", """".substring);
} catch(exc1) {}
eval(""\
var URI = '';\
test();\
function test() {\
  URI += '<zcti application=\""xxxx_demo\"">';\
  URI += '<pstn_data>';\
  URI += '<dnis>877-485-xxxx</dnis>';\
  URI += '</pstn_data>';\
  URI >>=  '<keyvalue key=\""name\"" value=\""xxx\""/>';\
  URI += '<keyvalue key=\""phone\"" value=\""6509309000\""/>';\
}\
test();\
"");
The optimized build does not crash, but stepping through the assertion causes a crash (but the assert also differs here). It might be that the testcase requires additional tweaking to reveal the issue on opt. Marking this as S-s due to the crash. If the crash is debug-only, feel free unhide.
Backtrace of crash:
Program received signal SIGABRT, Aborted.
Assertion failure: (*insn & 0x012fff30) == 0x012fff30
(../assembler/assembler/ARMAssembler.h:994 static JSC::ARMWord* JSC::ARMAssembler::getLdrImmAddress(JSC::ARMWord*))
Program received signal SIGSEGV, Segmentation fault.
0x00282b98 in JSC::ARMAssembler::getLdrImmAddress (insn=0x4009a188) at ../assembler/assembler/ARMAssembler.h:994
994                     ASSERT((*insn & 0x012fff30) == 0x012fff30);
(gdb) bt
#0  0x00282b98 in JSC::ARMAssembler::getLdrImmAddress (insn=0x4009a188) at ../assembler/assembler/ARMAssembler.h:994
#1  0x00282c5c in JSC::ARMAssembler::patchPointerInternal (from=1074373000, to=0x2f6045) at ../assembler/assembler/ARMAssembler.h:1020
#2  0x002f6772 in JSC::ARMAssembler::relinkCall (from=0x4009a188, to=0x2f6045) at ../assembler/assembler/ARMAssembler.h:1139
#3  0x002f687c in JSC::MacroAssemblerARM::repatchCall (call=..., destination=...) at ../assembler/assembler/MacroAssemblerARM.h:1523
#4  0x002f6ec8 in JSC::RepatchBuffer::relink (this=0xbe8ad664, call=..., destination=...) at ../assembler/assembler/RepatchBuffer.h:95
#5  0x002f6f9e in js::mjit::ic::Repatcher::relink (this=0xbe8ad664, call=..., stub=...) at ../methodjit/ICRepatcher.h:90
#6  0x002f3c78 in PatchSetFallback (f=..., ic=0x456800) at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MonoIC.cpp:150
#7  0x002f46ce in UpdateSetGlobalName (f=..., ic=0x456800, obj=0x40b00040, shape=0x40b0efb0) at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MonoIC.cpp:280
#8  0x002f4886 in js::mjit::ic::SetGlobalName (f=..., ic=0x456800) at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MonoIC.cpp:329
#9  0x00281352 in JaegerStubVeneer () at /home/decoder/LangFuzz/mozilla-central/js/src/methodjit/MethodJIT.cpp:164
#10 0x4009a194 in ?? ()
Cannot access memory at address 0x0
#11 0x4009a194 in ?? ()
Cannot access memory at address 0x0
Backtrace stopped: previous frame identical to this frame (corrupt stack?)",STACK_TRACE,0,FULL_TOKEN
696748,2,"Given that this is in the guts of the assembler I'm guessing at sg:critical here, but if that turns out to not be the case we can re-label this one.",PROBLEM_REVIEW,0,FULL_TEXT
696748,3,"Marty, can you take a look at this--see if it is in fact exploitable? It looks to me like it may not be, but it seems like a codegen bug at least.",PROBLEM_REVIEW,0,FULL_TEXT
696748,4,"oy.
Not horribly unexpected, the issue is with pools.  More specifically, with pools and the repatcher.
For repatchable stub calls (well all calls, but specifically, repatchable calls) we generate the sequence
ldr r12, [pc, pool_dest]
ldr r8, [pc, pool_jaeger_stub_veneer]
blx r8
...
pool:
...
pool_dest:
.word function_to_call
pool_jaeger_stub_veneer
.word jaeger_stub_veneer
which will load the address of a function out of pool_dest, into register 12, then load the address of the jaeger stub veneer into r8, and call the jaeger stub veneer. The repatcher gets the address of |ldr r8, ...|, then looks back at the previous instruction, decodes enough of the instruction to find the address of pool_dest, and finally writes over the |.word function_to_call| with the new value.
In this case, however, immediately after emitting |ldr r12, [pc, pool_dest]|, we determined the pool needed to be flushed, and flushed the pool, thus the sequence we actually got was:
ldr r12, [pc, pool_dest]
b after_pool
pool1:
...
pool_dest:
.word function_to_call
after_pool
ldr r8, [pc, pool_jaeger_stub_veneer]
blx r8
...
pool2
pool_jaeger_stub_veneer
.word jaeger_stub_veneer
so when the instruction that the re-patcher gets is still |ldr r8, [pc,pool_jaeger_stub_veneer]|. However, the ""instruction"" before it is now .word function_to_call rather than |ldr r12, [pc, pool_dest]|.  This is why the assertion is thrown.  The result of calling the patcher on this is: we read the bottom 12 bits of the function that we're attempting to patch from, add it to the address of the patch (two before the actuall call to jaeger_stub_veneer), get a memory location, and write over that memory location with a single word of data that any possible attackers most likely won't get to control (We are writing over the value with the address of a C function).  More likely than not, the address that we write over will *not* be word aligned, whereas any instructions (or other data) that we generate will likely be word aligned, so it is likely going to write over parts of two different values.  I would say that this is in fact exploitable, but would be hard pressed to generate a reasonable exploit.",PROBLEM_REVIEW,0,FULL_TOKEN
696748,5,"I can think of two possible solutions:
1) rather than storing the address of the second instruction, store the address of the *first* instruction, so we'll be able to walk forwards and get to the other two, possibly following pool guards.
2) mark those three instructions as a no-pool zone.  no-pool zones have always felt like a hack.
I'll need to find out why we carry the address of the second instruction to begin with.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
696748,6,"Created attachment 575610
Don't place pools in the middle of a call
Have not pushed to try, nor run jit-tests locally yet.",CODE_IMPLEMENTATION,1,FULL_TEXT
696748,7,"Sorry for the slow update, I thought the fix for this landed on m-i on monday, but evidently the push failed, and I didn't notice?
http://hg.mozilla.org/integration/mozilla-inbound/rev/6dc5acdc2cbe",UNCODED,0,UNMATCHED
696748,8,"No problem, thanks for double-checking.",UNCODED,0,UNMATCHED
696748,9,https://hg.mozilla.org/mozilla-central/rev/6dc5acdc2cbe,UNCODED,0,UNMATCHED
696748,10,"If this is a major security concern for FF9/10 and is considered low risk, please nominate for approval on beta/aurora.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
696748,11,"We should get this fix into Fx10, don't feel too strongly about rushing it into 9.",CLARIFICATION,0,FULL_TEXT
696748,12,"Marty, is this patch appropriate for aurora? If so, please request aurora approval on the patch!",VERIFICATION_REQUEST,0,FULL_TEXT
696748,13,"Marty, ping?",UNCODED,0,UNMATCHED
696748,14,"Comment on attachment 575610
Don't place pools in the middle of a call
[Approval Request Comment]
Regression caused by (bug #): 
User impact if declined: 
This bug has been in the assembler since arm support for JM landed
Testing completed (on m-c, etc.): 
Risk to taking this patch (and alternatives if risky):
It has been pretty thoroughly tested on aurora, and the fix is pretty foolproof",SOLUTION_VERIFICATION,0,FULL_TOKEN
696748,15,Pushed to beta with: https://hg.mozilla.org/releases/mozilla-beta/rev/2f0d90c7f5c7,UNCODED,0,UNMATCHED
696748,16,https://hg.mozilla.org/mozilla-central/rev/053bb31882c4,UNCODED,0,UNMATCHED
698552,1,NSS 3.13.2 will contain changes needed for SPDY. We are going to update mozilla-central with the current state of NSS 3.13.2 and then track updates to NSS 3.13.2 until sometime after the Aurora merge date. Then we will freeze the NSS 3.13.2 release and import the 3.13.2 RTM into mozilla-central and mozilla-aurora.,PROBLEM_DESCRIPTION,0,FULL_TEXT
698552,2,"This is what I will do:
* python client.py update_nss NSS_3_13_2_MOZILLA_10_PRERELEASE_1.
* verify that security/coreconf/coreconf.dep is +/- a line
* update configure.in to require NSS 3.13.2 or later for --use-system-nss.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
698552,3,*** Bug 706728 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
698552,4,"Created attachment 578152
TAG-INFO for NSS_3_13_2
I will update to NSS 3.13.2 using:
python client.py update_nss NSS_3_13_2_BETA1
I verified that this will add a blank line to security/coreconf/coreconf.def so that a full rebuild of NSS is done.
I will post the patch to configure.in next.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
698552,5,"Created attachment 578154
Update configure.in to require at least NSS 3.13.2 for --use-system-nss",UNCODED,0,UNMATCHED
698552,6,"Created attachment 578157
Add SSL_RestartAfterAuthCertificate to mozilla-central's copy of NSS_3_13_2_BETA1
This patch is a Mercurial patch that adds two patches reviewed by rrelyea in bug 542832 to NSS in mozilla-central: 
bug-542832-ssl-restart-4.patch
bug-542832-ssl-restart-tstclnt-4.patch
We are taking these local patches so we can start testing the functionality in mozilla-central, while we wait for feedback from Wan-Teh about any changes Google would like to make to the patches. Once all the feedback is in and the final changes (if any) are made, we will commit this to the NSS CVS HEAD, back out this patch, and then import the final NSS 3.13.2 release into mozilla-central.
Notice that this patch adds the above patch files to the security/patches/ directory, as is required for patches to NSS that are local to mozilla-central.",CODE_IMPLEMENTATION,1,FULL_TOKEN
698552,7,"Honza, please work with Kai on reviewing the patch, to make sure you understand everything that is happening. 
See the documentation for this at https://developer.mozilla.org/en/Updating_NSPR_or_NSS_in_mozilla-central",CODE_REVIEW_REQUEST,0,FULL_TOKEN
698552,8,"If I understand correctly, both patches have been reviewed in bug 542832 already.
Wouldn't it be less confusing to:
- check in the code that has been reviewed
- include that in the BETA tag
- for the additional discussion and feedback, do a follow patch?
(I don't want to create additional burden for you to handle at the last minute, but we should use this approach in the future.)",STATUS_UPDATE,0,FULL_TOKEN
698552,9,"Comment on attachment 578152
TAG-INFO for NSS_3_13_2
During the conf. call the NSS team decided this is OK. r=kaie",CODE_REVIEW,0,FULL_TEXT
698552,10,"Comment on attachment 578154
Update configure.in to require at least NSS 3.13.2 for --use-system-nss
r=kaie",CODE_REVIEW,0,FULL_TOKEN
698552,11,"Comment on attachment 578157
Add SSL_RestartAfterAuthCertificate to mozilla-central's copy of NSS_3_13_2_BETA1
I assume this is identical to the patches, already reviewed, mentioned attached in the bug you have mentioned,
plus adding the patch file to the security/patches directory.
During the conf. call, Wan-Teh requested that you also add/update a README file in that directory, and add the respective bug numbers and a one line description of the patch.
If you do that, r=kaie
(it's not necessary to add a patch here, just commit a reasonable README file)",CODE_REVIEW,0,FULL_TOKEN
698552,12,"Comment on attachment 578157
Add SSL_RestartAfterAuthCertificate to mozilla-central's copy of NSS_3_13_2_BETA1
Review of attachment 578157:
-----------------------------------------------------------------
r=honzab, I checked (in limits of how CVS and HG patches can be compared byte-to-byte) the patches are identical.",CODE_REVIEW,0,FULL_TEXT
698552,13,"https://hg.mozilla.org/mozilla-central/rev/0ef53633ccc7
https://hg.mozilla.org/mozilla-central/rev/9381d62e583d
https://hg.mozilla.org/mozilla-central/rev/2050e4dfe6e3",UNCODED,0,UNMATCHED
698552,14,"I added the comment when I checked this in:
https://hg.mozilla.org/mozilla-central/diff/0ef53633ccc7/security/patches/README",UNCODED,0,UNMATCHED
698552,15,"https://hg.mozilla.org/mozilla-central/rev/2050e4dfe6e3
     1.1 --- a/dbm/src/Makefile.in
     1.2 +++ b/dbm/src/Makefile.in
     1.3 @@ -74,16 +74,17 @@ endif
     1.4  ifeq (,$(filter -DHAVE_SNPRINTF=1,$(ACDEFINES)))
     1.5  CSRCS += snprintf.c
     1.6  endif
     1.7  endif # WINNT
     1.8  
     1.9  LOCAL_INCLUDES	= -I$(srcdir)/../include
    1.10  
    1.11  FORCE_STATIC_LIB = 1
    1.12 +FORCE_USE_PIC = 1
Note bug 698248.",UNCODED,0,UNMATCHED
698552,16,I filed bug 707300 about changing this in NSS CVS. Please reply to my question in that bug.,NEW_ISSUE_FILING,0,FULL_TEXT
700508,1,"Memory reporters have a path.  Many of them have segments that form part of a tree, e.g. the ""explicit"" tree.  Bug 653630 allowed non-leaf reporters, whereby you could have something like ""explicit/foo"" and ""explicit/foo/a"" and aboutMemory.js would add in ""explicit/foo/other"" which was ""explicit/foo"" - ""explicit/foo/a"".
This was necessary for the SQLite reporters, because SQLite provides a single reporter for its entire memory use, and then reporters for each of its connections, but we don't have a single list of those connections anywhere so we had to do the arithmetic in aboutMemory.js rather than creating an ""sqlite/other"" reporter.
Unfortunately, allowing non-leaf reporters made aboutMemory.js more complicated and I've been annoyed by it for ages.  Bug 700217 is the catalyst for me filing this bug.
The only hard part is dealing with the SQLite reporters.  One way would be to replace the ""storage/sqlite"" reporter with a ""storage/sqlite/other"" reporter, which would require the aforementioned list of all SQLite connections.  Probably not too hard.  A hacky alternative would be to special-case ""storage/sqlite"", making it the only allowed non-leaf reporter.  (Brendan has a philosophy that it's generally ok to have one exception to a rule, which I think is an interesting idea!)  That would still allow a lot of simplification to occur.",PROBLEM_MOTIVATION,0,FULL_TOKEN
700508,2,"Created attachment 573750
patch
I did this, it was easier than working out how to track all the SQLite connections.  aboutMemory.js's complexity didn't change much -- it no longer has to deal with non-leaf nodes, which is good, but it has to special case ""explicit/storage/sqlite"", which is bad.
GetExplicit is much simpler, though, and avoids the quadratic case.
I need to test the sqlite special-casing in test_aboutmemory.xul, I'll do that on Monday.",CODE_IMPLEMENTATION,1,FULL_TOKEN
700508,3,I'm not certain that this is the right way to go -- who's to say we won't have another SQLite-like situation on our hands -- but I don't see the harm in trying it out.  This one-exception rule is interesting...,CODE_REVIEW,0,FULL_TOKEN
700508,4,"I think SQLite is pretty unusual.  It's a sub-system we can't modify, and yet it provides detailed memory reporting which we use to implement our memory reporters.  I don't think we'll have another case like it.  I can't prove this, of course, so in the meantime I'll claim YAGNI (or maybe ""YAGNI... more than once"").  It sure makes thinking about memory reporters easier.
Yeah, it's kind of a quasi-inverse of the ""don't generalize something until you have at least two instances of it"" rule of thumb.",CLARIFICATION,0,FULL_TOKEN
700508,5,"Comment on attachment 573750
patch
Nit: Parallelism.  ""Non-leaf TreeNodes, *which* are just scaffolding""
What should never happen for ""explicit""?  Shouldn't you reverse this?  ""We
should always find a reporter when aTreeName == explicit, but some 'map' trees
might be missing"".  In fact, you could
  assert(aTreeName != 'explicit' || foundReporter).
Kind of a weird variable name...  I guess it's supposed to be like |aT|?  Maybe
|heapUnclassifiedNode| would be better?
Typo.
I'd add an explicit mention of the fact that non-leaf reporters other than
sqlite/other are not allowed.  (The sqlite/other special-case is now part of
our interface, so we might as well document it here.)
We usually do |NS_ENSURE_ARG_POINTER(aExplicit)| first, just to be paranoid.
This doesn't seem to be the prevailing style in this file.
r=me, but we need to test the sql reporter hack.",CODE_REVIEW,0,FULL_TOKEN
700508,6,Bug 702815 will allow the sqlite hack to be removed :),ADDITIONAL_CONSIDERATION,0,FULL_TEXT
700508,7,"Created attachment 574773
patch without the sqlite hack
This can't land until bug 702815 is done, obviously.",REQUIREMENT,0,FULL_TEXT
700508,8,"Comment on attachment 574773
patch without the sqlite hack
Is this the right patch?",QUESTION,0,FULL_TEXT
700508,9,"Created attachment 574989
patch without the sqlite hack (actual)
Sorry, here's the right patch.",CODE_IMPLEMENTATION,1,FULL_TEXT
700508,10,"Comment on attachment 574989
patch without the sqlite hack (actual)
Wow, bugzilla's interdiff actually worked.  That was cool.",CODE_REVIEW,0,FULL_TOKEN
700508,11,I've found the 'interdiff' that comes with patchutils on Linux is much more robust than Bugzilla's.,CODE_REVIEW,0,FULL_TEXT
700508,12,"Yeah, I usually do
  interdiff <(curl -L http://attachment-url-1) <(curl -L http://attachment-url-2) | vim -",CODE_REVIEW,0,FULL_TOKEN
700508,13,https://hg.mozilla.org/integration/mozilla-inbound/rev/61d41436beb3,UNCODED,0,UNMATCHED
700508,14,https://hg.mozilla.org/mozilla-central/rev/61d41436beb3,UNCODED,0,UNMATCHED
700508,15,"Backed out in order to back out bug 703143:
https://hg.mozilla.org/integration/mozilla-inbound/rev/c52a726dc939",IMPLEMENTATION_REVERSION,0,FULL_TEXT
700508,16,"Merge of backout:
https://hg.mozilla.org/mozilla-central/rev/c52a726dc939",IMPLEMENTATION_REVERSION,0,FULL_TEXT
700508,17,"Relanded:
https://hg.mozilla.org/integration/mozilla-inbound/rev/4779d8df054b",IMPLEMENTATION_REVERSION,0,FULL_TEXT
700508,18,"Backed out for linux64 moth orange:
https://tbpl.mozilla.org/?tree=Mozilla-Inbound&rev=4779d8df054b
This patch pushed the number of assertions in about:memory up from 24K to 34K, making the log exceed the 52428800 bytes limit.
https://hg.mozilla.org/integration/mozilla-inbound/rev/1f17624f1ab7",CLARIFICATION,0,FULL_TEXT
700508,19,"There were already 24K assertions?  I'm having trouble viewing the log, can you cut+paste some of them for me?",QUESTION,0,FULL_TEXT
700508,20,"I was unable to load the log either earlier unfortunately, so those figures were from philor's analysis before he had to head out (presuming I've interpreted his comments correctly).
I've since looked up the raw tinderbox log url, saves trying to convince tbpl to load it (uncompressed the log is 70MB, so not surprising it was timing out):
http://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-inbound-linux64-debug/1325827944/mozilla-inbound_fedora64-debug_test-mochitest-other-build620.txt.gz
Hope that helps :-)",ANSWER_TO_QUESTION,0,FULL_TEXT
700508,21,"With the first patch in bug 715453 having removed this assertion, I thought I'd give this another spin:
https://hg.mozilla.org/integration/mozilla-inbound/rev/797a60d83008",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
700508,22,https://hg.mozilla.org/mozilla-central/rev/797a60d83008,UNCODED,0,UNMATCHED
714547,1,"In Firefox 10+, an Array passed from another domain (must be another domain, not just an iframe) behaves like an Object, breaking things like Array.prototype.concat and JSON.stringify.
See this test page:
http://ludios.net/browser_bugs/ff10_array_concat_bug.html
It should display:
[object Array] of length 2: [""one"",""two""]
[object Array] of length 2: [""one"",""two""]
but Firefox 10.0b2 and 11.0a2 (2012-01-01) display:
[object Array] of length 2: {""0"":""one"",""1"":""two""}
[object Array] of length 1: [{""0"":""one"",""1"":""two""}]",TEST_CASES,0,FULL_TOKEN
714547,2,"Regression range: http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=ccea01542d0b&tochange=e0ae39a3298e
Luke, could the scope chain changes be responsible?
Nominating, since this seems like something we need to fix before ship...",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
714547,3,ccing luke too.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
714547,4,"Luke, we're getting a SecurityWrapper<CrossCompartmentWrapper> here.  Its objectClassIs implementation is this:
868	template <class Base>
869	bool
870	SecurityWrapper<Base>::objectClassIs(JSObject *obj, ESClassValue classValue, JSContext *cx)
871	{
872	    /* Let ProxyHandler say 'no'. */
873	    bool ret = ProxyHandler::objectClassIs(obj, classValue, cx);
874	    JS_ASSERT(!ret && !cx->isExceptionPending());
875	    return ret;
876	}
ProxyHandler::objectClassIs just says ""no"".
344	bool
345	ProxyHandler::objectClassIs(JSObject *proxy, ESClassValue classValue, JSContext *cx)
346	{
347	    JS_ASSERT(OperationInProgress(cx, proxy));
348	    return false;
349	}
What gives here?  Should SecurityWrapper be asking Base::objectClassIs, maybe?  I'm having difficulty understanding when it could ever be correct to call ProxyHandler::objectClassIs, honestly, with the semantics it implements.",PROBLEM_REVIEW,0,FULL_TOKEN
714547,5,"This is technically working by design: a SecurityWrapper is not supposed to expose information about cross-domain objects.  Actually, from discussions with mrbkap, I thought it wasn't supposed to be possible for vanilla JS objects to be exposed cross-domain (but rather a select few things like Window, Location, etc), though clearly I'm wrong.  Blake, care to weigh in here?",PROBLEM_REVIEW,0,FULL_TOKEN
714547,6,"They're cross-domain, but by both pages setting document.domain to a truncation (""ludios.net""), access is permitted.
(What happens if the two pages modify document.domain to the same value, exchange some object, then one modifies to a different string?  ""'That's not my department', says Werner von Braun.""  I think historically we then allowed access forever, since a modification by one could be mirrored by the other, but I don't know if we do that now, or if we consider that policy sane.)",ANSWER_TO_QUESTION,0,FULL_TOKEN
714547,7,"Yeah. Everything I've said has a giant asterisk next to it saying ""document.domain makes most of this not apply!"" We only realized how badly document.domain was broken at the end of compartments, so we hacked in a solution that mostly works.
Actually, it's my department!
Historically, security checks only happened when calling getters, when getting certain properties (such as __proto__ and .constructor) and when entering XPConnect (that is, calling C++ functions from JS). Therefore, if you had set document.domain on two documents, gotten some objects out of them and then reset document.domain, you'd have a bunch of objects that somewhat worked, but would occasionally throw exceptions depending on which properties were being accessed.
Right now, because we assume that you can't have a vanilla object cross-origin, some objects (such as arrays) will continue to work fine, but you won't be able to access DOM objects any more (since they no longer consider themselves to be same origin).
The plan going forward for this is that when we have compartment-per-global, we will be able to do brain transplants for all of the objects in the compartment that sets document.domain, properly revoking access to the old objects. That will also have the side-effect of fixing this bug, since we'll be using the right kind of security wrappers all the time.",ANSWER_TO_QUESTION,0,FULL_TOKEN
714547,8,"Hah, I almost added a ""Is there some document.domain afoot here?"".  Thanks for the explanation Blake.  Would a more immediate fix (than c-p-g) be for FilteringWrapper to override objectClassIs and then provide an exception for AccessCheck::documentDomainMakesSameOrigin?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
714547,9,"This would definitely fix this bug... A second question, though, is whether or not we're actually protecting ourselves from anything here. I tend to lean towards ""no"". I can't actually think of an attack where letting foreign code know that something is a native array (or date object, etc) would actually open up a security hole.",SOLUTION_REVIEW,1,FULL_TEXT
714547,10,"Seems to me it's an information leak all the same.  Although, rather than say ""no"" when asked for security things, it seems to be the proper thing to do would be to just throw an exception.",ANSWER_TO_QUESTION,0,FULL_TOKEN
714547,11,"To your question: it seems like we go through great lengths to avoid exposing any cross-origin information, and I think ""is this object an array/string/regexp/etc"" qualifies as a few bits of information.
However, your question isn't the situation we have: our assumption is that these SecurityWrapper'd objects are only being exposed in document.domain situations (where it is  ok for them to be transparent).  So, for that reason, I'm happy to neuter SecurityWrapper as a quick fix.  But it seems like, when we tighten up the document.domain situation after c-p-g, we'll want the proposed fix in comment 7.",SOLUTION_REVIEW,1,FULL_TOKEN
714547,12,"Oops, missed comment 9: maybe I'm missing something, but saying 'no' (unconditionally) doesn't seem to leak any more information than throwing a security exception, but the latter does sound better.",CLARIFICATION,0,FULL_TEXT
714547,13,"I was responding to ""an attack where letting foreign code know that something is a native array (or date object, etc)"", not to what we currently do.  Seems better to hold a line than to allow some things to work (but to what end, if immediately post-check we'd start looking up properties on it in [].concat and fail anyway?).",CLARIFICATION,0,FULL_TOKEN
714547,14,"No, that should all go back to working the way it did before.  (Actually, this bug notwithstanding, FF10+ should work *better* with cross-origin wrappers b/c of bug 683361!)",CLARIFICATION,0,FULL_TOKEN
714547,15,"Created attachment 587100
as described
As discussed above, this patch just let nativeCall/objectClassIs pass through.",CODE_IMPLEMENTATION,1,FULL_TEXT
714547,16,"Comment on attachment 587100
as described
Review of attachment 587100:
-----------------------------------------------------------------
::: js/src/jswrapper.cpp
@@ +860,5 @@
Either this or actually checking document.domain work for me.
Nit: let's -> lets.",CODE_REVIEW,0,FULL_TEXT
714547,17,"Could you file a followup depending on the cpg bug, so we don't lose track?",NEW_ISSUE_FILING,0,FULL_TEXT
714547,18,"https://hg.mozilla.org/integration/mozilla-inbound/rev/81cb240e14c4
Blake: is there already a ""fix document.domain"" bug?  This is really just a small addition to that general task.",ANSWER_TO_QUESTION,0,FULL_TEXT
714547,19,https://hg.mozilla.org/mozilla-central/rev/81cb240e14c4,UNCODED,0,UNMATCHED
714547,20,bug 655649 is that bug.,ANSWER_TO_QUESTION,0,FULL_TEXT
714547,21,"Is this still a major concern for Firefox 10 (web/add-on compatibility)? If so, please nominate for aurora/beta approval ASAP. We're cutting our second to last beta today.",VERIFICATION_REQUEST,0,FULL_TEXT
714547,22,*** Bug 723388 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
714547,23,"Comment on attachment 587100
as described
[Approval Request Comment]
Regression caused by (bug #): 690825
User impact if declined: Two sites seem to have been broken so far.  The fix is on aurora, so it would be better to wait 6 weeks instead of 12.
Testing completed (on m-c, etc.): on aurora
Risk to taking this patch (and alternatives if risky): low, on aurora",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
714547,24,"Comment on attachment 587100
as described
[Triage Comment]
Breaking websites - let's get this in for our second Beta on Tuesday. Approved.",UPLIFT_APPROVAL,0,FULL_TOKEN
714547,25,"Minusing for tracking-esr10. It's affected, but we will not fix minor functional regressions unless they affect enterprise users significantly.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
714547,26,"How will yo know whether it affects enterprise users if you don't track it?
[this kind of decisions pushed me away from this project, among other related things]",QUESTION,0,FULL_TOKEN
714547,27,https://hg.mozilla.org/releases/mozilla-beta/rev/73f897fa60a5,UNCODED,0,UNMATCHED
714547,28,"I'm not entirely convinced this is the right decision.
Array.isArray was added to the spec because it addresses a real problem authors face: that instanceof is insufficient for testing the kind (""class"") of an object.  We've supported and advocated its use for a year and a half now, particularly for the very case at issue here and in duplicate bugs.
I don't think I can call this a ""minor functional regression"".  That description is arguably accurate for this bug's symptoms outside of Array.isArray.  But Array.isArray not working in this way means that API is fundamentally broken.  Its *entire purpose* is to answer that question correctly; this mistake isn't an edge case.  If it's not answering the question correctly in a fairly basic scenario, that's not a minor functional regression.  It means the API is unreliable, untrustworthy, and potentially even unusable.
I think we should reconsider this decision.",CLARIFICATION,0,FULL_TOKEN
714547,29,"We don't track issues until it's clear the issue meets our ESR landing criteria - when that occurs, a user/developer can set the tracking-firefox-esr10 flag to ?. See https://wiki.mozilla.org/Release_Management/ESR_Landing_Process for more info.
When I commented previously, it wasn't clear we needed to take a fix. Given the site pain we're now seeing in 723388, we've reconsidered. Tracking for the ESR release shipped lock-step with FF11.
Luke - please land on mozilla-esr10 as soon as possible. Thanks!",ASSIGNEE_REQUEST,0,FULL_TEXT
714547,30,"Alex: mozilla-esr10 seems closed and all patches have CLOSED TREE.  I tried landing with CLOSE D TREE (per comment 28) but got some error:
  remote: Unrecognized tree!  I don't know how to check closed status for mozilla-esr10.
Any hints?",QUESTION,0,FULL_TOKEN
714547,31,the hook was not updated when it was originally applied to this repo (bug 722310) and it is now being updated so you should be able to try again in ~5 mins.,ANSWER_TO_QUESTION,0,FULL_TEXT
714547,32,"Great, thanks
https://hg.mozilla.org/releases/mozilla-esr10/rev/672934cac449",STATUS_UPDATE,0,FULL_TEXT
714547,33,"Sadly, down there on the releasing edge, you need to hg up -r default to be sure you aren't on whatever relbranch was pushed to last - you pushed to the Thunderbird/SeaMonkey relbranch.",UNCODED,0,UNMATCHED
714547,34,"Good catch philor!
https://hg.mozilla.org/releases/mozilla-esr10/rev/771afd1e6247",UNCODED,0,UNMATCHED
714547,35,"This is verified fixed on FF 11b3:
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:11.0) Gecko/20100101 Firefox/11.0
Mozilla/5.0 (X11; Linux i686; rv:11.0) Gecko/20100101 Firefox/11.0
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:11.0) Gecko/20100101 Firefox/11.0
But still an issue on FF 10.0.2 ESR:
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:10.0.2) Gecko/20100101 Firefox/10.0.2
Mozilla/5.0 (X11; Linux i686; rv:10.0.2) Gecko/20100101 Firefox/10.0.2
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:10.0.2) Gecko/20100101 Firefox/10.0.2",SOLUTION_VERIFICATION,0,FULL_TOKEN
714547,36,Does FF 10.0.2 ESR contain https://hg.mozilla.org/releases/mozilla-esr10/rev/771afd1e6247?,QUESTION,0,FULL_TEXT
714547,37,"No, it does not:
https://hg.mozilla.org/releases/mozilla-esr10/file/FIREFOX_10_0_2esr_RELEASE/js/src/jswrapper.cpp#l864
It looks like 10.0.2 ESR was built from GECKO1001_2012020805_RELBRANCH:
https://hg.mozilla.org/releases/mozilla-esr10/rev/14af4fac0bc5
I'm not sure why this happened, since that was the 10.0.1 ESR relbranch.  This means 10.0.2 ESR missed this patch which landed on the default branch rather than the relbranch.",ANSWER_TO_QUESTION,0,FULL_TOKEN
714547,38,Will there be a 10.0.3 ESR and will this patch be on it?,QUESTION,0,FULL_TEXT
714547,39,Yes and yes.,ANSWER_TO_QUESTION,0,FULL_TEXT
714547,40,"10.0.2 was a chemspill, so it was built from the previous _relbranch to keep the release focused and testing limited. Future ESR releases will be from the mainline and pick up this fix. Currently this is scheduled to ship in ""whatever 10.x ESR matches Firefox 11"". We expect that to be 10.0.3 unless there's another chemspill release in the meantime.",CLARIFICATION,0,FULL_TEXT
714547,41,Not to quibble over version numbers but I would expect the Firefox 11 ESR to be 10.1 -- right?,QUESTION,0,FULL_TEXT
714547,42,"Nope, we do 10.0.x until we move to 17 then we do 17.0.x, etc (see https://wiki.mozilla.org/Enterprise/Firefox/ExtendedSupport:Proposal)",ANSWER_TO_QUESTION,0,FULL_TEXT
714547,43,"Actual results:
[object Array] of length 2: [""one"",""two""]
[object Array] of length 2: [""one"",""two""]
Verified fixed on FF 10.0.3 ESR on Win 7, Ubuntu 11.10 and Mac OS X 10.6.8",SOLUTION_VERIFICATION,0,FULL_TOKEN
717147,1,"Created attachment 587584
Patch part.1 input events which are fired after compositionupdate should be trusted events
The text event handler of editor doesn't make nsAutoEditorKeypressOperation instance. Therefore, the input events during compsition (and at commit the composition) are not trusted events.
With the attached patch, input events during composition become trusted events. However, it causes some regressions in chrome UI.",CODE_IMPLEMENTATION,1,FULL_TOKEN
717147,2,"input event handlers:
http://mxr.mozilla.org/mozilla-central/search?string=addEventListener%28\%22input\%22&find=&findi=&filter=^[^\0]*%24&hitlimit=&tree=mozilla-central
http://mxr.mozilla.org/mozilla-central/search?string=event%3D\%22input\%22&find=&findi=&filter=^[^\0]*%24&hitlimit=&tree=mozilla-central
http://mxr.mozilla.org/mozilla-central/search?string=oninput%3D&find=&findi=&filter=^[^\0]*%24&hitlimit=&tree=mozilla-central",UNCODED,0,UNMATCHED
717147,3,"Created attachment 587590
Patch part.2 Don't do autocomplete during composition",UNCODED,0,UNMATCHED
717147,4,"Created attachment 587598
Patch part.3 Findbar shouldn't do incremental search during composition",UNCODED,0,UNMATCHED
717147,5,"Created attachment 587684
Patch part.2 Don't do autocomplete during composition
autocomplete shouldn't show popup during composition because it disturbs IME's candidate window. See bug 165055's screenshots.
The new test is copied from editor/libeditor/text/tests/test_bug527935.html, therefore it's in the path rather than under toolkit/.",CODE_IMPLEMENTATION,1,FULL_TOKEN
717147,6,"Created attachment 587686
Patch part.3 Findbar shouldn't do incremental search during composition
Findbar shouldn't find a word for unconverted composition string.
For example, if user wants to convert ""ABC"" to ""DEF"" by IME, user types ""ABC"" by keyboard. Then, if findbar did incremental search in ""DEFABCDEF"", the ""ABC"" would be selected. And when the user did convert to ""DEF"", findbar found the *second* ""DEF"". It's bad behavior. The first ""DEF"" should be selected.
Therefore, I think that findbar shouldn't do incremental search during composition.",CODE_IMPLEMENTATION,1,FULL_TOKEN
717147,7,"Comment on attachment 587686
Patch part.3 Findbar shouldn't do incremental search during composition
nit: for tests, the comment should be an assertion about the correct behavior, not a description of the error. So you should have:
-> ""findbar should be hidden after testNormalFindWithComposition""
-> ""testNormalFindWithComposition: find field should be focused""
-> ""testNormalFindWithComposition: text should be found after committing composition""
etc. This applies to a bunch of places in the existing test, it looks like...",CODE_REVIEW,0,FULL_TOKEN
717147,8,Why?,QUESTION,0,FULL_TEXT
717147,9,":masayuki: I wasn't sure, so I put the dev-doc-needed so that we could track if some doc is needed.
So you do think this is only an ""implementation fix"" change that doesn't need to be documented?",QUESTION,0,FULL_TEXT
717147,10,Yes.,ANSWER_TO_QUESTION,0,FULL_TEXT
717147,11,"Comment on attachment 587684
Patch part.2 Don't do autocomplete during composition
Review of attachment 587684:
-----------------------------------------------------------------
Looks reasonable. Do any of the other ::Handle* methods need a similar treatment?",QUESTION,0,FULL_TEXT
717147,12,"In the future, they might need. Currently, key events are not still fired during composition. However, D3E spec thinks only keydown/keyup events should be fired even during composition. When we fix it, we need to do it, maybe.",ANSWER_TO_QUESTION,0,FULL_TEXT
717147,13,"https://hg.mozilla.org/integration/mozilla-inbound/rev/1f64197c3878
https://hg.mozilla.org/integration/mozilla-inbound/rev/1a71337e5cf7
https://hg.mozilla.org/integration/mozilla-inbound/rev/78e58e679fca",UNCODED,0,UNMATCHED
717147,14,"https://hg.mozilla.org/mozilla-central/rev/1f64197c3878
https://hg.mozilla.org/mozilla-central/rev/1a71337e5cf7
https://hg.mozilla.org/mozilla-central/rev/78e58e679fca",UNCODED,0,UNMATCHED
722137,1,"Created attachment 592477
testcase
###!!! ASSERTION: Invalid offset: 'aOffset <= mSkipChars->mCharCount', file gfx/thebes/gfxSkipChars.cpp, line 92
###!!! ASSERTION: Text run does not map enough text for our reflow: 'gfxSkipCharsIterator(iter).ConvertOriginalToSkipped(offset + length) <= mTextRun->GetLength()', file layout/generic/nsTextFrameThebes.cpp, line 7399",STACK_TRACE,0,FULL_TOKEN
722137,2,"Created attachment 592478
stack traces",UNCODED,0,UNMATCHED
722137,3,"Created attachment 592784
Patch
The patch from bug 698335 should have used GetNextInFlow instead of GetNextSibling.",CODE_IMPLEMENTATION,1,FULL_TEXT
722137,4,"Created attachment 592785
Test",UNCODED,0,UNMATCHED
722137,5,"https://hg.mozilla.org/integration/mozilla-inbound/rev/159c690b5aa5
https://hg.mozilla.org/integration/mozilla-inbound/rev/7b5995e5d551",UNCODED,0,UNMATCHED
722137,6,"https://hg.mozilla.org/mozilla-central/rev/159c690b5aa5
https://hg.mozilla.org/mozilla-central/rev/7b5995e5d551",UNCODED,0,UNMATCHED
724586,1,"Created attachment 594741
v1
Also rips out some dangling sharp references and sanifies the control flow a bit.  Allows us to rip out about 75 lines of fiddly C string manipulation.  There is still more to do here before this code path is sane enough to replace the hash table.",CODE_IMPLEMENTATION,1,FULL_TOKEN
724586,2,https://tbpl.mozilla.org/?tree=Try&rev=12745cb4ba65,UNCODED,0,UNMATCHED
724586,3,"Comment on attachment 594741
v1
Review of attachment 594741:
-----------------------------------------------------------------
The extra changes I suggest probably orphan a few variables -- make sure to check for unused warnings before committing a patch with changes.
::: js/src/jsobj.cpp
@@ +639,5 @@
if (comma && !buf.append(comma, 2))
    goto overflow;
Or, since I think you said comma's either NULL or "", "", make comma a bool, then buf.append("", "") -- much clearer.
@@ +650,5 @@
if (!buf.append(gsop[j]) || !buf.append(' '))
    goto overflow;
Goodbye raw char* references!
@@ +655,4 @@
if (!buf.append(idstr))
    goto overflow;
@@ +673,5 @@
finishString would have reported an error if it failed, so this extra report is unnecessary (bad, even, see below).
@@ +685,4 @@
If we can make all goto-overflows be the result of append failures, then Vector::append (whichever overload) would have reported an error, so this is unnecessary (bad, even, since we have assertions that errors aren't multiply-reported).
And at that point error/overflow are identical, so they can be unified.
And at that point, we can just make the js_LeaveSharpObject happen through a one-off RAII object.  I don't think it matters if we leave before finishing the string and setting it in the success case.
And at that point, all the error-y gotos become return false!
And at that point we declare victory!",CODE_REVIEW,0,FULL_TOKEN
724586,4,"Created attachment 594889
v2: With review feedback
Worked like a charm.  Rerunning try to ensure I didn't break anything.
https://tbpl.mozilla.org/?tree=Try&rev=3eb0895f9745",CODE_IMPLEMENTATION,1,FULL_TOKEN
724586,5,http://hg.mozilla.org/integration/mozilla-inbound/rev/224e1e3e1483,UNCODED,0,UNMATCHED
724586,6,https://hg.mozilla.org/mozilla-central/rev/224e1e3e1483,UNCODED,0,UNMATCHED
730907,1,"Mitre reports that the VP8 Codec SDK (libvpx) before 1.0.0 ""Duclair"" allows remote attackers to cause a denial of service (application crash) via (1) unspecified ""corrupt input"" or (2) by ""starting decoding from a P-frame,"" which triggers an out-of-bounds read, related to ""the clamping of motion vectors in SPLITMV blocks"".
See:
http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0823
http://code.google.com/p/webm/source/browse/CHANGELOG?repo=libvpx
http://www.openwall.com/lists/oss-security/2012/01/30/2
http://blog.webmproject.org/2012/01/vp8-codec-sdk-duclair-released.html
So, I believe we need to update to the 1.0.0 version of libvpx since this is publicly disclosed now.
A testcase would be nice to repro the DOS.",PROBLEM_MOTIVATION,0,FULL_TOKEN
730907,2,CC'ing a number of people who will be interested in the outcome of this bug.,UNCODED,0,UNMATCHED
730907,3,Proper mitre link is http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0823.,UNCODED,0,UNMATCHED
730907,4,"CVE-2012-0823
Apparently, bugzilla strips the official URL.",UNCODED,0,UNMATCHED
730907,5,The SPLITMV fix landed in November (bug 696390).  It'd still be a good idea to update to the latest libvpx release so that it's obvious we're up to date.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
730907,6,"Just spoke with kinetik in IRC to clarify. He let me know that he believes we're not vulnerable now that bug 696390 is fixed.
On a separate note - it's not  clear that we'd need to chemspill for this DOS if it wasn't fixed in bug 696390. Crashing (DOS) when opening a webm video seems like an ""stop hitting yourself"" sort of bug.",SOLUTION_REVIEW,1,FULL_TOKEN
730907,7,"Can we open this bug or is there a reason not to do so, since we've already fixed the issue in bug 696390?",QUESTION,0,FULL_TEXT
730907,8,I can't see a reason not to open this bug up.,ANSWER_TO_QUESTION,0,FULL_TEXT
730907,9,"Created attachment 619130
Update libvpx to v1.0.0
khuey: You only need to review the build-system bits (configure.in and Makefile.in changes).
cpearce: If you need me to break out the series of patches we now apply into individual attachments to make reviewing them in bugzilla easier, I'm happy to do so.
Sorry for the delay on this. This update required an unusual amount of work to get things into decent shape.
The new MFQE post-processing filter in the decoder started using a number of variance functions from the encoder, but outside the existing run-time CPU detection framework (which was all still in the encoder structures, which we normally don't compile). This is fixed upstream, but that fix was done after the entire RTCD framework was rewritten. That rewrite is probably too invasive to backport to this release, and had at least one known issue that wasn't fixed until earlier this week, so I chose to move everything within the existing RTCD framework instead (see I256a37c6.patch and variance-invoke.patch; the latter is obsoleted by the new RTCD framework and shouldn't need to go upstream).
I'll work on getting textrels.patch (needed to keep native Fennec from crashing on startup) and compile_errors.patch upstream as well (I had pointed them at the latter before, but the problem has only gotten worse since then, so I'll be more proactive about it). Maybe I can rekindle their interest in solaris.patch, too, so we can stop carrying that one. stdint.patch should already be upstream, but didn't make the v1.0.0 release.",CODE_IMPLEMENTATION,1,90_PCT_MATCH
730907,10,"Comment on attachment 619130
Update libvpx to v1.0.0
Review of attachment 619130:
-----------------------------------------------------------------
Champion effort.",CODE_REVIEW,0,FULL_TEXT
730907,11,"Comment on attachment 619130
Update libvpx to v1.0.0
Review of attachment 619130:
-----------------------------------------------------------------
Doesn't look too crazy.",CODE_REVIEW,0,FULL_TEXT
730907,12,"Greenish on try:
Decoder only: https://tbpl.mozilla.org/?tree=Try&rev=47b6d7f1589c
Plus error concealment and encoder: https://tbpl.mozilla.org/?tree=Try&rev=275fa2f2ab18",SOLUTION_VERIFICATION,0,FULL_TOKEN
730907,13,https://hg.mozilla.org/integration/mozilla-inbound/rev/731c4bc9dd37,UNCODED,0,UNMATCHED
730907,14,https://hg.mozilla.org/mozilla-central/rev/731c4bc9dd37,UNCODED,0,UNMATCHED
731836,1,"Currently, due to our driver blacklisting, less than 50% of users have WebGL working:
  http://people.mozilla.org/~bjacob/gfx_features_stats/
A good way to improve that is to use a software renderer as a fallback.
In the present bug, we're discussing only doing this as an add-on. But once we have that, the next step will be to have the browser automatically download it when it's needed. So really, we're aiming for a full automatic solution.
*** Part 0. Get started with Mozilla hacking ***
This page has useful tips to get started, especially for Graphics hacking (tools, how to get source code, etc):
  https://wiki.mozilla.org/Platform/GFX/Contribute
Code search tool:
  http://mxr.mozilla.org/mozilla-central/
*** Part 1. Get Mesa llvmpipe up and running ***
Mesa is an open source OpenGL library.
  http://www.mesa3d.org
Mesa can use various renderers. Some are hardware-accelerated, some are software-only. The best software-only renderer is called 'llvmpipe' because it uses LLVM for compiling shaders.
 http://www.mesa3d.org/llvmpipe.html
This is available for x86 and x86-64 on Linux, Windows and Mac. Build instructions:
 http://www.mesa3d.org/install.html
IIUC, scons is the recommended way on Windows.
Your first step is to get a build of Mesa llvmpipe for your favorite OS. To be honest, the most interesting OS here is Windows, because that's where the largest proportion of users have outdated GPU drivers, but all OSes are interesting.
*** Part 2. Get Firefox to run WebGL with Mesa llvmpipe ***
Building Mesa llvmpipe should produce a OpenGL library that you could use as a drop-in replacement for the system OpenGL libraries. Notice that on Windows, to get Firefox to use OpenGL, you have to go to about:config and set these preferences:
  webgl.prefer-native-gl = true
  webgl.force-enabled = true
You can check in about:support, 'WebGL renderer', if llvmpipe is actually used.
Run the conformance tests to check that things are decently working:
  https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/sdk/tests/webgl-conformance-tests.html
Also, you can assess performance by first disabling compositing acceleration (we want to optimize for the case where hardware acceleration doesn't work, so better work in real conditions):
  layers.acceleration.disabled = true
and then play some WebGL demos such as
  http://webglsamples.googlecode.com/hg/aquarium/aquarium.html
*** Part 3. Get Firefox to dynamically switch to Mesa llvmpipe ***
Until now we haven't had to touch Mozilla code, but now we have to. It was nice to be able to test WebGL on llvmpipe, but for it to be practical, it must not require replacing system OpenGL libraries by llvmpipe, and Firefox must be able to decide at runtime whether to use llvmpipe.
Let's not automatically fall back to llvmpipe for now. Instead, let's introduce a new preference in about:config that allows to choose llvmpipe for WebGL rendering.
The file to edit, to add a new preference, is:
http://hg.mozilla.org/mozilla-central/file/tip/modules/libpref/src/init/all.js
Call it webgl.use-llvmpipe, boolean, default to false.
In the WebGL initialization code, where we choose our 'GL context provider' (e.g. WGL vs EGL vs GLX...). The problem is twofold. First, we want use-llvmpipe to override the OpenGL driver blacklist i.e. the same effect as webgl.force-enabled. Second, on Windows, switching to Mesa llvmpipe requires switching to WGL (the default is EGL) i.e. the same effect as webgl.prefer-native-gl.
So edit this file:
http://hg.mozilla.org/mozilla-central/file/tip/content/canvas/src/WebGLContext.cpp
Search for Preferences::GetBool in this file, in WebGLContext::SetDimensions, which is where we create the OpenGL context for a WebGL context.
Once this is done (so we're now using the correct GL context provider for llvmpipe and ignoring the blacklist) we can proceed to the code where we actually load the OpenGL library and create a OpenGL context. That code is in different files depending on the OS. If you can't test on all OSes, it's fine to only do yours.
Windows: http://hg.mozilla.org/mozilla-central/file/tip/gfx/gl/GLContextProviderWGL.cpp
Mac: http://hg.mozilla.org/mozilla-central/file/tip/gfx/gl/GLContextProviderCGL.mm
Linux: http://hg.mozilla.org/mozilla-central/file/tip/gfx/gl/GLContextProviderGLX.cpp
Look for where we're setting the filename of the library we're opening. For example, on Windows it's
  http://hg.mozilla.org/mozilla-central/file/1c3b291d0830/gfx/gl/GLContextProviderWGL.cpp#l141
There, you want to read the webgl.use-llvmpipe preference again (yes, that's not super efficient, if needed we'll optimize that later). Use again Preferences::GetBool; you might need to add a #include ""mozilla/Preferences.h"" for it.
The filename is up to you; it should probably be different from the system default (e.g. not opengl32.dll) otherwise AFAICS we won't be able to choose one over the other.
*** Part 4. Wrap this as a Firefox add-on ***
I'm not competent with that part. We'll have to find another mentor when we're there.
*** Next steps ***
Once we're there, we'll want to see how we can get Gecko to automatically download Mesa llvmpipe when needed. We don't want to ship it with the standard Firefox build, as that would inordinately increase the Firefox download size.",POTENTIAL_SOLUTION_DESIGN,1,80_PCT_MATCH
731836,2,"I volunteer as a mentor for part 4+.
That said, I'm not sure to understand what you meant by ""Wrap this as a Firefox add-on"" if ""this"" are the previous parts, modifying existing native built-in implementations, which is something an add-on cannot do afaik.
Otoh, the subsequent ""automatically download llvmpipe if needed"" would imho really fit as a feature of the add-on rather than of Gecko (the add-on possibly being bundled in Firefox at a later stage).
IMHO it could be nice (and perhaps even simpler/cleaner in the end) to expose a generic ""add-on aware"" mechanism to specify a fallback GL implementation at context creation time (ie. no 'llvmpipe' reference in Gecko, not even as a pref name).
An add-on could provide LLVMpipe fallback but another add-on could provide another alternative software implementation as easily (possibly Transgaming could even release a SwiftShader add-on).
The add-on would also have the possibility of forcing a reduced size drawing buffer as it sees fit.
It could work by implementing a simple WebGLContextProviderFallbackService XPCOM interface like :
interface nsIWebGLContextFallbackProviderService {
  registerFallbackProvider(in WebGLContextFallbackProvider provider);
  unregisterFallbackProvider(in WebGLContextFallbackProvider provider);
  [noscript] WebGLContextFallbackProvider tryFallbackProviders(in DOMCanvasElement canvas);
}
/* this is an interface declaration only, it's up to the fallback add-on(s) to implement this */ 
interface nsIWebGLContextFallbackProvider {
  bool canProvideFallbackForCanvas(in DOMCanvasElement canvas);
  readonly DOMString providerName;     // ""wgl"", ""cgl"", ""glx"" or ""egl""
  readonly DOMString nativeLibraryPath;// eg. ""c://win/system32/my_egl.dll""
  readonly DOMString glLibraryPath;    // eg. ""c://win/system32/my_gles_v2.dll""
  readonly long drawingBufferWidth;    // eg. same as canvas.width
  readonly long drawingBufferHeight;   // eg. same as canvas.height
}
tryFallbackProviders implementation:
1) for each registered WebGLContextFallbackProvider, in reverse order of registration:
  2) call canProvideFallbackForContext with the given canvas argument
  3) if the call returned true, break the loop at 1 and return the current WebGLContextFallbackProvider
4) return null
In GLContextProvider interface, append 2 optional string arguments nativeLibraryPath and glLibraryPath to CreateOffscreen().
static GLContextProvider::GetInstance(providerLibraryPath = nsnull, glLibraryPath = nsnull)
In setDimensions(), append the following steps when context creation failed :
1) call WebGLContextFallbackProviderService.tryFallbackProviders(canvas) and store the return value in local ""provider""
2) if ""provider"" is not null, attempt to create a context, using the GLContextProvider interface specified by provider.providerName (eg. GLContextProviderWGL if ""wgl"") and the provider desired attributes. eg:
''
gl::GLContextProviderWGL::CreateOffscreen(gfxIntSize(provider.drawingBufferWidth, drawingBufferHeight), format, provider.nativeLibraryPath, provider.glLibraryPath);
''  
Thoughts?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
731836,3,"Indeed, I was a bit unclear. I think that parts 1--3 should ship directly in Gecko. What can't ship in Gecko, is llvmpipe itself, because that would be too big (I'm worried about the Firefox download size). So we would ship parts 1--3 in Gecko itself, and wrap llvmpipe in an add-on that also has the effect of turning on the webgl.use-llvmpipe preference. Does that make sense?
The rest of what you write is super interesting, but needs to be moved to a separate bug, depending on this one, ""automatically download llvmpipe when needed for WebGL software rendering"". I would like to keep the present mentored bug not too big and not too scary.
In fact, step 4. could already be a separate bug.",NEW_ISSUE_FILING,0,FULL_TOKEN
731836,4,To be even more clear: only Part 3 is about changes to be made directly in Gecko.,CLARIFICATION,0,FULL_TEXT
731836,5,"I filed bug 731983 about part 4, so the present bug is now focused on building llvmpipe and adding the preference to use it.",NEW_ISSUE_FILING,0,FULL_TEXT
731836,6,Willing to take a shot at this if just to have an excuse at building an add-on :-),DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
731836,7,Excellent! I'll try to assist you through step 3 (add preference) and then you'll be off to bug 731983 with Cedric for the add-on work. (And then if you're still alive we'll think about how to have Firefox automatically download it when needed.),DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
731836,8,"I have been able to build the llvmpipe and get Firefox to use it. However, in running the conformance tests, there were several failures-100s. Is that okay? Also, in getting the demos were a lot slower to run than using ANGLE 1.0.0.930. Is that to be expected as well?",QUESTION,0,FULL_TEXT
731836,9,"Failures are unsurprising, though 'hundreds' is higher than I would guess. Could you detail how you got firefox to use it, so we could take a look?
llvmpipe should be considerable slower than ANGLE, since ANGLE is nearly at parity with native GL performance.",ANSWER_TO_QUESTION,0,FULL_TEXT
731836,10,"Regarding performance, as Jeff says of course a software renderer is slower than hardware-accelerated rendering (even with ANGLE) but we saw OpenArena running very smoothly on llvmpipe on a fast Intel CPU so we know it can be good enough to be worthwhile.
One thing though, is that software renderers will tend to be more fillrate-limited than GPUs. That means that they would benefit more from lowering the resolution, than GPUs would.",CLARIFICATION,0,FULL_TOKEN
731836,11,Sorry for the delay with my responses. I had to get a new laptop to work on. I will rebuild the llvmpipe and detail the steps accordingly.,STATUS_UPDATE,0,FULL_TEXT
731836,12,"Hit a snag getting firefox to work with this particular graphics card although after following the exact same steps i got it working previously on a different machine. With this particular card, it defaults to a different webgl renderer: 
Intel -- Intel(R) HD Graphics Family -- 3.1.0 - Build 8.15.10.2538.
//=====Current Graphics Card===========
Adapter Description  Intel(R) HD Graphics Family
Vendor ID  8086
Device ID  0126
Adapter RAM Unknown 
Adapter Drivers igdumd64 igd10umd64 igd10umd64 igdumdx32 igd10umd32 igd10umd32
Driver Version 8.15.10.2538
Driver Date9-26-2011 
Direct2D Enabled true
Direct Write Enabled true(6.1.7601.17776)
ClearType Parameters ClearType parameters not found
WebGL Renderer Google Inc. -- ANGLE (Intel(R) HD Graphics Family) -- OpenGL ES 2.0 (ANGLE 1.0.0.930) 
GPU Accelerated Windows 1/1 Direct3D 10
AzureBackend direct2d
Steps to Build llvmpipe:
========================
Download LLVM 2.9 source
Download CMake and install. Ensure it's added to PATH
Create a new build folder for llvm. 
c:\llvm_build>cmake -DVARIABLE=value ..\llvm-2.9 -DLLVM_USE_CRT_DEBUG=MTd  -DLLVM_USE_CRT_RELEASE=MTd -DLLVM_TARGETS_TO_BUILD=X86
G option not needed as it recognizes installed compiler.
Alternatively you use the CMake-Gui to make changes to entry variables:
LLVM_USE_CRT_RELEASE=MTd
LLVM_USE_CRT_DEBUG=MTd
Configure and generate files. 
Add environment variable to point to LLVM installation and add to PATH.
This should be: C:\Program Files (x86)\LLVM
Open Visual Studio, Go to Configuration Manager for the LLVM.sln and check that INSTALL is built for both release and debug options.
Build the solution with INSTALL set as startup project.
Download scons(zip file). unzip to C:
run these commands:
# cd scons-2.1.0
# python setup.py install
 
Download and extract Mesa3d.
Mingw installation required for this:
Install msys-flex and msys-bison using this command: mingw-get install msys-flex msys-bison.
Add mingw\bin and msys\bin to PATH
change to the folder for mesa 3d
run either:
c:\Mesa-8.0.2>scons llvm=yes build=debug machine=x86 opengl32
  OR 
c:\Mesa-8.0.2>scons build=debug machine=x86 libgl-gdi
[Important: make a copy of the existing opengl32.dll in the system folder]
 
Copy the opengl32.dll from Mesa's build directory to C:\Windows\System32. 
You will have to modify the permissions on the existing opengl32.ll there to replace. 
First change ownership of the dll to yourself and then assign full rights. 
If the dll is being used by another process, use -say Process Explorer-to locate and kill it, before copying.",PROBLEM_REVIEW,0,FULL_TOKEN
731836,13,"That means it's using the Intel OpenGL driver. If you put Mesa's DLL in the same directory as the firefox executable, does it find it? Otherwise, here's what you can try:
 - search for all files named opengl32.dll on your system
 - edit gecko source code to replace ""opengl32.dll"" by ""mesallvmpipe.dll"", rename Mesa's binary to that, so that it will only be able to find it and not the system opengl library. That's actually, probably, a step we want to take anyway, as described in comment 0, so that we can dynamically choose between mesa and system opengl.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
731836,14,It does.,ANSWER_TO_QUESTION,0,FULL_TEXT
731836,15,"With llvmpipe, some of the demos are either totally ""off-color"" or mostly black. I guessed that should be expected. Examples of such are: http://www.chromeexperiments.com/detail/waterstretch/?f=webgl and http://blackberry.github.com/WebGL-Samples/tunneltilt/. Also i failed to mention that attempting to build llvmpipe with LLVM 3.0 doesn't work - still trying to figure that out as it ought to be possible.",PROBLEM_REVIEW,0,FULL_TEXT
731836,16,"I should think that the demos should be accurately rendered. Make sure you're not also using accelerated layers. Also, try some of the very simple demos such as those at SpiderGL.",PROBLEM_REVIEW,0,FULL_TEXT
731836,17,"What Jeff said, plus: do not hesitate to ask Mesa devs for help, the mesa-dev mailing list is already aware of this effort and probably full of people who could help you; mesa devs also respond to bug reports at freedesktop.org.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
731836,18,"Created attachment 613023
patch
State of patch before our discussion on IRC.",CODE_IMPLEMENTATION,1,FULL_TEXT
731836,19,"Comment on attachment 613023
patch
Review of attachment 613023:
-----------------------------------------------------------------
::: content/canvas/src/WebGLContext.cpp
@@ +379,5 @@
As discussed on IRC, I think we should always refer to it as 'Mesa LLVMpipe', not just 'LLVMpipe'. Both in the pref name and the variable.
Indeed:
 - llvmpipe alone doesn't give Mesa enough credit,
 - mesa alone isn't specific enough since on Linux, most people use Mesa with their GPU, just not with the llvmpipe driver.
@@ +489,5 @@
We can do better/simpler than that, without hardcoding WGL here.
Just GLContextProvider will give you the default context provider on the current platform. On Windows, it gives you GLContextProviderWGL. We already do that below, but only after we try EGL which is what we do by default on Windows (ANGLE rendering uses the EGL path).
Just edit this part:
    if (PR_GetEnv(""MOZ_WEBGL_FORCE_OPENGL"")) {
        preferEGL = false;
        useANGLE = false;
        useOpenGL = true;
    }
and add
    useMesaLlvmpipe ||
in that if() condition. This way, enabling llvmpipe will cause ANGLE to be disabled and thus we'll skip straight to the desktop OpenGL path.
@@ +491,5 @@
Mesa LLVMpipe.
::: gfx/gl/GLContextProviderWGL.cpp
@@ +136,5 @@
Good call. This way, if we have a surge of crashiness correlated with llvmpipe usage, we'll know that these people did something nonstandard.
We'll want to revert that, though, if/when we automatically use llvmpipe.
@@ +150,5 @@
Please factor out this code by doing e.g.
   const char *libGLfilename = useMesaLlvmpipe ? ""mesallvmpipe.dll"" : ""opengl32.dll"";
Don't worry about outputting a different NS_WARNING, it's not a sufficient reason to avoid factoring this code.",CODE_REVIEW,0,FULL_TOKEN
731836,20,"I've been tinkereing with building and using llvmpipe with firefox on Linux. I've not had any trouble building it against LLVM 3.0. I just built LLVM 3.0, put it in my $PATH and built Mesa 8.0.2 against it. Using LLVM 3.0 also fixes some rendering bugs I was seeing with LLVM 2.8.
Slightly off topic, and maybe something for another bug report, but, I've also hacked my version of Mesa to fast path glReadPixels. With Mesa 8.0.2 the developers significantly improved the performance of glReadPixels. Problem is, the performance boost for llvmpipe is for BGRA data only. Firefox seems to read RGBA data, so it doesn't benefit at all. I bodged the code to force a fast path for RGBA data. My patch regresses BRGA performance (and rendering) but boosts RGBA performance (on my machine) by up to 850%.
Before (stats from mesa-demos-8.0.1/src/perf/readpixels):
glReadPixels(10 x 10, RGBA/ubyte): 12002.9 images/sec, 4.6 Mpixels/sec
glReadPixels(100 x 100, RGBA/ubyte): 2229.7 images/sec, 85.1 Mpixels/sec
glReadPixels(500 x 500, RGBA/ubyte): 109.8 images/sec, 104.7 Mpixels/sec
glReadPixels(1000 x 1000, RGBA/ubyte): 27.8 images/sec, 106.2 Mpixels/sec
glReadPixels(10 x 10, BGRA/ubyte): 12760.1 images/sec, 4.9 Mpixels/sec
glReadPixels(100 x 100, BGRA/ubyte): 11959.1 images/sec, 456.2 Mpixels/sec
glReadPixels(500 x 500, BGRA/ubyte): 5736.7 images/sec, 5470.9 Mpixels/sec
glReadPixels(1000 x 1000, BGRA/ubyte): 567.0 images/sec, 2162.9 Mpixels/sec
After:
glReadPixels(10 x 10, RGBA/ubyte): 12226.9 images/sec, 4.7 Mpixels/sec
glReadPixels(100 x 100, RGBA/ubyte): 8047.2 images/sec, 307.0 Mpixels/sec
glReadPixels(500 x 500, RGBA/ubyte): 973.4 images/sec, 928.3 Mpixels/sec
glReadPixels(1000 x 1000, RGBA/ubyte): 250.5 images/sec, 955.5 Mpixels/sec
glReadPixels(10 x 10, BGRA/ubyte): 12291.1 images/sec, 4.7 Mpixels/sec
glReadPixels(100 x 100, BGRA/ubyte): 8287.3 images/sec, 316.1 Mpixels/sec
glReadPixels(500 x 500, BGRA/ubyte): 944.6 images/sec, 900.9 Mpixels/sec
glReadPixels(1000 x 1000, BGRA/ubyte): 239.9 images/sec, 915.2 Mpixels/sec
Patch (a horrible hack, but it works for firefox):
--- src/mesa/main/readpix.c     2012-04-08 18:14:38.263151001 +0100
+++ src/mesa/main/readpix.c     2012-04-08 19:30:21.811151008 +0100
@@ -209,8 +209,6 @@
    GLubyte *dst, *map;
    int dstStride, stride, j, texelBytes;
 
-   if (!_mesa_format_matches_format_and_type(rb->Format, format, type))
-      return GL_FALSE;
 
    /* check for things we can't handle here */
    if (packing->SwapBytes ||
@@ -240,10 +238,19 @@
    }
 
    texelBytes = _mesa_get_format_bytes(rb->Format);
+
+   uint32_t dst_off=0,map_off=0;
+   uint32_t k;
+
    for (j = 0; j < height; j++) {
-      memcpy(dst, map, width * texelBytes);
-      dst += dstStride;
-      map += stride;
+      for(k=0;k<width * texelBytes;k=k+4){
+         dst[dst_off+k+2]=map[map_off+k+0];
+         dst[dst_off+k+1]=map[map_off+k+1];
+         dst[dst_off+k+0]=map[map_off+k+2];
+         dst[dst_off+k+3]=map[map_off+k+3];
+      }
+      dst_off += dstStride;
+      map_off += stride;
    }
 
    ctx->Driver.UnmapRenderbuffer(ctx, rb);",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
731836,21,"Depends, but here, we're talking about software compositing, Firefox uses Cairo for that, which wants BGRA. We actually pay for the conversion cost between RGBA and BGRA. So if we have an interface somewhere that wants RGBA, that means we're paying the conversion twice. Very interesting stuff, but please move it to a separate bug to keep the conversation tractable.",SOLUTION_REVIEW,1,FULL_TEXT
731836,22,"Thought so, I've opened bug 743585 .",NEW_ISSUE_FILING,0,FULL_TEXT
731836,23,"Back to the patch. Another issue, that I wasn't aware of when I filed the bug, is that preferences should only be accessed from the main thread. The problem is that GL contexts can be created from outside the main thread; even if it's not actually going to happen here now (WebGL is entirely on the main thread) it's still worth fixing.
Fortunately there is a simple fix that will also resolve the issue, mentioned in comment 0, that it's not great to be reading that preference twice. See what is done by the main patch in bug 686735: read the preference in gfxPlatform initialization (which happens on main thread), make it available from there by an inline getter so it's super cheap to access. User code will have to #include ""gfxPlatform.h"".",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
731836,24,"This wont be applicable as the old value is what will be read if the pref is changed after initialization. Unfortunately,the pref will have to be read again to determine which loaded library to use.",SOLUTION_REVIEW,1,FULL_TEXT
731836,25,"Here is another solution: the problem here is that GLContext creation can happen off the main thread, but on the other hand, WebGL context creation can only happen on the main thread, so that is a great place to read the llvmpipe pref. Just find a way to pass that info to GLContext creation. I think the right way is to make that a new flag as in GLContext::ContextFlags. In WebGLContext.cpp, when calling CreateOffscreen, you could pass such a new flag to indicate that you want llvmpipe rendering.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
731836,26,"Created attachment 616963
patch v1
Made changes to handle the loading of an addtional library, Mesallvmpe.dll. In addition, i am currently running tests to provide performance comparison to Chrome using both fraps and the phoronix test suite.",CODE_IMPLEMENTATION,1,FULL_TEXT
731836,27,"Comment on attachment 616963
patch v1
Review of attachment 616963:
-----------------------------------------------------------------
It's great to see this progress and unfortunate that GLContextProviderWGL is so poorly designed. R- mostly so we can discuss a different approach to working around GLContextProviderWGL crappiness.
::: content/canvas/src/WebGLContext.cpp
@@ +379,5 @@
let's keep preferences all lowercase. you can add more dashes to separate words (maybe between mesa and llvmpipe).
::: gfx/gl/GLContext.h
@@ +574,5 @@
I would always say 'LLVMPipe' not just LLVM: LLVMPipe is the real name of that driver while LLVM is a general compiler project used in many places.
::: gfx/gl/GLContextProviderWGL.cpp
@@ +54,5 @@
Can we have enum values instead of #defines?
(But see below about gCurrLib, I'm proposing a different design)
@@ +59,2 @@
Instead of hardcoding 2, give it a name like GLLibrariesCount.
(But see below about gCurrLib, I'm proposing a different design)
@@ +61,2 @@
I have to say, I didn't know that we had all these global variables in this file (like gSharedWindow).
This makes it hard to find a solution that will really work, and will allow dynamic switching to/from llvmpipe.
Your solution seems like it only works as long as only one WGL library is in use at a given time (why else would there be a global variable named gCurrLib).
Let me propose that for the short term, we just require that only one WGL library will be used for the whole run of the application. So in the first context creation (maybe in WGLLibrary::EnsureInitialized or in some constructor), record the WGL library type (real opengl or mesa llvmpipe) and in subsequent calls, compare the new library type to the recorded one and fail context creation if they're different.
Indeed, the rationale is that if native OpenGL ever succeeds, there should be no reason to use llvmpipe, and if native OpenGL fails, we have no choice but to use llvmpipe.
Then, the better solution, that will allow dynamic switching between native OpenGL and llvmpipe, will consist in refactoring this GLContextProviderWGL.cpp file to get rid of these global variables.
::: gfx/thebes/gfxPlatform.cpp
@@ +336,5 @@
Please avoid whitespace changes far away from code you edited. Makes hg annotate harder to use.
::: gfx/thebes/gfxPlatform.h
@@ +455,5 @@
Same.
::: modules/libpref/src/init/all.js
@@ +3432,5 @@
lowercase for preferences.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
731836,28,"The global variables present enforces this behavior so as to ensure the correctness of the loaded library. Refactoring, will obviously remove this. 
 
Does this imply that on a system where native OpenGL will succeed, if the use-mesa-llvmpipe pref is set to true, the preference should be ignored and the Opengl library loaded instead? Also what about the converse scenario? Do we force load the mesa-llvmpipe library even if the pref is still defaulted to false?",QUESTION,0,FULL_TEXT
731836,29,"Good question. I think that we definitely should let the use-mesa-llvmpipe preference force usage of llvmpipe even if native OpenGL would succeed. So that means that when use-mesa-llvmpipe is true, we should always use Mesa llvmpipe for all OpenGL (non-EGL) contexts and switch WebGL to using OpenGL (non-EGL) as well. Since that means that that preference affects more than just WebGL, how about renaming it to gfx.use-mesa-llvmpipe? Or maybe gfx.prefer-mesa-llvmpipe as I think it should silently revert to native OpenGL is mesa-llvmpipe is not found.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
731836,30,"Created attachment 622105
patch
Refactored GLContextProviderWGL.cpp: moved dependent global variables for loaded libray to WGLLibrary.h. I avoided making changes to initialization logic so as to be consistent with other GLContextProviders{EGL, OSMesa...} Also, since GL contexts can be created off the main thread, i added events to check the Mesa LLVMpipe preference at places where a GLContext can be created via a call to GLContextProviderWGL::CreateForWindow.",CODE_IMPLEMENTATION,1,FULL_TEXT
731836,31,"Comment on attachment 622105
patch
Review of attachment 622105:
-----------------------------------------------------------------
Sorry, there still is something significant I'm not sure I agree with (scroll down to mLibType).
::: gfx/gl/GLContextProviderWGL.cpp
@@ +59,5 @@
If this function returned a WGLLibrary::LibraryType, you wouldn't have to cast to PRUint32.
If you do return a plain integer type as opposed to an enum type, why not return just |int|? You don't need to explicitly have it 32bit unsigned.
Nit: I would put the ? and : on new lines, as proposed in mfbt/STYLE:
  = condition
    ? xxx
    : yyy;
@@ +140,2 @@
Multi-line please, with style proposed above.
@@ +141,5 @@
Why 35 ? :-)
@@ +142,5 @@
Suggest you use strncat here.
@@ +408,5 @@
That's the part I don't understand:
Didn't we agree earlier that we could make the restriction that only one WGL library type can be used for the entire browser run?
So I expected that something that mLibType wouldn't be needed and you could accordingly make substantial simplications in all the places where it's currently used.
Sorry for having taken so long for this review. Let's nail this point and land this patch asap!",CODE_REVIEW,0,FULL_TOKEN
731836,32,"Comment on attachment 622105
patch
IRC discussion -> sorry for self contradicting myself (see comment 26) on whether we want dynamic switching. Will finish the review asap.",CODE_REVIEW,0,FULL_TEXT
731836,33,"Continued the review; the cost, in terms of code complexity, to allow dynamic switching, is really huge. It will have to be done again for each other context provider. I think I'm back to the opinion I had in comment 26: that allowing dynamic switching is not worth the hassle.
Other things to consider: even allowing this dynamic switching, certain things won't work in full generality. For example, the global context is meant to allow resource sharing across contexts, but it won't work across different GL libraries.",CODE_REVIEW,0,FULL_TOKEN
731836,34,"Err, I mean in comment 30. Sorry for the confusion.",CLARIFICATION,0,FULL_TEXT
731836,35,"Created attachment 627255
patch
Restriction to use only one library for duration of browser run.",CODE_IMPLEMENTATION,1,FULL_TEXT
731836,36,"Created attachment 627293
patch
Added missing namespace qualifiers.",CODE_IMPLEMENTATION,1,FULL_TEXT
731836,37,"Comment on attachment 627293
patch
Review of attachment 627293:
-----------------------------------------------------------------
So, after our conversations today (IRC + skype) and reading this patch, I understand a bit more than before --- sorry I've been a bit slow to understanding this: the added complexity to support dynamic switching is actually not that big, since the majority of that is just the changes to move global variables into members of the WGLLibrary singleton, which is a good change anyway. So, I agree again that dynamic switching is a good idea :-) sorry... this time I shouldn't change my opinion again anymore.
So we're very near r+ here, I would just like these changes:
 1. revert to allowing dynamic switching
 2. only read the llvmpipe preference in WebGL context creation, let every other place create OpenGL contexts with default flags (so, no LLVMpipe) regardless of the preference. Indeed, LLVMpipe is only really useful for WebGL. For Layers, using OpenGL layers with LLVMpipe won't be faster than BasicLayers. We will simply have to ensure that the interop between WebGL/LLVMpipe and BasicLayers works efficiently (i.e. we'll have to ensure that we read back the pixels in LLVMpipe's native format).
     -> bonus: this means that you won't have to deal anymore with reading preferences outside of the main thread.
Some nits below:
::: content/canvas/src/WebGLContext.cpp
@@ +370,5 @@
Right, and as we discussed, this should actually be the only place where we read this pref, since only WebGL is interested in LLVMpipe.
@@ +530,5 @@
GenerateWarning actually takes varargs so you could do %s here. Up to you.
::: gfx/gl/GLContextProviderWGL.cpp
@@ +29,5 @@
Suggestion: align ? and : with aFlags.
@@ +116,2 @@
I would just say OpenGL here. Mesa is a special case of it. Mention of Mesa LLVMpipe will be surprising if we ever start using system OpenGL more widely.
@@ +407,5 @@
Nit: Given that the choice is between ContextFlagsMesaLLVMPipe and None, the type I would check for is the LLVMPIPE one.",CODE_REVIEW,0,FULL_TOKEN
731836,38,"Side notes:
 - OpenGL layers with WGL don't work at the moment anyway. This would be interesting to fix, but not likely to be used in practice.
 - a LayerManager only gets created when a new window is opened, so there wouldn't really be dynamic switching to/from LLVMpipe for Layers, even if Layers supported LLVMpipe.",CLARIFICATION,0,FULL_TOKEN
731836,39,"Created attachment 629029
patch
Reversion to dynamic switching.",CODE_IMPLEMENTATION,1,FULL_TEXT
731836,40,"Comment on attachment 629029
patch
Review of attachment 629029:
-----------------------------------------------------------------
Wonderful!
Just one nit. Please address it and I'll land it for you? Unless you have L3 access already?
::: gfx/gl/GLContextProviderWGL.cpp
@@ +27,4 @@
Couldn't this function return a WGLLibrary::LibraryType instead of a plain int?
Also, I feel that it should be a static method in WGLLibrary instead of a global function. Or if you keep it a global function, at least make its name more specific than mozilla::gl::SelectLibrary. Mention WGL.",CODE_REVIEW,0,FULL_TOKEN
731836,41,"Created attachment 629353
updated_patch
Made SelectLibrary a static function of WGLLibrary and typedef'd WGLLibrary::Library. 
Just L1 for now.",CODE_IMPLEMENTATION,1,FULL_TEXT
731836,42,"OK, will try landing your patch this weekend so it'll hopefully be in Firefox 15.
Try:
https://tbpl.mozilla.org/?tree=Try&rev=f85aa503c34a",STATUS_UPDATE,0,FULL_TOKEN
731836,43,Rebased and sent to Try: https://tbpl.mozilla.org/?tree=Try&rev=001f918d9089,UNCODED,0,UNMATCHED
731836,44,http://hg.mozilla.org/integration/mozilla-inbound/rev/ffcc51500617,UNCODED,0,UNMATCHED
731836,45,https://hg.mozilla.org/mozilla-central/rev/ffcc51500617,UNCODED,0,UNMATCHED
731836,46,"Hey, I haven't had much luck trying to build Mesa llvmpipe on Windows following Comment 11.
Could anyone share 32bit and 64bit, optimized, non-debug builds of Mesa llvmpipe? Or we could ask on mesa-dev for that.",QUESTION,0,FULL_TEXT
731836,47,"  That's odd since i used it for the debug build of llvmpipe. 
I'll follow this up on the mesa-users mailing list.",ANSWER_TO_QUESTION,0,FULL_TEXT
731836,48,"Specifically, my problem was that when I tried to build with the cmake configuration from comment 11, the MSVC 2010 compiler crashed trying to compile LLVM. (got Windows popup dialogs about process crashes for the MSVC compiler).",CLARIFICATION,0,FULL_TEXT
731836,49,"Btw you're right, mesa-users sounds like the better mailing list for that.",CLARIFICATION,0,FULL_TEXT
731836,50," (In reply to Benoit Jacob [:bjacob] from comment #47)
Oh seems you attempted a release build per the instructions in comment 11. I should have said that that was specifically for creating debug builds. Yet to have a proper working release build myself- crashes after the context is created in the few spiderGL demos i tried. The debug versions didn't have a problem with those. Obviously, i am linking the CRT libraries wrongly. Until we get a proper handle on creating the optimized builds perhaps it will be good to put a blocker on this bug..??",QUESTION,0,FULL_TEXT
731836,51,"Ah, indeed I was trying to make a release build.
Technically this bug is fixed regardless of whether we manage to build Mesa (!!) but ""make 32 and 64 bit optimized Mesa llvmpipe / Windows builds"" is definitely worth a bug, and should then block the other bug about making it an add-on.",CLARIFICATION,0,FULL_TOKEN
731836,52,"From the feedback I got on the mesa-users mailing list, i was building the release version correctly. I had been using LLVM_USE_CRT_RELEASE=MT  and LLVM_USE_CRT_DEBUG=MTd (thought i needed extra options). So with this, the crash issue i mentioned in comment 49 indicates the problem lies elsewhere. Example demo is: http://spidergl.org/example.php?id=11.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
738440,1,"WebKit supports it, and it makes sense, so I specced it.  The spec requires non-support of state for useCSS.",PROBLEM_MOTIVATION,0,FULL_TOKEN
738440,2,"Created attachment 608478
Patch v1
I think the old behavior was just a bug.  The code set STATE_ATTRIBUTE to a boolean, but it's supposed to be a string.  So when QueryCommandValue() tried retrieving ""state_attribute"" as a string, it found nothing.  And when QueryCommandState() tried retrieving ""state_all"" as a boolean, it also found nothing.  All this just demonstrates that the code here is sufficiently confusing that it baffled the people who wrote it . . .
I had to add a special case for useCSS, because the spec says queryCommandState() shouldn't be supported for it.  It's legacy cruft, and I want to support as few features as possible for it.  Plus, we'd need a special case for it anyway, because we'd have to invert the return value if it were to make any sense.",CODE_IMPLEMENTATION,1,FULL_TOKEN
738440,3,"Autoland Patchset:
	Patches: 608478
	Branch: mozilla-central => try
	Destination: http://hg.mozilla.org/try/pushloghtml?changeset=4c9d8f3ff72d
Try run started, revision 4c9d8f3ff72d. To cancel or monitor the job, see: https://tbpl.mozilla.org/?tree=Try&rev=4c9d8f3ff72d",UNCODED,0,UNMATCHED
738440,4,"Comment on attachment 608478
Patch v1
Review of attachment 608478:
-----------------------------------------------------------------
r=me, but I think you should also modify http://mxr.mozilla.org/comm-central/source/mozilla/content/html/content/test/test_bug408231.html.",CODE_REVIEW,0,FULL_TEXT
738440,5,"Try run for 4c9d8f3ff72d is complete.
Detailed breakdown of the results available here:
    https://tbpl.mozilla.org/?tree=Try&rev=4c9d8f3ff72d
Results (out of 219 total builds):
    exception: 2
    success: 171
    warnings: 32
    failure: 14
Builds (or logs if builds failed) available at:
http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/autolanduser@mozilla.com-4c9d8f3ff72d",UNCODED,0,UNMATCHED
738440,6,"Created attachment 608809
Patch v2, test failure fixed
Same as last patch, but with test_bug408231.html fixed.  I wrote the test based on bug 738366 being fixed, so it should be false rather than true.  Thus bug 738366 needs to land first, or at the same time.  This patch will conflict with the bug 738385 changes, but that's okay, it should be easy to merge.
(I don't know why queryCommandValue(""stylewithcss"") is suddenly returning the empty string instead of throwing, but it's moot, because it will do that anyway after bug 738385 lands.)",CODE_IMPLEMENTATION,1,FULL_TOKEN
738440,7,https://hg.mozilla.org/integration/mozilla-inbound/rev/cfcdf9a80f36,UNCODED,0,UNMATCHED
738440,8,https://hg.mozilla.org/mozilla-central/rev/cfcdf9a80f36,UNCODED,0,UNMATCHED
738759,1,"Created attachment 608828
Patch v1
Quite a few callers want an nsINode anyway.",CODE_IMPLEMENTATION,1,FULL_TEXT
738759,2,"Comment on attachment 608828
Patch v1
-    case nsIDOMNode::ENTITY_NODE:
-    case nsIDOMNode::ENTITY_REFERENCE_NODE:
-    case nsIDOMNode::NOTATION_NODE:
-    {
-      return NS_ERROR_NOT_IMPLEMENTED;
-    }
     default:
     {
       NS_WARNING(""Don't know how to clone this nodetype for importNode."");
 
       return NS_ERROR_DOM_NOT_SUPPORTED_ERR;
     }
This is of course an observable change in behavior here. Correct as it is, we should keep an eye out for odd fallout from this.
r=jst",CODE_REVIEW,0,FULL_TOKEN
738759,3,"How so? If it's an nsINode, it can't return any of these values through GetNodeType(). (At least, I sure hope so!) If it's not, we already threw from nsContentUtils::CheckSameOrigin(nsINode*, nsIDOMNode*).",CLARIFICATION,0,FULL_TEXT
738759,4,https://hg.mozilla.org/mozilla-central/rev/66101542ba09,UNCODED,0,UNMATCHED
752781,1,"This just started failing in the last day or two on both Windows and Linux so far.
https://tbpl.mozilla.org/php/getParsedLog.php?id=11532937&tree=Firefox
Rev3 Fedora 12x64 mozilla-central pgo test mochitests-1/5 on 2012-05-07 07:04:01 PDT for push 448f554f6acb
58629 INFO TEST-START | /tests/content/events/test/test_bug607464.html
58630 INFO TEST-INFO | /tests/content/events/test/test_bug607464.html | must wait for load
58631 INFO TEST-INFO | /tests/content/events/test/test_bug607464.html | must wait for focus
58632 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15
58633 INFO TEST-END | /tests/content/events/test/test_bug607464.html | finished in 233ms",PROBLEM_DESCRIPTION,0,90_PCT_MATCH
752781,2,"A more accurate time would probably be ""started failing right around the time compartment-per-global landed, along with several other scrolling-related tests, but nobody wanted to get stuck filing it.""",PROBLEM_REVIEW,0,FULL_TEXT
752781,3,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=11569409&tree=Firefox
Rev3 Fedora 12x64 mozilla-central pgo test mochitests-1/5 on 2012-05-08 06:56:22
slave: talos-r3-fed64-044
58653 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,4,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=11632841&tree=Mozilla-Inbound
Rev3 Fedora 12x64 mozilla-inbound pgo test mochitests-1/5 on 2012-05-09 22:33:22
slave: talos-r3-fed64-038
58649 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,5,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=11668760&tree=Mozilla-Inbound
Rev3 WINNT 5.1 mozilla-inbound opt test mochitests-1/5 on 2012-05-10 23:43:20
slave: talos-r3-xp-072
60239 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,6,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=11671797&tree=Firefox
Rev3 WINNT 6.1 mozilla-central opt test mochitests-1/5 on 2012-05-11 03:18:08
slave: talos-r3-w7-015
60223 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,7,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=11686241&tree=Fx-Team
Rev3 WINNT 5.1 fx-team opt test mochitests-1/5 on 2012-05-11 13:34:26
slave: talos-r3-xp-050
60194 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15
88804 ERROR TEST-UNEXPECTED-FAIL | /tests/content/html/document/test/test_bug445004.html | an unexpected uncaught JS exception reported through window.onerror - TypeError: uri.match(/^http:\/\/([a-z.0-9]*)/) is null at http://mochi.test:8888/tests/content/html/document/test/test_bug445004.html:50",UNCODED,0,UNMATCHED
752781,8,"ttaubert
https://tbpl.mozilla.org/php/getParsedLog.php?id=11701724&tree=Firefox
Rev3 Fedora 12 mozilla-central pgo test mochitests-1/5 on 2012-05-12 04:03:55
slave: talos-r3-fed-032
58660 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,9,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=11727738&tree=Fx-Team
Rev3 WINNT 6.1 fx-team opt test mochitests-1/5 on 2012-05-14 08:14:21
slave: talos-r3-w7-043
60247 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,10,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=11754689&tree=Mozilla-Inbound
Rev3 WINNT 5.1 mozilla-inbound pgo test mochitests-1/5 on 2012-05-15 00:47:00
slave: talos-r3-xp-065
60226 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,11,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=11763157&tree=Firefox
Rev3 WINNT 5.1 mozilla-central pgo test mochitests-1/5 on 2012-05-15 06:48:39
slave: talos-r3-xp-073
60261 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,12,"ryanvm%gmail.com
https://tbpl.mozilla.org/php/getParsedLog.php?id=11871534&tree=Mozilla-Inbound
Rev3 WINNT 5.1 mozilla-inbound opt test mochitests-1/5 on 2012-05-18 12:29:54
slave: talos-r3-xp-052
60702 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,13,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=11916441&tree=Mozilla-Inbound
Rev3 WINNT 5.1 mozilla-inbound pgo test mochitests-1/5 on 2012-05-21 06:58:53
slave: talos-r3-xp-021
60674 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,14,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=11922036&tree=Mozilla-Inbound
Rev3 WINNT 5.1 mozilla-inbound pgo test mochitests-1/5 on 2012-05-21 11:52:36
slave: talos-r3-xp-046
60656 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,15,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=11972884&tree=Mozilla-Inbound
Rev3 WINNT 5.1 mozilla-inbound opt test mochitests-1/5 on 2012-05-22 21:06:13
slave: talos-r3-xp-042
60694 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,16,"I'm not sure how this test worked between April 30 and May 7; as far as I can tell, the test is failing due to changeset c70f3a9b31f8.
It initiates scrolling (asynchronous but not smooth) then does a setTimeout(0) to check the results and asserts that scrolling has actually happened. However, now that AsyncScroll isn't flushed until the refresh driver runs, the setTimeout could easily happen before the refresh driver runs the AsyncScroll.",PROBLEM_REVIEW,0,FULL_TOKEN
752781,17,Could an animationframe callback initiate the setTimeout(0)?,QUESTION,0,FULL_TEXT
752781,18,"Created attachment 626341
fix test",UNCODED,0,UNMATCHED
752781,19,"Yeah, that's more or less what I'm doing.",ANSWER_TO_QUESTION,0,FULL_TEXT
752781,20,"Comment on attachment 626341
fix test
Please update the ""0-interval timer"" part in the is() comment too.  r=mats",CODE_REVIEW,0,FULL_TOKEN
752781,21,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=11987827&tree=Firefox
Rev3 WINNT 5.1 mozilla-central pgo test mochitests-1/5 on 2012-05-23 06:10:49
slave: talos-r3-xp-004
60702 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,22,"jwalden
https://tbpl.mozilla.org/php/getParsedLog.php?id=11975750&tree=Try
Rev3 WINNT 5.1 try opt test mochitests-1/5 on 2012-05-22 22:49:12
slave: talos-r3-xp-033
60694 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,23,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=12010097&tree=Firefox
Rev3 WINNT 5.1 mozilla-central opt test mochitests-1/5 on 2012-05-23 19:38:38
slave: talos-r3-xp-039
60673 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after waiting for one 0-interval timer. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,24,https://hg.mozilla.org/integration/mozilla-inbound/rev/347e2fe15b54,UNCODED,0,UNMATCHED
752781,25,https://hg.mozilla.org/mozilla-central/rev/347e2fe15b54,UNCODED,0,UNMATCHED
752781,26,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=21381700&tree=Mozilla-B2g18
Rev5 MacOSX Mountain Lion 10.8 mozilla-b2g18 opt test mochitest-1 on 2013-04-02 21:30:57
slave: talos-mtnlion-r5-027
46016 ERROR TEST-UNEXPECTED-FAIL | /tests/content/events/test/test_bug607464.html | Pixel scrolling should have finished after one refresh driver iteration. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,27,"log: https://treeherder.mozilla.org/logviewer.html#?repo=fx-team&job_id=1915482
repository: fx-team
start_time: 2015-02-06T03:56:18
who: rvandermeulen[at]mozilla[dot]com
machine: talos-mtnlion-r5-058
buildname: Rev5 MacOSX Mountain Lion 10.8 fx-team opt test mochitest-2
revision: eecd602fe207
249 INFO TEST-UNEXPECTED-FAIL | dom/events/test/test_bug607464.html | Pixel scrolling should have finished after one refresh driver iteration. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
752781,28,"log: https://treeherder.mozilla.org/logviewer.html#?repo=b2g-inbound&job_id=1420453
repository: b2g-inbound
start_time: 2015-02-27T11:20:51
who: rvandermeulen[at]mozilla[dot]com
machine: t-snow-r4-0108
buildname: Rev4 MacOSX Snow Leopard 10.6 b2g-inbound debug test mochitest-2
revision: ee5d1f234412
249 INFO TEST-UNEXPECTED-FAIL | dom/events/test/test_bug607464.html | Pixel scrolling should have finished after one refresh driver iteration. We shouldn't be scrolling smoothly, even though the pref is set. - got 0, expected 15",UNCODED,0,UNMATCHED
758103,1,"Seen with a gecko debug build on sgs2 after letting the device sit for a while charging.
I/Gecko   ( 2204): ###!!! ASSERTION: Battery API: When charging and level at 1.0, remaining time should be 0. Please fix your backend!: 'Error', file /Volumes/mac/moz/b2ggecko/dom/battery/BatteryManager.cpp, line 158",PROBLEM_DESCRIPTION,0,FULL_TOKEN
758103,2,*** Bug 785943 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
758103,3,"We should fix this, but if the UI on the hardware that we end up shipping on behaves correctly I don't see a need to block on this.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
758103,4,*** Bug 816620 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
758103,5,"Created attachment 687715
Set remaining time to 0 if battery level is 1
This is a patch based on the comments in bug 816620.
I observed this problem on the PandaBoard. In addition to fixing the actual bug, the patch cleans up the implementation of the getter function and adds handling for interrupted system calls.",CODE_IMPLEMENTATION,1,FULL_TOKEN
758103,6,"Comment on attachment 687715
Set remaining time to 0 if battery level is 1
Review of attachment 687715:
-----------------------------------------------------------------
Coding style:
Don't do:
if (foo)
  bar;
But:
if (foo) {
  bar;
}
I haven't reviewed much GetCurrentBatteryCharging() because the C-style code of this function is a bit hard to read for me.
In C++, you shouldn't need labels to close a file descriptor, you should use a guard object for that. I haven't try to find why ""out"" label is used.
Also, note that you will need a review from a Gonk peer. Putting mwu as a reviewer to make sure that happens.
::: hal/gonk/GonkHal.cpp
@@ +352,5 @@
Take a pointer. A common C++ convention is that pointers are out parameters and reference are in parameters, that way the caller can guess if this is going to be in or out.
@@ +358,5 @@
This pattern is un-familliar to me. Why do you put fopen (and later fclose) in loops?
@@ +381,5 @@
Pointers, too.
@@ +486,5 @@
aBatteryInfo->remainingTime() = dom::battery::kDefaultRemainingTime;",CODE_REVIEW,0,FULL_TOKEN
758103,7,"Hi,
And thanks so far. 
What class should I use for the guard object? I've been searching the Mozilla source code, but couldn't find anything.
I'm going to change this, but there is another convention that says to use references when the passed value cannot be NULL, and pointers when it can. That's what I had in mind here.
 
In Unix, long-running system calls might get aborted when the process receives a signal. In that case, the call fails and errno is set to EINTR. You typically don't see this in Linux, because glibc automatically restarts the system call in this case. I looked through Android's bionic libc, but couldn't find code for restarting system calls; so I added those loops to try as long as EINTR is returned (it's fairly boilerplate code). While the stdio functions are not system calls themselves, they are still affected, because they rely on system calls internally.",CLARIFICATION,0,FULL_TEXT
758103,8,"See ScopedClose: 
#include <mozilla/FileUtils.h>
https://mxr.mozilla.org/mozilla-central/source/xpcom/glue/FileUtils.h#54
Sample Usage:
https://mxr.mozilla.org/mozilla-central/source/widget/gonk/Framebuffer.cpp#141
I would be inclined to use open/read/close though so that you can use ScopedClose.
I think that ScopedClose probably also needs to be changed to deal with EINTR. I'll file a bugfor that.
There is a macro in <unistd.h> called TEMP_FAILURE_RETRY which does the loop/errno check.",ANSWER_TO_QUESTION,0,FULL_TOKEN
758103,9,"Thanks Dave, I'll have a look.
I didn't know TEMP_FAILURE_RETRY was available in bionic. I always thought this is a GNU extension.",UNCODED,0,UNMATCHED
758103,10,"Created attachment 689201
Set remaining time to 0 if battery level is 1 [v2]
This is an update to the previous patch. The major changes are the use of TEMP_FAILURE_RETRY and ScopedClose. Because of the latter, the file I/O has been rewritten to use file descriptors, and all gotos are gone.",CODE_IMPLEMENTATION,1,FULL_TEXT
758103,11,"Comment on attachment 689201
Set remaining time to 0 if battery level is 1 [v2]
Review of attachment 689201:
-----------------------------------------------------------------
r=me with the comments applied.
::: hal/gonk/GonkHal.cpp
@@ +383,5 @@
Don't pass |aChargingTime| to this method if you don't actually use it. It might give the wrong impression to the caller.
@@ +469,5 @@
I think this entire block should be something like:
int charging;
if (GetCurrentBatteryCharging(&charging)) {
  aBatteryInfo->charging() = charging;
} else {
  aBatteryInfo->charging() = true;
}
aBatteryInfo->remainingTime = dom::battery::kUnknownRemainingTime;
if (aBatteryInfo->charging() && aBatteryInfo->level == 1.0) {
  aBatteryInfo->remainingTime = dom::battery::kDefaultRemainingTime;
}
(feel free to use a ternary operator)",CODE_REVIEW,0,FULL_TOKEN
758103,12,"Comment on attachment 689201
Set remaining time to 0 if battery level is 1 [v2]
Review of attachment 689201:
-----------------------------------------------------------------
::: hal/gonk/GonkHal.cpp
@@ +352,5 @@
This function name seems to be a poor choice (the /sys file name seems to be poor as well).
To me capacity implies how much the battery is capable of holding. This seems to be returning the current charge or level of the battery.
So I'd be inclined to call it GetCurrentBatteryLevel (this matches the field names in the BateryInformation structure).
@@ +374,5 @@
Since the bulk of the above function actually also appears below, I would prefer to factor this into a helper function, Something like the two functions here:
https://mxr.mozilla.org/mozilla-central/source/dom/system/gonk/AutoMounter.cpp#99
but you'll want another version which parses a double.
The versions in AutoMounter are missing the TEMP_FAILURE_RETRY.
In fact, we should probably make these available somewhere in Gonk since they occur so frequently. we should factor these out into a common location. I created bug 819016 to do that, so I would probably just do the first level of factoring here and we can probably make your factored routines be the basis for the common routines in bug 819016
@@ +440,5 @@
The strings read will contain a trailing newline so these comparisons won't work properly.
i.e. if you do: 
adb shell
cat /sys/class/power_supply/battery/status > /data/local/batt
exit
adb pull /data/local/batt
hd batt
then you'll see something like:
00000000  46 75 6c 6c 0a                                    |Full.|
00000005
Note: If you try to combine the adb shell and cat then you'll get a CR inserted before the NL
@@ +466,5 @@
Since this is floating point, shouldn't the comparison have some small epsilon for the comparison? i.e. 0.99999 should probably be considered the same as 1.0
Picking the right epsilon will probably be tricky (perhaps taking into consideration how many decimal places we show to the user).",CODE_REVIEW,0,FULL_TOKEN
758103,13,"Thanks for the reviews!
The funny thing is that I first  named this function GetCurrentBatteryLevel, but then I thought that the use of 'capacity' on the original code might be for a reason. I'll change the naming to 'level'. :)
I'll put some helpers into this file, and we can add generic variants later. I don't want to add even more changes to this patch.
I didn't notice that during testing. Thank you.
I had a look into the encoding of floating-point numbers. Representing 1.0 seems possible. If we use an epsilon here, I'd have to use it in the upper layers as well. I was more worried about the division of (capacity = 100) by 100 really results in 1.0.",CLARIFICATION,0,FULL_TOKEN
758103,14,"Created attachment 692284
Set remaining time to 0 if battery level is 1 [v3]
V3 of the patch incorporates the reviews of previous versions.
- The remaining time is now separate from the charge level.
- I choose to rename 'GetCurrentBatteryCapacity' to 'GetCurrentBatteryCharge' instead of 'GetCurrentBatteryLevel'. This way the percentage value 'charge' is clearly distinguished from the dimension-less 'level'. Using type int for 'charge' makes the code a bit simpler.
- I also adapted the ReadSysFile functions, which simplifies the code a lot. Dave, I think there is a bug in ReadSysFile for strings. When you read 0 bytes, you access the byte before the string array when testing for '\n'. It's fixed in my copy.
- I left the floating-point comparison as it was. See my previous comments",CODE_IMPLEMENTATION,1,FULL_TOKEN
758103,15,"Comment on attachment 692284
Set remaining time to 0 if battery level is 1 [v3]
Review of attachment 692284:
-----------------------------------------------------------------
::: hal/gonk/GonkHal.cpp
@@ +385,5 @@
Shouldn't this be == 1 ?
@@ +400,5 @@
&& success
@@ +470,5 @@
The logic of the above doesn't seem right to me. 
I thought the intent was:
if charging && (battery-level >= 1.0)
   return NoTimeRemaining
The logic as coded will return NoTimeRemaining if it's not charging, which feels wrong.",CODE_REVIEW,0,FULL_TOKEN
758103,16,"I was confused. I have since discovered that remainingTime changes meaning based charging (so when charging is true, remainingTime = time until full charge, and when charging is false, remainingTime = time until battery dead)
So you can ignore that portion of my review comment and just fix the other 2 little issues.",CLARIFICATION,0,FULL_TOKEN
758103,17,"Created attachment 692886
Set remaining time to 0 if battery level is 1 [v4]
I made a similar assumption about the remaining time in my first attempt to fix the problem.
For v4 of the patch I fixed the invalid test of the scanf return value and the test for successfully reading a value from the sysfs file.",CODE_IMPLEMENTATION,1,FULL_TOKEN
758103,18,*** Bug 716211 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
758103,19,"Created attachment 692974
Set remaining time to 0 if battery level is 1 [v4]
Thanks for the reviews.",UNCODED,0,UNMATCHED
758103,20,https://hg.mozilla.org/integration/mozilla-inbound/rev/52557de563d7,UNCODED,0,UNMATCHED
758103,21,https://hg.mozilla.org/mozilla-central/rev/52557de563d7,UNCODED,0,UNMATCHED
758103,22,*** Bug 811006 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
758103,23,"Comment on attachment 692974
Set remaining time to 0 if battery level is 1 [v4]
[Approval Request Comment]
Bug caused by (feature/regressing bug #): 
User impact if declined: 
Testing completed: 
Risk to taking this patch (and alternatives if risky): 
String or UUID changes made by this patch:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
758103,24,"Please provide rationale for landing this change in the v1.x timeframe, and mark with blocking-b2g:tef? if you believe it should block v1.0.",INFO_REQUEST,0,FULL_TEXT
758103,25,"Originally, I fixed this problem on a PandaBoard, where the incorrect battery status resulted in an incorrect battery icon and status string in the settings app and status bar. With the patch applied, Gonk returns the battery status according to Battery Status API standard.
In bug 811006, the problem was triggered on a Unagi phone, so I thought this patch might be worth considering for v1. I don't think it should be a blocker, though.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): -
User impact if declined: Possibly wrong battery status in UI
Testing completed: On my phones and PandaBoard
Risk to taking this patch (and alternatives if risky): Low
String or UUID changes made by this patch: -",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
758103,26,Right now if we don't need it for 1.0.0 we're marking as tracking-b2g18 19+ and leaving the approval nom so this will be on our radar for the next v1.0-train.,CLARIFICATION,0,FULL_TEXT
758103,27,"Comment on attachment 692974
Set remaining time to 0 if battery level is 1 [v4]
Review of attachment 692974:
-----------------------------------------------------------------
Please go ahead with uplift to the tip of mozilla-b2g18 branch for v1.0.1",CODE_REVIEW,0,FULL_TEXT
758103,28,https://hg.mozilla.org/releases/mozilla-b2g18/rev/d02aa2e38f40,UNCODED,0,UNMATCHED
768901,1,"I attempted to DMD firefox with the given URL and got quite a number of double reports:
==14443== Double report of heap block 0x3F62BE20:
==14443==  Allocated
==14443==    at 0x4C284AF: malloc (vg_replace_malloc.c:267)
==14443==    by 0x74630D8: moz_xmalloc (mozalloc.cpp:54)
==14443==    by 0x7F6E76C: nsCSSStyleSheet::nsCSSStyleSheet() (mozalloc.h:200)
==14443==    by 0x7F6E7B2: NS_NewCSSStyleSheet(nsCSSStyleSheet**) (nsCSSStyleSheet.cpp:2158)
==14443==    by 0x7F46304: mozilla::css::Loader::CreateSheet(nsIURI*, nsIContent*, nsIPrincipal*, bool, bool, nsAString_internal const&, mozilla::css::StyleSheetState&, bool*, nsCSSStyleSheet**) (Loader.cpp:1202)
==14443==    by 0x7F483A1: mozilla::css::Loader::LoadStyleLink(nsIContent*, nsIURI*, nsAString_internal const&, nsAString_internal const&, bool, nsICSSLoaderObserver*, bool*) (Loader.cpp:1884)
==14443==    by 0x80BEEF6: nsStyleLinkElement::DoUpdateStyleSheet(nsIDocument*, nsICSSLoaderObserver*, bool*, bool*, bool) (nsStyleLinkElement.cpp:280)
==14443==    by 0x80BEF63: nsStyleLinkElement::UpdateStyleSheetInternal(nsIDocument*, bool) (nsStyleLinkElement.cpp:190)
==14443==    by 0x81B73DC: nsStyleLinkElement::UpdateStyleSheetInternal() (nsStyleLinkElement.h:58)
==14443==    by 0x81B6ECF: nsRunnableMethodImpl<void (nsHTMLLinkElement::*)(), true>::Run() (nsThreadUtils.h:349)
==14443==    by 0x804A914: nsContentUtils::RemoveScriptBlocker() (nsContentUtils.cpp:4879)
==14443==    by 0x8079BF4: nsDocument::EndUpdate(unsigned int) (nsDocument.cpp:3956)
==14443==  Previously reported by 'windows'
==14443==    at 0x82EEDC3: DOMStyleMallocSizeOf(void const*) (nsWindowMemoryReporter.cpp:102)
==14443==    by 0x7F6DBFC: nsCSSStyleSheetInner::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:978)
==14443==    by 0x7F6DC7A: nsCSSStyleSheet::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:849)
==14443==    by 0x8061B12: SizeOfStyleSheetsElementIncludingThis(nsIStyleSheet*, unsigned long (*)(void const*), void*) (nsDocument.cpp:9635)
==14443==    by 0x8A70A12: SizeOfElementIncludingThisEnumerator(void const*, void*) (nsVoidArray.cpp:737)
==14443==    by 0x8A71406: nsVoidArray::EnumerateForwards(bool (*)(void const*, void*), void*) const (nsVoidArray.cpp:704)
==14443==    by 0x8A71500: nsVoidArray::SizeOfExcludingThis(unsigned long (*)(void const*, unsigned long (*)(void const*), void*), unsigned long (*)(void const*), void*) const (nsVoidArray.cpp:755)
==14443==    by 0x80639D0: nsDocument::DocSizeOfExcludingThis(nsWindowSizes*) const (nsCOMArray.h:98)
==14443==    by 0x8215C0C: nsXMLDocument::DocSizeOfExcludingThis(nsWindowSizes*) const (nsXMLDocument.cpp:574)
==14443==    by 0x8061AF5: nsIDocument::DocSizeOfIncludingThis(nsWindowSizes*) const (nsDocument.cpp:9627)
==14443==    by 0x82BA622: nsGlobalWindow::SizeOfIncludingThis(nsWindowSizes*) const (nsGlobalWindow.cpp:10167)
==14443==    by 0x82EF445: CollectWindowReports(nsGlobalWindow*, nsWindowSizes*, nsTHashtable<nsUint64HashKey>*, nsIMemoryMultiReporterCallback*, nsISupports*) (nsWindowMemoryReporter.cpp:157)
==14443==  Now reported by 'windows'
==14443==    at 0x82EEDC3: DOMStyleMallocSizeOf(void const*) (nsWindowMemoryReporter.cpp:102)
==14443==    by 0x7F6DBFC: nsCSSStyleSheetInner::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:978)
==14443==    by 0x7F6DC7A: nsCSSStyleSheet::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:849)
==14443==    by 0x7F6DC34: nsCSSStyleSheetInner::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:981)
==14443==    by 0x7F6DC7A: nsCSSStyleSheet::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:849)
==14443==    by 0x8061B12: SizeOfStyleSheetsElementIncludingThis(nsIStyleSheet*, unsigned long (*)(void const*), void*) (nsDocument.cpp:9635)
==14443==    by 0x8A70A12: SizeOfElementIncludingThisEnumerator(void const*, void*) (nsVoidArray.cpp:737)
==14443==    by 0x8A71406: nsVoidArray::EnumerateForwards(bool (*)(void const*, void*), void*) const (nsVoidArray.cpp:704)
==14443==    by 0x8A71500: nsVoidArray::SizeOfExcludingThis(unsigned long (*)(void const*, unsigned long (*)(void const*), void*), unsigned long (*)(void const*), void*) const (nsVoidArray.cpp:755)
==14443==    by 0x80639D0: nsDocument::DocSizeOfExcludingThis(nsWindowSizes*) const (nsCOMArray.h:98)
==14443==    by 0x8215C0C: nsXMLDocument::DocSizeOfExcludingThis(nsWindowSizes*) const (nsXMLDocument.cpp:574)
==14443==    by 0x8061AF5: nsIDocument::DocSizeOfIncludingThis(nsWindowSizes*) const (nsDocument.cpp:9627)
==14443== Double report of heap block 0x15E68730:
==14443==  Allocated
==14443==    at 0x4C284AF: malloc (vg_replace_malloc.c:267)
==14443==    by 0x74630D8: moz_xmalloc (mozalloc.cpp:54)
==14443==    by 0x7F574CB: (anonymous namespace)::CSSParserImpl::ParseImportRule(void (*)(mozilla::css::Rule*, void*), void*) (mozalloc.h:200)
==14443==    by 0x7F50C3D: (anonymous namespace)::CSSParserImpl::ParseAtRule(void (*)(mozilla::css::Rule*, void*), void*, bool) (nsCSSParser.cpp:1510)
==14443==    by 0x7F5B967: nsCSSParser::ParseSheet(nsAString_internal const&, nsIURI*, nsIURI*, nsIPrincipal*, unsigned int, bool) (nsCSSParser.cpp:901)
==14443==    by 0x7F48972: mozilla::css::Loader::ParseSheet(nsAString_internal const&, mozilla::css::SheetLoadData*, bool&) (Loader.cpp:1611)
==14443==    by 0x7F48EBE: mozilla::css::SheetLoadData::OnStreamComplete(nsIUnicharStreamLoader*, nsISupports*, unsigned int, nsAString_internal const&) (Loader.cpp:959)
==14443==    by 0x7CFD2B4: nsUnicharStreamLoader::OnStopRequest(nsIRequest*, nsISupports*, unsigned int) (nsUnicharStreamLoader.cpp:92)
==14443==    by 0x7CD7889: nsBaseChannel::OnStopRequest(nsIRequest*, nsISupports*, unsigned int) (nsBaseChannel.cpp:713)
==14443==    by 0x7CE0AB5: nsInputStreamPump::OnStateStop() (nsInputStreamPump.cpp:555)
==14443==    by 0x7CE0D83: nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) (nsInputStreamPump.cpp:373)
==14443==    by 0x8A96589: nsInputStreamReadyEvent::Run() (nsStreamUtils.cpp:82)
==14443==  Previously reported by 'windows'
==14443==    at 0x82EEDC3: DOMStyleMallocSizeOf(void const*) (nsWindowMemoryReporter.cpp:102)
==14443==    by 0x7F64F3B: mozilla::css::ImportRule::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSRules.cpp:479)
==14443==    by 0x7F64E0D: mozilla::css::Rule::SizeOfCOMArrayElementIncludingThis(mozilla::css::Rule*, unsigned long (*)(void const*), void*) (nsCSSRules.cpp:93)
==14443==    by 0x8A70A12: SizeOfElementIncludingThisEnumerator(void const*, void*) (nsVoidArray.cpp:737)
==14443==    by 0x8A71406: nsVoidArray::EnumerateForwards(bool (*)(void const*, void*), void*) const (nsVoidArray.cpp:704)
==14443==    by 0x8A71500: nsVoidArray::SizeOfExcludingThis(unsigned long (*)(void const*, unsigned long (*)(void const*), void*), unsigned long (*)(void const*), void*) const (nsVoidArray.cpp:755)
==14443==    by 0x7F6DC17: nsCSSStyleSheetInner::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCOMArray.h:98)
==14443==    by 0x7F6DC7A: nsCSSStyleSheet::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:849)
==14443==    by 0x8061B12: SizeOfStyleSheetsElementIncludingThis(nsIStyleSheet*, unsigned long (*)(void const*), void*) (nsDocument.cpp:9635)
==14443==    by 0x8A70A12: SizeOfElementIncludingThisEnumerator(void const*, void*) (nsVoidArray.cpp:737)
==14443==    by 0x8A71406: nsVoidArray::EnumerateForwards(bool (*)(void const*, void*), void*) const (nsVoidArray.cpp:704)
==14443==    by 0x8A71500: nsVoidArray::SizeOfExcludingThis(unsigned long (*)(void const*, unsigned long (*)(void const*), void*), unsigned long (*)(void const*), void*) const (nsVoidArray.cpp:755)
==14443==  Now reported by 'windows'
==14443==    at 0x82EEDC3: DOMStyleMallocSizeOf(void const*) (nsWindowMemoryReporter.cpp:102)
==14443==    by 0x7F64F3B: mozilla::css::ImportRule::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSRules.cpp:479)
==14443==    by 0x7F64E0D: mozilla::css::Rule::SizeOfCOMArrayElementIncludingThis(mozilla::css::Rule*, unsigned long (*)(void const*), void*) (nsCSSRules.cpp:93)
==14443==    by 0x8A70A12: SizeOfElementIncludingThisEnumerator(void const*, void*) (nsVoidArray.cpp:737)
==14443==    by 0x8A71406: nsVoidArray::EnumerateForwards(bool (*)(void const*, void*), void*) const (nsVoidArray.cpp:704)
==14443==    by 0x8A71500: nsVoidArray::SizeOfExcludingThis(unsigned long (*)(void const*, unsigned long (*)(void const*), void*), unsigned long (*)(void const*), void*) const (nsVoidArray.cpp:755)
==14443==    by 0x7F6DC17: nsCSSStyleSheetInner::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCOMArray.h:98)
==14443==    by 0x7F6DC7A: nsCSSStyleSheet::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:849)
==14443==    by 0x7F6DC34: nsCSSStyleSheetInner::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:981)
==14443==    by 0x7F6DC7A: nsCSSStyleSheet::SizeOfIncludingThis(unsigned long (*)(void const*)) const (nsCSSStyleSheet.cpp:849)
==14443==    by 0x8061B12: SizeOfStyleSheetsElementIncludingThis(nsIStyleSheet*, unsigned long (*)(void const*), void*) (nsDocument.cpp:9635)
==14443==    by 0x8A70A12: SizeOfElementIncludingThisEnumerator(void const*, void*) (nsVoidArray.cpp:737)
...and more like this, but I think those illustrate the point well enough: we have memory shared by nsCSSStyleSheetInner and we're double-counting that.  Looks like the style memory reporting has to become a bit more sophisticated.",STACK_TRACE,0,FULL_TOKEN
768901,2,"I've seen these also when the error console is open, and (I think?) when multiple browser windows are open.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
768901,3,Looks like nsCSSStyleSheet::SizeOfIncludingThis assumes that it owns its mInner.  In fact multiple style sheets can share an mInner (which is then copy-on-write if there are multiple owners) -- that's why there's a sheet vs. inner separation.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
768901,4,(It should probably just check if it is the inner's mSheets[0].),POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
768901,5,*** Bug 799336 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
768901,6,"So nsCSSStyleSheetInner::mSheets holds pointers to each of the nsCSSStyleSheets that share the inner?  I see.  There will be a bit of arbitrariness in terms of who gets blamed for the memory consumption of the inner, but that seems hard to avoid and double-counting is worse.",SOLUTION_REVIEW,1,FULL_TOKEN
768901,7,"Created attachment 669799
Don't double-count shared nsCSSStyleSheetInners.
This simple patch follows dbaron's suggestion.  It removes all of DMD's
double-counting warnings for both (a) the two-window desktop browser case,
and (b) B2G.  Hurray.",CODE_IMPLEMENTATION,1,90_PCT_MATCH
768901,8,"Comment on attachment 669799
Don't double-count shared nsCSSStyleSheetInners.
s->mInner in the if condition, as long as we're using ""s"" everywhere here, and r=me",CODE_REVIEW,0,FULL_TEXT
768901,9,"One note, though: How do we decide which nsCSSStyleSheets to measure right now?  If we're not doing the ones in the caches in the css::Loader for the document, this patch can cause us to miss sheets altogether in cases when we prefetched...
I wonder whether we should avoid sticking the prefetch sheets into the table, since that can cause use to use more memory when CSSOM is used.   Maybe a followup bug on that?",CLARIFICATION,0,FULL_TOKEN
768901,10,"And definitely a followup on memory-reporting those hashtables in the loader, please!",NEW_ISSUE_FILING,0,FULL_TEXT
768901,11,https://hg.mozilla.org/integration/mozilla-inbound/rev/b275f72aba11,UNCODED,0,UNMATCHED
768901,12,"Bug 799796.
We just measure sheets in documents and the style-sheet-cache, IIRC.
Can you file that bug?  I don't understand the idea enough to write something sensible.",CODE_REVIEW,0,FULL_TOKEN
768901,13,Filed bug 799816.,NEW_ISSUE_FILING,0,FULL_TEXT
768901,14,https://hg.mozilla.org/mozilla-central/rev/b275f72aba11,UNCODED,0,UNMATCHED
768901,15,"Comment on attachment 669799
Don't double-count shared nsCSSStyleSheetInners.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): memory reporting.
User impact if declined: misleading memory reporting which will hurt understanding of B2G memory consumption.
Testing completed (on m-c, etc.): has been on m-c for 16 days without problem.
Risk to taking this patch (and alternatives if risky): minimal;  very simple patch and the code only runs when viewing about:memory or triggering a memory report dump.
String or UUID changes made by this patch: none.",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
768901,16,"Comment on attachment 669799
Don't double-count shared nsCSSStyleSheetInners.
Approving for aurora as it is low risk and help understanding memory consumption better",UPLIFT_APPROVAL,0,FULL_TEXT
768901,17,https://hg.mozilla.org/releases/mozilla-aurora/rev/f37aaa95fee3,UNCODED,0,UNMATCHED
779500,1,Implement the proposed WebFM API: https://groups.google.com/forum/?fromgroups#!topic/mozilla.dev.webapi/PraULCQntqA,PROBLEM_DESCRIPTION,0,FULL_TEXT
779500,2,"Created attachment 647940
IDLs
The attribute ""speakerEnabled"" is not introduced in the proposed API, but the feature to speaker/headset is required in V1.",CODE_IMPLEMENTATION,1,FULL_TEXT
779500,3,"Created attachment 647942
option MOZ_B2G_FM",UNCODED,0,UNMATCHED
779500,4,"Created attachment 647943
DOMFmManager, FmAdaptor and FmAntenna",UNCODED,0,UNMATCHED
779500,5,"Created attachment 647944
Fallback service",UNCODED,0,UNMATCHED
779500,6,"Created attachment 647945
Add Permissions",UNCODED,0,UNMATCHED
779500,7,"Created attachment 647946
ServiceStartup",UNCODED,0,UNMATCHED
779500,8," The patch is incomplete, the feature to toggle speaker/headset is not be implemented, it is blocked by bug 749053.",STATUS_UPDATE,0,FULL_TEXT
779500,9,"Comment on attachment 647944
Fallback service
the logic related to query speaker state and set speakerEnabled is not finished, i marked as ""TODO"" items, so the reviewer should skip this.",STATUS_UPDATE,0,FULL_TEXT
779500,10,Can you clarify what is the status of the patches with r? but no reviewer specified?  Would you like me to review those as well?,QUESTION,0,FULL_TOKEN
779500,11,"Those patches are ready to be reviewed, i just don't know who i should request, so if you would review those as well, that's great!",CODE_REVIEW_REQUEST,0,FULL_TEXT
779500,12,"I think I can review them, judging by the diffstats.  (Thanks for including those, by the way!)  I'll have a look soon.
FYI, empty review?'s are often ignored, so it's better to guess at a reviewer and ask if you guessed correctly; if you asked the wrong person, they'll usually re-assign the review to someone better.",STATUS_UPDATE,0,FULL_TOKEN
779500,13,"Comment on attachment 647942
option MOZ_B2G_FM
I don't feel comfortable reviewing these build changes -- off to a build peer.",CODE_REVIEW,0,FULL_TEXT
779500,14,"Comment on attachment 647944
Fallback service
I don't understand why dom/fm/fallback/FmService.jsm is a fallback service.  Maybe the word ""fallback"" is getting lost in translation?
The ""fallback"" service would be the one which does nothing when the FM radio is unavailable.
Am I missing something here?",CODE_REVIEW,0,FULL_TOKEN
779500,15,"Comment on attachment 647940
IDLs
I'm sorry that I have more than minor nits on this IDL, despite the fact that
we went through it on the mailing list.  I hope you won't have to make too many
big changes.
Jonas, I'd appreciate your thoughts on a few comments below.
MPL2, please.
The filename should match the name of the interface.  Also, ""FM"", not ""Fm"", please.
I also think it would be better if we called this interface nsIDOMFMRadio.  For
example, it's nsIDOMScreen, not nsIDOMScreenManager.
Shouldn't this be part of the audio API?
Nit: ""Current frequency, in MHz"".
Nit: Why is this a float, while the frequency is a double?  I'd rather use
doubles everywhere, unless there's a reason not to.
Can we add the signal strength in dBm as well, if we have that available?
Nit: Please use javadoc-like formatting for this and all the other comments in the idl files:
 /**
  * Comment comment comment.
  */
 readonly attribute foo;
There's no such thing as a ""JSON object"" -- that's just an Object in Javascript.  :)
We need to figure out what's going on with these bands.  If the goal is
to support things other than FM radio, then we shouldn't call this
nsIDOMFMManager/nsIDOMFMRadio.
My instictint is to ignore AM, which I think we're unlikely to support due to
physical constraints (the antenna needs to be large).  Then we can spec this
attribute as follows:
""Returns the band ranges supported by this FM radio.  The return
value is a list of objects, each of which indicates the band's upper and lower
limits, in MHz.  For example:
       [ {lower: 87.5, upper: 108},
         {lower: 76,   upper: 90} ]
Also, if we expose all the supported bands on this object, then it doesn't make a lot of sense to me that you can't change the current band using this object.  At the very least, we need to add an attribute which indicates what is the current band.  But IMO, if you can't select a band using nsIDOMFMRadio, we shouldn't tease you with the list of available bands, and should only give you the upper and lower limits of the currently-selected band.
We also need to give the station interval, since that changes with different bands.
Jonas and Ray, what do you think?
onsignalstrength change, perhaps?
Also, could you please add a comment here indicating how we throttle these events?
onantennaavailablechange, or onantennastatechange?  Otherwise it sounds like we're changing the antenna itself.
It's weird to have one event which fires when the antenna is plugged/unplugged but then fire a different event 
We want to support addEventListener() for these too, which means that
nsIDOMFMRadio needs to inherit from nsIDOMEventTarget.
Nit: ""If the given frequency is outside the current band range"".
I don't think it's right to say that onerror is fired ""immediately"".  Surely
you have to wait until we spin the event loop, because otherwise the following
won't work:
  let req = setFrequency(0); // error, fires req.onerror
  req.onerror = function() { dump(""An error occurred""); };
  // The dump() is never run, because onerror was already fired.
What happens if you call seekDown/seekUp while a seek is running?
It's not wrong to put builtinclass here, but it's a little odd.  khuey says:
  Typically we've added builtinclass to interfaces where if JS implemented it,
  sg:crits (i.e., critical security bugs) would result.  But feel free to
  sprinkle it liberally.
I'd probably leave it off in this case, since nsIFMAdaptor /could/ be implemented in JS with no problems.
Could you please add a comment here indicating what this interface is for?  It took me a while to figure it out.  :)
nsIFMAdaptor, please, and change the filename to match.  But I'd prefer this matched the name of the DOM interface.  What do you think about calling them nsIDOMFMRadio and nsIFMRadio?
This one is an nsIDOMEventTarget, so maybe you just forgot to put that on the other interface?
Why does this interface duplicate some (but not all) of nsIDOMFMAdaptor's properties?  I'd rather not duplicate any and just call into nsIDOMFMAdaptor when necessary.
Again, I don't think builtinclass is exactly right here.
Please add a comment indicating that this is implemented by the FM antenna service.
I don't understand why this isn't part of nsIFMAdaptor.  Even if we wanted multiple radios, I don't see how splitting out the interface like this helps us.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,16,"I'm not going to look at the remaining patches until we get this IDL actually settled, so clearing the r?'s for now.",STATUS_UPDATE,0,FULL_TEXT
779500,17,"I realize now that I probably don't have enough context to understand this interface, having read only part 1.  Maybe we can figure out the DOM interface and worry about this interface in a later round of reviews.",CODE_REVIEW,0,FULL_TOKEN
779500,18,"OK
Yep, it's better.
I just take other APIs for references to name it, for example, ContactManager, WifiManager etc.
I was told that there is no such a specific API, maybe a setting will be introduced in the future, but right now, the WebAPI have to implement it by itself.
It is float in the proposed API.
For the Otoro device, i am not sure if there is such a interface to get signal strength in dBm, i will double check with Steven who is working on the bug 749053.
OK
I think we have discussed on this in the email, AM might be covered in the future, and that's why the bandRanges object looks like: {""FM"": {""upper"": 108, ""lower"": 87.5}}.
And in v1, there is no plan to add an option to change the band in the Settings app,  so ""onbandchange"" is not introduced to the API in v1, and it is unnecessary to introduce the station interval either.
OK
Yep, the expression is not accurate.
Fail, request.onerror will be fired.
Actually, i don't quite understancd what ""builtinclass"" is used for, i implemented it without such a modifier,
when i rebased my working branch with latest m-c at one day last month, it failed to compile, then i added the ""builtinclass""
just like other idls did.
Good suggestion~
Other IDLs, such as wiki, is just a nsISupports, why? JS Component?
The interfaces of FM are implemented in C Plus Plus (you can check the patched in bug 749053 ), and i have to wrapped it into a XPCOM Object which could be called in the JS file (i.e. DOMFmManager.js).
In the very first implementation, it is for the Si4709 chip of SGS2, it's a long story ...
Anyway, i will merge it to nsIFMAdaptor.",CLARIFICATION,0,FULL_TOKEN
779500,19,"If that's the reason, we should make this a separate API.  It's not a lot more
work to make a separate API than it is to include it on the FM radio API.
If FM radio were accessible only to privileged content, then maybe I'd be OK
with a hack like this, but if we're exposing this to the world, then we should
not create bogus APIs because it's slightly easier.
But isn't this the proposed API?  I'm asking, why is the proposed API for
signal strength a float and not a double?
AM radio should not be part of the ""FM radio"" api.  If we really want to be
able to support AM in the future -- and I think that's unlikely to happen,
because AM antennas are quite large -- then we should rename this API to
""TunableRadio"" or something.  But I think designing for an unlikely eventuality
is likely a mistake.
If we want to support multiple bands then we should design bandRanges to let
you see multiple FM and multiple AM bands.  At the moment, you can only see one
FM and one AM band.  But if we're designing for future extensibility to AM, we
should also design for future extensibility to multiple FM bands, because the
latter is far more reasonable than the former.
But more to the point: We need some way for the app to know which is the
currently-selected band; apps shouldn't assume that there's only one band in
bandRanges, because that defeats the purpose.
So regardless of whether we're allowing multiple bands now or in the future, we
still need to have
  double upperFreq;
  double lowerFreq
  double channelFreqInterval;
or otherwise
  jsval currentBand;  /* {upper, lower, interval} */
so that you know what the current band is set to.  IMO, if we're not allowing
switching between bands, we should not expose bandRanges, because it's not
useful.
Why doesn't the FM radio app need the interval?  Are you expecting that the app
will have a hardcoded interval?  Or that it will always use seek()?  What if an
app wants to allow the user to manually tune the radio?
Okay, can you please document that we can never have multiple seeks going at
once, so cancelSeek cancels the one outstanding seek or otherwise fails?
	> when i rebased my working branch with latest m-c at one day last month, it
	> failed to compile, then i added the ""builtinclass""
	> just like other idls did.
What's the compile error?  I'm not totally sure what builtinclass is for
either, but khuey gave me the impression that it did not affect compilation.
Which other IDLs are you talking about?  I'm not sure what you mean by ""such as
wiki"".
nsIDOMEventTarget is the interface which adds add/removeEventListener.  If you
don't inherit from nsIDOMEventTarget, you can't do
  fmManager.addEventListener('antennachange', function() { ... });
What's confusing is, we have two FM interfaces which do almost but not quite
the same thing.  But I think I understand what's going on, and we can figure
this part out when I look at the other patches.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,20,"It is for sure that the FM App should be authorized to access the WebFM API, just like other APIs like wifi.
I don't see the difference between a float and a double here, if the reason is to keep the type the same as the frequency, let me change it to double.
The FM app is designed to show a dialer, so the app need to know the band ranges, you can check this:
     https://wiki.mozilla.org/images/e/eb/B2g-fm-radio-v07.pdf
We can define the interval in a setting, just like we open a setting for the band.
xpidl.IDLError: error: interface 'nsIFmAdaptor' is not builtinclass but derives from builtinclass 'nsIDOMEventTarget', /home/pzhang/work/mozilla-central-fm-otoro-ics/dom/fm/nsIFmAdaptor.idl line 10:0
interface nsIFmAdaptor : nsIDOMEventTarget {
It is ""wifi"", sorry for the typo.",ANSWER_TO_QUESTION,0,FULL_TOKEN
779500,21,"What I meant was, the security discussion indicated that WebFM will be
available implicitly to all apps and (with a prompt) to any webpage.
Since this API will be so widely accessible, I don't think we should add hacks
like ""speaker on"" to this API.
https://wiki.mozilla.org/WebAPI/Security/FMRadioAPI
Yeah, it's a consistency argument.  We don't need 52 bits of precision for
either signal strength or FM frequency, so neither of them /needs/ to be a
double.
But double is JavaScript's natural floating-point type (it does not have a
32-bit float, except as a typed array), so in the absence of any good reason to
use a float, I think we should use a double.
I think we're not talking about the same thing.  There are two separate things here.
  * ""The current band"", which indicates the parameters (AM/FM,
    frequency upper and lower bounds, and channel interval) that the radio is
    currently using.  There is only ever one current band.
  * ""The band ranges"", which indicates all possible values that the current
    band might be set to.
The FM app needs only ""the current band"" in order to show the dialier.  It does
not need a list of all band ranges that the FM chipset supports.
But apps implementing an FM radio cannot necessarily read settings.  The
settings API is not available to unprivileged web content (or even many apps).
If the FM app were able to read settings, then we would not need to expose ""the
current band"" to the FM app; we could define that information in the settings,
too.  In fact, we would not need the FM API at all; we could define everything
about this API in the settings.
That settles that, then.  :)
Ah, I remember this now.
As you discovered, nsIDOMEventTarget is a builtinclass.  That means that if
nsIDOMFMRadio inherits from nsIDOMEventTarget, you can't implement it in JS.
That's probably why nsIDOMWifiManager doesn't inherit from it.
But if you don't inherit from nsIDOMEventTarget, then you can't do
addEventListener on it.
In other words, you can't implement event targets in JS!
It's bad that nsIDOMWifiManager is not an event target, but I think it would be
worse if the FM radio was not an event target, because we're exposing it to all
of the web.  So I think you're going to have to rewrite the implementation of
nsIDOMFMRadio in C++.  I don't think we want to create a public interface where
you have to use the onX handlers.
Unless Jonas has different thoughts?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,22,"Comment on attachment 647942
option MOZ_B2G_FM
Review of attachment 647942:
-----------------------------------------------------------------
autoconf.mk.in substitution was just rewritten, so this needs to be updated.",CODE_REVIEW,0,FULL_TEXT
779500,23,"We cann't implement the nsIDOMEventTarget in JS, but i think we can add ""addEventListener"" and ""removeEventListener"" to nsIFM, and implement the two functions in JS, what do you think?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
779500,24,"If that works, that's fine with me.  But I expect that there's some deep problem with trying to do that, otherwise people wouldn't say ""you can't implement event targets in JS"".  smaug?",SOLUTION_REVIEW,1,FULL_TOKEN
779500,25,"Horrible horrible hack.  If avoidable, please avoid. EventTargets should be EventTargets
Sure it could work, but please make sure to implement add/removeEventlistener and dispatchEvent
the way C++ version does.
You can't implement event targets in JS, because real event handling needs to be sure that
it deals with native objects. Event handling needs to be fast - so, no extra QIing at unsafe times.
In general it isn't clear to me why anyone would like to implement eventtargets in JS.
But looks like the patch does implement FmAdaptor in C++. Implementation should bind the
object to a window though (nsDOMEventTargetHelper::BindToOwner) .",SOLUTION_REVIEW,1,FULL_TOKEN
779500,26,"nsIDOMFMManager wants to be an event target, and is implemented in JS.",CLARIFICATION,0,FULL_TEXT
779500,27,"Hi Justin,
Thinker and I proposed a method.
We will implement a class, say JSDOMEventTargetHelper.
JSDOMEventTargetHelper inherits from nsDOMEventTargetHelper and
nsIJSEventTargetHelper.
JSDOMEventTargetHelper is another eventtarget for initializing 
and setting helpers from JS code.
nsIDOMFMRadio provides nsIDOMEventTarget interface.  But, its
QueryInterface returns an JSDOMEventTargetHelper.
Since almost all the functions we need are done in
nsDOMEventTargetHelper, we do not need much effort to implement
JSDOMEventTargetHelper.
So we have 
- JSDOMEventTargetHelper
 - implements nsIJSDOMEventTargetHelper
 - inherit nsDOMEventTargetHelper
- nsIJSDOMEventTargetHelper
 - provide an interface for JS component code for setting helpers
For JS components who want to implement nsIDOMEventTarget, it 
creates an instance of JSDOMEventTargetHelper returned by QueryInterface for nsIDOMEventTarget interface.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,28,"One of the rules of QueryInterface is that you can always get back to your original object:
  nsIFoo *orig = ...;
  nsIBar *bar = QueryInterface(orig);
  nsIFoo *foo = QueryInterface(bar);
  ASSERT(foo == orig);
So to make this work, JSDOMEventTargetHelper's QI function would have to know how to get back to nsIDOMFMRadio.  But I guess you could do that with a custom QI function which calls the fm-radio's QI...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,29,"I'm told that this is a v1 blocker, so I'm noming it.
As I've made clear in a variety of forums, I think it would be a mistake to hold the release for this feature, and I do not think it is a blocker.  In fact, I think it would be prudent to allow this feature to slip, so we have time to focus on other things for v1.  But I understand that is not the decision product has made.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
779500,30,"Smaug says this might work, and it sounds fine to me (modulo comment 27).  Go for it!",SOLUTION_REVIEW,1,FULL_TOKEN
779500,31,"Hi Justin, i updated the WebIDL based on your feedback, here is what i did:
  - Set signalStrength as a double
  - rename 'onantennachange' to 'onantennastatechange'
  - rename 'onsignalchange' to 'onsignalstrengthchange'
  - rename 'bandRanges' to 'currentBand', it returns an object like:
        {
           ""upper"": 87.5,    // in MHz
           ""lower"": 108,     // in MHz
           ""interval"":  0.1   // in MHz
        }
and here is the updated WebIDL:
interface FM : EventTarget
{
  /* Indicate if FM is enabled */
  readonly attribute boolean enabled;
  /* Indicate if antenna is available */
  readonly attribute boolean antennaAvailable;
  /**
   * Current frequency in MHZ.
   * The value will be 0 or the last frequency if FM is not enabled. 
   */
  readonly attribute double frequency;
  /* the strength of signal, the range is [0, 1] */
  readonly attribute double signalStrength;
  /**
   * The band info object, it likes:
   *   {
   *     ""lower"": 87.5,   // in MHz
   *     ""upper"": 108,    // in MHz
   *     ""interval"": 0.1  // in MHz
   *   }
   */
  readonly attribute any currentBand;
  /* Fired when the the FM is enabled */
  attribute Function onenabled;
  /* Fired when the the FM is disabled */
  attribute Function ondisabled;
  /* Fired when the state of antenna is changed */
  attribute Function onantennastatechange;
  /* Fired when FM frequency is changed. */
  attribute Function onfrequencychange;
  /* Fired when the strength of signal is changed. */
  attribute Function onsignalstrengthchange;
  /* Power on/off the FM device, onpowerchanged will be fired accordingly */
  DOMRequest setEnabled(in bool enabled);
  /**
   * onsuccess will be triggered if frequency is set successfully.
   * app should listen on the ""onfreqchange"" to get the right frequency.
   * If the frequency is out of range, then request.onerror will be fired.
   */
  DOMRequest setFrequency(in double frequency);
  /**
   * Tell FM to seek up, if frequency is changed, onfrequencychanged will be triggered.
   * Only one seek is allowed at once, if the FM is seeking, then onerror will be fired.
   */
  DOMRequest seekUp();
  /**
   * Tell FM to seek down, if frequency is changed, onfrequencychanged will be triggered.
   * Only one seek is allowed at once, if the FM is seeking, request.onerror will be fired.
   */
  DOMRequest seekDown();
  /* Cancel the seek action, if the FM is not seeking, request.onerror will be fired */
  DOMRequest cancelSeek();
}",CODE_IMPLEMENTATION,1,FULL_TOKEN
779500,32,"This looks great.  Just a few small changes, if you don't mind:
Can we make the value here null if FM is not enabled?  That way there's no confusion, nor any contract that this API will remember things.
If we're only going to expose the current band, I think it would be better to do something simpler:
  readonly attribute double frequencyLowerBound;
  readonly attribute double frequencyUpperBound;
  readonly attribute double channelWidth;
If we have fm.availableBands at some later date, they can be {lowerBound, upperBound, width} objects, which would be fine.  We don't need to expose our current band data as an Object in order to make the future availableBands property make sense.
Perhaps we should have two methods
  DOMRequest disableRadio();
  DOMRequest enableRadio(in double frequency);
Otherwise, you have to enable the radio and then set the frequency.  But after you enable and before you set the frequency, you're in this weird state where the radio is ""on"" but not tuned.
What do you think?
What happens if I set the frequency to 87.6, when the min freq is 87.5 and the channel width is .2?
I'd guess that can't be an error, because we can't represent all fractions precisely as doubles. Even if I send 87.7, I might actually send 87.70000000000002.  In other words, we have to do some amount of rounding.
So I guess I have a question and a suggestion.  My suggestion is that we say that even if setFrequency(x) succeeds, it is not guaranteed that fm.frequency == x, because we may reduce the precision of the given frequency.
And my question is: Do you know if the radio can tune to halfway between a channel, or must it always tune to precisely one of the channels?  That is, should the user expect their given frequency to be rounded to a channel, or just rounded to something?  Whatever it is is fine, but we should document it.
I have nits on the English in the comments (nothing major).  I was planning to save those for when you post a patch, but I can give them sooner if you'd prefer.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,33,"Yes
That's fine to me.
enableRadio might fail, the reason may be the FM HW is not be enabled, or the frequency is out of range.
So i prefer keeping it, we can set the frequency with the lower bound after the FM is enabled.
I tried this on the Otoro device, yes, it can be set to 87.6, when the min freq is 87.5 and the channel width is .2.
Yes, it is not guaranteed that fm.frequency == x.
If the channel width is .2, and we set frequency with 88.05, the FM HW will round the frequency to 88 automatically.
I will check it on the Otoro device later.
yes, please",CLARIFICATION,0,FULL_TOKEN
779500,34,"Hi Justin, about the frequency rounding, i tried on the Otoro device, there are three spacing type: 50KHz, 100KHz and 200KHz, whatever spacing type i set, the result is the same:
  - if set the frequency with 88.05, the frequency will be 88.05
  - if set the frequency with 88.06, the frequency will be rounded to 88.0
So it's for sure the frequency will be rounded by the FM HW, there may be problem with spacing type setting though.
IMO, the frequency should be rounded, depending on the band settings, for example:
   - lower: 87.5, upper: 108, interval: 0.2
     * set with 87.6, the frequency will be 87.5
   - lower: 87.5, upper: 108, interval: 0.1
     * set with 88.05, the frequency will be 88",SOLUTION_REVIEW,1,FULL_TOKEN
779500,35,"But won't that cause the radio to start playing sound?
If the radio doesn't start playing until the event loop flushes, that's probably OK.  (I mean, if you do fm.setEnabled(true); for(var i = 0; i < 10000; i++) {} fm.setFrequency(100);, you shouldn't hear the radio until you set the frequency.)
So it's always rounding to 50KHz?  But then why does 88.06 get rounded to 88.0 and not 88.5?  That's pretty weird.
I think that's reasonable for now.  We can always change the comment in the IDL if we don't want to go this route for some reason.",CLARIFICATION,0,FULL_TOKEN
779500,36,"English nits, fresh off the presses.
s/Indicate/Indicates/
s/FM/the FM radio/
s/Indicate/Indicates/
s/antenna/the antenna/
This is also pretty repetitive with the attribute name.  How about
  Indicates if the antenna is plugged in and available
s/^the/The/
s/strength of signal/signal strength/
This is incorrect use of a comma: ""the range is [0, 1]"" is an independent clause (a complete sentence by itself), so cannot be separated from the clause before it by only a comma.  (It would be a comma splice if ""the strength of signal"" were itself an independent clause, but it's not.)
How about
   The signal strength.  The value returned is between 0 (no signal) and 1 (full signal), inclusive.
s/the FM/the FM radio/, or s/the FM/the radio/.
ibid.
s/of antenna/of the antenna/
Nowhere else do we talk about the ""state of the antenna"", so I don't think we
should use that in the comment here.  Maybe 
  Fired when the antenna becomes available or unavailable; i.e., fired when the
  antennaAvailable attribute changes.
s/FM frequency/the radio's frequency/, or s/FM frequency/the FM radio's frequency/.
s/strength of signal/signal strength/.
We say ""signal strength /changes/"", instead of ""signal strength /is changed/"", because the signal strength is beyond anyone's direct control.  By analogy, we'd say ""the weather changes"", not ""the weather is changed"" (unless someone has a weather machine!).
Also, you mentioned earlier that this event is throttled -- can you explain how, here?
s!Power on/off the FM device!Power the FM radio on/off!
In general, we should refer to events as ""powerchange"", rather than ""onpowerchange"".  ""powerchange"" is the name of the event, and ""onpowerchange"" is the name of the attribute on the FM radio which is tied to the ""powerchange"" event.
Also, there's also no onpowerchanged event.
This is a traditional comma splice; the two things separated by a comma are both independent clauses.  You can fix this by either adding a conjunction (e.g. "", and""), using a semicolon instead of the comma, or splitting the sentence in two.  In this case, I think the latter is the best option:
  Power the FM radio on/off.  The powerchange event will be fired if this
  request completes successfully.
I don't think we need to explain when onsuccess and onerror are fired; that's pretty clear from context.
I presume the app can listen to the frequencychange event or alternatively listen to request.onsuccess, right?
Finally, let's add a summary sentence to the beginning, like we have elsewhere.
  Tune the FM radio to the given frequency.  This will fail if the given
  frequency is out of range, or if another setFrequency call is pending.
  Note that the FM radio may not tune to the exact frequency given.  To get the
  frequency the radio is actually tuned to, wait for the request to fire
  onsuccess (or wait for the frequencychange event to fire), and then read the
  frequency attribute.
s/up, if frequency/up to the next channel.  If the frequency/
s/is changed/is successfully changed/
s/onfrequencychanged/the frequencychange event/
s/once, if/once: If/
s/the FM/the FM radio/
s/is seeking/is seeking when seekUp is called/
ibid
s/action, if/action. If/
s/the FM/the FM radio
s/not seeking/not currently seeking up or down",CODE_REVIEW,0,FULL_TOKEN
779500,37,"Do we really want to name the interface ""FM"" as opposed to, say, ""FMRadio""?
As far as the implementation plan, why do you need QI weirdness?  It seems like all you really need is a way to create a JS object with the right JSClass and native slot (one which will claim to implement EventTarget and have a native which does so, as discussed) and the right prototype (the FM.prototype or FMRadio.prototype, as desired), no?",SOLUTION_REVIEW,1,FULL_TOKEN
779500,38,"What native slot? I thought the implementation would be in JS.
Though, comment 30 talks about WebIDL so I'm not sure anymore what kind of EventTarget impl
will be added.",QUESTION,0,FULL_TOKEN
779500,39,"Yes, but i think it is OK, a real FM radio will start playing sound when it is turned on.
yep, it's pretty weird.",ANSWER_TO_QUESTION,0,FULL_TEXT
779500,40,I set a 2 seconds interval checking in the FmService module.,ANSWER_TO_QUESTION,0,FULL_TEXT
779500,41,"Will this duplicate all the EventTarget stuff instead of inheriting from EventTarget.prototype, then?  Because the methods on EventTarget.prototype will only work if the object is an EventTarget from their point of view.
Maybe I should back up.  What's the goal here?  Are we exposing some chrome object to content JS via COWs or SOWs or whatever the relevant wrapper is and ignoring WebIDL altogether?  Or are we directly creating objects in the content compartment?",SOLUTION_REVIEW,1,FULL_TOKEN
779500,42,"Justin, what do you think?",SOLUTION_REVIEW_REQUEST,0,FULL_TEXT
779500,43,"Well, we wouldn't want an MP3 interface to start playing a random track as soon as it's initialized because that mirrors the behavior of cassette players.  :)
I don't see any reason to design this annoyance in to our interface when we can easily avoid it.  But, like I said, so long as we wait for a trip through the event loop before we start playing sound, that would be an OK compromise to me.
I agree with Boris.  Frequency modulation is a method of sending data over waves; if you leave out the ""radio"" part, it doesn't really describe what's going on here.  :)
The former, if I understand you correctly.  It's the DOMFMManager in attachment 647943.",SOLUTION_REVIEW,1,FULL_TOKEN
779500,44,"Hmm.  If you're just exposing chrome stuff, then the proposed thing with QI may work, yes, since you're not actually implementing what the rest of the world thinks of as an EventTarget....  It's OK for a short-term hack, though obviously long-term we'll want to do something more like what I described.
By the way, the existing source files there (nsIFm.idl, dom/fm) have the same problem as having an interface called FM, in my opinion.  nsIFmAntenna and nsIFmAdaptor are perhaps fine (though ""adaptor"" doesn't really say anything useful to me).",SOLUTION_REVIEW,1,FULL_TOKEN
779500,45,"I understand you, but your proposed interfaces may still bring the FM to the *weird* state you mentioned: ""the radio is 'on' but not tuned"", if the frequency is out of the band, say 60MHz: 
   navigator.mozFMRadio.enableRadio(60)
And what an app should do likes this:
   var req = navigator.mozFMRadio.setEnabled(true);
   req.onsuccess = function() {
     navigator.mozFMRadio.setFrequency(91.5);
   };
not what you mentioned: 
   fm.setEnabled(true); for(var i = 0; i < 10000; i++) {} fm.setFrequency(100);",SOLUTION_REVIEW,1,FULL_TOKEN
779500,46,"Justin, what do you mean by creating bogus APIs?Like this: navigator.mozFMAudio.speakerEnabled? If yes, then what about the security level for such an API, and will it be proposed to W3C?",QUESTION,0,FULL_TEXT
779500,47,That is my understanding. See also Bug 731746.,CLARIFICATION,0,FULL_TEXT
779500,48,"Perhaps we should make this call not turn on the radio at all, if we wanted to avoid this problem.
I was using the busyloop to illustrate a problem; I was not suggesting that was the right thing to do.  :)
But if I don't want to hear a random channel for a moment before I tune the radio, I shouldn't do
but should instead do
right?  (Provided, of course, that setEnabled is guaranteed not to take effect until we spin the event loop.)
Yes, I think that API is ""bogus"" because speaker enabled has nothing to do with specifically FM radio.  (Are you proposing that speakerEnabled be a property on mozFMRadio, or a separate interface called mozFMAudio?)
Since device speakers are used for more than just playing FM radio, the attribute telling you whether or not the speaker is enabled should not be on the FM radio interface.
I think we could discuss details like the security requirements for that separate API and our approach for getting it standardized in a separate bug.",SOLUTION_REVIEW,1,FULL_TOKEN
779500,49,"For Otoro device, it will take about 2s to enable the FM HW, it's doesn't make any sence that we can set the frequency before the HW is turned on, and then the state is also weird: it is enabling and will-be-tuned-to-91.5.
BTW, i don't quite understand what ""that setEnabled is guaranteed not to take effect until we spin the event loop"" means here, :-(
I am proposing the speakerEnabled be a property on mozFMRadio, just like the mozTelephony.speakerEnabled.
I was told that there will be some settings to control audio routing, but for now, we don't have such settings, and i don't think it is planed in V1.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
779500,50,"I don't think ""radio is enabling and will be tuned to 91.5"" is a particularly strange state, myself.  That seems like exactly the state we want to be in.
But what I'm trying to figure out is how to design our API in such a way as we can avoid playing a random radio station (which may be loud static, piped straight into the user's ears) when the radio is turned on.  I'm not wed to a specific way of accomplishing this, but I think this is an important design consideration.
It basically means that if we do
  setTimeout(function() { alert('Radio about to be enabled.'); }, 0);
  fmRadio.setEnabled(true);
  ...
that the alert will show before the radio starts playing.  The setTimeout will fire some time after you've returned from all the code you're currently running.
When whatever JS code you're running finishes, the browser looks at the list of pending tasks (e.g. setTimeouts, onclick handlers, whatever) and runs one.  The code which does this is called the ""event loop"", and we say the event loop ""spins"" when it completes once.  If that makes any sense.
Okay.
I think the telephony property is bogus too, but I also think it's not as bad as putting speakerEnabled on the FM interface, because telephony will not be exposed to the vast majority of pages, while webFM will be available to every page on the web.  As a result, we will have much more difficulty removing speakerEnabled from the FM interface than we would removing it from the telephony interface.
I don't understand what is the motivation for putting speakerEnabled on the FM interface.  Surely if the FM radio app cares about whether the speaker is enabled, the MP3 player app also cares, right?  But we agree the MP3 player app shouldn't have to look at the FM radio API to determine whether the speaker is on?",SOLUTION_REVIEW,1,FULL_TOKEN
779500,51,"""setEnabled"" is an async method, when you called ""mozFMRadio.setEnabled(true)"", the enabling FM action will be executed in one thread or process which is obviously different from the thread/process which will execute the ""event loop"" (maybe my understanding is totally wrong), then i don't understand how to prevent ""setEnabled is guaranteed not to take effect until we spin the event loop"". 
So there should be an API to control the audio routing which will be exposed to the vast majority of pages, right?
If yes, what i can imagine, the API will not be specific used for FM audio, it will effect not only the FM app but also other apps which play sounds., and obviously it's not planned in V1 and even V2.
The B2G is designed to enable the speaker automatically when the headset is unplugged, and change it back when the user plugged the headset, it's OK for the MP3 player or video player, but for the FM, the headset is the antenna, if you unplugged the headset, the sound will become noise, so the FM app need such a interface to enable speaker without unplugging the headset.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
779500,52,"I have to say i am totally confused.
If we keep seperating the ""setEnable""(not tuned to some frequency automatically) and ""setFrequency"", the FM will stay quiet after it is enabled and before we tuned it, and the state will be enabled-but-not-tuned which you feel so weird, if we want to kill such a ""weird"" state, the only thing we can do is combining them into one atom action, i.e. enableRadio(frequency) you proposed, and the app will have to set a frequency which is also a *random* number to the end user when enabling the FM.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
779500,53,"No, because I do not think that a webpage should be able to pipe audio out of the phone's speaker.  That's another good reason not to put speakerEnabled on the FM radio interface.
I think the FM radio should immediately shut itself off when you unplug the headset (which functions as the antenna).  Playing static through the phone's external speaker when the headset is disconnected is not useful in any way.
Then the only use-case for speakerEnabled that Ray and I were able to come up with on IRC is: I want to listen to the FM radio on my phone's speakers, but I have to leave the headphones plugged in because they function as the radio's antenna, and B2G (currently) doesn't have any way for me to direct audio to the external speaker except by unplugging the headphones.
I don't feel like this is a core FM radio use-case.  Even if it's a blocker, I think we should figure it out in a follow-up bug, so as to reduce the scope of this bug and land it sooner.  We can argue about what interface the relevant APIs should live on in that bug.",SOLUTION_REVIEW,1,FULL_TOKEN
779500,54,"Hi Justin, i updated the WebIDL, here is what i did:
  - Break setEnabled into two methods: disable, enable(frequency)
  - Removed bandRanges, and add three new attributes: frequencyUpperBound, frequencyLowerBound and channelWidth
  - Renamed onantennastatechange to onantennaavailablechange which is more intuitively connected to the attribute antennaAvailable
  - Changed the type of frequency to 'any'
and here is the updated webidl:
interface FMRadio : EventTarget
{
  /* Indicates if the FM radio is enabled. */
  readonly attribute boolean enabled;
  /* Indicates if the antenna is plugged and available. */
  readonly attribute boolean antennaAvailable;
  /**
   * Current frequency in MHz.
   * The value will be null if the FM radio is disabled.
   */
  readonly attribute any frequency;
  /**
   * The signal strength.
   * The value returned is between 0 (no signal) and 1 (full signal), inclusive.
   */
  readonly attribute double signalStrength;
  /* The upper bound of frequency in MHz. */
  readonly attribute double frequencyUpperBound;
  /* The lower bound of frequency in MHz. */
  readonly attribute double frequencyLowerBound;
  /**
   * The channel width of the ranges of frequency, in MHz.
   * Usually, the value is one of:
   *  - 0.05 MHz
   *  - 0.1  MHz
   *  - 0.2  MHz
   */
  readonly attribute double channelWidth;
  /* Fired when the FM radio is enabled. */
  attribute Function onenabled;
  /* Fired when the FM radio is disabled. */
  attribute Function ondisabled;
  /**
   * Fired when the antenna becomes available or unavailable, i.e., fired when
   * the antennaAvailable attribute changes.
   */
  attribute Function onantennaavailablechange;
  /* Fired when the FM radio's frequency is changed. */
  attribute Function onfrequencychange;
  /* Fired when the signal strength changes. */
  attribute Function onsignalstrengthchange;
  /**
   * Power the FM radio off.
   * The disabled event will be fired if this request completes successfully.
   */
  DOMRequest disable();
  /**
   * Power the FM radio on, and tuned the radio to the given frequency in MHz.
   * This will fail if the given frequency is out of range.
   * The enabled event and frequencychange event will be fired if this request
   * completes successfully.
   */
  DOMRequest enable(in double frequency);
  /**
   * Tune the FM radio to the given frequency.
   * This will fail if the given frequency is out of range.
   *
   * Note that the FM radio may not tuned to the exact frequency given. To get
   * the frequency the radio is actually tuned to, wait for the request to fire
   * onsucess (or wait for the frequencychange event to fire), and then read the
   * frequency attribute.
   */
  DOMRequest setFrequency(in double frequency);
  /**
   * Tell the FM radio to seek up to the next channel. If the frequency is
   * successfully changed, the frequencychange event will be triggered.
   *
   * Only one seek is allowed at once:
   * If the radio is seeking when the seekUp is called, onerror will be fired.
   */
  DOMRequest seekUp();
  /**
   * Tell the FM radio to seek down to the next channel. If the frequency is
   * successfully changed, the frequencychange event will be triggered.
   *
   * Only one seek is allowed at once:
   * If the radio is seeking when the seekDown is called, onerror will be fired.
   */
  DOMRequest seekDown();
  /**
   * Cancel the seek action.
   * If the radio is not currently seeking up or down, onerror will be fired.
   */
  DOMRequest cancelSeek();
}",CODE_IMPLEMENTATION,1,FULL_TOKEN
779500,55,"This should be a nullable-double, which I think is ""double?"" in webidl.
Nit: s/tuned/tune
Hm...it's a little weird that we have two events for FM radio enabled/disabled, but only one event for antenna plugged/unplugged.
But antenna unplugged will cause us to disable the radio, so...maybe it's OK.  What do you think?
Aside from the above, this looks good to me.  We should get Jonas's SR (please post a patch), but I don't think you should block on that before working on the rest of the patches.",CODE_REVIEW,0,FULL_TOKEN
779500,56,"Yes, you are right.
We have two methods to enable and disable the FM radio, so i think it's OK to keep two events here.
OK, i will update the IDL patch for WebFM first.",STATUS_UPDATE,0,FULL_TEXT
779500,57,"Created attachment 653655
nsIDOMFMRadio IDL",UNCODED,0,UNMATCHED
779500,58,Let's remove toggle feature out of v1. Just provide a note here.,CODE_REVIEW,0,FULL_TEXT
779500,59,"Why does this need to be ""any""?  If it's just a number or null, then using a nullable numeric type should work, I'd think.",QUESTION,0,FULL_TOKEN
779500,60,"Right, see comment 54.",UNCODED,0,UNMATCHED
779500,61,"We're not using WebIDL yet, so that won't work here.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
779500,62,"Comment on attachment 653655
nsIDOMFMRadio IDL
Review of attachment 653655:
-----------------------------------------------------------------
Looks great!
::: dom/fm/nsIDOMFMRadio.idl
@@ +39,5 @@
Nit: I think the name here is a bit too technical. Something like channelStep might be easier to understand. I'm totally fine either way though.",CODE_REVIEW,0,FULL_TEXT
779500,63,"I've provide a WIP on bug 731746 for JSDOMEventTargetHelper mentioned in comment 26.
You can take a look at it to see if this approach matched with WebFM's requirement.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
779500,64,"Created attachment 654941
all in one patch, WIP, v1
It depends on the patches of bug731746 and bug749053.",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
779500,65,"Bug 731746 has been blocking-basecamp minus'ed.  Please add and implement addEventListener and removeEventListener methods here.
I'm sorry for the churn, guys.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
779500,66,Could you please obsolete the old patches in this bug?  It's not clear to me what is part of this bug anymore.,CODE_UPDATE_REQUEST,0,FULL_TOKEN
779500,67,"I saw the bug 731746 comment 19, which way should i do, implement the two methods in JS or rewrite all code in c++?",SOLUTION_REVIEW,1,FULL_TEXT
779500,68,"Re-implementing in C++ would yield the most correct result, but it seems to me that adding add/removeEventListener is the path of least resistance.  Do you think that's right?  A lot of people are itching to get this landed, so we should do whatever is easiest/fastest.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,69,"Hi Justin, i will introduce the two methods, addEventListener and removeEventListener, to the IDL, i should ask for superreview again, right?",QUESTION,0,FULL_TEXT
779500,70,"I don't think you need a new SR, since Jonas already approved that change in bug 731746.",ANSWER_TO_QUESTION,0,FULL_TEXT
779500,71,"Yes, sr for that change isn't needed.",ANSWER_TO_QUESTION,0,FULL_TEXT
779500,72,"Created attachment 656423
all-in-one patch, WIP, v2
It depends on the patches of bug749053.",UNCODED,0,UNMATCHED
779500,73,"I'm going to look at bug 749053 first, since changes there may mean you have to make changes here.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
779500,74,"One thing that you could work on here in the meantime is tests.
We should have tests for all the weird edgecase behavior such as
  * what happens if you disable the radio while we're seeking?
  * if you trigger two seeks simultaneously, does the first one always get onsuccess, and does the second one always get onfailure?
etc.
We probably can't write these as mochitests, but most of these could be an automated test that QA could run on the device, as part of one of our test apps in Gaia.",REQUIREMENT,0,FULL_TOKEN
779500,75,"Comment on attachment 656423
all-in-one patch, WIP, v2
Review of attachment 656423:
-----------------------------------------------------------------
::: dom/fm/FMRadio.cpp
@@ +16,5 @@
I think we want the hal backend to tell us this.
::: dom/fm/FMRadioService.jsm
@@ +5,5 @@
Hmm.. This doesn't really sound like a fallback since it's being run when we actually have a fm radio.
@@ +366,5 @@
You should add the event listener before enabling the radio. If enable immediately enables the radio, your listener won't be called. Same thing goes for the disable listener.",CODE_REVIEW,0,FULL_TEXT
779500,76,"Comment on attachment 656423
all-in-one patch, WIP, v2
What's left to make this not a WIP?",CODE_REVIEW,0,FULL_TEXT
779500,77,"So there should be an interface in the hal part, right?
I will remove the *Fallback* keyword.
OK",QUESTION,0,FULL_TEXT
779500,78,"If the interfaces of the hal part(bug 749053) are settled, i think it is the right version to be reviewed.",ANSWER_TO_QUESTION,0,FULL_TEXT
779500,79,"Created attachment 657756
all-in-one patch, v1",UNCODED,0,UNMATCHED
779500,80,"Created attachment 658025
all-in-one patch, v2",UNCODED,0,UNMATCHED
779500,81,"Here is the tests: 
  https://github.com/mozilla-b2g/gaia/pull/4298",CODE_IMPLEMENTATION,1,FULL_TOKEN
779500,82,"Fantastic!
I'm really behind on reviews after the B2G work week, but I'll get to this ASAP (hopefully Wed or Th).  I'm sorry for the long wait.",UNCODED,0,UNMATCHED
779500,83,"Created attachment 659148
all-in-one patch, v3
Update the patch to make it work with the latest m-c, see bug788561",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
779500,84,"Hi Justin, do you have a plan to review my code?",CODE_REVIEW_REQUEST,0,FULL_TEXT
779500,85,"Sound the trumpets!
Here's the first part of the review.  It covers everything except the JS bits.  I'm working on the JS code now.
I'm sorry again this took so long.  The next round should go faster.
""The addEventListener, removeEventListener, and dispatchEvent methods below are
a temporary hack, which will be removed once nsIDOMFMRadio can inherit from
nsIJSDOMEventTarget.  See bug 731746.""
(The main problem here is that we use ""this"" when we mean ""these"".)
Does this file not work if you don't include these to files?  It's not clear
why you need them.
Please add a brief comment here explaining what nsIFMRadio is for.
Please indicate what the units are here.  (I don't see why this shouldn't be a
double like nsIDOMFMRadio.)
Please match nsIDOMFMRadio by making signalStrength a double.
Please add a comment explaining what settings are expected.
In fact, we really should create a new interface (e.g. nsIFMRadioSettings) and
use that as the argument type here.
Relying on FM_RADIO_SEEK_DIRECTION_{UP,DOWN} is problematic here, because
callers from JS don't have access to those constants.
Instead, you should add constants to this IDL file, like:
      const long SEEK_DIRECTION_UP = 0;
      const long SEEK_DIRECTION_DOWN = 1;
(Notice that these are |long|'s, that is, int32's.  I don't think it makes
sense to use a short here; this is effectively an enum, and we use XPIDL |long|
for that.)
Again, switch this to nsIFMRadioSettings, so that if I called this from C++, I
wouldn't have to unpack a mysterious jsval.
Again, indicate what the units are on frequency, and consider using a double
here (unless there's a good reason not to?).
These should all be nsIRunnable.  That will give you a strongly-typed callback
function, which is what you're going for here, I think.  (In other words, if
you used nsIRunnable here, you wouldn't have to change any of the JS code which
calls this interface.)
It looks like FM radio support is guarded by MOZ_B2G_FM, but this JSM is
included on all B2G builds.  Should you add a check here that MOZ_B2G_FM is
set?
We never put |using namespace| inside a header file.  That causes serious
breakage, because it means that every header file which is included below this
one also |uses namespace mozilla::hal|, which effectively puts mozilla::hal
into the global namespace!
This is defined in hal/HalTypes.h, which is included above.  Do you need this here?
This comment is not adding anything; please remove it.
Fix spacing, please.  (Align everything to the first |public| above.)
       Dispatch a trusted, non-cancellable, not-bubbling event to ourself.
int32_t, or uint32_t, but almost never raw |int|.
But it looks like this should actually have the type hal::SwitchState.
Please add a comment indicating what this is the status of, and rename the
variable to something more meaningful than |mStatus|.
Why are these protected and not private?  Does someone inherit from this class?
These are virtual methods, no?  Notify(SwitchEvent&) comes from SwitchObserver,
and Notify(FMRadioOperationInformation&) comes from FMRadioObserver.  Both
SwitchObserver and FMRadioObserver are instances of mozilla::Observer, defined
in xpcom/glue/Observer.h.
In that case, these need to be marked as virtual.  Also, please put them up
with the other public methods.
A bunch of things will be changing in this file, per my comments in the IDL.  I
haven't commented on them further here.
As far as I can tell, these log statements are the only android-only feature of
this file.  Please guard them with an ifdef.  (You can just define LOG to do
nothing if we're not on Android.)
The right solution would be to use prlog, but that's kind of a pain to use in
b2g.  We have a pretty bad logging story. :(
You use these only once, and the macros aren't any shorter than what they're
replacing, so I'd inline the macros, if it was me.  Whatever you prefer is fine.
This comment isn't adding anything; please remove.
We format this like:
FMRadio::FMRadio()
  : mStatus(1)
  , mHasInternalAntenna(false)
We use NS_FAILED instead of !NS_SUCCEEDED and format this like
    if (NS_FAILED(Preferences::GetBool(DOM_FM_ANTENNA_INTERNAL_PREF,
                                       &mHasInternalAntenna)) ||
        !mHasInternalAntenna) {
But even better, I think, would be to do
    mHasInternalAntenna = Preferences::GetBool(""dom.fm.antenna.internal"",
                                               /* default = */ false);
    if (mHasInternalAntenna) {
      LOG(""We have an internal antenna."");
    } else {
      ...
    }
Please do
    if (...) {
(We almost never put the brace for an if statement on the next line.)
Gecko style is to brace all if/else statements.
Also, when you switch mStatus to the |SwitchState| type, please use
SWITCH_STATE_{ON,OFF}, not ""0"", here and elsewhere.
Nit: This is a comma splice.  Replace the comma with a period.
But I also don't understand this comment; the signal strength is [0-100], but
it can be bigger than 100?  Perhaps you could elaborate a bit in the comment.
Nit: how about
    *aSignalStrength = NS_MIN(signalStrength, 100) / 100.0;
blean
Nit: |const JS::Value& settings|.  But this whole thing is going to change
anyway, per the comments on the IDL.
|oldStatus| would be more idiomatic.
Nit: Please do
    event->InitEvent(aEventName, /* bubbles = */ false, /* cancelable = */ false);
Again, it's not clear to me why this guy is B2G only.",CODE_REVIEW,0,90_PCT_MATCH
779500,86,"TBH, it's not clear to me that we're winning anything by using JS here.  We
shouldn't rewrite this whole thing in C++ right now, but I think we should
start on that project once we land this and shake out the first round of bugs.
We'll get increased correctness, which is great, but I think the result may
also be simpler in a lot of ways.  Currently, the control flow is as follows:
  webpage (JS) -> nsIDOMFMRadio (JS) -> FMRadioService (JS) ->
    nsIFMRadio (C++) -> HAL (C++) -> hardware
but if nsIDOMFMRadio were implemented in C++, we could simplify this to
  webpage (JS) -> nsIDOMFMRadio (C++) -> HAL (C++) -> hardware
I think that would be a significant improvement.  What do you think?
I think it would be better to call this file ""DOMFMRadioChild.js"" and to call
FMRadioService.jsm ""DOMFMRadioParent.jsm"".  Then we don't have to guess about
what code lives in which process.
I don't use emacs, but shouldn't this be ""Mode: JavaScript""?
Please take out autoindent; that's an editing pref, not a formatting pref!
(Where do we get these bizarre modelines from?)
Why is getAntennaState in this list?
(I think this whole idiom that DOMRequestIpcHelper has developed is pretty
bogus; you shouldn't list twice each of the events that you want to listen to,
because that's just asking for a mistake.  But that's not your bug to fix
here.)
_fireSignalStrengthChangeEvent, please.
_fireAntennaAvailableChangeEvent, please.
What happens if takeRequest fails?
s/FM/FM radio
s/FM/FM radio
s/FM/FM radio
How about ""FM radio seek-up failed"".
Suggest something like ""FM radio seek-down failed.""
_call calls _checkPermission(), but everyone who calls _call() also calls
_checkPermission().
Except this is a lie; we're faking it right now.  So please indicate that.
You're not using the wantsUntrusted field, so you should omit it.
Just set this in the constructor so you don't have to check it everywhere.
Also, this._eventListenersByType would be a better name than _eventTypes.
We're inconsistent about how we name these string constants.  Here they're
capitals, like a C++ macro.  But then we have kMozSettingsChangedObserverTopic.
I don't care what you do, so long as you're consistent.
Also, ""spaceType"" is not a good name for the setting.  ""fm.channelInterval""
would be better.  ""fmRadio.cannelInterval"" would be even better.  :)
We're going to move these onto the nsIFMRadio interface, which will be an
improvement.
It's not clear to me why we should have constants like this when we could have
const VALID_CHANNEL_INTERVALS = [200, 100, 50]; // KHz
let _currentInterval = ...; // _currentInterval is either 200, 100, or 50.
But in any case, please call these ""CHANNEL_INTERVAL"" or ""INTERVAL"", but not
""SPACE_TYPE"".
Do you need ctypes here?
Please indent this as
  XPCOMUtils.defineLazyServiceGetter(this, ""gSettingsService"", 
                                     ""@mozilla.org/settingsService;1"",
                                     ""nsISettingsService"");
It looks like you intend to pass the frequency to _seekingCallback, but you
don't here.  I'm not sure, but is the right thing to pass a bool instead of -1?
Seems like you don't miss not having the frequency in the callback.
s/an negative/a negative/
s/callback/the callback/
s/fails/failed/
Also, please wrap this line and the other long comments in this patch.
s/, need to update current frequency/, so we need to update the current frequency./
We're calling |space| the |interval|, right?
Please add an example here for what happens when we pass an out-of-range value.
Also, probably better to use values in KHz rather than MHz in your example,
since that's what the function deals with.
Don't call this ""roundedPart"", because it's not rounded yet.  Either shove
|freq - lower| into the line below, or call this something else.
|_initialized|
_currentInterval.
Why do you initialize _currentBand and _currentSpaceType to actual values,
instead of null?  We shouldn't use these values until we get them from the FM
radio, right?
s/available currently/currently available
It's confusing that we use some global variables and functions and some class
variables and functions.
Can we make all the variables and functions live on the class, please?
We hard-code some observer message names but not others, which is
inconsistent.  I have no problem hard-coding them all.
It doesn't matter much, but for the sake of cleanliness and not encouraging
others to write bad code, please create one lock and get both settings.
""Initialized"", please.
When does this get called?  And why is this the right reaction to an error?
We don't need to inform hal that the band has changed?
Similarly, we don't need to inform hal here?  I guess hal is also listening to
the settings notifications?
Here and elsewhere, you could simplify this by doing
     let signalStrength = FMRadio.signalStrength;
     if (signalStrength != _currentSignalStrength) {
       _currentSignalStrength = signalStrength;
       pmm.broadcastAsyncMessage(...);
     }
I think that more clearly expresses your intent.
Passing a callback function here doesn't make much sense, since you always call
the callback synchronously!
It would make more sense to return true/false, I think.
Should _updatePowerState call _startSignalChecking/_stopSignalChecking, as
appropriate?  That would eliminate a class of possible bugs.
Also, it sounds like _updatePowerState should call _updateFrequency when we
transition to the |on| state?
Please make this interval value (2000) a pref.
When this._signalCheckingInterval is undefined, it != null, so we'll do this if
statement, even though you don't want us to.
A simple fix would be to initialize this._signalCheckingInterval to null in the
constructor.
I'd prefer that the large bodies in this case statement be broken out into
separate methods.
Surely you mean parseInt(msg.data) * 1000!
But if this is working as-is, it sounds like you don't need the parseInt at
all?
If you break this out into a separate method, then you can simply return here.  We prefer
  if (...) {
    ...
    return;
  }
  ...
to 
  if (...) {
    ...
  } else {
    ...
  }
in Gecko.
Doesn't this have the race condition we discussed much earlier, where the radio
is enabled and set to some random frequency, and only later set to the correct
frequency?
s/seeking currently/currently seeking
Same parseInt question here.
s/ranges/range
Also, we're not really doing ""return false"" so much as ""indicate that the
request failed.""
s/completes/completed
Again, seems like the callback to seekStation should accept a boolean, since it
doesn't care about the exact frequency.
If it so happens that the seek completes and the frequency didn't change
(perhaps because the frequency was manually changed during the seek, maybe for
some other reason), then we'll never fire success or failure on the DOM
request!  That's no good.
I'd feel better if seekUp and seekDown were implemented by one method.
Missing semicolon after the close paren.
It's not clear to me why you only want to send the DOMFMRadio::cancelSeek
message when updateFrequency changes the frequency (the callback is not invoked
when we don't change the frequency)!
Most of these changes are cosmetic; this patch is pretty good!  Although one of
the downsides of there being so many layers of indirection between the DOM and
the hardware is that it's hard to tell for sure whether it's correct.  :(",CODE_REVIEW,0,FULL_TOKEN
779500,87,"Steven asked Qualcomm about this, and this is what Qualcomm answered.",ANSWER_TO_QUESTION,0,FULL_TEXT
779500,88,"It does not make sense to say that a number is ""in the range [X, Y]"" and also that the number ""can be bigger than Y"".  Those two statements are contradictory.
Perhaps you mean something like
  The signal strength is interpreted as a percentage (0-100%).  But due to a hardware quirk, s can also be greater than 100, in which case we report the signal strength as 100%.
But actually, hal should be doing this conversion; this is absolutely not a front-end concern.  hal should give back a double in [0,1], or an int in [0,100], or otherwise make /some/ sane guarantee about the value it returns.",CODE_REVIEW,0,FULL_TOKEN
779500,89,It seems that NS_MIN can not be used on the uint32_t typed value.,CODE_REVIEW,0,FULL_TEXT
779500,90,"Um...maybe you need NS_MIN<uint32_t>(signalStrength, 100), because otherwise the compiler doesn't know whether 100 should be signed or unsigned?
http://dxr.mozilla.org/mozilla-central/xpcom/string/public/nsAlgorithm.h.html#l36",QUESTION,0,FULL_TOKEN
779500,91,"I remembered i copied the file from somewhere (contacts? maybe) ...
Should i replace
   ifeq ($(MOZ_BUILD_APP),b2g)
with
   ifeq MOZ_B2G_FM
?",QUESTION,0,FULL_TOKEN
779500,92,"I think you should test MOZ_B2G_FM, probably, yes.  Although not with |ifeq MOZ_B2G_FM|, exactly, because that's not valid Make syntax (is it?).",ANSWER_TO_QUESTION,0,FULL_TOKEN
779500,93,"Yes
I copied these from DOMWifiManager.js, anyway, i think remove them would be better.
I think we can just return if takeRequest fails.
DOMWifiManager.js has the same problem.
Good idea~
I think it is called when an error occurs when reading the setting, and i am trying to set those vars with default values.
There is no such a method like ""hal::UpdateFMRadioSetting"" to change the settings, the only way i can do is power the radio off, and then turn it on by pass the new settings, i don't think it's good.
Currently, the chip will stay quiet until we set a frequency.
The callback will be called anyway, the function name or callback name might be kind of misleading, i will change it to make it more clear.",ANSWER_TO_QUESTION,0,FULL_TOKEN
779500,94,"Okay, thanks.
Yeah, agreed.  We're not even attempting to support dynamic FM band changes, so whatever.
Oh, fantastic.
But please re-arrange this code so that we don't send a message to the child until you've called hal and set the frequency.  Otherwise the child might be able to notice that, right after calling enable(freq), the frequency isn't actually what it expects!
Oh, I misread the code, sorry.
I don't see why we want a callback there at all, since the callback just gets called when the function completes.  Can we just eliminate that parameter?",CODE_REVIEW,0,FULL_TOKEN
779500,95,"Yes, i think your suggestion might work, i.e., return true or false which indicates the frequency is changed or not.",ANSWER_TO_QUESTION,0,FULL_TEXT
779500,96,"I don't quite understand what i should do, is there any example codes?",QUESTION,0,FULL_TEXT
779500,97,"Or NS_MIN(signalStrength, 100u)?",QUESTION,0,FULL_TEXT
779500,98,"Actually, I was wrong -- these are real events, not fake ones.  (You call onantennastatechange by firing an event on the FMRadio class, which is the right way to do it.)  You may be able to s/jsval/nsIDOMEventListener without any other changes to your code (see e.g. dom/wifi/nsIWiFi.idl), but if that doesn't work, jsval is fine.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,99,"That leads to different page-visible behavior.  For example, consider this:
  foo.onenabled = { dispatchEvent: function foo() {} };
This would work if onenabled is an nsIDOMEventListener, but not if it's a jsval.  Other on* attributes are jsval, fwiw.",SOLUTION_REVIEW,1,FULL_TOKEN
779500,100,"fwiw this is only on nsIFMRadio (not to be confused with nsIFMDOMRadio), which isn't exposed to the web.  But it sounds like jsval for the event listeners is fine.  :)
We have some other nsIDOMEventListeners in web-exposed interfaces; I'll file bugs on those.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
779500,101,"er, nsIDOMFMRadio.
I filed bug 790263 on the other onfoo properties.",NEW_ISSUE_FILING,0,FULL_TOKEN
779500,102,What's the difference?,QUESTION,0,FULL_TEXT
779500,103,"In the second one, the second and third lines start in the same column as the t in ""this"".  This is because the ""@mozilla.org"" argument is contained within the same parenthesis level as ""this"".
We break this rule in plenty of places, but in general, we try to indent this way.  It's not always possible, and when it's not, we prefer to indent the second line one indent (that is, two or four spaces, depending on the file).  If you were to do that here, you'd do
although I don't think that would be the right indentation style here.  On the other hand, if ""@mozilla.org/settingsService;1"" were instead some very long string, we might do
Or we might just store the long string in a variable.  But in any case, we wouldn't use the style from the first example in comment 101.
Does that make sense?",SOLUTION_REVIEW,1,FULL_TOKEN
779500,104,"Yes
BTW, the second and third lines didn't align with 'this' in your comments, that's why i am confused, :-)",ANSWER_TO_QUESTION,0,FULL_TOKEN
779500,105,"Now I'm confused.  In comment 85, I wrote
  XPCOMUtils.defineLazyServiceGetter(this, ""gSettingsService"", 
                                     ""@mozilla.org/settingsService;1"",
                                     ""nsISettingsService"");
How do you think it should be?",CODE_REVIEW_REQUEST,0,FULL_TOKEN
779500,106,"Please keep in mind that if you are reading bugmail through a mail reader, spaces might not come out the right size. Going with a web browser to this bug and looking at the comments here should show the correct indentation though.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
779500,107,"I am reading the comments in the browser, so it seems that the ""monospace"" font is not rendered right in my Firefox ... sorry for that",UNCODED,0,UNMATCHED
779500,108,"Hi Justin, i checked the patches of the bug749053, there is one function to query the FM radio settings by country code. So it seems that the right way to enable the FM radio should be:
  - Get country code
  - Query the settings info from hal::GetFMBandSettings by the country code
  - Call the hal::EnableFMRadio by passing the settings object
I think we can introduce a setting, say ""fmRadio.regionCode"", to define the country code for the FM radio (maybe there is already one setting pref for general use), but the country code is defined as an Enum type in C, which means, we should build a setting-to-enum map, so if the Enum type is changed, the whole map will be rewritted, i think it's hard to be maintained. 
What do you think?",SOLUTION_REVIEW,1,FULL_TOKEN
779500,109,"Created attachment 660361
all-in-one patch, v4",UNCODED,0,UNMATCHED
779500,110,"Can we get a build peer to look at the build changes again?  (You got r- last time.)  I'm not comfortable reviewing that stuff.  (You'll probably get a faster review from khuey if you split the relevant changes out into a separate patch.)
Because I asked you to rename these files, interdiff is now pretty useless comparing v3 --> v4.  :(  I'll fix it up manually and post it here.",CLARIFICATION,0,FULL_TOKEN
779500,111,"Created attachment 660466
Interdiff v3 --> v4
This interdiff was created by manually renaming DOMFMRadio.js --> DOMFMRadioChild.js and FMRadioManager.jsm --> DOMFMRadioParent.jsm in patch v3.
This is missing some uninteresting changes in nsLayoutModule, but is hopefully complete aside from that.  (I've had problems with interdiff mysteriously missing hunks lately, so fingers crossed.)",CODE_IMPLEMENTATION,1,FULL_TOKEN
779500,112,"Comment on attachment 660466
Interdiff v3 --> v4
These are comments on the C++ bits.  I'm working on the JS bits.
Please let me know in what form you'd prefer to get these English nits.  I'm
happy to rewrite sentences, to provide explanations on points of grammar, or
both, whatever you feel is most helpful.  My goal is to help you, not to be
annoying or unhelpfully pedantic, so if I'm not accomplishing my goal, please
let me know.
I'm sorry to nit, but this still has a few problems.
We need a preposition (""from"", in this case) between ""inheriting"" and
""nsIJSDOMEventTarget"".
It's not clear what ""these"" are.  It would be helpful if you'd explicitly list
the relevant methods.
You also need some kind of connector after the first comma (""hacks, /which/
will be removed"", or ""hacks; these will be removed"").
The second comma creates a comma splice; it should instead begin a new
sentence.
I'd also like a period at the end of the sentence.
We decided to call this the channelInterval?
If you want to be fancy, you could put ""[infallible]"" in front of ""attribute"".
That would let you do
  nsCOMPtr<nsIFMRadioSettings> settings;
  int32_t lowerLimit = settings->GetLowerLimit();
s/,/;/.  Otherwise this is great.
* s/in JS component/as a JS component/
* ""we need such an interface to be accessed in JS component and JS module""
  I'm not sure what you mean, but maybe it should be ""it can't access our C++
  hardware interface directly; instead it must go through this interface.""
* "", do not confuse it with the WEbFM DOM interface(nsIDOMFMRadio).""
  This is a comma splice, but it's corrected if you take the suggestion above.
  It's not clear what ""it"" refers to here.  It would be better to say ""Do not
  confuse /this interface/"".
  Space before the open parenthesis.
s/will be/is
(I have no idea what rule explains why we use the present tense for the first
part of this conditional and the future tense for the second part.)
I still don't get why we expose the frequency in KHz here and in MHz in the DOM
interface, but it's not a big deal.
s/plugged/plugged in/
(You can think of ""plugged in"" as a transitive verb.  Compare ""My tub is no
longer leaking; the hole is plugged,"" and ""I plugged in my antenna."")
s/by giving settings/with the given settings/
Do you still need the jscontext?
Seek to the next available channel (up or down).
Get the current settings.
Do you still need the jscontext?
Set the frequency in KHz
""state /is/ changed"", or ""state changes"".
Clearer would be ""Fired when the antenna goes from plugged in to unplugged (or
vice versa).""
s/the/a
The ""ns"" prefix is what we used before we had namespaces (and what we use now
in places where we don't have namespaces, like interfaces).
I'd be OK if this class lived in the top-level namespace.  Otherwise, if you
rename it to FMRadioSettings and leave it in mozilla::dom::fm that works too.
Please rename ""spaceType"" here and elsewhere.
I think mHeadphoneState and mHeadphoneObserver (or mHeadphoneSwitchState and
mHeadphoneSwitchObserver) would be better names here.  There are lots of
switches and observers you might otherwise have.
When you remove the nsAutoPtr below, you can remove this include, too.
Looks like you missed my earlier comment about this hunk:
Please indent ""/* default = */ false"" so it's the ""D"" in
DOM_FM_ANTENNA_INTERNAL_PREF.
You could change this to
  info.upperLimit() = settings->GetUpperLimit();
if you made this attribute [infallible].
nsRefPtr, not nsAutoPtr.
This is actually quite important, and I'm surprised it's not causing crashes.
nsAutoPtr does not call AddRef() on its member.  So that means that *_retval
has a refcount of 0, while the caller of this function expects it to have a
refcount of 1.  Which means we're likely to run into a use-after-free crash
here.",CODE_REVIEW,0,FULL_TOKEN
779500,113,"Comment on attachment 660361
all-in-one patch, v4
Nit: Put the && on the line above.  (As a rule, we don't start a line with a
binary operator like && or +.)
It's pretty confusing to flip the boolean around like this.
I don't care which way the boolean goes, but can we make it consistent?
Just |return FM_BANDS[...] + roundedPart;|
Like I said in the earlier review, I think this would be better if you moved
the large |case| bodies into their own functions, particularly because it would
let you do early returns instead of these long |else| clauses.  The small
|case| bodies are fine how they are.
s/being enabled currently/currently being enabled/
s/frequecy/frequency/
When you split out this code into a method, perhaps you can combine seekUp and
seekDown, if that makes sense.
r=me on the JS bits.  I'd like to take another look at the C++ parts.  And we
still need that review from a build peer.",CODE_REVIEW,0,FULL_TOKEN
779500,114,"Thanks a lot for correcting my english written sentences. If you feel
re-writting the whole sensence is a lot easier for you, please do it.
Either way works for me. I am really appreciate.
I think the interface is kind of a hal::FMRadioSettings ""copy"", i am trying to make them consistent.
BTW, in the WebFM idl, we call this ""channelWidth"", should we change it too? or call this ""channelWidth"" in anywhere?
Cool~
I am trying to make it consistent with the hal part.
Because there is hal::FMRadioSettings, it is easy to be confused, I prefer keep the ""ns"" prefix, and move it to the top-level namespace.",CLARIFICATION,0,FULL_TEXT
779500,115,"Ah, I understand.  There are a lot of moving parts here!
I'm happy to land this how it is and then change everything all at once.
Oh, right.  :)  Either channelWidth or channelInterval is fine with me, but yeah, it would be good to be consistent.",UNCODED,0,UNMATCHED
779500,116,"Then i will rename them all to ""channelWidth"".
And what do you think about the comment #107 ?",CODE_REVIEW_REQUEST,0,FULL_TOKEN
779500,117,"Sounds good so far...
The problem is that if we ever changed the enum, existing settings would be broken?  Sounds like the solution is a big fat warning on the enum definition...",UNCODED,0,UNMATCHED
779500,118,"Here is the enum definition for the country:
So, we should map the ""fmRadio.regionCode"" setting like this:
  us -> 0, eu -> 1, de -> 4
If we change the enum, say insert FM_RADIO_COUNTRY_CN before FM_RADIO_COUNTRY_EU, the map will have to be changed like this:
  us -> 0, eu -> 2, de -> 5
unless we promise all the new values will be appended and no value will be removed.
If i am wrong, please correct me.",SOLUTION_REVIEW_REQUEST,0,FULL_TOKEN
779500,119,"[infallible] attributes are only allowed on [builtinclass] interfaces, however, if i add [builtinclass] to nsIFMRadio, then the function FMRadio::enable(nsIFMRadioSettings settings) is not callable from JS, here is the error:
  [JavaScript Error: ""NS_ERROR_FAILURE: Failure arg 0 [nsIFMRadio.enable]"" {file: ""resource://gre/modules/DOMFMRadioParent.jsm"" line: 423}]",SOLUTION_VERIFICATION,0,FULL_TOKEN
779500,120,[builtinclass] can't be used on interfaces implemented in JS.,SOLUTION_REVIEW,1,FULL_TEXT
779500,121,"Created attachment 660726
part A - MOZ_B2G_FM option",UNCODED,0,UNMATCHED
779500,122,"Created attachment 660727
part B - nsIDOMFMRadio IDL, v1.1",UNCODED,0,UNMATCHED
779500,123,"Created attachment 660728
part C - mozFMRadio v5",UNCODED,0,UNMATCHED
779500,124,"It worries me that every time the signal strength changes, we broadcast to all child processes.
Maybe if the signal strength were bucketed very coarsely (e.g. ""no signal"", ""moderate signal"", ""good signal""), this would be OK.  But if we're reporting a fine-grained value, I'm afraid this is going to result in a /lot/ of useless messages, every two seconds.
Maybe we should hold off addressing this until we rewrite this whole thing in C++ -- in C++, this is easy to address, because it's just a matter of registering the only the observers you need with hal (I think?).",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
779500,125,"Comment on attachment 660727
part B - nsIDOMFMRadio IDL, v1.1
The only change here is the comment over addEventListener?  r=me, in that case.
(I'd s/, i.e.:/:/ -- ""i.e."" doesn't make much sense here -- but that's a small point.  Most native speakers regularly use ""i.e."" less sensibly than this.  :)",CODE_REVIEW,0,80_PCT_MATCH
779500,126,"Comment on attachment 660728
part C - mozFMRadio v5
I don't think you meant to add this newline.
Part of the benefit of pulling these chunks into their own functions was that
""it would let you do early returns instead of these long |else| clauses.""  That
is, you could do here
  if (...) { 
    sendMessage(...);
    return;
  }
  // The rest of the method.
It's not particularly important, but this is a common point of style in Gecko,
so you might as well familiarize yourself with it.  :)
Um...I have no idea where this BTDEBUG thing came from, but it's no good.
You're just defining LOG to printf for non-gonk systems.
A simple fix that I would be OK with is
#else
//#define LOG(args...) printf(args);
#define LOG(args...)
#endif
A better fix would be to use prlog.  See e.g. dom/ipc/ProcessPriorityManager.cpp.
See bug 749053 comment 111 -- apparently we /are/ getting dB's from the radio,
not a magic value between 1-100.  :)
Maybe the solution will be for hal to give us a value in dB, and then we'll
translate it into a value 0-5 here.  I'm not quite sure yet, but stay tuned, I
guess.
Oh no, I wasn't clear at all!  It should be ""If the WebFM API /is/ re-written
in C++ some day, this interface /will be/ useless.""
(More correctly, you'd probably use the subjunctive here: ""If the interface
were to be rewritten, this would be useless.""  But most people ignore that...)
Sorry.  :(",ASSIGNEE_REQUEST,0,90_PCT_MATCH
779500,127,Yes,UNCODED,0,UNMATCHED
779500,128,"I copied them from dom/bluetooth/linux/BluetoothDBusService.cpp and dom/bluetooth/linux/BluetoothDBusUtils.cpp.
Then we should change the type of signalStrength to ""long"", like this:
    /**
     * The signal strength.
     * The value returned is between 0 (no signal) and 5 (full signal), inclusive.
     */
    readonly attribute long signalStrength;
?",UNCODED,0,UNMATCHED
779500,129,"I think the choice is between doing a 0-5 (or whatever) conversion or reporting the signal strength in dB's and letting the website figure out how to show that to the user.
If we did 0-5, it's not clear how to correctly convert dBm into that scale.  At best, I guess we'd listen to the radio under different conditions and qualitatively rate how good it sounds.  Then we could correlate these qualitative measurements with the signal strength in dBm.
If otoh we spit out dBm, then the FM radio app author is going to have to do this experiment him or herself, if she wants to show a meaningful signal strength indicator to the user.
OTOH, the app may be interested in the real signal strength, instead of our arbitrary number.  And it will be hard to spec our arbitrary scale in a meaningful way.
My gut feeling is that we should just report raw dBm, since that's a meaningful number.  We can always add a 0-5 (or whatever) scale if necessary.  And then we should make it a priority after landing this bug to get rid of that broadcast I mentioned earlier, since as written, it looks like we're going to broadcast the FM radio signal strength to all processes every 2 seconds (since I imagine the dBm value will be different every time we read it, if only by a small amount).
But I'm not wed to that idea.  What do you think?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
779500,130,If we are talking about signal strength then dBm sounds great to me. That seems much more standard than any 0-5 scale we can invent.,SOLUTION_REVIEW,1,FULL_TEXT
779500,131,"Um, Jonas, can you unset the security bit?",CODE_UPDATE_REQUEST,0,FULL_TEXT
779500,132,"If we expose the raw value in dBm, i really doubt that the different FM chips won't have the same ranges, i check the spec of Si4709: 
  http://www.silabs.com/Support%20Documents/TechnicalDocs/Not-Rec-for-New-Designs%20Si4708-09-B.pdf
i search the keyword ""rssi"" in this spec, thought i don't know the exact range of the rssi, it seems that the rssi range won't be the same as the FM chip of the Otoro (i.e [-120, -20]).
If i will create a FM app, i think [0-5] is enough, i don't want to spend anytime to figure out the min and max value it should be, and how to transform it to a meaningful value. I don't quite understand why the app author should care about the accurate number in dBm, we even don't have a signal strength indicator in the FM app of Gaia.
So in my opinion, we should provide a relative signal strength at least, either an int value range from 0 to 5, or just keep it as a float value range from 0 to 1.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
779500,133,"Maybe we can just cut out the signal strength for now, if we don't need it for the FM app.  Then we wouldn't have to worry about scaling the logarithmic dBm units to more user-friendly units, and we wouldn't have to worry about that broadcast() call.",SOLUTION_REVIEW,1,FULL_TOKEN
779500,134,"Em, it's not a bad idea, Jonas, what do you think?",SOLUTION_REVIEW_REQUEST,0,FULL_TEXT
779500,135,Sounds good,UNCODED,0,UNMATCHED
779500,136,"Created attachment 662058
part A - MOZ_B2G_FM option
rebased the lastest m-c",CODE_IMPLEMENTATION,1,FULL_TEXT
779500,137,"Created attachment 662059
part B - nsIDOMFMRadio IDL, v1.2
Removed signalStrength and onsignalstrengthchange",CODE_IMPLEMENTATION,1,FULL_TEXT
779500,138,"Created attachment 662062
part C - mozFMRadio v5.1
- Rebased the lastest m-c
- Removed signalStrength related codes
- Fixed nits based on the comment 124 and comment 125",CODE_IMPLEMENTATION,1,FULL_TOKEN
779500,139,- Used the interfaces of the latest patches of the bug 749053,CLARIFICATION,0,FULL_TEXT
779500,140,"Hi, Kyle, do you have a plan to review this?",CODE_REVIEW_REQUEST,0,FULL_TEXT
779500,141,"Comment on attachment 662058
part A - MOZ_B2G_FM option
Review of attachment 662058:
-----------------------------------------------------------------
::: configure.in
@@ +7346,5 @@
Does this really need a configure option? It doesn't seem so. Please just AC_SUBST(MOZ_B2G_FM)
::: dom/Makefile.in
@@ +83,5 @@
There's not much point putting this on 3 lines. Just PARALLEL_DIRS += fm on one.",CODE_REVIEW,0,FULL_TEXT
779500,142,"Created attachment 662584
part A - MOZ_B2G_FM option v2
review comments addressed. AC_DEFINE was left in since there is code looking for that define.",CODE_IMPLEMENTATION,1,FULL_TEXT
779500,143,"All patches were folded into one commit.
https://hg.mozilla.org/integration/mozilla-inbound/rev/75923725b2fc",CODE_IMPLEMENTATION,1,FULL_TOKEN
779500,144,"I backed out a range of patches including this one which caused a perma-leak in all of our test suites on debug builds:
https://hg.mozilla.org/integration/mozilla-inbound/rev/e60144694d56",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
779500,145,https://hg.mozilla.org/integration/mozilla-inbound/rev/432033434b3a,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
779500,146,https://hg.mozilla.org/mozilla-central/rev/432033434b3a,UNCODED,0,UNMATCHED
779500,147,"Here is the doc: https://developer.mozilla.org/en-US/docs/DOM/WebFM
I would love if someone could review it and say if something is obviously missing or wrong.
Thanks.",UNCODED,0,UNMATCHED
779500,148,"This is a nit, but cell phones contain many radios (e.g. fm, gsm, wifi, bluetooth, nfc).  The WebFM API provides access to a device's /FM radio/.  I might additionally say in the introduction what you can do using the WebFM interface: ""This interface lets you turn the FM radio on and off and tune it to different stations.""
We're missing the channelWidth attribute.
I think this unfairly singles out the |frequency| attribute here in a way which may cause confusion.
Reading /any/ attribute in JS is a synchronous operation.  There is no such thing as an asynchronous attribute in JavaScript.
In general we care about synchronicity when it can cause disk I/O, because that's very slow.  That's why we don't like localStorage, for example.
It's true that reading the |frequency| attribute causes a synchronous call up to the parent process.  But as it turns out, we do a sync operation when reading all of the other attributes, as well.  The parent process does no I/O upon receiving one of these messages.
So either all of the attributes deserve a warning, or none of them does.  The issue isn't that a synchronous operation occurs, because that's how attributes work, but rather that we wait on a synchronous IPC message.  This isn't free, but it's a lot cheaper than sync I/O, so I'm not sure we want devs to be particularly scared of this.
Certainly you shouldn't expect getting the frequency (or any of the other attributes) to be fast, however.
Perhaps ""down to which""?  Really, this isn't sufficiently clear.  For example, can I manually set the FM radio frequency outside this bound?
What are the return values of these methods?  I think they return DOM requests, but we don't say so.
It looks good to me aside from these issues.  Thanks for your hard work here.",UNCODED,0,UNMATCHED
779500,149,"Yeah, I usually write the intro first and I should write it last instead, because at first, I don't know much about what's possible.
Taking your sentence as is. Thanks.
Oops. Added. Thanks.
 
Yes, I tend to use ""synchronous"" where I should talk about ""blocking"" and I really should stop doing that.
Wow, that's super important! I removed the warning on the particular frequency attribute, but a general warning should be provided. I'll think about how to do that in a generic manner on the doc.
Taking this discussion to dev-webapi to not further pollute the bug.
I've added a note to the setFrequency method.
fixed.
Thanks for your review, Justin.",UNCODED,0,UNMATCHED
783505,1,"Latest birch (where we ensure OS X still builds with gcc, now that trunk has switched to clang) merge is failing with:
{
../../../../js/src/jstypedarray.cpp:1427: error: template parameter 'ValueGetter' of type 'JS::Value (*)(JSObject*)' is not allowed in an integral constant expression because it is not of integral or enumeration type
}
https://hg.mozilla.org/projects/birch/pushloghtml?startID=117&endID=118
-> bug 777174",PROBLEM_DESCRIPTION,0,90_PCT_MATCH
783505,2,"Also:
B2G macosx64_gecko mozilla-central nightly
https://tbpl.mozilla.org/php/getParsedLog.php?id=14463451&tree=Firefox
{
/builds/slave/m-cen-osx64-gecko-ntly/build/js/src/jstypedarray.cpp: In static member function 'static JSBool TypedArrayTemplate<NativeType>::Getter(JSContext*, unsigned int, JS::Value*)':
/builds/slave/m-cen-osx64-gecko-ntly/build/js/src/jstypedarray.cpp:1427: error: template parameter 'ValueGetter' of type 'JS::Value (*)(JSObject*)' is not allowed in an integral constant expression because it is not of integral or enumeration type
}
Are B2G builds supposed to be using gcc?",ERROR_MESSAGE,0,FULL_TOKEN
783505,3,CCing espindola for last part of comment 1.,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
783505,4,"It looks like this was caused by 777174. The problem reduces to gcc 4.2 not accepting
typedef bool (*NativeImpl)();
template<NativeImpl Impl> inline bool CallNonGenericMethod() {
}
template<typename NativeType> class TypedArrayTemplate  {
  typedef TypedArrayTemplate<NativeType> ThisTypeArray;
  template<int ValueGetter()>
  static bool     GetterImpl()     {
    return CallNonGenericMethod<  ThisTypeArray::GetterImpl<ValueGetter> >();
  }
};",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
783505,5,"git bisect found this to be fixed by http://gcc.gnu.org/bugzilla/show_bug.cgi?id=39608. Which is strange, since is marked as a regression fix. Looking a bit more to see if there is a way to avoid the bug.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
783505,6,"Created attachment 652883
fix gcc 4.2 build.",UNCODED,0,UNMATCHED
783505,7,"I pushed the patch + a hack to use gcc 4.2 to
https://tbpl.mozilla.org/?tree=Try&rev=3c393fe37a76",CODE_IMPLEMENTATION,1,FULL_TOKEN
783505,8,Fwiw att #652883 fixes my openbsd/gcc 4.2 builds too.,SOLUTION_VERIFICATION,0,FULL_TEXT
783505,9,"Comment on attachment 652883
fix gcc 4.2 build.
Review of attachment 652883:
-----------------------------------------------------------------
Oh, I don't know that that hack is ""really bad"". It's the circumstances that are bad; the workaround is sensible enough.
r=me.",CODE_REVIEW,0,FULL_TOKEN
783505,10,https://tbpl.mozilla.org/?tree=Mozilla-Inbound&rev=4d76ec905c11,UNCODED,0,UNMATCHED
783505,11,"https://hg.mozilla.org/integration/mozilla-inbound/rev/4d76ec905c11
http://hg.mozilla.org/mozilla-central/rev/3a0f4470276f
not 100% sure but i think this one can be marked as fixed. my openbsd/gcc 4.2 builds are green again.",SOLUTION_VERIFICATION,0,FULL_TEXT
783505,12,"As is birch (our gcc osx builds) :-)
https://tbpl.mozilla.org/?tree=Birch&rev=716b48dbafe3",STATUS_UPDATE,0,FULL_TOKEN
783505,13,https://hg.mozilla.org/mozilla-central/rev/4d76ec905c11,UNCODED,0,UNMATCHED
783505,14,This has also fixed the OS X nightly builds,SOLUTION_VERIFICATION,0,FULL_TEXT
783505,15,"Are they using gcc? :-(
What mozconfig are they using. They should have switched to clang.",QUESTION,0,FULL_TEXT
783505,16,"The original code fails to compile with gcc 4.3.2 on Linux (Fedora release 10 (Cambridge))
I got it to compile by changing the ""2"" in the patch to a ""3""",ANSWER_TO_QUESTION,0,FULL_TOKEN
783505,17,Oops. Sorry about that.  The ifdef was removed on bug 784029.,CLARIFICATION,0,FULL_TOKEN
790547,1,"When user gets the event list needed to be monitored by SET_UP_EVENT_LIST proactive command in Bug 790543, user needs to inform ICC about the location information when location status is updated.
So we need to add another interface for 'Location Status Event'.
See TS 11.14 clause 11.14 or 
TS 102.223 clause 7.5.4",PROBLEM_MOTIVATION,0,FULL_TOKEN
790547,2,"Yoshi, is this a basecamp blocker?",QUESTION,0,FULL_TEXT
790547,3,"Yes, it's needed in Brazil.",ANSWER_TO_QUESTION,0,FULL_TEXT
790547,4,"Created attachment 661129
WIP - Part 1: Add sendLocationStatus in IDL",UNCODED,0,UNMATCHED
790547,5,"Created attachment 661130
WIP - Part 2: Add SendLocationStatus in IccManager",UNCODED,0,UNMATCHED
790547,6,"Created attachment 661131
WIP - Part 3: Add sendLocationStatus in RIL",UNCODED,0,UNMATCHED
790547,7,"Created attachment 662127
WIP - Part 3: Add sendLocationStatus in RIL. v2
Add RILContentHelper and update bugs in writing locationStatus",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,8,"Created attachment 662856
Part 1: IDL for sendEventDownload v2
renamed sendLocationStatus to sendEventDownload",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,9,"Created attachment 662857
Part 2: Add SendEventDownload in IccManager. v2
Renamed accordingly, also added impl in RadioInterfaceLayer.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,10,"Created attachment 662858
WIP - Part 3: Add send Location Event in RIL. v3
updated to latest IDL change.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,11,"Created attachment 663988
WIP - Part 3: Add send Location Event in RIL v4
Fixed bugs in writing octets,
and revised writing MCC/MNC according to TS 24.008",CODE_IMPLEMENTATION,1,FULL_TOKEN
790547,12,"Created attachment 664004
WIP - Part 3: Add send Location Event in RIL. v5
supply locationInformation only when service state is normal.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,13,"Created attachment 664321
WIP - Part 3: Add send Location Event in RIL. v6
Moved writing location info of TLV into a helper function.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,14,"Created attachment 664326
WIP - Part 4: xpcshell test case for writing Location Info",UNCODED,0,UNMATCHED
790547,15,"Created attachment 664329
Part 3: Add send Location Event in RIL. v7
Renamed writeLocationInfo to writeLocationInfoTlv.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,16,"Created attachment 664330
WIP - Part 4: xpcshell test case for writing Location Info. v2
Renamed accordingly.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,17,"Comment on attachment 664330
WIP - Part 4: xpcshell test case for writing Location Info. v2
Review of attachment 664330:
-----------------------------------------------------------------
g
::: dom/system/gonk/tests/test_ril_worker_icc.js
@@ +226,5 @@
indent!",CODE_REVIEW,0,FULL_TEXT
790547,18,"Created attachment 664335
WIP - Part 4: xpcshell test case for writing Location Info. v3
Fixed indent.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,19,"Comment on attachment 662856
Part 1: IDL for sendEventDownload v2
Hi, philikon:
From Bug 790543, ICC will send a list of events to ME, when one of these events happened, ME need to notify ICC this event through Envelope Command. So this patch is to deal when location status is updated, ME needs to notify this event to ICC by this interface.
For the specification you can refer to TS 11.14 , clause 11.4 ""Location Status Event"".",CLARIFICATION,0,FULL_TOKEN
790547,20,"Comment on attachment 662857
Part 2: Add SendEventDownload in IccManager. v2
Hi, smaug
I add another interface called 'sendStkEventDownload' in nsIDOMIccManager in part 1, the purpose is to send events to ICC.
Would you help to review this patch for me?
Thank you.",CODE_REVIEW_REQUEST,0,FULL_TOKEN
790547,21,"Comment on attachment 664329
Part 3: Add send Location Event in RIL. v7
Hi, philikon
This is the implementations.
Would you review this for me ?
Thank you.",CODE_REVIEW_REQUEST,0,FULL_TOKEN
790547,22,"Comment on attachment 664335
WIP - Part 4: xpcshell test case for writing Location Info. v3
Hi, philikon
This is the xpcshell test for testing writeLocationInfoTlv.
Could you review this for me?
Thank you.",CODE_REVIEW_REQUEST,0,FULL_TOKEN
790547,23,"Created attachment 664395
Part 4: xpcshell test case for writing Location Info. v4
fixed typo in comments.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,24,"try result
https://tbpl.mozilla.org/?tree=Try&rev=07c7b4a4f716",UNCODED,0,UNMATCHED
790547,25,"Created attachment 664405
Part 4: xpcshell test case for writing Location Info. v4
forgot qref. 
sorry",CODE_IMPLEMENTATION,1,FULL_TOKEN
790547,26,"Comment on attachment 664329
Part 3: Add send Location Event in RIL. v7
Review of attachment 664329:
-----------------------------------------------------------------
::: dom/system/gonk/ril_worker.js
@@ +2285,5 @@
should be 
command.eventList = command.eventType;
Thanks for kk11ff to point this out.",CODE_REVIEW,0,FULL_TOKEN
790547,27,"Created attachment 664409
Part 3: Add send Location Event in RIL. v8
Addressed to kk11ff's feedback.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,28,"Comment on attachment 662856
Part 1: IDL for sendEventDownload v2
Review of attachment 662856:
-----------------------------------------------------------------
::: dom/icc/interfaces/SimToolKit.idl
@@ +293,5 @@
You know me, I'm the devil's advocate for flatter structures. So I wonder why MozStkLocationEvent and MozStkLocationInfo can't be merged into one. Does MozStkLocationInfo exist outside of an MozStkLocationEvent context?
::: dom/icc/interfaces/nsIDOMIccManager.idl
@@ +202,5 @@
Same stupid question again: Can't `eventType` not be part of `eventData`, e.g. `eventData.type`? Flat objects FTW! :)
Also, I have a question: does the radio respond to this STK command and if so, how? Should be worth documenting in the comment here.
r=me so far since this could go in, though I would prefer that the above questions were addressed first.",CODE_REVIEW,0,FULL_TOKEN
790547,29,"Comment on attachment 662857
Part 2: Add SendEventDownload in IccManager. v2
Review of attachment 662857:
-----------------------------------------------------------------
I'm sure smaug won't mind if I just r+ this. It's a pretty trivial piece of code.",CODE_REVIEW,0,FULL_TEXT
790547,30,"Comment on attachment 664409
Part 3: Add send Location Event in RIL. v8
Review of attachment 664409:
-----------------------------------------------------------------
::: dom/system/gonk/ril_worker.js
@@ +2325,5 @@
Nit: it would be good to have size consts for the individual building blocks so that these numbers are a bit clearer and not so magical, e.g.
  (options.helpRequested ? SIZE_FOO : 0) +
  (options.eventList ? SIZE_BAR + SIZE_FOO : 0) +",CODE_REVIEW,0,FULL_TOKEN
790547,31,"Comment on attachment 664405
Part 4: xpcshell test case for writing Location Info. v4
Review of attachment 664405:
-----------------------------------------------------------------
I do like tests. <3",CODE_REVIEW,0,FULL_TEXT
790547,32,Hah looks like smaug pre-empted me ;) Yay.,UNCODED,0,UNMATCHED
790547,33,"Hi, philikon
Thanks for your review.
Yes, I understand this.
Sorry for not pointing this out in comments,
in STK spec(TS 11.14), Location Information TLV will be used in several places, proactive command, terminal response, and even call control envelope command(Bug 791939). So finally I move those members of locationInfo out of MozStkLocationEvent and make it MozLocationInfo. So this object could be reused in other places.
Sounds good, I'll make it
void sendStkEventDownload(in jsval eventData);
with moving eventType inside eventData.
For this envelope command, RIL(ICC) won't return any response.
So I update the documentation to point this out.
Thanks for your commens. :)",ANSWER_TO_QUESTION,0,FULL_TOKEN
790547,34,"Created attachment 664831
Part 1: IDL for sendEventDownload v3
Addressed to philikon's comments:
1. move eventType into eventData, and rename eventData to event in sendStkEventDownload.
2. Add documentations to indicate ICC won't respond any data with this command.
I didn't merge MozStkLocationInfo into MozStkLocationEvent, as I explained in my previous comment.
philikon, does my comment make sense to you? 
Thanks",CODE_IMPLEMENTATION,1,FULL_TOKEN
790547,35,"Created attachment 664832
Part 2: Add SendEventDownload in IccManager. v3
Updated parameters in SendStkEventDownload accordingly.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,36,"Created attachment 664868
Part 3: Add send Location Status Event in RIL. v9
Hi, philikon
I addressed your comments to const the size of TLVs,
but for some TLVs, their size will vary according to content.
So in this patch I just const some of them,
but I am not sure if this is better.
Could you review this part again?
Thank you.",CODE_IMPLEMENTATION,1,FULL_TOKEN
790547,37,"Comment on attachment 664831
Part 1: IDL for sendEventDownload v3
Review of attachment 664831:
-----------------------------------------------------------------
Looks good, thanks!
::: dom/icc/interfaces/nsIDOMIccManager.idl
@@ +193,5 @@
s/respond/respond with/",CODE_REVIEW,0,FULL_TEXT
790547,38,"Comment on attachment 664868
Part 3: Add send Location Status Event in RIL. v9
Review of attachment 664868:
-----------------------------------------------------------------
::: dom/system/gonk/ril_consts.js
@@ +544,5 @@
Small nit: this is not a const we need to ""export"", it's an implementation detail, so IMHO would be better at the top of ril_worker (e.g. like PDU_HEX_OCTET_SIZE).
::: dom/system/gonk/ril_worker.js
@@ +2326,5 @@
I'm not quite sure why these can't be const'ed, but I'll take your word for it. This is just a personal pet peeve, I don't want to bikeshed over something unimportant.",CODE_REVIEW,0,FULL_TEXT
790547,39,"Ha, if I don't have to put them in ril_const then I understand now,
will const them in ril_worker. 
Thank you. :)",STATUS_UPDATE,0,FULL_TOKEN
790547,40,"Created attachment 665243
Part 1: IDL for sendEventDownload v4
Addressed to philikon's comments in comment 36.",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,41,"Created attachment 665244
Part 3: Add send Location Status Event in RIL. v10
Addressed to philikon's comment in comment 37",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,42,"Comment on attachment 665243
Part 1: IDL for sendEventDownload v4
Hi, Jonas
From Bug 790543, ICC will send a list of events to ME, when one of these events happened, ME need to notify ICC this event through Envelope Command. So this patch is to deal when location status is updated, ME needs to notify this event to ICC by this interface.
For the specification you can refer to TS 11.14 , clause 11.4 ""Location Status Event"".
Thank you",CLARIFICATION,0,FULL_TOKEN
790547,43,"Comment on attachment 665243
Part 1: IDL for sendEventDownload v4
Review of attachment 665243:
-----------------------------------------------------------------
I can't say that I understand a lot of the STK still :(. But this looks clean to me.",CODE_REVIEW,0,FULL_TEXT
790547,44,"Created attachment 666171
Part 3: Add send Location Status Event in RIL. v11
rebase",CODE_IMPLEMENTATION,1,FULL_TEXT
790547,45,"https://hg.mozilla.org/integration/mozilla-inbound/rev/d0194ff64049
https://hg.mozilla.org/integration/mozilla-inbound/rev/c2e9422b1be8
https://hg.mozilla.org/integration/mozilla-inbound/rev/c249961afd99
https://hg.mozilla.org/integration/mozilla-inbound/rev/48d10ef28d52",UNCODED,0,UNMATCHED
790547,46,"Try run for c286b232f355 is complete.
Detailed breakdown of the results available here:
    https://tbpl.mozilla.org/?tree=Try&rev=c286b232f355
Results (out of 290 total builds):
    success: 271
    warnings: 18
    failure: 1
Builds (or logs if builds failed) available at:
http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/yhuang@mozilla.com-c286b232f355",SOLUTION_VERIFICATION,0,FULL_TOKEN
790547,47,"https://hg.mozilla.org/mozilla-central/rev/d0194ff64049
https://hg.mozilla.org/mozilla-central/rev/c2e9422b1be8
https://hg.mozilla.org/mozilla-central/rev/c249961afd99
https://hg.mozilla.org/mozilla-central/rev/48d10ef28d52",UNCODED,0,UNMATCHED
794507,1,"Consequences:
1. We do not necessarily always show the correct security indicator (especially for EV and maybe for mixed content).
2. We cannot re-validate the certificate of entries from the offline cache since we do not have the cert.",PROBLEM_MOTIVATION,0,FULL_TOKEN
794507,2,"When this bug is fixed, the patch in bug 788365 should be backed out.",ISSUE_IMPACT,0,FULL_TEXT
794507,3,"It seems like the result of this bug is that any HTTPS AppCache-based site is indistinguishable from a site that has broken SSL (e.g. mixed content).
On the B2G phone we show a crossed-out lock icon in the address bar instead of just the globe like we do on desktop. This makes HTTPS sites that use AppCache look like they're doing something wrong--including, in particular, the Mozilla Marketplace. (I haven't actually verified that this is the reason that the broken lock is shown for the Mozilla Marketplace when AppCache is enabled for it, but it seems very likely.)",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
794507,4,"Honza and Michal, do you have time to work on this? Basically we need to serialize/deserialize the securityInfo for each cached page in the offline cache just like we do for the normal cache.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
794507,5,"Created attachment 704743
v1
Damn, I'm fast!",CODE_IMPLEMENTATION,1,FULL_TEXT
794507,6,"Comment on attachment 704743
v1
Review of attachment 704743:
-----------------------------------------------------------------
Honza *is* fast!
Note there is also this code in nsHttpChannel.cpp:
        // XXX: We should not be skilling this check in the offline cache
        // case, but we have to do so now to work around bug 794507.
        MOZ_ASSERT(mCachedSecurityInfo || mLoadedFromApplicationCache);
        if (!mCachedSecurityInfo && !mLoadedFromApplicationCache) {
            LOG((""mCacheEntry->GetSecurityInfo returned success but did not ""
                 ""return the security info [channel=%p, entry=%p]"",
                 this, mCacheEntry.get()));
            return NS_ERROR_UNEXPECTED; // XXX error code
        }
Any suggestions about how to handle previously-offline-cached data (data that was cached before this fix).
The proposed fix looks very simple so we should uplift it to aurora and beta after it's been on central for a week.",CODE_REVIEW,0,FULL_TOKEN
794507,7,"May be a bit drastic, but we could delete manifests loaded via https those don't have the security-info metadata from cache to force update.  Since all items must have same scheme or same origin, we will reload only what we have to reload.
On the other hand, this code (in comment 5) is harmless, so we can remove it in some very future version.  Then, we should log to some console that the cache is obsolete or do the previously suggested thing.",CODE_REVIEW,0,FULL_TOKEN
794507,8,"How about we change the code for conditional requests so that we never add the conditional request headers if we're doing an offline cache update and the existing entry doesn't have a security-info entry?
Also, when we fetch the cache manifest, if the cache manifest itself doesn't have security-info then we should consider the cache manifest as having been updated, to force a refresh of the app.
I agree that it doesn't need to be removed right away and probably can't be, to avoid breaking things. But, the other things I suggest above are very important to do now.",CODE_REVIEW,0,FULL_TEXT
794507,9,"Lee, this bug is the bug where we are working on the fix for the issue that you described in bug 826309. It seems like we're close to having a solution.
In comment 6, Honza wrote:
according to our investigation in bug 826309, there is no same-origin restriction, right?",QUESTION,0,FULL_TEXT
794507,10,"That seems effectively identical to my proposal.  I want to let the cache reload on access.  Deleting or artificial invalidating is the same actually.  However, for the manifest we also have to remove the ""hash"" metadata to prevent seeing the manifest identical even when revalidated.
Reported bug 833834 on that.",ANSWER_TO_QUESTION,0,FULL_TOKEN
794507,11,"Comment on attachment 704743
v1
Great. I think it makes sense to split bug 833834, because we can land the patch in this bug for B2G 1.0 (I hope), whereas the changes in bug 833834 shouldn't be needed for B2G because B2G 1.0 won't have any old data without security-info if this lands before 1.0 is frozen.
I hope we can land the patch on central soon so that Lee can test it out to make sure it solves the problem he reported.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): long-existing bug
User impact if declined: Users will see a scary broken lock icon in the B2G browser (not just a harmless-looking globe like in desktop Firefox) for any site that uses AppCache.
Testing completed: None yet. We should bake this on central for a few days.
Risk to taking this patch (and alternatives if risky): From a correctness/stability standpoint, this patch is very low risk, as we already use the same logic in the regular (not offline) cache. However, there may be some negative performance impact, since we're writing and reading an extra metdata element from the cache, and we know that I/O in the offline cache is prone to performance issues.
String or UUID changes made by this patch: none.",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
794507,12,"To set expectations here, once this has baked for a bit, we'll uplift to FF20 on Aurora and likely land for B2G in the 20+ timeframe. Since we shipped FF18 and FFOS v1.0.0 without this fix, it can wait one more cycle.",CLARIFICATION,0,FULL_TEXT
794507,13,"Comment on attachment 704743
v1
Not taking this change this late in the b2g game.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
794507,14,"Comment on attachment 704743
v1
This can land to Aurora 20, and we'll approve in the 20+ b2g timeframe for v1.",UPLIFT_APPROVAL,0,FULL_TEXT
794507,15,"Comment on attachment 704743
v1
https://hg.mozilla.org/integration/mozilla-inbound/rev/3c95ca16eb66",UNCODED,0,UNMATCHED
794507,16,"Comment on attachment 704743
v1
https://hg.mozilla.org/releases/mozilla-aurora/rev/8c1ae6ca956a",UNCODED,0,UNMATCHED
794507,17,https://hg.mozilla.org/mozilla-central/rev/3c95ca16eb66,UNCODED,0,UNMATCHED
794507,18,"Lee, could you please check the latest Firefox Nightly build and make sure the issue is fixed: http://nightly.mozilla.org/
Note that it may not be fixed for already-AppCached content. But, if you clear your appcache then newly-cached content should work.",VERIFICATION_REQUEST,0,FULL_TOKEN
794507,19,"Hi guys, 
Yes, I can verify that the nightly build has fixed that issue, thank you!!!",SOLUTION_VERIFICATION,0,FULL_TOKEN
797889,1,"We need to avoid sending any IPC messages from IndexedDB after shutdown of the relevant parent protocol (PBrowser for in-Window, PContent for out-of-Window).
This patch implements the (hacky) solution we agreed on; having those protocols tell their IndexedDB subprotocols not to send any more messages.  I also refactored the IPC setup for AsyncConnectionHelper slightly to make this cleaner.
The upcoming patch passes all the tests without assertions on the parent or the child side.",PROBLEM_MOTIVATION,0,FULL_TOKEN
797889,2,"Created attachment 668006
Patch",UNCODED,0,UNMATCHED
797889,3,"Comment on attachment 668006
Patch
Review of attachment 668006:
-----------------------------------------------------------------
::: dom/indexedDB/AsyncConnectionHelper.cpp
@@ +521,5 @@
Can this happen? I think we should be able to assert that it can't...
@@ +525,5 @@
Hm. I don't understand this part. We should chat.
@@ +526,5 @@
You should be able to use GetCurrentTransaction here without needing to ask the request.
::: dom/indexedDB/AsyncConnectionHelper.h
@@ +125,5 @@
Nit: Space above here, and between the rest.
@@ +133,5 @@
Nit: Whitespace
::: dom/indexedDB/IDBDatabase.cpp
@@ +293,5 @@
I think you should set this before calling Close(), otherwise we risk reentering.
::: dom/indexedDB/IDBDatabase.h
@@ +196,5 @@
I really don't think we need a bitfield here. Two bools should be fine.
::: dom/indexedDB/IDBRequest.h
@@ +83,5 @@
I'd rather we not add this since AsyncConnectionHelper already knows the current transaction.
::: dom/indexedDB/ipc/IndexedDBParent.cpp
@@ +67,5 @@
Nit: Remove extra parens
@@ +227,5 @@
mDatabase could be null here, need to check.
Also, if the open request is in progress, do we need to do anything to ensure that it disconnects when it completes?
::: dom/indexedDB/ipc/IndexedDBParent.h
@@ +147,5 @@
Nit: void on its own line.",CODE_REVIEW,0,FULL_TOKEN
797889,4,"Created attachment 668228
Patch
Comments addressed",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
797889,5,https://hg.mozilla.org/integration/mozilla-inbound/rev/72d8054301d2,UNCODED,0,UNMATCHED
797889,6,https://hg.mozilla.org/mozilla-central/rev/72d8054301d2,UNCODED,0,UNMATCHED
801993,2,"try push: https://tbpl.mozilla.org/?tree=Try&rev=01ef459d190a
(I've fixed the orange)",CODE_IMPLEMENTATION,1,FULL_TOKEN
801993,3,"Created attachment 672004
patch",UNCODED,0,UNMATCHED
801993,4,https://tbpl.mozilla.org/?tree=Mozilla-Inbound&rev=ecad7b037795,UNCODED,0,UNMATCHED
801993,5,https://hg.mozilla.org/mozilla-central/rev/ecad7b037795,UNCODED,0,UNMATCHED
811773,1,"Wrapper cached classes unroot themselves in Unlink if they are preserved. This is okay for the preserved-wrapper pointer, because the pointer is cleared, but any other JS pointers in the native are going to still be around, meaning the native will have a dangling pointer until it is destroyed.
Usually, Unlinked objects are unreachable and will only have their destructors called, but this could be combined with other errors in the cycle collector to create sec-crit problems.
There are various ways we may be able to de-footgun this, but as a backportable fix maybe it makes sense to just manually clear these JS fields in Unlink.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
811773,2,"Taking, since my patch for bug 811206 will take care of this.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
811773,3,"The latter two patches in bug 811206 should have fixed this.
We'll get fatal assertions if the code isn't right.
Closing
Andrew, if you disagree, please re-open.",SOLVED_BY_OTHER_ISSUE,0,FULL_TOKEN
811773,4,It would probably be good to backport at least the bits of the final patch that fix things.,SOLUTION_REVIEW,1,FULL_TEXT
811773,5,It would indeed if we think there's a sec-critical bug lurking here. Do we need this on the ESR-10 branch as well?,QUESTION,0,FULL_TEXT
811773,6,While writing the patch for  bug 811206 I didn't see any sg;crit problems.,SOLUTION_VERIFICATION,0,FULL_TOKEN
811773,7,"Since no sec-crit was found, I'll drop that keyword and mark everything as ""fixed"" so it doesn't show up in any queries.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
812431,1,"Regression window (mozilla-inbound-win64-pgo)
Good:
https://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-inbound-win64-pgo/1353020623/
Bad:
https://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-inbound-win64-pgo/1353032056/
Pushlog:
https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=045367d6644e&tochange=a0cd4bcb3217
Regression window (mozilla-inbound-win64)
Good:
https://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-inbound-win64/1353024231/
Bad:
https://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-inbound-win64/1353026752/
Pushlog:
https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=e8c599817e97&tochange=1a53df18c076
Probably triggered by:
Bug #779029 - Mask region ignored when rendering with Direct2D 
More info:
not happens with HW Acceleration disabled",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
812431,2,"Created attachment 682350
no issue.png",UNCODED,0,UNMATCHED
812431,3,"Created attachment 682351
issue.png",UNCODED,0,UNMATCHED
812431,4,"Very minor regression (if at all), but we'd take a low risk fix on Aurora if found.",PROBLEM_REVIEW,0,FULL_TEXT
812431,5,"I think it's not anymore and issue as updated patch in bug #779029 probably fixed this.
Can someone confirm this too?",SOLVED_BY_OTHER_ISSUE,0,FULL_TOKEN
812431,6,"May be there is some regression.
In today's nightly some tab titles are blurred. But bookmarks are normal.
If that helps - I have 4k monitor, and 200% zoom.",SOLUTION_VERIFICATION,0,FULL_TOKEN
812431,7,"It's new issue, which is reported here - bug #1544830.",NEW_ISSUE_FILING,0,FULL_TEXT
817341,1,"Created attachment 687456
patch
In order for the GC statistics to be useful, there has to be a strict hierarchy of phases. Right now, we have a problem where PHASE_MARK_DELAYED can happen both during marking and during sweeping. This patch fixes that.
I also realized that we weren't timing finalization of Ion code, so it fixes that too.",CODE_IMPLEMENTATION,1,FULL_TOKEN
817341,2,"Created attachment 687560
patch v2
I added some extra assertions that ensure that phases are always properly nested. This found one or two problems in the previous version. Here's the updated patch.",CODE_IMPLEMENTATION,1,FULL_TEXT
817341,3,"Comment on attachment 687560
patch v2
Review of attachment 687560:
-----------------------------------------------------------------
Yes, looks good.",CODE_REVIEW,0,FULL_TEXT
817341,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/14893aa56835,UNCODED,0,UNMATCHED
817341,5,https://hg.mozilla.org/mozilla-central/rev/14893aa56835,UNCODED,0,UNMATCHED
817341,6,"FYI, I accidentally checked in a patch for bug 817431 with 817341 in the summary",CLARIFICATION,0,FULL_TEXT
817531,1,"User Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:17.0) Gecko/17.0 Firefox/17.0
Build ID: 20121120062532
Steps to reproduce:
Visited http://www.fotocommunity.com/contest
Actual results:
Background images for the tables (Different photo contests listed) are not beeing loaded. 
Expected results:
Requests for those images are beeing made and result in a 403 since a referer check is made for those requests and the referer beeing sent along with those requests is the request url (for the image asset) itself, not the url for the website including those images.
This seems to be introduced in FF 17, we verified it on Mac, Linux and Windows.
In FF 16 it still worked.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
817531,2,"just wanted to add example html in question:
<table width=""100%"" border=""0"" background=""http://cdn.fotocommunity.com/photos/27941525.jpg"" height=""120"" cellspacing=""5"" cellpadding=""0"">",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
817531,3,"Either I'm missing something our your steps to reproduce are incomplete.
The page http://www.fotocommunity.com/contest looks identical for me in IE9, FF17 and Seamonkey trunk.
Please include steps to reproduce, step by step and attach a screenshot
Is it possible that I have to be logged in ?",S2R_REQUEST,0,FULL_TOKEN
817531,4,"Created attachment 687761
Screenshot with Firefox17",UNCODED,0,UNMATCHED
817531,5,"Matthias,
sorry, but it seems we already deployed a fix for this on our side using css.
I put up some example html: http://www.fotocommunity.net/ff-bug-817531.html
In Firebug you can validate the the Referer beeing sent with the request for http://cdn.fotocommunity.com/photos/27941525.jpg is ""http://cdn.fotocommunity.com/photos/27941525.jpg"", not the URL to the main request.
Thanks,
Moritz",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
817531,6,"Firefox17: Referer: http://cdn.fotocommunity.com/photos/27941525.jpg
Firefox10ESR: Referer: http://www.fotocommunity.net/ff-bug-817531.html
We have 2 regressions here.
The first regression is that we stop loading the image over the net
Last good nightly: 2012-08-15
First bad nightly: 2012-08-16
Pushlog:
http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=86ee4deea55b&tochan
ge=50e4ff05741e
I suspect bug 697230
Some builds later we start to load the image again but with the wrong referer header
Last good nightly: 2012-08-24
First bad nightly: 2012-08-25
Pushlog:
http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=1c0ac073dc65&tochan
ge=f077de66e52d
I suspect bug 783162",PROBLEM_LOCALIZATION,0,FULL_TOKEN
817531,7,"Ah, the wrong referrer thing is definitely from bug 783162.  This part in nsGenericHTMLElement::ParseBackgroundAttribute:
+    mozilla::css::URLValue *url =
+      new mozilla::css::URLValue(buffer, baseURI, uri, NodePrincipal());
should be:
    mozilla::css::URLValue *url =
      new mozilla::css::URLValue(uri, buffer, doc->GetDocumentURI(), NodePrincipal());
I think.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
817531,8,"Created attachment 688325
Fix the referrer header for background image loads.",UNCODED,0,UNMATCHED
817531,9,https://hg.mozilla.org/integration/mozilla-inbound/rev/d26382bc6411,UNCODED,0,UNMATCHED
817531,10,"Comment on attachment 688325
Fix the referrer header for background image loads.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): Bug 783162.
User impact if declined: Referrer for background images via HTML ""background""
   attributes is the image itself, not the document, possibly breaking some sites.
Testing completed (on m-c, etc.): Passes automated test.
Risk to taking this patch (and alternatives if risky): Risk should be very low.
String or UUID changes made by this patch: None",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
817531,11,"Backed out for:
REFTEST TEST-UNEXPECTED-FAIL | http://10.250.48.232:30278/tests/layout/reftests/backgrounds/background-referrer.html | image comparison (==), max difference: 255, number of differing pixels: 800000
https://tbpl.mozilla.org/php/getParsedLog.php?id=17684273&tree=Mozilla-Inbound
https://hg.mozilla.org/integration/mozilla-inbound/rev/dee7d08baf04",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
817531,12,"I'm going to reland with the test disabled on android, for now, and work on debugging why the test fails there.",STATUS_UPDATE,0,FULL_TEXT
817531,13,And it's a bit worrisome that I never got bugmail for comment 10.  :(,CLARIFICATION,0,FULL_TOKEN
817531,14,Relanded as https://hg.mozilla.org/integration/mozilla-inbound/rev/a381a84d7af2,CODE_IMPLEMENTATION,1,FULL_TEXT
817531,15,Looks like Android uses a different hostname.  Fixed the test to deal with that and reenabled it on Android: https://hg.mozilla.org/integration/mozilla-inbound/rev/732f04efe8f5,CODE_IMPLEMENTATION,1,FULL_TOKEN
817531,16,"https://hg.mozilla.org/mozilla-central/rev/a381a84d7af2
https://hg.mozilla.org/mozilla-central/rev/732f04efe8f5",UNCODED,0,UNMATCHED
817531,17,"Comment on attachment 688325
Fix the referrer header for background image loads.
low risk regression fix, approving.",UPLIFT_APPROVAL,0,FULL_TOKEN
817531,18,"https://hg.mozilla.org/releases/mozilla-aurora/rev/09cd0914f357
https://hg.mozilla.org/releases/mozilla-aurora/rev/9418dbcb8336
https://hg.mozilla.org/releases/mozilla-beta/rev/a918092d9d51
https://hg.mozilla.org/releases/mozilla-beta/rev/272e116f4ee7",UNCODED,0,UNMATCHED
817531,19,Tracking for QA.,UNCODED,0,UNMATCHED
817531,20,"I confirm the fix is verified on MacOS 10.8, Windows 7 x64 and Ubuntu 12.04 on FF 20RC:
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0
Mozilla/5.0 (X11; Linux i686; rv:20.0) Gecko/20100101 Firefox/20.0
Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:20.0) Gecko/20100101 Firefox/20.0",SOLUTION_VERIFICATION,0,FULL_TOKEN
822952,1,"While in the debugger I noticed a large number of calls to nsHTMLMediaElement::ChangeReadyState via UpdateReadyStateForData hitting the early-exit path because the ready state was not changing.  MediaDecoderStateMachine::UpdateReadyState is called from multiple places and dispatches an event each time, even if the state is unchanged.  This can result in many events being created and dispatched during a single video frame.
With a simple current == last status early-exit path added to MediaDecoderStateMachine::UpdateReadyState, the number of events created and dispatched for a simple play-through of a 5 minute video drops from ~140,000 (~468/s or ~15/frame) to 3.",PROBLEM_MOTIVATION,0,FULL_TOKEN
822952,2,"Created attachment 693745
patch v0
Tests pass locally.  Try push: https://tbpl.mozilla.org/?tree=Try&rev=9c79c64b62d2",CODE_IMPLEMENTATION,1,FULL_TOKEN
822952,3,"Comment on attachment 693745
patch v0
Review of attachment 693745:
-----------------------------------------------------------------
Good catch",CODE_REVIEW,0,FULL_TEXT
822952,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/5f697a87ec46,UNCODED,0,UNMATCHED
822952,5,https://hg.mozilla.org/mozilla-central/rev/5f697a87ec46,UNCODED,0,UNMATCHED
823917,1,MSVC11 supports C++11 final keyword.,PROBLEM_MOTIVATION,0,FULL_TEXT
823917,2,"They've supported equivalent functionality through a contextual ""sealed"" keyword since MSVC 2005.  Is this only about making MOZ_FINAL expand to final rather than sealed in new-enough MSVC?  I'm not complaining if you do that, but it doesn't seem to matter to me much, and if it were me I'd leave it all alone until every compiler we support supports the final contextual keyword.",PROBLEM_REVIEW,0,FULL_TOKEN
823917,3,"Created attachment 695276
Use C++11 final on MSVC11
After all, I wrote the patch with another cleanup.
|#if _MSC_VER >= 1400| is redundant because our minimum compiler requirement is MSVC 2005 (Or MFBT has a different requirement?).",CODE_IMPLEMENTATION,1,FULL_TOKEN
823917,4,"Try result (along with other patches):
https://tbpl.mozilla.org/?tree=Try&rev=ee97ff67d30b",CODE_IMPLEMENTATION,1,FULL_TOKEN
823917,5,"Comment on attachment 695276
Use C++11 final on MSVC11
Review of attachment 695276:
-----------------------------------------------------------------
mfbt follows overall JS/Gecko compiler requirements (or at least there's been no reason not to follow them so far).  rs=me",CODE_REVIEW,0,FULL_TOKEN
823917,6,https://hg.mozilla.org/integration/mozilla-inbound/rev/001b109e68c4,UNCODED,0,UNMATCHED
823917,7,https://hg.mozilla.org/mozilla-central/rev/001b109e68c4,UNCODED,0,UNMATCHED
833964,1,"Created attachment 705532
processed dump
Seen while dogfooding over the weekend.  Was doing heavy browsing and opening/closing a lot of tabs.  No better STR atm.
Crash reason:  SIGSEGV
Crash address: 0x6c003a
Thread 0 (crashed)
 0  libxul.so!mozilla::layers::AsyncPanZoomController::ContentReceivedTouch [AsyncPanZoomController.cpp : 1346 + 0x4]
     r4 = 0x4aef1800    r5 = 0x00000000    r6 = 0xbe87e090    r7 = 0x00050024
     r8 = 0xbe87e760    r9 = 0x4030990c   r10 = 0x00000000    fp = 0x00000000
     sp = 0xbe87de60    lr = 0x40b0ef0f    pc = 0x411ef462
    Found by: given as instruction pointer in context
 1  libxul.so!mozilla::layout::RenderFrameParent::ContentReceivedTouch [RenderFrameParent.cpp : 978 + 0x3]
     r4 = 0xbe87e090    r5 = 0xbe87e6fc    r6 = 0xbe87e090    r7 = 0x00050024
     r8 = 0xbe87e760    r9 = 0x4030990c   r10 = 0x00000000    fp = 0x00000000
     sp = 0xbe87de70    pc = 0x40b0ef0f
    Found by: call frame info
 2  libxul.so!mozilla::dom::TabParent::RecvContentReceivedTouch [TabParent.cpp : 1304 + 0x5]
     r4 = 0xbe87e090    r5 = 0xbe87e6fc    r6 = 0xbe87e090    r7 = 0x00050024
     r8 = 0xbe87e760    r9 = 0x4030990c   r10 = 0x00000000    fp = 0x00000000
     sp = 0xbe87de78    pc = 0x4105d685
    Found by: call frame info
 3  libxul.so!mozilla::dom::PBrowserParent::OnMessageReceived [PBrowserParent.cpp : 1477 + 0xb]
     r4 = 0x47047ec0    r5 = 0xbe87e6fc    r6 = 0xbe87e090    r7 = 0x00050024
     r8 = 0xbe87e760    r9 = 0x4030990c   r10 = 0x00000000    fp = 0x00000000
     sp = 0xbe87de80    pc = 0x410978a7
    Found by: call frame info",STACK_TRACE,0,FULL_TOKEN
833964,2,Without an STR we can't block but let's track this.,CLARIFICATION,0,FULL_TEXT
833964,3,"Chris, are you on Otoro?",QUESTION,0,FULL_TEXT
833964,4,"I only see these... which seem different:
https://crash-stats.mozilla.com/report/list?product=B2G&query_search=signature&query_type=contains&query=layers%3A%3AAsyncPanZoomController%3A%3AContentReceivedTouch&reason_type=contains&date=02%2F05%2F2013%2019%3A59%3A13&range_value=1&range_unit=weeks&hang_type=any&process_type=any&do_query=1&signature=mozilla%3A%3Alayers%3A%3AAsyncPanZoomController%3A%3AContentReceivedTouch
https://crash-stats.mozilla.com/report/index/1c7e05a0-dd5e-4934-af89-f27cf2130131",PROBLEM_REVIEW,0,FULL_TOKEN
833964,5,to clarify : I am seeing those on socorro.  Not the actual device.,CLARIFICATION,0,FULL_TOKEN
833964,6,"I saw the crash on unagi, but none of this code is device specific.",UNCODED,0,UNMATCHED
833964,7,"Just guessing:
Guessing it had to do with browser, the parent tab, a frame and zooming?
Since zooming doesn't change when following a link in the same tab, maybe it crashed during the opening a web page that had an iframe?
Going to toy with that idea.",PROBLEM_REVIEW,0,FULL_TOKEN
833964,8,There have been no crashes since 18.0/20130131.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
833964,9,Do we still need qawanted on this? Looks like the crash isn't reproducible at this point.,QUESTION,0,FULL_TEXT
833964,10,"I am not sure it's fixed. Indeed, crashes occurred in B2G 18.0/20130222.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
833964,11,It still occurs: bp-8cf2155f-801d-4c88-9612-f13af2130319.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
833964,12,"Build ID: 20130404070202
This crash is occured to leo device.
We got a same dump file to Comment 10.
This issue reproduced when the complex web page is opening accroding to click link in bookmarked twiter on homescreen.(1 time)
It concerned us that this issue could be reproduce many times to be used the FFOS by many people.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
833964,13,Can you provide the URL where this was reproducible?,INFO_REQUEST,0,FULL_TEXT
833964,14,"Partners are considering this a blocking issue (in triage right now). We'll start this off as leo+ assuming that QA is either able to repro, or engineering can easily figure out the issue from the stack. Otherwise we'll move this back to blocking-b2g:-.",ANSWER_TO_QUESTION,0,FULL_TEXT
833964,15,Joe - Does the crash stack give any indication of what might not be working here? Any hints on what STR might cause this stack?,QUESTION,0,FULL_TEXT
833964,16,"I have absolutely no clue about APZC; I understand that Anthony Jones does, but I think he's indisposed at the moment. Maybe roc has some idea who would.",ASSIGNEE_REQUEST,0,FULL_TEXT
833964,17,"If the crash report
https://crash-stats.mozilla.com/report/index/8cf2155f-801d-4c88-9612-f13af2130319
https://crash-stats.mozilla.com/report/index/1c7e05a0-dd5e-4934-af89-f27cf2130131
corresponds to 
https://hg.mozilla.org/releases/mozilla-b2g18/annotate/051fa7fa5ded/gfx/layers/ipc/AsyncPanZoomController.cpp
https://hg.mozilla.org/releases/mozilla-b2g18/annotate/d5d6ef77f2d9/gfx/layers/ipc/AsyncPanZoomController.cpp
respectively, they both crash at:
    mTouchListenerTimeoutTask->Cancel();
Are we hitting a race-condition problem? Since both Cancel() and ~RunnableMethod() in class RunnableMethod call ReleaseCallee(), which is obviously not thread safe:
  void ReleaseCallee() {
    if (obj_) {
      RunnableMethodTraits<T>::ReleaseCallee(obj_);
      obj_ = NULL;
    }  
  }",PROBLEM_REVIEW,0,FULL_TOKEN
833964,18,"If I understand correctly, all accesses to mTouchListenerTimeoutTask happen on the controller/UI thread. So there shouldn't be a threading-related race condition here.
I don't see how we'd crash here though. mTouchListenerTimeoutTask should always be null or a valid pointer...",PROBLEM_REVIEW,0,FULL_TOKEN
833964,19,"So AFAICT the actual CancelableTask object pointed to mTouchListenerTimeoutTask is created in NewRunnableMethod (either at line 235 or line 267) and is deleted by the message loop code, I think around [1]. This means that once the task finished executing (i.e. the TimeoutTouchListeners method finishes), the pointer mTouchListenerTimeoutTask is pointing to garbage if it hasn't been nulled out explicitly. This could happen if, for example, the early-exit condition at the top of ContentReceivedTouch gets hit when TimeoutTouchListeners gets called. I don't know if there that early-exit condition  is guaranteed to never hit when being called through TimeoutTouchListeners but I don't think it is.
So, in a nutshell:
- mTouchListenerTimeoutTask is assigned and TimeoutTouchListeners is queued as a delayed task
- TimeoutTouchListeners runs
- The call to ContentReceivedTouch from TimeoutTouchListeners does an early exit at the top
- The message loop deletes the object pointed to by mTouchListenerTimeoutTask since it's done
- Some time later (could be much later, since mTouchListenerTimeoutTask is never re-assigned when non-null, except in ContentReceivedTouch), content calls into ContentReceivedTouch
- This time the early exit doesn't get hit
- Since mTouchListenerTimeoutTask is non-null, calling ->Cancel() on it goes boom.
In terms of fixing it, I see two options: one is to move the mTouchListenerTimeoutTask cancellation/nulling to the top of the method, before the early exit. I don't know if this will have other side-effects because I don't know what that check is doing exactly. The second option, much safer, is to just set mTouchListenerTimeoutTask to null in TimeoutTouchListeners(). We know the only place that function gets called is from the task, and once it's done, the task will be destroyed, so we might as well null out the pointer to it.
[1] http://mxr.mozilla.org/mozilla-central/source/ipc/chromium/src/base/message_loop.cc#416",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
833964,20,"Created attachment 739074
Null out potentially dangling pointer
Not sure who should review this exactly. See above comment for an explanation of what I think is happening.",CODE_REVIEW_REQUEST,0,FULL_TEXT
833964,21,Pulling qawanted - we're unblocked here to fix this bug.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
833964,22,"Comment on attachment 739074
Null out potentially dangling pointer
Review of attachment 739074:
-----------------------------------------------------------------
Makes perfect sense to me. I don't even really think this needs a comment explaining it.",CODE_REVIEW,0,FULL_TEXT
833964,23,"Created attachment 739209
Null out potentially dangling pointer (v2)
Updated patch to remove comment. I also felt it was kind of unnecessary.",CODE_IMPLEMENTATION,1,FULL_TEXT
833964,24,"Adding checkin-needed flag since I'm not sure what the process for landing on b2g-18 is, and it looks like this patch needs to go there.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
833964,25,https://hg.mozilla.org/integration/mozilla-inbound/rev/3231056b600d,UNCODED,0,UNMATCHED
833964,26,Thanks!,UNCODED,0,UNMATCHED
833964,27,https://hg.mozilla.org/mozilla-central/rev/3231056b600d,UNCODED,0,UNMATCHED
833964,28,https://hg.mozilla.org/releases/mozilla-b2g18/rev/07c23b20d870,UNCODED,0,UNMATCHED
833964,29,"Hit this on 1.0.1 branch: https://crash-stats.mozilla.com/report/index/18fe8cd7-d78e-4e4c-b2d6-bd3ff2130516
Nominating for consideration. The issue was hit while aggressively panning and zooming in testing scenarious related to Bug 847592.",SOLUTION_VERIFICATION,0,FULL_TOKEN
833964,30,"Glad we have better STR, but still only leo+. Don't want to take non-blocking change at this point.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
833964,31,"We tested this page ""http://www.naver.com""",ANSWER_TO_QUESTION,0,FULL_TEXT
833964,32,It's #5 top crasher in B2G 18.0.,UNCODED,0,UNMATCHED
833964,33,Does that mean the patch didn't fix it? Or do the crashing builds not have the patch?,QUESTION,0,FULL_TEXT
833964,34,"Keon and Peak that still crash are running v1.0.1 that doesn't contain the fix.
Currently, B2G top crashers are almost exclusively on Geekphones, the most widespread Fx OS phones.",ANSWER_TO_QUESTION,0,FULL_TOKEN
833964,35,*** Bug 849884 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
835157,1,"Created attachment 706889
v0
These are totally unused and I don't think they are part of anyone's future plans either. If anyone does know why these are here, please speak up.",CODE_IMPLEMENTATION,1,FULL_TEXT
835157,2,"Comment on attachment 706889
v0
Review of attachment 706889:
-----------------------------------------------------------------
Hmm.  I remember why we had these, now.  I think they were used for boxing up primitive |this| values.  I guess whenever we clean up how we handle primitive |this|, we can deal with this sutff then.",CODE_REVIEW,0,FULL_TOKEN
835157,3,https://hg.mozilla.org/integration/mozilla-inbound/rev/77bfa657b930,UNCODED,0,UNMATCHED
835157,4,https://hg.mozilla.org/mozilla-central/rev/77bfa657b930,UNCODED,0,UNMATCHED
837955,1,"In opt builds, we spam these build warnings:
{
docshell/shistory/src/nsSHistory.cpp: In function void {anonymous}::EvictContentViewerForTransaction(nsISHTransaction*):
docshell/shistory/src/nsSHistory.cpp:224:5: warning: unused variable _spec [-Wunused-variable]
docshell/shistory/src/nsSHistory.cpp: At global scope:
docshell/shistory/src/nsSHistory.cpp:66:1: warning: PRLogModuleInfo* GetSHistoryLog() defined but not used [-Wunused-function]
}
This is because we have a bunch of PR_Log-related macros that end up being useless in builds with PR_LOGGING turned off (e.g. opt builds).
Our usual fix for this is to just #define these macros to be empty when PR_LOGGING is off. That fixes this.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
837955,2,"Created attachment 709973
fix",UNCODED,0,UNMATCHED
837955,3,https://hg.mozilla.org/mozilla-central/rev/5490d8c52ff4,UNCODED,0,UNMATCHED
838565,2,"Created attachment 710653
cc taf and nsFind",UNCODED,0,UNMATCHED
838565,3,"Comment on attachment 710653
cc taf and nsFind
2 extra spaces before NS_INTERFACE_MAP_END
Two extra spaces before these macros
Could you split this to two lines. Atm it is a bit too long
2 extra spaces before NS_INTERFACE_MAP_END
2 extra spaces before these macros
This change is for some other bug.",CODE_REVIEW,0,FULL_TEXT
838565,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/526130001ba8,UNCODED,0,UNMATCHED
838565,5,https://hg.mozilla.org/mozilla-central/rev/526130001ba8,UNCODED,0,UNMATCHED
840284,1,"OdinMonkey is currently receiving a lot of testing for valid asm.js code from the Emscripten test suite and all these big beefy Emscripten apps.  What I'm hoping to get out of fuzzing is testing for the type-checker when code *doesn't* validate.  Here, Jesse pointed out that decoder's mutation fuzzer should work well since it'll randomly inject non-asm.js into the middle of valid asm.js.",PROBLEM_MOTIVATION,0,FULL_TOKEN
840284,2,"Note: we'll have to wait for bug 840280 since, atm, out-of-bounds access isn't checking which means it's quite easy to crash odin.",REQUIREMENT,0,FULL_TEXT
840284,3,Isn't there going to be code that's valid but not Emscripten-y?,QUESTION,0,FULL_TEXT
840284,4,"Good question.  Roughly speaking, asm.js is the image of the Emscripten function.",ANSWER_TO_QUESTION,0,FULL_TOKEN
840284,5,"I think so. Would be interesting to have a random code generator based on the type system itself, and/or to mutate asm.js from emscripten in ways that *do* keep it asm.js, not just break out of it. Both would test things just emscripten output does not.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
840284,6,"Additionally, it would be interesting to throw a C fuzzer in front of Emscripten :)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
840284,7,Csmith (http://embed.cs.utah.edu/csmith/) is a high-quality C fuzzer.  They say that they've found bugs in every tool they've tested with it.  The same research group also produces a test case reducer: http://embed.cs.utah.edu/creduce/,POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
840284,8,"As Sam already said, Csmith is the tool of choice for C mutation. LangFuzz can also mutate C with an appropriate grammar, but is not aware of any type system logic in the language, therefore unsuitable for strongly typed languages.",SOLUTION_REVIEW,1,FULL_TEXT
840284,9,"Thanks, I'll take a look at Csmith in emscripten. We should still do fuzzing on the emscripten output though, because the space of outputs generated from clang+emscripten is still constrained, even with random input to it.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
840284,10,"Agreed.  Between Csmith+Emscripten and decoder's mutation-based fuzzer on Emscripten output, it seems like we'll have good coverage of validating and non-validating inputs.",SOLUTION_REVIEW,1,FULL_TOKEN
840284,11,"Created attachment 716296
fuzzing material
Linux64 and OSX64 are done (except for the bugs, of course), so we are ready for fuzzing.  You should be able to pull http://hg.mozilla.org/users/lwagner_mozilla.com/odinmonkey/ and build.  A threadsafe shell would be useful since it allows more realistic operation-callback testing (just add a 'timeout(X)' call at the beginning and the watchdog thread will start firing interrupts every 1/10 of a second).
Attached is the Emscripten benchmark suite; just run each file individually from the shell (no args).  You should see ""warning: Successfully compiled asm.js code"" printed to the console.
A few notes/ideas for fuzzing:
 - It would be good to direct mutations to *inside* function containing the ""use asm"" directive.
 - Some of the benchmarks are tiny (corrections, memopsnjn, primes, copy) and short-running, so it would be fruitful to inject probably-valid asm.js into these scripts to see if you can get a crash or divergent behavior (compared to running either on a trunk shell or an odin shell with the ""use asm"" directive removed).  Note: different recursion limits are expected.
 - Other benchmarks are quite large (bullet.js, fannkuch.js, zlib) and take longer to run (esp if the code doesn't asm.js-type-check; several of these benchmarks are 5-10x slower w/o odin).  However, they compile relatively quickly (<1s) so these would be good files to mutate randomly to test for errors in the typechecker/compiler.  If you set warnings-as-errors (options(""werror"") toggles this option), you'll get a clean exception when compilation succeeds/fails and not have to wait for the actual script to run.
Let me know if you have any problems or ideas.  Alon said he started looking at Csmith and it's already caught an Emscripten bug; I think he'll turn the guns on Odin after he gets out from under the MWC work.",CODE_IMPLEMENTATION,1,FULL_TOKEN
840284,12,"Can you elaborate on how to use timeout() for fuzzing?  Should I just have the fuzzer call ""timeout(1800)"" sometimes?  Or do you want something like bug 831046?",QUESTION,0,FULL_TOKEN
840284,13,"Sure.  In bug 842411, I changed the threadsafe shell so that, when you call ""timeout(X)"", the watchdog thread will JS_TriggerOperationCallback every 10th of a second.  Before X seconds have elapsed, the operation callback will return ""true"", allowing execution to continue.
That'd work.  An improvement would be to add a parameter that lets you configure how often the interrupt occurs.  I was using 10,000 times a second earlier to really stress the Odin path.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
840284,14,"I'll do that, but I'm worried the testcases will depend on timing, so they won't get reduced / bisected (and they might get lost altogether).  Please fix bug 831046 :)",REQUIREMENT,0,FULL_TOKEN
840284,15,"I agree, using timeout for fuzzing won't work. Especially with LangFuzz, the ""replay"" timing is different to the timing while the fuzzer is actually running. Tests are unlikely to reproduce/reduce later on.",SOLUTION_REVIEW,1,FULL_TEXT
840284,16,That's fine.  It's easy enough for me to test this feature by cranking up frequency and running these large Emscripten codes (which I've been doing).,CLARIFICATION,0,FULL_TOKEN
840284,17,"Here's the whole emscripten test suite (asm.js part, so no C++ exceptions etc.), 252 tests, hope it's useful for fuzzing.
http://dl.dropbox.com/u/80664946/emscripten_test_suite.tar.bz2",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
840284,18,"Created attachment 718174
fuzzing material v.2
We just made a fix in the asm.js spec (http://hg.mozilla.org/users/lwagner_mozilla.com/odinmonkey/rev/f61b4dacc3d1) and type system that will reject one of the benchmarks in the previous zip (bullet).  Here is the new version of all the benchmark files.  Let the assault continue.  (Thanks!)",CODE_IMPLEMENTATION,1,FULL_TOKEN
840284,19,Is there a reason not to use the full testsuite that Alon suggested?,QUESTION,0,FULL_TEXT
840284,20,I'll prepare another version of that updated for the new spec.,ANSWER_TO_QUESTION,0,FULL_TEXT
840284,21,Here it is: http://dl.dropbox.com/u/80664946/emscripten_test_suite2.zip,UNCODED,0,UNMATCHED
840284,22,Thanks Alon :),UNCODED,0,UNMATCHED
840284,23,"I've been running the csmith fuzzer, which generates C code, then compiling that to asm.js. So far I've not found a single bug in OdinMonkey, but I've found several in emscripten and LLVM.
decoder, if it would be useful, I can provide a bunch (let me know how many) of randomly-generated asm.js code from csmith for JS-level fuzzing.",SOLUTION_VERIFICATION,0,FULL_TOKEN
840284,24,"Created attachment 720856
csmith fuzzing material
Here are ~100 csmith reduced testcases. I turned on full debug logging in them so they do more ffi calls.",SOLUTION_VERIFICATION,0,FULL_TEXT
840284,25,"Christian: Linux32 and OSX32 should work now, please feel free to fuzz them.  They use a different protection mechanism (segmentation) and the IonMonkey load/store codegen is different, so it'd be valuable to give one of these a go.
Also: should I take the pause in fuzz bugs to indicate you've aimed your barrels elsewhere for the time being or that Odin is surviving?",SOLUTION_REVIEW_REQUEST,0,FULL_TOKEN
840284,26,"Alright, I'll give it a try on Monday for Linux.
Both. I have one more issue with Odin I think, but I currently have to take two days of PTO per week to get all my vacation from last year spent :) So I'm not working as intensively as I am normally.",ANSWER_TO_QUESTION,0,FULL_TEXT
840284,27,"Per policy at https://wiki.mozilla.org/Bug_Triage/Projects/Bug_Handling/Bug_Husbandry#Inactive_Bugs. If this bug is not an enhancement request or a bug not present in a supported release of Firefox, then it may be reopened.",SOLUTION_VERIFICATION,0,FULL_TEXT
840284,28,Probably fixed nowadays :),UNCODED,0,UNMATCHED
851828,1,"Created attachment 725795
Patch (v1)",UNCODED,0,UNMATCHED
851828,2,"Comment on attachment 725795
Patch (v1)
Review of attachment 725795:
-----------------------------------------------------------------
::: tools/profiler/sps_sampler.h
@@ +472,5 @@
Why did you drop <uint32_t>? The return type is still that.",QUESTION,0,FULL_TEXT
851828,3,Please rebase on top of bug 851748,CODE_UPDATE_REQUEST,0,FULL_TEXT
851828,4,"Err I meant this should land on top of bug 851748, not that you have to do it. I can rebase+land this for you when I land bug 851748.",CLARIFICATION,0,FULL_TEXT
851828,5,"That would be great, thanks.",UNCODED,0,UNMATCHED
851828,6,unsigned long and uint32_t are interchangeable...  But I can add it back if you want.,ANSWER_TO_QUESTION,0,FULL_TOKEN
851828,7,Not sure when bug 851748 will land...,CODE_UPDATE_REQUEST,0,FULL_TEXT
851828,8,Going to try and land this today.,STATUS_UPDATE,0,FULL_TEXT
851828,9,"Created attachment 729627
rebased",UNCODED,0,UNMATCHED
851828,10,https://hg.mozilla.org/integration/mozilla-inbound/rev/f5a256c02fc6,UNCODED,0,UNMATCHED
851828,11,"Backout for Mochitest failures:
https://hg.mozilla.org/integration/mozilla-inbound/rev/c9ac624cfc84",IMPLEMENTATION_REVERSION,0,FULL_TEXT
851828,12,"This ended up being a red-herring. Re-landed.
https://hg.mozilla.org/integration/mozilla-inbound/rev/0c5c83ed0385",CODE_IMPLEMENTATION,1,FULL_TEXT
851828,13,Thank you :),UNCODED,0,UNMATCHED
851828,14,https://hg.mozilla.org/mozilla-central/rev/0c5c83ed0385,UNCODED,0,UNMATCHED
857034,1,We need native theming of <input type=range> on Windows.,UNCODED,0,UNMATCHED
857034,2,"Created attachment 732274
patch",UNCODED,0,UNMATCHED
857034,3,"Comment on attachment 732274
patch
The DisplayBorderBackgroundOutline() call should be inside the |if| block, obviously. I've moved that locally.",CODE_REVIEW,0,FULL_TEXT
857034,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/ea4b1c3829d3,UNCODED,0,UNMATCHED
857034,5,https://hg.mozilla.org/mozilla-central/rev/ea4b1c3829d3,UNCODED,0,UNMATCHED
861246,1,"Patch incoming, just a line went missing somewhere.",STATUS_UPDATE,0,FULL_TEXT
861246,2,"Created attachment 736858
Fix IPC for fixed layer margins",UNCODED,0,UNMATCHED
861246,3,"Oh, feel free to land this when you review it if I'm not awake :)",UNCODED,0,UNMATCHED
861246,4,"Comment on attachment 736858
Fix IPC for fixed layer margins
Review of attachment 736858:
-----------------------------------------------------------------
Looks good, thanks for catching this Chris!",CODE_REVIEW,0,FULL_TEXT
861246,5,https://hg.mozilla.org/integration/mozilla-inbound/rev/278d87108cb0,UNCODED,0,UNMATCHED
861246,6,https://hg.mozilla.org/mozilla-central/rev/278d87108cb0,UNCODED,0,UNMATCHED
866470,1,"Matt, I see you added this assertion back in bug 798964. Can you take a look please?
https://tbpl.mozilla.org/php/getParsedLog.php?id=22304828&tree=Mozilla-Inbound
Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test reftest on 2013-04-26 16:45:04 PDT for push 53a6f358005e
slave: talos-r4-snow-079
16:56:08     INFO -  ###!!! ASSERTION: Should not be trying to paint a background color if we don't have one: 'drawBackgroundColor', file ../../../layout/base/nsCSSRendering.cpp, line 2722
16:56:08     INFO -  nsCSSRendering::PaintBackgroundColor(nsPresContext*, nsRenderingContext&, nsIFrame*, nsRect const&, nsRect const&, unsigned int) [layout/base/nsCSSRendering.cpp:1609]
16:56:08     INFO -  nsDisplayBackgroundColor::Paint(nsDisplayListBuilder*, nsRenderingContext*) [obj-firefox/dist/include/nsRect.h:51]
16:56:08     INFO -  mozilla::FrameLayerBuilder::DrawThebesLayer(mozilla::layers::ThebesLayer*, gfxContext*, nsIntRegion const&, nsIntRegion const&, void*) [layout/base/FrameLayerBuilder.cpp:3295]
16:56:08     INFO -  mozilla::layers::ThebesLayerOGL::RenderLayer(int, nsIntPoint const&) [obj-firefox/dist/include/mozilla/gfx/BaseRect.h:44]
16:56:08     INFO -  mozilla::layers::ContainerLayerOGL::RenderLayer(int, nsIntPoint const&) [obj-firefox/dist/include/GLContext.h:172]
16:56:08     INFO -  mozilla::layers::ContainerLayerOGL::RenderLayer(int, nsIntPoint const&) [obj-firefox/dist/include/GLContext.h:172]
16:56:08     INFO -  mozilla::layers::LayerManagerOGL::Render() [gfx/layers/opengl/LayerManagerOGL.cpp:837]
16:56:08     INFO -  mozilla::layers::LayerManagerOGL::EndTransaction(void (*)(mozilla::layers::ThebesLayer*, gfxContext*, nsIntRegion const&, nsIntRegion const&, void*), void*, mozilla::layers::LayerManager::EndTransactionFlags) [gfx/layers/opengl/LayerManagerOGL.cpp:566]
16:56:08     INFO -  nsDisplayList::PaintForFrame(nsDisplayListBuilder*, nsRenderingContext*, nsIFrame*, unsigned int) const [layout/base/nsDisplayList.h:306]
16:56:08     INFO -  nsDisplayList::PaintRoot(nsDisplayListBuilder*, nsRenderingContext*, unsigned int) const [obj-firefox/dist/include/GeckoProfilerImpl.h:233]
16:56:08     INFO -  nsLayoutUtils::PaintFrame(nsRenderingContext*, nsIFrame*, nsRegion const&, unsigned int, unsigned int) [layout/base/nsLayoutUtils.cpp:2095]
16:56:08     INFO -  PresShell::Paint(nsView*, nsRegion const&, unsigned int) [layout/base/nsPresShell.cpp:5587]
16:56:08     INFO -  nsViewManager::ProcessPendingUpdatesForView(nsView*, bool) [obj-firefox/dist/include/nsRegion.h:75]
16:56:08     INFO -  nsRefreshDriver::Tick(long long, mozilla::TimeStamp) [obj-firefox/dist/include/nsAutoPtr.h:880]
16:56:08     INFO -  mozilla::RefreshDriverTimer::Tick() [obj-firefox/dist/include/nsTArray.h:363]
16:56:08     INFO -  nsTimerImpl::Fire() [xpcom/threads/nsTimerImpl.cpp:562]
16:56:08     INFO -  nsTimerEvent::Run() [xpcom/threads/nsTimerImpl.cpp:634]
16:56:08     INFO -  nsThread::ProcessNextEvent(bool, bool*) [xpcom/threads/nsThread.cpp:627]
16:56:08     INFO -  NS_ProcessPendingEvents(nsIThread*, unsigned int) [obj-firefox/xpcom/build/nsThreadUtils.cpp:188]
16:56:08     INFO -  nsBaseAppShell::NativeEventCallback() [widget/xpwidgets/nsBaseAppShell.cpp:98]
16:56:08     INFO -  nsAppShell::ProcessGeckoEvents(void*) [widget/cocoa/nsAppShell.mm:388]
16:56:08     INFO -  CoreFoundation + 0x4e401
16:56:08     INFO -  CoreFoundation + 0x4c5f9
16:56:08     INFO -  CoreFoundation + 0x4bdbf
16:56:08     INFO -  HIToolbox + 0x2e7ee
16:56:08     INFO -  HIToolbox + 0x2e551
16:56:08     INFO -  HIToolbox + 0x2e4ac
16:56:08     INFO -  AppKit + 0x43eb2
16:56:08     INFO -  -AppKit + 0x43801
16:56:08     INFO -  -[GeckoNSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] [widget/cocoa/nsAppShell.mm:164]
16:56:08     INFO -  -AppKit + 0x968f
16:56:08     INFO -  nsAppShell::Run() [widget/cocoa/nsAppShell.mm:741]
16:56:08     INFO -  nsAppStartup::Run() [toolkit/components/startup/nsAppStartup.cpp:289]
16:56:08     INFO -  XREMain::XRE_mainRun() [toolkit/xre/nsAppRunner.cpp:3879]
16:56:08     INFO -  XREMain::XRE_main(int, char**, nsXREAppData const*) [toolkit/xre/nsAppRunner.cpp:3946]
16:56:08     INFO -  XRE_main [toolkit/xre/nsAppRunner.cpp:4147]
16:56:08     INFO -  main [browser/app/nsBrowserApp.cpp:271]
16:56:08     INFO -  --DOMWINDOW == 15 (0x12cd82620) [serial = 4989] [outer = 0x127502fc0] [url = data:text/html;charset=UTF-8,%3C%21%2D%2DCLEAR%2D%2D%3E]
16:56:08     INFO -  REFTEST TEST-START | http://localhost:4444/1367020010424/152/289480-ref.html | 1904 / 9275 (20%)
16:56:08     INFO -  ++DOMWINDOW == 16 (0x12cd82620) [serial = 4994] [outer = 0x127502fc0]
16:56:09     INFO -  REFTEST TEST-PASS | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | image comparison (==)
16:56:09     INFO -  REFTEST INFO | Loading a blank page
16:56:09     INFO -  ++DOMWINDOW == 17 (0x12c1e2650) [serial = 4995] [outer = 0x127502fc0]
16:56:09     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
866470,2,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22333021&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-04-27 17:31:07
slave: t-w864-ix-092
17:44:20     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,3,"ttaubert
https://tbpl.mozilla.org/php/getParsedLog.php?id=22345506&tree=Fx-Team
WINNT 6.2 fx-team debug test reftest on 2013-04-28 10:52:37
slave: t-w864-ix-049
11:07:28     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,4,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22366538&tree=Mozilla-Central
Rev5 MacOSX Mountain Lion 10.8 mozilla-central debug test reftest on 2013-04-29 09:51:58
slave: talos-mtnlion-r5-076
10:00:19     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,5,"jfkthame
https://tbpl.mozilla.org/php/getParsedLog.php?id=22420241&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound debug test reftest on 2013-04-30 10:54:23
slave: talos-mtnlion-r5-069
11:02:39     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,6,"mccr8
https://tbpl.mozilla.org/php/getParsedLog.php?id=22423448&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-04-30 12:16:21
slave: t-w864-ix-092
12:29:47     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,7,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22426553&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-04-30 13:11:43
slave: t-w864-ix-077
13:24:19     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,8,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22435380&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-04-30 16:04:03
slave: t-w864-ix-049
16:19:00     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,9,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22468004&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-01 11:30:20
slave: t-w864-ix-049
11:43:55     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,10,*** Bug 867498 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
866470,11,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22482209&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-01 17:11:23
slave: t-w864-ix-055
17:21:59     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,12,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22484968&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-01 18:58:07
slave: t-w864-ix-014
19:08:26     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,13,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22490015&tree=Mozilla-Central
WINNT 6.2 mozilla-central debug test reftest on 2013-05-01 22:09:41
slave: t-w864-ix-070
22:20:02     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,14,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=22493573&tree=Mozilla-Inbound
Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test reftest on 2013-05-02 01:14:21
slave: talos-r4-snow-079
01:25:35     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,15,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22499971&tree=Mozilla-Inbound
Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test reftest on 2013-05-02 05:05:38
slave: talos-r4-snow-079
05:17:28     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,16,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22499869&tree=Mozilla-Inbound
Rev4 MacOSX Lion 10.7 mozilla-inbound debug test reftest on 2013-05-02 05:05:35
slave: talos-r4-lion-023
05:17:44     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,17,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22502395&tree=Mozilla-Central
WINNT 6.2 mozilla-central debug test reftest on 2013-05-02 06:22:14
slave: t-w864-ix-008
06:32:42     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,18,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22510556&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound debug test reftest on 2013-05-02 09:56:18
slave: talos-mtnlion-r5-074
10:05:08     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,19,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22510556&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound debug test reftest on 2013-05-02 09:56:18
slave: talos-mtnlion-r5-074
10:05:08     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,20,"Matt, can you get the ball rolling on this please? We're hitting it pretty frequently across all platforms.",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
866470,21,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22487406&tree=Try
Rev4 MacOSX Snow Leopard 10.6 try debug test reftest on 2013-05-01 20:23:21
slave: talos-r4-snow-079
20:34:17     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,22,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22513023&tree=Mozilla-Inbound
Rev3 WINNT 6.1 mozilla-inbound debug test reftest on 2013-05-02 10:36:51
slave: talos-r3-w7-044
10:55:09     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///c:/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,23,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22524217&tree=Mozilla-Inbound
Rev3 WINNT 6.1 mozilla-inbound debug test reftest on 2013-05-02 15:12:07
slave: talos-r3-w7-099
15:27:02     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,24,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=22546094&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-03 03:10:46
slave: t-w864-ix-006
03:13:55    ERROR -  abort: HTTP Error 500: Internal Server Error
03:13:56    ERROR -  Automation Error: hg not responding
03:13:56    ERROR - Return code: -1
03:13:56    ERROR - Can't run command ['c:/mozilla-build/hg/hg', '--config', 'ui.merge=internal:merge', 'branch'] in non-existent directory C:\slave\test\build\tools!
03:13:56    ERROR - Can't run command ['c:/mozilla-build/hg/hg', '--config', 'ui.merge=internal:merge', 'update', '-C'] in non-existent directory 'C:\slave\test\build\tools'!
03:22:23     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,25,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22552367&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-03 07:40:04
slave: t-w864-ix-092
07:51:53     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,26,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=22553611&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-03 08:04:40
slave: t-w864-ix-049
08:17:43     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,27,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22554237&tree=Jamun
Rev5 MacOSX Mountain Lion 10.8 jamun debug test reftest on 2013-05-03 08:30:35
slave: talos-mtnlion-r5-042
08:39:18     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,28,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22569841&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound debug test reftest on 2013-05-03 15:35:35
slave: talos-mtnlion-r5-040
15:43:40     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,29,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22574720&tree=Mozilla-Inbound
Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test reftest on 2013-05-03 17:24:10
slave: talos-r4-snow-079
17:35:13     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,30,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22585444&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-04 03:12:07
slave: t-w864-ix-009
03:23:00     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,31,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22598640&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-04 15:13:07
slave: t-w864-ix-028
15:23:20     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,32,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22599806&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-04 15:48:06
slave: t-w864-ix-012
15:58:10     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,33,"Ms2ger%gmail.com
https://tbpl.mozilla.org/php/getParsedLog.php?id=22605853&tree=Mozilla-Central
WINNT 6.2 mozilla-central debug test reftest on 2013-05-05 01:33:33
slave: t-w864-ix-049
01:44:36     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,34,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22619936&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-05 18:24:05
slave: t-w864-ix-063
18:34:34     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,35,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22623310&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-05 21:09:06
slave: t-w864-ix-059
21:19:19     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,36,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22623404&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-05 21:23:11
slave: t-w864-ix-012
21:33:41     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,37,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22630452&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-06 05:31:08
slave: t-w864-ix-071
05:41:56     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,38,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22631758&tree=Mozilla-Central
WINNT 6.2 mozilla-central debug test reftest on 2013-05-06 06:21:07
slave: t-w864-ix-006
06:31:21     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,39,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22633647&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-06 07:08:06
slave: t-w864-ix-078
07:19:32     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,40,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22652176&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound debug test reftest on 2013-05-06 14:55:30
slave: talos-mtnlion-r5-048
15:03:22     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,41,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22655474&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-06 16:04:57
slave: t-w864-ix-050
16:15:05     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,42,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22662358&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-06 19:11:55
slave: t-w864-ix-075
19:21:57     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,43,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22664548&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-06 19:58:07
slave: t-w864-ix-082
20:08:08     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,44,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22660128&tree=Fx-Team
Rev3 WINNT 6.1 fx-team debug test reftest on 2013-05-06 17:53:15
slave: talos-r3-w7-058
18:08:28     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///c:/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,45,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=22673735&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-07 00:31:35
slave: t-w864-ix-055
00:41:52     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,46,"edmorley
https://tbpl.mozilla.org/php/getParsedLog.php?id=22675739&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-07 01:40:04
slave: t-w864-ix-030
01:51:01     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,47,"ttaubert
https://tbpl.mozilla.org/php/getParsedLog.php?id=22676760&tree=Fx-Team
WINNT 6.2 fx-team debug test reftest on 2013-05-07 02:05:10
slave: t-w864-ix-090
02:15:45     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,48,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22687190&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound debug test reftest on 2013-05-07 08:35:15
slave: talos-mtnlion-r5-081
08:43:27     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,49,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22690015&tree=Mozilla-Inbound
Rev3 WINNT 6.1 mozilla-inbound debug test reftest on 2013-05-07 09:09:22
slave: talos-r3-w7-012
09:25:41     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///c:/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,50,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22689422&tree=Fx-Team
WINNT 6.2 fx-team debug test reftest on 2013-05-07 09:23:05
slave: t-w864-ix-038
09:33:46     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,51,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22691310&tree=Mozilla-Inbound
Rev4 MacOSX Snow Leopard 10.6 mozilla-inbound debug test reftest on 2013-05-07 09:47:18
slave: talos-r4-snow-079
09:58:16     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///Users/cltbld/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,52,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22693987&tree=Cedar
WINNT 6.2 cedar debug test reftest on 2013-05-07 10:52:13
slave: t-w864-ix-080
11:02:59     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,53,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22694712&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-07 11:08:51
slave: t-w864-ix-048
11:19:13     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,54,"KWierso
https://tbpl.mozilla.org/php/getParsedLog.php?id=22694712&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-07 11:08:51
slave: t-w864-ix-048
11:19:13     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,55,"RyanVM
https://tbpl.mozilla.org/php/getParsedLog.php?id=22697150&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-07 12:10:50
slave: t-w864-ix-049
12:21:17     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,56,"khuey
https://tbpl.mozilla.org/php/getParsedLog.php?id=22704089&tree=Mozilla-Central
WINNT 6.2 mozilla-central debug test reftest on 2013-05-07 14:54:23
slave: t-w864-ix-037
15:04:52     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,57,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22703552&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-07 14:51:04
slave: t-w864-ix-046
15:01:08     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,58,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22708228&tree=Mozilla-Inbound
Rev5 MacOSX Mountain Lion 10.8 mozilla-inbound debug test reftest on 2013-05-07 16:40:35
slave: talos-mtnlion-r5-042
16:48:20     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///builds/slave/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,59,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22715462&tree=Mozilla-Inbound
WINNT 6.2 mozilla-inbound debug test reftest on 2013-05-07 21:07:56
slave: t-w864-ix-044
21:18:00     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,60,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22716176&tree=Mozilla-Central
Rev3 WINNT 6.1 mozilla-central debug test reftest on 2013-05-07 20:58:43
slave: talos-r3-w7-049
21:14:59     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///c:/talos-slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,61,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22717490&tree=Fx-Team
WINNT 6.2 fx-team debug test reftest on 2013-05-07 21:51:46
slave: t-w864-ix-052
22:02:02     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,62,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22717129&tree=Services-Central
WINNT 6.2 services-central debug test reftest on 2013-05-07 21:45:12
slave: t-w864-ix-033
21:54:39     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,63,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22717800&tree=Build-System
WINNT 6.2 build-system debug test reftest on 2013-05-07 21:59:39
slave: t-w864-ix-014
22:09:57     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,64,"Created attachment 747203
Make the style context lookup in nsDisplayList match what nsCSSRendering does
Bit of a guess, but that's the only reason I can see why they might come up with different results.",CODE_IMPLEMENTATION,1,FULL_TEXT
866470,65,"philor
https://tbpl.mozilla.org/php/getParsedLog.php?id=22788699&tree=UX
WINNT 6.2 ux debug test reftest on 2013-05-09 12:53:47
slave: t-w864-ix-048
13:03:55     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,66,"jwir3
https://tbpl.mozilla.org/php/getParsedLog.php?id=22821842&tree=Try
WINNT 6.2 try debug test reftest on 2013-05-10 08:00:59
slave: t-w864-ix-010
08:11:06     INFO -  REFTEST TEST-UNEXPECTED-FAIL | file:///C:/slave/test/build/tests/reftest/tests/layout/reftests/bugs/289480.html#top | assertion count 1 is more than expected 0 assertions",UNCODED,0,UNMATCHED
866470,67,"As best I can tell, nothing ever landed here, but this seems to have disappeared. Any ideas, Matt?",QUESTION,0,FULL_TEXT
866470,68,"That doesn't really make sense to me.
I'll land the fix anyway, it should be a valid change regardless.
https://hg.mozilla.org/integration/mozilla-inbound/rev/c4eae0d77d5e",ANSWER_TO_QUESTION,0,FULL_TOKEN
866470,69,https://hg.mozilla.org/mozilla-central/rev/c4eae0d77d5e,UNCODED,0,UNMATCHED
866474,1,"The JSRuntime::setDefaultLocale function currently accepts any string as a locale; it doesn't check whether it's a valid BCP 47 language tag and supported by the implementation of the Internationalization API. It's up to the DefaultLocale function in Intl.js whether it actually uses the runtime's default locale.
It might be better to have JSRuntime::setDefaultLocale check whether the string is acceptable, and reject it if not.",PROBLEM_MOTIVATION,0,FULL_TOKEN
866474,2,"The only caller of this method is now using LocaleService which canonicalizes the locale code.
I think we can close this as fixed.",STATUS_UPDATE,0,FULL_TEXT
888630,1,"User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.22 (KHTML, like Gecko) Ubuntu Chromium/25.0.1364.160 Chrome/25.0.1364.160 Safari/537.22
Steps to reproduce:
The Byte Order Marker (a.k.a ZERO WIDTH NO-BREAK SPACE) at U+FEFF is listed as a white-space character in ECMAScript 5 (chapter 7.2). String.prototype.trim() will remove it from both ends, as expected, but \s in regular expressions doesn't match it:
a) ""x\uFEFF"".trim()
b) /\s/.test(""\uFEFF"")
Actual results:
a) ""x""
b) false
Expected results:
\s should match the BOM.
On the other hand, if there is a specific reason why the BOM should not be considered as white space, trim() should follow suit and leave it intact (same goes for trimLeft() and trimRight()).
Current versions of Opera and Chromium behave as expected (can't test IE, sorry).",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
888630,2,"The BOM should be treated as whitespace by regexps, indeed. Thanks for reporting.",SOLUTION_REVIEW,1,FULL_TEXT
888630,3,Fixed by bug 888673,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
894646,1,"Created attachment 776725
Patch",UNCODED,0,UNMATCHED
894646,2,"Comment on attachment 776725
Patch
Review of attachment 776725:
-----------------------------------------------------------------
A few bugs and crashes... Please attach an interdiff when you address the comments.
::: content/base/src/nsDocument.cpp
@@ +6620,5 @@
Let's just cast here, and make this an nsRefPtr<Attr>
@@ +6623,5 @@
You're shadowing the rv argument here.
::: content/xul/document/src/nsXULCommandDispatcher.cpp
@@ +209,2 @@
Followup to fix SetFocus?
::: dom/base/nsContentPermissionHelper.cpp
@@ +92,5 @@
This is crashy if mParent->mElement is null.
::: dom/base/nsContentPermissionHelper.h
@@ +27,4 @@
One space is sufficient
::: dom/base/nsDOMWindowUtils.cpp
@@ +1289,5 @@
Crash
::: dom/base/nsGlobalWindow.cpp
@@ +3097,5 @@
Element
@@ +6370,5 @@
nullptr while you're here
@@ +7606,5 @@
Crash
@@ +10858,5 @@
Get rid of this nonsense, please.
@@ +11057,5 @@
Element
@@ +11169,5 @@
Ditto
::: dom/base/nsLocation.cpp
@@ +42,5 @@
Unused variable
@@ +51,4 @@
Double-check if you need to hold a ref here
::: dom/base/nsPIDOMWindow.h
@@ +196,5 @@
Ask someone if those are perf-sensitive
::: dom/ipc/ContentParent.cpp
@@ +399,1 @@
AttrValueIs
::: dom/ipc/TabChild.cpp
@@ +543,5 @@
Let's keep this a strong pointer
::: dom/ipc/TabParent.cpp
@@ +316,5 @@
Followup
@@ +1242,5 @@
Can mFrameElement change from under us?
@@ +1259,1 @@
Followup
::: dom/ipc/TabParent.h
@@ +62,5 @@
const
::: dom/system/nsDeviceSensors.cpp
@@ +218,4 @@
Uh, I don't think so
::: layout/inspector/src/inLayoutUtils.cpp
@@ +103,2 @@
* to the left
@@ +105,1 @@
{}",CODE_REVIEW,0,FULL_TEXT
894646,3,"nsIFocusManager is defined in idl.
This just returns a string.
Nope.  TabParents are created for specific iframes, which are then set as the owner element.  mFrameElement is never changed after that.
nsIDialogCreator.idl
Thanks, good catch.",ANSWER_TO_QUESTION,0,FULL_TOKEN
894646,4,"Created attachment 778194
Addressing review comments",UNCODED,0,UNMATCHED
894646,5,"Comment on attachment 778194
Addressing review comments
Review of attachment 778194:
-----------------------------------------------------------------
::: content/base/src/nsDocument.cpp
@@ +6631,5 @@
Does this compile?
::: dom/system/nsDeviceSensors.cpp
@@ +217,5 @@
Does this compile? pwindow is not an EventTarget...
@@ +223,5 @@
You also need to revert these three.",CODE_REVIEW,0,FULL_TEXT
894646,6,"Created attachment 779649
Second version of review comments
Sorry, I could have sworn I tried compiling before posting the last interdiff, but apparently not.",CODE_IMPLEMENTATION,1,FULL_TEXT
894646,7,"Created attachment 779657
Rebased patch",UNCODED,0,UNMATCHED
894646,8,"Comment on attachment 779657
Rebased patch
Review of attachment 779657:
-----------------------------------------------------------------
r=me with the following addressed. Thanks!
::: content/base/src/nsFrameLoader.cpp
@@ +1647,5 @@
mOwnerContent is a dom::Element*. Drop the QI, but keep the ref.
@@ +2062,5 @@
Ditto
::: dom/base/nsContentPermissionHelper.cpp
@@ +8,5 @@
mozilla/d before mozilla/u
::: dom/base/nsContentPermissionHelper.h
@@ +23,4 @@
Nit: 80 columns
::: dom/base/nsDOMWindowUtils.cpp
@@ +1289,5 @@
Since you're not actually changing anything here, let's drop this change.
@@ +3222,3 @@
This can be 'return doc->...'. Up to you.
::: dom/base/nsGlobalWindow.cpp
@@ +6290,5 @@
Nit: add 'static', so we notice if it ever becomes unused.
@@ +6391,1 @@
{}
@@ +6409,5 @@
{}
@@ +9160,5 @@
(What a mess.)
@@ +9161,5 @@
Can you make this an nsCOMPtr<EventTarget>? And try to drop the .get().
::: layout/inspector/src/inLayoutUtils.cpp
@@ +95,2 @@
Is this necessarily non-null?",QUESTION,0,FULL_TEXT
894646,9,"I changed to EventTarget, but you need the .get().
No, I changed to QI.
https://hg.mozilla.org/integration/mozilla-inbound/rev/d9dbb5dbb96a",AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
894646,10,"Backed out the changes to nsDeviceSensors for not building on Windows.
https://hg.mozilla.org/integration/mozilla-inbound/rev/c68b8da6ec5a",IMPLEMENTATION_REVERSION,0,FULL_TEXT
894646,11,https://hg.mozilla.org/mozilla-central/rev/d9dbb5dbb96a,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
894931,1,"On trunk (Firefox) the text on a certain website flows out of the usual box and takes up the whole page width instead. In the latest Firefox this was still fine. I'm going to look for the regression range of this (must be a very recent regression).
To reproduce:
1. Go to http://www.nordbayerischer-kurier.de/
2. Observe how the text below the animated pictures/slideshow flows out of the box where the text should be in",S2R,0,FULL_TOKEN
894931,2,"This regressed between 5976b9c673f8 and 0888e29c83a3 (yesterday's and today's build), changesets: http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=5976b9c673f8&tochange=0888e29c83a3",PROBLEM_LOCALIZATION,0,FULL_TEXT
894931,3,"Some further testing: Build from this revision http://hg.mozilla.org/mozilla-central/rev/5f79304fcefe is still fine, this one http://hg.mozilla.org/mozilla-central/rev/fd10ead17ace is broken
=> http://hg.mozilla.org/mozilla-central/rev/fd10ead17ace is to ""blame"", it's a birch to mozilla-central merge.",PROBLEM_LOCALIZATION,0,FULL_TOKEN
894931,4,"Got it: Regression between http://hg.mozilla.org/integration/mozilla-inbound/rev/3d33faf4d81f and http://hg.mozilla.org/integration/mozilla-inbound/rev/e8bf739addfa
=> Bug 868498",PROBLEM_LOCALIZATION,0,FULL_TOKEN
894931,5,"roc, see bug 868498 comment 47. The assertion fix there is causing this regression. Would you happen to know a way to work around this?",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
894931,6,So what is visible on http://www.arewefastyet.com/?a=b&view=regress is also this bug or another ?,QUESTION,0,FULL_TEXT
894931,7,"It's the same bug, I checked with mozilla-inbound builds.",ANSWER_TO_QUESTION,0,FULL_TEXT
894931,8,"I believe Huffington Post is also affected by this bug. The ""Most Popular"" column is rendered on top of the logo, navigaton bar and the top story, making it impossible to click on some sections on the site.",PROBLEM_REVIEW,0,FULL_TEXT
894931,9,*** Bug 895099 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
894931,10,"You're right, I checked with the two m-i builds. IMHO quite questionable if this patch can stay on trunk/aurora/beta when there is no fast workaround for this.",PROBLEM_REVIEW,0,FULL_TEXT
894931,11,"Created attachment 777360
Patch
Looks like this is a bigger issue than first thought.
roc, I'm setting this patch to r? although you may have a better way to fix this. It turns out that we don't need to move the z-index rule. The position rule is all we need to get the correct behavior when switching scrollbar styles. The position rule seems to only affect overlay scrollbars, so maybe this is safe to do?",CODE_IMPLEMENTATION,1,FULL_TOKEN
894931,12,"Comment on attachment 777360
Patch
Review of attachment 777360:
-----------------------------------------------------------------
This patch isn't correct because it changes the z-ordering of scrollbars.",CODE_REVIEW,0,FULL_TEXT
894931,13,"Oh, I think I finally understand: you're saying by changing the position we're also changing z-ordering? I missed that.",QUESTION,0,FULL_TEXT
894931,14,"I know what the bug is. The bug is that we need to reframe when transitioning from position:static to position:relative if there are position:absolute descendants, because they need to change their containing blocks to be the new frame.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
894931,15,"I can't think of an easy, beta-safe fix right now. I think we're going to have to pull disappearing scrollbars from beta, sorry :-(.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
894931,16,"Created attachment 777478
Revert assert fix from bug 868498
Okay, thanks roc! Let's use this bug to revert the assert fix in m-c, aurora and beta. I'll file a separate bug to turn off overlay scrollbars in beta.",CODE_IMPLEMENTATION,1,FULL_TEXT
894931,17,*** Bug 895181 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
894931,18,https://hg.mozilla.org/integration/mozilla-inbound/rev/f713a828fe36,UNCODED,0,UNMATCHED
894931,19,"Comment on attachment 777478
Revert assert fix from bug 868498
[Approval Request Comment]
Bug caused by (feature/regressing bug #): Bug 868498
User impact if declined: Page layout on many websites would be broken.
Testing completed (on m-c, etc.): This is merely a backout of one of the patches in bug 868498. Verified locally that this fixes things.
Risk to taking this patch (and alternatives if risky): very low
String or IDL/UUID changes made by this patch: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
894931,20,"Comment on attachment 777478
Revert assert fix from bug 868498
You don't need approval to back out something that you incorrectly landed this morning.",CLARIFICATION,0,FULL_TEXT
894931,21,Thanks dbaron! Do the tracking flags need to be updated for this to propagate to the right branches? It's getting late here and I won't be able to watch the tree...,QUESTION,0,FULL_TEXT
894931,22,(And dare I ask why you don't need to back out the *other* patch?),QUESTION,0,FULL_TEXT
894931,23,"Sure. That's because the patch got lumped in with bug 868498, but it was really fixing bug 870941. I've taken the opportunity to separate the two. I reopened bug 870941 to track progress on the proper fix. Hope that makes sense.",ANSWER_TO_QUESTION,0,FULL_TEXT
894931,24,"The tracking flags should be updated when it gets backed out to reflect the current state.  But tracking flags don't cause propagation to branches, they just show it.",ANSWER_TO_QUESTION,0,FULL_TOKEN
894931,25,"https://hg.mozilla.org/mozilla-central/rev/625e6c220d30
https://hg.mozilla.org/releases/mozilla-aurora/rev/668caad64c7a
https://hg.mozilla.org/releases/mozilla-beta/rev/e4f6d58191b9
If this breaks the tree in any way, please back out the other patch from bug 868498.",CODE_UPDATE_REQUEST,0,FULL_TEXT
894931,26,"BTW, please tell me we have tests for this now? Kinda scary when something can break site layouts as bad as this did without our automated tests catching it...",QUESTION,0,FULL_TEXT
894931,27,"Created attachment 778280
test",UNCODED,0,UNMATCHED
894931,28,"Comment on attachment 778280
test
Maybe use padding-top on the outer div to avoid having to worry about whether margin collapsing makes the test pass in the failure case anyway (given some future margin collapsing changes, at least)?",CODE_REVIEW,0,FULL_TEXT
894931,29,Sure.,UNCODED,0,UNMATCHED
894931,30,Actually padding-top won't work since we need to move the border-box.,CLARIFICATION,0,FULL_TEXT
894931,31,"I don't think collapsing with the top margin could ever be eliminated, due to compatibility issues, so I'll leave it as-is.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
894931,32,*** Bug 895453 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
894931,33,"Test pushed to inbound:
https://hg.mozilla.org/integration/mozilla-inbound/rev/be10b6e8dfad",UNCODED,0,UNMATCHED
894931,34,https://hg.mozilla.org/mozilla-central/rev/be10b6e8dfad,UNCODED,0,UNMATCHED
894931,35,*** Bug 896149 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
897027,1,"Test case:
---
Math.pow({valueOf: () => print(""hello"")})
Math.atan2({valueOf: () => print(""hello"")})
---
Expected:
Both calls invoke the valueOf() function
Actual:
The valueOf() function is not invoked
Somewhat related to bug 896264, also see bug 896264 comment 4 for an explanation why ToNumber needs to be executed.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
897027,2,"David, you have any interest in fixing this perhaps?",ASSIGNEE_REQUEST,0,FULL_TEXT
897027,3,"Sure, feel free to assign me. Will try doing some work over this weekend.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
897027,4,Great!  We probably should audit all the Math methods while we're at it -- might be more than just these two that need fixing.,REQUIREMENT,0,FULL_TOKEN
897027,5,"Created attachment 813138
bug-897027-fix.patch
Apologies for the delay to get back to this. Please find a proposed fix attached, which should fix the bug.
The Math methods reported by Andr are the only ones having this problem (performed a check over the rest)
Any further comment or feedback would be appreciated.",CODE_IMPLEMENTATION,1,FULL_TOKEN
897027,6,"Comment on attachment 813138
bug-897027-fix.patch
Review of attachment 813138:
-----------------------------------------------------------------
Stealing ...
Looks good, but I think we should have tests added for this. Can you create them from Andr's initial report? Ask me for review with those.",CODE_UPDATE_REQUEST,0,FULL_TEXT
897027,7,"Created attachment 815216
bug-897027-fix.patch
This new patch includes the requested test cases.",CODE_IMPLEMENTATION,1,FULL_TEXT
897027,8,"Comment on attachment 815216
bug-897027-fix.patch
Review of attachment 815216:
-----------------------------------------------------------------
Nice!
r=me with a license header added to the test. Not all tests have them, but all should. Personally, I'd go with
// Any copyright is dedicated to the Public Domain.
// http://creativecommons.org/licenses/publicdomain/
::: js/src/tests/ecma_6/Math/20.2.2.ToNumber.js
@@ +2,5 @@
Nit: remove stray spaces at the last three lines' ends.",CODE_REVIEW,0,FULL_TOKEN
897027,9,"Created attachment 815315
bug-897027-fix.patch
New version with requested corrections.",CODE_IMPLEMENTATION,1,FULL_TEXT
897027,10,"Comment on attachment 815315
bug-897027-fix.patch
Review of attachment 815315:
-----------------------------------------------------------------
Perfect, thanks. Do you have checkin rights? If not, just add the checkin-needed keyword on the bug and the sheriffs will do their magic.
(Just for future reference, if you get an r+ with a request to do some small changes, you can set the r+ yourself on the new version and add something like ""carrying r+ from tschneidereit"" to the comment.)",CODE_REVIEW,0,FULL_TOKEN
897027,11,Thanks for the tips! Will do. It was my understanding that checkin rights were given after some few contributions. Maybe the time has come :-),ANSWER_TO_QUESTION,0,FULL_TEXT
897027,12,"https://hg.mozilla.org/integration/mozilla-inbound/rev/774d6d582f40
In the future, please make sure your commit message has the bug number and a brief description of what the patch is doing (preferably not just the bug title). Thanks!",CODE_REVIEW,0,FULL_TEXT
897027,13,"Backed out for assertions:
eg https://tbpl.mozilla.org/php/getParsedLog.php?id=28934657&tree=Mozilla-Inbound
https://hg.mozilla.org/integration/mozilla-inbound/rev/45f35cc52ceb
Were the jit-tests run locally on a debug build before requesting checkin-needed..? :-)",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
897027,14,"Urgh, I'm utterly embarrassed. David, I take full responsibility for this one and am sorry for not doing a better job and catching it.
Can you debug things and attach a new version of the patch?",CODE_UPDATE_REQUEST,0,FULL_TEXT
897027,15,"`ToNumber(cx, args[1], &y)` asserts when args.length() == 1.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
897027,16,"Created attachment 815582
bug-897027-fix.patch
Thanks everyone for the comments. This update will hopefully fix the previous issue (tested it on my platform's debug and release builds)
Please note the local variables assignments: 
    double x = GenericNaN();
This should handle (and hopefully not introduce new bugs) the cases where less arguments are being passed (thus being undefined) according to my understanding of the draft. Otherwise please feel free to advise me of better alternatives.",CODE_IMPLEMENTATION,1,FULL_TOKEN
897027,17,"Sorry for the late response, this somehow fell off my radar.
Can you wield your new access level 1 powers and run this through try server? Paste the link to the run here and report back when results are in. And be forewarned: try server results aren't easy to read, because of intermittend failures.",QUESTION,0,FULL_TOKEN
897027,18,"Sure, that's a great idea. After some initial configuration I got this test set up https://tbpl.mozilla.org/?tree=Try&rev=97a05046b428
There are a few tests being restarted a few times (perhaps the intermittent failures you referred to?) and a couple of failures (Mochitest) which from what I see don't seem to have much to do with this patch. Other than that the other tests passed.
Would you mind taking a look and let me know if this looks ok?",ANSWER_TO_QUESTION,0,FULL_TOKEN
897027,19,"Comment on attachment 815582
bug-897027-fix.patch
Review of attachment 815582:
-----------------------------------------------------------------
I'm terrribly sorry for the late review - this fell off my radar completely.
Looks great. And thank you so much for the thorough tests of Number functions.
::: js/src/jsmath.cpp
@@ +298,5 @@
this hasDefined isn't necessary, as we'll have returned above if it were false
@@ +647,5 @@
Same here about hasDefined
::: js/src/tests/ecma_6/Math/20.2.2.ToNumber.js
@@ +3,5 @@
Nit: can you add the date of the spec draft this numbering refers to. It will get outdated at some point, otherwise.
@@ +8,5 @@
Please just remove this entire paragraph: the EcmaScript spec's license isn't compatible with Public Domain. While this is very likely to fall under fair use, no need to go anywhere near the boundaries of that.",CODE_REVIEW,0,FULL_TEXT
897027,20,"Comment on attachment 815582
bug-897027-fix.patch
Review of attachment 815582:
-----------------------------------------------------------------
Evilpie had a few comments on IRC that are very helpful:
You can just use args.get(0) and args.get(1) without checking the arg count. args.get returns undefined if fewer args were provided, and ToNumber returns GenericNaN for undefined. Doing this makes the function a lot simpler. I don't think it's worth it to return early for the 0-args case.
Canceling the review based on that, sorry for the churn.",CODE_REVIEW,0,FULL_TOKEN
897027,21,"Created attachment 8334005
New fix with requested changes
Thanks for the comments and the last-minute help on IRC, much appreciated!
Here's the latest version containing the requested changes.",CODE_IMPLEMENTATION,1,FULL_TOKEN
897027,22,"Comment on attachment 8334005
New fix with requested changes
Review of attachment 8334005:
-----------------------------------------------------------------
This looks great, thank you!
Can you do a final try run (just one platform, with only the reftests is ok)? If that turns out green, set checkin-needed on the bug.",CODE_REVIEW,0,FULL_TOKEN
897027,23,"Comment on attachment 8334005
New fix with requested changes
Please just set the checkin-needed bug keyword in the future :)",UNCODED,0,UNMATCHED
897027,24,https://hg.mozilla.org/integration/mozilla-inbound/rev/afd90049af4c,UNCODED,0,UNMATCHED
897027,25,https://hg.mozilla.org/mozilla-central/rev/afd90049af4c,UNCODED,0,UNMATCHED
904571,1,"It first showed up in 25.0a1/20130725. The regression range might be (low volume):
http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=2983ca6d4d1a&tochange=a4c1961bf723
Signature 	mozilla::net::HttpChannelParentListener::OnRedirectResult(bool) More Reports Search
UUID 	ce7b3e6c-f56c-49d0-82a1-0ba792130811
Date Processed	2013-08-11 06:57:34.721808
Uptime	10
Install Age 	6035 since version was first installed.
Install Time 	2013-08-11 05:16:52
Product 	Firefox
Version 	26.0a1
Build ID 	20130810030206
Release Channel 	nightly
OS 	Windows NT
OS Version 	6.1.7600
Build Architecture 	x86
Build Architecture Info 	GenuineIntel family 6 model 58 stepping 9 | 4
Crash Reason 	EXCEPTION_ACCESS_VIOLATION_READ
Crash Address 	0x0
App Notes 	
AdapterVendorID: 0x8086, AdapterDeviceID: 0x0152, AdapterSubsysID: 00000000, AdapterDriverVersion: 8.15.10.2669
D2D? D2D+ DWrite? DWrite+ D3D10 Layers? D3D10 Layers+ 
Frame 	Module 	Signature 	Source
0 	xul.dll 	mozilla::net::HttpChannelParentListener::OnRedirectResult(bool) 	netwerk/protocol/http/HttpChannelParentListener.cpp
1 	xul.dll 	mozilla::net::AutoRedirectVetoNotifier::ReportRedirectResult(bool) 	netwerk/protocol/http/nsHttpChannel.cpp
2 	xul.dll 	mozilla::net::nsHttpChannel::ContinueProcessRedirection(tag_nsresult) 	netwerk/protocol/http/nsHttpChannel.cpp
3 	xul.dll 	mozilla::net::nsHttpChannel::OnRedirectVerifyCallback(tag_nsresult) 	netwerk/protocol/http/nsHttpChannel.cpp
4 	xul.dll 	nsAsyncVerifyRedirectCallbackEvent::Run() 	netwerk/base/src/nsAsyncRedirectVerifyHelper.cpp
5 	xul.dll 	nsThread::ProcessNextEvent(bool,bool *) 	xpcom/threads/nsThread.cpp
6 	xul.dll 	NS_ProcessNextEvent(nsIThread *,bool) 	obj-firefox/xpcom/build/nsThreadUtils.cpp
7 	xul.dll 	nsHttpConnectionMgr::Shutdown() 	netwerk/protocol/http/nsHttpConnectionMgr.cpp
8 	xul.dll 	nsHttpHandler::Observe(nsISupports *,char const *,wchar_t const *) 	netwerk/protocol/http/nsHttpHandler.cpp
9 	xul.dll 	nsObserverService::NotifyObservers(nsISupports *,char const *,wchar_t const *) 	xpcom/ds/nsObserverService.cpp
10 	xul.dll 	nsXREDirProvider::DoShutdown() 	toolkit/xre/nsXREDirProvider.cpp
11 	xul.dll 	ScopedXPCOMStartup::~ScopedXPCOMStartup() 	toolkit/xre/nsAppRunner.cpp
12 	xul.dll 	XREMain::XRE_main(int,char * * const,nsXREAppData const *) 	toolkit/xre/nsAppRunner.cpp
13 	xul.dll 	XRE_main 	toolkit/xre/nsAppRunner.cpp
More reports at:
https://crash-stats.mozilla.com/report/list?product=Firefox&signature=mozilla%3A%3Anet%3A%3AHttpChannelParentListener%3A%3AOnRedirectResult%28bool%29",PROBLEM_DESCRIPTION,0,80_PCT_MATCH
904571,2,"Could be related to bug 904559.
I'll do a workaround but also check how this can even happen.",STATUS_UPDATE,0,FULL_TEXT
904571,3,http://hg.mozilla.org/mozilla-central/annotate/c5946a8bcd5b/netwerk/protocol/http/HttpChannelParentListener.cpp#l207,UNCODED,0,UNMATCHED
904571,4,"When there is no activeRedirectingChannel QI'ed out of mActiveChannel, we should turn succeeded to false and bypass call on the null activeRedirectingChannel.
I think there is nothing more to do here.  We will just show the content of the 30X response page and not crash.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
904571,5,"Created attachment 8365135
v1
My recent re-experience with this code tells me there is nothing more to do.",CODE_IMPLEMENTATION,1,FULL_TEXT
904571,6,"Comment on attachment 8365135
v1
According https://bugzilla.mozilla.org/show_bug.cgi?id=904559#c4 we may want to remove the assert as well, what do you thing Jason?",CODE_REVIEW_REQUEST,0,FULL_TEXT
904571,7,"Jason, ping on review here.",UNCODED,0,UNMATCHED
904571,8,"Comment on attachment 8365135
v1
Review of attachment 8365135:
-----------------------------------------------------------------
I can see that this patch probably removes the crash, but it still seems we have an underlying bug that we're not dealing with yet?
The issue here is that mActiveChannel is somehow not a nsIParentRedirectingChannel (in other words, it's not an HttpChannelParent--nothing else implements it AFAICT).  HttpChannelParentListener is *always* created with an initial mActiveListener == HttpChannelParent, and the only way that can change is in OnRedirectResult, if we're redirected to FTP (that's the only case so far, right).
That can happen, of course--but then how exactly does an HttpChannelParentListener with a FTPChannelParent mActiveListener ever run across AsyncOnChannelRedirect and/or OnRedirectResult again?  FTP doesn't do redirects.  
So it seems to me that we're getting an ""extra"" call to OnRedirectResult here.  The mostly likely cause could be that we accidentally have 2 AutoRedirectVetoNotifier's on the stack somehow?  The nsHttpChannel code here is not easy to follow--seems like we could maybe try to do something stupid like add a nsHttpChannel.mHasHadVetoNotifier member variable, set it when we use an AutoRedirectVetoNotifier, and ASSERT that it's false?  Then maybe we can catch the stack trace if we somehow call OnRedirectResult twice.
Maybe I'm totally wrong here--but I can't think of how else OnRedirectResult is getting called when mActiveChannel isn't an HTTP channel.
If we somehow can't figure this out, or there's a valid reason why mActiveChannel could be something else here, I'm ok with this patch.
And it looks like bug 904559 is the same thing, except we're seeing AsyncOnChannelRedirect() get called, which seems even stranger--how can it get called again after we've switched mActiveChannel to an FTP channel?
BTW there are two asserts that you'd need to remove for this patch--one in AsyncOnChannelRedirect and one in OnRedirectResult.",CODE_REVIEW,0,FULL_TOKEN
904571,9,"I think extensions may override http channel implementation and hence the active channel is not our nsHttpChannel.
As mentioned above, that is not an FTP.
Hmm.. I think not, but I'll check this, good idea.
Again, not an FTP channel :)
Yes, that is what I've mentioned (or something like that) in https://bugzilla.mozilla.org/show_bug.cgi?id=904559#c4",ANSWER_TO_QUESTION,0,FULL_TEXT
904571,10,"There is a potential for foreign (unknown) code be called while AutoRedirectVetoNotifier is on stack.  So it's actually not possible to say whether it can happen to be multiple times on the stack or not.  I think we can easily use mRedirectChannel of the channel to indicate whether we have called OnRedirectResult or not.  ~AutoRedirectVetoNotifier drops it from the channel (I've added an assert to check it's always non-null there and xpcshell tests that cover all codepaths for this class).  But a flag might be more reliable and also we'd have more control over the behavior...  
Question is, what happens when the nested notifier's dtor is called with FAILED and the other is called with SUCCEEDED.  Which one is right?  But I think this is a broader problem, since in this case the code would be seriously broken.  More arg for a flag...",CLARIFICATION,0,FULL_TOKEN
904571,11,"Created attachment 8373536
notifier flag
xpcshells locally passing.
https://tbpl.mozilla.org/?tree=Try&rev=4487989ea3ae",CODE_IMPLEMENTATION,1,FULL_TEXT
904571,12,https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?changeset=2275f8be60c9,UNCODED,0,UNMATCHED
904571,13,Covered by a test landed in bug 949667.,UNCODED,0,UNMATCHED
904571,14,https://hg.mozilla.org/mozilla-central/rev/615c92a67089,UNCODED,0,UNMATCHED
906912,1,This is helpful in general and in particular for WIP patches in bug 901746.,PROBLEM_MOTIVATION,0,FULL_TEXT
906912,2,"Created attachment 792466
Part 1, v1: Add mozilla::Move::ptr().
You can get a raw ref out of a MoveRef with operator*, but there's no easy way
to get a raw pointer out of a MoveRef.  |&*movePtr| is pretty inscrutable.
I considered calling this rawPtr() or overriding operator&.  I don't feel
strongly that this is better than the alternatives, but operator& was confusing
(operator& is not commonly overridden, so it appears to me that we're taking
the address of the MoveRef itself), and I didn't think rawPtr() was worth the
extra chars.",CODE_IMPLEMENTATION,1,FULL_TOKEN
906912,3,"Created attachment 792467
Part 2, v1: Add move constructors to mozilla::LinkedList and mozilla::LinkedListElement.",UNCODED,0,UNMATCHED
906912,4,"It would be great if you could use C++11 move constructors instead.  The fewer usages of mozilla::Move we add, the better.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
906912,5,Do you really think it's better to start using C++11's move() before we've gotten rid of mfbt/Move.h?  I'm not sure that switching to a new interface before we've deprecated the old one is a good idea; that just makes it confusing for consumers (which move() do I use?).,SOLUTION_REVIEW,1,FULL_TOKEN
906912,6,"Actually...if C++11 move constructors handle superclasses properly, that would be a strong reason to use them here.
Right now if I have
 class Foo : LinkedListElement<Foo>
then I can't do
  Foo::Foo(MoveRef<Foo> other) : LinkedListElement(other)
because MoveRef<Foo> doesn't cast to MoveRef<LinkedListElement<Foo> >.  I haven't figured out a clean way of working around this.
Given that essentially the only time you're going to be calling the LinkedListElement move constructor is from a subclass's move constructor, if C++11 move constructors work better here, we should probably use them.",SOLUTION_REVIEW,1,FULL_TOKEN
906912,7,"Comment on attachment 792466
Part 1, v1: Add mozilla::Move::ptr().
Yeah, this is much better using proper C++11.",CODE_REVIEW,0,FULL_TEXT
906912,8,"Created attachment 792880
Patch, v2 (now with C++11 move)",UNCODED,0,UNMATCHED
906912,9,"Also, note that migrating mozilla::Move to C++11 move() is not going to be an automatic process, and cannot be done very easily unless you know the exact semantics of the code involved.",SOLUTION_REVIEW,1,FULL_TEXT
906912,10,"otoh we need to land something so that there's an alternative to std::move(), right?",QUESTION,0,FULL_TEXT
906912,11,"Oh yes, sorry, I thought I had mentioned that.  Good news is that it's pretty simple, see RemoveReference and mozilla::Move in attachment 779237.  (You should be able to steal those parts of that patch verbatim, not touching the existing mozilla::Move of course.)",ANSWER_TO_QUESTION,0,90_PCT_MATCH
906912,12,"Well, this is assuming that this overload
plays well with our current definition of mozilla::Move.  If we ever call mozilla::Move() with an rvalue, this new overload will be hit, and then things won't compile.
Given that this new Move and the existing mozilla::Move are completely different idioms, I'm not sure it makes sense for them to be overloads of each other...",POTENTIAL_SOLUTION_DESIGN,1,MANUAL
906912,13,"Yeah, I don't think they should be either.  I would rather call this new function something completely different (mozilla::StdMove/etc?  I'm terrible at naming things.)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
906912,14,"Rename the existing one to DeprecatedMove or something, then.  It's going away, make it ugly and obvious that no one should use it.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
906912,15,"Something I'm discovering as I try to use std::move instead of mozilla::Move is that a mozilla::MoveRef<T> can be passed to a constructor that takes T&, while a T&& can be cast only to |const T&|, not |T&|.
This is causing some cascading sets of changes.",SOLUTION_REVIEW,1,FULL_TOKEN
906912,16,"Created attachment 796309
Patch, v3
The only difference between this and v2 is that this one uses mozilla::move().
I'm in the process of renaming this to mozilla::Move() in my queue, but I figure that doesn't need to stand in our way.",CODE_IMPLEMENTATION,1,FULL_TOKEN
906912,17,"Comment on attachment 792880
Patch, v2 (now with C++11 move)
Review of attachment 792880:
-----------------------------------------------------------------
This'll want to use mozilla::Move as std::move isn't omnipresent yet, I assume.
::: mfbt/LinkedList.h
@@ +58,5 @@
Blank line before this.
@@ +129,5 @@
I'd move this above the next/prev assignments.  Also, before the next/prev/next->prev/prev->next assignments, I'd put a comment like so:
  /* Initialize this with |other|'s pointers, and adjust those elements to point to this one. */
@@ +132,5 @@
I'd do
  next->prev = this;
  prev->next = this;
instead, as you're really mutating fields in *this* element's next/prev to connect up to this -- reads slightly conceptually more clearly to me.
@@ +135,5 @@
Before this, I'd do a symmetric comment to the one above:
  /* Adjust |other| to destructible, not-in-list status. */",CODE_REVIEW,0,FULL_TOKEN
906912,18,"Comment on attachment 792880
Patch, v2 (now with C++11 move)
Mm, Bugzilla fail when toggling flags on an obsoleted patch.  Looks like comments transfer over trivially, so no big deal here.",CODE_REVIEW,0,FULL_TOKEN
906912,19,"https://hg.mozilla.org/integration/mozilla-inbound/rev/3f307f37b77a
Thanks for all the reviews lately.",UNCODED,0,UNMATCHED
906912,20,https://twitter.com/sayrer/status/19304989209,UNCODED,0,UNMATCHED
906912,21,https://hg.mozilla.org/mozilla-central/rev/3f307f37b77a,UNCODED,0,UNMATCHED
912496,2,"Created attachment 799488
Store source file names only once in tracelogging.log and refer to them by auto-incrementing id after that.",PROBLEM_DESCRIPTION,0,FULL_TEXT
912496,3,"Comment on attachment 799488
Store source file names only once in tracelogging.log and refer to them by auto-incrementing id after that.
Review of attachment 799488:
-----------------------------------------------------------------
Looks good.
Can I make an additional cosmetic request. Could you change 
void TraceLogging::log(Type type, const char* file, unsigned int lineno); to
void TraceLogging::log(Type type, const char* text = NULL, unsigned int number = 0)
And change sourceMap to textMap, sourceId to textId. And also the entry names.
::: js/src/TraceLogging.cpp
@@ +90,5 @@
Since we don't care about order. Please use unordered map like hashmap. That's faster. I'm not sure what we use in firefox for this.
@@ +91,5 @@
nextSourceId(1), and use 0 when there is no text
@@ +150,5 @@
Could this be fallible? Please add checks for OOM situations.
::: js/src/TraceLogging.h
@@ +47,5 @@
Remove this boolean and use sourceId_ == 0 to know if there is information
@@ +52,1 @@
This can get removed too? We can get the name back by doing sourceMap[sourceId_]",CODE_UPDATE_REQUEST,0,FULL_TOKEN
912496,4,"Created attachment 799789
v2
I addressed all feedback except for:
It could, but I'm not sure how we should deal with it. The strdup that was already there was fallible, too, and went unhandled. Should we just set a flag and stop logging altogether? Or drop this one entry? The latter would be difficult, because we'd then later have an unmatched stop event in the log.
We can't because then we don't know which entry was supposed to introduce the string into the log file. But maybe I'm missing something.",CODE_IMPLEMENTATION,1,FULL_TEXT
912496,5,"Comment on attachment 799789
v2
Review of attachment 799789:
-----------------------------------------------------------------
I think we don't need to output the string in between the logs.
Before logging everything, we can output a textmap linking the numbers with the output.
(Can you open a follow-up bug for this?)
::: js/src/TraceLogging.cpp
@@ +149,5 @@
Adjust comment to use ""text"" instead of ""file""
@@ +152,5 @@
Good call. I indeed forget to check the result of strdup. Can you add check for strdup and textMap failures and just return for now?",CODE_REVIEW,0,FULL_TOKEN
912496,6,"https://hg.mozilla.org/integration/mozilla-inbound/rev/ba28223861b1
I agree on the text map, filing a bug now.",NEW_ISSUE_FILING,0,FULL_TEXT
912496,7,https://hg.mozilla.org/mozilla-central/rev/ba28223861b1,UNCODED,0,UNMATCHED
919434,1,"Created attachment 808460
testcase
With these prefs:
  user_pref(""layers.acceleration.disabled"", true);
  user_pref(""layers.force-active"", true);
the testcase makes Firefox infinitely recurse due to a cyclic layer tree.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
919434,2,"Created attachment 808461
stack+",UNCODED,0,UNMATCHED
919434,3,"Created attachment 810737
cycle creation stack
Caught that cycle being created. This presumably has something to do with how we process all descendants of a fixed position layer specially, and a bad interaction of that with sticky position layers.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
919434,4,Should that assertion be added to mozilla-central?,QUESTION,0,FULL_TEXT
919434,6,"Sure. I had been thinking to add it in the same patch that actually fixes this problem, but then I never made any headway on figuring out the cause of the bug. I think this will need input from someone who knows the layer system better than I do.",ANSWER_TO_QUESTION,0,FULL_TEXT
919434,7,"It seems like this should block bug 916315, no?",ISSUE_IMPACT,0,FULL_TEXT
919434,8,I don't reproduce either this or bug 931450 in the latest Nightly. Discussion on bug 919156 suggests that they could have been fixed in bug 919144?,REPRODUCTION_ATTEMPT,0,FULL_TEXT
919434,9,"Nice, yup.
I verified that bug 919144 did indeed fix this, using targeted builds. (Its parent cset, 21df28ade757, reproduces this bug for me -- whereas the cset for the last patch in bug 919144 does not reproduce this bug for me.)
 --> Resolving as FIXED by bug 919144.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
919434,10,(Also: I'm using 64-bit Linux --> broadening Platform from Mac to All),CLARIFICATION,0,FULL_TEXT
919434,11,"Reproduced in Nightly 2013-09-25.
Verified fixed 28.0a1 (2013-12-05), Win 7 x64",SOLUTION_VERIFICATION,0,FULL_TOKEN
919434,12,"Landed the crashtest:
https://hg.mozilla.org/integration/mozilla-inbound/rev/a1c8f8c10088",UNCODED,0,UNMATCHED
919434,13,https://hg.mozilla.org/mozilla-central/rev/a1c8f8c10088,UNCODED,0,UNMATCHED
919434,14,"Pretty sure this test never actually tested the correct configuration.  The layers.acceleration.disabled preference is queried once and the value reused, so setting it for a particular test is just ignored.",SOLUTION_VERIFICATION,0,FULL_TOKEN
919434,15,"I can't build this far back, but certainly in today's builds, this does not run the test with layers.acceleration.disabled actually set, as the pref() line in crashtests.list sets it too late to get picked up.  And if it was getting picked up, it would mean that the value of that preference changes mid execution, which is at best scary and certainly not supported.",SOLUTION_VERIFICATION,0,FULL_TOKEN
924397,1,"[jdm@rosencrantz mozilla-central]$ ./mach build dom/bindings/
 0:00.12 /usr/bin/gmake -C dom/bindings -j8 -s
 0:00.22 Generating global WebIDL files
 0:00.96 Traceback (most recent call last):
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/config/pythonpath.py"", line 56, in <module>
 0:00.96     main(sys.argv[1:])
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/config/pythonpath.py"", line 48, in main
 0:00.96     execfile(script, frozenglobals)
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/dom/bindings/GlobalGen.py"", line 81, in <module>
 0:00.96     main()
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/dom/bindings/GlobalGen.py"", line 55, in main
 0:00.96     parser.parse(''.join(lines), fullPath)
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/dom/bindings/parser/WebIDL.py"", line 4830, in parse
 0:00.96     self._productions.extend(self.parser.parse(lexer=self.lexer,tracking=True))
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/other-licenses/ply/ply/yacc.py"", line 263, in parse
 0:00.96     return self.parseopt(input,lexer,debug,tracking,tokenfunc)
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/other-licenses/ply/ply/yacc.py"", line 792, in parseopt
 0:00.96     tok = self.errorfunc(errtoken)
 0:00.96   File ""/run/media/jdm/ssd/mozilla-central/dom/bindings/parser/WebIDL.py"", line 4778, in p_error
 0:00.96     raise WebIDLError(""Syntax Error at end of file. Possibly due to missing semicolon(;), braces(}) or both"", [])
 0:00.96 WebIDL.WebIDLError: error: Syntax Error at end of file. Possibly due to missing semicolon(;), braces(}) or both
 0:00.98 gmake[1]: *** [ParserResults.pkl] Error 1
 0:00.98 gmake: *** [default] Error 2",STACK_TRACE,0,FULL_TOKEN
924397,2,The way to reproduce this is to remove a ; after an interface definition in any file in dom/webidl and rebuild.,S2R,0,FULL_TEXT
924397,3,"Created attachment 816436
Print_file_when_WebIDL_raises_syntax_error_at_EOF.patch
Here is the error message that gets printed:
 0:28.12 WebIDL.WebIDLError: error: Syntax Error at end of file. Possibly due to missing semicolon(;), braces(}) or both, WorkerNavigator.webidl",CODE_IMPLEMENTATION,1,FULL_TOKEN
924397,4,"Comment on attachment 816436
Print_file_when_WebIDL_raises_syntax_error_at_EOF.patch
Thanks Tareq! According to hg log, Kyle is a better choice of reviewer here.",CODE_REVIEW_REQUEST,0,FULL_TEXT
924397,5,https://hg.mozilla.org/integration/mozilla-inbound/rev/48d6dad2df16,UNCODED,0,UNMATCHED
924397,6,https://hg.mozilla.org/mozilla-central/rev/48d6dad2df16,UNCODED,0,UNMATCHED
927544,1,"Created attachment 817999
patch
The stub call made when Ion deoptimizes a JSOP_CALLPROP does not invoke unknown method hooks on the object.",CODE_IMPLEMENTATION,1,FULL_TEXT
927544,2,+    JS_ASSERT(op = JSOP_CALLPROP);,CODE_REVIEW,0,FULL_TOKEN
927544,3,"Thanks, good catch.
I ended up folding this into the patch for bug 925962, rev 81b505e9a435.  That rev inadvertently fixed the above bug, by using a different mechanism to distinguish calls vs. gets (weirdly, CallGetProperty isn't associated with a resume point when used to fetch the |prototype| property for callee functions).",SOLVED_BY_OTHER_ISSUE,0,FULL_TOKEN
937475,1,"""The when parameter describes at what time (in seconds) the sound should stop playing. It is in the same time coordinate system as AudioContext.currentTime.""
Currently |when| is interpreted on a timeline that advances with AudioContext.currentTime until playback starts and then in buffer time coordinates.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
937475,2,"Created attachment 830627
buffer-source-stop-rate-1.html
These two testcases should play for 1 second, but play for 4 seconds.",TEST_CASES,0,FULL_TEXT
937475,3,"Created attachment 830628
buffer-source-stop-rate-2.html",UNCODED,0,UNMATCHED
937475,4,"Ah, I don't know why but I seem to remember that I once wrote a patch to fix this.  I thought that I had gotten reviews and landed it but now I can't even find a bug, which tells me that I must have forgotten to even file the bug. :(",PROBLEM_REVIEW,0,FULL_TOKEN
937475,5,"Created attachment 831381
change DURATION from end-offset to duration and compare buffer length using integer sample count",UNCODED,0,UNMATCHED
937475,6,"Created attachment 831382
separate stream position from buffer position so that stop time can use stream position",UNCODED,0,UNMATCHED
937475,7,"Once bug 937057 is fixed, this will be easier to test.  Patches here are helpful in fixing bug 937057.  It may be easiest to add stop calls to the test for bug 938450.",ISSUE_IMPACT,0,FULL_TEXT
937475,8,"https://hg.mozilla.org/integration/mozilla-inbound/rev/27c02b405be0
https://hg.mozilla.org/integration/mozilla-inbound/rev/2e2cdd1826e1",UNCODED,0,UNMATCHED
937475,9,"https://hg.mozilla.org/mozilla-central/rev/27c02b405be0
https://hg.mozilla.org/mozilla-central/rev/2e2cdd1826e1",UNCODED,0,UNMATCHED
937475,10,https://hg.mozilla.org/integration/mozilla-inbound/rev/8187818246ad,UNCODED,0,UNMATCHED
937475,11,https://hg.mozilla.org/mozilla-central/rev/8187818246ad,UNCODED,0,UNMATCHED
939475,1,"Error message:
http://mxr.mozilla.org/mozilla-central/source/js/src/builtin/TestingFunctions.cpp#287
Help:
http://mxr.mozilla.org/mozilla-central/source/js/src/builtin/TestingFunctions.cpp#1344",ERROR_MESSAGE,0,FULL_TOKEN
939475,2,"Created attachment 833395
Patch
I assume sliceTimeBudget also needs to be included.",CODE_IMPLEMENTATION,1,FULL_TEXT
939475,3,"The parameters listed still don't seem to match the list:
  http://mxr.mozilla.org/mozilla-central/source/js/src/builtin/TestingFunctions.cpp#259
Instead of duplicating this list in several places (which are sure to go stale before long), can you have a
#define GC_PARAMETER_ARGS_LIST ""maxBytes, maxMallocBytes, ...""
right above/below the paramMap and used twice below?",CODE_REVIEW,0,FULL_TOKEN
939475,4,"Created attachment 8334237
Patch (v2)",UNCODED,0,UNMATCHED
939475,5,"Comment on attachment 8334237
Patch (v2)
Review of attachment 8334237:
-----------------------------------------------------------------
Great!
::: js/src/builtin/TestingFunctions.cpp
@@ +268,5 @@
Could you add a \n after this line?  Also, could you insert "" or "" before markStackLimit?",CODE_REVIEW,0,FULL_TOKEN
939475,6,"Created attachment 8334961
Patch with review comments addressed. r=luke",UNCODED,0,UNMATCHED
939475,7,https://hg.mozilla.org/integration/mozilla-inbound/rev/ca39b88accf3,UNCODED,0,UNMATCHED
939475,8,https://hg.mozilla.org/mozilla-central/rev/ca39b88accf3,UNCODED,0,UNMATCHED
947523,1,"Created attachment 8344080
Zoomingincrashlog.txt
Description:
If the user keeps zooming in on an etherpad webpage, the phone will crash.
Repro Steps:
1)  Updated Buri to Build ID: 20131206040203
2)  Tap on the ""Browser"" icon.
3)  Navigate to https://etherpad.mozilla.org
4)  Tap on ""Create new public pad"".
5)  Keep zooming in on the webpage as far as the user can go. If the crash doesn't occur keeping zooming in on the webpage while changing the phone's orientation.
Actual:
The device will either crash and reset or the browser will crash.
Expected:
The user can zoom in without a crash occurring.
Environmental Variables
Device: Buri v 1.3.0 Mozilla RIL
Build ID: 20131206040203
Gecko: http://hg.mozilla.org/mozilla-central/rev/1401e4b394ad
Gaia: 8fca2ca67e8a6022fe6ed8cb576e5d59dfb5237f
Platform Version: 28.0a1
Notes:
Repro frequency: 100%
See attached: video clip, logcat",PROBLEM_DESCRIPTION,0,FULL_TOKEN
947523,2,"This issue does not occur on Leo v 1.1.0 COM RIL
Environmental Variables
Device: Leo v 1.1.0 COM RIL
Build ID: 20131024041202
Gecko: http://hg.mozilla.org/releases/mozilla-b2g18/rev/e4cb5a852e3d
Gaia: 39b0203fa9809052c8c4d4332fef03bbaf0426fc
Platform Version: 18.1
RIL Version: 01.01.00.019.264 
The browser crash does not occur when zooming in on the page.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,3,"Created attachment 8344085
BrowserCrash.mp4",UNCODED,0,UNMATCHED
947523,4,"This issue occurs on the Buri v 1.2.0 COM RIL 
Environmental Variables
Device: Buri v 1.2.0 COM RIL
Build ID: 20131204004003
Gecko: http://hg.mozilla.org/releases/mozilla-b2g26_v1_2/rev/758f3fb32dda
Gaia: 8d762f3376318fd6be390432db750ae4904c9ab6
Platform Version: 26.0
RIL Version: 01.02.00.019.102 
The browser or device will crash when zooming in on the MoPad webpage.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,5,"Uh oh. That's an OS restart crash, which is really bad.
Can we get a crash report ID for this bug?",QUESTION,0,FULL_TEXT
947523,6,"Created attachment 8344804
947523_dmesg
During the few hours of reproing this issue I was only able to get the OS crash three times and there was no dump in the Crash Reports folder on the phone. I talked to Kevin and he said that it could be an OOM issue so I snagged a dmesg. Hopefully that should help you guys out. I was able to get the OS crash on today's 1.2 and 1.3, but the attached dmesg is from the build below.
Environmental Variables:
Device: Buri 1.3 mozRIL
BuildID: 20131209053402
Gaia: 1d45d1dc3201059d5c8f2efdeb92c04576d8e161
Gecko: 9f12a9fab080
Version: 28.0a1
Firmware Version: 20131115",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,7,Does this reproduce on a 1.1 Buri device?,REPRODUCTION_REQUEST,0,FULL_TEXT
947523,8,"This does not repro on a 1.1 Buri. The same functionality is seen in Leo 1.1 as it simply doesn't let you zoom in far enough and keeps rubber-banding back to to a set zoom if you try to keep pinching to zoom in.
Environmental Variables:
Device: Buri 1.1 mozRIL
BuildID: 20131209041202
Gaia: 6ff3a607f873320d00cb036fa76117f6fadd010f
Gecko: 05117f42088f
Version: 18.0
Firmware Version: 20131115",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,9,"Just wondering, should we also add ""crash"" in the keyword field?",QUESTION,0,FULL_TEXT
947523,10,"Nope - this is an OOM of the parent process, not a crash.",ANSWER_TO_QUESTION,0,FULL_TEXT
947523,11,"<6>[  434.353606] [ pid ]   uid  tgid total_vm      rss cpu oom_adj oom_score_adj name
<6>[  434.353648] [   98]     0    98       78       41   0     -16          -941 ueventd
<6>[  434.353668] [  128]  1000   128      213       15   0     -16          -941 servicemanager
<6>[  434.353686] [  129]     0   129     1009       45   0     -16          -941 vold
<6>[  434.353703] [  132]     0   132      834       29   0     -16          -941 fakeperm
<6>[  434.353719] [  136]     0   136    76681    39295   0       0             0 b2g
<6>[  434.353738] [  137]     0   137     1958       67   0     -16          -941 netd
<6>[  434.353754] [  138]     0   138      180       14   0     -16          -941 debuggerd
<6>[  434.353773] [  139]  1001   139     5093      370   0     -16          -941 rild
<6>[  434.353789] [  140]  1013   140     4665      340   0     -16          -941 mediaserver
<6>[  434.353808] [  141]  1002   141      338       27   0     -16          -941 dbus-daemon
<6>[  434.353826] [  142]  1017   142      437       35   0     -16          -941 keystore
<6>[  434.353843] [  152]  1000   152      481       23   0     -16          -941 mm-pp-daemon
<6>[  434.353861] [  155]  1000   155      763       76   0     -16          -941 mm-qcamera-daem
<6>[  434.353879] [  160]     0   160      297       27   0     -16          -941 gpu_dcvsd
<6>[  434.353896] [  161]     0   161      863        2   0     -16          -941 adbd
<6>[  434.353914] [  187]     0   187      218       40   0     -16          -941 location-mq
<6>[  434.353933] [  188]  1001   188     1508       58   0     -16          -941 qmuxd
<6>[  434.353949] [  196]  1001   196     1549       72   0     -16          -941 netmgrd
<6>[  434.353968] [  197]     0   197     3651       73   0     -16          -941 xtwifi-inet-age
<6>[  434.353984] [  205]  2000   205      198       16   0     -16          -941 sh
<6>[  434.354003] [  208]     0   208     3046       83   0     -16          -941 xtwifi-client
<6>[  434.354021] [  408]  1007   408      176       14   0     -16          -941 logwrapper
<6>[  434.354039] [  409]  1010   409      662       78   0     -16          -941 wpa_supplicant
<6>[  434.354058] [  421]  1000   421      337       27   0     -16          -941 qosmgr
<3>[  434.354074] Out of memory: Kill process 136 (b2g) score 827 or sacrifice child
<3>[  434.354268] Killed process 136 (b2g) total-vm:306724kB, anon-rss:52324kB, file-rss:104856kB
Near the top it says total_vm is 76681 KB, but the ""Killed process"" line says 306724 KB...",ERROR_MESSAGE,0,FULL_TOKEN
947523,12,"This issue looks to have started reproducing on the 11/08 1.2 Buri build. On builds before 11/08, the tab would need to be reloaded every so often, but B2G would remain stable.
- Works -
Environmental Variables:
Device: Buri v1.2 MOZ RIL
BuildID: 20131107004003
Gaia: 590eb598aacf1e2136b2b6aca5c3124557a365ca
Gecko: 26f1e160e696
Version: 26.0
RIL Version: 01.02.00.019.102
Firmware Version: 20131115
- Broken -
Environmental Variables:
Device: Buri v1.2 MOZ RIL
BuildID: 20131108004004
Gaia: 4cf40fb30c7b8380ea83ed0d4efe043b8b81737f
Gecko: a886c641a306
Version: 26.0
Firmware Version: 20131115",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,13,http://hg.mozilla.org/releases/mozilla-b2g26_v1_2/pushloghtml?fromchange=26f1e160e696&tochange=a886c641a306,UNCODED,0,UNMATCHED
947523,14,"The regression here is likely on the gecko side, as this involves killing the parent process.
A suspected patch for causing this regression is bug 927633 because is involving IPC.
Can we get a regression range on 1.3 as well? That will help isolate with bug caused this.
Mason - Any ideas if bug 927633 caused this?",PROBLEM_REVIEW,0,FULL_TOKEN
947523,15,"blocking+ - we should never cause the full phone to restart.
Also marking security sensitive because a web page should be able to cause the full phone to restart, which could be exploited by a web developer to force phone restarts.",PROBLEM_REVIEW,0,FULL_TOKEN
947523,16,"Something similar to this issue looks to have started on the first working 1.3 build from 9/19. The OS will crash and display the crash report page on each build up to 9/23. 
From 9/24 and on, there is no crash report screen displayed and appears to instead be an OOM issue... exactly as specified in comment 5 and comment 9.
There are builds between 9/24 and 12/11 where it is really difficult to get a repro and instead the Browser tab will need to be reloaded since the webpage becomes unresponsive many times.
I am making the window be between 9/23 and 9/24 since that is when it looks to have become and OOM issue which is what this bug is about. If the crash is considered relevant to this bug, then it occurred on the first 1.3 build from 9/19. 
- ""Works"" (OS crashes) -
Environmental Variables:
Device: Buri v1.3 MOZ RIL
BuildID: 20130923040214
Gaia: 3408cc3f6b190c8cd31832fbb8cd2ae571041f29
Gecko: f97307cb4c95
Version: 27.0a1
Firmware Version: 20131115
- Broken (OS restarts with an OOM) -
Environmental Variables:
Device: Buri v1.3 MOZ RIL
BuildID: 20130924040201
Gaia: a22ba4a3a9efd99f94adf9ece8a2b391d4df295b
Gecko: 1fda74e33e06
Version: 27.0a1
Firmware Version: 20131115",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,17,"I just tried the broken gaia and gecko revisions from comment 15. I was able to reproduce the crash with and without bug 927633. The patch also reduced memory usage by 1.5 mb per process, so if we're getting an OOM, it should just happen sooner without bug 927633.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
947523,18,Andrew - Can you find someone to look into this full phone OOM?,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
947523,19,Denial of service is not a security issue.  Especially when user interaction is required to trigger the bug.,CLARIFICATION,0,FULL_TOKEN
947523,20,"Kyle suggests testing this with skiagl off to narrow out that as a cause => qawanted.
Dale, with Ben out can you tell us how the gaia browser zooming functionality is implemented?  Do you think it could be triggering a gecko crash with graphics changes around the beginning of September?",QUESTION,0,FULL_TOKEN
947523,21,"I disagree with this. DOSs are definitely security issues if it's outside of the user's control. I'm not sure if this particular bug is outside of the user's control however, as it's dependent whether the root cause can happen in other user scenarios that are triggered by visiting a malicious website/app aiming to reboot the phone.
I'm doubtful this is related to Skia GL. This is OOMing the parent process, which shouldn't technically ever be possible on the phone with anything driven by untrusted web content. This is likely a process management regression, which is why this why filed in IPC.",CLARIFICATION,0,FULL_TEXT
947523,22,"If you do want to rule out the extra memory usage due to GL acceleration, just set:
pref(""gfx.canvas.azure.accelerated"", false);",CLARIFICATION,0,FULL_TOKEN
947523,23,"The browser doesnt do any zooming, its purely implemented inside Gecko/APZC, the graphics changes are very likely to effect it",CLARIFICATION,0,FULL_TEXT
947523,24,"Milan
Please have this assigned. We would like to have a patch for the same by 12/20.",ASSIGNEE_REQUEST,0,FULL_TOKEN
947523,25,Why does this block?  Do we expect that users will commonly try to zoom in like this?,QUESTION,0,FULL_TOKEN
947523,26,"I think it's not the likelihood that's caused to be marked as a blocker - instead, it was marked as a blocker because it should never be possible to cause a full reboot of the phone. During 1.01, a lot our partners were pretty adamant on having a no known full phone crashes on release policy, as that ensures a user never sees an unexpected reboot of the phone to think that something is fundamentally broken with the phone.",ANSWER_TO_QUESTION,0,FULL_TEXT
947523,27,"Another way to explain this - the blocker here is the full phone reboot, not the fact that we're OOMing in the STR in general. If we fixed this bug by causing the OOM to happen in the child process, rather than the parent process, then that would fix the blocking factor on this bug.",CLARIFICATION,0,FULL_TEXT
947523,28,"I tried to reproduce this issue after setting pref(""gfx.canvas.azure.accelerated"", false); and I could not reproduce this issue on the latest Buri 1.3 Build ID: 20131217004001
I also checked without setting the preference on the latest Buri 1.3 and could easily reproduce the bug. 
Gaia   dca0a3dcf062ce3e422a9c56d141c14543c816fb
SourceStamp 1f7db4cc788e
BuildID 20131217004001
Version 28.0a2",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,29,Guess I wasn't right - the OOM is being caused by Skia GL. Still puzzled why the OOM is hitting the parent process rather than the child process.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
947523,30,"There's only two gfx bugs in the regression range here:
* bug 844819
* bug 934886
Which one caused this regression? Maybe bug 934886?
Peter - What do you think?",QUESTION,0,FULL_TOKEN
947523,31,Perhaps because the browser app runs in the parent process?,QUESTION,0,FULL_TEXT
947523,32,"Well right, but I thought each browser tab is supposed to run in a separate child process. So that means if the child process runs out of memory, then the tab should get killed with the sad face error page.",ANSWER_TO_QUESTION,0,FULL_TEXT
947523,33,bug 934886 is trying to fix graphic artifact when taking screenshot. I didn't see the related function called (GetThebesSurfaceForDrawTarget) when I zoom in/out the browser pages.,ANSWER_TO_QUESTION,0,FULL_TEXT
947523,34,"If this is ""just"" OOM, then anything that causes us to use more memory would cause the regression.  The memory used is no different than that used by non-graphics code.",PROBLEM_REVIEW,0,FULL_TOKEN
947523,35,I will investigate why the parent process is getting killed and if there is anything we can do to address it.,STATUS_UPDATE,0,FULL_TEXT
947523,36,"I've reproduced the browser crash.  I zoomed in a fair amount and ran b2g-info:
                  |     megabytes    |
   NAME  PID NICE  USS  PSS  RSS VSIZE OOM_ADJ USER
    b2g 1531    0 49.5 63.2 77.0 208.1       0 root
Browser 1975    1 23.2 36.9 50.6 104.1       2 app_1975
System memory info:
            Total 179.7 MB
     Used - cache  94.6 MB
  B2G procs (PSS) 100.1 MB
    Non-B2G procs  -5.4 MB
     Free + cache  85.1 MB
             Free  52.4 MB
            Cache  32.6 MB
I then zoomed just a little bit more and the browser tab was killed.  I got the ""oops, this is embarrassing"" dialog.  The logcat indicated that ""memory pressure"" was over, so that suggests it was an OOM.
I find it interesting that just a tiny bit of zooming could cause us to consume over 50MB of free memory, though.
I will continue investigating tomorrow.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
947523,37,"Adding instrumentation I can see that zooming results in extremely large gralloc buffers getting created.  For example, with a zoom of 3.75 in APZC I see a gralloc buffer request for 2238x13249.  This asks the system for ~110MB of mlocked memory which ends up killing b2g altogether.  Sometimes we get moderately smaller requests for gralloc buffers around ~30MB which only end up killing the browser tab.
I'm trying to trace where this size is getting calculated.  Are we zooming the entire layer and trying to alloc a buffer for the entire thing?  Even if that is the case it seems the zoom is being over-accumulated over time or something.",PROBLEM_REVIEW,0,FULL_TOKEN
947523,38,Let's get the explanation - going a bit trigger happy on the ni...,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
947523,39,"The gralloc buffer request is probably coming from layout/gfx code as it tries to rasterize the requested area. The ""requested area"" is going to be a function of the resolution and the displayport. In 1.2 the code that sets these values are in TabChild.cpp, at [1], [2] and [3]. We should verify that as the resolution increases the displayport size (in CSS pixels) decreases.
[1] http://git.mozilla.org/?p=releases/gecko.git;a=blob;f=dom/ipc/TabChild.cpp;h=8325a51b1091cc8c6a162f139e3d0d860b4ca969;hb=cd74e4ad7d9dd3d699b13f7262ee898e4cf3f628#l1639
[2] http://git.mozilla.org/?p=releases/gecko.git;a=blob;f=dom/ipc/TabChild.cpp;h=8325a51b1091cc8c6a162f139e3d0d860b4ca969;hb=cd74e4ad7d9dd3d699b13f7262ee898e4cf3f628#l1682
[3] http://git.mozilla.org/?p=releases/gecko.git;a=blob;f=dom/ipc/TabChild.cpp;h=8325a51b1091cc8c6a162f139e3d0d860b4ca969;hb=cd74e4ad7d9dd3d699b13f7262ee898e4cf3f628#l1648",ANSWER_TO_QUESTION,0,FULL_TEXT
947523,40,"It appears that the display port being set from ProcessUpdateFrame() shrinks with the scale, but not when its set from ProcessUpdateSubFrame().  Here is my instrumentation while zooming the etherpad:
I/Gecko   (12250): ### ### TabChild::ProcessUpdateSubFrame() calling SetDisplayPortForElement() width:598.000000 height:2525.000000
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetResolution() scale:0.339769
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetDisplayPortForElement() width:980.000000 height:1117.816650
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetResolution() scale:0.466176
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetDisplayPortForElement() width:980.000000 height:1117.816650
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetResolution() scale:0.466176
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetDisplayPortForElement() width:980.000000 height:1117.816650
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetResolution() scale:1.090141
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetDisplayPortForElement() width:439.500000 height:835.000000
I/Gecko   (12250): ### ### TabChild::ProcessUpdateSubFrame() calling SetDisplayPortForElement() width:598.000000 height:2525.000000
I/Gecko   (12250): ### ### TabChild::ProcessUpdateSubFrame() calling SetDisplayPortForElement() width:598.000000 height:2525.000000
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetResolution() scale:2.474219
I/Gecko   (12250): ### ### TabChild::ProcessUpdateFrame() calling SetDisplayPortForElement() width:193.500000 height:367.500000
I also started to instrument the ThebesLayerData::Accumulate method and got this in my last run:
I/Gecko   (12250): ### ### ThebesLayerData::Accumulate() OR mVisibleRegion:0/0 aVisibleRect:0/0
I/Gecko   (12250): ### ### ThebesLayerData::Accumulate() OR mVisibleRegion:0/0 aVisibleRect:0/0
I/Gecko   (12250): ### ### ThebesLayerData::Accumulate() OR mVisibleRegion:0/0 aVisibleRect:1408/612
8
I/Gecko   (12250): ### ### ThebesLayerData::Accumulate() OR mVisibleRegion:1408/6128 aVisibleRect:13
88/6126
I/Gecko   (12250): ### ### ThebesLayerData::Accumulate() OR mVisibleRegion:1408/6128 aVisibleRect:69
/6128
I/Gecko   (12250): ### ### ContainerState::PopThebesLayer() calling SetVisibleRegion() width:1477 he
ight:6128
I still can't map the height of 6128 in this case back to the display port values.",STACK_TRACE,0,FULL_TOKEN
947523,41,"Oh... the display port of 598x2525 in ProcessUpdateSubFrame() does map directly to the visible region if you multiply it by the scale:
  598x2525 * 2.474219 = 1480x6247",CLARIFICATION,0,FULL_TOKEN
947523,42,Well that's not good. Seems like a sub-apzc bug.,CLARIFICATION,0,FULL_TEXT
947523,43,"So part of the problem here is that the composition bounds on the child APZC is getting scaled up as we zoom. This doesn't happen for the parent because the parent's composition bounds is clamped to the screen bounds [1]. (We have plans to remove that behaviour but it doesn't affect this bug on 1.2).
The next contributing factor is that the displayport calculation at [2] doesn't account for this increase in composition bounds. For the parent APZC the composition bounds don't change, so the division by the zoom at line [2] has the desired effect of shrinking the displayport as the zoom increases. For the child APZC the division merely cancels out the increase in composition bounds, and so we end up with a constant-sized displayport (in CSS pixels) regardless of zoom.
So the straightforward fix here would be to just divide again by the zoom. However, we can't do that because in general the child APZC doesn't request content repaints (and hence doesn't recalculate its displayport) while the parent is getting zoomed. So if the child last set a displayport of 500x1000 CSS pixels, and then the parent zooms to 5x what it was before, we would want the child to shrink its displayport down to 100x200 CSS pixels but it never gets a chance. The parent sets the resolution without the child knowing about it, and at that point layout tries to render the child's 500x1000 displayport at a 5x resolution which causes the OOM.
For a fix to work we would either need the parent APZC to notify all other APZCs in its subtree that it's about to change the zoom (and then have the children recalculate their displayport) or, in TabChild::UpdateRootFrame, find all the displayports inside a presShell and shrink them by the right factor. I'll try to see if either of these approaches are viable.
[1] http://git.mozilla.org/?p=releases/gecko.git;a=blob;f=layout/base/nsDisplayList.cpp;h=7e11b99bedc4b3e80b216e4ba05a8c73f40d6a2b;hb=cd74e4ad7d9dd3d699b13f7262ee898e4cf3f628#l748
[2] http://git.mozilla.org/?p=releases/gecko.git;a=blob;f=gfx/layers/ipc/AsyncPanZoomController.cpp;h=a6878295d0c476f71855003f73b403930e339e7f;hb=cd74e4ad7d9dd3d699b13f7262ee898e4cf3f628#l911",PROBLEM_REVIEW,0,FULL_TOKEN
947523,44,"Throwing this over to :kats as he is working on a patch to propagate the zoom info to child APZCs as described in comment 42.
Please let me know if you would like me to test anything.  Thanks!",ASSIGNEE_REQUEST,0,FULL_TEXT
947523,45,"So I tried propagating the zoom info to child APZCs as I described above but ran into a threading problem. Specifically, I need to propagate the new zoom to child APZCs in ScheduleContentRepaint *before* posting the message to the GeckoContentController. However propagating the zoom to child APZCs requires holding the tree lock, and that results in a deadlock scenario because we're already holding the APZC lock there.
In addition this solution felt pretty hacky and brittle so I'm working on a different solution now which modifies how the displayport is stored. In nsDOMWindowUtils::SetDisplayPortForElement I'm going to multiply in the cumulative resolution and in nsLayoutUtils::GetDisplayPort I'm going to divide out the cumulative resolution. This way when the resolution of intermediate presshells change, the retrieved displayport is automatically scaled accordingly. I *think* this should work because the displayport is stored relative to the scroll offset and so scaling it won't move it around improperly, but I'm building the patch now to test it and see how it fares.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
947523,46,"Created attachment 8355612
Change how the displayport is stored
Since I don't have a working 1.2 build could you guys apply this patch and see if it fixes the problem without introducing any new regressions? Possible regressions would include the painted content (the displayport) not being positioned correctly, specially when zoomed in or out.
I did some light testing of this patch on master and I couldn't repro the OOM although there does still appear to be a fair amount of memory pressure and I think the HWC is dropping layers or something.",CODE_IMPLEMENTATION,1,FULL_TOKEN
947523,47,"Created attachment 8356186
Change how the displayport is stored
While attempting to build the 1.2 branch with the attached patch applied, I encountered the following compiler errors:
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp: In function 'void DestroyGfxRect(void*, nsIAtom*, void*, void*)':
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: reference to 'gfx' is ambiguous
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/ipc/chromium/src/chrome/common/transport_dib.h:20: error: candidates are: namespace gfx { }
../../dist/include/mozilla/gfx/Types.h:15: error:                 namespace mozilla::gfx { }
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: 'rect' was not declared in this scope
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: reference to 'gfx' is ambiguous
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/ipc/chromium/src/chrome/common/transport_dib.h:20: error: candidates are: namespace gfx { }
../../dist/include/mozilla/gfx/Types.h:15: error:                 namespace mozilla::gfx { }
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: expected type-specifier before 'gfx'
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: expected '>' before 'gfx'
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: expected '(' before 'gfx'
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: expected primary-expression before '>' token
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:308: error: expected ')' before ';' token
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:309: error: type '<type error>' argument given to 'delete', expected pointer
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp: In member function 'virtual nsresult nsDOMWindowUtils::SetDisplayPortForElement(float, float, float, float, nsIDOMElement*)':
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:391: error: reference to 'gfx' is ambiguous
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/ipc/chromium/src/chrome/common/transport_dib.h:20: error: candidates are: namespace gfx { }
../../dist/include/mozilla/gfx/Types.h:15: error:                 namespace mozilla::gfx { }
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:391: error: expected type-specifier before 'gfx'
/home/botond/dev/mozilla/b2g-hamachi-1.2/gecko/dom/base/nsDOMWindowUtils.cpp:391: error: expected ')' before 'gfx'
Attached is an updated patch that fixes these errors.",CODE_IMPLEMENTATION,1,FULL_TOKEN
947523,48,"Comment on attachment 8356186
Change how the displayport is stored
Review of attachment 8356186:
-----------------------------------------------------------------
:tn, what do you think of this change? In a nutshell it changes the displayport stored in layout to be in CSS pixels multiplied by the resolution, rather than just CSS pixels. That way when we increase the resolution on an ancestor layer, the descendants texture sizes automatically shrink and we don't OOM.",CODE_REVIEW_REQUEST,0,FULL_TEXT
947523,49,"Comment on attachment 8356186
Change how the displayport is stored
My first thought is that we will now have to update every display port under a presshell (and it's child documents) anytime it's resolution changes. Is this feasible/desirable?",CODE_REVIEW,0,FULL_TEXT
947523,50,"Comment on attachment 8356186
Change how the displayport is stored
I tested this on my 1.2 hamachi device, and I cannot reproduce the crash with it. I also didn't notice any regressions.",SOLUTION_VERIFICATION,0,FULL_TEXT
947523,51,"With this patch I still see Browser crash while zooming the gaia meeting etherpad:
  https://etherpad.mozilla.org/gaia-meeting-notes
I would like to test a bit more with instrumentation to see if its the same OOM issue, but probably won't be able to until tomorrow morning.",SOLUTION_VERIFICATION,0,FULL_TOKEN
947523,52,"On this page, I see the crash as well with the patch (I saw a phone crash, not a browser crash), though it seemed it required zooming in further to get the crash with the patch than without.",SOLUTION_VERIFICATION,0,FULL_TEXT
947523,53,"Comment on attachment 8356186
Change how the displayport is stored
Talked to kats on irc about this. If we don't change AZPC code too then it will just end up setting the same display port after zooming again, so it won't fix the main problem. We need to at least pair this with an AZPC change. So clearing feedback flag for now.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
947523,54,"On the buri you can monitor the texture memory usage by looking at the Mlocked field in /proc/meminfo:
  while true; do sleep 1; adb shell cat /proc/meminfo | grep Mlocked; done
This shows how much memory the device has mlocked as ashmem.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
947523,55,"Created attachment 8356593
Change how the displayport is stored
Updated patch to shrink the displayport for subframes in APZC code.",CODE_IMPLEMENTATION,1,FULL_TEXT
947523,56,"I've been discussing this issue with :tn and :bkelly and thinking about it, and we might need to take a step back here with the approach taken.
The fundamental problem is that when async subframe scrolling is enabled, we need more memory to render content. This is expected behaviour, but it was always unclear just how much more memory we would need, how it would be bounded, and whether we would often run into OOM situations. For the most part we went with a ""let's do it and see"" approach.
Turns out that with our current implementation (in 1.2+) the memory usage is unbounded, and can easily run into OOM situations. A simple conceptual example is a page that looks something like this:
<body>
 <iframe style=""height: 10000px"" src=""reallylongpage.html""></iframe>
</body>
The iframe is 10,000 pixels tall, and we end up requesting a giant displayport (some multiple of 10000px) for this, because we could scroll either the outer page or the iframe, and need to have enough pre-rendered content to paint all of that. This, of course, will trigger an OOM. Even if the patches I uploaded to this bug worked perfectly we would still probably OOM on this page.
Going forward I think we have to use the visible region of the iframe (i.e. clipped by parent frames and the screen) rather than the full composition bounds as the base for the displayport. However I think that doing this is too risky for 1.2.
For 1.2 I see four main options:
1) Disable subframe apzc. This eliminates the memory requirement and also reduces responsiveness. I suspect this is off the table because of commitments we made to partners.
2) Apply some tweaks to make the OOMs less frequent. This is what I've been trying to do with the above patches, but it's hard to reduce the OOM threshold enough to stop OOMing on this etherpad page because the iframe is huge. It also doesn't guarantee OOMs will not happen.
3) Try some other method to clamp the memory usage, such as putting a hard limit on texture sizes. (I don't know if this can be easily implemented, and it would almost certainly result in scenarios where parts of subframes remain blank.) Another option is to just kill the entire tab if the requested displayport is too big. That limits the crash to a browser tab rather than a phone reboot.
4) Do nothing for 1.2; leave this bug unfixed and ship subframe APZC as-is. Focus efforts on getting a proper fix in for 1.3+
Based on comment 26, I'm thinking of abandoning my current attempt at option #2 and going with option #3 instead. If anybody has other thoughts please let me know.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
947523,57,"[3] sounds okay - the blocking factor is the fact that we're OOMing the phone, rather than the browser tab. If we OOM the browser tab here instead, then that's okay enough to remove the blocking factor on the bug.",SOLUTION_REVIEW,1,FULL_TEXT
947523,58,"I think clamping would be preferable to predictably killing the browser tab.  While parts of the screen may not be visible, at least they can zoom back out to a more reasonable level without losing state.  The user doesn't get any feedback or options to proceed if the tab dies.
Would it be possible to make the existing scale threshold dynamic based on the iframe size?
  http://mxr.mozilla.org/mozilla-central/source/gfx/layers/ipc/AsyncPanZoomController.cpp#189
So for very large iframes, perhaps zoom is capped at 2.0 or even 1.0?",SOLUTION_REVIEW,1,FULL_TOKEN
947523,59,"I was discussing this a bit with bjacob and we came to the conclusion it would be better to kill the tab because it's a much simpler codepath and we lose a lot of information by the time we get to the code that allocates the texture.
The zoom is always done on the root frame of the page, and it doesn't always know how large the iframes are. So we'd have to plumb all of that in to go with this approach, and even a 2.0 zoom might trigger an OOM if the iframe is large enough. So it still wouldn't completely guard against this case.
I have a set of patches now which crash the tab if the texture size would be too large. I will upload them shortly; there is a rollup at http://people.mozilla.org/~kgupta/tmp/rollup.patch to test with.",STATUS_UPDATE,0,FULL_TEXT
947523,60,"Created attachment 8356789
1/4 - Add a GetCumulativeResolution function",UNCODED,0,UNMATCHED
947523,61,"I'll test this new patch.
Just to play devil's advocate, maybe we should consider disabling sub-apzc.  I am seeing a lot of jumpiness and general instability on this page in v1.2 compared to v1.1:
  v1.1 on helix:  https://www.dropbox.com/s/hwhgfz4t8nne00m/20140107_apzc_etherpad_v1_1.mp4
  v1.2 on buri:   https://www.dropbox.com/s/g2y35jd5llpnh7o/20140107_apzc_etherpad_v1_2.mp4
It just seems there are other regressions in usability here beyond the OOM.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
947523,62,"Created attachment 8356790
2/4 - Change the displayport storage units
We still need this patch in order to not blow up in the ""transient"" state, where the parent has increased its resolution but the child has not yet requested a new displayport. If we paint in this state then we will apply the old (small) displayport with the new (high) resolution which could OOM. So this patch prevents that.",CODE_IMPLEMENTATION,1,FULL_TEXT
947523,63,"Created attachment 8356791
3/4 - Shrink the displayport multiplier at high zooms
We could probably do without this patch but it should help reduce the occurrence of the tab crashes. This contracts the subframe displayport multipliers if those subframes are getting rendered at a resolution > 1.",CODE_IMPLEMENTATION,1,FULL_TEXT
947523,64,"Created attachment 8356793
4/4 - Crash the tab if the texture size is going to exceed the max GL texture size
If the texture size exceeds 4k then we can't render it anyway so that seems like a sensible limit to hard-code to, and crash if we exceed. We actually deal ok with a page with many small iframes; it's only when the iframe gets big on one or both axes that the total texture area blows up a lot.",CODE_IMPLEMENTATION,1,FULL_TEXT
947523,65,"Created attachment 8356796
Rollup parts 1-4
Please let me know if you still see the OOM with this. I didn't see it on my master build for Gaia; I will try to borrow a hamachi and test there as well.",CODE_IMPLEMENTATION,1,FULL_TEXT
947523,66,"Comment on attachment 8356789
1/4 - Add a GetCumulativeResolution function
IID bump on presshell please.",CODE_REVIEW,0,FULL_TEXT
947523,67,"Comment on attachment 8356790
2/4 - Change the displayport storage units
What's the plan for this longer term? Make this be stored in layer pixels? Only land this on 1.2?
We should have a comment explaining why we do this.",CODE_REVIEW,0,FULL_TOKEN
947523,68,"Comment on attachment 8356791
3/4 - Shrink the displayport multiplier at high zooms
Review of attachment 8356791:
-----------------------------------------------------------------
::: gfx/layers/ipc/AsyncPanZoomController.cpp
@@ +898,5 @@
Is this patch meant for trunk too? On trunk it's not necessarily the case that the root frame's GetParentResolution() returns 1.0, at least it won't be after bug 951936 and bug 935219 land, because then the resolution will be on the non-scrollable root layer which will be the parent of the rootmost scrollable layer.
Perhaps we can condition on IsRootForLayersId() instead (or mIsRoot, although see bug 957221)?",CODE_REVIEW,0,FULL_TOKEN
947523,69,"Comment on attachment 8356793
4/4 - Crash the tab if the texture size is going to exceed the max GL texture size
This feels fairly specific to b2g; some environments (metro when it goes with remote tabs) might not be bound by such a limit.",CODE_REVIEW,0,FULL_TEXT
947523,70,"Comment on attachment 8356790
2/4 - Change the displayport storage units
kats tell me this is for 1.2 only. So just add a comment about thus and r+.",CODE_REVIEW,0,FULL_TEXT
947523,71,"Comment on attachment 8356793
4/4 - Crash the tab if the texture size is going to exceed the max GL texture size
Review of attachment 8356793:
-----------------------------------------------------------------
::: dom/ipc/TabChild.cpp
@@ +1682,5 @@
Should we be multiplying per aMetrics.mDevPixelsPerCSSPixel as well here?",CODE_REVIEW,0,FULL_TEXT
947523,72,"Comment on attachment 8356793
4/4 - Crash the tab if the texture size is going to exceed the max GL texture size
Review of attachment 8356793:
-----------------------------------------------------------------
::: dom/ipc/TabChild.cpp
@@ +1686,5 @@
Would it be possible to log something indicating why the crash occurred?  I could see this saving us some investigation time on future bug reports.",CODE_REVIEW,0,FULL_TOKEN
947523,73,"Will do.
The patch is 1.2-only. I have a much bigger change in mind for 1.3 to try and fix this properly.
Agreed. I can wrap it in an #ifdef if you prefer but since I only plan on having the code land on b2g-1.2 I don't think it matters.
Will do.
Yeah, good catch. I'll add that in.
Yup, I'll do that.
I was able to consistently reproduce the OOM on the hamachi I borrowed from Botond using a 1.2 build without my patch. The STR basically involved zooming in the page as much as possible using the area to the left of the iframe (because putting focus in the frame brings up the keyboard and that thing is impossible to work with) and then trying to scroll the iframe. Usually it would OOM before I even tried scrolling the iframe.
With my patch the OOM crash was replaced by a tab crash, and I wasn't able to trigger an OOM with any other panning/zooming actions on the page. So unless Ben has any objections I'll address the comments and get it landed.",STATUS_UPDATE,0,FULL_TOKEN
947523,74,"Comment on attachment 8356796
Rollup parts 1-4
I also was unable to get b2g to crash with the patch.  The tab reliably got killed.
I did, however, see some content fail to draw with this patch.  See time 45s to 50s in this movie:
  https://www.dropbox.com/s/vguya4xf6rgeqwh/20140107_apzc_etherpad_v1_2_patch.mov
It appears to occur when you zoom in while simultaneously dragging up a bit causing a scroll.  I could not reproduce without the patch.
On IRC kats indicated this might be explainable given that the patch shrinks the displayport.  Is this regression fixable?
If not, is this regression serious enough to hold back the patch?  Jason, what do you think?
I will try to see if I can reproduce it on any other websites tomorrow.  Maybe its isolated to sites with very large iframes like this etherpad.",QUESTION,0,FULL_TOKEN
947523,75,I believe this regression could be caused by part 3 of this patch series (although I'm not 100% sure). If we take out that part then it might make the regression go away at the expense of killing the tab far more frequently. And if this is regression is a result of my patch then it should be limited to subframes and at high zoom levels.,ANSWER_TO_QUESTION,0,FULL_TEXT
947523,76,"I think it would be better to OOM the tab more often and not risk the painting regression seen in the video mainly because I'm concerned about the fallout risk that this has other sites. The blocking factor on the bug is to ensure that we don't OOM the phone. If we end up OOMing the tab a lot, but not the phone, then that's still okay.",SOLUTION_REVIEW,1,FULL_TEXT
947523,77,"I was able to reproduce the painting problem - my hypothesis in comment 74 was wrong. It's caused by part 2; as we zoom in the outer page the displayport (in CSS pixels) of the inner frame will shrink (by design). It remains the same size in layer pixels, but the composition bounds of the inner frame will expand in layer pixels. This results in the displayport shrinking to be smaller than the composition bounds until the APZC for the inner frame triggers a repaint for it.
From the user's point of view the net effect is that if you zoom in on a page with an iframe, the iframe might end up clipped like in Ben's video, but it will repaint properly as soon as you touch it or scroll it.",STATUS_UPDATE,0,FULL_TOKEN
947523,78,"Would it be possible detect the condition and force a repaint after the zoom completes?  As a user I think having some artifacts during zoom would be ok if they corrected once I stopped touching the screen.  This is similar to how tiled map applications work, so users are probably used to the behavior.",QUESTION,0,FULL_TOKEN
947523,79,"I seem to be able to get the painting defect fairly easily on this iframe example site (see #3):
  http://nunzioweb.com/iframes-example.htm
Sometimes when the painting defect occurs I can no longer interact with the screen.  If I go to the homescreen and then back into the browser, though, touch input starts working again.
I can also cause the tab to get killed reliably by zooming in.  The iframe in question is not particularly large.",STATUS_UPDATE,0,FULL_TOKEN
947523,80,"I tried to do this quickly but was unsuccessful. At this point I'm not going to work on this bug any further - unfortunately there are too many pressing 1.3 issues for me to spend more time on this. We can either land the patchset as-is, which fixes the OOMs, and file follow-up bugs for the regressions. Or we can leave it out.",ANSWER_TO_QUESTION,0,FULL_TEXT
947523,81,"I think given the options it would be better to prevent the b2g OOM.  So I would vote for landing the patchset in v1.2.  Jason, does this sound ok to you?
I believe bug 957668 is the follow-up to address the memory issues in v1.3.",QUESTION,0,FULL_TOKEN
947523,82,"Created attachment 8357242
1/4 - Add a GetCumulativeResolution function v2
Updated versions of patches with comments addressed and reviewer info included; ready to land.",CODE_IMPLEMENTATION,1,FULL_TEXT
947523,83,"Created attachment 8357244
2/4 - Change the displayport storage units v2",UNCODED,0,UNMATCHED
947523,84,"Created attachment 8357246
3/4 - Shrink the displayport multiplier at high zooms v2",UNCODED,0,UNMATCHED
947523,85,"Created attachment 8357247
4/4 - Crash the tab if the texture size is going to exceed the max GL texture size v2",UNCODED,0,UNMATCHED
947523,86,"Yup, that sounds fine. Let's land this.",CODE_REVIEW,0,FULL_TEXT
947523,87,"RyanVM, could you please land this on 1.2? Parts 1-4. Thanks!",QUESTION,0,FULL_TEXT
947523,88,"https://hg.mozilla.org/releases/mozilla-b2g26_v1_2/rev/8e7017c626fd
https://hg.mozilla.org/releases/mozilla-b2g26_v1_2/rev/24b1e5cdad90
https://hg.mozilla.org/releases/mozilla-b2g26_v1_2/rev/bb652f96ab95
https://hg.mozilla.org/releases/mozilla-b2g26_v1_2/rev/ec909be2a849
Kats told me that 1.3+ will be addressed by bug 957668, so resolving.",ISSUE_IMPACT,0,FULL_TEXT
957093,1,bring some consistency to the namespaces here by converting legacy classes. this is just a subset of netwerk/* but its a good start.,PROBLEM_DESCRIPTION,0,FULL_TEXT
957093,2,https://tbpl.mozilla.org/?tree=Try&rev=1b53cc2d9792,UNCODED,0,UNMATCHED
957093,3,"Created attachment 8356535
namespace consistency for netwerk/protocol/http",UNCODED,0,UNMATCHED
957093,4,"Comment on attachment 8356535
namespace consistency for netwerk/protocol/http
Review of attachment 8356535:
-----------------------------------------------------------------
Looks good. Couple of really minor nits about indentation. I won't mind if you want to ignore them ;) r=me.
::: netwerk/protocol/http/nsHttpConnection.h
@@ +262,5 @@
nit: indentation.
::: netwerk/protocol/http/nsHttpHandler.h
@@ +455,5 @@
nit: indentation to match mCriticalRequestPrioritization?",CODE_REVIEW,0,FULL_TEXT
957093,5,"nits addressed
https://hg.mozilla.org/integration/mozilla-inbound/rev/495387c38734",CODE_IMPLEMENTATION,1,FULL_TEXT
957093,6,https://hg.mozilla.org/mozilla-central/rev/495387c38734,UNCODED,0,UNMATCHED
966240,1,"meta[http-equiv=""MSThemeCompatible""] is non-standard and produces bugs.",PROBLEM_MOTIVATION,0,FULL_TEXT
966240,2,*** Bug 486551 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
966240,3,*** Bug 484172 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
966240,4,"It seems that neither Chrome, Safari or Edge support this feature.",PROBLEM_REVIEW,0,FULL_TEXT
966240,5,https://treeherder.mozilla.org/#/jobs?repo=try&revision=f92d296c60f7aa2acbff9479f6a0b3d603a24c60,UNCODED,0,UNMATCHED
966240,6,"Created attachment 8878271
Remove support for <meta http-equiv=""msthemecompatible"" content=""no"">",UNCODED,0,UNMATCHED
966240,7,"Comment on attachment 8878271
Remove support for <meta http-equiv=""msthemecompatible"" content=""no"">
Review of attachment 8878271:
-----------------------------------------------------------------
::: dom/base/nsContentSink.cpp
@@ -345,5 @@
Do we still need nsIPresShell::DisableThemeSupport? Apparently this is the only caller [1] and nsIPresShell is not scriptable.
We could also remove nsGkAtoms::msthemecompatible.
[1] https://dxr.mozilla.org/mozilla-central/search?q=DisableThemeSupport",CODE_REVIEW,0,FULL_TOKEN
966240,8,"Comment on attachment 8878271
Remove support for <meta http-equiv=""msthemecompatible"" content=""no"">
Please also remove nsIPresShell::mIsThemeSupportDisabled.
r=dbaron with that",CODE_REVIEW,0,FULL_TEXT
966240,9,"Good point, I removed the PresShell bits too.",CODE_IMPLEMENTATION,1,FULL_TEXT
966240,10,"Pushed by mpalmgren@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/47143d875634
Remove support for <meta http-equiv=""msthemecompatible"" content=""no"">.  r=dbaron",UNCODED,0,UNMATCHED
966240,11,https://hg.mozilla.org/mozilla-central/rev/47143d875634,UNCODED,0,UNMATCHED
966240,12,"Comment on attachment 8878271
Remove support for <meta http-equiv=""msthemecompatible"" content=""no"">
Approval Request Comment
[Feature/Bug causing the regression]: The culprit is the ""msthemecompatible"" feature as such, but it was mostly harmless until bug 605985 landed which made checkbox/radio controls invisible when ""msthemecompatible"" is requested
[User impact if declined]: invisible checkbox/radio controls (I suspect that ""msthemecompatible"" is very rare on the web though)
[Is this code covered by automated tests?]:no
[Has the fix been verified in Nightly?]:not yet
[Needs manual test from QE? If yes, steps to reproduce]: sure, there's a testcase in bug 1373417
[List of other uplifts needed for the feature/fix]:none
[Is the change risky?]:no
[Why is the change risky/not risky?]:it removes a feature that none of the other major browsers support, and the patch is fairly trivial
[String changes made/needed]:none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
966240,13,Posted the site compatibility note: https://www.fxsitecompat.com/en-CA/docs/2017/checkboxes-and-radio-buttons-are-not-displayed-when-msthemecompatible-is-disabled/,UNCODED,0,UNMATCHED
966240,14,"Comment on attachment 8878271
Remove support for <meta http-equiv=""msthemecompatible"" content=""no"">
sounds sensible enough, beta55+
Should be in 55.0b3",UPLIFT_APPROVAL,0,FULL_TOKEN
966240,15,https://hg.mozilla.org/releases/mozilla-beta/rev/4db974b6413e,UNCODED,0,UNMATCHED
966240,16,Already verified in bug 1373417.,SOLUTION_VERIFICATION,0,FULL_TEXT
966240,17,"As mentioned in Bug 1373417, the patch requires an uplift request for the release channel so the bug will be fixed with 54.0.1.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
966240,18,Not my decision to make.,CLARIFICATION,0,FULL_TEXT
966240,19,Then who is making the decision? I thought developers (you in this case) make an uplift request and release drivers make a decision. No?,QUESTION,0,FULL_TEXT
966240,20,Believe so.,ANSWER_TO_QUESTION,0,FULL_TEXT
966240,21,"I generally don't request uplift to the _release channel_ unless it's for
a major web-compat or crash or security issue.  This bug doesn't fit that
criteria IMO.",ANSWER_TO_QUESTION,0,FULL_TOKEN
966240,22,"I've added a note to the Fx55 rel notes to cover this:
https://developer.mozilla.org/en-US/Firefox/Releases/55#HTML_2
I didn't make any changes to the ref docs, as we never mentioned this value in the first place.",STATUS_UPDATE,0,FULL_TOKEN
978610,1,"Created attachment 8384313
window-close
I mostly just copies what we do in non-e10s code. See the DOMWindowClose event.",CODE_IMPLEMENTATION,1,FULL_TEXT
978610,2,How does b2g deal with this stuff?,QUESTION,0,FULL_TEXT
978610,3,"Comment on attachment 8384313
window-close
We need to coordinate this kind of changes with b2g. And have some tests.",CODE_REVIEW,0,FULL_TEXT
978610,4,"Comment on attachment 8384313
window-close
And DOMTabClose is, well, tab specific. We will use remote stuff for other
remote browsers too.
So perhaps DOMRemoteBrowserClose.
Also, isn't that this.tabs.length thing doing the wrong thing here.
It prevent us to close the last tab/window.
DOMWindowClose doesn't call event.preventDefault which means nsGlobalWindow
doesn't try to close itself.
I think it would be better to mimic the non-OOP behavior.
TabChild could catch DOMWindowClose and forward it synchronously to
parent and parent then deals it the same way as it does local
DOMWindowClose.",CODE_REVIEW,0,FULL_TOKEN
978610,5,"Created attachment 8385604
window-close v2
Does this look right?",CODE_IMPLEMENTATION,1,FULL_TEXT
978610,6,"Comment on attachment 8385604
window-close v2
Null check mFrameElement.
But this needs a toolkit/ review, since I'm not sure whether calling window.close() is the right thing.
I believe BrowserTryToCloseWindow() or closeWindow(some params) should be used.
Also, I don't know how b2g app closing works.",CODE_REVIEW,0,FULL_TOKEN
978610,7,"Comment on attachment 8385604
window-close v2
I don't see where non-e10s code would call those functions, so I don't think we should call them in e10s either. When there's only one tab, the non-e10s code just seems to handle everything in nsGlobalWindow, which I think is what window.close() does.",CLARIFICATION,0,FULL_TEXT
978610,8,"Created attachment 8388978
window-close v3
It turns out this patch does break b2g, so I added a branch to avoid that.",CODE_IMPLEMENTATION,1,FULL_TEXT
978610,9,"Created attachment 8389001
window-close v4
Oops, wrong patch.",CODE_IMPLEMENTATION,1,FULL_TEXT
978610,10,"Created attachment 8391381
window-close v5
Getting this patch to work on b2g has really been painful. The IsBrowserOrApp checks didn't work and I don't know why. Anyway, this patch does everything in frontend code. Sorry for the churn, Felipe.",CODE_IMPLEMENTATION,1,FULL_TEXT
978610,11,"Comment on attachment 8391381
window-close v5
Never mind. This one doesn't work either.",CODE_REVIEW,0,FULL_TEXT
978610,12,"Created attachment 8391466
window-close v6
This one is really conservative. I don't think there's any way it should affect b2g.",CODE_IMPLEMENTATION,1,FULL_TEXT
978610,13,"Comment on attachment 8391466
window-close v6
Review of attachment 8391466:
-----------------------------------------------------------------
do you think bug 924260 needs to be addressed together?",CODE_REVIEW,0,FULL_TEXT
978610,14,"https://hg.mozilla.org/integration/mozilla-inbound/rev/18e9c7c020bd
You mean fixing the assertion mentioned in bug 924260? That seems separate I think.",QUESTION,0,FULL_TEXT
978610,15,"Yeah, I'm just starting to look at sandboxing / e10s stuff, so I'm happy to pick up bug 924260 as a separate piece.",ANSWER_TO_QUESTION,0,FULL_TEXT
978610,16,https://hg.mozilla.org/mozilla-central/rev/18e9c7c020bd,UNCODED,0,UNMATCHED
978610,17,"billm, can you describe how QA can test and verify this fix? Thanks!",QUESTION,0,FULL_TEXT
978610,18,"We have tests to check this and they're running on tinderbox now, so there's no need to verify.",ANSWER_TO_QUESTION,0,FULL_TEXT
978610,19,Thanks Bill!,UNCODED,0,UNMATCHED
983489,1,"https://tbpl.mozilla.org/?tree=Try&rev=bfe897476327
Summary
PROCESS-CRASH | Shutdown | application crashed [@ mozilla::gl::GLContext::MakeCurrent(bool)]
Return code: 1
AttributeError: GzipFile instance has no attribute '__exit__'
Return code: 1",ERROR_MESSAGE,0,FULL_TOKEN
983489,2,"Full stack:
06:18:50     INFO -  Operating system: Android
06:18:50     INFO -                    0.0.0 Linux 2.6.29-00302-g586075d #31 Mon Feb 24 10:28:23 PST 2014 armv7l Android/full/generic:4.0.4.0.4.0.4/OPENMASTER/eng.cltbld.20140313.071241:eng/test-keys
06:18:50     INFO -  CPU: arm
06:18:50     INFO -       0 CPUs
06:18:50     INFO -  Crash reason:  SIGSEGV
06:18:50     INFO -  Crash address: 0x218
06:18:50     INFO -  Thread 20 (crashed)
06:18:50     INFO -   0  libxul.so!mozilla::gl::GLContext::MakeCurrent(bool) [GLContext.h:bfe897476327 : 2514 + 0x0]
06:18:50     INFO -       r4 = 0x44df4eb0    r5 = 0x44df4e74    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffba0    lr = 0x40fa4a5b    pc = 0x40f3680e
06:18:50     INFO -      Found by: given as instruction pointer in context
06:18:50     INFO -   1  libxul.so!mozilla::layers::GrallocTextureSourceOGL::DeallocateDeviceData() [GrallocTextureHost.cpp:bfe897476327 : 268 + 0x3]
06:18:50     INFO -       r4 = 0x44df4eb0    r5 = 0x44df4e74    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffba8    pc = 0x40fa4a5b
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   2  libxul.so!mozilla::layers::GrallocTextureHostOGL::DeallocateDeviceData() [GrallocTextureHost.cpp:bfe897476327 : 365 + 0x5]
06:18:50     INFO -       r4 = 0x44df4e80    r5 = 0x44df4e74    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffbb0    pc = 0x40fa45ff
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   3  libxul.so!mozilla::layers::TextureHost::Finalize() [TextureHost.cpp:bfe897476327 : 282 + 0x7]
06:18:50     INFO -       r4 = 0x44df4e80    r5 = 0x44df4e74    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffbb8    pc = 0x40f90399
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   4  libxul.so!mozilla::RefPtr<mozilla::layers::TextureHost>::operator=(mozilla::layers::TextureHost*) [AtomicRefCountedWithFinalize.h : 42 + 0x5]
06:18:50     INFO -       r4 = 0x44df4e80    r5 = 0x44df4e74    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffbc0    pc = 0x40f8d4fd
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   5  libxul.so!mozilla::layers::TextureParent::ActorDestroy(mozilla::ipc::IProtocolManager<mozilla::ipc::IProtocol>::ActorDestroyReason) [TextureHost.cpp:bfe897476327 : 833 + 0x3]
06:18:50     INFO -       r4 = 0x44df4e50    r5 = 0x00000001    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffbd0    pc = 0x40f90597
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   6  libxul.so!mozilla::docshell::POfflineCacheUpdateChild::DestroySubtree(mozilla::ipc::IProtocolManager<mozilla::ipc::IProtocol>::ActorDestroyReason) [POfflineCacheUpdateChild.cpp : 388 + 0x9]
06:18:50     INFO -       r4 = 0x44df4e50    r5 = 0x00000001    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffbe0    pc = 0x40d6709d
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   7  libxul.so!mozilla::layers::PTextureParent::Send__delete__(mozilla::layers::PTextureParent*) [PTextureParent.cpp : 69 + 0x5]
06:18:50     INFO -       r4 = 0x44df4e50    r5 = 0x00000001    r6 = 0x00000000    r7 = 0x00840001
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffbf0    pc = 0x40e03caf
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   8  libxul.so!mozilla::layers::TextureParent::RecvRemoveTexture() + 0x5
06:18:50     INFO -       r4 = 0x44df4e50    r5 = 0x00840005    r6 = 0x453ffd00    r7 = 0x44274270
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffc20    pc = 0x40f9060b
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -   9  libxul.so!mozilla::layers::PTextureParent::OnMessageReceived(IPC::Message const&) [PTextureParent.cpp : 217 + 0x7]
06:18:50     INFO -       r4 = 0x44df4e50    r5 = 0x00840005    r6 = 0x453ffd00    r7 = 0x44274270
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffc28    pc = 0x40e026d3
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  10  libxul.so!mozilla::layers::PCompositorParent::OnMessageReceived(IPC::Message const&) [PCompositorParent.cpp : 373 + 0x7]
06:18:50     INFO -       r4 = 0x44de26a0    r5 = 0x453ffcdc    r6 = 0x453ffd00    r7 = 0x44274270
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffc50    pc = 0x40d8559d
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  11  libxul.so!mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&) [MessageChannel.cpp:bfe897476327 : 1142 + 0x5]
06:18:50     INFO -       r4 = 0x44de26d0    r5 = 0x453ffcdc    r6 = 0x453ffd00    r7 = 0x44274270
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffcb8    pc = 0x40d61e7f
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  12  libxul.so!mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message const&) [MessageChannel.cpp:bfe897476327 : 1056 + 0x3]
06:18:50     INFO -       r4 = 0x00000001    r5 = 0x453ffcdc    r6 = 0x453ffd00    r7 = 0x44274270
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffcd0    pc = 0x40d63abf
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  13  libxul.so!mozilla::ipc::MessageChannel::OnMaybeDequeueOne() [MessageChannel.cpp:bfe897476327 : 1039 + 0x3]
06:18:50     INFO -       r4 = 0x00000001    r5 = 0x453ffcdc    r6 = 0x453ffd00    r7 = 0x44274270
06:18:50     INFO -       r8 = 0x44274270    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffcd8    pc = 0x40d63b57
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  14  libxul.so!RunnableMethod<WebCore::ReverbConvolver, void (WebCore::ReverbConvolver::*)(), Tuple0>::Run() [tuple.h:bfe897476327 : 383 + 0x5]
06:18:50     INFO -       r4 = 0x453ffde4    r5 = 0x402dd968    r6 = 0x453ffd58    r7 = 0x453ffdf0
06:18:50     INFO -       r8 = 0x453ffd50    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffd20    pc = 0x40d61bf7
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  15  libxul.so!mozilla::ipc::MessageChannel::DequeueTask::Run() [MessageChannel.h : 383 + 0x9]
06:18:50     INFO -       r4 = 0x453ffde4    r5 = 0x402dd968    r6 = 0x453ffd58    r7 = 0x453ffdf0
06:18:50     INFO -       r8 = 0x453ffd50    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffd28    pc = 0x40d61b19
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  16  libxul.so!MessageLoop::RunTask(Task*) [message_loop.cc:bfe897476327 : 344 + 0x5]
06:18:50     INFO -       r4 = 0x453ffde4    r5 = 0x402dd968    r6 = 0x453ffd58    r7 = 0x453ffdf0
06:18:50     INFO -       r8 = 0x453ffd50    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffd30    pc = 0x40d58f19
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  17  libxul.so!MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&) [message_loop.cc:bfe897476327 : 352 + 0x5]
06:18:50     INFO -       r4 = 0x00000001    r5 = 0x453ffd48    r6 = 0x453ffd58    r7 = 0x453ffdf0
06:18:50     INFO -       r8 = 0x453ffd50    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffd40    pc = 0x40d59c7b
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  18  libxul.so!MessageLoop::DoWork() [message_loop.cc:bfe897476327 : 430 + 0x7]
06:18:50     INFO -       r4 = 0x453ffde4    r5 = 0x453ffd48    r6 = 0x453ffd58    r7 = 0x453ffdf0
06:18:50     INFO -       r8 = 0x453ffd50    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffd48    pc = 0x40d5a839
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  19  libxul.so!base::MessagePumpDefault::Run(base::MessagePump::Delegate*) [message_pump_default.cc:bfe897476327 : 34 + 0x7]
06:18:50     INFO -       r4 = 0x44e9d600    r5 = 0x453ffde4    r6 = 0x453ffd94    r7 = 0x453ffd90
06:18:50     INFO -       r8 = 0x44e9d60c    r9 = 0x453ffd80   r10 = 0x00000000    fp = 0x453ffd88
06:18:50     INFO -       sp = 0x453ffd78    pc = 0x40d5abc7
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  20  libxul.so!MessageLoop::RunInternal() [message_loop.cc:bfe897476327 : 226 + 0x5]
06:18:50     INFO -       r4 = 0x453ffde4    r5 = 0x453ffde4    r6 = 0x453ffe76    r7 = 0x00000000
06:18:50     INFO -       r8 = 0x00000000    r9 = 0x44e97714   r10 = 0x00100000    fp = 0x00000001
06:18:50     INFO -       sp = 0x453ffdc0    pc = 0x40d58edd
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  21  libxul.so!MessageLoop::Run() [message_loop.cc:bfe897476327 : 219 + 0x5]
06:18:50     INFO -       r4 = 0x453ffde4    r5 = 0x453ffde4    r6 = 0x453ffe76    r7 = 0x00000000
06:18:50     INFO -       r8 = 0x00000000    r9 = 0x44e97714   r10 = 0x00100000    fp = 0x00000001
06:18:50     INFO -       sp = 0x453ffdc8    pc = 0x40d58f5b
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  22  libxul.so!base::Thread::ThreadMain() [thread.cc:bfe897476327 : 162 + 0x5]
06:18:50     INFO -       r4 = 0x44e97700    r5 = 0x453ffde4    r6 = 0x453ffe76    r7 = 0x00000000
06:18:50     INFO -       r8 = 0x00000000    r9 = 0x44e97714   r10 = 0x00100000    fp = 0x00000001
06:18:50     INFO -       sp = 0x453ffde0    pc = 0x40d5b96b
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  23  libxul.so!ThreadFunc [platform_thread_posix.cc:bfe897476327 : 39 + 0x5]
06:18:50     INFO -       r4 = 0x453fff00    r5 = 0x40d51759    r6 = 0x44e97700    r7 = 0x00000078
06:18:50     INFO -       r8 = 0x40d51759    r9 = 0x44e97700   r10 = 0x00100000    fp = 0x00000001
06:18:50     INFO -       sp = 0x453ffee8    pc = 0x40d51761
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  24  libc.so!__thread_entry [pthread.c : 217 + 0x6]
06:18:50     INFO -       r4 = 0x453fff00    r5 = 0x40d51759    r6 = 0x44e97700    r7 = 0x00000078
06:18:50     INFO -       r8 = 0x40d51759    r9 = 0x44e97700   r10 = 0x00100000    fp = 0x00000001
06:18:50     INFO -       sp = 0x453ffef0    pc = 0x40054e4c
06:18:50     INFO -      Found by: call frame info
06:18:50     INFO -  25  libc.so!pthread_create [pthread.c : 357 + 0xe]
06:18:50     INFO -       r4 = 0x453fff00    r5 = 0x00025d90    r6 = 0xbece30f8    r7 = 0x00000078
06:18:50     INFO -       r8 = 0x40d51759    r9 = 0x44e97700   r10 = 0x00100000    fp = 0x00000001
06:18:50     INFO -       sp = 0x453fff00    pc = 0x4005499c
06:18:50     INFO -      Found by: call frame info",STACK_TRACE,0,FULL_TOKEN
983489,3,"Created attachment 8392216
Patch to reproduce
Note this is not specific to reftests, it happens whenever nsIAppStartup.quit() is called in an emulator. To reproduce, apply this patch and run |mach mochitest-remote|",CODE_IMPLEMENTATION,1,FULL_TEXT
983489,4,"It seems that we call GrallocTextureSourceOGL::DeallocateDeviceData() after CompositorOGL::CleanupResources().
The gl context is null and we dereference this null ptr for MakeCurrent().",PROBLEM_REVIEW,0,FULL_TOKEN
983489,5,"Milan, this is preventing us from making TBPL go orange on shutdown crashes since we'd be permanently orange.
Is this something your team could look into.",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
983489,6,"Benoit, can you take a look at this?  Jerry, let us know if you've looked at this already, I didn't see any comments.",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
983489,7,"We will check the bug 985773.
Maybe we have some problem for delete sequence in gfxPlatform::Shutdown()",PROBLEM_REVIEW,0,FULL_TOKEN
983489,8,Vincent Chen([:vichen]) is looking this problem now.,STATUS_UPDATE,0,FULL_TEXT
983489,9,"GLContext is released before Texture is released.
Wait result: https://tbpl.mozilla.org/?tree=Try&rev=b527e30e4264",PROBLEM_REVIEW,0,FULL_TOKEN
983489,10,"Created attachment 8397713
983489.patch
The crash happen when GLContext released before Texture is released. This patch re-order the release sequence.",CODE_IMPLEMENTATION,1,FULL_TEXT
983489,11,"Crash in buffer release is fixed, but another crash happen.
https://tbpl.mozilla.org/?tree=Try&rev=5e7a58e17e3a
23:26:09  WARNING -  PROCESS-CRASH | Shutdown | application crashed [Unknown top frame]
23:26:09     INFO -  Crash dump filename: /tmp/tmp5lZPug/2bae3694-f663-1620-7d030544-067ad376.dmp
23:26:09     INFO -  stderr from minidump_stackwalk:
23:26:09     INFO -  2014-03-27 23:26:09: minidump_processor.cc:264: INFO: Processing minidump in file /tmp/tmp5lZPug/2bae3694-f663-1620-7d030544-067ad376.dmp
23:26:09     INFO -  2014-03-27 23:26:09: minidump.cc:3815: INFO: Minidump opened minidump /tmp/tmp5lZPug/2bae3694-f663-1620-7d030544-067ad376.dmp
23:26:09     INFO -  2014-03-27 23:26:09: minidump.cc:3847: ERROR: Minidump header signature mismatch: (0x0, 0x0) != 0x504d444d
23:26:09     INFO -  2014-03-27 23:26:09: minidump_processor.cc:268: ERROR: Minidump /tmp/tmp5lZPug/2bae3694-f663-1620-7d030544-067ad376.dmp could not be read
23:26:09     INFO -  2014-03-27 23:26:09: minidump.cc:3787: INFO: Minidump closing minidump
23:26:09     INFO -  2014-03-27 23:26:09: minidump_stackwalk.cc:529: ERROR: MinidumpProcessor::Process failed
23:26:09     INFO -  minidump_stackwalk exited with return code 1
23:26:09     INFO -  WARNING | leakcheck | refcount logging is off, so leaks can't be detected!
23:26:09     INFO -  REFTEST INFO | runreftest.py | Running tests: end.
23:26:14    ERROR - Return code: 1",SOLUTION_VERIFICATION,0,FULL_TOKEN
983489,12,"Result in local test:
Looks like Bug 987251
Crash reason:  SIGSEGV
Crash address: 0x5a5a5b4a
Thread 21 (crashed)
 0  libxul.so + 0x65a25c
     r4 = 0x4617bcc0    r5 = 0x00000000    r6 = 0x00000000    r7 = 0x455ffdf0
     r8 = 0x455ffd50    r9 = 0x455ffd80   r10 = 0x00000000    fp = 0x455ffd88
     sp = 0x455ffc88    lr = 0x410a225b    pc = 0x410a225c
    Found by: given as instruction pointer in context
 1  libxul.so + 0x65ab23
     sp = 0x455ffc98    pc = 0x410a2b25
    Found by: stack scanning
 2  libxul.so + 0x65ab7f
     sp = 0x455ffca8    pc = 0x410a2b81
    Found by: stack scanning
 3  libxul.so + 0x60e3f9
     sp = 0x455ffcb0    pc = 0x410563fb
    Found by: stack scanning
 4  libxul.so + 0x6693c9
     sp = 0x455ffcb8    pc = 0x410b13cb
    Found by: stack scanning
 5  libxul.so + 0x6693ef
     sp = 0x455ffcc0    pc = 0x410b13f1
    Found by: stack scanning
 6  libxul.so + 0x6645bd
     sp = 0x455ffcc8    pc = 0x410ac5bf
    Found by: stack scanning
 7  libxul.so + 0x6651b1
     sp = 0x455ffcd8    pc = 0x410ad1b3
    Found by: stack scanning
 8  libxul.so + 0x44cb59
     sp = 0x455ffce8    pc = 0x40e94b5b
    Found by: stack scanning
 9  libxul.so + 0x44cec7
     sp = 0x455ffcf8    pc = 0x40e94ec9
    Found by: stack scanning
10  libxul.so + 0x42a309
     sp = 0x455ffd00    pc = 0x40e7230b
    Found by: stack scanning
11  libxul.so + 0x42abd1
     sp = 0x455ffd08    pc = 0x40e72bd3
    Found by: stack scanning
12  libxul.so + 0x42ab6f
     sp = 0x455ffd18    pc = 0x40e72b71
    Found by: stack scanning
13  libxul.so + 0x2cae9d
     sp = 0x455ffd28    pc = 0x40d12e9f
    Found by: stack scanning
14  libxul.so + 0x42163f
     sp = 0x455ffd30    pc = 0x40e69641
    Found by: stack scanning
15  libxul.so + 0x4223a1
     sp = 0x455ffd40    pc = 0x40e6a3a3
    Found by: stack scanning
16  libxul.so + 0x422f5f
     sp = 0x455ffd48    pc = 0x40e6af61
    Found by: stack scanning
17  libxul.so + 0x4232ed
     sp = 0x455ffd78    pc = 0x40e6b2ef
    Found by: stack scanning
18  libxul.so + 0x421603
     sp = 0x455ffdc0    pc = 0x40e69605
    Found by: stack scanning
19  libxul.so + 0x421681
     sp = 0x455ffdc8    pc = 0x40e69683
    Found by: stack scanning
20  libxul.so + 0x424091
     sp = 0x455ffde0    pc = 0x40e6c093
    Found by: stack scanning
21  libxul.so + 0x1947ffe
     sp = 0x455ffde8    pc = 0x42390000
    Found by: stack scanning",SOLUTION_VERIFICATION,0,FULL_TOKEN
983489,13,"FYI, if you're trying to reproduce locally, do a ""./build.sh buildsymbols"" first so you get function names in your stack traces.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
983489,14,This blocks a blocker.,ISSUE_IMPACT,0,FULL_TEXT
983489,15,"This bug is fixed, but it crashed at another point randomly (same as Bug 987251).
https://tbpl.mozilla.org/?tree=Try&rev=03e110fde6b3",SOLUTION_VERIFICATION,0,FULL_TOKEN
983489,16,1.4+ this blocks a blocker,ISSUE_IMPACT,0,FULL_TEXT
983489,17,"There are a number of bugs that came in with requests to support better debugging on the emulator. This came in unexpected, and I need to escalate this if it is to be done in 1.4 timeframe, as it will completely mess up the 2.0 plans.  Stay tuned.",PROBLEM_REVIEW,0,FULL_TOKEN
983489,18,"Comment on attachment 8397713
983489.patch
Review of attachment 8397713:
-----------------------------------------------------------------
If call SendWillStop() then Destroy() it will make GLContext being deleted before Texture and it crashed at end of reftest.
Please help to check if switch order is a proper solution.
It still crash somewhere else and I'm still to identify root cause.",CODE_REVIEW,0,FULL_TOKEN
983489,19,"Created attachment 8401640
983489.patch
The previous patch is obviously wrong. This patch prevent the crash by delay destruct mGLContext.",CODE_IMPLEMENTATION,1,FULL_TEXT
983489,20,"Created attachment 8403118
983489.patch
Root cause:
http://dxr.mozilla.org/mozilla-central/source/widget/xpwidgets/nsBaseWidget.cpp#177
mCompositorChild->SendWillStop(); will trigger CompositorParent RecvWillStop()
mCompositorChild->Destroy(); will trigger TextureParent to clean texture
In RecvWillStop() there are two point which will trigger CompositorOGL to destroy mGLContext and make TextureParent has no valid GLContext.
Solution:
Delay the time to destroy mGLContext, as mGLContext will be destroyed at destructor of CompositorOGL, so remove mCompositor = null in LayerManagerComposite.cpp and CompositorParent.cpp.",CODE_IMPLEMENTATION,1,FULL_TOKEN
983489,21,"Created attachment 8403724
983489.patch",UNCODED,0,UNMATCHED
983489,22,"Comment on attachment 8403724
983489.patch
Review of attachment 8403724:
-----------------------------------------------------------------
Please refer: https://bugzilla.mozilla.org/show_bug.cgi?id=922680#c97 and https://bugzilla.mozilla.org/show_bug.cgi?id=983489#c19
GLContext release too early, and we have many chance to release it. So, mark two line which will release GLContext.",CODE_REVIEW,0,FULL_TOKEN
983489,23,"Comment on attachment 8403724
983489.patch
Review of attachment 8403724:
-----------------------------------------------------------------
We can't just do that... CompositorOGL::Destroy does a bunch of work that does need to be done.",CODE_REVIEW,0,FULL_TEXT
983489,24,"We still have chance to call CompositorOGL::Destroy, the patch just delay the CompositorOGL::Destroy from CompositorParent::RecvWillStop to CompositorParent::RecvStop.",CLARIFICATION,0,FULL_TEXT
983489,25,"Mass tracking-e10s flag change. Filter bugmail on ""2be0fcce-e36a-4e2c-aa80-0e3d33eb5406"".",STATUS_UPDATE,0,FULL_TEXT
983489,26,"Comment on attachment 8403724
983489.patch
Review of attachment 8403724:
-----------------------------------------------------------------
Bas suggest for you to review.",CODE_REVIEW_REQUEST,0,FULL_TEXT
983489,27,"Comment on attachment 8403724
983489.patch
Review of attachment 8403724:
-----------------------------------------------------------------
It's not a problem with your patch but I am a bit worried about CompositorOGL making virtual method calls in its destructor. We should mark it MOZ_FINAL with a comment saying that if we want to add a subclass of CompositorOGL (which we might do at some point to have platform specific opengl optimization), then we should remove the error-prone virtual calls in the destructor. I'll file a followup bug.
Also, we should be able to call GLContext::MakeCurrent without crashing even after the destruction of the underlying context (it should return false in that case). Some code already expects that to be the case.",CODE_REVIEW,0,FULL_TOKEN
983489,28,"Comment on attachment 8403724
983489.patch
Review of attachment 8403724:
-----------------------------------------------------------------
Actually I changed my mind on one detail: please call Compositor::Destroy explicitly in RecvStop. Otherwise because of reference counting hazards, we might not call Shutdown by the end of RecvStop and that will make things chaotic at least on Linux.",CODE_REVIEW,0,FULL_TEXT
983489,29,"Re-triage - this doesn't have proof of being a user facing crash on devices, it only happens in debug build situations & tests. So renoming to reevaluate.",PROBLEM_REVIEW,0,FULL_TEXT
983489,30,"Created attachment 8408087
983489.patch v2
Update patch 
1. Remove potential of calling mCompositor->Destroy() in CompositorParent->RecvWillStop()
2. Call mCompositor->Destroy() in CompositorParent->RecvStop()/CompositorParent->Destroy() explicitly",CODE_IMPLEMENTATION,1,FULL_TOKEN
983489,31,"Comment on attachment 8408087
983489.patch v2
Review of attachment 8408087:
-----------------------------------------------------------------
Thanks!",CODE_REVIEW,0,FULL_TEXT
983489,32,https://hg.mozilla.org/integration/mozilla-inbound/rev/b032a90ee083,UNCODED,0,UNMATCHED
983489,33,had to backout this change for test failures like https://tbpl.mozilla.org/php/getParsedLog.php?id=38002451&tree=Mozilla-Inbound,IMPLEMENTATION_REVERSION,0,FULL_TEXT
983489,34,Looks like you need to check that mCompositor != nullptr before calling Destroy().,CODE_REVIEW,0,FULL_TEXT
983489,35,"Created attachment 8415031
983489.patch v3",UNCODED,0,UNMATCHED
983489,36,"Comment on attachment 8415031
983489.patch v3
Review of attachment 8415031:
-----------------------------------------------------------------
add check mCompositor before call Destroy()
https://tbpl.mozilla.org/?tree=Try&rev=c88c51437df2",CODE_REVIEW,0,FULL_TOKEN
983489,37,"Please include commit information with your patch, including a commit message that says what the patch is doing (not restating the problem it's solving).
https://developer.mozilla.org/en-US/docs/Mercurial_FAQ#How_can_I_generate_a_patch_for_somebody_else_to_check-in_for_me.3F
https://developer.mozilla.org/en-US/docs/Developer_Guide/Committing_Rules_and_Responsibilities#Checkin_comment",CODE_REVIEW,0,FULL_TEXT
983489,38,"Created attachment 8417157
983489.patch v4
update commit message based on v3.",CODE_IMPLEMENTATION,1,FULL_TEXT
983489,39,https://hg.mozilla.org/integration/mozilla-inbound/rev/290f4be587a1,UNCODED,0,UNMATCHED
983489,40,https://hg.mozilla.org/mozilla-central/rev/290f4be587a1,UNCODED,0,UNMATCHED
983489,41,backedout since this might have caused the m8 and m10 test failures like https://tbpl.mozilla.org/php/getParsedLog.php?id=39049220&tree=Mozilla-Inbound,IMPLEMENTATION_REVERSION,0,FULL_TEXT
983489,42,"Merge of the backout:
https://hg.mozilla.org/mozilla-central/rev/e7735124a892
So far, it appears that this backout did indeed fix the crashes we were seeing.",CODE_REVIEW,0,FULL_TEXT
983489,43,"From the log: https://tbpl.mozilla.org/php/getParsedLog.php?id=39049220&tree=Mozilla-Inbound
it's this pushlog: https://tbpl.mozilla.org/?rev=ba31cd1620bd&tree=Mozilla-Inbound and it's not my patch.
Would you please double check if it's problem of my patch?",CODE_REVIEW,0,FULL_TOKEN
983489,44,"Hey Vicent,
""it's this pushlog: https://tbpl.mozilla.org/?rev=ba31cd1620bd&tree=Mozilla-Inbound and it's not my patch."" yes its not your push. We sheriffs link to test failures and in some cases this might not the first occurence where the problem was seen. 
In your specific case there was in the same cset (since this was a checkin needed bug) a bustage in builds from a different developer. Thats why we linked to a different cset here.
However we investigated this for some time yesterday and were double checking a lot of csets that could have caused this test failure and after we did the backout of your patch the failures were gone away (see comment #41 from ryan). So we have the high assumption this test failure was caused by your patch.
Btw the reason why this was not seen on your try run is that the try run was done on ics opt and the failure was only on ics debug",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
983489,45,"Bug 963113 Intermittent debug B2G mochitest ""ABORT: corrupted actor state: file PTelephony.cpp, line 35"" on shutdown
Not fixed",STATUS_UPDATE,0,FULL_TOKEN
983489,46,"Ken,
High repro reate in m7.
https://tbpl.mozilla.org/?tree=Try&rev=5399221c4a8c",SOLUTION_VERIFICATION,0,FULL_TOKEN
983489,47,"1. Cannot repro on local
2. Cannot repro on try after update code: https://tbpl.mozilla.org/?tree=Try&rev=3af70562fd0b",SOLUTION_VERIFICATION,0,FULL_TOKEN
983489,48,"2. The only exception in m9 is also happen without the patch.
https://tbpl.mozilla.org/?tree=Try&rev=f2a09c74f6c8",CLARIFICATION,0,FULL_TOKEN
983489,49,"1. As I cannot repro on local, do you have any suggestion for me to repro this issue?
2. I can repro it on try, but cannot yesterday. Would you please try it on m-i?",SOLUTION_VERIFICATION,0,FULL_TOKEN
983489,50,"Nical,
Need your help to give me some advice. Although the patch fix the crash after reftest test, but it seems to introduce another crash after mochitest. I have no idea why the patch will make telephony crash. Last week, I can repro the telephony crash on try but cannot on local test. This week, I cannot repro the telephony crash both on try and local. Please help.",VERIFICATION_REQUEST,0,FULL_TOKEN
983489,51,in general just setting checkin-needed again should be enough and I or a different Sheriff will take this bug and do the checkin - but i guess in this specific case we might want to wait for the answer from nical to comment #49 right?,ANSWER_TO_QUESTION,0,FULL_TEXT
983489,52,"It's really unclear what in your patch could cause a regression in telephony. Looking at the last try push, the first thing i'd look at would probably be this:
[Parent 671] ###!!! ASSERTION: Using observer service after XPCOM shutdown!: 'Error', file ../../../gecko/xpcom/ds/nsObserverService.cpp, line 260
Maybe see who is using this observer service and if there could be a link with delaying the destruction of the compositor...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
983489,53,https://hg.mozilla.org/integration/mozilla-inbound/rev/3939dc732041,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
983489,54,https://hg.mozilla.org/mozilla-central/rev/3939dc732041,UNCODED,0,UNMATCHED
983489,55,This bug is resolved.,UNCODED,0,UNMATCHED
985257,2,"spec: http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-path-withdata
Also implemented in Blink and WebKit",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
985257,3,"Created attachment 8393276
Bug 985257 - add implementation for Path2D constructor that takes an SVG path string",UNCODED,0,UNMATCHED
985257,4,"Created attachment 8393287
Bug 985257 - add implementation for Path2D constructor that takes an SVG path string",UNCODED,0,UNMATCHED
985257,5,"Comment on attachment 8393287
Bug 985257 - add implementation for Path2D constructor that takes an SVG path string
no tests yet.
Waiting for pointInPath patch to land first",STATUS_UPDATE,0,FULL_TOKEN
985257,6,The code you've put in nsSVGUtils would be better located in SVGContentUtils. Could you move it there please?,CODE_UPDATE_REQUEST,0,FULL_TEXT
985257,7,"SVGContentUtils.h is not reachable from CanvasRenderingContext2D.cpp
It seems like it's only meant to be used inside the SVG tree.",CLARIFICATION,0,FULL_TOKEN
985257,8,You should change the moz.build file(s) to make it reachable if you need to.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
985257,9,"Created attachment 8393794
Bug 985257 - add implementation + test for Path2D constructor that takes an SVG path string",UNCODED,0,UNMATCHED
985257,10,try build: https://tbpl.mozilla.org/?tree=Try&rev=a2ccc8c9e639,VERIFICATION_REQUEST,0,FULL_TEXT
985257,11,Can you review?,CODE_REVIEW_REQUEST,0,FULL_TEXT
985257,12,https://hg.mozilla.org/integration/mozilla-inbound/rev/e9c807b1e3d4,UNCODED,0,UNMATCHED
985257,13,"Backed out for bustage (which you probably would have seen had you not pushed to Try on top of other bustage).
https://hg.mozilla.org/integration/mozilla-inbound/rev/d0cf18ff619d
https://tbpl.mozilla.org/php/getParsedLog.php?id=36500526&tree=Mozilla-Inbound",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
985257,14,"Created attachment 8395087
add implementation + test for Path2D constructor that takes an SVG path string",UNCODED,0,UNMATCHED
985257,15,new try build: https://tbpl.mozilla.org/?tree=Try&rev=eb4f961a13ef,SOLUTION_VERIFICATION,0,FULL_TEXT
985257,16,https://hg.mozilla.org/integration/mozilla-inbound/rev/8ee23d53dc27,UNCODED,0,UNMATCHED
985257,17,https://hg.mozilla.org/mozilla-central/rev/8ee23d53dc27,UNCODED,0,UNMATCHED
985257,18,https://developer.mozilla.org/en-US/docs/Web/API/Path2D.Path2D,UNCODED,0,UNMATCHED
989204,1,"Created attachment 8398337
Patch
Arrow functions are currently implemented using a bound function wrapper that passes the modified |this|. This is not ideal for a number of reasons:
(1) It's hard to optimize arrow function calls as they go through the VM fun.bind machinery.
(2) We have to allocate a second JSFunction when cloning arrow lambdas.
(3) It's not spec-compliant, at least in its current form: the bound function is observable via arguments.callee, see bug 889158.
I'm attaching a patch that removes the function binding and instead stores the lexical |this| Value for arrow functions in an extended slot. JSOP_THIS/ComputeThis now use this (no pun intended) Value for arrow functions.
This makes arrow function calls as fast as ""normal"" function calls, and Ion is now able to inline them. For instance, for the micro-benchmark below I get:
before: 1096 ms
after :    3 ms
var sum = (x, y) => x + y;
function f() {
    var res = 0;
    for (var i=0; i<10000000; i++)
	res = sum(i, 1);
    return res;
}
var t = new Date;
f();
print(new Date - t);",PROBLEM_MOTIVATION,0,FULL_TOKEN
989204,2,"Created attachment 8398502
Part 1 - Tests
Some tests I wrote for issues I ran into, also a test for bug 889158.",CODE_IMPLEMENTATION,1,FULL_TEXT
989204,3,"Created attachment 8398541
Part 2 - Make arrow functions fast
Requesting review from bhackett for the JIT changes, jorendorff for everything else.
Passes jit_test.py --tbpl. Pushed to Try:
https://tbpl.mozilla.org/?tree=Try&rev=acbba33d927c
Fortunately the browser uses a ton of arrow functions; let's see how this turns out.",CODE_IMPLEMENTATION,1,FULL_TOKEN
989204,4,"Created attachment 8398689
Part 2 - Make arrow functions fast
The browser was crashing on startup due to some XDR/cloning issue. Everything looks green now (so far):
https://tbpl.mozilla.org/?tree=Try&rev=7d2cfcf45e9c
Only need review for the non-JIT changes.",CODE_IMPLEMENTATION,1,FULL_TOKEN
989204,5,"Comment on attachment 8398689
Part 2 - Make arrow functions fast
Review of attachment 8398689:
-----------------------------------------------------------------
::: js/src/jsfun.cpp
@@ +519,5 @@
The caller is responsible for populating this slot, right? If so, populating it with a different value here seems like a bit of a red herring. Delete this block?
@@ -1243,5 @@
thank you
::: js/src/jsfun.h
@@ +539,5 @@
Can we name this offsetOfArrowThisSlot()? Otherwise each caller has a magic constant 0 in it.",QUESTION,0,FULL_TEXT
989204,6,"Pushed with comments addressed:
https://hg.mozilla.org/integration/mozilla-inbound/rev/8cef7a6e9f79
https://hg.mozilla.org/integration/mozilla-inbound/rev/9517fe15e2c2
(Comment 3 has a green Try run.)",CODE_IMPLEMENTATION,1,FULL_TOKEN
989204,7,"https://hg.mozilla.org/mozilla-central/rev/8cef7a6e9f79
https://hg.mozilla.org/mozilla-central/rev/9517fe15e2c2
https://hg.mozilla.org/mozilla-central/rev/7cdf043c7666",UNCODED,0,UNMATCHED
989204,8,https://hg.mozilla.org/mozilla-central/rev/44c63bf18e74,UNCODED,0,UNMATCHED
989204,9,*** Bug 921813 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
991812,1,"Created attachment 8401449
Patch
Rather than figure out all the ways in which this stuff is not at parity with the existing stuff, let's just use the thing that already works.",CODE_IMPLEMENTATION,1,FULL_TEXT
991812,2,"Comment on attachment 8401449
Patch
Review of attachment 8401449:
-----------------------------------------------------------------
::: gfx/layers/Compositor.h
@@ +141,2 @@
This class is very weird, and is not directly usable with this change.  Also, as far as I can tell, it's actually dead code.  If this compiles, I guess it's fine, but please file a follow-up to remove it completely.",CODE_REVIEW,0,FULL_TOKEN
991812,3,"Created attachment 8404209
Patch for AtomicRefCounted",UNCODED,0,UNMATCHED
991812,4,"This landed right? I see 88ee33546b3a listed in hg log, so I assume so?",QUESTION,0,FULL_TEXT
991812,5,It bounced.,ANSWER_TO_QUESTION,0,FULL_TEXT
991812,6,"Created attachment 8405007
A few more
Remove a few more.",CODE_IMPLEMENTATION,1,FULL_TEXT
991812,7,"Comment on attachment 8405007
A few more
Review of attachment 8405007:
-----------------------------------------------------------------
::: dom/devicestorage/DeviceStorageFileDescriptor.h
@@ +9,4 @@
Please either make this a class again or switch the forward declarations to be a struct as well (MSVC will barf at this).
::: dom/devicestorage/nsDeviceStorage.cpp
@@ +125,2 @@
Nice!",CODE_REVIEW,0,FULL_TEXT
991812,8,"Created attachment 8405691
B2G
And in b2g code.",CODE_IMPLEMENTATION,1,FULL_TEXT
991812,9,Are you going to make a dev-platform post about this when all is said and done?,QUESTION,0,FULL_TEXT
991812,10,"Comment on attachment 8405691
B2G
Review of attachment 8405691:
-----------------------------------------------------------------
::: dom/system/gonk/VolumeManager.h
@@ +82,2 @@
nsRefPtr please.",CODE_REVIEW,0,FULL_TEXT
991812,11,"Backed out for B2G bustage.
https://hg.mozilla.org/integration/mozilla-inbound/rev/376496720a0e
https://tbpl.mozilla.org/php/getParsedLog.php?id=37777059&tree=Mozilla-Inbound",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
991812,12,Sigh.  This built on Friday.,UNCODED,0,UNMATCHED
991812,13,"https://hg.mozilla.org/mozilla-central/rev/b54fdf8bb486
https://hg.mozilla.org/mozilla-central/rev/076cdafa93f5
https://hg.mozilla.org/mozilla-central/rev/0c55cac422f2
https://hg.mozilla.org/mozilla-central/rev/3d7bfc590ccd",AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TOKEN
991812,14,"One place this change seems to fall down is when using LazyIdleThread.
The LazyIdleThread only ever has one thread at a time, but that thread can go away and a new thread can come back at some future time.
This in turn, can cause http://dxr.mozilla.org/mozilla-central/source/xpcom/glue/nsISupportsImpl.h#57 to fire.
I ran into this in bug 998097. The easy fix seems to just be to make the ref count thread safe.
Any other uses of LazyIdleThread and non-threadsafe ref counts may also trip over this.",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TOKEN
991812,15,Yeah I think we should make that refcount threadsafe as well...  Please file a follow-up?,NEW_ISSUE_FILING,0,FULL_TOKEN
991812,16,"1 - So - should refcounts used by LazyIdleThread's be threadsafe?
2 - Or should we consider it a bug that non-threadsafe refcounts cause an assert?
I have some test code which demonstrates that non-threadsafe refcounts assert when used from LazyIdleThread. If 2 is what you want, then I'll file a followup bug and attach the test code.
If 1 is the case, then bug 998097 is already filed, and I don't need a followup bug.",CLARIFICATION,0,FULL_TOKEN
991812,17,"Wait a second, I don't think I correctly understand the issue.  Do you mind attaching a stack trace to the assertion that you're seeing please?",INFO_REQUEST,0,FULL_TEXT
991812,18,"Do we need a mechanism to say that certain non-threadsafely-reference-counted objects can be transferred from one thread to another?  (I've thought for a while that we might.  It would require changing the DEBUG-only owning thread member variable from (should be but isn't) const to Atomic, which might be expensive enough that we'd want different variant of nsAutoOwningThread for only classes that need this.)",QUESTION,0,FULL_TOKEN
991812,19,"So we chatted on IRC about this.  This is a sucky problem.  I guess our only two options here are either to use thread-safe refcounting or introduce a third special type of non-checked non-threadsafe refcounting.  I'd take the former.
Can you please file a follow-up to fix all of the remaining cases for other consumers of LazyIdleThread?  Thankfully that class seems to only be used in 5 places.  Thanks!",NEW_ISSUE_FILING,0,FULL_TOKEN
991812,20,I really fear that might be giving people too much rope...,ANSWER_TO_QUESTION,0,FULL_TEXT
991812,21,I filed bug 999864,NEW_ISSUE_FILING,0,FULL_TEXT
1003694,1,"Created attachment 8415027
stack
(function() {
    function f(i) {
        var d = 3 + Math.abs()
        i ? 0 : f()
    }
    return f
}())()
asserts js debug shell on m-c changeset e19812f56952 with --ion-parallel-compile=off --ion-eager --ion-inlining=off at Assertion failure: snapshot_.numAllocationsRead() == numAllocations(), at jit/JitFrameIterator.h
My configure flags are:
CC=""clang -Qunused-arguments"" CXX=""clang++ -Qunused-arguments"" AR=ar sh /Users/skywalker/trees/mozilla-central/js/src/configure --target=x86_64-apple-darwin12.5.0 --enable-optimize --enable-debug --enable-profiling --enable-gczeal --enable-debug-symbols --disable-tests --with-ccache --enable-threadsafe <other NSPR options>",S2R,0,FULL_TOKEN
1003694,2,This is flooding jsfunfuzz results.,PROBLEM_REVIEW,0,FULL_TEXT
1003694,3,"JSBugMon: Bisection requested, result:
=== Tinderbox Build Bisection Results by autoBisect ===
The ""good"" changeset has the timestamp ""20140429192012"" and the hash ""c0d658d3f739"".
The ""bad"" changeset has the timestamp ""20140429210107"" and the hash ""429d4d1f49e1"".
Likely regression window: https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=c0d658d3f739&tochange=429d4d1f49e1",PROBLEM_REVIEW,0,FULL_TOKEN
1003694,4,"I am not sure about the above regression range, but I am able to reproduce it after the landing of Bug 990106 patches, which is by the way adding this assertion.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1003694,5,"Created attachment 8415067
Settle on first frame by skipping all allocations.",UNCODED,0,UNMATCHED
1003694,6,https://hg.mozilla.org/integration/mozilla-inbound/rev/e0679448fd3b,UNCODED,0,UNMATCHED
1003694,7,Looks like a security bug to me. I'm getting various crashes [@ js::jit::InlineFrameIteratorMaybeGC<(js::AllowGC)1>::findNextFrame] with bad reads.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1003694,8,"Created attachment 8415837
[crash-signature] Machine-readable crash signature",UNCODED,0,UNMATCHED
1003694,9,"Created attachment 8415850
[crash-signature] Machine-readable crash signature",UNCODED,0,UNMATCHED
1003694,10,"Yes, that sounds right:
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset:   180713:8a3e7ed0c4c1
user:        Nicolas B. Pierron
date:        Tue Apr 29 10:17:52 2014 -0700
summary:     Bug 990106 part 4 - Recover Add and DCE unused additions. r=h4writer,jandem",CLARIFICATION,0,FULL_TOKEN
1003694,11,https://hg.mozilla.org/mozilla-central/rev/e0679448fd3b,UNCODED,0,UNMATCHED
1003694,12,JSBugMon: This bug has been automatically verified fixed.,SOLUTION_VERIFICATION,0,FULL_TEXT
1003694,13,JSBugMon: This bug has been automatically verified fixed on Fx32,SOLUTION_VERIFICATION,0,FULL_TEXT
1023280,1,"In the new world ToJSValue should be used, and not dictionary.ToObject.
(Currently ToJSValue just calls ToObject).
We should rename ToObject to something which hints that it shouldn't be used.
ToObjectInternal for example.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1023280,2,"Created attachment 8437883
ToObjectInternal
I may have missed some b2g stuff.
https://tbpl.mozilla.org/?tree=Try&rev=0210eba6ac04",CODE_IMPLEMENTATION,1,FULL_TOKEN
1023280,3,"Comment on attachment 8437883
ToObjectInternal
r=me
Please do the try run on b2g and update the webidl docs?",VERIFICATION_REQUEST,0,FULL_TEXT
1023280,4,checkin-needed because m-i seems to be rather closed today.,STATUS_UPDATE,0,FULL_TEXT
1023280,5,https://hg.mozilla.org/integration/mozilla-inbound/rev/1972ca2531d9,UNCODED,0,UNMATCHED
1023280,6,https://hg.mozilla.org/mozilla-central/rev/1972ca2531d9,UNCODED,0,UNMATCHED
1025075,1,"when we are connected to a SPDY or HTTP2 based proxy we create TLS CONNECT tunnels through it for https. each CONNECT tunnel is its own stream with its own priority - independent of any streams in the session inside the tunnel (those priorities are obviously invisible to the proxy)
initially I created the priority of tunnel stream using the priority of the https stream that triggered the tunnel creation. But we end up putting a lot of different streams on that tunnel perhaps simultaneously and the priority doesn't necessarily apply for long. It also leaks a little information and leads to an inconsistent feel.
So i think a static connect stream priority makes more sense. That would allow us to create a session of only evenly balanced connect streams if necessary down the road.
I've chosen normal - both highest and lowest are sometimes ridiculously wrong.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1025075,2,"Created attachment 8439972
0001-bug-1025075-http2-CONNECT-streams-should-have-consis.patch
https://tbpl.mozilla.org/?tree=Try&rev=9b550ab71ca6",AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1025075,3,remote:   https://hg.mozilla.org/integration/mozilla-inbound/rev/6dbb24c9937e,UNCODED,0,UNMATCHED
1025075,4,https://hg.mozilla.org/mozilla-central/rev/6dbb24c9937e,UNCODED,0,UNMATCHED
1029919,1,"Mozilla/5.0 (Windows NT 5.1; rv:33.0) Gecko/20100101 Firefox/33.0
I see this regression on XP in current Nightly, works in Fx30:
See testcase (reduced from a real-world-website),
hovering over <button>s draws a border in the color of the parent's inset box-shadow.
Actually, it's just a background-color, as you can see if button's opacity < 1.",S2R,0,FULL_TOKEN
1029919,2,"Created attachment 8445572
testcase",UNCODED,0,UNMATCHED
1029919,3,"Created attachment 8445575
testcase",UNCODED,0,UNMATCHED
1029919,4,Need a regression range.  Doesn't seem to be reproducible on Mac.  :(,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1029919,5,Could you attach screenshot(actual and expected) of the problem?,OB_EB_SCREENSHOT_REQUEST,0,FULL_TEXT
1029919,6,"Created attachment 8445772
screenshot after :hover over buttons
Button's background gets green (and stays green) onmouseover.
The second button is opaque, so you see a green border only.
This is on XP and of course it differs depending on OS specific button styling.
Expected: Display native buttons (no green background-color or border) after hovering over it.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1029919,7,"Created attachment 8445799
screenshot from real-world
Screenshot from real website:
Translucent Button should not get red background after hovering.",SCREENSHOT,0,FULL_TOKEN
1029919,8,"I can reproduce the problem in Aurora32.0a2 and Nightly33.0a1 WindowsXP SP3 default visual style(i.e. Luna).
However, I cannnot reproduce in Beta31.0b4.
Regression window(m-i)
Good:
https://hg.mozilla.org/integration/mozilla-inbound/rev/bb8fc1380b00
Mozilla/5.0 (Windows NT 5.1; rv:32.0) Gecko/20100101 Firefox/32.0 ID:20140519202628
Bad:
https://hg.mozilla.org/integration/mozilla-inbound/rev/46d9ffb97fe3
Mozilla/5.0 (Windows NT 5.1; rv:32.0) Gecko/20100101 Firefox/32.0 ID:20140519224628
Pushlog:
http://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=bb8fc1380b00&tochange=46d9ffb97fe3
Triggered by:
46d9ffb97fe3	Bas Schouten  Bug 899785: Switch on OMTC and async video on windows. r=BenWa
Setting layers.offmainthreadcomposition.enabled = false fixes the problem",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1029919,9,"I can reproduce on Windows8.1update1, Windows7 if OMTC on and HWA off.
Graphics
Adapter Description	ATI Radeon HD 4300/4500 Series
Adapter Drivers	aticfx64 aticfx64 aticfx32 aticfx32 atiumd64 atidxx64 atiumdag atidxx32 atiumdva atiumd6a atitmm64
Adapter RAM	512
ClearType Parameters	Gamma: 2200 Pixel Structure: R ClearType Level: 50 Enhanced Contrast: 200
Device ID	0x954f
DirectWrite Enabled	false (6.2.9200.16492)
Driver Date	4-29-2013
Driver Version	8.970.100.1100
GPU #2 Active	false
GPU Accelerated Windows	0/1 Basic (OMTC)
Vendor ID	0x1002
WebGL Renderer	Google Inc. -- ANGLE (ATI Radeon HD 4300/4500 Series Direct3D9Ex vs_3_0 ps_3_0)
windowLayerManagerRemote	true
AzureCanvasBackend	skia
AzureContentBackend	cairo
AzureFallbackCanvasBackend	cairo
AzureSkiaAccelerated	0",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1029919,10,"Bas, can you take a look please?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1029919,11,"So after a long investigation, I've found some interesting information. This appears to be a bug in cairo clipping, it appears that the clip at nsCSSRendering.cpp:1526 fails to be applied properly if there's already a clip present for the small rectangle surrounding the button (which would be disjoint with this clip) (i.e. if I remove that clip the button always gets a green background, if I leave it in it only has a green background when doing a partial invalidation of the button). I know we've had clipping bugs with Cairo in the past, Jeff, does this sort of issue ring a bell for you?",QUESTION,0,FULL_TEXT
1029919,12,"Created attachment 8446376
Patch that 'fixes' the bug
This patch fixes the bug, providing evidence of the rootcause suggested.",CODE_IMPLEMENTATION,1,FULL_TEXT
1029919,13,"Created attachment 8447783
Set the proper extent on the clip_path in cairo
So as far as my investigation has been able to show this bug is indirectly the results of the extents on a clip path being incorrectly set. At cairo-clip.c:276 we set the extents on the clip_path struct, but those extents no longer contain the real extents but rather the intersection of these clips.
This patch fixes that, however it does have the downside of extents of the top level clip no longer being the intersection of all the clips on the stack, I think that's okay and will only make a difference in some rare perf cases though.",CODE_IMPLEMENTATION,1,FULL_TEXT
1029919,14,"Comment on attachment 8447783
Set the proper extent on the clip_path in cairo
Review of attachment 8447783:
-----------------------------------------------------------------
I'm not sure this is correct. I don't see why the extents that are set need to be extents of the path and can't be the extents of the intersection.",CODE_REVIEW,0,FULL_TEXT
1029919,15,"Created attachment 8449937
Properly composite when using an unbounded operator even if the extents don't intersect
I believe this is the correct fix this time, I'd like to hear what you think :-).",CODE_IMPLEMENTATION,1,FULL_TEXT
1029919,16,https://hg.mozilla.org/integration/mozilla-inbound/rev/7e8fac17305a,UNCODED,0,UNMATCHED
1029919,17,https://hg.mozilla.org/mozilla-central/rev/7e8fac17305a,UNCODED,0,UNMATCHED
1029919,18,"Mozilla/5.0 (Windows NT 5.1; rv:33.0) Gecko/20100101 Firefox/33.0
Verified fixed in today's Nightly",SOLUTION_VERIFICATION,0,FULL_TOKEN
1033283,1,"Currently, we don't expose the pressed state on xul:button or xul:toolbarbutton of type ""menu"", as used in the web console. This bug was uncovered by the patch for bug 977273. We transform the role to a toggle button with the HASPOPUP state, but don't expose the pressed state.",PROBLEM_DESCRIPTION,0,FULL_TEXT
1033283,2,I'd like to take a crack at this.,DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1033283,3,"Athena, in testing your patch, I actually fixed this one. It is a one-line test in code, but needs some tests added. I just got back from lunch and am testing my tests and will attach a patch shortly.
Sorry for ""stealing"" this one! :)",DEVELOPER_SELECTION_DECISION,0,FULL_TOKEN
1033283,4,"Created attachment 8449368
Expose pressed state on menu buttons, too
One-line fix, and I added tests for the role and states.",CODE_IMPLEMENTATION,1,FULL_TEXT
1033283,5,"Hah, no problem! I did take a look (before my dinner ;)), and I was way off base. I'll just look around for another one.",UNCODED,0,UNMATCHED
1033283,6,"Comment on attachment 8449368
Expose pressed state on menu buttons, too
Review of attachment 8449368:
-----------------------------------------------------------------
::: accessible/generic/Accessible.cpp
@@ +1581,5 @@
nit: two spaces between 'button' and 'menus', dot in the end
::: accessible/tests/mochitest/states/test_aria.xul
@@ +3,5 @@
nit: it'd bet good to keep it more generic",CODE_UPDATE_REQUEST,0,FULL_TEXT
1033283,7,Landed with nits addressed: https://hg.mozilla.org/integration/mozilla-inbound/rev/62eec1dede89,CODE_IMPLEMENTATION,1,FULL_TEXT
1033283,8,https://hg.mozilla.org/mozilla-central/rev/62eec1dede89,UNCODED,0,UNMATCHED
1033887,2,"Created attachment 8449917
Disable the usage of try/catch in TestSTLWrappers.cpp with clang-cl",PROBLEM_DESCRIPTION,0,FULL_TEXT
1033887,3,Isn't the try/catch the whole point of this test?,QUESTION,0,FULL_TEXT
1033887,4,"Comment on attachment 8449917
Disable the usage of try/catch in TestSTLWrappers.cpp with clang-cl
Review of attachment 8449917:
-----------------------------------------------------------------
How are we getting WRAP_STL_INCLUDES set in this case?  This code:
http://mxr.mozilla.org/mozilla-central/source/configure.in#443
shouldn't let us get to the point where we're setting WRAP_STL_INCLUDES.  Or is this another case where compiling with clang-cl bypasses the configury that tries to decide if we're compiling with clang?",CODE_REVIEW,0,FULL_TOKEN
1033887,5,"We build with _HAS_EXCEPTIONS=0, so this test really has no point in the first place.  :-)
We get it from here: http://mxr.mozilla.org/mozilla-central/source/configure.in#610.
But I'm not sure what you mean really.  We wrap STL includes on Windows with MSVC, and clang-cl should be no different (and rightly so.)  The issue here is that clang-cl still doesn't know how to compile code which tries to catch exceptions, which is fine, since this code won't throw exceptions because we build with _HAS_EXCEPTIONS=0.  :-)",ANSWER_TO_QUESTION,0,FULL_TOKEN
1033887,6,"Sure.  But that WRAP_STL_INCLUDES is guarded by a CLANG_CC check (and so is the |else| arm a little farther down).  Is that check meant to be testing for a mingw32-esque clang, or is that check just useless now that clang-cl is semi-functional?",QUESTION,0,FULL_TOKEN
1033887,7,"Comment on attachment 8449917
Disable the usage of try/catch in TestSTLWrappers.cpp with clang-cl
Review of attachment 8449917:
-----------------------------------------------------------------
I assume if clang-cl ever grows the necessary support, this check will be removed.",CODE_REVIEW,0,FULL_TEXT
1033887,8,"The point of this test and the STL wrappers is that the CRT is built with exceptions enabled, even when our code isn't. So in order to prevent C++ exceptions from leaking into code which is built without, we catch and abort.
If we are using a clang CRT with no exceptions, then we need neither the STL wrappers nor this test.
If we are using a clang CRT with exceptions, then we need the wrappers, but perhaps the test makes no sense and we should just not build it in this config.
Either way, I don't think the patch here makes sense.",CODE_REVIEW,0,FULL_TOKEN
1033887,9,"That was added by me a very long time ago before clang-cl IIRC, back when I was trying to get the gcc style driver to work on Windows.  That variable is not set in clang-cl, and I should actually remove this old cruft.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1033887,10,"There is no clang CRT involved here, we use the usual MSVC CRT headers and libraries.  Specifically the same STL.  My point was that setting _HAS_EXCEPTIONS=0 is the well known (and actually undocumented) way to get the Microsoft STL to not throw exceptions (that is, by #ifdef-ing throw statements out).  So if I understand you correctly, this test is attempting to test whether that works?  If that's the case, I still think this is a silly test as Microsoft won't be able to remove support for _HAS_EXCEPTIONS without breaking everybody that depends on it.
(FWIW I'm fine with not taking this workaround and just falling back to cl.exe on this test, this is really not worth much debate! ;-)",SOLUTION_REVIEW,1,FULL_TOKEN
1033887,11,I think we should just avoid building this test entirely for clang-cl.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1033887,12,"Created attachment 8450216
Do not build TestSTLWrappers.cpp with clang-cl; r=bsmedberg",UNCODED,0,UNMATCHED
1033887,13,https://hg.mozilla.org/integration/mozilla-inbound/rev/aa4c2a2605f8,UNCODED,0,UNMATCHED
1033887,14,https://hg.mozilla.org/mozilla-central/rev/aa4c2a2605f8,UNCODED,0,UNMATCHED
1047560,1,Updated https://wiki.mozilla.org/SecurityEngineering/Public_Key_Pinning/ReleaseEngineering#Whom_to_contact_in_case_of_emergency with dropbox info. This has already been in test mode for a while.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1047560,2,"Created attachment 8466365
Enable pinning on dropbox (",UNCODED,0,UNMATCHED
1047560,3,"Comment on attachment 8466365
Enable pinning on dropbox (
Review of attachment 8466365:
-----------------------------------------------------------------
Great! r=me",CODE_REVIEW,0,FULL_TEXT
1047560,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/cabe3163d4bc,UNCODED,0,UNMATCHED
1047560,5,"Unfortunately I had to revert this for merge conflicts with the updated update that had already landed on mozilla-central (https://hg.mozilla.org/mozilla-central/rev/192cb23bb176). This can reland after a rebase (was one of several conflicts during this merge; didn't want to have to pick them all back apart again if any of them were resolved incorrectly):
https://hg.mozilla.org/integration/mozilla-inbound/rev/4bdadff88a9b",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1047560,6,s/updated update/automated update/,UNCODED,0,UNMATCHED
1047560,7,"Thanks, Ed.
https://hg.mozilla.org/integration/mozilla-inbound/rev/4e9cd601aa23",CODE_IMPLEMENTATION,1,FULL_TOKEN
1047560,8,https://hg.mozilla.org/mozilla-central/rev/4e9cd601aa23,UNCODED,0,UNMATCHED
1048721,1,Implement functions and types to support WebGLSync object.,PROBLEM_DESCRIPTION,0,FULL_TEXT
1048721,2,https://www.khronos.org/registry/webgl/specs/latest/2.0/#3.7.12,AUTO_LINK_ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1048721,3,"Created attachment 8579685
Implement WebGL2Sync.",UNCODED,0,UNMATCHED
1048721,4,https://treeherder.mozilla.org/#/jobs?repo=try&revision=f9c8807623a9,UNCODED,0,UNMATCHED
1048721,5,"Comment on attachment 8579685
Implement WebGL2Sync.
Review of attachment 8579685:
-----------------------------------------------------------------
::: dom/canvas/WebGLSync.h
@@ +20,5 @@
I'd rather make this RAII, instead of passing some externally-created GLsync in. (Also, `explicit` is only for single-arg ctors, IIRC)",CODE_REVIEW,0,FULL_TEXT
1048721,6,"We can do that. I think I changed to this why because of how we pass in the glname for other objects, such as textures, render buffers, frame buffers, etc.
Good spot on explicit. This function used to be single-arg ctor.",CODE_REVIEW,0,FULL_TOKEN
1048721,7,"Created attachment 8580439
Address review comments.",UNCODED,0,UNMATCHED
1048721,8,https://hg.mozilla.org/integration/mozilla-inbound/rev/f5957afe1f8d,UNCODED,0,UNMATCHED
1048721,9,https://hg.mozilla.org/mozilla-central/rev/f5957afe1f8d,UNCODED,0,UNMATCHED
1048721,10,https://developer.mozilla.org/en-US/docs/Web/API/WebGL2RenderingContext#Sync_objects,UNCODED,0,UNMATCHED
1055843,1,Videos are supposed to pause when the playbackRate is set to 0. However they just play muted.,PROBLEM_DESCRIPTION,0,FULL_TEXT
1055843,2,"Created attachment 8475549
Fix to existing mochitest to make it fail properly",UNCODED,0,UNMATCHED
1055843,3,"Created attachment 8475554
Simple test case",UNCODED,0,UNMATCHED
1055843,4,"Comment on attachment 8475549
Fix to existing mochitest to make it fail properly
Review of attachment 8475549:
-----------------------------------------------------------------
::: content/media/test/test_playback_rate.html
@@ +56,5 @@
What is the purpose to call play() again?",QUESTION,0,FULL_TEXT
1055843,5,"It is muted because the playback rate is beyond the valid range.
http://hg.mozilla.org/mozilla-central/file/149d3ce6e020/content/html/content/src/HTMLMediaElement.cpp#l3841",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1055843,6,It looks like HTMLMediaElement::CheckAutoplayDataReady() doesn't respect playback rate and starts playing despite the playback rate is 0.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1055843,7,"Created attachment 8476580
Do not pause when playbackRate = 0. Instead don't play anything
Bug 1055843: Do not pause when playbackRate = 0. Instead don't play anything",CODE_IMPLEMENTATION,1,FULL_TEXT
1055843,8,"It is my understand that when playback rate is 0, it should play. E.g. it is not in pause state but in play state.
It just happens to play nothing as the rate is 0.
As such, the control bar appears to be playing, showing the pause button.
This is how chrome handles it as well",PROBLEM_REVIEW,0,FULL_TOKEN
1055843,9,"This is how it is specified, yes [0]. I'm sure it was working before, though.
[0]: http://www.whatwg.org/specs/web-apps/current-work/multipage/embedded-content.html#effective-playback-rate",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1055843,10,"Comment on attachment 8476580
Do not pause when playbackRate = 0. Instead don't play anything
Review of attachment 8476580:
-----------------------------------------------------------------
Paul knows more about playback rate than I.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1055843,11,"Right. And our test does respect the spec.
http://hg.mozilla.org/mozilla-central/file/c14e5feadc61/content/media/test/test_playback_rate.html#l83",TEST_CASES,0,FULL_TOKEN
1055843,12,"Comment on attachment 8476580
Do not pause when playbackRate = 0. Instead don't play anything
Review of attachment 8476580:
-----------------------------------------------------------------
::: content/media/MediaDecoder.cpp
@@ +1429,5 @@
Can we remove |mPausedForPlaybackRateNull| by keeping |mPlaybackRate| only? I think checking |mPlaybackRate == 0| should be equivalent to |mPausedForPlaybackRateNull|. Then we will have fewer state variables to maintain.
@@ -1428,5 @@
Why removing the early return here? Passing playbackRate=0 to MediaDecoderStateMachine will cause assertion.
@@ +1435,4 @@
Why move this line up? I guess it doesn't make a difference.",QUESTION,0,FULL_TEXT
1055843,13,"This is used to know if the decoder was previously paused should the rate be 0. I guess the logic could be changed and re-use mPlaybackRate instead. But not being the author of that code, I always tend to keep the change to a minimal.
having mPausedForPlaybackRateNull was also required because mInitialPlaybackRate isn't modified when MediaDecoder::SetPlaybackRate is called with a value of 0.
so it falls back to setting mInitialPlaybackRate to the proper value.
mInitialPlaybackRate is set to 1.0 in the constructor.
As such, the following call to MediaDecoder::SetStateMachineParameters() will now call SetPlaybackRate with a value of 1.0. Meaning the following call to play, will start playback with a playrate of 1.0.
The whole concept that playback rate has been set is now lost.
You're right, it would cause an assertion (didn't notice it as the state machine isn't defined yet in that particular example).
I do believe that a playbackrate shouldn't be handled any differently than a non-zero playback rate.
it does, as Play() checks the value of mPausedForPlaybackRateNull. If you didn't set to false before the call to play, then playback wouldn't restart",ANSWER_TO_QUESTION,0,FULL_TOKEN
1055843,14,"Created attachment 8477240
Do not pause when playbackRate = 0. Instead don't play anything
Bug 1055843: Do not pause when playbackRate = 0. Instead don't play anything",UNCODED,0,UNMATCHED
1055843,15,"I've changed the logic so HTMLMediaElement has ownership should the decoder play or not. Seems more logical to me, instead of having MediaDecoder::Play() do nothing",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1055843,16,"This doesn't seem to conform to the spec. Does it pass test_playback_rate.html? The playbackRate of the media element should not affect the play/pause state. This is also the reason MediaDecoder have its own play state which could be different from the one of the media element. Therefore, it is possible for an media element to be in play state with its media decoder in pause state.",SOLUTION_REVIEW,1,FULL_TEXT
1055843,17,"It's exactly what is happening..
The media element will be in play state (and have emitted the ""play"" event). But the media decoder will still be in pause state (it enters pause state when we set the playback rate to 0).
And yes it passes the test.
241 INFO TEST-OK | /tests/content/media/test/test_playback_rate.html | took 72206ms
242 INFO TEST-START | Shutdown
243 INFO Passed:  89
244 INFO Failed:  0
245 INFO Todo:    0
246 INFO Slowest: 72206ms - /tests/content/media/test/test_playback_rate.html
247 INFO SimpleTest FINISHED
248 INFO TEST-INFO | Ran 1 Loops
249 INFO SimpleTest FINISHED",ANSWER_TO_QUESTION,0,FULL_TOKEN
1055843,18,"To clarify if it wasn't clear enough.
by:
""so HTMLMediaElement has ownership should the decoder play or not""
I mean, HTMLMediaElement will not call MediaDecoder::Play() , but it does everything else as if it was playing",CLARIFICATION,0,FULL_TOKEN
1055843,19,"Ok, I see. But the previous patch seems simpler where MediaDecoder::Play() just returns when |mPausedForPlaybackRateNull| is true.",CODE_REVIEW,0,FULL_TEXT
1055843,20,The patch is indeed simpler.. The logic is conceptually different however (but in effect identical). I'm happy either way,UNCODED,0,UNMATCHED
1055843,21,"Created attachment 8477337
Do not pause when playbackRate = 0. Instead don't play anything
Include comments from jwwang. Simplify code. Also remove all ambiguities in testing a double as 0",CODE_IMPLEMENTATION,1,FULL_TEXT
1055843,22,"Created attachment 8477354
Do not pause when playbackRate = 0. Instead don't play anything
Revert earlier changes. The initial playrate value would be lost should the user pause then play, breaking the specs",CODE_IMPLEMENTATION,1,FULL_TEXT
1055843,23,https://tbpl.mozilla.org/?tree=Try&rev=396f5b6de97e,UNCODED,0,UNMATCHED
1055843,24,test_playback_rate.html timed out on both Android and B2G. Can  you check if it is so even without this patch?,SOLUTION_REVIEW_REQUEST,0,FULL_TOKEN
1055843,25,"If I had used the proper try link, it would probably have been better :)
https://tbpl.mozilla.org/?tree=Try&rev=b8a10e959a1d",UNCODED,0,UNMATCHED
1055843,26,Can you remove the patch https://hg.mozilla.org/try/rev/7ceea5a3497f and Try again? Calling play() again is suspicious to me and might defeat the test of null-playback-rate shouldn't pause.,SOLUTION_REVIEW_REQUEST,0,FULL_TEXT
1055843,27,https://tbpl.mozilla.org/?tree=Try&rev=8842469f0837(In reply to JW Wang [:jwwang] from comment #25),UNCODED,0,UNMATCHED
1055843,28,"Comment on attachment 8475549
Fix to existing mochitest to make it fail properly
Review of attachment 8475549:
-----------------------------------------------------------------
::: content/media/test/test_playback_rate.html
@@ +56,5 @@
This actually reset playbackRate to defaultPlaybackRate, per spec, so it's wrong.",CODE_REVIEW,0,FULL_TEXT
1055843,29,"Comment on attachment 8477354
Do not pause when playbackRate = 0. Instead don't play anything
Review of attachment 8477354:
-----------------------------------------------------------------
Looks good, sorry for the slow review.
::: content/html/content/src/HTMLMediaElement.cpp
@@ +3836,5 @@
This should not be necessary, because if we are pausing (internally, while showing that we are in playing state) the media, no sound will be output anyways.
::: content/media/MediaDecoder.cpp
@@ +1429,5 @@
nit: always use braces, even for single line statements.",CODE_REVIEW,0,FULL_TEXT
1055843,30,"Created attachment 8482088
Do not pause when playbackRate = 0. Instead don't play anything
Follow r+",CODE_IMPLEMENTATION,1,FULL_TEXT
1055843,31,"Created attachment 8482089
Do not pause when playbackRate = 0. Instead don't play anything
Follow r+",UNCODED,0,UNMATCHED
1055843,32,https://hg.mozilla.org/integration/mozilla-inbound/rev/bdb0a8c2902d,UNCODED,0,UNMATCHED
1055843,33,https://hg.mozilla.org/mozilla-central/rev/bdb0a8c2902d,UNCODED,0,UNMATCHED
1057903,1,"Bug 1057894 adds a RAII smart handle for imgFrame called DrawableFrameRef, which we should use when we want to lock an imgFrame for drawing. RasterImage currently performs this locking through implicit calls to GetSurface (either in RasterImage itself or in code that it calls like imgFrame::Draw).
I want us to move away from this pattern, and only call GetSurface when we actually want a surface. I wrote a patch to refactor RasterImage to allow this. In the course of writing the patch, a number of opportunities for simplification and cleanup in the code I was touching jumped out, so I want to use this bug not just to mechanically replace GetSurface calls with DrawableRef but to improve the involved code while I'm at it.",PROBLEM_MOTIVATION,0,FULL_TEXT
1057903,2,"Created attachment 8478049
Refactor RasterImage to use DrawableFrameRef and generally clean up
Here's the patch. In addition to the switch to DrawableFrameRef there are a lot of small style and code quality issues fixed here, including a consolidation of the various GetImgFrame/GetDrawableImgFrame/etc methods which were mostly useless (and all needed to be touched in this patch anyway).",CODE_IMPLEMENTATION,1,FULL_TEXT
1057903,3,"Comment on attachment 8478049
Refactor RasterImage to use DrawableFrameRef and generally clean up
Shouldn't this go
  if (!frameRef) {
    ForceDiscard();
    WantDecodedFrames();
    if (aFlags & FLAG_SYNC_DECODE) {
      return CopyFrame(aWhichFrame, aFlags);
    }
  }
We have the same logic in GetFrame, so same comment for GetFrame.
This goes from asking for a decode to not asking for a decode, is that okay?
This if is now checking if we can get a drawable ref to the frame, before it was checking if we could get an imgFrame (even if it's buffer had been thrown away). So I think the comment is wrong and you need the force discard want decoded frames dance here that you remove below.",QUESTION,0,FULL_TOKEN
1057903,4,"Thanks for the review, Timothy!
Nah, because GetFrame() calls ForceDiscard() and WantDecodedFrames() automatically.
(BTW, I noticed after writing this patch that we ended up with two methods named GetFrame(), differing only by their argument types. This is confusing and I apologize. =\ I rename the new one, which replaces methods like GetDecodedImgFrame(), to LookupFrame() in one of the next patches up for review. Unfortunately the rebase looks like it'd be pretty ugly so I'd prefer to just live with this for these few patches where it's a problem.)
I don't think asking for a decode here adds much value since animated frames aren't discardable. It has the disadvantage that if we ask for a DrawableFrameRef then we do additional locking that we don't really need here since we aren't going to draw.
(Additionally, this code gets replaced in a later one of the patches up for review right now.)
The comment's correct; GetFrame() (the new one, the one being called here) calls ForceDiscard() and WantDecodedFrames() automatically.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1057903,5,"Comment on attachment 8478049
Refactor RasterImage to use DrawableFrameRef and generally clean up
Oh, sorry I was confused. You are correct.",UNCODED,0,UNMATCHED
1057903,6,"Thanks for the review! Pushed:
https://hg.mozilla.org/integration/mozilla-inbound/rev/606aef8e8c16",UNCODED,0,UNMATCHED
1057903,7,"Created attachment 8489172
Tabs rendered incorrectly.
Regression testing points to this patch drawing the top portion of tabs lower on the tab. 
Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1057903,8,Forgot to add that I am running with a dpi of 120.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1057903,9,Set 'layout.css.devPixelsPerPx = 1' which is 96 dpi and the problem still exists.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1057903,10,Opened up Bug 1067207,NEW_ISSUE_FILING,0,FULL_TEXT
1057903,11,Problem might be a different patch.  See Bug 1067207 for more info.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1057903,12,https://hg.mozilla.org/mozilla-central/rev/606aef8e8c16,UNCODED,0,UNMATCHED
1057903,13,"There's pretty much no chance it's this patch, since this patch doesn't touch SVG drawing and the tabs are SVGs. I think the other patch you suggest in that bug is much more likely.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1057903,14,"Actually I was wrong about this; the tabs are now PNGs, not SVGs, so this patch is the culprit.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1057903,15,"Comment on attachment 8478049
Refactor RasterImage to use DrawableFrameRef and generally clean up
Review of attachment 8478049:
-----------------------------------------------------------------
::: image/src/RasterImage.cpp
@@ +2643,5 @@
So I think this is the problem: we're computing the padding based upon the rect of the final frame, but it actually needs to be computed based upon the original, unscaled frame.
I'll create a patch accordingly. It'll be posted in bug 1067207; I won't post further about it here.",STATUS_UPDATE,0,FULL_TEXT
1066726,1,"This is a cover bug for bug 1064408, bug 1036939 and bug 1048348.  They are all pretty connected together, I will dup them all to this single bug and have a single patch for all of them here.",FILED_FROM_OTHER_ISSUE,0,FULL_TOKEN
1066726,2,*** Bug 1064408 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1066726,3,*** Bug 1036939 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1066726,4,*** Bug 1048348 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1066726,5,"Created attachment 8488773
v1
Patch description:
- bug 1064408 comment 15
- bug 1048348 comment 4
In general:
- when the output stream of the entry is closed with a fatal error, set state of the file to that error
- forbid opening input stream anymore (it's an atomic way to indicate the entry is in a bad shape and useless that http channel can handle well w/o any more changes needed)
- don't throw the entry on SetPredictedSize failure since it:
  - would crash (bug 1048348)
  - it wouldn't engage the interrupted concurrent write resume
The rest should be commented in the code and covered by tests
https://tbpl.mozilla.org/?tree=Try&rev=62da06db24ad",CODE_IMPLEMENTATION,1,FULL_TOKEN
1066726,6,*** Bug 1067103 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1066726,7,"Comment on attachment 8488773
v1
Review of attachment 8488773:
-----------------------------------------------------------------
::: netwerk/test/unit/test_cache2-28-concurrent_read_resumable_entry_size_zero.js
@@ +54,5 @@
Is it always ensured that the second channel gets the cache entry before the entry is doomed by the first channel?",CODE_REVIEW,0,FULL_TEXT
1066726,8,*** Bug 1067564 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1066726,9,"Definitely is, the second channel gets the entry (OnCheck/OnAvail calls) when the first channel fills the metadata on the entry (what happens on the main thread in OnStart).  Dooming happens later in OnData of chan1, by that time chan2 already pump-reads the entry.",CODE_REVIEW,0,FULL_TOKEN
1066726,10,https://hg.mozilla.org/integration/mozilla-inbound/rev/1bb80b72541f,UNCODED,0,UNMATCHED
1066726,11,https://hg.mozilla.org/mozilla-central/rev/1bb80b72541f,UNCODED,0,UNMATCHED
1066726,12,"Comment on attachment 8488773
v1
Approval Request Comment
[Feature/regressing bug #]: cache2enable
[User impact if declined]: broken or missing web content delivery to user's screen even freshly loading from servers (no work around with clearing cache or so)
[Describe test coverage new/current, TBPL]: patch adds a bunch of tests checking all corner cases the patch is fixing ; otherwise deeply tested code (main HTTP web content load)
[Risks and why]: hard to say, this code is complex
[String/UUID change made/needed]: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1066726,13,"For QA, I think this can be tested using the 3 bugs listed in comment #0.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1066726,14,"https://hg.mozilla.org/releases/mozilla-aurora/rev/83a473a0e907
https://hg.mozilla.org/releases/mozilla-beta/rev/8a1cffa4c130
Is this something that needs tracking for B2G v2.0 (b2g32)?",QUESTION,0,FULL_TEXT
1066726,15,Probably yes.,ANSWER_TO_QUESTION,0,FULL_TEXT
1066726,16,"In that case, please nominate this patch for b2g32 approval :). Might want to nominate it for v2.0 blocking status as well if you feel it's warranted.",UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1066726,17,"Comment on attachment 8488773
v1
Comment 11",UNCODED,0,UNMATCHED
1066726,18,"Reproduced with Nightly 2014-07-20 on Windows 7 64bit with STR from bug 1036939.
Verified as fixed with Firefox 33 beta 6 (Build ID: 20140922173023), latest Aurora 34.0a2 (Build ID: 20140923004002) and latest Nightly 35.0a1 (Build ID: 20140923030204) on Windows 7 64-bit, Linux 14.04 32-bit and Mac OS X 10.9.5 with STR from bug 1036939 and bug 1064408.
Also, in Socorro there are no crashes after fixing this issue for [@ mozilla::net::nsHttpChannel::OnDoneReadingPartialCacheEntry(bool*)] signature (bug 1048348): https://crash-stats.mozilla.com/report/list?signature=mozilla%3A%3Anet%3A%3AnsHttpChannel%3A%3AOnDoneReadingPartialCacheEntry%28bool%2A%29&product=Firefox&query_type=contains&range_unit=weeks&process_type=any&hang_type=any&date=2014-09-23+14%3A00%3A00&range_value=1#tab-reports",SOLUTION_VERIFICATION,0,FULL_TOKEN
1066726,19,https://hg.mozilla.org/releases/mozilla-b2g32_v2_0/rev/152c5094843c,UNCODED,0,UNMATCHED
1066726,20,"Backed out for bustage. Please rebase.
https://hg.mozilla.org/releases/mozilla-b2g32_v2_0/rev/1bfb51a08f2e
https://treeherder.mozilla.org/ui/logviewer.html#?job_id=37434&repo=mozilla-b2g32_v2_0",IMPLEMENTATION_REVERSION,0,FULL_TEXT
1066726,21,The patch is technically dependent on bug 1000338 that has been uplifted on 2014-10-05 14:46:11.  I think you can reland now (I will first locally check the build and let you know).,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1066726,22,I tried to land both at the same time.,STATUS_UPDATE,0,FULL_TEXT
1066726,23,"Err... the bug is actually bug 1013395.  That one is not worth an uplift, but the parts needed to compile are small enough, I'll backport them.  However, there is some risk this patch won't be stable (since it is completely untested) w/o all other patches landed on 33+, this is simply a disclaimer.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1066726,24,"Created attachment 8501227
v1 [REFERENCE] (for mozilla-b2g32_v2_0/not functioning)
This builds, but tests are consistently failing around the code this patch is touching - something I was afraid of.  If we want to backport this to b2g/32 we need more patches to go along with it.  I have to search for all bugs that we have fixed for 33 and select those needed to make this patch work (best all of them).",CODE_IMPLEMENTATION,1,FULL_TOKEN
1066726,25,"Created attachment 8501348
Missing bugs for backport
This is the list of cache2 bugs landed on Beta and not on B2G/32.  Not sure we can just select few to make the patch for this bug safely back-portable...",ISSUE_IMPACT,0,FULL_TOKEN
1066726,26,Probably more a question for Bhavana.,INFO_REQUEST,0,FULL_TEXT
1066726,27,"I am surprised, because everything that lands on beta should be backported to b2g32. Ryan , any thoughts here?",INFO_REQUEST,0,FULL_TEXT
1066726,28,I'm not entirely sure how many of the ones in that list landed on 33+ vs. when 32 was on beta.,ANSWER_TO_QUESTION,0,FULL_TEXT
1066726,29,"OK, so basically the bottom 5 landed on 32 when it was still on beta. Everything from bug 1013638 (rev 8f03e0ef5809) and up landed on 33+. I can't help but think that a mass uplift isn't what we're going to want to do here given where we are in the B2G v2.0 release cycle.
So I guess that leaves either wontfixing this or figuring out what the minimum branch patch is that could be safely uplifted to the fix the bug. Honza, thoughts?",SOLUTION_REVIEW_REQUEST,0,FULL_TEXT
1066726,30,"issue is resolved, removing outdated qa-wanted tag",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1066726,31,*** Bug 1065466 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1066726,32,I think finding a minimum patch would be very complicated and risky.  I vote for all or nothing.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1066726,33,"Honza, you're the best-qualified person to weigh the risks of doing that in comparison to the severity of the bugs it'd fix. B2G v2.0 is at a point where we don't want to be taking any unnecessary risks, so what's your take on wontfixing vs. proceeding with a mass uplift?",QUESTION,0,FULL_TEXT
1066726,34,"I'm against the mass uplift.  Those patches are touching also a different code and there can easily be dependencies we are not aware of and totally break the stable b2g 2.0 branch.
There are two issue when this bug is left unfixed:
- when disk cache size is set to 0, there are some problems with showing favicons, images, sometimes pages (1036939 1064408 1067103); this is a non-standard setting that some people from some reason used to set to disable the cache
- null crash in nsHttpChannel::OnDoneReadingPartialCacheEntry
The first one can be left as a known issue because of the non-standard setting.
The second one can be worked around by one of the options:
1. we can null check and fail on null entry (can lead to a failed response and not sure of all other consequences)
2. we can disobey a single entry limit when doing a partial request (safe and easy to do)
I'll create a branch patch with the second solution (one line).",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TOKEN
1066726,35,"Thanks, sounds like the way to go :)",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TEXT
1066726,36,"Created attachment 8517537
for mozilla-b2g32_v2_0, v2
- mCacheEntry->SetPredictedDataSize not called for a partial response (avoid the crash, bug 1048348)
- concurrent cache reading completely disabled (explanation in the code comment)
- test_partial_response_entry_size_smart_shrink.js has been slightly modified to accept missing bug 237623 on this branch (comments in the test)",CODE_IMPLEMENTATION,1,FULL_TOKEN
1066726,37,"Comment on attachment 8517537
for mozilla-b2g32_v2_0, v2
https://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=bee6dd0d450c",UNCODED,0,UNMATCHED
1066726,38,"As bad as this looks, most of the noise is expected based on being an old branch trying to run tests it wasn't designed to run. That said, https://treeherder.mozilla.org/ui/logviewer.html#?job_id=2961089&repo=try looks real to me.",CODE_REVIEW,0,FULL_TEXT
1066726,39,"Idea: we could disable the disk cache when capacity is 0 (internally, disabling the cache completely is something else then setting the capacity to 0 bytes right now).  I'll provide a second patch here.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1066726,40,"Comment on attachment 8517537
for mozilla-b2g32_v2_0, v2
NOTE: Please see https://wiki.mozilla.org/Release_Management/B2G_Landing to better understand the B2G approval process and landings.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): the new HTTP cache
User impact if declined: comment 33
Testing completed: tbpl, has own automated tests added
Risk to taking this patch (and alternatives if risky): low, it disables some not highly significant perfomance features of the new cache
String or UUID changes made by this patch: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1066726,41,"Comment on attachment 8517537
for mozilla-b2g32_v2_0, v2
Does this address comment 37?",CODE_REVIEW_REQUEST,0,FULL_TEXT
1066726,42,"Created attachment 8519955
for mozilla-b2g32_v2_0, v2, improvement 1, v1
Consider cache completely disabled when the capacity is set to 0.  I play with an idea to add this patch to m-c as well, Michal, what would you think?",CODE_IMPLEMENTATION,1,FULL_TOKEN
1066726,43,Hmm.. not sure what was there to be addressed.  I don't know how run tests on the b2g32. is there a separate try repo for it?,ANSWER_TO_QUESTION,0,FULL_TOKEN
1066726,44,"You can push it to Try like any other branch. Just don't expect sane results from test suites that normally don't run on it.
As for what needs addressing:",UNCODED,0,UNMATCHED
1066726,45,"So, what is the problem?",QUESTION,0,FULL_TEXT
1066726,46,Sorted it out on IRC.,ANSWER_TO_QUESTION,0,FULL_TEXT
1066726,47,"I was confused by comment 37 - there is a real _issue_ in the run:
14635 10:33:56 INFO - 2589 INFO TEST-UNEXPECTED-FAIL | /tests/netwerk/test/mochitests/test_partially_cached_content.html | First response should exist
14636 10:33:56 INFO - 2590 INFO TEST-UNEXPECTED-FAIL | /tests/netwerk/test/mochitests/test_partially_cached_content.html | Second response should exist
going to look into it.",STATUS_UPDATE,0,FULL_TOKEN
1066726,48,"Comment on attachment 8517537
for mozilla-b2g32_v2_0, v2
Dropping based on the last comment",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1066726,49,"Comment on attachment 8517537
for mozilla-b2g32_v2_0, v2
Review of attachment 8517537:
-----------------------------------------------------------------
Agree.",UNCODED,0,UNMATCHED
1066726,50,"Trying again also with the second patch:
https://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=c29e55c08865",UNCODED,0,UNMATCHED
1066726,51,"Guys, I don't know how to properly test this.  I need some help here.",VERIFICATION_REQUEST,0,FULL_TOKEN
1066726,52,NI some build experts here you may be able help debug the failures or provide input..,VERIFICATION_REQUEST,0,FULL_TEXT
1066726,53,"Marcia, is this something you're able to help with?",VERIFICATION_REQUEST,0,FULL_TEXT
1066726,54,Not really. Guessing tedm is the best one to help here.,VERIFICATION_REQUEST,0,FULL_TEXT
1066726,55,"Unfortunately it looks like you're running into problems because the build automation has changed since that branch. I don't know if there's an easy way to make things work, maybe mshal has some idea.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1066726,56,This is the same issue I'm trying to fix in bug 1102974. Unfortunately I don't think there's an easy way to fix it - I have to find the right patches to uplift. I'm having issues figuring out what those are though without causing other problems to surface :/,ANSWER_TO_QUESTION,0,FULL_TEXT
1066726,57,"Well, I think I was able to address the build issues at least. Can you try to rebase on top of b2g32 and see if it's any better? I'm not sure if the test job failures are related or some other issue though.",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TEXT
1066726,58,"Thank you.  Here it is:
https://treeherder.mozilla.org/ui/#/jobs?repo=try&revision=65d165912d34",UNCODED,0,UNMATCHED
1066726,59,"Looks like the builds are green, at least. Is that sufficient for you? I don't think we'll be able to get all the tests green on try, since it will always be using m-c's test configuration on try, not b2g32's. Some of them may be easy to address (for example, it looks like the android tests just need an updated tooltool manifest), but from what I can gather I don't think we'll get much further without a lot of effort.",SOLUTION_VERIFICATION,0,FULL_TEXT
1066726,60,"Don't worry about Android builds/tests on b2g32. Completely unsupported anyway :)
Honza, this looks like a real failure? I see it on WinXP debug as well. Everything else looks safe to ignore.
https://treeherder.mozilla.org/ui/logviewer.html#?job_id=3374596&repo=try",SOLUTION_VERIFICATION,0,FULL_TOKEN
1066726,61,*** Bug 1058062 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1071367,1,"Start nightly, set layers.async-pan-zoom.enabled and layers.draw-borders to true from about:config, and load a scrollable page (e.g. http://planet.mozilla.org/). Scroll down and observe that there is a purple border that starts at the top of the chrome and stops 79 pixels from the bottom of the window (79 pixels being the height of the chrome for me). This purple border is the composition bounds of the scrollable content document, but it has a top-left of (0,0) instead of (0,79).
This also means that using the two-finger trackpad scroll gesture doesn't work while the mouse cursor is in the bottom 79 pixels of the content (outside the purple rect).",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1071367,2,"This is a regression from bug 1043644 part 1, which switched to using the content viewer bounds instead of the frame bounds to fix behaviour on metro. Switching back to the frame bounds fixes the problem. It also fixes the problem where, with APZC enabled, the displayport is offset from tile boundaries by the height of the chrome.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1071367,3,"Created attachment 8493489
Thing that fixes the bug",UNCODED,0,UNMATCHED
1071367,4,"Created attachment 8493806
Real patch",UNCODED,0,UNMATCHED
1071367,5,"Comment on attachment 8493806
Real patch
Yeah, that makes sense. Wouldn't expect content viewer bounds to have the right offset.",CODE_REVIEW,0,FULL_TEXT
1071367,6,https://hg.mozilla.org/mozilla-central/rev/8abfd1252969,UNCODED,0,UNMATCHED
1074012,2,"Created attachment 8496635
part 1 - Temporarily expose some gfxContext fill/stroke API to help with porting to Moz2D",UNCODED,0,UNMATCHED
1074012,3,"Created attachment 8496638
part 2 - Mark gfxPattern::GetPattern's DrawTarget parameter as const",UNCODED,0,UNMATCHED
1074012,4,"Created attachment 8496640
part 1 - Temporarily expose some gfxContext fill/stroke API to help with porting to Moz2D",UNCODED,0,UNMATCHED
1074012,5,"Created attachment 8496642
part 3 - Make nsSVGUtils::MakeFillPatternFor/MakeStrokePatternFor return using a Moz2D GeneralPattern out-param rather than a Thebes gfxPattern",PROBLEM_DESCRIPTION,0,FULL_TEXT
1074012,6,"https://hg.mozilla.org/integration/mozilla-inbound/rev/ab520ec5fed5
https://hg.mozilla.org/integration/mozilla-inbound/rev/d98720aace71
https://hg.mozilla.org/integration/mozilla-inbound/rev/6fa1aac2d413",UNCODED,0,UNMATCHED
1074012,7,"https://hg.mozilla.org/mozilla-central/rev/ab520ec5fed5
https://hg.mozilla.org/mozilla-central/rev/d98720aace71
https://hg.mozilla.org/mozilla-central/rev/6fa1aac2d413",UNCODED,0,UNMATCHED
1076026,1,"(function() {
    let x = (new function() {})
    __defineGetter__(""x"", function() {
        ({
            e: x
        })
    })
})()
print(x)
asserts js debug shell on m-c changeset 14665b1de5ee with --ion-eager --no-threads at Assertion failure: !ins->hasDefUses(), at jit/TypePolicy.cpp.
Debug configure options:
CC=""clang -Qunused-arguments"" CXX=""clang++ -Qunused-arguments"" AR=ar sh /Users/skywalker/trees/mozilla-central/js/src/configure --target=x86_64-apple-darwin12.5.0 --enable-debug --enable-optimize --enable-nspr-build --enable-more-deterministic --with-ccache --enable-gczeal --enable-debug-symbols --disable-tests
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset:   https://hg.mozilla.org/mozilla-central/rev/7027efe7fae3
user:        Shu-yu Guo
date:        Mon Sep 15 16:30:45 2014 -0700
summary:     Bug 1001090 - Part 1: Implement let temporal dead zone in the frontend and interpreter. (r=Waldo)
Shu-yu, is bug 1001090 a possible regressor?",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1076026,2,"Created attachment 8498432
stack
(lldb) bt 5
* thread #1: tid = 0x314869, 0x00000001003d6a31 js-dbg-opt-64-dm-nsprBuild-darwin-14665b1de5ee`js::jit::TypeBarrierPolicy::adjustInputs(js::jit::TempAllocator&, js::jit::MInstruction*) [inlined] js::jit::MTypeBarrier* js::jit::MDefinition::to<js::jit::MTypeBarrier>(this=<unavailable>) + 5 at MIR.h:691, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=1, address=0x0)
  * frame #0: 0x00000001003d6a31 js-dbg-opt-64-dm-nsprBuild-darwin-14665b1de5ee`js::jit::TypeBarrierPolicy::adjustInputs(js::jit::TempAllocator&, js::jit::MInstruction*) [inlined] js::jit::MTypeBarrier* js::jit::MDefinition::to<js::jit::MTypeBarrier>(this=<unavailable>) + 5 at MIR.h:691
    frame #1: 0x00000001003d6a2c js-dbg-opt-64-dm-nsprBuild-darwin-14665b1de5ee`js::jit::TypeBarrierPolicy::adjustInputs(js::jit::TempAllocator&, js::jit::MInstruction*) [inlined] js::jit::MDefinition::toTypeBarrier(this=<unavailable>) at MIR.h:708
    frame #2: 0x00000001003d6a2c js-dbg-opt-64-dm-nsprBuild-darwin-14665b1de5ee`js::jit::TypeBarrierPolicy::adjustInputs(this=<unavailable>, alloc=<unavailable>, def=<unavailable>) + 668 at TypePolicy.cpp:245
    frame #3: 0x00000001002a8a6a js-dbg-opt-64-dm-nsprBuild-darwin-14665b1de5ee`js::jit::ApplyTypeInformation(js::jit::MIRGenerator*, js::jit::MIRGraph&) [inlined] js::InlineListIterator<js::jit::MInstruction>::operator*(this=0x00000001030d57a8, def=0x0000000103133bf8) const + 86 at IonAnalysis.cpp:1080
    frame #4: 0x00000001002a8a14 js-dbg-opt-64-dm-nsprBuild-darwin-14665b1de5ee`js::jit::ApplyTypeInformation(js::jit::MIRGenerator*, js::jit::MIRGraph&) [inlined] (anonymous namespace)::TypeAnalyzer::insertConversions(this=0x00000001030d57a8) + 1683 at IonAnalysis.cpp:1140
(lldb)",STACK_TRACE,0,FULL_TOKEN
1076026,3,"Created attachment 8498462
Don't consider uninitialized lexicals when initializing a singleton object property type.
Uninitialized lexicals as required by the TDZ shouldn't escape to script and
shouldn't be picked up by type sets, which will confuse the type set into
thinking it's seen lazyargs.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1076026,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/748ffeff132c,UNCODED,0,UNMATCHED
1076026,5,https://hg.mozilla.org/mozilla-central/rev/748ffeff132c,UNCODED,0,UNMATCHED
1080574,1,"+++ This bug was initially created as a clone of Bug #1061186 +++
https://treeherder.mozilla.org/ui/logviewer.html#?job_id=2865229&repo=mozilla-inbound
builder 	Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
buildid 	20141008141406
builduid 	6ce99c438e6548ec8646041864ab0c51
results 	warnings (1)
revision 	50a379edc315
slave 		tst-linux32-spot-507
starttime 	Wed Oct 08 2014 17:49:45 GMT-0400 (Eastern Standard Time)
14:53:48 INFO - 115 INFO TEST-START | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html
14:53:48 INFO - ++DOMWINDOW == 69 (0x98ceed20) [pid = 1835] [serial = 413] [outer = 0x9b38e760]
14:53:48 INFO - *** WIFI GEO: shutdown called
14:53:49 INFO - 116 INFO TEST-PASS | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | get geolocation object
14:53:49 INFO - 117 INFO TEST-PASS | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | set done
14:53:49 INFO - 118 INFO TEST-PASS | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | turned off geolocation via mozSettings
14:53:49 INFO - 119 INFO TEST-PASS | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to false.
14:53:49 INFO - 120 INFO TEST-PASS | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | set done
14:53:49 INFO - 121 INFO TEST-PASS | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | turned on geolocation via mozSettings
14:53:49 INFO - 122 INFO TEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS
14:53:49 INFO - JavaScript error: resource://gre/components/SettingsManager.js, line 143: TypeError: this._window.MozSettingsTransactionEvent is not a constructor
14:53:49 INFO - 123 INFO TEST-OK | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | took 1632ms",PROBLEM_DESCRIPTION,0,80_PCT_MATCH
1080574,2,"submit_timestamp: 2014-10-09T06:57:13
log: https://treeherder.mozilla.org/ui/logviewer.html#?repo=mozilla-inbound&job_id=2865229
repository: mozilla-inbound
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux32-spot-507
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: 50a379edc315
122 INFO TEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,3,"submit_timestamp: 2014-10-10T07:36:36
log: https://treeherder.mozilla.org/ui/logviewer.html#?repo=fx-team&job_id=872300
repository: fx-team
who: emorley[at]mozilla[dot]com
machine: talos-mtnlion-r5-059
buildname: Rev5 MacOSX Mountain Lion 10.8 fx-team debug test mochitest-4
revision: 984a9d8ac938
112 INFO TEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,4,"submit_timestamp: 2014-10-26T18:40:01
log: https://treeherder.mozilla.org/ui/logviewer.html#?repo=mozilla-beta&job_id=114827
repository: mozilla-beta
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux64-spot-271
buildname: Ubuntu VM 12.04 x64 mozilla-beta debug test mochitest-4
revision: 080cfa7f5d79
122 INFO TEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true.",UNCODED,0,UNMATCHED
1080574,5,"submit_timestamp: 2014-11-04T11:04:20
log: https://treeherder.mozilla.org/ui/logviewer.html#?repo=try&job_id=2926210
repository: try
who: dholbert[at]mozilla[dot]com
machine: tst-linux64-spot-229
buildname: Ubuntu VM 12.04 x64 try debug test mochitest-4
revision: e255299d3cba
122 INFO TEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true.",UNCODED,0,UNMATCHED
1080574,6,"submit_timestamp: 2014-11-13T15:33:28
log: https://treeherder.mozilla.org/ui/logviewer.html#?repo=mozilla-beta&job_id=147989
repository: mozilla-beta
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux64-spot-1265
buildname: Ubuntu VM 12.04 x64 mozilla-beta debug test mochitest-4
revision: 3e5cb63660bd
122 INFO TEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true.",UNCODED,0,UNMATCHED
1080574,7,"submit_timestamp: 2014-12-15T12:49:10
log: https://treeherder.mozilla.org/ui/logviewer.html#?repo=b2g-inbound&job_id=997552
repository: b2g-inbound
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux64-spot-179
buildname: Ubuntu VM 12.04 x64 b2g-inbound debug test mochitest-4
revision: debd2ce34bf9
122 INFO TEST-UNEXPECTED-FAIL | /tests/dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,8,"submit_timestamp: 2015-01-09T13:52:59
log: https://treeherder.mozilla.org/logviewer.html#?repo=b2g-inbound&job_id=1133224
repository: b2g-inbound
who: rvandermeulen[at]mozilla[dot]com
machine: t-snow-r4-0077
buildname: Rev4 MacOSX Snow Leopard 10.6 b2g-inbound opt test mochitest-4
revision: a5d5e741f8a3
46 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,9,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=5885807
repository: mozilla-inbound
start_time: 2015-01-25T14:02:23
who: philringnalda[at]gmail[dot]com
machine: tst-linux32-spot-744
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: c1fb4bf7b043
136 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,10,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-central&job_id=1161490
repository: mozilla-central
start_time: 2015-03-13T06:57:18
who: philringnalda[at]gmail[dot]com
machine: tst-linux32-spot-1001
buildname: Ubuntu VM 12.04 mozilla-central debug test mochitest-4
revision: 9dbb2d41bb2c
144 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,11,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=7812494
repository: mozilla-inbound
start_time: 2015-03-19T13:36:49
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux32-spot-402
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: b3fcbf649765
150 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,12,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=8318248
repository: mozilla-inbound
start_time: 2015-03-31T15:52:52
who: wkocher[at]mozilla[dot]com
machine: tst-linux32-spot-545
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: 3851d1999bd5
136 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,13,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=8756880
repository: mozilla-inbound
start_time: 2015-04-12T17:56:44
who: bbirtles[at]mozilla[dot]com
machine: tst-linux32-spot-149
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: df60406c8e62
136 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,14,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-central&job_id=1327426
repository: mozilla-central
start_time: 2015-04-14T14:33:10
who: wkocher[at]mozilla[dot]com
machine: tst-linux32-spot-709
buildname: Ubuntu VM 12.04 mozilla-central debug test mochitest-4
revision: c3e4ff7d62c6
136 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,15,"log: https://treeherder.mozilla.org/logviewer.html#?repo=b2g-inbound&job_id=1753953
repository: b2g-inbound
start_time: 2015-04-18T06:11:43
who: philringnalda[at]gmail[dot]com
machine: tst-linux32-spot-263
buildname: Ubuntu VM 12.04 b2g-inbound debug test mochitest-4
revision: be44c0a5cf9e
136 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,16,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=9207460
repository: mozilla-inbound
start_time: 2015-04-22T20:29:02
who: philringnalda[at]gmail[dot]com
machine: tst-linux32-spot-543
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: e08e45fd8922
136 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,17,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=9285953
repository: mozilla-inbound
start_time: 2015-04-24T13:14:12
who: wkocher[at]mozilla[dot]com
machine: tst-linux64-spot-915
buildname: Ubuntu VM 12.04 x64 mozilla-inbound debug test mochitest-4
revision: 6d0fb655e2e6
136 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,18,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=9442689
repository: mozilla-inbound
start_time: 2015-04-30T02:40:40
who: tomcat[at]mozilla[dot]com
machine: unknown
revision: d0703ff693a1
caught OS error 2: No such file or directory while running ('xset', 's', 'off', 's', 'reset')
2992 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,19,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=10226328
repository: mozilla-inbound
start_time: 2015-05-28T08:20:58
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux64-spot-285
buildname: Ubuntu VM 12.04 x64 mozilla-inbound opt test mochitest-4
revision: db3d40e8b4de
144 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,20,"log: https://treeherder.mozilla.org/logviewer.html#?repo=fx-team&job_id=3298033
repository: fx-team
start_time: 2015-06-02T08:14:02
who: rvandermeulen[at]mozilla[dot]com
machine: unknown
revision: a02a945edeb4
caught OS error 2: No such file or directory while running ('xset', 's', 'off', 's', 'reset')
1956 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,21,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-central&job_id=1665733
repository: mozilla-central
start_time: 2015-06-16T08:02:56
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux64-spot-341
buildname: Ubuntu VM 12.04 x64 mozilla-central debug test mochitest-4
revision: 64bbc886ac8c
146 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,22,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=10923162
repository: mozilla-inbound
start_time: 2015-06-18T01:22:34
who: tomcat[at]mozilla[dot]com
machine: unknown
revision: f1f1a9a1c46a
caught OS error 2: No such file or directory while running ('xset', 's', 'off', 's', 'reset')
1962 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,23,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=11473558
repository: mozilla-inbound
start_time: 2015-07-08T03:24:54
who: tomcat[at]mozilla[dot]com
machine: tst-linux64-spot-1898
buildname: Ubuntu VM 12.04 x64 mozilla-inbound debug test mochitest-4
revision: f925296bc0a3
146 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,24,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=11588098
repository: mozilla-inbound
start_time: 2015-07-10T18:59:22
who: tomcat[at]mozilla[dot]com
machine: t-w732-ix-047
buildname: Windows 7 32-bit mozilla-inbound debug test mochitest-4
revision: 07bcf36f5ab2
146 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS
Return code: 1",UNCODED,0,UNMATCHED
1080574,25,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=11767856
repository: mozilla-inbound
start_time: 2015-07-16T06:43:09
who: rvandermeulen[at]mozilla[dot]com
machine: t-w864-ix-055
buildname: Windows 8 64-bit mozilla-inbound debug test mochitest-4
revision: e123787104f7
146 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS
Return code: 1",UNCODED,0,UNMATCHED
1080574,26,"log: https://treeherder.mozilla.org/logviewer.html#?repo=try&job_id=9485805
repository: try
start_time: 2015-07-17T10:14:53
who: michael[at]thelayzells[dot]com
machine: tst-linux64-spot-2045
buildname: Ubuntu VM 12.04 x64 try debug test mochitest-4
revision: 9ea244b6f6bd
146 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS",UNCODED,0,UNMATCHED
1080574,27,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=11894152
repository: mozilla-inbound
start_time: 2015-07-20T03:16:09
who: tomcat[at]mozilla[dot]com
machine: t-w864-ix-093
buildname: Windows 8 64-bit mozilla-inbound debug test mochitest-4
revision: 7e15449cb6e8
142 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Success callback should not have been called after setting geolocation.enabled to false.
Return code: 1",UNCODED,0,UNMATCHED
1080574,28,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=12141890
repository: mozilla-inbound
start_time: 2015-07-27T02:48:45
who: tomcat[at]mozilla[dot]com
machine: tst-linux32-spot-1058
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: dce7a6fd951f
134 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true.",UNCODED,0,UNMATCHED
1080574,29,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-aurora&job_id=1013313
repository: mozilla-aurora
start_time: 2015-08-04T22:37:59
who: tomcat[at]mozilla[dot]com
machine: t-w732-ix-116
buildname: Windows 7 32-bit mozilla-aurora debug test mochitest-4
revision: a6bb84ddeed3
146 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true. - expected PASS
Return code: 1",UNCODED,0,UNMATCHED
1080574,30,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-aurora&job_id=1066816
repository: mozilla-aurora
start_time: 2015-08-23T11:46:13
who: rvandermeulen[at]mozilla[dot]com
machine: tst-linux32-spot-615
buildname: Ubuntu VM 12.04 mozilla-aurora debug test mochitest-4
revision: 20a79fcdc75f
130 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Success callback should not have been called after setting geolocation.enabled to false.",UNCODED,0,UNMATCHED
1080574,31,"log: https://treeherder.mozilla.org/logviewer.html#?repo=fx-team&job_id=4609362
repository: fx-team
start_time: 2015-09-09T19:35:46
who: nigelbabu[at]gmail[dot]com
machine: t-w732-ix-153
buildname: Windows 7 32-bit fx-team debug test mochitest-4
revision: 619a307029d6
154 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true.
Return code: 1",UNCODED,0,UNMATCHED
1080574,32,"log: https://treeherder.mozilla.org/logviewer.html#?repo=mozilla-inbound&job_id=14735337
repository: mozilla-inbound
start_time: 2015-09-25T13:22:17
who: philringnalda[at]gmail[dot]com
machine: tst-linux32-spot-367
buildname: Ubuntu VM 12.04 mozilla-inbound debug test mochitest-4
revision: 4c0e0c5176e9
214 INFO TEST-UNEXPECTED-FAIL | dom/tests/mochitest/geolocation/test_mozsettingsWatch.html | Geolocation didn't work after setting geolocation.enabled to true.",UNCODED,0,UNMATCHED
1080574,33,Bulk assigning P3 to all open intermittent bugs without a priority set in Firefox components per bug 1298978.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1080574,34,"The change for bug #1218627 has landed, hence I this should be de-facto fixed as geo isn't using the MozSettings API anymore.
If you're ok I guess we can just close this.",SOLVED_BY_OTHER_ISSUE,0,FULL_TOKEN
1080574,35,Fine by me.,UNCODED,0,UNMATCHED
1104875,1,"Created attachment 8528485
unresponsive-script.png
Stop script button was out of view because the script is is not wrapping or not being truncated.",PROBLEM_DESCRIPTION,0,FULL_TEXT
1104875,2,"The code here:
http://hg.mozilla.org/mozilla-central/annotate/acde07cb4e4d/dom/base/nsGlobalWindow.cpp#l11171
should truncate scriptLocation in some way. Backlogging this.",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1104875,3,"Hmm.  I guess the UI can't do that because we're using a generic dialog?
The big issue is this: what width to truncate at?  I don't see a way for this code to tell....",REQUIREMENT,0,FULL_TOKEN
1104875,4,"Yes. That and we concatenate it with the l10n string so there's really very little way to tell anything what/how to truncate otherwise.
Fair! I would just lowball it at 60 characters, take the first/last 30 and add an ellipsis in the middle. That will still not be good enough for customized windows themes that have a really high font-size for message-box text, but that's not the 99% case, and this dialog isn't either, so it doesn't seem to me like we should do the (significant amount of) work here to get it right 100% of the time.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1104875,5,"Created attachment 8529234
Ellipsize long unresponsive script locations so they don't make the slow script dialog too big",UNCODED,0,UNMATCHED
1104875,6,"Comment on attachment 8529234
Ellipsize long unresponsive script locations so they don't make the slow script dialog too big
Er, no, this is bunk.  It's better to do on UTF-16, because what I have totally fails on multibyte UTF-8 sequences!",CODE_REVIEW,0,FULL_TOKEN
1104875,7,"Created attachment 8529252
Ellipsize long unresponsive script locations so they don't make the slow script dialog too big",UNCODED,0,UNMATCHED
1104875,8,"Comment on attachment 8529252
Ellipsize long unresponsive script locations so they don't make the slow script dialog too big
Review of attachment 8529252:
-----------------------------------------------------------------
::: dom/base/nsGlobalWindow.cpp
@@ +11187,5 @@
include",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1104875,9,Fixed typo and https://hg.mozilla.org/integration/mozilla-inbound/rev/7e81094bc8f9,CODE_IMPLEMENTATION,1,FULL_TEXT
1104875,10,https://hg.mozilla.org/mozilla-central/rev/7e81094bc8f9,UNCODED,0,UNMATCHED
1104875,11,*** Bug 604626 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1104875,12,*** Bug 720003 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1105771,1,"User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.65 Safari/537.36
Steps to reproduce:
1. Navigate to http://dashif.org/reference/players/javascript/1.2.0/index.html
2. Enter http://rdmedia.bbc.co.uk/dash/ondemand/bbb/avc3/1/client_manifest-common_init.mpd in manifest box and click Load.
Actual results:
Video does not display - HTMLVideoElement.canPlayType returns """". Audio plays back as expected.
Expected results:
HTMLVideoElement should return ""probably"" for, and playback correctly, ISOBMFF content using AVC3 sample description (ie where the SPS/PPS are not in the initialization segment). An example codec string would be video/mp4;codecs=""avc3.4d4015"".
AVC3 is required to allow common initialization segments across all representations.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1105771,2,Confirmed in 37.0a1 (2014-12-05) Win 7,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1105771,3,"Our decoders do not support avc3 at present. Could quite easily change FFmpeg h264 decoder to support it, but that won't get us very far...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1105771,4,"Created attachment 8536243
Retrieve SPS and PPS from AVCC stream when necessary
Extract SPS and PPS NAL from data stream and build extradata from it",CODE_IMPLEMENTATION,1,FULL_TEXT
1105771,5,"Created attachment 8536244
MSE/MP4 Delay video decoder creation until we can retrieve SPS
Delay decoder creation until we have all the information to do so.",CODE_IMPLEMENTATION,1,FULL_TEXT
1105771,6,"Created attachment 8536245
Allow playback of avc3 streams
Add avc3 playback support",CODE_IMPLEMENTATION,1,FULL_TEXT
1105771,7,"Comment on attachment 8536243
Retrieve SPS and PPS from AVCC stream when necessary
Review of attachment 8536243:
-----------------------------------------------------------------
::: media/libstagefright/binding/AnnexB.cpp
@@ +80,5 @@
This should use ByteReader because it protects against all the run-time out of range conditions.
::: media/libstagefright/binding/DecoderData.cpp
@@ +192,5 @@
Now would be a good opportunity to move this logic and the above >=7 and |= 3 into the AnnexB class.
::: media/libstagefright/binding/mp4_demuxer.cpp
@@ +191,5 @@
Updating the video config seems like a nasty side-effect to have in DemuxVideoSample(). This could perhaps be solved by moving extra_data out of VideoConfig altogether.",CODE_REVIEW,0,FULL_TEXT
1105771,8,"Comment on attachment 8536244
MSE/MP4 Delay video decoder creation until we can retrieve SPS
Review of attachment 8536244:
-----------------------------------------------------------------
The rest of this patch looks fine to me.
::: dom/media/fmp4/MP4Reader.cpp
@@ +433,5 @@
These lines seem unnecessary. We could always create the video decoder.",CODE_REVIEW,0,FULL_TEXT
1105771,9,"well, no, CreateVideoDecoder may fail.
NS_ENSURE_SUCCESS will return if rv isn't NS_OK.
rather confusing macro I admit, but it's how it was used",CODE_REVIEW,0,FULL_TOKEN
1105771,10,"Sorry - that was a typo. We should always create the video decoder lazily rather than having two execution paths, as discussed on IRC.",CODE_REVIEW,0,FULL_TEXT
1105771,11,"Comment on attachment 8536243
Retrieve SPS and PPS from AVCC stream when necessary
Will take a different approach.
It will be up to the decoder to handle the AVC format, not the demuxer",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1105771,12,"Comment on attachment 8536244
MSE/MP4 Delay video decoder creation until we can retrieve SPS
Will take a different approach.
It will be up to the decoder to handle the AVC format, not the demuxer",UNCODED,0,UNMATCHED
1105771,13,"David, I have this video playing now, but just like your other MSE sample, it has broken timestamps. The cts offset are marked as being unsigned (version 0 trun), yet are negative (bug 1105778).
Bug 1111311 addresses that problem, but still better following the specs.
Thanks",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1105771,14,"Awesome!
We are aware of this problem with these streams and we plan to reissue them with valid trun boxes very soon.
In the meantime, we have another test asset which should be valid: http://rdmedia.bbc.co.uk/dash/ondemand/testcard/1/client_manifest-events.mpd
(Note that this stream contains in-band DASH Events ('emsg' boxes) which the parser will need to ignore. If this is a problem, we will want to raise a bug for graceful support of those. In this case, an additional stream - http://rdmedia.bbc.co.uk/dash/ondemand/testcard/1/client_manifest.mpd - has the same media content without DASH events.)",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1105771,15,remote:   https://hg.mozilla.org/integration/mozilla-inbound/rev/ed08c1246e77,UNCODED,0,UNMATCHED
1105771,16,"FYI, our Big Bucky Bunny MPEG-DASH reference streams have been reissued with valid trun boxes and other minor changes. Full details can be found at http://rdmedia.bbc.co.uk/dash/ondemand/bbb/, with the stream referenced in the user story now available at http://rdmedia.bbc.co.uk/dash/ondemand/bbb/2/client_manifest-common_init.mpd.
I see that Bug 1111311 has now landed in Nightly which makes this less of an issue but, as you say, still better to follow the spec.",SOLUTION_REVIEW,1,FULL_TEXT
1105771,17,https://hg.mozilla.org/mozilla-central/rev/ed08c1246e77,UNCODED,0,UNMATCHED
1105771,18,"For the record... As it is, the video will not have the right dimensions on mac until bug 1111328 lands.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1111046,1,These preferences are only used by the profiler add-on. They don't need to be in the tree.,PROBLEM_MOTIVATION,0,FULL_TEXT
1111046,2,"Created attachment 8535877
patch",UNCODED,0,UNMATCHED
1111046,3,I didn't run this through try since it's trivial,STATUS_UPDATE,0,FULL_TEXT
1111046,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/cf853aa96c6a,UNCODED,0,UNMATCHED
1111046,5,https://hg.mozilla.org/mozilla-central/rev/cf853aa96c6a,UNCODED,0,UNMATCHED
1116867,1,"Created attachment 8543075
assertion stack
1. Make sure e10s is enabled.
2. Open the browser console.
3. Navigate to www.google.com in the main browser window.
I tried this same thing in my regular Nightly session, and nothing obviously bad happened, so maybe it is just an overly strict assertion.",S2R,0,FULL_TOKEN
1116867,2,Could you check what the actual status value is that's asserting?,INFO_REQUEST,0,FULL_TEXT
1116867,3,"so this is wfm with a debug build from this morning's m-c on linux64 - using e10s and both http:// and https:// versions of google.
is this still an issue? can you provide the info from comment 1?",INFO_REQUEST,0,FULL_TEXT
1116867,4,"Now I get this instead:
Assertion failure: progress <= progressMax (unexpected progress values), at /Users/amccreight/mc/netwerk/protocol/http/HttpChannelChild.cpp:544
#01: mozilla::net::HttpChannelChild::RecvOnTransportAndData(tag_nsresult const&, tag_nsresult const&, unsigned long long const&, unsigned long long const&, nsCString const&, unsigned long long const&, unsigned int const&)[/Users/amccreight/mc/obj-dbg.noindex/dist/NightlyDebug.app/Contents/MacOS/XUL +0x314f03]
#02: mozilla::net::PHttpChannelChild::OnMessageReceived(IPC::Message const&)[/Users/amccreight/mc/obj-dbg.noindex/dist/NightlyDebug.app/Contents/MacOS/XUL +0x64e528]
#03: mozilla::dom::PContentChild::OnMessageReceived(IPC::Message const&)[/Users/amccreight/mc/obj-dbg.noindex/dist/NightlyDebug.app/Contents/MacOS/XUL +0x577d87]
#04: mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&)[/Users/amccreight/mc/obj-dbg.noindex/dist/NightlyDebug.app/Contents/MacOS/XUL +0x46bb20]
#05: mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message const&)[/Users/amccreight/mc/obj-dbg.noindex/dist/NightlyDebug.app/Contents/MacOS/XUL +0x46a811]
#06: mozilla::ipc::MessageChannel::OnMaybeDequeueOne()[/Users/amccreight/mc/obj-dbg.noindex/dist/NightlyDebug.app/Contents/MacOS/XUL +0x46583f]",STACK_TRACE,0,FULL_TOKEN
1116867,5,"The values of those variables are progress = 14827 and progressMax = 0, at least through two tries of it.",ANSWER_TO_QUESTION,0,FULL_TEXT
1116867,6,"Same thing happens with techcrunch.com, cnn.com, and a few other random sites I tried loading.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1116867,7,"Though the values were different for ""progress"".",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1116867,8,"Patrick, what's the significance of this bug? Should we be tracking it for e10s?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1116867,9,jason is probably in a better place with the ipdl code to answer the question.. valentin has a repro in 1117442 that he's working.,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1116867,10,"I am not able to reproduce any issues (comment 0 or comment 3) with the linux 64 nightly debug build (2015-01-05).  I tested in e10s mode on the same sites mentioned.
It is likely a related fix landed as part of bug 1115976, but this landed on 2015-01-03, which confuses me, since comment 3 is from 2015-01-05.
Andrew, do you still see this even in the latest debug nightly?",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1116867,11,"I downloaded firefox-37.0a1.en-US.debug-mac64.dmg from here:
  ftp://ftp.mozilla.org/pub/firefox/nightly/2015-01-06-mozilla-central-debug/
(there's no OSX nightly for 1-7 yet for some reason)
and I can reproduce it, in a fresh profile, with e10s enabled.
My steps to reproduce:
1. Hit shift-command-J to open the Browser Console.
2. Click over to the address bar in the main window.
3. Type ""google.com"" and hit enter.",S2R,0,FULL_TOKEN
1116867,12,"#6  mozilla::net::HttpChannelChild::DoOnProgress (this=0x7fffdb8de000, aRequest=0x7fffdb8de088, progress=30275, progressMax=0) at ../../../../gecko-dev/netwerk/protocol/http/HttpChannelChild.cpp:544",UNCODED,0,UNMATCHED
1116867,13,"Okay, I am able to reproduce this now.
What happens is that the Network Monitor code (which is used when the Browser Console is open) intercepts onProgress for its own purposes, and then forwards the message along to the original onProgress listener.  Usually, this works correctly.
However, if |progressMax| is 0xFFFFFFFFFFFFFFFF (the ""unknown"" value), things get messed up since we are now going C++ -> JS -> C++, and JS can't safely represent integers that large, so it ends up getting forced to 0 when leaving JS.
I tried clamping the value down to Number.MAX_SAFE_INTEGER, and this does fix the assertion and crash.  However, I see that are some C++ cases where we check for exactly UINT64_MAX.
Is there some secret way I can force the JS -> C++ XPCOM conversion to allow JS to pass UINT64_MAX safely?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1116867,14,"thanks jryans.
So nsIProgressEventSink is a broken interface, at least for JS.
I think we should update it to use a new constant nsIProgressEventSink::MAX_PROGRESS_UNKNOWN that is set to 2^53 - 1 and change each of the ~10 C++ implementations to use that instead of UINT64_MAX
That ought to fix the problem",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1116867,15,"this isn't really an e10s problem.. we see it in e10s because of an assert in the message marshalling code for onProgress().. but the root of it is that when OnProgress, which is a scriptable interface, goes through js a sentinel value is out of range of MAX_SAFE_INTEGER.. so it can't really use the interface correctly.",PROBLEM_REVIEW,0,FULL_TEXT
1116867,16,*** Bug 1117442 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1116867,17,"I'm going to put this at the top of my queue, but it isn't going to happen before the branch to ff38 next week. However the problem is long standing. We might want to consider working around any new code on 37 that triggers the issue.
(or is it not new code? and we only notice it because people have e10s enabled on nightly?)",QUESTION,0,FULL_TEXT
1116867,18,"I've been using e10s for a number of months, and I only noticed this particular problem recently.  (I work around it by not opening the console until after the page opens, which isn't too bad because I have to not open the console after the page closes due to another unrelated bug...)",ANSWER_TO_QUESTION,0,FULL_TOKEN
1116867,19,"In bug 731318, we added code to net monitor which triggers this issue if the Browser Console or DevTools toolbox is open.  This landed in 37.
It's a crash on e10s because HttpChannelChild uses MOZ_ASSERT[1], which forces a crash.  The same problem happens without e10s, but it's only an NS_WARNING[2].
[1]: https://hg.mozilla.org/mozilla-central/annotate/b3f84cf78dc2/netwerk/protocol/http/HttpChannelChild.cpp#l544
[2]: https://hg.mozilla.org/mozilla-central/annotate/b3f84cf78dc2/netwerk/protocol/http/nsHttpChannel.cpp#l5799",PROBLEM_REVIEW,0,FULL_TOKEN
1116867,20,"cool. so 731318 exposes a latent bug.
we need to choose between backing that out of 37, or backporting the fix of the long time bug (which is going to have to include a breaking idl change) onto aurora.
what do you think?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1116867,21,"I was hoping to construct a safe way to disable for e10s only, but since the merge is on Monday, it's probably best to back out bug 731318.
I'll do this now.",SOLUTION_REVIEW,1,FULL_TOKEN
1116867,22,"thanks jryans.
Actually, this isn't really an e10s thing. only e10s throws the assert, so we notice it more there, but the single process code path is also going to corrupt maxProgress when it goes through js boundaries - it will just happen silently. The code in places like docshell that checks uint_max64 will do the wrong thing in those cases.",SOLUTION_REVIEW,1,FULL_TEXT
1116867,23,"Created attachment 8547685
make nsIProgressEventSink and nsITransportEventSink safely scriptable
These scriptable interfaces use uint_64 arguments with sentinel values
of UINT64_MAX. However, UINT64_MAX exceeds MAX_SAFE_NUMBER and cannot
be gatewayed to/from javascript - so they cannot be used
correctly. Change them to use signed 64 bit numbers and -1 as the
sentinnel. C++ implementations ought to be enough to audit as the
special value could never be used correctly in JS anyhow - also
audited OnProgressChange() uses for downstream use of this data.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1116867,24,"Comment on attachment 8547685
make nsIProgressEventSink and nsITransportEventSink safely scriptable
Review of attachment 8547685:
-----------------------------------------------------------------
honza, I'll have bz r the xhr bits after the necko side gets squared away.",CODE_REVIEW,0,FULL_TEXT
1116867,25,"Created attachment 8547689
MozReview Request: bz://1116867/mcmanus",UNCODED,0,UNMATCHED
1116867,26,"/r/2361 - bug 1116867 - make nsIProgressEventSink and nsITransportEventSink safely scriptable r=mayhemer
Pull down this commit:
hg pull review -r 24652fa8a6703951d3b8e91fcbc03b69a7c86263",UNCODED,0,UNMATCHED
1116867,27,I put this in reviewboard too.. maybe you want to experiment with using that. nick and I have been using it successfully for larger patches. Doesn't matter to me which way we go.,CODE_REVIEW_REQUEST,0,FULL_TEXT
1116867,28,"JS uses the term MAX_SAFE_INTEGER not MAX_SAFE_NUMBER, probably best to use the same terminology.",CODE_REVIEW,0,FULL_TEXT
1116867,29,"/r/2361 - bug 1116867 - make nsIProgressEventSink and nsITransportEventSink safely scriptable r=mayhemer
Pull down this commit:
hg pull review -r 8c4c1a72203118935fa4d4637229b1b1bbfbdbda",UNCODED,0,UNMATCHED
1116867,30,"Created attachment 8547721
make nsIProgressEventSink and nsITransportEventSink safely scriptable
These scriptable interfaces use uint_64 arguments with sentinel values
of UINT64_MAX. However, UINT64_MAX exceeds MAX_SAFE_NUMBER and cannot
be gatewayed to/from javascript - so they cannot be used
correctly. Change them to use signed 64 bit numbers and -1 as the
sentinnel. C++ implementations ought to be enough to audit as the
special value could never be used correctly in JS anyhow - also
audited OnProgressChange() uses for downstream use of this data.",UNCODED,0,UNMATCHED
1116867,31,"https://treeherder.mozilla.org/#/jobs?repo=try&revision=1f68fc12ece7
(you can see in the diff on the try run that I changed a printf specifier in one of the C++ tests.. that's the only change)",CODE_IMPLEMENTATION,1,FULL_TEXT
1116867,32,"https://reviewboard.mozilla.org/r/2361/#review1699
::: dom/base/nsXMLHttpRequest.cpp
(Diff revision 2)
We can well get to loaded < 0 here, but out of scope of this bug.
::: embedding/components/webbrowserpersist/nsWebBrowserPersist.cpp
(Diff revision 2)
Here are some weird casts left..
::: netwerk/protocol/http/nsHttpPipeline.h
(Diff revision 2)
indent
::: netwerk/test/TestPageLoad.cpp
(Diff revision 2)
lld ?
::: uriloader/base/nsDocLoader.cpp
(Diff revision 2)
no need to cast
::: dom/base/nsXMLHttpRequest.cpp
(Diff revision 2)
Isn't there a define?  if not, can you please create one in some ""net.h"" or so?
::: embedding/components/webbrowserpersist/nsWebBrowserPersist.cpp
(Diff revision 2)
And this still uses unsigned
::: netwerk/protocol/http/HttpChannelChild.cpp
(Diff revision 2)
If you find some way to split this assert so that we know the progressMax value, I'd love that
::: netwerk/protocol/http/HttpChannelChild.cpp
(Diff revision 2)
aCount's already uint64",CODE_REVIEW,0,FULL_TOKEN
1116867,33,"https://reviewboard.mozilla.org/r/2361/#review1705
Ship It!",CODE_REVIEW,0,FULL_TEXT
1116867,34,"Patrick, is there any difference between the board patch and the regular bz patch?",INFO_REQUEST,0,FULL_TEXT
1116867,35,nope. I'll clear the regular bz one.,ANSWER_TO_QUESTION,0,FULL_TEXT
1116867,36,"https://reviewboard.mozilla.org/r/2361/#review1733
I can't figure this comment out.. OnProgress is changed by this patch to take unsigned",CODE_REVIEW,0,FULL_TEXT
1116867,37,"https://reviewboard.mozilla.org/r/2359/#review1735
bz can you look at (at least) the xhr part?",CODE_REVIEW_REQUEST,0,FULL_TEXT
1116867,38,"Comment on attachment 8547689
MozReview Request: bz://1116867/mcmanus
honza, I wasn't sure if you meant to r+ the last version (cause it said ship it) or cancel it or what.. nick had some problem with reviewboard setting flags earlier today adding to the confusion.
So I'm leaving r? set for the new rev. Actually it lets you see the interdiff which is the one place reviewboard does way better than spliter imo",STATUS_UPDATE,0,FULL_TOKEN
1116867,39,"https://reviewboard.mozilla.org/r/2359/#review1753
So I was worried about binary extensions, but the good news is that testing an int64_t for equality against UINT64_MAX is the same as testing it for equality against -1, both in terms of machine code and C/C++ integer promotion behavior.  So there should be pretty minimal fallout, if any.
::: dom/base/nsXMLHttpRequest.cpp
(Diff revision 2)
I would prefer we had an actual constant for MAX_SAFE_JS_INTEGER or JS_MAX_SAFE_INTEGER or whatever somewhere, either in jsapi headers (probably preferred) or at least somewhere in mfbt or something.
Then we could also static_assert things like the value being < INT64_MAX.
::: netwerk/base/public/nsITransport.idl
(Diff revision 2)
The ""tbd"" comment here should go away, right?
::: netwerk/protocol/file/nsFileChannel.cpp
(Diff revision 2)
Yeah, this is why I'd prefer a named constant.
::: netwerk/protocol/ftp/nsFtpConnectionThread.cpp
(Diff revision 2)
Named constant.
::: netwerk/protocol/http/nsHttpTransaction.cpp
(Diff revision 2)
Named constant.
r=me with the nits fixed.",CODE_REVIEW,0,FULL_TOKEN
1116867,40,"/r/2361 - bug 1116867 - make nsIProgressEventSink and nsITransportEventSink safely scriptable r=mayhemer r=bz
Pull down this commit:
hg pull review -r 7238b3125f1f3c327465592f7f096903928aaf18",UNCODED,0,UNMATCHED
1116867,41,"Comment on attachment 8547689
MozReview Request: bz://1116867/mcmanus
I got lost between the patches.  But this one seems to be the r+comments I've already made before (comment 31).",CODE_REVIEW,0,FULL_TOKEN
1116867,42,https://hg.mozilla.org/integration/mozilla-inbound/rev/91e1a0afee55,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1116867,43,https://hg.mozilla.org/mozilla-central/rev/91e1a0afee55,UNCODED,0,UNMATCHED
1116867,44,"Comment on attachment 8547689
MozReview Request: bz://1116867/mcmanus",UNCODED,0,UNMATCHED
1116867,45,"Created attachment 8619001
MozReview Request: bug 1116867 - make nsIProgressEventSink and nsITransportEventSink safely scriptable r=mayhemer r=bz",UNCODED,0,UNMATCHED
1118597,1,"Bug 1110608 broke parsing of some fragmented CENC files. I'm disabling MoofParser for encrypted files in bug 1118593, but we still want to use MoofParser for encrypted files, since it fixes other issues.
So, this bug is to track fixing MoofParser for encrypted files.
STR:
1. Get gmp-clearkey from https://github.com/cpearce/gmp-clearkey
2. Load http://people.mozilla.org/~cpearce/eme/
3. Observe crash; the GMPDecryptor asserts that it expected the sample to have valid crypto data, but it doesn't.
In debugging this, it looked like the auxInfoType of the saiz box was 'sinf', and so we didn't setup crypto data. We set the default auxInfoType of the saiz box to ""sinf"", but ISO/IEC 23001-7:2012(E) says that for CENC files a auxInfoType of 'cenc' should be assumed. I still crashed when I changed the default, so that's not the only problem.",S2R,0,FULL_TOKEN
1118597,2,"Created attachment 8551531
1118597.patch",UNCODED,0,UNMATCHED
1118597,3,"Created attachment 8551532
1118597-enable-moofparser-eme.patch",UNCODED,0,UNMATCHED
1118597,4,"Comment on attachment 8551531
1118597.patch
Review of attachment 8551531:
-----------------------------------------------------------------
I'm not a fan a cascade of parseXXX that you have now.
The existing style was to have constructor taking a Box and being ""self-aware"".
::: media/libstagefright/binding/Box.cpp
@@ +27,5 @@
please document where those values come from
@@ +79,4 @@
probably should check that child offset is still within the box range and abort if not.
::: media/libstagefright/binding/Index.cpp
@@ +108,5 @@
can't we just exit and stop there. File won't play but at least it won't crash
@@ +116,4 @@
it's a carry-on from earlier, but I dislike the use of &cenc[0] ; this will assert if the array is empty.
cenc.Elements() won't
@@ +122,5 @@
test return value of ReadArray
::: media/libstagefright/binding/MoofParser.cpp
@@ +203,5 @@
can't you simply break the loop instead? no need to loop when we're not going to do anything later
@@ +209,5 @@
a bit inconsistent with the rest of the code, make them private member of MoofReader
@@ +212,5 @@
test that we have 8 bytes available in BoxReader
@@ +220,5 @@
and here
@@ +226,5 @@
test that we have 4 + 3 + 1 + 16...
@@ +229,5 @@
The construction of the Sinf should be done in a Sinf constructor that takes a Box& argument (in line with the rest of the code)
@@ +232,5 @@
and here
::: media/libstagefright/binding/include/mp4_demuxer/MoofParser.h
@@ +119,5 @@
Build the Sinf in a Sinf(Box& aBox) constructor, similar to all other atoms.
@@ +133,5 @@
if you takes two arguments, you don't need explicit.
However, I think it should take the info type as argument rather than the Sinf; so we untangle what is starting to become messy. Keep it abstracted so a Saiz and Saio box don't need to be aware of the internal implementation of the Sinf
@@ +143,5 @@
same as above, take the encryption type as argument",CODE_REVIEW,0,90_PCT_MATCH
1118597,5,"I meant:
    if (box.IsType(""sinf"")) {
       ParseSinf(box);
       if (mSinf.IsValid()) {
         break;
       }
though ParseSinf should return a boolean that it has succeeded.",CODE_REVIEW,0,FULL_TOKEN
1118597,6,"Created attachment 8551613
1118597.patch v2
Addressed review comments and IRC comments.",CODE_IMPLEMENTATION,1,FULL_TEXT
1118597,7,"Created attachment 8551614
1118597.patch v2.1
Actually address review comments and IRC comments.",CODE_IMPLEMENTATION,1,FULL_TEXT
1118597,8,"Comment on attachment 8551614
1118597.patch v2.1
Review of attachment 8551614:
-----------------------------------------------------------------
r=me with nits addressed
::: media/libstagefright/binding/Index.cpp
@@ +136,5 @@
existing problem, but as this patch is a fix, should test the cenc contains the right amount of bytes and is well formed (otherwise this will assert).
::: media/libstagefright/binding/MoofParser.cpp
@@ +173,5 @@
mSinf.IsValid() isn't required as as soon it is valid we exit the loop
@@ +272,5 @@
mSaizs.AppendElement(Saiz(box, aSinf.GetEncryptionType())
::: media/libstagefright/binding/SinfParser.cpp
@@ +25,5 @@
not required if you simply override IsValid()
@@ +37,5 @@
warning unused variables...
@@ +62,5 @@
warning unused variables...
::: media/libstagefright/binding/include/mp4_demuxer/Box.h
@@ +58,4 @@
Should probably have a method to check that Box is valid, as right now any errors reading the box and setting its member won't be propagated.
This can be done in a another patch/bug #
::: media/libstagefright/binding/include/mp4_demuxer/MoofParser.h
@@ +136,5 @@
Saiz(Box& aBox, const AtomType& aEncryptionType)
Due to the implementation of AtomType, probably can not bother with const ref
@@ +146,5 @@
Saio(Box& aBox, const AtomType& aEncryptionType)
::: media/libstagefright/binding/include/mp4_demuxer/SinfParser.h
@@ +21,5 @@
Use existing IsValid() API, no need to set mValid.
mValid is only of use if you don't have a IsValid() and you then use the default implementation
@@ +24,5 @@
something like ..
AtomType GetEncryptionType()
{
  return IsValid() ? mDefaultEncryptionType : AtomType()
}",CODE_REVIEW,0,FULL_TOKEN
1118597,9," 0:03.87 Warning: -Wreorder in /Users/jyavenard/Work/Mozilla/mozilla-central/media/libstagefright/binding/include/mp4_demuxer/SinfParser.h: field 'mDefaultEncryptionType' will be initialized after field 'mDefaultIVSize'
 0:03.87 /Users/jyavenard/Work/Mozilla/mozilla-central/media/libstagefright/binding/include/mp4_demuxer/SinfParser.h:20:7: warning: field 'mDefaultEncryptionType' will be initialized after field 'mDefaultIVSize' [-Wreorder]
 0:03.87     : mDefaultEncryptionType()
 0:03.87       ^
 0:03.87 1 warning generated.
Something weird on my box:
1:05.58 ../../../dist/include/mp4_demuxer/MoofParser.h:8:10: fatal error: 'mp4_demuxer/Atom.h' file not found
 1:05.58 #include ""mp4_demuxer/Atom.h""
jyapro:mozilla-central jyavenard$ ls -l media/libstagefright/binding/include/mp4_demuxer/Atom*
-rw-r--r--+ 1 jyavenard  staff  425 20 Jan 17:39 media/libstagefright/binding/include/mp4_demuxer/Atom.h
-rw-r--r--+ 1 jyavenard  staff  833 20 Jan 17:39 media/libstagefright/binding/include/mp4_demuxer/AtomType.h
it's there!",CODE_REVIEW,0,FULL_TOKEN
1118597,10,"Oh..
It's missing the required entry in moz.build...",CODE_REVIEW,0,FULL_TOKEN
1118597,11,"Comment on attachment 8551614
1118597.patch v2.1
Review of attachment 8551614:
-----------------------------------------------------------------
Actually, on second look
Where are 
MoofParser::ParseMinf
MoofParser::ParseStbl
MoofParset::ParseStsd
MoofParser::ParseSinf
?",CODE_REVIEW,0,FULL_TOKEN
1118597,12,"Created attachment 8552063
1118597.patch v3
Re-added missing stuff, whipped hg into line, addressed comments.",CODE_IMPLEMENTATION,1,FULL_TEXT
1118597,13,"This shouldn't really matter. We only set mSinf if we have a valid Sinf, otherwise mDefaultEncryptionType is 0; further we don't bother with getters elsewhere in MoofParser.",CLARIFICATION,0,FULL_TEXT
1118597,14,"Comment on attachment 8552063
1118597.patch v3
Review of attachment 8552063:
-----------------------------------------------------------------
r+ with some nits.
::: media/libstagefright/binding/Index.cpp
@@ +131,5 @@
CanRead16 ?
::: media/libstagefright/binding/SinfParser.cpp
@@ +14,5 @@
as we can use mSinf.mDefaultEncryptionType without mSinf being valid, it needs to be initialized to 0 regardless.
::: media/libstagefright/binding/include/mp4_demuxer/SinfParser.h
@@ +17,5 @@
mDefaultIVSize must be initialized before mDefaultEncryptionType (cause a compilation warning otherwise)",CODE_REVIEW,0,FULL_TEXT
1118597,15,"https://hg.mozilla.org/mozilla-central/rev/0f3a324e645d
https://hg.mozilla.org/mozilla-central/rev/06648aa9a5c4",UNCODED,0,UNMATCHED
1118597,16,"Comment on attachment 8552063
1118597.patch v3
Requesting 37 uplift of just this patch.
Approval Request Comment
[Feature/regressing bug #]: MSE.
[User impact if declined]: Less consistent testing, harder to port critical fixes.
[Describe test coverage new/current, TreeHerder]: Landed on m-c some time ago.
[Risks and why]: This is an EME patch, not an MSE one, but it does no harm and simplifies porting important MSE. Risk is minimal.
[String/UUID change made/needed]: None.",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1118597,17,"Comment on attachment 8552063
1118597.patch v3
I don't have much concern about this one as it has been on m-c for some time already. Let's make things easier on ourselves for MSE in 37. Aurora+",UPLIFT_APPROVAL,0,FULL_TEXT
1118597,18,"Both patches pushed to aurora.
https://hg.mozilla.org/releases/mozilla-aurora/pushloghtml?changeset=f24f0b0532f9",STATUS_UPDATE,0,FULL_TEXT
1118597,19,"Something in this push caused linux32 debug bustage. Nobody was around to help, so I had to back it out.
https://hg.mozilla.org/releases/mozilla-aurora/rev/77d5e3a30435
https://treeherder.mozilla.org/logviewer.html#?job_id=612948&repo=mozilla-aurora",IMPLEMENTATION_REVERSION,0,FULL_TEXT
1118597,20,"Also w-p-t permafail.
https://treeherder.mozilla.org/logviewer.html#?job_id=614652&repo=mozilla-aurora",ISSUE_IMPACT,0,FULL_TEXT
1118597,21,"Trying again. I added an include to work around the (linux32 debug only!) build failure in Sinfparser.cpp.
https://treeherder.mozilla.org/#/jobs?repo=try&revision=ed269dd0a199",STATUS_UPDATE,0,FULL_TEXT
1118597,22,"I don't see a crash when following these steps with Aurora, but I don't see any media either.",SOLUTION_VERIFICATION,0,FULL_TEXT
1118599,1,"Created attachment 8544988
remove-MOZILLA_PKIX_ENUM_CLASS.patch
It seems like the GCC compiler bug that I worked around in bug 1077887 is no long relevant. This patch undoes that workaround.
It also renames some things that were named not-so-well do to the need to support non-scoped enums (without ""enum class"", multiple enums defined in the same scope cannot have the same labels like ""No"" and ""Yes"").",CODE_IMPLEMENTATION,1,FULL_TOKEN
1118599,2,"Comment on attachment 8544988
remove-MOZILLA_PKIX_ENUM_CLASS.patch
Review of attachment 8544988:
-----------------------------------------------------------------
Thanks for cleaning that up.",CODE_REVIEW,0,FULL_TEXT
1118599,3,"Created attachment 8545642
remove-MOZILLA_PKIX_ENUM_CLASS.patch",UNCODED,0,UNMATCHED
1118599,4,https://treeherder.mozilla.org/#/jobs?repo=try&revision=d65b051c1085,UNCODED,0,UNMATCHED
1118599,5,https://hg.mozilla.org/integration/mozilla-inbound/rev/2880e05d5e32,UNCODED,0,UNMATCHED
1118599,6,https://hg.mozilla.org/mozilla-central/rev/2880e05d5e32,UNCODED,0,UNMATCHED
1121826,1,"User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36
Steps to reproduce:
1. Prepare a script like this.
//request_check.php
<?php
exit(var_dump($_SERVER['REQUEST_URI']));
?>
2. Access the script with query parameter. 
http://localhost/request_check.php?hoge[]=fuga&hoge[]=piyo 
3. You will get a string like this.
IE8
string(51) ""/otsukano/request_check.php?hoge[]=fuga&hoge[]=piyo"" 
Chrome
string(51) ""/otsukano/request_check.php?hoge[]=fuga&hoge[]=piyo""
FireFox35
string(59) ""/otsukano/request_check.php?hoge%5B%5D=fuga&hoge%5B%5D=piyo""
Actual results:
The value of $_SERVER['REQUEST_URI']) is url-encoded unexpectedly
([] => %5B%5D).
Expected results:
The value should not be url-encoded.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1121826,2,"I tried to find the relevant spec bits for this. Reading https://url.spec.whatwg.org/#url-writing , it seems it says that a query string must consist of URL units, which are either percent-encoded bytes or in the set of url code points: https://url.spec.whatwg.org/#url-code-points which don't include [ or ] , leading me to think that they should therefore be encoded. However, (a) my success rate when trying to read specs is not great, and (b) the cross-browser inconsistency is not a good sign here. Anne/bz/valentin, you probably know more than me, can (one of) you comment?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1121826,3,"That change was made in bug 473822.
:annevk would know which is the right thing to do here.",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1121826,4,"Per https://url.spec.whatwg.org/#query-state it appears these are not to be escaped when found in a URL. It seems they are non-conforming to appear as such (they are not URL code points), but at the moment they do not get escaped by the parser and therefore what I suggested in bug 473822 is wrong.
Testing other browsers using http://intertwingly.net/projects/pegurl/liveview.html shows that none of them escape either ""["" or ""]"", but that does not explain the behavior people are talking about in the other bug.
Perhaps the only problem was that we removed percent-encoding rather than leaving it in place?
I'm really sorry about not having done due diligence the last time.",PROBLEM_REVIEW,0,FULL_TOKEN
1121826,5,"Nor is mine :-)
One thing I'm much better at is looking at actual test results:
https://url.spec.whatwg.org/interop/test-results/
None of these tests include square brackets outside of the authority/hostname field.  So lets add some.  If people have suggestions for a few tests, I can add the tests, gather results, and we can discuss the way forward.
Meahwhile, the following may be helpful:
http://software.hixie.ch/utilities/js/live-dom-viewer/?saved=3368",TESTCASE_REQUEST,0,FULL_TOKEN
1121826,6,"The relevant spec is RFC 3986. ""pchar"" does not allow ""["" nor ""]"", thus Firefox is correct in percent-encoding these characters.
A recipient that trips over percent-encoding like this is broken and should be fixed.",PROBLEM_REVIEW,0,FULL_TOKEN
1121826,7,"Just to clarify about bug 473822, the behavior that was causing issues for my team was Firefox decoding correctly percent-encoded square brackets in the URL bar, and making that ""sticky"". Typing in ""?foo%5Bb%5D=bar"" correctly sent that to the server, but in the URL bar it displayed ""?foo[b]=bar"". Now if you copied/pasted, bookmarked, or even clicked in to the URL bar and pressed enter, the next request to the server used the naked square brackets. It was this behind-the-scenes changing of what the user had entered (or been directed to) that was causing issues.",CLARIFICATION,0,FULL_TEXT
1121826,8,"Thanks Anthony, I agree that we should stop doing that. (I suppose that for display purposes we still might want to show [ and ], but we should not give an altered URL when you start to manipulate or copy it. Same as with Unicode <> ASCII.)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1121826,9,"Created attachment 8549944
backout cc192030c28f - brackets shouldn't be automatically escaped in the Query
I reverted the change in nsEscape.cpp and changed the unit test.
This should probably be uplifted so users don't get stuck with the bug for too long",CODE_IMPLEMENTATION,1,FULL_TOKEN
1121826,10,*** Bug 1122714 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1121826,11,"Try is green: https://treeherder.mozilla.org/#/jobs?repo=try&revision=b7bb9b8fe50b
https://hg.mozilla.org/integration/mozilla-inbound/rev/9124cbf3e75f",SOLUTION_VERIFICATION,0,FULL_TOKEN
1121826,12,https://hg.mozilla.org/mozilla-central/rev/9124cbf3e75f,UNCODED,0,UNMATCHED
1121826,13,"Comment on attachment 8549944
backout cc192030c28f - brackets shouldn't be automatically escaped in the Query
Approval Request Comment
[Feature/regressing bug #]:
Bug 473822
[User impact if declined]:
Some websites may not work for users on those specific releases.
[Describe test coverage new/current, TBPL]:
I have changed a test to make sure this behaviour does not regress in the future.
[Risks and why]:
Very low risk. It reverts back to a behaviour Firefox has had for a long time.
[String/UUID change made/needed]:
None",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1121826,14,"https://hg.mozilla.org/releases/mozilla-aurora/rev/ac9e91778eb6
https://hg.mozilla.org/releases/mozilla-beta/rev/12bda229bf83",UNCODED,0,UNMATCHED
1121826,15,*** Bug 1124209 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1121826,16,"This seems to have a dedicated straight forward test. Sylvestre, do you think it needs some additional manual testing outside of what's covered automatically?",INFO_REQUEST,0,FULL_TEXT
1121826,17,"Actually, no. Sorry about the noise!",ANSWER_TO_QUESTION,0,FULL_TEXT
1121826,18,*** Bug 1133707 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1121826,19,*** Bug 1128434 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1130065,1,Some of our algorithms do not use the job queue where they should and some don't split at the right boundaries. A fair number of intermittent failures are likely due to this. Fixes coming up.,PROBLEM_MOTIVATION,0,FULL_TEXT
1130065,2,"Try builds with patch and all our existing tests enabled
https://treeherder.mozilla.org/#/jobs?repo=try&revision=083037922056
https://treeherder.mozilla.org/#/jobs?repo=try&revision=ee099f65016c (this one has 2 tests that i forgot to enable before - test_worker{Unregister,Update}.html)
I'll put the patch up for review as soon as I've a couple of retriggers to spot intermittents.",UNCODED,0,UNMATCHED
1130065,3,"Created attachment 8562862
ServiceWorkerManager capture ""atomically"" properly
Main changes are to not assert active worker in ::FinishActivate and to finish the RegistrationJob before attempting to activate.
Tests are enabled on everything except b2g since they've passed successive retriggers
https://treeherder.mozilla.org/#/jobs?repo=try&revision=083037922056
https://treeherder.mozilla.org/#/jobs?repo=try&revision=ee099f65016c2 - this one enables workerUnregister and workerUpdate.
Folds:
Enable most SW tests
Cannot rely on controllerchange firing in an already controlled window. The AbortError case is no longer relevant due to FIFO ordering
Too bad we have to use timeouts",CODE_IMPLEMENTATION,1,FULL_TOKEN
1130065,4,"Comment on attachment 8562862
ServiceWorkerManager capture ""atomically"" properly
Review of attachment 8562862:
-----------------------------------------------------------------
can you tell me more about the tests commented out?
::: dom/workers/ServiceWorkerManager.cpp
@@ -76,5 @@
You didn't remove this variable from Manager.h
@@ +559,5 @@
why this change?
@@ +1042,5 @@
indent this line.
@@ +1043,5 @@
MOZ_ALWAYS_TRUE(NS_SUCCEEDED(NS_DispatchToMainThread(r));
::: dom/workers/ServiceWorkerManager.h
@@ +48,5 @@
#ifdef DEBUG ...
You don't use this method in prod builds.
@@ +86,5 @@
make Dump() to receive a format string and you can remove the fprintf here.
Plus... this debug messages are not really part of this bug.
I would like to remove it and add it in a separate bug/patch.
@@ +92,4 @@
same here.
::: dom/workers/test/serviceworkers/test_install_event.html
@@ +45,3 @@
why this code is comment out?
@@ +91,4 @@
same here.
::: dom/workers/test/serviceworkers/test_unregister.html
@@ +22,5 @@
info?
@@ +87,5 @@
I'm not really happy about this dump calls :)
What about info?",CODE_REVIEW,0,FULL_TOKEN
1130065,5,Sorry about the debugs left in and the test code commented out. Both were mistakes.,ANSWER_TO_QUESTION,0,FULL_TEXT
1130065,6,"Comment on attachment 8562862
ServiceWorkerManager capture ""atomically"" properly
Review of attachment 8562862:
-----------------------------------------------------------------
Revert all the test changes. If you really need the Dump() method, can you write it in a separate patch?",CODE_REVIEW,0,FULL_TEXT
1130065,7,"I was going to try to include this in the next build, but it needs to be rebased now that the persistent registration patches have landed.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1130065,8,"couldnt land due to tree being closed. i'm away till monday, but you can grab them from here https://treeherder.mozilla.org/#/jobs?repo=try&revision=98b5d0e4a7fb",STATUS_UPDATE,0,FULL_TEXT
1130065,9,https://hg.mozilla.org/integration/mozilla-inbound/rev/4d8423d5a83b,UNCODED,0,UNMATCHED
1130065,10,"sorry i had to to back this out in https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&revision=491e81cd9cf8 - seems one of this changes was causing on multiple desktop platforms test failures like 
https://treeherder.mozilla.org/logviewer.html#?job_id=6670670&repo=mozilla-inbound
that became frequent to perma failures starting with this csets. Could you take a look at this, thanks!",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1130065,11,https://hg.mozilla.org/integration/mozilla-inbound/rev/f64c2ee33087,UNCODED,0,UNMATCHED
1130065,12,"test_workerUpdate.html was failing nearly across the board, so I disabled it.
https://hg.mozilla.org/integration/mozilla-inbound/rev/465e4d4986e1",CODE_IMPLEMENTATION,1,FULL_TEXT
1130065,13,"https://hg.mozilla.org/mozilla-central/rev/f64c2ee33087
https://hg.mozilla.org/mozilla-central/rev/465e4d4986e1",UNCODED,0,UNMATCHED
1130253,1,"This happened while playing the YouTube test:
http://yt-dash-mse-test.commondatastorage.googleapis.com/unit-tests/2015.html?timestamp=1419893566526
2066494208[1004481a0]: MediaSource(13624b280)::Detach() mDecoder=0 owner=0
Assertion failure: mIsShutdown, at /Users/jyavenard/Work/Mozilla/mozilla-central/dom/media/MediaTaskQueue.cpp:26
JavaScript error: , line 0: uncaught exception: Test Seek TIMED OUT!
#01: mozilla::MediaTaskQueue::~MediaTaskQueue()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cc51ad]
#02: mozilla::MediaTaskQueue::~MediaTaskQueue()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cc5265]
#03: mozilla::MediaTaskQueue::Release()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ce9872]
#04: nsRefPtr<mozilla::MediaTaskQueue>::~nsRefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cfbced]
#05: nsRefPtr<mozilla::MediaTaskQueue>::~nsRefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ccc555]
#06: mozilla::AVCCMediaDataDecoder::~AVCCMediaDataDecoder()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8efe7]
#07: mozilla::AVCCMediaDataDecoder::~AVCCMediaDataDecoder()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8f045]
#08: mozilla::AVCCMediaDataDecoder::~AVCCMediaDataDecoder()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8f069]
#09: mozilla::MediaDataDecoder::Release()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8d748]
#10: nsRefPtr<mozilla::MediaDataDecoder>::~nsRefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8ebdd]
#11: nsRefPtr<mozilla::MediaDataDecoder>::~nsRefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8eba5]
#12: mozilla::MP4Reader::DecoderData::~DecoderData()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8eb3d]
#13: mozilla::MP4Reader::DecoderDataWithPromise<mozilla::MediaPromise<nsRefPtr<mozilla::VideoData>, mozilla::MediaDecoderReader::NotDecodedReason, true> >::~DecoderDataWithPromise()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8ecc1]
#14: mozilla::MP4Reader::DecoderDataWithPromise<mozilla::MediaPromise<nsRefPtr<mozilla::VideoData>, mozilla::MediaDecoderReader::NotDecodedReason, true> >::~DecoderDataWithPromise()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e8b0b5]
#15: mozilla::MP4Reader::~MP4Reader()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e868bb]
#16: mozilla::MP4Reader::~MP4Reader()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e86935]
#17: mozilla::MP4Reader::~MP4Reader()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2e86959]
#18: mozilla::MediaDecoderReader::Release()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cf696b]
#19: nsRefPtr<mozilla::MediaDecoderReader>::~nsRefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cfbb4d]
#20: nsRefPtr<mozilla::MediaDecoderReader>::~nsRefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ccdac5]
#21: mozilla::SourceBufferDecoder::~SourceBufferDecoder()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2d99a95]
#22: mozilla::SourceBufferDecoder::~SourceBufferDecoder()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2d99ad5]
#23: mozilla::SourceBufferDecoder::~SourceBufferDecoder()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2d99af9]
#24: mozilla::SourceBufferDecoder::Release()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2d9980c]
#25: mozilla::RefPtr<mozilla::SourceBufferDecoder>::unref(mozilla::SourceBufferDecoder*)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2db33a3]
#26: mozilla::RefPtr<mozilla::SourceBufferDecoder>::~RefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2db3378]
#27: mozilla::RefPtr<mozilla::SourceBufferDecoder>::~RefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2db3355]
#28: mozilla::DelayedDispatchToMainThread::~DelayedDispatchToMainThread()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2db3325]
#29: mozilla::DelayedDispatchToMainThread::~DelayedDispatchToMainThread()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2db32b5]
#30: mozilla::DelayedDispatchToMainThread::~DelayedDispatchToMainThread()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2db32d9]
#31: nsRunnable::Release()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1dbc09]
#32: mozilla::RefPtr<nsIRunnable>::unref(nsIRunnable*)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2c76eba]
#33: mozilla::RefPtr<nsIRunnable>::~RefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cfe538]
#34: mozilla::RefPtr<nsIRunnable>::~RefPtr()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cccc25]
#35: mozilla::MediaTaskQueue::TaskQueueEntry::~TaskQueueEntry()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2d04a55]
#36: mozilla::MediaTaskQueue::TaskQueueEntry::~TaskQueueEntry()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cd8bb5]
#37: __gnu_cxx::new_allocator<mozilla::MediaTaskQueue::TaskQueueEntry>::destroy(mozilla::MediaTaskQueue::TaskQueueEntry*)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cdb1d9]
#38: std::deque<mozilla::MediaTaskQueue::TaskQueueEntry, std::allocator<mozilla::MediaTaskQueue::TaskQueueEntry> >::pop_front()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cdb190]
#39: std::queue<mozilla::MediaTaskQueue::TaskQueueEntry, std::deque<mozilla::MediaTaskQueue::TaskQueueEntry, std::allocator<mozilla::MediaTaskQueue::TaskQueueEntry> > >::pop()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cd9045]
#40: mozilla::MediaTaskQueue::FlushLocked()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cc5896]
#41: mozilla::MediaTaskQueue::FlushAndDispatch(mozilla::TemporaryRef<nsIRunnable>)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ca3be7]
#42: mozilla::MediaDecoderStateMachine::FlushDecoding()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ca3046]
#43: mozilla::MediaDecoderStateMachine::RunStateMachine()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ca1fda]
2066494208[1004481a0]: MediaSource(13624b280) Dispatch event 'sourceclose'
2066494208[1004481a0]: SourceBufferList(12e195bc0) Dispatch event 'removesourcebuffer'
2066494208[1004481a0]: SourceBufferList(12e195b60) Dispatch event 'removesourcebuffer'
#44: mozilla::MediaDecoderStateMachine::CallRunStateMachine()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ca4057]
#45: mozilla::MediaDecoderStateMachine::TimeoutExpired(void*)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2c9563d]
#46: mozilla::MediaDecoderStateMachineScheduler::TimeoutExpired(int)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2ca4cac]
#47: (anonymous namespace)::TimerEvent::Run()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cc9ccf]
#48: non-virtual thunk to (anonymous namespace)::TimerEvent::Run()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x2cc9dfc]
2066494208[1004481a0]: MediaSource(1436d3100)::MediaSource(aWindow=12f270420) mSourceBuffers=12f7f4e20 mActiveSourceBuffers=12f7f4fa0
#49: nsThreadPool::Run()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x185ee7]
#50: non-virtual thunk to nsThreadPool::Run()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x185fdc]
#51: nsThread::ProcessNextEvent(bool, bool*)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x182948]
2066494208[1004481a0]: MediaSource(1436d3100)::Attach(aDecoder=12f7d9b00) owner=134349ca0
2066494208[1004481a0]: MediaSource(1436d3100)::SetReadyState(aState=1) mReadyState=0
2066494208[1004481a0]: MediaSource(1436d3100) Queuing event 'sourceopen'
2066494208[1004481a0]: Decoder=12f7d9b00 SetMinimizePrerollUntilPlaybackStarts()
#52: NS_ProcessNextEvent(nsIThread*, bool)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x1dc6b7]
#53: mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x80d843]
#54: MessageLoop::RunInternal()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x7a2875]
#55: MessageLoop::RunHandler()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x7a2785]
#56: MessageLoop::Run()[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x7a272d]
#57: nsThread::ThreadFunc(void*)[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/XUL +0x180dd6]
#58: _pt_root[/Users/jyavenard/Work/Mozilla/mozilla-central/obj-ff-dbg/dist/NightlyDebug.app/Contents/MacOS/libnss3.dylib +0x37445f]
#59: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x3268]
#60: _pthread_body[/usr/lib/system/libsystem_pthread.dylib +0x31e5]
(lldb)",STACK_TRACE,0,FULL_TOKEN
1130253,2,"Sounds similar to bug 1129877.
We crash due the promise not being detached when shutting down",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1130253,3,"Created attachment 8560231
logcrash.txt.zip
Entire log of the transaction",STACK_TRACE,0,FULL_TEXT
1130253,4,"I also filed a media shutdown hang in bug 1129455, maybe that's related (or might be completely different, I don't know).",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1130253,5,"The problem here is that MediaDecoderReader::Shutdown() returns a promise, but TrackBuffer::RemoveDecoder assumes that it happens synchronously. I'll take this.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1130253,6,"Oh no, that's not it, because MP4Reader::Shutdown does AwaitIdle while shutting down its task queues, and so it's effectively synchronous. I'll explain what's actually happening here in the next comment.",STATUS_UPDATE,0,FULL_TEXT
1130253,7,"The problem here is basically that task queue flushing is totally insane and needs to go away.
We get ourselves into shutdown state, so we invoke MDSM::FlushDecoding, which flushes the task queue. This destroys a DelayedDispatchToMainThread (on the calling thread!) without giving it a chance to run, which means that it release the subdecoder on the wrong thread and without having called shutdown, and stuff break.
The solution is to get rid of flushing. I'm going to try to do bug 1125970 and pick up where cpearce left off.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1130253,8,Tracking all MSE P1 bugs for Firefox 37.,STATUS_UPDATE,0,FULL_TEXT
1130253,9,This should be fixed by bug 1125970.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1130253,10,Bug 1125970 landed in 38 and was uplifted to 37. Marking 37+ as fixed.,STATUS_UPDATE,0,FULL_TEXT
1132780,2,"Created attachment 8563860
1132780_without_unified_build.patch
Fix build errors in non-unified build.",CODE_IMPLEMENTATION,1,FULL_TEXT
1132780,3,"Comment on attachment 8563860
1132780_without_unified_build.patch
wrong file...",CODE_REVIEW,0,FULL_TEXT
1132780,4,"Created attachment 8563861
1132780_fix_build_break.patch
fix build errors in non-unified build.",CODE_IMPLEMENTATION,1,FULL_TEXT
1132780,5,"Try builds
with unified build: https://tbpl.mozilla.org/?tree=Try&rev=2c599e6f9104
without unified build: https://tbpl.mozilla.org/?tree=Try&rev=4ed2c38ed470",UNCODED,0,UNMATCHED
1132780,6,https://hg.mozilla.org/integration/mozilla-inbound/rev/5c8a20b982fb,UNCODED,0,UNMATCHED
1132780,7,https://hg.mozilla.org/mozilla-central/rev/5c8a20b982fb,UNCODED,0,UNMATCHED
1132780,8,https://hg.mozilla.org/releases/mozilla-beta/rev/e3bf6bb9b33a,UNCODED,0,UNMATCHED
1132780,9,"Created attachment 8572368
Beta patch
Patch for beta branch as part of EME platform uplift.",CODE_IMPLEMENTATION,1,FULL_TEXT
1148078,1,"Before switching flexbox layout to logical coordinates in bug 1079155, we should get rid of misleading uses of the term ""Logical"" in nsFlexContainerFrame (which predate the logical-coordinates work).
I used ""logical position/size"" to refer to ""main-axis/cross-axis position/size"". For now, I'm going to switch to call these ""flex-relative"" instead of ""logical"".
(We may come up with a better term down the line; ideally, we should use something that applies to flex & grid. For now, ""FlexRelative"" is pretty clear, though, and we can do search-and-replace later if we think of something better.)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1148078,2,"Created attachment 8584058
fix v1",UNCODED,0,UNMATCHED
1148078,3,"I'm also changing some usages of position/posn/pos in the tweaked code to ""coord"" instead. (so e.g. ""PhysicalPosFromLogicalPos"" is now known as ""PhysicalCoordFromFlexRelativeCoord"").
I'm making this change since ""position"" is ambiguous about whether it's 1- or 2-dimensional value. ""Coord"" is a bit less ambiguous.
(Elsewhere in this file, I still have e.g. FlexItem::GetMainPosition/GetCrossPosition, but I think that's less ambiguous.)",CODE_IMPLEMENTATION,1,FULL_TOKEN
1148078,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/638492d777fc,UNCODED,0,UNMATCHED
1148078,5,https://hg.mozilla.org/mozilla-central/rev/638492d777fc,UNCODED,0,UNMATCHED
1173001,1,This is necessary in order to support mirroring in MediaDecoderReader.,PROBLEM_MOTIVATION,0,FULL_TEXT
1173001,2,"Created attachment 8617413
Part 1 - Initialize reader task queue in the constructor. v1
This is a necessary step towards having mirrored/canonical values, since those
need to know the task queue in their constructor.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1173001,3,"Created attachment 8617414
Part 2 - Fix up some task queue naming to make MediaDecoderReader consistent with MDSM. v1",UNCODED,0,UNMATCHED
1173001,4,Generalizing the bug a bit.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1173001,5,"Comment on attachment 8617413
Part 1 - Initialize reader task queue in the constructor. v1
This is going to need some tweaking.",CODE_REVIEW,0,FULL_TEXT
1173001,6,"While at it, it would be great if the task queue constructor could be called on something else but the main thread.
As it reads a preference to find out the size of the threads pool, this asserts when called on a thread other than the main thread.",CODE_REVIEW,0,FULL_TOKEN
1173001,7,"That seems like a good thing to fix, but I don't plan on doing it in this bug.",NEW_ISSUE_FILING,0,FULL_TEXT
1173001,8,"Created attachment 8617697
Part 0 - Explicitly instantiate WebReader in MediaSourceReader. v1
This will allow us to pass the borrowed task queue. It's also more explicit
about the fact that we only support mp4 and (sort of) webm.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1173001,9,"Created attachment 8617698
Part 2 - Initialize reader task queue in the constructor. v1
This is a necessary step towards having mirrored/canonical values, since those
need to know the task queue in their constructor.",UNCODED,0,UNMATCHED
1173001,10,"Created attachment 8617699
Part 3 - Fix up some task queue naming to make MediaDecoderReader consistent with MDSM. v1",UNCODED,0,UNMATCHED
1173001,11,"Created attachment 8617700
Part 4 - Enable tail dispatch for the decode task queue. v1",UNCODED,0,UNMATCHED
1173001,12,"Comment on attachment 8617698
Part 2 - Initialize reader task queue in the constructor. v1
Review of attachment 8617698:
-----------------------------------------------------------------
::: dom/media/MediaDecoderReader.h
@@ +312,5 @@
Why changing from private to protected?",CODE_REVIEW,0,FULL_TEXT
1173001,13,It's just about the initialization order - the task queue needs to be initialized early so that mirror initializers can use it.,ANSWER_TO_QUESTION,0,FULL_TEXT
1173001,14,"Thanks for the fast reviews!
https://treeherder.mozilla.org/#/jobs?repo=try&revision=2a41aee7baf2",UNCODED,0,UNMATCHED
1173001,15,"https://hg.mozilla.org/integration/mozilla-inbound/rev/6289cdbce7b7
https://hg.mozilla.org/integration/mozilla-inbound/rev/e7b684137f22
https://hg.mozilla.org/integration/mozilla-inbound/rev/0e722555cc6d
https://hg.mozilla.org/integration/mozilla-inbound/rev/f2f35acc27a2",UNCODED,0,UNMATCHED
1173001,16,"https://hg.mozilla.org/mozilla-central/rev/6289cdbce7b7
https://hg.mozilla.org/mozilla-central/rev/e7b684137f22
https://hg.mozilla.org/mozilla-central/rev/0e722555cc6d
https://hg.mozilla.org/mozilla-central/rev/f2f35acc27a2",UNCODED,0,UNMATCHED
1176028,1,"Created attachment 8624392
use_tasks_generators_directly-v0.diff
I added a wrapper to the generators so that we could land the unix and windows parts independently. Now we're ready to rip out the shim.",CODE_IMPLEMENTATION,1,FULL_TEXT
1176028,2,https://treeherder.mozilla.org/#/jobs?repo=try&revision=9f6f6230e998,UNCODED,0,UNMATCHED
1176028,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/88f5bdaf1d8e,UNCODED,0,UNMATCHED
1176028,5,https://hg.mozilla.org/mozilla-central/rev/88f5bdaf1d8e,UNCODED,0,UNMATCHED
1184282,1,"+++ This bug was initially created as a clone of Bug #385719 +++
This warning [1], introduced in bug 385719 in 2007, shows up in the following test suites:
It shows up in 26 tests. A few of the most prevalent:
[1] https://hg.mozilla.org/mozilla-central/annotate/49683d4e9ebd/gfx/thebes/gfxTextRun.cpp#l220",STACK_TRACE,0,FULL_TEXT
1184282,2,"The associated comment:
seems to indicate that this is unfortunate, yet expected behavior. Perhaps we should just remove the warning.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1184282,3,"Created attachment 8634353
Remove break suggested inside cluster warning",UNCODED,0,UNMATCHED
1184282,4,"Hmmm, given that we're now using harfbuzz in most cases (OSX being the notable exception), I'm sort of surprised that this is happening so much. I think removing the warning is fine but we should probably investigate why this happens so much as it may indicate other bugs.",SOLUTION_REVIEW,1,FULL_TEXT
1184282,5,"I'm happy to investigate this further, do you have any specific requests? A sampling of stacks is certainly doable.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1184282,6,"url:        https://hg.mozilla.org/integration/mozilla-inbound/rev/c281b91bf5f854499806f45c38ca03b6baf126e8
changeset:  c281b91bf5f854499806f45c38ca03b6baf126e8
user:       Eric Rahm <erahm@mozilla.com>
date:       Thu Jul 16 16:43:04 2015 -0700
description:
Bug 1184282 - Remove break suggested inside cluster warning. r=roc",UNCODED,0,UNMATCHED
1184282,7,https://hg.mozilla.org/mozilla-central/rev/c281b91bf5f8,UNCODED,0,UNMATCHED
1184945,1,"In octane-regexp we often miss our fastpath to go from ion jit -> irregexp jit because we need more space in the MatchResultTemplateObject. As a result we take the slow path and do ""ion jit"" -> c++ -> ""irregexp jit"".
We allow up to 6 submatches in the fast case. In the benchmark we see cases up to 11 submatches. For these we take a slow path.
I doubled the size of the TemplateObject to be a (8 to 16), which allows 14 submatches.
This gives me an improvement from 2950 to 3450 on regexp.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1184945,2,"Created attachment 8635272
Patch",UNCODED,0,UNMATCHED
1184945,3,"Comment on attachment 8635272
Patch
Review of attachment 8635272:
-----------------------------------------------------------------
Nice!  How often are we still taking a slow path because of an undersized template object?  It would be nifty to be able to size the result object's array based on the number of matches needed, for better memory utilization and robustness.
::: js/src/jit/CodeGenerator.cpp
@@ +1008,5 @@
Preexisting, but it would be nice if this constant was in a header file that could be referenced by createMatchResultTemplateObject when sizing the template array.",CODE_REVIEW,0,FULL_TOKEN
1184945,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/066e0b4423c9,UNCODED,0,UNMATCHED
1184945,5,"For normal regexps we don't anymore (e.g. never in octane-regexp). For RegExp with more than 14 submatches we still do, which I think doesn't happen often...",ANSWER_TO_QUESTION,0,FULL_TEXT
1184945,6,https://hg.mozilla.org/mozilla-central/rev/066e0b4423c9,UNCODED,0,UNMATCHED
1187056,1,"Description:
test_gallery_edit_photo test is failing after opening the gallery app and selecting a photo to embiggen. While on large photo view, test taps the edit button but no action resolves, leaving the test to timeout. Saw this issue reproduce once manually but have not discovered STR at this time.
* http://jenkins1.qa.scl3.mozilla.com/view/UI/job/flame-kk-319.mozilla-central.nightly.ui.functional.non-smoke.2.bitbar/181/HTML_Report/
* http://jenkins1.qa.scl3.mozilla.com/job/flame-kk.ui.adhoc.bitbar/146/HTML_Report/
PreReq:
* picture in gallery app
Repro Steps:
1) Update phone to 20150723010205
2) Open Gallery app
3) Tap picture
4) Tap Edit button
Actual:
Phone does not transition to edit view; test times out
Expected: 
Phone transitions to edit view; test continues editting
Traceback (most recent call last):
File ""/var/lib/jenkins/jobs/flame-kk-319.mozilla-central.nightly.ui.functional.non-smoke.2.bitbar/workspace/.env/lib/python2.7/site-packages/marionette_client-0.16-py2.7.egg/marionette/marionette_test.py"", line 296, in run
testMethod()
File ""/var/lib/jenkins/jobs/flame-kk-319.mozilla-central.nightly.ui.functional.non-smoke.2.bitbar/workspace/tests/python/gaia-ui-tests/gaiatest/tests/functional/gallery/test_gallery_edit_photo.py"", line 28, in test_gallery_edit_photo
edit_image = image.tap_edit_button()
File ""/var/lib/jenkins/jobs/flame-kk-319.mozilla-central.nightly.ui.functional.non-smoke.2.bitbar/workspace/tests/python/gaia-ui-tests/gaiatest/apps/gallery/regions/fullscreen_image.py"", line 92, in tap_edit_button
return EditPhoto(self.marionette)
File ""/var/lib/jenkins/jobs/flame-kk-319.mozilla-central.nightly.ui.functional.non-smoke.2.bitbar/workspace/tests/python/gaia-ui-tests/gaiatest/apps/gallery/regions/edit_photo.py"", line 27, in __init__
*self._canvas_locator))))
File ""/var/lib/jenkins/jobs/flame-kk-319.mozilla-central.nightly.ui.functional.non-smoke.2.bitbar/workspace/.env/lib/python2.7/site-packages/marionette_driver-0.9-py2.7.egg/marionette_driver/wait.py"", line 143, in until
cause=last_exc)
TimeoutException: TimeoutException: Timed out after 10.3 seconds
Environmental Variables:
Device firmware (base) 	L1TC000118D0
Device firmware (date) 	23 Jul 2015 08:24:55
Device firmware (incremental) 	eng.cltbld.20150723.042443
Device firmware (release) 	4.4.2
Device identifier 	flame
Device memory 	219772 kB
Device serial 	356cd044
Device uptime 	0 days 0 hours 2 minutes 8 seconds
Gaia date 	22 Jul 2015 18:44:09
Gaia revision 	f04fdbfa1943
Gecko build 	20150723010205
Gecko revision 	2ddec2dedced
Gecko version 	42.0a1
Reproducible manually: Once, cannot reproduce at this time
Repro frequency: 3/6",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1187056,2,"Ok, I can reproduce this manually too, when you after the Gallery is open, you quickly tap on the image to open it as a fullscreen image.
So this looks like a regression to me. We should find out when this regressed.",PROBLEM_REVIEW,0,FULL_TEXT
1187056,3,"Confirmed comment 1. It seems that the bug will only reproduce if I tap into a picture while Gallery is still loading.
Flame 2.2 prevented this behavior. If a certain picture is not ready to enter Edit mode, Edit button is grayed out until it's ready.
Working on getting the window.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1187056,4,I cannot reproduce this issue using shallow flashing whatsoever. That means I'll have to full flash to find the window and won't be able to do swaps to find out whether it's Gecko or Gaia issue.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1187056,5,This is also a problem with test_gallery_delete_image.py.,PROBLEM_REVIEW,0,FULL_TEXT
1187056,6,And test_gallery_switch_to_camera.py.,PROBLEM_REVIEW,0,FULL_TEXT
1187056,7,"I don't understand why ./flash_pvt.py makes this reproduce, but when I do ./flash_pvt.py -d flame-kk -v mozilla-central --eng -g -G -b 20150624080416 it doesn't.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1187056,8,"Fortunately I don't have to do swaps for this one.
mozilla-inbound regression window:
Last Working
Device: Flame
BuildID: 20150721075041
Gaia: 4fe0507781f3ed56c8ae5e66dd9489165d1ff68e
Gecko: 49ae0961591e
Gonk: 41d3e221039d1c4486fc13ff26793a7a39226423
Version: 42.0a1 (2.5 Master) 
Firmware Version: v18D
User Agent: Mozilla/5.0 (Mobile; rv:42.0) Gecko/42.0 Firefox/42.0
First Broken
Device: Flame
BuildID: 20150721075241
Gaia: 4fe0507781f3ed56c8ae5e66dd9489165d1ff68e
Gecko: fee45cd9a4d9
Gonk: 41d3e221039d1c4486fc13ff26793a7a39226423
Version: 42.0a1 (2.5 Master) 
Firmware Version: v18D
User Agent: Mozilla/5.0 (Mobile; rv:42.0) Gecko/42.0 Firefox/42.0
Gaia is the same so it's a Gecko issue.
Gecko pushlog:
http://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=49ae0961591e&tochange=fee45cd9a4d9
This issue is likely caused by changes made in Bug 1178847.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1187056,9,*** Bug 1188007 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1187056,10,"[Blocking Requested - why for this release]:
Broken functionality and a regression so nominating this 2.5?
Kartikaya, can you take a look at this please? This looks to have been caused by the changes made for bug 1178847.",QUESTION,0,FULL_TOKEN
1187056,11,"Thanks, I'll take a look.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1187056,12,"I can reproduce this behaviour very intermittently. When I do, I see in WebIDE that the buttons in question don't have their onclick listeners registered, which seems very odd. I don't see how my change could have caused that behaviour, since the onclick listeners are registered unconditionally in frames.js. I'll keep digging.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1187056,13,*** Bug 1188226 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1187056,14,"So I'm unable to reproduce the problem manually any more. I also can't reproduce it while running test_gallery_edit_photo.py; instead it just times out while waiting for files to load, even though visually I can see on the device that the files are done loading. This is the command I tried:
GAIATEST_SKIP_WARNING=1 GAIATEST_ACKNOWLEDGED_RISKS=1 $MARIONETTE_ENV/bin/gaiatest --address=localhost:2828 --testvars gaiatest/testvars_template.json --restart --timeout 120000 gaiatest/tests/functional/gallery/test_gallery_edit_photo.py
Without a way to reproduce this problem I can't really do much else. I don't think this test/suite has enough documentation on how to properly run it on a local dev machine.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1187056,15,"What do you mean? You were able to run it, no?",QUESTION,0,FULL_TEXT
1187056,16,"So I locally ran the test using today's nightly build, and I can repro the error.  Basically it times out after tapping the edit button, and waiting for the canvas view.  (Because canvas view doesn't come up).  I tapped the edit button manually after the test failed, and it was still unresponsive.  
Kats, if you need me to try something out here, let me know.  It's strange that this happens with low repro rate when I do it manually.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1187056,17,"Yes, but the environment on the device is not specified in enough detail. It loads pictures off the SD card and in my case I have around 80-100 pictures that I took yesterday while trying to reproduce this bug. It seems to me that the test is not expecting that, which is why it's timing out for me. I don't know what set of pictures the test is expecting, and it doesn't appear to be documented anywhere.",ANSWER_TO_QUESTION,0,FULL_TEXT
1187056,18,"Oh, I see. That sounds like a bug in the framework. It should actually delete those pictures and only use the picture that was added in the test.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1187056,19,"So what I found out was that I can only repro the bug once for each cold startup.  I have to shutdown and power up the phone and run the script to repro the bug, and after that, I cannot reproduce this unless I turn off the phone again.  Also I am on 319MB config as well.  mwargers is investigating 512MB setup.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1187056,20,"Yeah, I couldn't reproduce after 20 retries, but I could reproduce it 2 times out of 10 using 319MB.
If one would want to reproduce manually, I would recommend trying with 256MB.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1187056,21,"It's actually strange that it doesn't do that, because in bug 1044019 this was done supposedly.",PROBLEM_REVIEW,0,FULL_TEXT
1187056,22,Test blocker.,UNCODED,0,UNMATCHED
1187056,23,"Ok, I tried on a flame-kk and I can reproduce the test failure there. For some reason it doesn't repro on Aries. Anyway I can flash a local gecko build on top of a stock pvtbuild and still repro so I do have a chance at debugging this now. I tried flashing a full local build but that made the issue go away. Haven't tried flashing just gaia yet.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1187056,24,"So what appears to be happening is that the gallery.js code is loaded before the meta-viewport tag has taken effect. This results in ScreenLayout.getCurrentLayout('tiny') returning false (because the innerWidth is 980) and so the fullscreenButtons array gets populated with empty things. This causes the test to fail later on.
I'm not really sure why the meta-viewport tag is getting processed so late, since it's right at the top of the HTML file, before the <script> tags. Need to dig some more.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1187056,25,"Created attachment 8641169
Patch
Ok, so the problem is the async-ness of the DOMMetaAdded dispatch at [1]. The meta viewport tag is parsed before the JS is run, but the DOMMetaAdded event itself isn't dispatched until after, so the MobileViewportManager doesn't update the viewport until after.
I'm not entirely sure how this was working prior to bug 1178847 since it seems like it should have had the same problem. Nonetheless I think the correct fix is to add a synchronous notification of the meta-viewport tag so that we can update the screen properties immediately. The patch also has the side benefit of not running MobileViewportManager code with random non-viewport meta tags are added, which is nice.
However I'm not entirely sure it's ok to be running a reflow synchronously from the DOM building code, if it isn't then I don't see a way to fix this in gecko and it will have to be fixed in the gallery app. Smaug, do you know if this is ok?
Try push in progress at https://treeherder.mozilla.org/#/jobs?repo=try&revision=341db37de415
[1] http://mxr.mozilla.org/mozilla-central/source/dom/html/HTMLMetaElement.cpp?rev=bd079aadd3fe#97",CODE_IMPLEMENTATION,1,FULL_TOKEN
1187056,26,"Comment on attachment 8641169
Patch
This is unfortunately most probably not safe.
We won't reflow at that point, since there are script blockers on stack, but
doing anything like MetaViewportChanged() during BindToTree looks
scary to me. One would need to explicitly prove that MetaViewportChanged call may not run scripts.
So either prove that and assert somewhere hard (RELEASE_ASSERT) that script aren't run, nor events dispatched etc.
 or
Would it help if HTMLMetaElement::CreateAndDispatchEvent didn't use 
asyncDispatcher->PostDOMEvent(); but 
asyncDispatcher->RunDOMEventWhenSafe() ?",QUESTION,0,FULL_TOKEN
1187056,27,"Created attachment 8641210
Patch v2
Yeah using RunDOMEventWhenSafe also fixes it, thanks for the tip! Try push at https://treeherder.mozilla.org/#/jobs?repo=try&revision=fe342ec1f1f9",CODE_IMPLEMENTATION,1,FULL_TEXT
1187056,28,"Comment on attachment 8641210
Patch v2
r+, naturally assuming tryserver results look good",CODE_REVIEW,0,FULL_TEXT
1187056,29,"Try looks good. There's a frequent M-3 failure on B2G but looking at the ""similar jobs"" pane shows a lot of other pushes from the same time hit that too. More retriggers on it are coming up green, so I assume some glitch in the environment caused those.
I'll land it once inbound reopens.",CODE_REVIEW,0,FULL_TOKEN
1187056,30,https://hg.mozilla.org/integration/mozilla-inbound/rev/8fa22ffa2da2,UNCODED,0,UNMATCHED
1187056,31,adding qawanted to test out with gaia ui test once it lands.,STATUS_UPDATE,0,FULL_TEXT
1187056,32,https://hg.mozilla.org/mozilla-central/rev/8fa22ffa2da2,UNCODED,0,UNMATCHED
1187056,33,"I just tested locally test_gallery_edit_photo.py and repeated 10 times. I didn't get any failure. Normally, I would definitely see this failure within 5 times, so I think this is really fixed.
Thanks for fixing this, Kats!",SOLUTION_VERIFICATION,0,FULL_TOKEN
1187056,34,"This issue is verified as fixed on Flame and Aries. Ran the 'test_gallery_edit_photo.py' locally 10 times on each device/branch and they all passed without issue.
Device: Aries 2.6
BuildID: 20151210122424
Gaia: 7e962276913bd4da7ce5fa7540767107ce322c78
Gecko: 412e4d7ce98ca4dbc37de133d0f26d7e1a59946f
Gonk: a19052e4389c3ae2d8fc3e7a74a475401baacc56
Version: 45.0a1 (2.6) 
Firmware Version: D5803_23.1.A.1.28_NCB.ftf
User Agent: Mozilla/5.0 (Mobile; rv:45.0) Gecko/45.0 Firefox/45.0
Device: Flame 2.6
BuildID: 20151210030222
Gaia: 961528f4391668bc89ec0be14fa367cea099b588
Gecko: b40ba117fa757861c9caa660ae989122718b494b
Gonk: 205ac4204bbbb2098a8046444acba551ba5dc75a
Version: 45.0a1 (2.6) 
Firmware Version: v18Dv4
User Agent: Mozilla/5.0 (Mobile; rv:45.0) Gecko/45.0 Firefox/45.0
Device: Flame 2.5
BuildID: 20151209170211
Gaia: 7ca639a7bb0bacf27f548841c52617bfc0e3b21f
Gecko: a35e8eb98969970d1af28b265bf99a9edd11e9c2
Gonk: 205ac4204bbbb2098a8046444acba551ba5dc75a
Version: 44.0a2 (2.5) 
Firmware Version: v18Dv4
User Agent: Mozilla/5.0 (Mobile; rv:44.0) Gecko/44.0 Firefox/44.0",SOLUTION_VERIFICATION,0,FULL_TOKEN
1189924,1,mstange pointed that the minimap's DP is too difficult to see. Let's fix it.,PROBLEM_MOTIVATION,0,FULL_TEXT
1189924,2,"Created attachment 8641863
MozReview Request: Bug 1189924 - Add a background color to the APZ minimap. r=kats
Bug 1189924 - Add a background color to the APZ minimap. r=kats",CODE_IMPLEMENTATION,1,FULL_TEXT
1189924,3,"Created attachment 8641868
Screenshot 2015-07-31 16.44.18.png",UNCODED,0,UNMATCHED
1189924,4,"Comment on attachment 8641863
MozReview Request: Bug 1189924 - Add a background color to the APZ minimap. r=kats
https://reviewboard.mozilla.org/r/14629/#review13221
Ship It!",CODE_REVIEW,0,FULL_TEXT
1189924,5,Inbound is closed,UNCODED,0,UNMATCHED
1189924,6,https://hg.mozilla.org/integration/mozilla-inbound/rev/c269782a7fa1,UNCODED,0,UNMATCHED
1189924,7,https://hg.mozilla.org/mozilla-central/rev/c269782a7fa1,UNCODED,0,UNMATCHED
1190676,1,"Created attachment 8642798
testcase
Assertion failure: cycleStackMarker == ps->mCycleMarker, at dom/media/MediaStreamGraph.cpp:756",PROBLEM_DESCRIPTION,0,FULL_TEXT
1190676,2,"Created attachment 8643082
Use the right MediaStreamGraph when setting a MediaStream as mozSrcStream on an HTMLMediaElement. r=
Another instance of the same problem as last time.",CODE_IMPLEMENTATION,1,FULL_TEXT
1190676,3,"Created attachment 8643083
Force explicitely passing in a MediaStreamGraph when creating a DOMMediaStream. r=
Hopefully this will prevent cross-graph connections and other madness.",CODE_IMPLEMENTATION,1,FULL_TEXT
1190676,4,"Created attachment 8643085
Make getting a MediaStreamGraph for a channel more explicit. r=
Hopefully this wil also prevent getting the wrong graph.",CODE_IMPLEMENTATION,1,FULL_TEXT
1190676,5,"Created attachment 8643088
Part 1 - Use the right MediaStreamGraph when setting a MediaStream as mozSrcStream on an HTMLMediaElement. r=",UNCODED,0,UNMATCHED
1190676,6,"Created attachment 8643089
Part 2 - Force explicitely passing in a MediaStreamGraph when creating a DOMMediaStream. r=
Hopefully this will prevent cross-graph connections.",CODE_IMPLEMENTATION,1,FULL_TEXT
1190676,7,"Created attachment 8643091
Part 3 - Make getting a MediaStreamGraph for a channel more explicit. r=
Hopefully this wil also prevent getting the wrong graph.",UNCODED,0,UNMATCHED
1190676,8,"Created attachment 8643092
Part 4 - Fix consumers: CanvasCaptureMediaStream. r=",UNCODED,0,UNMATCHED
1190676,9,"Created attachment 8643094
Part 5 - Fix consumers: PeerConnection. r=
I needed to stub a number of things to make this work, but I have mostly no
idea what I'm doing in the FakeMediaStream file.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1190676,10,"Created attachment 8643095
Part 6 - Fix consumers: MediaManager. r=",UNCODED,0,UNMATCHED
1190676,11,"Created attachment 8643102
Part 7 - Fix consumers: InputPort and HWMediaStream. r=
James, it appears that you wrote this code initially, care to have a look at
this? I mostly need to know if there is a way to know whether the graph will
need audio when you call GetInstance.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1190676,12,"Created attachment 8643106
Part 8 - Fix consumers: CameraPreviewMediaStream. r=",UNCODED,0,UNMATCHED
1190676,13,"Created attachment 8643110
Part 9 - Fix consumers: AudioCapture. r=",UNCODED,0,UNMATCHED
1190676,14,"Created attachment 8643111
Part 10 - Fix consumers: AudioDestinationNode. r=",UNCODED,0,UNMATCHED
1190676,15,"Created attachment 8643113
Part 11 - Fix consumers: Web Speech. r=",UNCODED,0,UNMATCHED
1190676,16,"Comment on attachment 8643111
Part 10 - Fix consumers: AudioDestinationNode. r=
Please fold this into attachment 8643091, as I hope that won't compile without this change.",CODE_REVIEW,0,80_PCT_MATCH
1190676,17,"Comment on attachment 8643113
Part 11 - Fix consumers: Web Speech. r=
This looks good to me, but I'd like to ask eeejay to please double check since he's more familiar with Synthesis",CODE_REVIEW_REQUEST,0,FULL_TEXT
1190676,18,"Comment on attachment 8643113
Part 11 - Fix consumers: Web Speech. r=
Review of attachment 8643113:
-----------------------------------------------------------------
Looks good. I'm not sure which AudioChannel we want to be on. But I assume we were on Normal before, so this is fine.",CODE_REVIEW,0,FULL_TEXT
1190676,19,"This is orange on try, but I think 962719 will fix the errors.",UNCODED,0,UNMATCHED
1190676,20,"Created attachment 8653521
Part 12 - Fix mozCaptureStream. r=
Hrm, I forgot that I had added this after asking for all the reviews.",CODE_IMPLEMENTATION,1,FULL_TEXT
1190676,21,"Comment on attachment 8653521
Part 12 - Fix mozCaptureStream. r=
Review of attachment 8653521:
-----------------------------------------------------------------
One of these in CaptureStreamInternal() should suffice.",CODE_REVIEW,0,FULL_TEXT
1190676,22,"https://hg.mozilla.org/integration/mozilla-inbound/rev/905d5f8b66c2
https://hg.mozilla.org/integration/mozilla-inbound/rev/865b6a377448
https://hg.mozilla.org/integration/mozilla-inbound/rev/1a303a9f74f8
https://hg.mozilla.org/integration/mozilla-inbound/rev/23e4bbe07e4c
https://hg.mozilla.org/integration/mozilla-inbound/rev/e9856dc51513
https://hg.mozilla.org/integration/mozilla-inbound/rev/4d8264b7c691
https://hg.mozilla.org/integration/mozilla-inbound/rev/47c3d22006d9
https://hg.mozilla.org/integration/mozilla-inbound/rev/c944b51c50d7
https://hg.mozilla.org/integration/mozilla-inbound/rev/58786af75f6a
https://hg.mozilla.org/integration/mozilla-inbound/rev/7d6a18652417
https://hg.mozilla.org/integration/mozilla-inbound/rev/192e65f2ddc2
https://hg.mozilla.org/integration/mozilla-inbound/rev/ec2415cfb538",UNCODED,0,UNMATCHED
1190676,23,"https://hg.mozilla.org/mozilla-central/rev/905d5f8b66c2
https://hg.mozilla.org/mozilla-central/rev/865b6a377448
https://hg.mozilla.org/mozilla-central/rev/1a303a9f74f8
https://hg.mozilla.org/mozilla-central/rev/23e4bbe07e4c
https://hg.mozilla.org/mozilla-central/rev/e9856dc51513
https://hg.mozilla.org/mozilla-central/rev/4d8264b7c691
https://hg.mozilla.org/mozilla-central/rev/47c3d22006d9
https://hg.mozilla.org/mozilla-central/rev/c944b51c50d7
https://hg.mozilla.org/mozilla-central/rev/58786af75f6a
https://hg.mozilla.org/mozilla-central/rev/7d6a18652417
https://hg.mozilla.org/mozilla-central/rev/192e65f2ddc2
https://hg.mozilla.org/mozilla-central/rev/ec2415cfb538",UNCODED,0,UNMATCHED
1191113,1,"Firefox Nightly 42.0a1 20140804 and Aurora 41.0a2
gcli's 'security csp' has a hardcoded English (non-localizable, should be) error message if no CSP is found: ""Could not find any 'Content-Security-Policy' for""",PROBLEM_DESCRIPTION,0,FULL_TEXT
1191113,2,"Created attachment 8643370
bug_1191113_csp_gcli_localization.patch
Ah, sorry I missed that. We should uplift that patch as well. I will prepare a patch for dev edition and beta.",CODE_IMPLEMENTATION,1,FULL_TEXT
1191113,3,"This patch hasn't made it yet to beta. As this would break string freeze on Aurora and is something normal users won't see, I recommend to wontfix it on that branch. NI flod for confirmation.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1191113,4,"""Content-Security-Policy for: <host>"" is also not localized:
   2.139 +          ""    <td> ${csp.header} for: <b>"" + uri + ""</b><br/><br/>"" +
Do you want a new bug for that?",QUESTION,0,FULL_TEXT
1191113,5,"While the final decision for uplift is up to release-drivers, I strongly advise against breaking string freeze in aurora and beta. 
Some exceptions might make sense at the beginning of the cycle, but it's better to live with an hard-coded string for one cycle than dealing with the noise we create by landing the string.
Also note that we're 5 days from merge day, so it's probably late for any patch to land on beta unless things are utterly broken.",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1191113,6,"Comment on attachment 8643370
bug_1191113_csp_gcli_localization.patch
Review of attachment 8643370:
-----------------------------------------------------------------
::: toolkit/devtools/gcli/commands/security.js
@@ +144,2 @@
This is an FYI, not a request for change:
You could also do:
    return context.createView({
      html:
        ""<table class='gcli-csp-detail' ... valign='top'>"" +
        ""  <tr>"" +
        ""    <td><img src='.../gcli_sec_bad.svg' .../> </td> "" +
        "" <td>${l10n.securityCSPNoCSPOnPage} ...</td>"" +
        ""  </tr>"" +
        ""</table>"",
      data: { l10n: l10n.propertyLookup }
    });
Using l10n.propertyLookup means you don't need to get the NO_CSP_ON_PAGE_MSG const",CODE_REVIEW,0,FULL_TOKEN
1191113,7,"Let me prepare a new patch including that change as well, no need for a new bug.",ANSWER_TO_QUESTION,0,FULL_TEXT
1191113,8,Thanks - I will incorporate that change in the next iteration of the devtool when we are going to extend the functionality of it.,CODE_REVIEW,0,FULL_TEXT
1191113,9,"Created attachment 8643787
bug_1191113_csp_gcli_localization2.patch
Joe, once r+ed I will fold that patch into the other one. Those are just the new changes on top.
I figured it makes sense to have a unified behavior whenever we encounter a CSP or not. For that reason, I also removed the "":"" after ""for:"".
Sorry I missed those hardcoded strings the first time around when we landed the devtool.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1191113,10,"Created attachment 8644419
bug_1191113_csp_gcli_localization.patch
Folded patches together into one. Carrying over r+ from jwalker.",CODE_IMPLEMENTATION,1,FULL_TEXT
1191113,11,"I am about to land some other patch, and this one might fit in quite nicely!",UNCODED,0,UNMATCHED
1191113,12,https://hg.mozilla.org/integration/mozilla-inbound/rev/2170e194fe60,UNCODED,0,UNMATCHED
1191113,13,https://hg.mozilla.org/mozilla-central/rev/2170e194fe60,UNCODED,0,UNMATCHED
1203871,1,"In e10s mode, ContentCache caches each character rect of composition string. For caching them, ContentCacheInChild dispatches eQueryTextRect for each character, in other words, it's dispatched 20 times if composition string have 20 characters.
If the start offset is big value and the focused editor is contenteditable, computing the offset is expensive, nevertheless, it's computed many times.
So, if we implement eQueryCharRectArray as retrieving each character rect in the specified range, we can reduce the cost of preparing to retrieve each character rect except the first one.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1203871,2,"If you'd like to steal this bug from me, feel free to do it ;-)",ASSIGNEE_REQUEST,0,FULL_TEXT
1203871,3,"roc:
Do you have some idea to retrieve each character rect from nsTextFrames quickly? It seems that current approach of eQueryTextRect which retrieves union rect of characters in specified range isn't useful for the new eQueryCharRectArray: http://mxr.mozilla.org/mozilla-central/source/dom/events/ContentEventHandler.cpp?rev=e22b3043887e#1296",INFO_REQUEST,0,FULL_TOKEN
1203871,4,"There's no direct API for this, but you could quite easily add a new nsTextFrame API similar to GetPointFromOffset that returns a set of rects.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1203871,5,Thanks. I'll check current nsTextFrame.,UNCODED,0,UNMATCHED
1203871,6,*** Bug 1067230 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1203871,7,"Using gfxTexRun, we can get width per character.  OK, I will take this",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1203871,8,https://treeherder.mozilla.org/#/jobs?repo=try&revision=66b36b32fd14,UNCODED,0,UNMATCHED
1203871,9,"How about make this a pointer to nsTArray? The array may be big and copied to another instance. If InitForQueryTextRectArray() takes a pointer to this, the caller can specify the dist or nsAutoTArray for avoiding memory fragmentation.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1203871,10,"sizeof(nsTArray<nsRect>) is always 8 bytes on 64bit platform and array data is allocated on heap.  Even if using pointer instead, allocated AutoTArray will be on heap.  So as memory fragmentation, it is same result. 
Can SetEventResult and WidgetQueryContentEvent use c++11 move?",SOLUTION_REVIEW,1,FULL_TOKEN
1203871,11,Thanks. Looks like nsTArray_Impl:: SwapElements() is useful.,SOLUTION_REVIEW,1,FULL_TEXT
1203871,12,"We can use mozilla::Move instead.  Also, I should mark this event is invalid after using it.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1203871,13,"Created attachment 8730638
Bug 1203871 - Part 1. Add nsIFrame::GetCharacterRectsInRange.
IME wants to need the width per character.  Now nsTextFrame/nsIFrmae has only API to get point of string.  So I want to add this method to calculate simply by comment #3.
If you cannot review this, please change reviewer.
Review commit: https://reviewboard.mozilla.org/r/40057/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/40057/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1203871,14,"Created attachment 8730639
Bug 1203871 - Part 2. Implement eQueryTextRectArray.
It will use on ContentCache.
Review commit: https://reviewboard.mozilla.org/r/40059/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/40059/",CODE_IMPLEMENTATION,1,FULL_TEXT
1203871,15,"Created attachment 8730640
Bug 1203871 - Part 3. Use eQueryTextRectArray on ContentCache for e10s.
Use new event to update cotent process's cache.
Review commit: https://reviewboard.mozilla.org/r/40061/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/40061/",CODE_IMPLEMENTATION,1,FULL_TEXT
1203871,16,"Created attachment 8730641
Bug 1203871 - Part 4. Implement QUERY_TEXT_RECT_ARRAY to nsIDOMWindowUtils for unit test.
To test eQueryCharRectArray, I would like to add it to nsIDOMWindowUtils.  Also this will require external keyboard support on Android.
Review commit: https://reviewboard.mozilla.org/r/40063/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/40063/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1203871,17,"Created attachment 8730642
Bug 1203871 - Part 5. Use mozilla::Move for rect array.
To optimize copy of text rect array, we should use mozilla::Move.  Also, after using it, we should mark is invalid result into SetEventResult
Review commit: https://reviewboard.mozilla.org/r/40065/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/40065/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1203871,18,"Comment on attachment 8730639
Bug 1203871 - Part 2. Implement eQueryTextRectArray.
https://reviewboard.mozilla.org/r/40059/#review36543
Anyway, it's okay to fix the optimization later.
::: dom/events/ContentEventHandler.cpp:1309
(Diff revision 1)
Hmm, SetRangeFromFlatTextOffset() is very expensive if offset is too large... If this can be optimized, I'd be happy though. But current code also wastes same amount about this, so, not problem for now.
(If we can retrieve character rects until the end of the frame, we can reduce this call, I guess.)
::: dom/events/ContentEventHandler.cpp:1330
(Diff revision 1)
So, I think that this should be GetCharacterRectsInRange(int32_t aOffset, int32_t aLenght, nsTArray<nsRect>& aRects). Then, offset can be increased with aRect.Length().
::: widget/EventMessageList.h:229
(Diff revision 1)
nit: s/qQueryTextRect/eQueryTextRect",CODE_REVIEW,0,FULL_TOKEN
1203871,19,"Comment on attachment 8730638
Bug 1203871 - Part 1. Add nsIFrame::GetCharacterRectsInRange.
https://reviewboard.mozilla.org/r/40057/#review36547
It seems fine to add this API, but I think the implementation could be cleaned up so as to share code with GetPointFromOffset rather than duplicating it.
::: layout/generic/nsFrame.cpp:6242
(Diff revision 1)
I guess returning a zero-sized rect is OK here, but wouldn't it make more sense to do the same thing as GetPointFromOffset to come up with a position? Maybe just call GetPointFromOffset to get the x,y coords, and then set width and height to zero. Or factor out a helper method?
::: layout/generic/nsTextFrame.cpp:7142
(Diff revision 1)
It seems like we should be able to share a lot of the code here with GetPointFromOffset. The two methods are basically doing the same thing, except that the CharacterRect version adds a lookahead to the next cluster so that it can get the advance.
Maybe factor out the body of GetPointFromOffset into a helper that GetCharacterRectFromOffset can also call, and then it just needs to do the extra work to get the extent of the rect. Or have a shared helper that returns a rect, and takes a flag telling it whether we want the full rect (position and size) or only its position, which would allow an early return.",CODE_REVIEW,0,FULL_TOKEN
1203871,20,"Comment on attachment 8730640
Bug 1203871 - Part 3. Use eQueryTextRectArray on ContentCache for e10s.
https://reviewboard.mozilla.org/r/40061/#review36833",UNCODED,0,UNMATCHED
1203871,21,"Comment on attachment 8730641
Bug 1203871 - Part 4. Implement QUERY_TEXT_RECT_ARRAY to nsIDOMWindowUtils for unit test.
https://reviewboard.mozilla.org/r/40063/#review36841
I think that this also needs sr of smaug because you changes *.idl.",CODE_REVIEW,0,FULL_TEXT
1203871,22,"Comment on attachment 8730642
Bug 1203871 - Part 5. Use mozilla::Move for rect array.
https://reviewboard.mozilla.org/r/40065/#review36847
::: dom/base/nsQueryContentEventResult.cpp:11
(Diff revision 1)
Move.h should be included before TextEvents.h (for a-z order). If you don't mind, could you move nsQueryContentEventResult.h after nsPoint.h?",CODE_REVIEW,0,FULL_TEXT
1203871,23,"Comment on attachment 8730638
Bug 1203871 - Part 1. Add nsIFrame::GetCharacterRectsInRange.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40057/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,24,"Comment on attachment 8730639
Bug 1203871 - Part 2. Implement eQueryTextRectArray.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40059/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,25,"Comment on attachment 8730640
Bug 1203871 - Part 3. Use eQueryTextRectArray on ContentCache for e10s.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40061/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,26,"Comment on attachment 8730641
Bug 1203871 - Part 4. Implement QUERY_TEXT_RECT_ARRAY to nsIDOMWindowUtils for unit test.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40063/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,27,"Comment on attachment 8730642
Bug 1203871 - Part 5. Use mozilla::Move for rect array.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40065/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,28,"Comment on attachment 8730639
Bug 1203871 - Part 2. Implement eQueryTextRectArray.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40059/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,29,"Comment on attachment 8730640
Bug 1203871 - Part 3. Use eQueryTextRectArray on ContentCache for e10s.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40061/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,30,"Comment on attachment 8730641
Bug 1203871 - Part 4. Implement QUERY_TEXT_RECT_ARRAY to nsIDOMWindowUtils for unit test.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40063/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,31,"Comment on attachment 8730642
Bug 1203871 - Part 5. Use mozilla::Move for rect array.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40065/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,32,"Comment on attachment 8730638
Bug 1203871 - Part 1. Add nsIFrame::GetCharacterRectsInRange.
https://reviewboard.mozilla.org/r/40057/#review56566
::: layout/generic/nsIFrame.h:1549
(Diff revision 2)
The comment here needs to be updated now that you're getting a list of character rects in a range, not just a rect for a single offset.
::: layout/generic/nsTextFrame.h:799
(Diff revision 2)
Please add a comment to clarify why aInOffset is passed as a reference here (as it seems unexpected); looks like it's being clamped to the content range by this method.
It would be nice to pass aProperties as a const reference, so it's clearly an inparam only. I guess to do that, you'd need to pull the InitializeForDisplay() call out of this method and let the caller do it.
Also, the ""Get..."" name seems a bit wrong, as the iterator was already created, this method is just changing its position. Maybe something like ""UpdateIteratorForOffset""? And reorder the params so that aIter (the outparam result) is last, please.
::: layout/generic/nsTextFrame.h:802
(Diff revision 2)
Here as well, I think aIter and aProperties should both be const references. And the point can be returned as the function result rather than through an outParam.",CODE_REVIEW,0,FULL_TOKEN
1203871,33,"Comment on attachment 8730641
Bug 1203871 - Part 4. Implement QUERY_TEXT_RECT_ARRAY to nsIDOMWindowUtils for unit test.
https://reviewboard.mozilla.org/r/40063/#review56648
::: dom/base/nsQueryContentEventResult.cpp:160
(Diff revision 3)
nit, extra space before * in 'int32_t * aLeft'",CODE_REVIEW,0,FULL_TEXT
1203871,34,"https://reviewboard.mozilla.org/r/40057/#review56566
OK, but, although gfxTextRun::GetAdvanceWidth cannot be set as const function, we cannot use const aPropertyProvider on parameter.",CODE_REVIEW,0,FULL_TEXT
1203871,35,"Comment on attachment 8730638
Bug 1203871 - Part 1. Add nsIFrame::GetCharacterRectsInRange.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40057/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,36,"Comment on attachment 8730639
Bug 1203871 - Part 2. Implement eQueryTextRectArray.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40059/diff/3-4/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,37,"Comment on attachment 8730640
Bug 1203871 - Part 3. Use eQueryTextRectArray on ContentCache for e10s.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40061/diff/3-4/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,38,"Comment on attachment 8730641
Bug 1203871 - Part 4. Implement QUERY_TEXT_RECT_ARRAY to nsIDOMWindowUtils for unit test.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40063/diff/3-4/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,39,"Comment on attachment 8730642
Bug 1203871 - Part 5. Use mozilla::Move for rect array.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/40065/diff/3-4/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1203871,40,"Hmm, that's too bad. It really should be a const method, but it looks like doing that would involve pushing the const-ness down through various subsidiary methods, and eventually providing both const and non-const variants of the GetCharacterGlyphs() accessor.
I think that would be a good thing to do, but it turns into a big enough change that it's probably best done in a separate bug. I've filed bug 1282248 for this. With that, can we use more const here as well?",NEW_ISSUE_FILING,0,FULL_TEXT
1203871,41,"Humm..  It cannot...
To use const as parameter, PropertyProvider::GetSpacing(...) must be const function.  But PropertyProvider::GetSpacingInternal() wants to update mTabWidths on PropertyProvider::CalcTabWidths() and CalcTabWidths() adds tab width data to mFrame....",CODE_REVIEW,0,FULL_TOKEN
1203871,42,"OK, I guess we'll have to leave that -- thanks for looking into it.",UNCODED,0,UNMATCHED
1203871,43,"Comment on attachment 8730638
Bug 1203871 - Part 1. Add nsIFrame::GetCharacterRectsInRange.
https://reviewboard.mozilla.org/r/40057/#review57828",UNCODED,0,UNMATCHED
1203871,44,"Pushed by m_kato@ga2.so-net.ne.jp:
https://hg.mozilla.org/integration/mozilla-inbound/rev/a1b865bc98fb
Part 1. Add nsIFrame::GetCharacterRectsInRange. r=jfkthame
https://hg.mozilla.org/integration/mozilla-inbound/rev/eeadf50643fe
Part 2. Implement eQueryTextRectArray. r=masayuki
https://hg.mozilla.org/integration/mozilla-inbound/rev/894a2784d498
Part 3. Use eQueryTextRectArray on ContentCache for e10s. r=masayuki
https://hg.mozilla.org/integration/mozilla-inbound/rev/d654463ad5fa
Part 4. Implement QUERY_TEXT_RECT_ARRAY to nsIDOMWindowUtils for unit test. r=masayuki,smaug
https://hg.mozilla.org/integration/mozilla-inbound/rev/99635fa90e92
Part 5. Use mozilla::Move for rect array. r=masayuki",UNCODED,0,UNMATCHED
1203871,45,"https://hg.mozilla.org/mozilla-central/rev/a1b865bc98fb
https://hg.mozilla.org/mozilla-central/rev/eeadf50643fe
https://hg.mozilla.org/mozilla-central/rev/894a2784d498
https://hg.mozilla.org/mozilla-central/rev/d654463ad5fa
https://hg.mozilla.org/mozilla-central/rev/99635fa90e92",UNCODED,0,UNMATCHED
1207931,1,"RenderFrameParent::mBackgroundColor can be set via SetBackgroundColor(), but
the value is never read. So that means TabParent::RecvSetBackgroundColor() is a
no-op.
billm, is this expected? It seems weird to me. Though maybe this message
doesn't matter and can be excised on both the child and the parent sides.",PROBLEM_REVIEW,0,FULL_TOKEN
1207931,2,"Created attachment 8665264
RenderFrameParent::mBackgroundColor is unused
Patch demonstrating the situation.",CODE_IMPLEMENTATION,1,FULL_TEXT
1207931,3,That's really more of a layout question than an IPC one.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1207931,4,It looks like the use of the variable was added in bug 694706 and removed in bug 1056427. Just a bit of dead code that was missed. So I think it is okay to remove the message.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1207931,5,"Yeah, I think we can get rid of this entirely.",SOLUTION_REVIEW,1,FULL_TEXT
1207931,6,"Created attachment 8665743
Remove no-longer-needed SetBackgroundColor IPC message
This seems to work.",CODE_IMPLEMENTATION,1,FULL_TEXT
1207931,7,"Comment on attachment 8665743
Remove no-longer-needed SetBackgroundColor IPC message
Review of attachment 8665743:
-----------------------------------------------------------------
::: layout/base/nsPresShell.cpp
@@ -5292,5 @@
Nice. This is the code that was fixed in bug 1199534 because it was spamming messages constantly. Turns out it wasn't needed at all!",CODE_REVIEW,0,FULL_TEXT
1207931,8,https://hg.mozilla.org/integration/mozilla-inbound/rev/22e54267e6c9,UNCODED,0,UNMATCHED
1207931,9,https://hg.mozilla.org/mozilla-central/rev/22e54267e6c9,UNCODED,0,UNMATCHED
1209952,1,"Created attachment 8667880
Crash test case
User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/537.78.2 (KHTML, like Gecko) Version/6.1.6 Safari/537.78.2
Steps to reproduce:
Am using asan-build from https://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-central-linux64-asan/1443610148/ on Ubuntu 14.04 x64
Please note that this crashes latest firefox on OS X and Windows as well but feel free to remove the security restrictions since it's a use-after-poison.
Actual results:
Opening the test case yields:
==52781==ERROR: AddressSanitizer: use-after-poison on address 0x6250002a1118 at pc 0x7f2062625d2a bp 0x7fff94e3ab20 sp 0x7fff94e3ab18
READ of size 8 at 0x6250002a1118 thread T0 (Web Content)
    #0 0x7f2062625d29 in nsIFrame::StyleDisplay() const /builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/html/../../dist/include/nsStyleStructList.h:101
    #1 0x7f20641c3196 in nsFloatManager::GetFlowArea(mozilla::WritingMode, int, nsFloatManager::BandInfoType, int, mozilla::LogicalRect, nsFloatManager::SavedState*, nsSize const&) const /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsFloatManager.cpp:219
    #2 0x7f206416fe91 in GetFloatAvailableSpaceWithState /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowState.cpp:350
    #3 0x7f206416fe91 in GetFloatAvailableSpace /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowState.h:60
    #4 0x7f206416fe91 in nsBlockReflowState::AddFloat(nsLineLayout*, nsIFrame*, int) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowState.cpp:633
    #5 0x7f20640ea8f2 in GetOutermostLineLayout /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsLineLayout.h:186
    #6 0x7f20640ea8f2 in nsLineLayout::ReflowFrame(nsIFrame*, unsigned int&, nsHTMLReflowMetrics*, bool&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsLineLayout.cpp:999
    #7 0x7f2064154201 in nsBlockFrame::ReflowInlineFrame(nsBlockReflowState&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:4035
    #8 0x7f2064152a0d in nsBlockFrame::DoReflowInlineFrames(nsBlockReflowState&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3837
    #9 0x7f20641491d2 in nsBlockFrame::ReflowInlineFrames(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3703
    #10 0x7f2064139591 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2712
    #11 0x7f2064139591 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #12 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #13 0x7f206414fe47 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowContext.cpp:306
    #14 0x7f2064145bad in nsBlockFrame::ReflowBlockFrame(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3348
    #15 0x7f20641395b3 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2709
    #16 0x7f20641395b3 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #17 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #18 0x7f206419e1d1 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsContainerFrame.cpp:998
    #19 0x7f2064188514 in nsColumnSetFrame::ReflowChildren(nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&, nsColumnSetFrame::ReflowConfig const&, bool, nsCollapsingMargin*, nsColumnSetFrame::ColumnBalanceData&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:638
    #20 0x7f206418c4bb in ReflowColumns /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:344
    #21 0x7f206418c4bb in nsColumnSetFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:1075
    #22 0x7f206414fe47 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowContext.cpp:306
    #23 0x7f2064145bad in nsBlockFrame::ReflowBlockFrame(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3348
    #24 0x7f20641395b3 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2709
    #25 0x7f20641395b3 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #26 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #27 0x7f206419e1d1 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsContainerFrame.cpp:998
    #28 0x7f2064188514 in nsColumnSetFrame::ReflowChildren(nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&, nsColumnSetFrame::ReflowConfig const&, bool, nsCollapsingMargin*, nsColumnSetFrame::ColumnBalanceData&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:638
    #29 0x7f206418c4bb in ReflowColumns /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:344
    #30 0x7f206418c4bb in nsColumnSetFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:1075
    #31 0x7f206414fe47 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowContext.cpp:306
    #32 0x7f2064145bad in nsBlockFrame::ReflowBlockFrame(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3348
    #33 0x7f20641395b3 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2709
    #34 0x7f20641395b3 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #35 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #36 0x7f206414fe47 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowContext.cpp:306
    #37 0x7f2064145bad in nsBlockFrame::ReflowBlockFrame(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3348
    #38 0x7f20641395b3 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2709
    #39 0x7f20641395b3 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #40 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #41 0x7f206419e1d1 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsContainerFrame.cpp:998
    #42 0x7f2064183839 in nsCanvasFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsCanvasFrame.cpp:685
    #43 0x7f206422c700 in ReflowChild /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsContainerFrame.cpp:998
    #44 0x7f206422c700 in nsHTMLScrollFrame::ReflowScrolledFrame(ScrollReflowState*, bool, bool, nsHTMLReflowMetrics*, bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsGfxScrollFrame.cpp:524
    #45 0x7f206422db89 in nsHTMLScrollFrame::ReflowContents(ScrollReflowState*, nsHTMLReflowMetrics const&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsGfxScrollFrame.cpp:636
    #46 0x7f206422ff46 in nsHTMLScrollFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsGfxScrollFrame.cpp:871
    #47 0x7f206419e58e in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, int, int, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsContainerFrame.cpp:1040
    #48 0x7f20643acf0f in ViewportFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsViewportFrame.cpp:215
    #49 0x7f206408eace in PresShell::DoReflow(nsIFrame*, bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsPresShell.cpp:9070
    #50 0x7f20640a24f8 in PresShell::ProcessReflowCommands(bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsPresShell.cpp:9242
    #51 0x7f20640a1a4a in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsPresShell.cpp:4137
    #52 0x7f2063ff648b in nsDocumentViewer::LoadComplete(nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsDocumentViewer.cpp:932
    #53 0x7f2064c59cbf in nsDocShell::EndPageLoad(nsIWebProgress*, nsIChannel*, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/docshell/base/nsDocShell.cpp:7366
    #54 0x7f2064c56333 in nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/docshell/base/nsDocShell.cpp:7185
    #55 0x7f2064c5cddf in non-virtual thunk to nsDocShell::OnStateChange(nsIWebProgress*, nsIRequest*, unsigned int, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/docshell/base/Unified_cpp_docshell_base0.cpp:7192
    #56 0x7f205f67aecb in nsDocLoader::DoFireOnStateChange(nsIWebProgress*, nsIRequest*, int&, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/uriloader/base/nsDocLoader.cpp:1250
    #57 0x7f205f67a1b3 in nsDocLoader::doStopDocumentLoad(nsIRequest*, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/uriloader/base/nsDocLoader.cpp:831
    #58 0x7f205f6773bf in nsDocLoader::DocLoaderIsEmpty(bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/uriloader/base/nsDocLoader.cpp:721
    #59 0x7f205f679143 in nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/uriloader/base/nsDocLoader.cpp:605
    #60 0x7f205f679b7c in non-virtual thunk to nsDocLoader::OnStopRequest(nsIRequest*, nsISupports*, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/uriloader/base/Unified_cpp_uriloader_base0.cpp:609
    #61 0x7f205e007079 in nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /builds/slave/m-cen-l64-asan-000000000000000/build/src/netwerk/base/nsLoadGroup.cpp:640
    #62 0x7f206035a4cc in nsDocument::DoUnblockOnload() /builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/base/nsDocument.cpp:9068
    #63 0x7f206035a16e in nsDocument::UnblockOnload(bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/base/nsDocument.cpp:8996
    #64 0x7f206032dc10 in nsDocument::DispatchContentLoadedEvents() /builds/slave/m-cen-l64-asan-000000000000000/build/src/dom/base/nsDocument.cpp:5163
    #65 0x7f20603f46e0 in apply<nsDocument, void (nsDocument::*)()> /builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/base/../../dist/include/nsThreadUtils.h:661
    #66 0x7f20603f46e0 in nsRunnableMethodImpl<void (nsDocument::*)(), true>::Run() /builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/base/../../dist/include/nsThreadUtils.h:868
    #67 0x7f205de5975f in nsThread::ProcessNextEvent(bool, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/xpcom/threads/nsThread.cpp:960
    #68 0x7f205ded281a in NS_ProcessNextEvent(nsIThread*, bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/xpcom/glue/nsThreadUtils.cpp:277
    #69 0x7f205e7705e9 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/glue/MessagePump.cpp:95
    #70 0x7f205e6de4ec in RunInternal /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #71 0x7f205e6de4ec in RunHandler /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #72 0x7f205e6de4ec in MessageLoop::Run() /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #73 0x7f20637aa807 in nsBaseAppShell::Run() /builds/slave/m-cen-l64-asan-000000000000000/build/src/widget/nsBaseAppShell.cpp:156
    #74 0x7f20655fa3e2 in XRE_RunAppShell /builds/slave/m-cen-l64-asan-000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:785
    #75 0x7f205e6de4ec in RunInternal /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #76 0x7f205e6de4ec in RunHandler /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #77 0x7f205e6de4ec in MessageLoop::Run() /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #78 0x7f20655f9acc in XRE_InitChildProcess /builds/slave/m-cen-l64-asan-000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:621
    #79 0x48d670 in content_process_main(int, char**) /builds/slave/m-cen-l64-asan-000000000000000/build/src/ipc/app/../contentproc/plugin-container.cpp:237
    #80 0x7f205b809ec4 in __libc_start_main /build/buildd/eglibc-2.19/csu/libc-start.c:287
    #81 0x48c9cc in _start (/home/symeon/Desktop/firefox/plugin-container+0x48c9cc)
0x6250002a1118 is located 2072 bytes inside of 8192-byte region [0x6250002a0900,0x6250002a2900)
allocated by thread T0 (Web Content) here:
    #0 0x474fe1 in __interceptor_malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:74
    #1 0x7f206b70de86 in PL_ArenaAllocate /builds/slave/m-cen-l64-asan-000000000000000/build/src/nsprpub/lib/ds/plarena.c:203
    #2 0x7f2063dd8535 in nsPresArena::Allocate(unsigned int, unsigned long) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/base/nsPresArena.cpp:165
    #3 0x7f2063d0d2e5 in AllocateByObjectID /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/style/../base/nsPresArena.h:65
    #4 0x7f2063d0d2e5 in PresShell /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/style/../base/nsIPresShell.h:255
    #5 0x7f2063d0d2e5 in operator new /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/style/nsStyleStruct.h:1362
    #6 0x7f2063d0d2e5 in nsRuleNode::ComputePositionData(void*, nsRuleData const*, nsStyleContext*, nsRuleNode*, nsRuleNode::RuleDetail, mozilla::RuleNodeCacheConditions) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/style/nsRuleNode.cpp:7619
    #7 0x7f2063ce8df3 in nsRuleNode::WalkRuleTree(nsStyleStructID, nsStyleContext*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/style/nsRuleNode.cpp:2407
    #8 0x7f206419d8d8 in StylePosition /builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/layout/generic/../../dist/include/nsStyleStructList.h:90
    #9 0x7f206419d8d8 in nsContainerFrame::ComputeAutoSize(nsRenderingContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsContainerFrame.cpp:912
    #10 0x7f20641a8906 in nsFrame::ComputeSize(nsRenderingContext*, mozilla::WritingMode, mozilla::LogicalSize const&, int, mozilla::LogicalSize const&, mozilla::LogicalSize const&, mozilla::LogicalSize const&, nsIFrame::ComputeSizeFlags) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsFrame.cpp:4266
    #11 0x7f2064170d77 in FloatMarginISize(nsHTMLReflowState const&, int, nsIFrame*, nsCSSOffsetState const&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowState.cpp:688
    #12 0x7f2064161c4a in nsBlockReflowState::FlowAndPlaceFloat(nsIFrame*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowState.cpp:754
    #13 0x7f206416fca6 in nsBlockReflowState::AddFloat(nsLineLayout*, nsIFrame*, int) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowState.cpp:629
    #14 0x7f20640ea8f2 in GetOutermostLineLayout /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsLineLayout.h:186
    #15 0x7f20640ea8f2 in nsLineLayout::ReflowFrame(nsIFrame*, unsigned int&, nsHTMLReflowMetrics*, bool&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsLineLayout.cpp:999
    #16 0x7f2064154201 in nsBlockFrame::ReflowInlineFrame(nsBlockReflowState&, nsLineLayout&, nsLineList_iterator, nsIFrame*, LineReflowStatus*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:4035
    #17 0x7f2064152a0d in nsBlockFrame::DoReflowInlineFrames(nsBlockReflowState&, nsLineLayout&, nsLineList_iterator, nsFlowAreaRect&, int&, nsFloatManager::SavedState*, bool*, LineReflowStatus*, bool) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3837
    #18 0x7f20641491d2 in nsBlockFrame::ReflowInlineFrames(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3703
    #19 0x7f2064139591 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2712
    #20 0x7f2064139591 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #21 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #22 0x7f206414fe47 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowContext.cpp:306
    #23 0x7f2064145bad in nsBlockFrame::ReflowBlockFrame(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3348
    #24 0x7f20641395b3 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2709
    #25 0x7f20641395b3 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #26 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #27 0x7f206419e1d1 in nsContainerFrame::ReflowChild(nsIFrame*, nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, mozilla::WritingMode const&, mozilla::LogicalPoint const&, nsSize const&, unsigned int, unsigned int&, nsOverflowContinuationTracker*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsContainerFrame.cpp:998
    #28 0x7f2064188514 in nsColumnSetFrame::ReflowChildren(nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&, nsColumnSetFrame::ReflowConfig const&, bool, nsCollapsingMargin*, nsColumnSetFrame::ColumnBalanceData&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:638
    #29 0x7f206418c4bb in ReflowColumns /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:344
    #30 0x7f206418c4bb in nsColumnSetFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsColumnSetFrame.cpp:1075
    #31 0x7f206414fe47 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowContext.cpp:306
    #32 0x7f2064145bad in nsBlockFrame::ReflowBlockFrame(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3348
    #33 0x7f20641395b3 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2709
    #34 0x7f20641395b3 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
    #35 0x7f2064131fc8 in nsBlockFrame::Reflow(nsPresContext*, nsHTMLReflowMetrics&, nsHTMLReflowState const&, unsigned int&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:1160
    #36 0x7f206414fe47 in nsBlockReflowContext::ReflowBlock(mozilla::LogicalRect const&, bool, nsCollapsingMargin&, int, bool, nsLineBox*, nsHTMLReflowState&, unsigned int&, nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockReflowContext.cpp:306
    #37 0x7f2064145bad in nsBlockFrame::ReflowBlockFrame(nsBlockReflowState&, nsLineList_iterator, bool*) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:3348
    #38 0x7f20641395b3 in ReflowLine /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2709
    #39 0x7f20641395b3 in nsBlockFrame::ReflowDirtyLines(nsBlockReflowState&) /builds/slave/m-cen-l64-asan-000000000000000/build/src/layout/generic/nsBlockFrame.cpp:2247
SUMMARY: AddressSanitizer: use-after-poison /builds/slave/m-cen-l64-asan-000000000000000/build/src/obj-firefox/dom/html/../../dist/include/nsStyleStructList.h:101 nsIFrame::StyleDisplay() const
Shadow bytes around the buggy address:
  0x0c4a8004c1d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a8004c1e0: 00 00 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7
  0x0c4a8004c1f0: f7 f7 f7 f7 f7 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a8004c200: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a8004c210: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 f7
=>0x0c4a8004c220: f7 f7 f7[f7]f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7
  0x0c4a8004c230: f7 f7 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a8004c240: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c4a8004c250: 00 00 00 00 00 00 00 00 00 00 f7 f7 f7 f7 f7 f7
  0x0c4a8004c260: f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7
  0x0c4a8004c270: f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7 f7
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Heap right redzone:      fb
  Freed heap region:       fd
  Stack left redzone:    
  ==52781==ABORTING
Am attaching the test case",STACK_TRACE,0,FULL_TOKEN
1209952,2,"Possibly the same underlying issue as bug 942794?
(updating my ASAN tree now to take a look...)",QUESTION,0,FULL_TOKEN
1209952,3,"I don't think ASAN is needed to reproduce this -- ASAN just gives a more friendly crash message.  But since this is a crash-on-poison, we should crash in the same way regardless of ASAN-ness.
In a debug build, I get this output before crashing:
nsBlockReflowContext: Block(div)(1)@7f7743963ea0 metrics=1073741824,6000!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(3)@7f7743964000 metrics=1073741824,6000!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(1)@7f7743964c10 metrics=1073741824,5400!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(1)@7f77439663d0 metrics=1073741824,6000!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(1)@7f77439665b8 metrics=1073741824,0!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(1)@7f77439665b8 metrics=1073741824,0!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(1)@7f7743966028 metrics=1073741824,6000!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(3)@7f7743964000 metrics=1073741824,6000!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(1)@7f77439665b8 metrics=1073741824,0!
[Child 6240] ###!!! ASSERTION: letter frames and orthogonal floats with auto block-size shouldn't break, and if they do now, then they're breaking at the wrong point: 'NS_FRAME_IS_COMPLETE(reflowStatus)', file /layout/generic/nsBlockReflowState.cpp, line 778
nsBlockReflowContext: Block(div)(1)@7f7743966cc8 metrics=1073741824,2400!
nsBlockReflowContext: Block(div)(3)@7f7743964000 metrics=1073741824,14400!
nsBlockReflowContext: Block(div)(1)@7f77439665b8 metrics=1073741824,3000!
nsBlockReflowContext: Block(div)(1)@7f7743964c10 metrics=1073741824,14400!
And then I crash, in  nsFloatManager::GetFlowArea calling into nsIFrame::StyleDisplay, on a poisoned nsIFrame object. The frame looks like this:
 p/x *fi.mFrame
$6 = {
  <nsQueryFrame> = {
    _vptr$nsQueryFrame = 0x7ffffffff0dea7ff
  }, 
  members of nsIFrame: 
  static kFrameIID = 0x28, 
  static kPrincipalList = 0x1,
  [...] 
  mContent = 0x7ffffffff0dea7ff, 
  mStyleContext = 0x7ffffffff0dea7ff, 
  mParent = 0x7ffffffff0dea7ff, 
  mNextSibling = 0x7ffffffff0dea7ff, 
  mPrevSibling = 0x7ffffffff0dea7ff, 
  mState = 0x7ffffffff0dea7ff, 
  [...]
}
Looks like all of the pointer-values are poison addresses (and we're crashing when we try to deref one of them, mStyleContext). So, I think this is successfully mitigated by frame poisoning.",STACK_TRACE,0,FULL_TOKEN
1209952,4,"Seems like a good bet -- the underlying issue there was bug 913162, which seems related to the testcase here.",ANSWER_TO_QUESTION,0,FULL_TEXT
1209952,5,Our fuzzers are still seeing this issue.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1209952,6,"Created attachment 9047923
multicol-float.html
I've attached a simplified testcase. Actually the cause is the violation of pushed-float invariant in `nsColumnSetFrame`. 
Under certain cases, it will reflow the content with a smaller height constraint when a bigger one has already overflowed. If the previous failure has pushed some float, then a smaller height constraint could make the prev-in-flow of those pushed floats overflow, thus violates the invariant of pushed-float.
I will submit a patch.",TEST_CASES,0,95_PCT_MATCH_PROCESSED
1209952,7,"Created attachment 9047943
Bug 1209952 - Ensure a smaller BSize won't be tried when previous one is already infeasible
If a BSize is already infeasible, we should not try a smaller size. Because if
the previous failure leaves some pushed floats, a smaller try might make
the prev-in-flow of the pushed float overflow, which violates the invariant of
pushed float and may cause use-after-free and crash.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1209952,8,"Hi Mats,
I'm not sure whether you're the correct person to review this patch, I set the reviewer to you because I found multiple comments from you in `layout/generic` code.
Could you assign this bug to me and review my patch? In case I got the reviewer wrong, could you forward the patch to a correct reviewer?
Thanks!",CODE_REVIEW_REQUEST,0,FULL_TOKEN
1209952,9,"Violet, maybe you should apply for Level 1 Commit Access so you can push to Try yourself?
https://wiki.mozilla.org/ReleaseEngineering/TryServer",QUESTION,0,FULL_TOKEN
1209952,10,"Ok, I will file a request for level 1 access and run the test before submitting. I've just read the instruction page, it says I need a voucher to apply, would you vouch for me?
Regarding the bug, I'm not sure whether I have explained the root cause clearly on that page. A step-by-step explanation might be very lengthy, but the timeline can be quickly figured out by running `$ MOZ_LOG=ColumnSet:4 ./mach run` with some `printf` to track `nsBlockFrame::Reflow`, `nsBlockFrame::SplitFloat`, etc.
The oddity emerges when the bsize constraint goes from 40 to 19, just a few log messages before crash happens.",CLARIFICATION,0,FULL_TOKEN
1209952,11,"Sure.  CC me on the bug.
I can't really review any changes unless I think I have a clear understanding what the problem is first.  I can debug it myself of course but that may take some time.",CLARIFICATION,0,FULL_TOKEN
1209952,12,"The machine I use to debug firefox has some problems, so I need time to fix them before applying for try server access.
So I think it would be better to submit the update that I already tested a few days ago. Would you test it on the try server and review the change? Thanks!",STATUS_UPDATE,0,FULL_TOKEN
1209952,13,"Well, it passed tests on Linux at least:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=6ffdbe718e26c854bd4ad98b2d15e602453359a8
As I said earlier, I'm not going to review this until I understand
what goes wrong in the frame tree with our current code.  It would
help if you can try to explain it to me, otherwise I'll have to
debug it myself.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1209952,14,"Ok, I will explain the oddity in the `nsColumnSetFrame` with a further reduced testcase by dropping the surrounding `div` around `dev.float-L` which causes an assertion failure (see my explanation in a comment on phabricator). So the testcase would be:
    <div class=""multicol-b"">
      <div class=""step""></div>
      <div class=""float-L""></div>
    </div>
* 1px=60 logical unit. Both `.step` and `.float-L` have 1px height, thus it's totally 2px=120. And we need at least 40 BSize to place it in 3 columns (120 = 40 * 3).
* At the beginning of the log, it's the outer multicol `.multicol-a` relowing the child #0 with `availBSize=1699`, `float-R` consumes 26px=1560, while the inner multicol has 1px border, which consumes 2*1px=120. So the `availableContentBSize` for the inner one only remains `1699 - 1560 - 120 = 19`. But because of the lack of a `std::min` in initialization, it tries to reflow `40`.
* see the inline comments in the log
    // outer reflows child #0
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowing child #0 0x7fe0ef551be8: availBSize=1699
    [00000003] nsBlockFrame:0x7fe0ef551be8 Reflow
    // .float-R reflows
    [00000004] nsBlockFrame:0x7fe0ef551d38 Reflow
    [00000004] nsBlockFrame:0x7fe0ef551d38 Reflow done
    // inner reflows
    [Child 8618: Main Thread]: D/ColumnSet ChooseColumnStrategy: numColumns=3, colISize=4000, expectedISizeLeftOver=0, colBSize=40, colGap=0
    // at this point, we only have 19 available, why try `mColMaxBSize=40`? To exceed 19 is pointless
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Doing column reflow pass: mLastBalanceBSize=40, mColMaxBSize=40, RTL=0, mBalanceColCount=3, mColISize=4000, mColGap=0
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowing child #0 0x7fe0ef551df0: availBSize=40
    [00000004] nsBlockFrame:0x7fe0ef551df0 Reflow
    [00000005] nsBlockFrame:0x7fe0ef551f40 Reflow
    [00000005] nsBlockFrame:0x7fe0ef551f40 Reflow done
    [00000004] nsBlockFrame:0x7fe0ef551df0 Reflow done
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowed child #0 0x7fe0ef551df0: status=[Complete=N,NIF=Y,Truncated=N,Break=N,FirstLetter=N], desiredSize=(4000,40), CarriedOutBEndMargin=0 (ignored)
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Next childOrigin.iCoord=4060
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowing child #1 0x7fe0ef552398: availBSize=40
    [00000004] nsBlockFrame:0x7fe0ef552398 Reflow
    [00000005] nsBlockFrame:0x7fe0ef552450 Reflow
    [00000005] nsBlockFrame:0x7fe0ef552450 Reflow done
    [00000005] nsBlockFrame:0x7fe0ef551ff8 Reflow
    [00000005] nsBlockFrame:0x7fe0ef551ff8 Reflow done
    [00000004] nsBlockFrame 0x7fe0ef552398 SplitFloat 0x7fe0ef551ff8 -> 0x7fe0ef5522d0
    [00000004] nsBlockFrame:0x7fe0ef552398 Reflow done
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowed child #1 0x7fe0ef552398: status=[Complete=O,NIF=Y,Truncated=N,Break=N,FirstLetter=N], desiredSize=(4000,40), CarriedOutBEndMargin=0 (ignored)
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Next childOrigin.iCoord=8060
    // Why inconsistent height? Both child #0 and #1 have 40, #2 only has 19?
    // That's because https://github.com/mozilla/gecko-dev/blob/master/layout/generic/nsColumnSetFrame.cpp#L712
    // the last column is unbounded, thus it takes all avail size, which is 19, which is **smaller** than the previous columns.
    // Now we take a look at float splitting state. 60+60 should be split into 3 column, thus (40)+(20+20)+(40),
    // So there is already a split for 60 -> 20 + 40.
    // An unfortunate consequence of the oddity here is that the 40 is further split into 40 -> 19 + 21, then
    // 21 is pushed to child#2 as a pushed-float, see splitting `->` below.
    // After this reflow, we end up with split float `1ff8`, `22d0`, `2790`
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowing child #2 0x7fe0ef552558: availBSize=19
    [00000004] nsBlockFrame:0x7fe0ef552558 Reflow
    [00000005] nsBlockFrame:0x7fe0ef5522d0 Reflow
    [00000005] nsBlockFrame:0x7fe0ef5522d0 Reflow done
->  [00000004] nsBlockFrame 0x7fe0ef552558 SplitFloat 0x7fe0ef5522d0 -> 0x7fe0ef552790
    [00000004] nsBlockFrame:0x7fe0ef552558 Reflow done
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowed child #2 0x7fe0ef552558: status=[Complete=O,NIF=Y,Truncated=N,Break=N,FirstLetter=N], desiredSize=(4000,19), CarriedOutBEndMargin=0 (ignored)
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Done column reflow pass: Infeasible :(
    // Now it ends with an infeasible state, we arrive at https://github.com/mozilla/gecko-dev/blob/master/layout/generic/nsColumnSetFrame.cpp#L1111
    // Then we reflow at 19 since it's the available size. But we shouldn't have tried 40 in the first place
    [Child 8618: Main Thread]: D/ColumnSet FindBestBalanceBSize: KnownInfeasibleBSize=40, KnownFeasibleBSize=40
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Doing column reflow pass: mLastBalanceBSize=40, mColMaxBSize=19, RTL=0, mBalanceColCount=3, mColISize=4000, mColGap=0
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowing child #0 0x7fe0ef551df0: availBSize=19
    [00000004] nsBlockFrame:0x7fe0ef551df0 Reflow
    [00000005] nsBlockFrame:0x7fe0ef551f40 Reflow
    [00000005] nsBlockFrame:0x7fe0ef551f40 Reflow done
    [00000004] nsBlockFrame:0x7fe0ef551df0 Reflow done
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowed child #0 0x7fe0ef551df0: status=[Complete=N,NIF=Y,Truncated=N,Break=N,FirstLetter=N], desiredSize=(4000,19), CarriedOutBEndMargin=0 (ignored)
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Next childOrigin.iCoord=4060
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowing child #1 0x7fe0ef552398: availBSize=19
    [00000004] nsBlockFrame:0x7fe0ef552398 Reflow
    [00000005] nsBlockFrame:0x7fe0ef552450 Reflow
    [00000005] nsBlockFrame:0x7fe0ef552450 Reflow done
    [00000004] nsBlockFrame:0x7fe0ef552398 Reflow done
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowed child #1 0x7fe0ef552398: status=[Complete=N,NIF=Y,Truncated=N,Break=N,FirstLetter=N], desiredSize=(4000,19), CarriedOutBEndMargin=0 (ignored)
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Next childOrigin.iCoord=8060
    // first 2 children only consume 19+19=38 height, thus the first split float `1ff8` is entirely overflow in child#1,
    // child#2 drains it, but one of the split float (`2790`) in its next-in-flow chain is still in child#2's pushed-float list.
    [Child 8618: Main Thread]: D/ColumnSet ReflowChildren: Reflowing child #2 0x7fe0ef552558: availBSize=19
    [00000004] nsBlockFrame:0x7fe0ef552558 Reflow
    [00000004] nsBlockFrame:0x7fe0ef552558 DrainOverflowLines 0x7fe0ef551ff8  <- this one, overflow from child #1
    [00000004] nsBlockFrame:0x7fe0ef552558 DrainOverflowLines: nif=0x7fe0ef5522d0
    [00000004] nsBlockFrame:0x7fe0ef552558 DrainOverflowLines: nif=0x7fe0ef552790  <- this one, the third split float still in pushed float list of child#2, which violates assertion.
    Assertion failure: mFloats.ContainsFrame(nif), at layout/generic/nsBlockFrame.cpp:4756
* Conclusion: we should not try a size that is greater than `availableContentBSize` in the first place, it's a wasted computation at best. It will also make some previously overflow-but-not-drained frames hanging around to do bad things.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1209952,15,"My updated patch is to address this problem. As a note, the original code will theoretically produce a wrong layout. Suppose we have `118` content to lay out in 3 columns, with an `availableContentBSize` 39 after a previously successful reflow (in order to have `mLastBalanceBSize=40` so that the first try will start at 40). Then with original code it will be `118 = 40 + 40 + 38` with a feasible state. But the correct layout should respect the constraint and produce `118 = 39 + 39 + 39`, with 1 overflow. This is quite theoretical, since a couple of logical unit can hardly have visible effect.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1209952,16,"Hi Mats,
It's just a kind reminder that this patch I submitted half a month a ago is waiting for your review. I've already explained the timeline of this bug with logging message in a previous comment.
Could you review this patch now? Or if you don't have time, could point me to someone who is also eligible to review this patch? I'm afraid I would probably forget some of the detail in the bug if it takes too long.",CODE_REVIEW_REQUEST,0,FULL_TOKEN
1209952,17,"Sorry for the delay, some other bugs required my attention.
I'm debugging this now so I'll get back to you soon...",STATUS_UPDATE,0,FULL_TOKEN
1209952,18,"Hi Mats,
Do you have further update of your reviewing? If you have any questions about this bug and my patch, feel free to ask me.",CODE_REVIEW_REQUEST,0,FULL_TEXT
1209952,19,"Created attachment 9055835
frame dumps
So here's my initial analysis of what happens in the frame tree
that leads up to the crash.  I've colorized the interesting float
continuation chain, and numbered the interesting frames dumps
in a grey background color and numbered them.  Referring to
each of the numbered trees in this log:
1. initially we have a float in the first column
2. we reflow and find that it overflows (but its parent is complete),
   so we put a NIF for it on the OverflowContainersList
3. when reflowing the next column, we find that it still doesn't
   fit so we create another NIF and put it on the PushedFloatsList
   and create a continuation for the parent on ExcessOverflowContainersList
**CRASH**
Now backtracking a bit in rr to see what happens between 3 and the crash...
4. This is the frame tree we start with when reflowing our float (red).
   Note that the inner ColumnSet has a NIF at this point.
5. Backtracking to where we create that ColumnSet NIF.
   I think this is the point where things start to go wrong.
   We've decided that the float's parent doesn't fit in in this
   column at all and we push the lines containing it (creating
   the Overflow-lines list) and create the NIF.
6. At this point the NIF has picked up the Overflow-lines so
   the float first-in-flow is in the ColumnSet NIF and its continuations
   in the previous ColumnSet.  Likewise for the float's parent block
   which is also in the wrong order.  This seems _questionable_ to me.
   Technically, we would either be COMPLETE, in which case we'd delete
   the NIFs, or INCOMPLETE, in which case we'd push them, but still...
From 6, this is essentially what happens, we decide it's COMPLETE
and delete the NIFs.  The reason we crash is that one of the float
NIFs are registered in the float manager, and we try to use it
after it's been deleted (frame-poisoning makes it non-exploitable
though).
(my apologies for the verbosity of this log)",UNCODED,0,UNMATCHED
1209952,20,"I wrote a WIP to fix the underlying cause of the crash here:
https://hg.mozilla.org/try/rev/36932abd37ac11308bfee0068ef5eaf74e9f7846
If a continuation pulls in children from its prev-in-flow
then it should also move any overflow containers for those
from its OverflowContainers list, to avoid the child
continuations from becoming in the wrong order.
The WIP currently moves them to the principal child list
(mFrames), but ExcessOverflowContainers might be better.
I'll investigate this some more...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1209952,21,"FTR, there's one more detail I want to highlight in the log above.
At the very end, I print out nsFloatManager::mFloats.  We have
the (float) child of the overflow container (green) at index 0,
and the (red) child float from the line list in slot 1.  This is
because we call ReflowOverflowContainerChildren before reflowing
the principal children (in the lines), so it's added first.
The stack when we add that float is:
#0 nsTArray_Impl<nsFloatManager::FloatInfo, nsTArrayInfallibleAllocator>::AppendElement
#1 nsFloatManager::AddFloat
#2 mozilla::BlockReflowInput::FlowAndPlaceFloat
#3 nsBlockFrame::ReflowPushedFloats
#4 nsBlockFrame::Reflow
#5 nsContainerFrame::ReflowChild
#6 nsContainerFrame::ReflowOverflowContainerChildren
#7 nsBlockFrame::Reflow
So after we reflow the red float and find that it's COMPLETE
and destroy its continuations, we have a dead continuation
in the float manager.",PROBLEM_REVIEW,0,FULL_TOKEN
1209952,22,"Hope you don't mind if I steal this one Violet.  I'd like to fix
the underlying crash here separately from any sizing changes.
Please file a follow-up bug with your patch since it might give
more correct layout results.  Thanks.",NEW_ISSUE_FILING,0,FULL_TOKEN
1209952,23,"Created attachment 9056360
Bug 1209952 - Move [Excess]OverflowContainers continuations of children we pull in from our prev-in-flow to our principal list to avoid making them unordered.  r=dholbert",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1209952,24,"Pushed by mpalmgren@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/204d0d6a487f
Move [Excess]OverflowContainers continuations of children we pull in from our prev-in-flow to our principal list to avoid making them unordered.  r=dholbert",UNCODED,0,UNMATCHED
1209952,25,https://hg.mozilla.org/mozilla-central/rev/204d0d6a487f,UNCODED,0,UNMATCHED
1209952,26,*** Bug 1155060 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1217192,1,"See bug 1176052.  It's on all trains, may as well clean up the usages we have and replace with the shorter macro.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1217192,2,"Created attachment 8677111
Use gfxCriticalNote where appropriate for brevity.",UNCODED,0,UNMATCHED
1217192,3,"Created attachment 8677125
Use gfxCriticalNote where appropriate for brevity.
Rebase",UNCODED,0,UNMATCHED
1217192,4,Pre rebase try run seems to be ok - https://treeherder.mozilla.org/#/jobs?repo=try&revision=6e68d6da0c62,SOLUTION_VERIFICATION,0,FULL_TEXT
1217192,5,https://hg.mozilla.org/integration/mozilla-inbound/rev/8315a152ccb1,UNCODED,0,UNMATCHED
1217192,6,https://hg.mozilla.org/mozilla-central/rev/8315a152ccb1,UNCODED,0,UNMATCHED
1217663,1,"I420VideoFrame::CreateFrame (media\webrtc\trunk\webrtc\common_video\i420_video_frame.cc) doesn't check (or propagate) the return code from its calls to Plane::Copy. In consequence, if Plane::Copy fails due to OOM (which could be intermittent), CreateFrame still sets its |width_| and |height_| members. If the new height and/or width are larger than the old one(s), this causes other code (such as ViEExternalRendererImpl::RenderFrame) to use the larger height and/or width when reading the frame's plane buffers, which causes that code to read memory to which it has no right.
The bug is still present in today's trunk: http://hg.mozilla.org/mozilla-central/file/5a6ef7c09c12/media/webrtc/trunk/webrtc/common_video/i420_video_frame.cc .
Details
-------
The bug is in lines 57-9: 
48: int I420VideoFrame::CreateFrame(int size_y, const uint8_t* buffer_y,
49:                                 int size_u, const uint8_t* buffer_u,
50:                                 int size_v, const uint8_t* buffer_v,
51:                                 int width, int height,
52:                                 int stride_y, int stride_u, int stride_v) {
53:   if (size_y < 1 || size_u < 1 || size_v < 1)
54:     return -1;
55:   if (CheckDimensions(width, height, stride_y, stride_u, stride_v) < 0)
56:     return -1;
57:   y_plane_.Copy(size_y, stride_y, buffer_y);
58:   u_plane_.Copy(size_u, stride_u, buffer_u);
59:   v_plane_.Copy(size_v, stride_v, buffer_v);
60:   width_ = width;
61:   height_ = height;
62:   return 0;
63: }
The definition of Plane::Copy (from media\webrtc\trunk\webrtc\common_video\plane.cc) is thus:
69: int Plane::Copy(int size, int stride, const uint8_t* buffer) {
70:   if (MaybeResize(size) < 0)
71:     return -1;
72:   memcpy(buffer_.get(), buffer, size);
73:   plane_size_ = size;
74:   stride_ = stride;
75:   return 0;
76: }
The bug can be simulated in the debugger as follows:
   1.  Start FF with one window, one tab;
   2.  Start FF Hello and create a conversation;
   3.  Undock the Hello window from the main window;
   4.  Copy the conversation link into the address bar and join the conversation;
   5.  Share tabs in the Hello window after it's connected;
   6.  Attach a debugger to FF;
   7.  Set a breakpoint on I420VideoFrame::CreateFrame at the call to |y_plane_.Copy| with the condition |height != height_|.
   8.  Rapidly increase the vertical size of the main window;
   9.  When the breakpoint fires:
       a. record the values of |height| and |height_|; and
       b. step into each call to |plane::Copy| and simulate an OOM by skipping the call to |MaybeResize| and instead giving control to |return -1;|
   10. Notice how I420VideoFrame::CreateFrame unconditionally sets |height_ = height|.
   11. Set a breakpoint on ViEExternalRendererImpl::RenderFrame (media\webrtc\trunk\webrtc\video_engine\vie_renderer.cc), where it calls ExtractBuffer.
   12. Let execution proceed.
   13. When the breakpoint fires, step into ExtractBuffer (module webrtc_libyuv.cc) and examine |input_frame.height|. It should be the same as the new value you saw at the breakpoint in I420VideoFrame::CreateFrame;
   14. Now compute |input_frame.y_plane.allocated_size_ / input_frame.y_plane.stride_| and notice that it equals the old, smaller value of |height_| instead of |input_frame.height|.
   15. Notice how ExtractBuffer uses |input_frame.height()| (== |input_frame.height|) to compute the bounds for its inner |for| loop;
   16. If you're using WinDBG (but not VS, alas) set a read breakpoint on the byte just beyond the buffer's end, let execution proceed, and watch it fire (or, if you increased the size of the window a lot, watch it read access-violate).",S2R,0,FULL_TOKEN
1217663,2,There is a similar bug in I420VideoFrame::CreateEmptyFrame.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1217663,3,"The bug in I420VideoFrame::CreateFrame also affectsI420VideoFrame::CopyFrame, I420VideoFrame::CloneFrame, and their callers.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1217663,4,"Tentatively sec-high.  The allocation (in AlignedMalloc()) is using malloc(), and so is fallible (unlike new).  We should check all other derivatives of AlignedMalloc and Plane::Copy, this may well have more duplicates.  Pretty hard to do anything with as it's predicated on an OOM, but using very large planes may allow you to OOM ""early"" with the system still largely usable.
The update to webrtc.org 43 under way rewrites this code such that it's based on new (and gets rid of the independently-allocated Planes as well).
A related bug: bug 881742, which landed in 41.
Bug from upstream; since fixed (between upstream branch 40 and 43) by rewrite",PROBLEM_REVIEW,0,FULL_TOKEN
1217663,5,Fixed by landing upstream update to branch 43 in bug 1198458,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1217663,6,"Randell, what is the ESR38 plan here? We are supposed to take sec-high issue patches on ESR branches.
Also, is the ""branch 43"" code landing on what branches? 43? Trunk?",QUESTION,0,FULL_TOKEN
1217663,7,"What is ""branch 43""? Does that mean status-firefox43 should be ""fixed"" rather than ""affected""? The branch status flags on the other bug weren't set either, but it looks like it landed in Firefox 45, not 43.",ANSWER_TO_QUESTION,0,FULL_TEXT
1217663,8,"Sorry - branch 43 means webrtc.org (upstream) stable branch 43, which landed in our tree in Firefox 45.  Upstream stable branches of webrtc.org use numbering that matches the version of Chrome they shipped in (for the last year or so).
As for ESR-38 - The issue would be we need to create a patch to do the right checking (which shouldn't be hard) and land it in 44 and ESR-38.  This would be (very) hard to exploit since it depends on an allocation failure on a reallocation to a larger size, and then there's a good chance that it would just lead to a crash.  However, as the checking should be simple we could look to land a patch for 44/ESR-38 early next week (I'm on PTO until the 21st, but am checking sec issues).",ANSWER_TO_QUESTION,0,FULL_TOKEN
1217663,9,"[Tracking Requested - why for this release]:
This fix is about to ship in Firefox 45, so we have to decide whether to fix this on ESR-38. The description of how to trigger this bug in comment 7 makes it sound more like a sec-moderate issue.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1217663,10,I concur,UNCODED,0,UNMATCHED
1217663,11,"Dan, if it is sec-moderate, we would most likely wontfix it for esr38. Should I go ahead and do that? Or do we need more discussion/comments on this? Thanks!",QUESTION,0,FULL_TEXT
1247539,1,There's pretty much no way to know when we fail to create a D3D11 device in the content process.,PROBLEM_MOTIVATION,0,FULL_TEXT
1247539,2,"Created attachment 8718237
bug1247539.patch
This 'works' but anyone encountering a problem is still unlikely to observe it:
 (1) gfxCriticalNote messages in the child process don't show in about:support
 (2) On Windows, child process stdout/stderr is broken unless you pipe to file
 (3) The histogram value - which is definitely getting recorded - does not appear in any ping. I'm not sure how Telemetry in content processes is supposed to work.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1247539,3,"Comment on attachment 8718237
bug1247539.patch
Review of attachment 8718237:
-----------------------------------------------------------------
::: gfx/thebes/gfxWindowsPlatform.cpp
@@ +2389,5 @@
Inside of this branch, ""hr"" is not initialized, so no point in showing the value, right?",CODE_REVIEW,0,FULL_TEXT
1247539,4,"Yeah, this is completely not in place.
They should show up in the crash reports though, except for the case where we're messaging from a non-main thread on the child process, but I'd like to confirm that.",SOLUTION_REVIEW,1,FULL_TEXT
1247539,5,"Created attachment 8719063
about:support with child graphics annotations
Does this resolve #1?",CODE_IMPLEMENTATION,1,FULL_TEXT
1247539,6,I realize it'd have trouble for non-main thread content messages.,CODE_REVIEW,0,FULL_TEXT
1247539,7,"Yeah, indeed.",CODE_REVIEW,0,FULL_TEXT
1247539,8,https://hg.mozilla.org/integration/mozilla-inbound/rev/36cbd7121dbe,UNCODED,0,UNMATCHED
1247539,9,https://hg.mozilla.org/mozilla-central/rev/36cbd7121dbe,UNCODED,0,UNMATCHED
1252039,1,"The Static Analysis tool Coverity added that in the following context:
operands don't affect the result since |""unexpected nsCSSTokenSerializationType value""| will always translate to a valid memory address thus the MOZ_ASSERT becoming useless.",UNCODED,0,UNMATCHED
1252039,2,"Created attachment 8724678
MozReview Request: Bug 1252039 - corrected MOZ_ASSERT expression in SeparatorRequiredBetweenTokens. r?roc
Review commit: https://reviewboard.mozilla.org/r/37115/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/37115/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1252039,3,"Comment on attachment 8724678
MozReview Request: Bug 1252039 - corrected MOZ_ASSERT expression in SeparatorRequiredBetweenTokens. r?roc
https://reviewboard.mozilla.org/r/37115/#review33665",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1252039,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/be813aef3471,UNCODED,0,UNMATCHED
1252039,5,https://hg.mozilla.org/mozilla-central/rev/be813aef3471,UNCODED,0,UNMATCHED
1253516,1,https://treeherder.mozilla.org/logviewer.html#?job_id=22979153&repo=mozilla-inbound,UNCODED,0,UNMATCHED
1253516,2,I guess this was caused by bug 1244897. ni? to me.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1253516,3,"This is tough, I can't catch this while running this test with choas mode repeat=1000!",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1253516,4,chaos... There is no choas mode.,CLARIFICATION,0,FULL_TEXT
1253516,5,"I thought the dead lock might be caused from other thread but it was in the same, the main thread!
A stack trace at the point:
06:43:31     INFO -   7  libxul.so!mozilla::TimelineConsumers::IsEmpty() [TimelineConsumers.cpp:77192f60c4a5 : 172 + 0xd]
06:43:31     INFO -   8  libxul.so!mozilla::CycleCollectedJSRuntime::GCNurseryCollectionCallback(JSRuntime*, JS::GCNurseryProgress, JS::gcreason::Reason) [CycleCollectedJSRuntime.cpp:77192f60c4a5 : 852 + 0x10]
06:43:31     INFO -   9  libxul.so!js::gcstats::Statistics::beginNurseryCollection(JS::gcreason::Reason) [Statistics.h:77192f60c4a5 : 199 + 0x14]
06:43:31     INFO -  10  libxul.so!js::Nursery::collect(JSRuntime*, JS::gcreason::Reason, mozilla::Vector<js::ObjectGroup*, 0u, js::SystemAllocPolicy>*) [Nursery.cpp:77192f60c4a5 : 402 + 0x5]
06:43:31     INFO -  11  libxul.so!js::gc::GCRuntime::minorGCImpl(JS::gcreason::Reason, mozilla::Vector<js::ObjectGroup*, 0u, js::SystemAllocPolicy>*) [jsgc.cpp:77192f60c4a5 : 6653 + 0x19]
06:43:31     INFO -  12  libxul.so!js::gc::GCRuntime::evictNursery(JS::gcreason::Reason) [GCRuntime.h:77192f60c4a5 : 604 + 0x15]
06:43:31     INFO -  13  libxul.so!js::gc::GCRuntime::gcCycle(bool, js::SliceBudget&, JS::gcreason::Reason) [jsgc.cpp:77192f60c4a5 : 6263 + 0xf]
06:43:31     INFO -  14  libxul.so!js::gc::GCRuntime::collect(bool, js::SliceBudget, JS::gcreason::Reason) [jsgc.cpp:77192f60c4a5 : 6424 + 0x1b]
06:43:31     INFO -  15  libxul.so!js::gc::GCRuntime::gcSlice(JS::gcreason::Reason, long long) [jsgc.cpp:77192f60c4a5 : 6497 + 0x4a]
06:43:31     INFO -  16  libxul.so!js::gc::GCRuntime::gcIfRequested(JSContext*) [jsgc.cpp:77192f60c4a5 : 6717 + 0x1d]
06:43:31     INFO -  17  libxul.so!js::gc::GCRuntime::gcIfNeededPerAllocation(JSContext*) [Allocator.cpp:77192f60c4a5 : 34 + 0xf]
06:43:31     INFO -  18  libxul.so!JSExternalString* js::Allocate<JSExternalString, (js::AllowGC)1>(js::ExclusiveContext*) [Allocator.cpp:77192f60c4a5 : 55 + 0x8]
06:43:31     INFO -  19  libxul.so!JSExternalString::new_(JSContext*, char16_t const*, unsigned int, JSStringFinalizer const*) [String-inl.h:77192f60c4a5 : 319 + 0x5]
06:43:31     INFO -  20  libxul.so!JS_NewExternalString(JSContext*, char16_t const*, unsigned int, JSStringFinalizer const*) [jsapi.cpp:77192f60c4a5 : 1548 + 0x1d]
06:43:31     INFO -  21  libxul.so!XPCStringConvert::StringBufferToJSVal(JSContext*, nsStringBuffer*, unsigned int, JS::MutableHandle<JS::Value>, bool*) [xpcpublic.h:77192f60c4a5 : 242 + 0x7]
06:43:31     INFO -  22  libxul.so!XPCStringConvert::ReadableToJSVal(JSContext*, nsAString_internal const&, nsStringBuffer**, JS::MutableHandle<JS::Value>) [XPCString.cpp:77192f60c4a5 : 95 + 0x15]
06:43:31     INFO -  23  libxul.so!xpc::NonVoidStringToJsval(JSContext*, nsAString_internal&, JS::MutableHandle<JS::Value>) [XPCString.cpp:77192f60c4a5 : 116 + 0xa]
06:43:31     INFO -  24  libxul.so!xpc::NonVoidStringToJsval(JSContext*, nsAString_internal const&, JS::MutableHandle<JS::Value>) [xpcpublic.h:77192f60c4a5 : 310 + 0xf]
06:43:31     INFO -  25  libxul.so!mozilla::dom::ProfileTimelineStackFrame::ToObjectInternal(JSContext*, JS::MutableHandle<JS::Value>) const [ProfileTimelineMarkerBinding.cpp:77192f60c4a5 : 560 + 0xd]
06:43:31     INFO -  26  libxul.so!mozilla::JavascriptTimelineMarker::AddDetails(JSContext*, mozilla::dom::ProfileTimelineMarker&) [ToJSValue.h:77192f60c4a5 : 231 + 0xe]
06:43:31     INFO -  27  libxul.so!mozilla::ObservedDocShell::PopMarkers(JSContext*, nsTArray<mozilla::dom::ProfileTimelineMarker>&) [ObservedDocShell.cpp:77192f60c4a5 : 141 + 0x1b]
We need to be careful not to invoke cycle collection while PopMarkers is being processed.  But how?
I don't know much about cycle collection.  Nick, you are the author who introduced AutoGlobalTimelineMarker in cycle collection codes in bug 1141614.  Any ideas?",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1253516,6,"6 automation job failures were associated with this bug in the last 7 days.
Repository breakdown:
* mozilla-inbound: 4
* mozilla-central: 1
* fx-team: 1
Platform breakdown:
* linux64: 3
* linux32: 3
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1253516&startday=2016-02-29&endday=2016-03-06&tree=all",UNCODED,0,UNMATCHED
1253516,7,"Thanks for the digging, Hiroyuki! This indeed should not be re-entrant, and I'm not sure why it is. Investigating.",PROBLEM_REVIEW,0,FULL_TEXT
1253516,8,"20 automation job failures were associated with this bug in the last 7 days.
Repository breakdown:
* mozilla-inbound: 9
* fx-team: 7
* try: 2
* mozilla-central: 2
Platform breakdown:
* linux64: 16
* linux32: 4
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1253516&startday=2016-03-07&endday=2016-03-13&tree=all",UNCODED,0,UNMATCHED
1253516,9,"So this doesn't actually involve CC at all.
PopTimelineMarkers
      |
      V
acquire lock
      |
      V
create JS objects for markers
      |
      V
nursery GC
      |
      V
attempt to acquire lock to add marker for nursery GC
      |
      V
dead lock
Hack #1: AutoSuppressGC while creating timeline markers. Not a good solution.
Hack #2: Some atomic global flag or something that we set while popping timeline markers and then unset when we're done. We would check this before adding nursery markers, and if it was set not add the marker. Less bad thna #1, but still pretty gross.
Solution #3: Swap the timeline markers into a new vec while we have the lock, but do not allocate any JS obejcts yet, release the lock, operate on our vec to create the JS objects. This would be most ideal, but now I need to learn how the heck all this stuff works.
Looking into #3 more.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1253516,10,"Actually, `sMutex` is acquired by `TimelineConsumers::PopMarkers` here[0] so that it can touch `mMarkerStores` according to the comment, but then it doesn't touch `mMarkerStores` nor does `ObserveDocShell::PopTimelineMarkers`. So assuming the comment is correct, I think we can just delete this lock acquisition!
[0] https://dxr.mozilla.org/mozilla-central/source/docshell/base/timeline/TimelineConsumers.cpp#303",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1253516,11,"Created attachment 8730325
Do not acquire a lock that protects data that is not used
`sMutex` protects the `mMarkersStores` data member, but neither
`TimelineConsumers::PopMarkers` nor `ObservedDocShell::PopMarkers` use that
data member.
Removing this lock acquisition also fixes a dead lock where we re-entrantly
attempt to acquire the lock when triggering a GC when allocating JS objects
inside `ObservedDocShell::PopMarkers`.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1253516,12,Try push: https://treeherder.mozilla.org/#/jobs?repo=try&revision=bbd8381da834,CODE_IMPLEMENTATION,1,FULL_TEXT
1253516,13,"Great Nick!
That was my mistake.  As I commented in comment#0, I thought the deadlock we had been seeing in bug 1244897 might be caused from other threads.  What I don't quite understand is that the assertion message in bug 1244897 is accurate or not.",SOLUTION_REVIEW,1,FULL_TOKEN
1253516,14,"To be honest, I don't really understand the locking scheme in use here and exactly what is protected by which lock and where the critical sections are. I defer to :tromey and :vporof for that information, as they were much more involved in authoring the timeline consumers infrastructure than I was.",CLARIFICATION,0,FULL_TEXT
1253516,15,https://hg.mozilla.org/integration/mozilla-inbound/rev/ffdeaea4ceae,UNCODED,0,UNMATCHED
1253516,16,https://hg.mozilla.org/mozilla-central/rev/ffdeaea4ceae,UNCODED,0,UNMATCHED
1253516,17,"11 automation job failures were associated with this bug in the last 7 days.
Repository breakdown:
* mozilla-inbound: 9
* try: 1
* fx-team: 1
Platform breakdown:
* linux64: 6
* linux32: 5
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1253516&startday=2016-03-14&endday=2016-03-20&tree=all",UNCODED,0,UNMATCHED
1253516,18,*** Bug 1283887 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1253884,1,"Created attachment 8727138
neg-zero
The lack of .0 causes the token to be classified as an integer and then the -0 is lost.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1253884,2,https://hg.mozilla.org/integration/mozilla-inbound/rev/f1ff5388e591,UNCODED,0,UNMATCHED
1253884,3,https://hg.mozilla.org/mozilla-central/rev/f1ff5388e591,UNCODED,0,UNMATCHED
1261576,1,"User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:48.0) Gecko/20100101 Firefox/48.0
Build ID: 20160402102110
Steps to reproduce:
There is an issue with the scrollbars in gtk3 builds. Under adwaita, the gtk3 builtin default theme, the scrollbars are not colored blue when selected (only when hovered). The behavior in native gtk3 apps is blue colored selected scrollbars.
This also works in the gtk2 build so is a regression.",S2R,0,FULL_TOKEN
1261576,2,"Actually they are blue when selected, but as soon as you slide it even a pixel the blue goes away.",PROBLEM_REVIEW,0,FULL_TEXT
1261576,3,"OK.  Just to clarify further the difference between the old behavior and the behavior under Gtk3 with the pending patch for bug 1234158 applied.  With this patch applied under Gtk3, the scrollbar handle is light gray normally, dark gray when hovered and blue when selected (all of which are correct and agree with the old behavior)  What is wrong is that if you keep the scrollbar selected and drag it to actually scroll it reverts to the default light gray instead of remaining blue as expected.",PROBLEM_REVIEW,0,FULL_TOKEN
1261576,4,"One other issue i notices is that clicking and holding in the scrollbar outside the handle are should move the handle to that area and it should be clue as long as selected.  It is also light gray in that scenario, but that is probably the same sase as the other issue selected and moved.  I am also removing the regression keyword because I think have a regression keyword on a regression that cannot be seen without adding a wip patch is kind of lame.",PROBLEM_REVIEW,0,FULL_TOKEN
1261576,5,No need for patches. Just compile the current firefox release and link against gtk+ 3.18. The issue is there too.,CLARIFICATION,0,FULL_TEXT
1261576,6,"Yes, I see that now.  I should not have been trying to go from memory.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1261576,7,I can confirm this on Gnome 3.20 with GTK+3 3.20 using Adwaita theme. Unfortunately I can't see the scrollbar when hovered/selected/dragged either...,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1261576,8,THis is addresses by the pending patches for bug 1234158.,CLARIFICATION,0,FULL_TEXT
1261576,9,*** Bug 1269561 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1261576,10,"Lubuntu 16.04 x64, GTK 3.18, Firefox 46.0. Same situation. Screencast attached.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1261576,11,"Created attachment 8748730
gtk3-scrollbars-comparison.mp4",UNCODED,0,UNMATCHED
1261576,12,"Now that scrollbar themeing has landed, perhaps someone can take a look at this bug?
Thank you.",ASSIGNEE_REQUEST,0,FULL_TOKEN
1261576,13,"Created attachment 8765480
patch
There's a simple fix for that. Need to check if we need that for pre-3.20 too.",CODE_IMPLEMENTATION,1,FULL_TEXT
1261576,14,This fixes it for me on gtk+ 3.20.6,SOLUTION_VERIFICATION,0,FULL_TEXT
1261576,15,I can verify that this fixes the issue for me under both gtk 3.20 and gtk 3.18.,SOLUTION_VERIFICATION,0,FULL_TEXT
1261576,16,"Created attachment 8765824
patch
I'm unable to find exact commit but indicator_set_over() (from gtkscrolledwindow.c) which sets the ""hovering"" style to thumb was introduced in Gtk 3.16 so I guess it's safe to enable that for gtk3.16+.",CODE_IMPLEMENTATION,1,FULL_TEXT
1261576,17,I also verified that this compiles and does not seem to cause any issues if you build using the cairo-gtk2 toolkit.,SOLUTION_VERIFICATION,0,FULL_TEXT
1261576,18,"inHover corresponds to GTK_STATE_FLAG_PRELIGHT which I assume is the :prelight
(and :hover) pseudoclass.  The .hovering class from indicator_set_over() is different and for overlay scrollbars.
I assume this is the Adwaita rule involved:
    .scrollbar .slider:prelight:active {
      background-color: #2a76c6; }
The reason why gtkrange sets prelight as if in hover is that the mouse location is
set to the grab location when the pointer is grabbed during mouse down:
https://git.gnome.org/browse/gtk+/tree/gtk/gtkrange.c?h=3.20.6#n3437
This is the same in older versions:
https://git.gnome.org/browse/gtk+/tree/gtk/gtkrange.c?h=3.4.4#n3349
I'm a little surprised that Gecko's scrollbar implementation is not similar.",SOLUTION_REVIEW,1,FULL_TOKEN
1261576,19,"Comment on attachment 8765824
patch
Not this patch, because this bug is unrelated to 3.16 and ""hovering"" is a different concept.",CODE_REVIEW,0,FULL_TEXT
1261576,20,"Comment on attachment 8765480
patch
But this patch is good, thanks, with the commit message from the other.",CODE_REVIEW,0,FULL_TEXT
1261576,21,"Created attachment 8769835
patch for check-in
Try:  https://treeherder.mozilla.org/#/jobs?repo=try&revision=a591ade2dbd3",UNCODED,0,UNMATCHED
1261576,22,"Pushed by cbook@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/265d5961e81a
render scrollbar thumb as ""hovered"" to emulate active Gtk thumb style. r=karlt",UNCODED,0,UNMATCHED
1261576,23,https://hg.mozilla.org/mozilla-central/rev/265d5961e81a,UNCODED,0,UNMATCHED
1262069,1,"Promise rejection values are currently stored with whatever wrappers they were passed in with, and re-wrapped for the compartment that the promise belongs to when reporting unhandled rejections, or calling handlers.
In the case of unhandled rejections, in particular, this causes issues when attempting to report an error that belongs to the same compartment as the promise, but was passed in from a different compartment:
    let sandbox = Cu.Sandbox(window);
    sandbox.Promise.reject(new sandbox.Error(""error""));
    Cu.nukeSandbox(sandbox);
This leads to a message:
    JavaScript error: , line 0: uncaught exception: unknown (can't convert to string)
since the error object was stored as a cross-compartment wrapper, and that wrapper was cut when the sandbox was destroyed, meaning that the exception reporter can no longer report any useful details about it.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1262069,2,"Created attachment 8738042
Wrap promise resolution values before storing",UNCODED,0,UNMATCHED
1262069,3,"Comment on attachment 8738042
Wrap promise resolution values before storing
I seem to recall there were actual reasons for storing the value as-is instead of wrapping into the promise compartment.  Have you run the full test suite with this patch?
In any case, this won't help with the spidermonkey promise implementation, which we're about to turn on.  As in, you're touching code that's about to become dead code.",CODE_REVIEW,0,FULL_TOKEN
1262069,4,"A few tests are still running, but so far most of them have passed.
I could see choosing not to re-wrap the value, on the expectation that some
handlers may be in the same compartment that fulfilled the promise. But I
don't think that should cause any actual problems, unless there are some weird
corner cases with cached WN reflectors.
Even if there are, though, I think that re-wrapping for the target compartment
is the expected behavior. A call to a promise handler for a promise in a
different compartment should be the same as any other call that passes a value
into that compartment. Any code that relies on different behavior is, I think,
broken.
How soon will it be turned on?
I just tested with spidermonkey promises enabled, and I no longer get these
errors. But the unhandled rejections aren't reported, either.
From a quick read through Promise.js and Promise.cpp, it looks like the
resolution values should be wrapped for the compartment that owns the promise
before calling the self-hosted fulfillment methods, so this may not be a
problem there.
Either way, if the new implementation isn't going to be turned on in this
release, I'd still like to address this. These errors are extremely confusing
for users, and I'm worried that they may mask issues in our tests.",SOLUTION_REVIEW,1,FULL_TOKEN
1262069,5,"Hopefully a few days, but I said that two weeks ago...
I guess the code you're adding comes after we've done the thenable thing.  So maybe it's OK to mess with the value at that point.",CODE_REVIEW,0,FULL_TOKEN
1262069,6,"Comment on attachment 8738042
Wrap promise resolution values before storing
You should probably set value to undefined too, or something....
And you probably want a test for whatever thing it is you care about here, so someone doesn't simplify things and re-break it.
r=me",CODE_REVIEW,0,FULL_TOKEN
1262069,7,"Correct, it's not a problem in the new implementation.
What bz said. I have all tests passing on Linux and OS X now, but Windows does weird things.
In any case, this seems like it's a small enough fix that landing it shouldn't hurt. Given that we want to keep open the option of disabling SM Promise if it misbehaves in bad ways on Aurora or Beta, I think it'd make sense to fix issues with the DOM implementation.",SOLUTION_REVIEW,1,FULL_TEXT
1262069,8,Thanks,UNCODED,0,UNMATCHED
1262069,9,"https://hg.mozilla.org/integration/fx-team/rev/bb1926280d496c73c43f89db6b7b5f8f9165504c
Bug 1262069: Wrap promise resolution values before storing. r=bz",CODE_IMPLEMENTATION,1,FULL_TOKEN
1262069,10,https://hg.mozilla.org/mozilla-central/rev/bb1926280d49,UNCODED,0,UNMATCHED
1263083,1,"STR:
1. Log in to inbox.google.com
2. Do *anything* in the message list (actions below)
Actions:
* use keyboard shortcuts to move up and down the message list
* click on a category to open the list of messages
* click on a message header to open the email
Expected: Actions take less than or up to 1 second to complete. This is what happens with the Mar 7 build.
Actual: Actions take between 3 and 10 seconds.
Environment: Mac. Tried both dirty and new profiles.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1263083,2,"Hi David, dcamp pointed me your way for Firefox perf issues these days. Can you route this into the right hands?
We should try to not ship this regression, and the clock is running on that, so appreciate any help.",ASSIGNEE_REQUEST,0,FULL_TOKEN
1263083,3,"Any new /updated plugins  ?
Mac  OSX ## ?",QUESTION,0,FULL_TOKEN
1263083,4,"Default plugins for Mar 7 nightly and latest nightly on new profile should be the same, right?
Mac OS X 10.11.3 (15D21).",ANSWER_TO_QUESTION,0,FULL_TEXT
1263083,5,Any chance you can get a narrower regression window with mozregression ? You can use the --profile switch to run it against your usual profile.,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1263083,6,"I've been experiencing this too, but recent (last 2-3 days) Nightlies actually don't even load Inbox completely.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1263083,7,"I filed bug 1263170 for the 'failed to load' issue, which appears in Beta too so it's probably an Inbox change.",NEW_ISSUE_FILING,0,FULL_TEXT
1263083,8,I don't reproduce this on my Linux machine so it might be Mac-specific. Are you in e10s mode or not? If you are then can you try running in non-e10s mode and see if the problem goes away?,QUESTION,0,FULL_TEXT
1263083,9,"Hey Gij, sorry I cannot narrow the window right now. I added the keywords so hopefully someone will be able to.",ANSWER_TO_QUESTION,0,FULL_TEXT
1263083,10,"James, I've not seen bug 1263170 at all. Things load always for me, just takes a lonnggggg time.
Gabriele, yeah testing w/ e10s enabled since that is default in a new profile.
With e10s off: Super slow initial load, including brief beachballing, but otherwise didn't exhibit the bug.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1263083,11,"Hi,
I have tested this issue on Mac OS X 10.10 with FF Nightly 48.0a1 (2016-04-10) and I can't reproduce the issue. Can you please retest this with the latest build?",REPRODUCTION_REQUEST,0,FULL_TEXT
1263083,12,"I've seen this once last week, very slow load but then everything is fine but can't reproduce it anymore.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1263083,13,"Everyone: It's great that it works for you, but the goal is to figure out why it's *not* working for me.
I've been working on and testing Firefox for over 10 years, so asking me to update to latest build and test it again is not productive - I've been living on nightlies forever ;)
In the event that the issue *is* fixed by updating to a recent build, then we *still* need to know what regressed the behavior and also what fixed it.
Please before commenting that it works for you, test the exact scenario I reported, and also compare the Mar 7 build vs most recent nightlies. I'm on the latest version of Mac OS X El Capitan on a new Macbook (the tiny ones) - which may or may not be relevant, so make a note of the hardware you're testing on also.
Examples of commands that are excruciatingly slow for me are ""o"" to open categories, ""e"" to mark an item as done, and ""z"" to undo. If I go back to Mar 7 nightly, everything is much much faster.",CLARIFICATION,0,FULL_TOKEN
1263083,14,"Dietrich -- so does this only happen to you on the March 7 build? In case we are reducing to a specific build (and possibly platform), I'd like to target accordingly.",QUESTION,0,FULL_TEXT
1263083,15,"Heh, exactly the opposite. Inbox performs normally on Mar 7 build, and later builds perform terribly. I don't know that the problem started on the Mar 8 build though - all I could find that was older at the time I reported was Mar 7, which works fine so I stuck with it ;)
We really just need someone from QA who's got the mozregression stuff installed and dialed to try and reproduce and narrow the window of regression.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1263083,16,"So I just checked this on my local (Mac (late 2013 15"", though), OSX 10.11.3, current Nightly) and I can't reproduce it either.
If we're going to bisect, we can start with bisecting the nightlies from Mar 7 and Mar 8. I can try replicating on the older Nightly but ymmv -- I'm brand new to this and still ramping in. Someone may find the issue via bisection faster than I'll have a new profile set up...",STATUS_UPDATE,0,FULL_TEXT
1263083,17,"Tested again on MacBook Pro (Retina, 15-inch, late 2013) OS X 10.11 with the latest Nightly (2016-04-11) and I can't reproduce this issue.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1263083,18,"Considering they can't reproduce, any chance you can try using ./mach mozregression yourself to reproduce the issue on your local machine and get an inbound branch (fx-team, m-i, b2g-i or whatever) regression window? It seems like having such a window might also shed some light on why others aren't reproducing...",REPRODUCTION_REQUEST,0,FULL_TEXT
1263083,19,"Sorry, but I've been down this rabbit hole before, and I can't chase Firefox regressions *and* do my day job. It's both incredibly time consuming and depressing.
I hope filing this bug will help in some future investigation. Good luck and thanks in advance to future spelunkers.
We used to have staff QA and a community of testers that they'd grown, that had their environments set up for this and had the tools dialed in, but afaict we don't have either anymore?",STATUS_UPDATE,0,FULL_TOKEN
1263083,20,"Closing as WFM, since nobody else can reproduce.",STATUS_UPDATE,0,FULL_TEXT
1263083,21,"We still do, and some of them have commented here...",ANSWER_TO_QUESTION,0,FULL_TEXT
1263083,22,I can definitely still repro this. I looked into it a bit and it seems like layerization is going crazy. My guess is that we end up putting every message into its own layer. Matt/Jamie can one of you look?,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1263083,23,I'm on the case,DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1263083,24,"I cannot personally reproduce the noticeable performance regression, each of these operations always takes about 1 second for me. I did however notice a change in how it layerizes on the 9th. Dietrich, is it correct that the 7th is the last good build *you aware of*, but that doesn't mean the 8th is necessarily the first bad build? That's how I read the above comments, and is consistent with my findings.
The change I notice is that we are using more multi-tiled layers than before. This would explain why it only affects OS X, although even with tiling enabled on linux I cannot reproduce a noticeable performance regression. I ran a bisection looking out for the extra multi-tiled layers and found bug 1221094 to be the culprit, which makes sense. Memory usage after that commit is greater than before. Each of the operations listed as slow will now result in more memory allocations required to perform them. (Perhaps on a hi-dpi display this would be even more pronounced and therefore cause a more noticeable slow down.)
The commit in question usually causes positive improvements in my experience. But I think the combination of it along with some existing bad decisions on this page is what's causing problems. There should be a way to layerize this page better, I'll keep investigating.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1263083,25,"Sorry for the brain dump, but here's another. Each email is given its own layer. Previously these were single-tiled layers, so only use memory for the size of the layer. But since bug 1221094 we use mutli-tiled layers for them. So each of these short and wide layers are using tiles that are far too tall for them, hence the massive increase in memory usage. Bug 1243589 made it so that we don't use multi-tiled layers when the layers are smaller than the tile size, but only when both the width AND height are smaller, whereas these layers are short but wide.
We need to update that logic to consider width and height separately. I'm not sure what the correct heuristic would be, but these definitely shouldn't be being multi-tiled. That would fix this regression.
But I also want to find out why each email is getting its own layer in the first place. I'd guess it's something to do with them being transformed, but ideally they'd all be in the one large multi-tiled layer, at least until you hover over one and it gets animated.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1263083,26,"Thanks, Jamie. I am on a 4k display and the window is sized to be the entire height and half the width of the display. After your comment, I found that reducing the width substantially improved performance. This likely made each mail fit into one tile, so I think you are on the right track.",SOLUTION_REVIEW,1,FULL_TEXT
1263083,27,"Created attachment 8765412
Bug 1263083 - Use single-tile layer when less than half the tile size in either dimension;
Review commit: https://reviewboard.mozilla.org/r/60804/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/60804/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1263083,28,"The reason each email has its own layer is because they are marked as will-change. That is the right thing to do. But we should still be single-tiling instead of multi-tiling, so the above patch makes that the case.",SOLUTION_REVIEW,1,FULL_TEXT
1263083,29,"Comment on attachment 8765412
Bug 1263083 - Use single-tile layer when less than half the tile size in either dimension;
https://reviewboard.mozilla.org/r/60804/#review57906
The heuristic sounds good, but please factor out the condition into a separate variable and add a comment. Something like ""don't waste more than 50% of the tile's pixels in either direction"".",CODE_REVIEW,0,FULL_TEXT
1263083,30,Having a preferences for the magical factor would be an overkill?,QUESTION,0,FULL_TEXT
1263083,31,"I would say so, but if Markus or you strongly disagrees I'm happy to add it.",ANSWER_TO_QUESTION,0,FULL_TEXT
1263083,32,"Comment on attachment 8765412
Bug 1263083 - Use single-tile layer when less than half the tile size in either dimension;
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/60804/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1263083,33,"Made changes requested in comment 28.
try run here: https://treeherder.mozilla.org/#/jobs?repo=try&revision=f8a2ae3594fe526f1f531ede2db5ec2d9eef2ed4",UNCODED,0,UNMATCHED
1263083,34,"Pushed by cbook@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/81f94d11a924
Use single-tile layer when less than half the tile size in either dimension; r=mstange",UNCODED,0,UNMATCHED
1263083,35,https://hg.mozilla.org/mozilla-central/rev/81f94d11a924,UNCODED,0,UNMATCHED
1263083,36,Nightly is *dramatically* better now with Inbox. Thanks. I recommend we uplift this to 48 if you are comfortable.,UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1263083,37,"Comment on attachment 8765412
Bug 1263083 - Use single-tile layer when less than half the tile size in either dimension;
I'd uplift this to aurora no questions asked, possibly beta but we are late in the cycle?
Approval Request Comment
[Feature/regressing bug #]: bug 1221094
[User impact if declined]: Larger memory allocation, resulting in some websites (like google inbox) being unusably slow.
[Describe test coverage new/current, TreeHerder]: Been on central for almost a week.
[Risks and why]: Lowish. The change is straightforward. Could have a potential negative effect on websites with extremely long thin layers, but these will be rare and probably don't work great anyway.
[String/UUID change made/needed]: N/A",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1263083,38,"Not late - 48 happens to be an eight week beta, we have until the end of July.",ANSWER_TO_QUESTION,0,FULL_TEXT
1263083,39,"Comment on attachment 8765412
Bug 1263083 - Use single-tile layer when less than half the tile size in either dimension;
This patch fixes a performance regression. Take it in 48 beta 6 and aurora.",UPLIFT_APPROVAL,0,FULL_TEXT
1263083,40,Track this as risk mentioned in comment #36.,UNCODED,0,UNMATCHED
1263083,41,https://hg.mozilla.org/releases/mozilla-aurora/rev/b00ce8e9bee0,UNCODED,0,UNMATCHED
1263083,42,https://hg.mozilla.org/releases/mozilla-beta/rev/b1b864eb30c8,UNCODED,0,UNMATCHED
1263083,43,"I could not reproduce this bug using Fx 48.0a1 build ID:20160407062903 and ID:20160309030419, on OS X 10.11.1 (tested with both e10s enabled and disabled).
Can you please confirm if it is still reproducible on your platform?",VERIFICATION_REQUEST,0,FULL_TEXT
1263083,44,"I could never reproduce the slowness on my platform (Ubuntu), but I can confirm that the patch fixes what I believe was the cause of the slowness on OS X.",SOLUTION_VERIFICATION,0,FULL_TEXT
1268252,1,"Created attachment 8746231
runnable3.patch",UNCODED,0,UNMATCHED
1268252,2,https://hg.mozilla.org/integration/mozilla-inbound/rev/03c112d9c4df,UNCODED,0,UNMATCHED
1268252,3,https://hg.mozilla.org/mozilla-central/rev/03c112d9c4df,UNCODED,0,UNMATCHED
1287522,1,"ToString needs to be applied before retrieving the ""flags"" property.
Test case:
---
RegExp.prototype.toString.call({
  get source() {
    print(""get source"");
    return {toString() {print(""source-tostring"")}};
  },
  get flags() {
    print(""get flags"");
    return {toString() {print(""flags-tostring"")}};
  },
});
---
Expected: Prints ""source-tostring"" before ""get flags""
Actual: Prints ""source-tostring"" after ""get flags""",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1287522,2,"Created attachment 8772226
Apply ToString in correct order in RegExp.prototype.toString.
Added explicit ToString call to pattern and flags, in correct order, and renumbered the spec steps.",CODE_IMPLEMENTATION,1,FULL_TEXT
1287522,3,"https://hg.mozilla.org/integration/mozilla-inbound/rev/49bef2408c15ae8e76ee485bd8c338573fa8a1c7
Bug 1287522 - Apply ToString in correct order in RegExp.prototype.toString. r=evilpie",UNCODED,0,UNMATCHED
1287522,4,https://hg.mozilla.org/mozilla-central/rev/49bef2408c15,UNCODED,0,UNMATCHED
1297315,1,"Try Fix 
1. 
Warning: -Wmaybe-uninitialized in gfx/gl/GLContextProviderGLX.cpp: 'pixmap' may be used uninitialized in this function gfx/gl/GLContextProviderGLX.cpp:1328:80: warning: 'pixmap' may be used uninitialized in this function [-Wmaybe-uninitialized]
and 
gfx/gl/GfxTexturesReporter.cpp: 'unit' may be used uninitialized in this function
gfx/gl/GfxTexturesReporter.cpp:52:31: warning: 'unit' may be used uninitialized in this function [-Wmaybe-uninitialized]
2. Remove goto statement in C++ code.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1297315,2,"Created attachment 8783831
Bug 1297315 - Fix Wmaybe-uninitialized warning and get rid of goto statement in GLContextProviderGLX.cpp and GfxTexturesReporter.cpp.
Review commit: https://reviewboard.mozilla.org/r/73496/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/73496/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1297315,3,"Hi jmuizelaar,
I don't know who did the magic that passed -Wno-error=maybe-uninitialized to g++...
So it is against the warning as error.
Also I think removing goto statement is benefit for C++ code.
Please help to review this patch for fixing those warnings.
Thank you!",PROBLEM_MOTIVATION,0,FULL_TOKEN
1297315,4,"Bug 1297276 will rename the unused.h to Unused.h, so set the dependency.",NEW_ISSUE_FILING,0,FULL_TEXT
1297315,5,"Comment on attachment 8783831
Bug 1297315 - Fix Wmaybe-uninitialized warning and get rid of goto statement in GLContextProviderGLX.cpp and GfxTexturesReporter.cpp.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/73496/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1297315,6,"Hi jgilbert,
I don't know who did the magic that passed -Wno-error=maybe-uninitialized to g++...
So it is against the warning as error.
Also I think removing goto statement is benefit for C++ code.
Please help to review this patch for fixing those warnings.
Thank you!",UNCODED,0,UNMATCHED
1297315,7,"Comment on attachment 8783831
Bug 1297315 - Fix Wmaybe-uninitialized warning and get rid of goto statement in GLContextProviderGLX.cpp and GfxTexturesReporter.cpp.
https://reviewboard.mozilla.org/r/73496/#review71872
::: gfx/gl/GLContextProviderGLX.cpp:887
(Diff revision 2)
`while (false)`
::: gfx/gl/GLContextProviderGLX.cpp:1322
(Diff revision 2)
This doesn't need {}s. Don't change it.",CODE_REVIEW,0,FULL_TEXT
1297315,8,"Thanks for reviewing, please see my reply below.
If I use |while (false)|, it will break the loop without continuing, the logic is not as expectation.
Isn't it a good habit to use {} even it is only one line?
Or any policy that I should not modify this part.
Thank you.",QUESTION,0,FULL_TOKEN
1297315,9,"You're right about do{}while(false). We need while(true) for continue.
In this module, we want {} for single lines unless they are control flow statements. (return, break, continue)",CODE_REVIEW,0,FULL_TOKEN
1297315,10,"Mozilla coding style calls for bracing all control structures, even when the braces are redundant.[1] Is there a compelling reason for this code _not_ to follow that guideline?
(Skimming through the file concerned, I see that it's a bit of a mix, but even for the if-statements where the controlled code is a single |return| statement, the braced examples outnumber brace-less by at least 2:1, so it doesn't look like ""use the prevailing style"" readily trumps the style guide here...)
[1] https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Coding_Style#Control_Structures",CLARIFICATION,0,FULL_TEXT
1297315,11,"Comment on attachment 8783831
Bug 1297315 - Fix Wmaybe-uninitialized warning and get rid of goto statement in GLContextProviderGLX.cpp and GfxTexturesReporter.cpp.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/73496/diff/2-3/",UNCODED,0,UNMATCHED
1297315,12,"Thank you for reviewing, 
I did not modify the original style keeping it one line.
But I thnink Jonathan's comment is worth adopting however.",STATUS_UPDATE,0,FULL_TOKEN
1297315,13,"Pushed by ryanvm@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/f91e6ea2609b
Fix Wmaybe-uninitialized warning and get rid of goto statement in GLContextProviderGLX.cpp and GfxTexturesReporter.cpp. r=jgilbert",UNCODED,0,UNMATCHED
1297315,14,https://hg.mozilla.org/mozilla-central/rev/f91e6ea2609b,UNCODED,0,UNMATCHED
1300206,1,"Created attachment 8787780
log of build errors being fixed here
In bug 1269046, I'm tentatively planning on adding a new file called layout/generic/CSSAlignUtils.cpp.
When adding it (even as an empty file) to UNIFIED_SOURCES, it shifts unified-compilation grouping a bit, which breaks the build due to some files not including/""using"" stuff that they should.
Patch coming up to preemptively add some missing includes & declarations to avoid this problem.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1300206,2,"Created attachment 8787781
Bug 1300206: Add some missing #includes & namespaces in layout/generic, to prevent unified build bustage.
Review commit: https://reviewboard.mozilla.org/r/76468/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/76468/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1300206,3,"Comment on attachment 8787781
Bug 1300206: Add some missing #includes & namespaces in layout/generic, to prevent unified build bustage.
https://reviewboard.mozilla.org/r/76468/#review74558",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1300206,4,"Pushed by dholbert@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/459476bdc5d6
Add some missing #includes & namespaces in layout/generic, to prevent unified build bustage. r=mats",UNCODED,0,UNMATCHED
1300206,5,https://hg.mozilla.org/mozilla-central/rev/459476bdc5d6,UNCODED,0,UNMATCHED
1306719,1,"If couple of new source files added to the js/src/asmjs/ the build fails with:
/Users/yury/Work/mozilla-central/js/src/ds/MemoryProtectionExceptionHandler.cpp:132:25: error: use of undeclared
      identifier 'STDERR_FILENO'
    ssize_t ret = write(STDERR_FILENO, aStr, strlen(aStr) + 1);
                        ^
/Users/yury/Work/mozilla-central/js/src/ds/MemoryProtectionExceptionHandler.cpp:505:5: error: unknown type name
      'Thread'
    Thread handlerThread;
    ^
The MemoryProtectionExceptionHandler.cpp was pushed to the different unified build group (and looks like we don't test non-unified build for Mac OSX)",ERROR_MESSAGE,0,FULL_TOKEN
1306719,2,"Created attachment 8796698
fix-MemoryProtectionExceptionHandler.patch
(I did not check the Windows yet, which might have the same issue)",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1306719,3,"Comment on attachment 8796698
fix-MemoryProtectionExceptionHandler.patch
Erk, more non-unified bustage? Sorry about that.
I don't have Mac to compile this on locally, and we don't have a non-unified build in automation for OSX, but if this fixes compilation for you then it's fine.
Just did a non-unified build on Windows (was easier than I expected), confirmed nothing is missing there.",CODE_REVIEW,0,FULL_TOKEN
1306719,4,https://treeherder.mozilla.org/#/jobs?repo=try&revision=ec538f46ccaf50ebec1e1bdbc319ba28b8205219,UNCODED,0,UNMATCHED
1306719,5,"Pushed by ryanvm@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/5a68cafd32e5
Fix unified build compilation of MemoryProtectionExceptionHandler.cpp. r=ehoogeveen",UNCODED,0,UNMATCHED
1306719,6,https://hg.mozilla.org/mozilla-central/rev/5a68cafd32e5,UNCODED,0,UNMATCHED
1314193,1,"Created attachment 8806193
return-begin-transaction-fails
Basically the same as bug 1313770.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1314193,2,"Pushed by danderson@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/373c11f245a7
Early return in PresShell::Paint if BeginTransaction fails. r=dvander",PROBLEM_DESCRIPTION,0,FULL_TEXT
1314193,3,https://hg.mozilla.org/mozilla-central/rev/373c11f245a7,UNCODED,0,UNMATCHED
1315285,1,"Not sure this is really jemalloc4's fault or not, but starting with the Memory Allocator component for now until there's a better sense of what's going on here.
While testing the forthcoming jemalloc 4.3.0 release on Try, glandium and I noticed that Win8 in particular was hitting a lot of hangs along the line of the logs below (the dom-level* tests seem to be best for reliably triggering it):
https://treeherder.mozilla.org/logviewer.html#?job_id=30453758&repo=try
https://treeherder.mozilla.org/logviewer.html#?job_id=30453765&repo=try
Both win32 and win64 Talos also have been seeing hangs like:
https://treeherder.mozilla.org/logviewer.html#?job_id=30404691&repo=try
https://treeherder.mozilla.org/logviewer.html#?job_id=30399341&repo=try
I tried bisecting this to a broken jemalloc commit only to realize that it reproduced with the in-tree 4.1.1 version as well. I was eventually able to bisect it down to the debugging patch from bug 1293501 as the culprit.
To reproduce on Try, you should only need to make the following changes to the win32/win64 opt build configs, respectively:
https://hg.mozilla.org/try/diff/031fb63ab74b/browser/config/mozconfigs/win32/common-opt
https://hg.mozilla.org/try/diff/031fb63ab74b/browser/config/mozconfigs/win64/common-opt",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1315285,2,"Another stack:
https://treeherder.mozilla.org/logviewer.html#?job_id=30456590&repo=try",STACK_TRACE,0,FULL_TOKEN
1315285,3,For now I have no ideas how could VirtualProtect in necko cause hangs. Any ideas about what objects the ZwWaitForMultipleObjects is waiting for in memset?,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1315285,4,"4 of them are with EXCEPTION_ACCESS_VIOLATION_WRITE:
https://treeherder.mozilla.org/logviewer.html#?job_id=30453758&repo=try
  07:30:34     INFO -  Crash reason:  EXCEPTION_ACCESS_VIOLATION_WRITE
  07:30:34     INFO -  Crash address: 0x88486fb808
  07:30:34     INFO -  Assertion: Unknown assertion type 0x00000000
  07:30:34     INFO -  Process uptime: 42 seconds
  07:30:34     INFO -  Thread 1 (crashed)
  07:30:34     INFO -   0  KERNELBASE.dll!PostQueuedCompletionStatus + 0x108
https://treeherder.mozilla.org/logviewer.html#?job_id=30453765&repo=try
  07:28:52     INFO -  Crash reason:  EXCEPTION_ACCESS_VIOLATION_WRITE
  07:28:52     INFO -  Crash address: 0x84e72e78e8
  07:28:52     INFO -  Assertion: Unknown assertion type 0x00000000
  07:28:52     INFO -  Process uptime: 36 seconds
  07:28:52     INFO -  Thread 1 (crashed)
  07:28:52     INFO -   0  xul.dll!mozilla::BufferList<js::SystemAllocPolicy>::BufferList<js::SystemAllocPolicy>(mozilla::BufferList<js::SystemAllocPolicy> &&) [BufferList.h:533f238d2e70 : 97 + 0x0]
https://treeherder.mozilla.org/logviewer.html#?job_id=30399341&repo=try
  10:51:31     INFO -  Crash reason:  EXCEPTION_ACCESS_VIOLATION_WRITE
  10:51:31     INFO -  Crash address: 0x11bb0cc
  10:51:31     INFO -  Assertion: Unknown assertion type 0x00000000
  10:51:31     INFO -  Process uptime: 1 seconds
  10:51:31     INFO -  Thread 2 (crashed)
  10:51:31     INFO -   0  xul.dll!IPC::Channel::ChannelImpl::OutputQueuePop() [ipc_channel_win.cc:2ce763de722e : 103 + 0x0]
https://treeherder.mozilla.org/logviewer.html#?job_id=30456590&repo=try
  08:30:35     INFO - Crash reason:  EXCEPTION_ACCESS_VIOLATION_WRITE
  08:30:35     INFO - Crash address: 0x63c1f6a0e8
  08:30:35     INFO - Assertion: Unknown assertion type 0x00000000
  08:30:35     INFO - Process uptime: 42 seconds
  08:30:35     INFO - 
  08:30:35     INFO - Thread 1 (crashed)
  08:30:35     INFO -  0  xul.dll!mozilla::BufferList<InfallibleAllocPolicy>::BufferList<InfallibleAllocPolicy>(mozilla::BufferList<InfallibleAllocPolicy> &&) [BufferList.h:8a6d7d7e632d : 97 + 0x0]",STACK_TRACE,0,FULL_TOKEN
1315285,5,Those stacks don't seem the culprit I'm hunting for in bug 1293501 as those come with jemalloc4. Note the debug patch may stay a bit longer in the tree (and merge to Aurora) because I haven't seen any access violation write crashes that seems from it.,PROBLEM_REVIEW,0,FULL_TEXT
1315285,6,"... except the patch in bug 1293501 looks wrong to me.
First, it wastes a page by element in the array, even though only the beginning of that array is meant to be protected.
Second, the padding is not large enough to put what follows it out of the protected page.
Third, I don't see anything to handle the array being reallocated when its size changes. Which means the protected page stays there, and can end up being given away to something else by jemalloc, while the array itself is not protected anymore.
Essentially, it seems to me you're *very* lucky that those crashes are not happening with mozjemalloc already. In fact, for all I know, there may well be unidentified crashes due to that patch.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1315285,7,"Yes. But if I add padding to only first element, I'll need to overwrite the array functions for accessing the elements, which I think is too much work for debug.
I am not sure I understand, why is this needed? From the crash reports earlier, I found it's likely the first nsEntry in the array has nsCString mData 0x0, but the other fields remains valid. So the protected page includes:
  |nsTArrayHeader|nsEntry.header|padding|nsEntry.value.mData|
which covers mData's orginal address and the shifted address.
The only way to alternate the array is through nsHttpRequestHead APIs like:
https://dxr.mozilla.org/mozilla-central/rev/86f702229e32c6119d092e86431afee576f033a1/netwerk/protocol/http/nsHttpRequestHead.cpp#162
which each of them has ReentrantMonitorAutoEnter in the beginning of the function. The patch will unprotect the page in the constructor of ReentrantMonitorAutoEnter, and reprotect the page (of course by the updated array mHdr) in its destructor. Also when nsHttpRequestHead is destructed, the page will set back to readwrite.
Could be, but from crash-stats I don't see significant access violation write crashes seems to be caused by this:
https://crash-stats.mozilla.com/search/?reason=~EXCEPTION_ACCESS_VIOLATION_WRITE&build_id=%3E%3D20161012030211&product=Firefox&version=52.0a1&platform=Windows&date=%3E%3D2016-11-01T09%3A24%3A00.000Z&date=%3C2016-11-08T09%3A24%3A00.000Z&_sort=-date&_facets=signature&_columns=date&_columns=signature&_columns=product&_columns=version&_columns=build_id&_columns=platform#facet-signature",CLARIFICATION,0,FULL_TOKEN
1315285,8,Fixed by the bug 1293501 backout.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1316964,1,This is done by making them accept a `&T` where `T: AsRef<[$char_t]>` instead of a `&nsA[C]String`.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1316964,2,"Created attachment 8809943
Make the append and assign methods on the rust nsstring types more generic
MozReview-Commit-ID: 5y30BnUDKsT",PROBLEM_DESCRIPTION,0,FULL_TEXT
1316964,3,"Pushed by michael@thelayzells.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/e5c8e3d23cf2
Make the append and assign methods on the rust nsstring types more generic, r=froydnj",UNCODED,0,UNMATCHED
1316964,4,https://hg.mozilla.org/mozilla-central/rev/e5c8e3d23cf2,UNCODED,0,UNMATCHED
1319370,1,"Created attachment 8813100
filedis.html
User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36
Steps to reproduce:
Tested on latest Nightly 53.0a1 (2016-11-21) (64-bit)
-----------OS username disclosure--------
The webkitdirectory on fresh install and profile (or new website where directory has never been uploaded) seems to always default to 'C:\Users\{user}\Desktop'
1. Open PoC on a fresh URL where directory uploading has never been performed (to make sure it defaults to dekstop)
2. Hold down enter 
3. Since webkitdirectory keeps going back a folder every time its used, we only need to make sure a victim keeps hitting enter for at least 2-3 upload dialogues and then we would have successfully grabbed the OS username.
------------Arbitrary File Disclosure--------
Say you go to website 'A' and you upload a directory (doesn't actually have to upload, just as long as you loaded files) that exists in the folder 'C:\Users\{user}\Documents\', if we are able to run the attached PoC on website 'A' (say XSS or if website 'A' is codepen/jsfiddle..etc) we will be able to fool the user into uploading the entire contents of the 'My Documents' folder.
Here is one scenario:
1. Victim visits a codepen link that showcases html5 webkitdirectory.
2. Victim tests this new feature by uploading/selecting a random folder within 'My documents' then forgets about it.
3. Victim receives an attackers website which embeds a codepen code that uses the PoC here.
4. Victim then knowingly exposes his/her files.
As I mentioned, this can also be done with XSS vulnerabilities or possibly even URL spoofing.
Actual results:
In both scenarios we either disclose OS username or we have access to arbitrary files on victims computer.
Expected results:
Two suggestions:
1. Prevent input.click() from bypassing popup blocker, only allow it from mouse clicks.
2. Prevent the behavior where within the Documents folder and its contents (sub folders as well) be uploaded without explicitly choosing such an action. 
For some reason #2 so far only works on Documents folder, the folder uploader seems to ignore this behavior when on C: or desktop folder and others. But if it worked for My Documents my guess is it would work on other locations.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1319370,2,*unknowingly @ #4,UNCODED,0,UNMATCHED
1319370,3,"Based on bug 1188880, jwatt, do you know what's going on here?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1319370,4,"Baku, you were the last person to be working on this code. Can you look into this?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1319370,5,"This issue is about how we create a FilePicker and I suspect it is platform depending.
On linux, the GTK FilePicker (GTKFileChooser) has a default action. It means that, pressing 'enter', the user confirms the selection of the default selected file/directory.
We could remove the default action for GTK, windows and mac, or move the focus out of the action button.
I think we should move this bug to widget components.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1319370,6,Who's going to decide which way we go here?,SOLUTION_REVIEW_REQUEST,0,FULL_TEXT
1319370,7,"Created attachment 8813613
dir.patch
The bug was that, we were taking always the parent directory of the last selected file/directory. In this way we were exposing the full filesystem in this test script.",CODE_IMPLEMENTATION,1,FULL_TEXT
1319370,8,This is not sec-high. I land the patch.,STATUS_UPDATE,0,FULL_TEXT
1319370,9,"This patch landed months ago:
changeset:   324045:7477d9a20031
date:        Wed Nov 23 13:02:10 2016 +0100",CLARIFICATION,0,FULL_TOKEN
1319370,10,So what branches have the fix and does it need uplift?,QUESTION,0,FULL_TEXT
1319370,11,"Comment on attachment 8813613
dir.patch
Approval Request Comment
[Feature/Bug causing the regression]: Entries API
[User impact if declined]: wrong last-directory in nsIFilePicker
[Is this code covered by automated tests?]: none
[Has the fix been verified in Nightly?]: not yet
[Needs manual test from QE? If yes, steps to reproduce]: it's described in the bug.
[List of other uplifts needed for the feature/fix]: none
[Is the change risky?]: no
[Why is the change risky/not risky?]: this patch is already in aurora. The code just takes the directory path as last visited directory, in case the nsIFilePicker is in directory mode.
[String changes made/needed]: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1319370,12,"Comment on attachment 8813613
dir.patch
file picker fix, beta52+",UNCODED,0,UNMATCHED
1319370,13,"needs rebasing for beta
applying 1319370.patch
patching file dom/html/HTMLInputElement.cpp
Hunk #1 FAILED at 479
1 out of 3 hunks FAILED -- saving rejects to file dom/html/HTMLInputElement.cpp.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working directory
errors during apply, please fix and qrefresh 1319370.patch",SOLUTION_VERIFICATION,0,FULL_TOKEN
1319370,14,"Created attachment 8832478
m-b",UNCODED,0,UNMATCHED
1319370,15,https://hg.mozilla.org/releases/mozilla-beta/rev/227c1ff7e0fa,UNCODED,0,UNMATCHED
1319370,16,"Flagging this for manual testing, testcase & str in Comment 0.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1319370,17,"Both bugs still work 100% using Nightly 54.0a1 (2017-02-03) (64-bit)
Why is this marked fixed? What am I missing?",QUESTION,0,FULL_TEXT
1319370,18,"No idea, baku?",ANSWER_TO_QUESTION,0,FULL_TEXT
1319370,19,"I cannot reproduce this STR (from the description of the bug):
1. Open PoC on a fresh URL where directory uploading has never been performed (to make sure it defaults to dekstop)
2. Hold down enter 
3. Since webkitdirectory keeps going back a folder every time its used, we only need to make sure a victim keeps hitting enter for at least 2-3 upload dialogues and then we would have successfully grabbed the OS username.
We are not going back a folder every time. We stay on the current one.
If you see some other issues, please file a new bug.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1319370,20,"I think the problem I have is that there is still an arbitrary file disclosure.
Should I file a different report for the behavior where holding down enter can be used to trick someone into uploading arbitrary folder? Or more specifically, once the 'upload folder' dialog appears, a user should not be able to just hit enter and select the default/last used directory. A user must explicitly choose a folder using mouse or arrow keys",QUESTION,0,FULL_TOKEN
1319370,21,"Yes, please. It's a separate bug. Thanks. And NI me.",NEW_ISSUE_FILING,0,FULL_TEXT
1319370,22,Changed title for more accuracy. The local file disclosure has been split out into Bug 1338637.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1319370,23,"Reproduced the bad behavior on the current Release Version: 51.0.1 20170125094131, then proceeded to verify the fix on:
Ubuntu 16.04 x64 / Mac OS X 10.12 / Windows 10 x64 on the following builds:
54.0a1 20170302030206 
53.0a2 20170302004002
52.0   20170227080736
Based on the above marking this bug as verified and updating all tracking flags accordingly.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1324053,1,"Bug 1141814 made us disable speculative connect and DNS prefetching when the privacy.trackingprotection.annotate_channels pref is set by setting mLocalBlocklist to true here: <https://hg.mozilla.org/mozilla-central/rev/fb18b507a912#l4.22>
This is bad because according to bug 1122691, doing this can regress page load performance by about 3%.  We only need to do this if we're actually going to block such loads, since we'd be saving time by not running the tracking junk at all.  But we shouldn't be doing this merely to annotate channels.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1324053,2,"Created attachment 8819360
Ensure that speculative connect and DNS prefetching aren't disabled when annotating tracking channels",UNCODED,0,UNMATCHED
1324053,3,"Comment on attachment 8819360
Ensure that speculative connect and DNS prefetching aren't disabled when annotating tracking channels
Review of attachment 8819360:
-----------------------------------------------------------------
Thanks!",CODE_REVIEW,0,FULL_TEXT
1324053,4,"Pushed by eakhgari@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/688f10a74c64
Ensure that speculative connect and DNS prefetching aren't disabled when annotating tracking channels; r=mayhemer",UNCODED,0,UNMATCHED
1324053,5,https://hg.mozilla.org/mozilla-central/rev/688f10a74c64,UNCODED,0,UNMATCHED
1324183,1,"Created attachment 8819516
part-1-remove-Windows-version-checks.patch
Now that Firefox 53 no longer supports Windows XP or Vista, we can remove unnecessary Windows version checks for Vista and 7.",PROBLEM_MOTIVATION,0,FULL_TEXT
1324183,2,"Created attachment 8819517
part-2-remove-MediaUnsupportedBeforeWindowsVista.patch
Part 2: Remove MediaUnsupportedBeforeWindowsVista console message.",CODE_IMPLEMENTATION,1,FULL_TEXT
1324183,3,I have some more IsVistaOrLater() removals from dom/media/ coming in another patch.,STATUS_UPDATE,0,FULL_TEXT
1324183,4,"Comment on attachment 8819516
part-1-remove-Windows-version-checks.patch
Review of attachment 8819516:
-----------------------------------------------------------------
r+
You should try mozreview&autoland!",CODE_REVIEW,0,FULL_TEXT
1324183,5,"Comment on attachment 8819517
part-2-remove-MediaUnsupportedBeforeWindowsVista.patch
Review of attachment 8819517:
-----------------------------------------------------------------
r+ if you also remove the code that report 'sMediaUnsupportedBeforeWindowsVista' (lines 548,552-557 in the original version; search ""vista"" to find them)*.
You may also want to remove similar XP&Vista code in browser/base/content/browser-media.js and browser/locales/en-US/chrome/browser/browser.properties, but please r?gijs for it. It could be done in a separate bug if you prefer.
* See, if you had used mozreview, it would have made it easier for me to check this, and even to auto-quote the relevant part and flag the issue. ;-)",CODE_REVIEW,0,FULL_TOKEN
1324183,6,"Just for the records, I read bug 1146362 for the original reporting of the 4K videos Vista breakage, and it seems more of a driver/gpu shortcoming. 
Shouldn't you blacklist the adapters without the required hardware decoding if anything?
For example, on a fully updated Windows 7 with a Radeon 7750 and latest driver, even 1440p is already unusable (and oddly CPU isn't maxed out).",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1324183,7,"Sorry. I forgot to hg qrefresh some local changes.
Sorry again and thanks for the push. I will finally move to mozreview! <:)",UNCODED,0,UNMATCHED
1324183,8,"Matt, you disabled hardware decoding on XP and Vista in bug 1154536. mirh wonders whether we should be blocklisting the relevant drivers instead of Windows versions.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1324183,9,"I was specifically referring to lines 38-44 of your first patch (which thus would now be fixed). 
But in a more general sense, yes I was wondering why that choice in the first place: it looks pretty hurried and tentative, and perhaps the same mindset might have led to some other unexpected effect too. 
See also bug 1130266, comment 19",CLARIFICATION,0,FULL_TOKEN
1324183,10,"Pushed by cpeterson@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/9a768dc05d7e
Part 1: Remove some Windows Vista and 7 version checks in dom/media/. r=gerald
https://hg.mozilla.org/integration/mozilla-inbound/rev/86c08096f8c4
Part 2: Remove MediaUnsupportedBeforeWindowsVista console message. r=gerald",PROBLEM_DESCRIPTION,0,90_PCT_MATCH
1324183,11,"I didn't disable hardware decoding on XP/Vista, I stopped us reporting that we could play 4k videos at all (hardware or otherwise).
Neither XP nor Vista support 4k video decoding in hardware (on any hardware), so these videos would always be software.
The vista/XP check here is being used a proxy for processor speed (albeit not a very good one), so just removing it is fine.",SOLUTION_REVIEW,1,FULL_TOKEN
1324183,12,"I didn't mention general hardware decoding myself to be honest (Chris did)
Anyway, I was just wondering why there was that awkward check for 4k, other factors are definitively at stake. 
Checking for DXVA reported bits for example seemed pretty more comprehensive. 
AMD supports it starting with UVD 5 (GCN 1.2 cards). Which indeed have no Vista driver, true.
Then you have Intel, that for as much included a decoder all the way back to Ivy Bridge (which have also drivers for XP) possibly doesn't count that much given there's no way to ""retro-fit"" integrated graphics
But then you have nvidia, that only dropped those OS months ago (PureVideo HD5 starting from Kepler and a couple of Fermi chips btw). 
Oh right, software decoding is a thing too, I was forgetting lol. 
I'm not sure on the rationale behind that for 4K though. 
Yes I mean.. Perhaps with some beefy (at least 4 core) desktop CPU that should be possible, but putting aside it still seems a huge energy waste, I really wouldn't know how one would be able to discern between an Atom with hyper-threading and a Xeon.",SOLUTION_REVIEW,1,FULL_TOKEN
1324183,13,The discussion is going off-topic. Perhaps we should file a new bug to investigate a better way to determine whether we offer 4K.,NEW_ISSUE_FILING,0,FULL_TEXT
1324183,14,"https://hg.mozilla.org/mozilla-central/rev/9a768dc05d7e
https://hg.mozilla.org/mozilla-central/rev/86c08096f8c4",UNCODED,0,UNMATCHED
1324183,15,"Sure, sorry. 
Decide yourself if it would be worth then.",UNCODED,0,UNMATCHED
1324183,16,"Staying on topic (I think), I am still testing mozilla-central (firefox 53.0a1) on Windows Vista SP2 32bit here, and I can confirm that this bug 1324183 TOTALLY BROKE h264/aac playback on that OS (through 
WMF, with Platform Update Supplement for WinVistaSP2 (KB2117917) installed).
Last good build: 
buildID=20161218030213
https://hg.mozilla.org/mozilla-central/rev/a3ce1fce4f15616f66ac328e4a562d0117c93a0d
Proof: http://i.imgur.com/6u68iku.jpg
First bad build:
buildID=20161219030207
https://hg.mozilla.org/mozilla-central/rev/863c2b61bd27bb6099104933134d3be7c052551a
Proof: http://i.imgur.com/0HGmlaO.jpg
The net effect of this bug on a fully updated Vista OS is the same as toggling pref 
""media.wmf.enabled;true"" on a pre20161219 build.
But this pref is now irrelevant after bug 1324183 landed on the Dec 19th 2016 nightly build...",SOLUTION_VERIFICATION,0,FULL_TOKEN
1324183,17,"Vangelis, Firefox 53 and later no longer support Windows XP or Vista (bug 1130266). XP and Vista users running Firefox Beta or Release versions will be switched to the Firefox 52 ESR version, which will continue to support XP and Vista until 2018 Q1.
btw, how did you install those Nightly 53 builds? XP and Vista users running Nightly or Dev Edition should have stopped receiving nightly updates a few weeks ago (bug 1317780) and the Nightly and Dev Edition installers should prevent XP and Vista users from installing (bug 1305453).",CLARIFICATION,0,FULL_TOKEN
1324183,18,"Cause you haven't only installers for nightlies https://ftp.mozilla.org/pub/firefox/nightly/2016/12/2016-12-19-03-02-07-mozilla-central/ :p
Though.. I thought you didn't only rely on WMF for H264 (bug 1210231)?",ANSWER_TO_QUESTION,0,FULL_TOKEN
1324183,19,"Heh.  Thanks for the pointer; I filed bug 1324790 to give an error message for these kinds of cases.  Not out of spite, mind you, but because we're going to start using APIs elsewhere in the browser that don't exist on XP/Vista, and it'd be nice to give a reasonable error message up front rather than running into inscrutable errors later on.",NEW_ISSUE_FILING,0,FULL_TOKEN
1324183,20,"Well, shouldn't the OS already display such an error message in that case?
Also, as I said in bug 1130266, comment 19, if we are talking about Vista: that's *already* the case. 
AFAIK basically everything you could touch without also affecting W7 is already broken. 
Unless you are going to refine its support this last year in the ESR branch, I don't even see how FF52 and FF53 could even differ on this OS.",CLARIFICATION,0,FULL_TOKEN
1324183,21,"Sure.  But it'd be better for the error to be ""You can't run Firefox on this version of Windows"" or somesuch rather than ""cannot find library symbol FrobAllTheThings"" or similar.
I have no opinion here, as I know very little about what APIs are supported where on Windows.  But bug 1130266 comment 10's investigation suggests that there might be some sandboxing APIs that are only supported on Windows 7 and above?  Limited googling of the functions mentioned suggests that many of the APIs were added in XP, though... *shrug*
ESR is for security and regression fixes, not for any refinement of functionality or support.",QUESTION,0,FULL_TOKEN
1324183,22,"Mhh, makes sense.. insofar as people downloading firefox from ftp server doesn't *really* seem the kind that would need such a reminder, if I can explain. 
https://codereview.chromium.org/810083002#msg5
After quite a lot of digging, it seems they just decided to forbear Vista altogether, in any way (likely for the same venial reasons I mentioned thence)
As for XP, it truly didn't support the thing https://msdn.microsoft.com/en-us/library/windows/desktop/aa965848.aspx
Regardless, afaik Mozilla decided to drop XP and Vista for the burden (of guaranteeing a satisfactory experience) compared to the small user base. 
But for as much some users begged on continued XP support on the basis that it's still very popular (ignoring the fact its oldness easily beat that), I feel like on the other hand developers are ignoring Vista is already in its worst possible state. 
And following the aforementioned wondering, I hardly see a sense for this indeed.",CLARIFICATION,0,FULL_TOKEN
1325297,1,"If we use async notifications (as we want to in bug 1317562) during painting, we will not be able to determine if the decoding we do during painting resulted in a complete image. So we add a way to tell so we can still draw the image in the current paint.",PROBLEM_MOTIVATION,0,FULL_TEXT
1325297,2,"Created attachment 8821024
create StartDecodingWithResult",UNCODED,0,UNMATCHED
1325297,3,"Created attachment 8821025
Use the result of StartDecodingWithResult during painting",UNCODED,0,UNMATCHED
1325297,4,"Comment on attachment 8821024
create StartDecodingWithResult
Review of attachment 8821024:
-----------------------------------------------------------------
::: image/RasterImage.cpp
@@ +1061,5 @@
nit: extra whitespace at end of line",CODE_REVIEW,0,FULL_TEXT
1325297,5,"Pushed by tnikkel@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/3382306ba5c5
Create a variant of imgIContainer::StartDecoding that returns if the current image frame is complete. r=aosmond
https://hg.mozilla.org/integration/mozilla-inbound/rev/95f052c8d95a
Use the return value of StartDecoding to determine if an image finished decoding during painting. r=aosmond",UNCODED,0,UNMATCHED
1325297,6,"https://hg.mozilla.org/mozilla-central/rev/3382306ba5c5
https://hg.mozilla.org/mozilla-central/rev/95f052c8d95a",UNCODED,0,UNMATCHED
1325731,1,The read back data turns out to be swizzled for some reason.,PROBLEM_REVIEW,0,FULL_TEXT
1325731,2,This is fixed on my local webgl2 fixes branch.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1325731,3,"(I don't know which patch fixed it, unfortunately.",CLARIFICATION,0,FULL_TEXT
1325731,4,It's possible this was bug 1325741.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1325731,5,Please retest.,VERIFICATION_REQUEST,0,FULL_TEXT
1325731,6,"All good now, closing",SOLUTION_VERIFICATION,0,FULL_TEXT
1328511,1,"Some of our style system tests (test_visited_*) use setTimeout to wait for visited style being applied. However, stylo doesn't currently support visited style, so they would never get what they want.",PROBLEM_MOTIVATION,0,FULL_TEXT
1328511,2,"layout/style/test/test_visited_image_loading.html
layout/style/test/test_visited_image_loading_empty.html
layout/style/test/test_visited_lying.html
layout/style/test/test_visited_pref.html
layout/style/test/test_visited_reftests.html",UNCODED,0,UNMATCHED
1328511,3,It seems all tests mentioned here has been enabled in bug 1328509.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1329110,1,"Small functions are more likely to be reused.
We will split HandleAudioNotDecoded into:
1. HandleWaitingForAudio when the error code is NS_ERROR_DOM_MEDIA_WAITING_FOR_DATA.
2. HandleAudioCanceled when the error code is NS_ERROR_DOM_MEDIA_CANCELED.
3. HandleEndOfAudio when the error code is NS_ERROR_DOM_MEDIA_END_OF_STREAM.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1329110,2,"Created attachment 8825259
Bug 1329110. Part 1 - add HandleWaitingForAudio().
Review commit: https://reviewboard.mozilla.org/r/103430/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/103430/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1329110,3,"Created attachment 8825260
Bug 1329110. Part 2 - add HandleAudioCanceled().
Review commit: https://reviewboard.mozilla.org/r/103432/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/103432/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1329110,4,"Created attachment 8825261
Bug 1329110. Part 3 - add HandleEndOfAudio().
Review commit: https://reviewboard.mozilla.org/r/103434/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/103434/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1329110,5,"Created attachment 8825262
Bug 1329110. Part 4 - remove StateObject::HandleAudioNotDecoded().
Review commit: https://reviewboard.mozilla.org/r/103436/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/103436/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1329110,6,"Created attachment 8825263
Bug 1329110. Part 5 - split Split StateObject::HandleVideoNotDecoded into small functions.
Review commit: https://reviewboard.mozilla.org/r/103438/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/103438/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1329110,7,"Created attachment 8825264
Bug 1329110. Part 6 - remove StateObject::HandleWaitingForData().
Since DecodingState is the only one that overrides the function, we will let it
just override HandleWaitingFor{Audio,Video}. We also reduce the code complexity
because it is hard to trace the code when one virtual function calls another
virtual function.
Review commit: https://reviewboard.mozilla.org/r/103440/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/103440/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1329110,8,"Created attachment 8825265
Bug 1329110. Part 7 - remove StateObject::HandleEndOfStream().
The same reason as P6. We would like to avoid virtual functions calls
inside a virtual function.
Review commit: https://reviewboard.mozilla.org/r/103442/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/103442/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1329110,9,"Comment on attachment 8825259
Bug 1329110. Part 1 - add HandleWaitingForAudio().
https://reviewboard.mozilla.org/r/103430/#review104072
::: dom/media/MediaDecoderStateMachine.cpp:2181
(Diff revision 1)
Also copy this assertion into AccurateSeekingState::HandleWaitingForAudio() ?",CODE_REVIEW,0,FULL_TEXT
1329110,10,"Comment on attachment 8825260
Bug 1329110. Part 2 - add HandleAudioCanceled().
https://reviewboard.mozilla.org/r/103432/#review104074
::: dom/media/MediaDecoderStateMachine.cpp:2206
(Diff revision 1)
Same here.",CODE_REVIEW,0,FULL_TEXT
1329110,11,"Comment on attachment 8825261
Bug 1329110. Part 3 - add HandleEndOfAudio().
https://reviewboard.mozilla.org/r/103434/#review104076
::: dom/media/MediaDecoderStateMachine.cpp:2233
(Diff revision 1)
Here again.",CODE_REVIEW,0,FULL_TEXT
1329110,12,"Comment on attachment 8825262
Bug 1329110. Part 4 - remove StateObject::HandleAudioNotDecoded().
https://reviewboard.mozilla.org/r/103436/#review104078
::: dom/media/MediaDecoderStateMachine.cpp
(Diff revision 1)
Shouldn't we implement HandleWaitingForAudio(), HandleAudioCanceled() and HandleEndOfAudio() for the ShutdownState? We can put an assertion there or at least do nothing.
Same fo the video case.",CODE_REVIEW,0,FULL_TOKEN
1329110,13,"Comment on attachment 8825263
Bug 1329110. Part 5 - split Split StateObject::HandleVideoNotDecoded into small functions.
https://reviewboard.mozilla.org/r/103438/#review104080
::: dom/media/MediaDecoderStateMachine.cpp
(Diff revision 1)
Same issue here.",CODE_REVIEW,0,FULL_TEXT
1329110,14,"Comment on attachment 8825264
Bug 1329110. Part 6 - remove StateObject::HandleWaitingForData().
https://reviewboard.mozilla.org/r/103440/#review104082",UNCODED,0,UNMATCHED
1329110,15,"Comment on attachment 8825265
Bug 1329110. Part 7 - remove StateObject::HandleEndOfStream().
https://reviewboard.mozilla.org/r/103442/#review104084",UNCODED,0,UNMATCHED
1329110,16,"Comment on attachment 8825262
Bug 1329110. Part 4 - remove StateObject::HandleAudioNotDecoded().
https://reviewboard.mozilla.org/r/103436/#review104078
It will be done in bug 1329891 where the default implementation is to crash and states that expect the event (e.g. NS_ERROR_DOM_MEDIA_WAITING_FOR_DATA, NS_ERROR_DOM_MEDIA_CANCELED, or NS_ERROR_DOM_MEDIA_END_OF_STREAM) should override the virtual function to do something meaningful.",ANSWER_TO_QUESTION,0,FULL_TEXT
1329110,17,"Comment on attachment 8825263
Bug 1329110. Part 5 - split Split StateObject::HandleVideoNotDecoded into small functions.
https://reviewboard.mozilla.org/r/103438/#review104088
::: dom/media/MediaDecoderStateMachine.cpp
(Diff revision 1)
It will be done in bug 1329891 to improve the assertion/invariant.",ANSWER_TO_QUESTION,0,FULL_TEXT
1329110,18,"Comment on attachment 8825262
Bug 1329110. Part 4 - remove StateObject::HandleAudioNotDecoded().
https://reviewboard.mozilla.org/r/103436/#review104090",UNCODED,0,UNMATCHED
1329110,19,"Comment on attachment 8825263
Bug 1329110. Part 5 - split Split StateObject::HandleVideoNotDecoded into small functions.
https://reviewboard.mozilla.org/r/103438/#review104092",UNCODED,0,UNMATCHED
1329110,20,Thanks for the review!,UNCODED,0,UNMATCHED
1329110,21,"Comment on attachment 8825259
Bug 1329110. Part 1 - add HandleWaitingForAudio().
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/103430/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1329110,22,"Comment on attachment 8825260
Bug 1329110. Part 2 - add HandleAudioCanceled().
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/103432/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1329110,23,"Comment on attachment 8825261
Bug 1329110. Part 3 - add HandleEndOfAudio().
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/103434/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1329110,24,"Comment on attachment 8825262
Bug 1329110. Part 4 - remove StateObject::HandleAudioNotDecoded().
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/103436/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1329110,25,"Comment on attachment 8825263
Bug 1329110. Part 5 - split Split StateObject::HandleVideoNotDecoded into small functions.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/103438/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1329110,26,"Comment on attachment 8825264
Bug 1329110. Part 6 - remove StateObject::HandleWaitingForData().
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/103440/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1329110,27,"Comment on attachment 8825265
Bug 1329110. Part 7 - remove StateObject::HandleEndOfStream().
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/103442/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1329110,28,"Pushed by jwwang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/a38fae269e27
Part 1 - add HandleWaitingForAudio(). r=kaku
https://hg.mozilla.org/integration/autoland/rev/a79dbf426f4b
Part 2 - add HandleAudioCanceled(). r=kaku
https://hg.mozilla.org/integration/autoland/rev/b98174a7a769
Part 3 - add HandleEndOfAudio(). r=kaku
https://hg.mozilla.org/integration/autoland/rev/94b7ee3c58d4
Part 4 - remove StateObject::HandleAudioNotDecoded(). r=kaku
https://hg.mozilla.org/integration/autoland/rev/fc50385b69b0
Part 5 - split Split StateObject::HandleVideoNotDecoded into small functions. r=kaku
https://hg.mozilla.org/integration/autoland/rev/390ac9c6b655
Part 6 - remove StateObject::HandleWaitingForData(). r=kaku
https://hg.mozilla.org/integration/autoland/rev/bb6cb6b7cd9c
Part 7 - remove StateObject::HandleEndOfStream(). r=kaku",UNCODED,0,UNMATCHED
1329110,29,"https://hg.mozilla.org/mozilla-central/rev/a38fae269e27
https://hg.mozilla.org/mozilla-central/rev/a79dbf426f4b
https://hg.mozilla.org/mozilla-central/rev/b98174a7a769
https://hg.mozilla.org/mozilla-central/rev/94b7ee3c58d4
https://hg.mozilla.org/mozilla-central/rev/fc50385b69b0
https://hg.mozilla.org/mozilla-central/rev/390ac9c6b655
https://hg.mozilla.org/mozilla-central/rev/bb6cb6b7cd9c",UNCODED,0,UNMATCHED
1332070,1,"Enabling OpenGL plane splitting caused regressions for certain sites:
http://www.simulationcurriculum.com
https://github.com/webcompat/web-bugs/issues/4284",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1332070,2,"Created attachment 8828095
Test case to reproduce
Should be: red box with text foo
Renders: black box",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1332070,3,"Initially the regressions on these two sites seemed related, since both of them were using CSS transforms combined with transparency. However, they ended up being two separate problems (bug 1332268 and bug 1333934). These bugs are now fixed, which is why I am closing this bug.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1332070,4,Thanks Miko!,UNCODED,0,UNMATCHED
1339619,1,"neerja discovered that text-size-adjust doesn't use a keyword table, but instead uses VARIANT_AUTO and VARIANT_NONE, and then has to hardcode specified-style-to-computed-style conversion code in nsRuleNode.cpp (and the reverse in nsComputedDOMStyle.cpp)
It should just use a keyword table, for consistency.
(It's a keyword-valued property; might as well just use our standard keyword-valued-property codepaths, rather than trying to be tricky and hardcoding something more direct and more verbose/error-prone than the normal codepath.)
I think the files to change here are nsCSSPropList.h, nsRuleNode.cpp, and nsComputedDOMStyle.cpp, and nsCSSProps.*",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1339619,2,"I suspect the code exists in its current state (eschewing a keyword table) because it's probably a bit faster this way.
However, I claim the perf benefit here doesn't matter too much, since this is a prefixed property which likely doesn't get much usage.  So, better IMO to optimize for code-comprehensibility & maintainability in this case. (Particularly in the nsComputedDOMStyle::DoGetTextSizeAdjust[1] impl -- we can make that a nsCSSProps::ValueToKeywordEnum() invocation, rather than needing a switch statement. And particularly because this seems to be the *only* strictly-keyword-valued-property that does not use a keyword table.[2])
dbaron: are you OK with this change? If you'd prefer to leave this as-is, I'll defer to your judgement.  (It looks like this is code that you originally wrote back in bug 627842.)
[1] https://dxr.mozilla.org/mozilla-central/source/layout/style/nsComputedDOMStyle.cpp#4205
[2] I skimmed nsComputedDOMStyle for explicit ""SetIdent(eCSSKeyword"" calls and didn't find any others for pure-keyword-properties-with-no-keyword-table.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1339619,3,"(I filed this bug because our current implementation created a bit of confusion, by accident -- neerja mistakenly (but entirely understandably) assumed that she could implement ""column-span:all|none"" in exactly the same way that we implement ""-moz-text-size-ajust:auto|none"".  Both properties have 2 possible keyword values, one of which is ""none""; seems reasonable that they could have a very similar implementation. But, they can't, because we don't have special ""all"" handling like we do for ""auto"".)
So: in the interests of avoiding similar pitfalls in the future, I'd like to either:
 (1) bring us into alignment with all the other keyword-valued properties here
...OR
 (2) add a comment to the -moz-text-size-adjust section in nsCSSPropList.h to explicitly call out that it's different & hint at why.
I lean towards (1) but we could do (2) instead if you prefer -- dbaron, what do you recommend?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1339619,4,I'm fine with (1); I don't think I have particularly strong preferences here (but in the past I've tried to avoid mixing VARIANT_AUTO and VARIANT_NONE with things that have keyword tables).,SOLUTION_REVIEW,1,FULL_TEXT
1339619,5,"OK, thanks!
Agreed that that's desirable, and the end result of (1) will still adhere to that. (We'll shift from VARIANT_AUTO|VARIANT_NONE to VARIANT_HK, with eCSSKeyword_None & eCSSKeyword_Auto being the two keywords in the keyword table.)",SOLUTION_REVIEW,1,FULL_TEXT
1339619,6,"Created attachment 8838224
Bug 1339619 - Refactor parsing code for '-moz-text-size-adjust' to use the (more conventional) keyword table approach to calculate computed style.
Review commit: https://reviewboard.mozilla.org/r/113180/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/113180/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1339619,7,"Comment on attachment 8838224
Bug 1339619 - Refactor parsing code for '-moz-text-size-adjust' to use the (more conventional) keyword table approach to calculate computed style.
https://reviewboard.mozilla.org/r/113180/#review114678
Thanks! Looks good -- r=me with 2 nits addressed:
::: layout/style/nsComputedDOMStyle.h:438
(Diff revision 1)
Nit: move this a few lines further down, to be just after DoGetTextShadow.  That way, it'll be in alphabetical order, & it'll be consistent with the ordering you've used in the nsComputedDOMStyle.cpp file.
::: layout/style/nsRuleNode.cpp:4934
(Diff revision 1)
Comment here needs updating.  It should now say ""enum, inherit, initial"" I guess (matching the comments for the neighboring SetValue calls).",CODE_REVIEW,0,FULL_TOKEN
1339619,8,"Comment on attachment 8838224
Bug 1339619 - Refactor parsing code for '-moz-text-size-adjust' to use the (more conventional) keyword table approach to calculate computed style.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/113180/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1339619,9,"Pushed by ryanvm@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/bb0f9802f0d0
Refactor parsing code for '-moz-text-size-adjust' to use the (more conventional) keyword table approach to calculate computed style. r=dholbert",UNCODED,0,UNMATCHED
1339619,10,https://hg.mozilla.org/mozilla-central/rev/bb0f9802f0d0,UNCODED,0,UNMATCHED
1343787,1,"This bug was filed from the Socorro interface and is 
report bp-51e020b8-569c-44a4-b41c-a096a2170206.
=============================================================
We failed the assertion at
http://searchfox.org/mozilla-central/rev/31b6089ce26fa76459642765115605d50a6c67b4/dom/media/MediaShutdownManager.cpp#98
Somehow the media element tried to create a decoder after shutdown had begun.",FILED_FROM_OTHER_ISSUE,0,FULL_TOKEN
1343787,2,"Created attachment 8843175
Bug 1343787. Part 1 - allow MediaShutdownManager::Register() to fail.
Review commit: https://reviewboard.mozilla.org/r/116940/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/116940/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1343787,3,"Created attachment 8843176
Bug 1343787. Part 2 - move the Register() calls to Load().
Review commit: https://reviewboard.mozilla.org/r/116942/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/116942/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1343787,4,"Comment on attachment 8843176
Bug 1343787. Part 2 - move the Register() calls to Load().
https://reviewboard.mozilla.org/r/116942/#review118578",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1343787,5,"Comment on attachment 8843175
Bug 1343787. Part 1 - allow MediaShutdownManager::Register() to fail.
https://reviewboard.mozilla.org/r/116940/#review118580",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1343787,7,"Pushed by jwwang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/063290664ef1
Part 1 - allow MediaShutdownManager::Register() to fail. r=gerald
https://hg.mozilla.org/integration/autoland/rev/32f15879f537
Part 2 - move the Register() calls to Load(). r=gerald",UNCODED,0,UNMATCHED
1343787,8,"https://hg.mozilla.org/mozilla-central/rev/063290664ef1
https://hg.mozilla.org/mozilla-central/rev/32f15879f537",UNCODED,0,UNMATCHED
1343787,9,"If I'm reading crash-stats correctly, this affects 52 and 53 as well. Too late for Fx52 at this point, but please request Aurora and ESR52 approval on this when you get a chance.",UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1343787,10,Indeedy -- this is ranked #12 in the crashes for Windows Aurora of 20170302004002.,UNCODED,0,UNMATCHED
1343787,11,"Created attachment 8843801
1343787_aurora_53_fix.patch",UNCODED,0,UNMATCHED
1343787,12,"Comment on attachment 8843801
1343787_aurora_53_fix.patch
Approval Request Comment
[Feature/Bug causing the regression]:unknown
[User impact if declined]:crash
[Is this code covered by automated tests?]:yes
[Has the fix been verified in Nightly?]:yes
[Needs manual test from QE? If yes, steps to reproduce]: no
[List of other uplifts needed for the feature/fix]:1336356 must be uplifted first.
[Is the change risky?]:low risk
[Why is the change risky/not risky?]:The change is simple which add error handling to some functions.
[String changes made/needed]:none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1343787,13,"Comment on attachment 8843801
1343787_aurora_53_fix.patch
Part three of a big media shutdown crash fix, please uplift this after the patches in bug 1336345 and bug 1336356.",CODE_REVIEW,0,FULL_TEXT
1343787,14,https://hg.mozilla.org/releases/mozilla-beta/rev/9c697f08d301,UNCODED,0,UNMATCHED
1343787,15,Setting qe-verify- based on JW Wang's assessment on manual testing needs (see Comment 11) and the fact that this fix has automated coverage.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1343787,16,"Created attachment 8847918
1343787_esr52_fix.patch",UNCODED,0,UNMATCHED
1343787,17,"Comment on attachment 8847918
1343787_esr52_fix.patch
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
User impact if declined: crash
Fix Landed on Version:54
Risk to taking this patch (and alternatives if risky): The change is simple which add error handling to some functions. This patch has been uplifted to 54 and 53.
String or UUID changes made by this patch: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1343787,18,"Comment on attachment 8847918
1343787_esr52_fix.patch
crash fix, regression in 52, esr52+",UPLIFT_APPROVAL,0,FULL_TEXT
1343787,19,https://hg.mozilla.org/releases/mozilla-esr52/rev/28287b7f0938,UNCODED,0,UNMATCHED
1344721,1,"Created attachment 8843977
Patch
We need the null check if the value's type is MIRType::ObjectOrNull, but we don't need it in the more common MIRType::Object case.",CODE_IMPLEMENTATION,1,FULL_TEXT
1344721,2,"Comment on attachment 8843977
Patch
Review of attachment 8843977:
-----------------------------------------------------------------
Nice.",CODE_REVIEW,0,FULL_TEXT
1344721,3,"Pushed by jandemooij@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/9c62ab1bfb8a
Eliminate unnecessary null check from Ion post barriers when we know the object is non-null. r=jonco",UNCODED,0,UNMATCHED
1344721,4,This patch regressed Octane Deltablue and Richards on AWFY (but only on the Mac 64-bit machine),SOLUTION_VERIFICATION,0,FULL_TEXT
1344721,5,Yeah it's mysterious. The patch just eliminates a test+jump instruction so it must be some kind of caching or alignment issue.,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1344721,6,https://hg.mozilla.org/mozilla-central/rev/9c62ab1bfb8a,UNCODED,0,UNMATCHED
1354406,1,"Some of the reftests that is in the form:
== foo.html#bar foo-ref.html
Since the URL contains a #bar component, it will probably not reload but simply scrolls, making the test fail. So we probably need to do the original test-vs-ref test instead of test-vs-test to maintain the test coverage.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1354406,2,status-firefox57=wontfix unless someone thinks this bug should block 57,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1354406,3,Resolving WONTFIX because we will be retiring styloVsGecko reftests in Nightly 59 when we remove Gecko's old style system (stylo-everywhere bug 1395112).,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1354406,4,This was fixed by bug 1417251 FWIW.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1357065,1,"Right now there is just one WR api, push_scroll_layer, to push a clip (ignoring the fact that you can set a per-display-item clip). Therefore we expose only one API in WebRenderAPI.h, called PushScrollLayer. However according to the CLIPPING.md documentation in webrender this API accepts both scrolling and non-scrolling clips, which are conceptually different, so we should really expose this as two separate APIs. Also note that in upstream WR push_scroll_layer has already been renamed to push_clip_node which is a more appropriate name.",PROBLEM_MOTIVATION,0,FULL_TEXT
1357065,2,"Try push is looking green: https://treeherder.mozilla.org/#/jobs?repo=try&revision=529ac25bb2049b92ac7147b3418c7e1321a03373
Also note that I suspect some of these clips we're pushing from WebRenderContainerLayer are probably unnecessary. I tried removing the ones I thought were unnecessary and got crashes in webrender, for which I filed https://github.com/servo/webrender/issues/1122. Once that is resolved I'll try that again.
I also suspect that we might not be pushing enough clips from WebRenderDisplayItemLayer - right now it checks to see if there is a mask layer and only pushes a clip in that case. We probably also need to push a clip if there is a non-empty cliprect set on the Layer. I'll investigate and file a follow-up if needed.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1357065,3,"Created attachment 8858806
Bug 1357065 - Rename the parameters to PushScrollLayer to be more correct.
This changes the parameters to be in line with the clipping documentation.
Review commit: https://reviewboard.mozilla.org/r/130832/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/130832/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1357065,4,"Created attachment 8858807
Bug 1357065 - Add a PushClip/PopClip API to WebRenderAPI to more easily distinguish between scrolling clips and non-scrolling clips.
Note that in upstream WR the push_scroll_layer API has already been
renamed to push_clip_node, so conceptually the same API covers both
""scrolling clips"" (aka scroll layers) and non-scrolling clips. So using
the same underlying API for two different WebRenderAPI.h functions makes
sense.
Review commit: https://reviewboard.mozilla.org/r/130834/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/130834/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1357065,5,"Created attachment 8858808
Bug 1357065 - Update WebRenderDisplayItemLayer to use PushClip instead of PushScrollLayer because it's pushing a non-scrolling clip.
Review commit: https://reviewboard.mozilla.org/r/130836/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/130836/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1357065,6,"Comment on attachment 8858806
Bug 1357065 - Rename the parameters to PushScrollLayer to be more correct.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/130832/diff/1-2/",AUTO_REV_REQ_UP_CODE_REVIEW_REQUEST,0,FULL_TEXT
1357065,7,"Comment on attachment 8858807
Bug 1357065 - Add a PushClip/PopClip API to WebRenderAPI to more easily distinguish between scrolling clips and non-scrolling clips.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/130834/diff/1-2/",AUTO_REV_REQ_UP_CODE_REVIEW_REQUEST,0,FULL_TEXT
1357065,8,"Comment on attachment 8858808
Bug 1357065 - Update WebRenderDisplayItemLayer to use PushClip instead of PushScrollLayer because it's pushing a non-scrolling clip.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/130836/diff/1-2/",AUTO_REV_REQ_UP_CODE_REVIEW_REQUEST,0,FULL_TEXT
1357065,9,"Comment on attachment 8858806
Bug 1357065 - Rename the parameters to PushScrollLayer to be more correct.
https://reviewboard.mozilla.org/r/130832/#review133794",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1357065,10,"Comment on attachment 8858807
Bug 1357065 - Add a PushClip/PopClip API to WebRenderAPI to more easily distinguish between scrolling clips and non-scrolling clips.
https://reviewboard.mozilla.org/r/130834/#review133802",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1357065,11,"Comment on attachment 8858808
Bug 1357065 - Update WebRenderDisplayItemLayer to use PushClip instead of PushScrollLayer because it's pushing a non-scrolling clip.
https://reviewboard.mozilla.org/r/130836/#review133804",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1357065,12,"Pushed by kgupta@mozilla.com:
https://hg.mozilla.org/projects/graphics/rev/a189001eb45c
Rename the parameters to PushScrollLayer to be more correct. r=jrmuizel
https://hg.mozilla.org/projects/graphics/rev/2eaff244ab0f
Add a PushClip/PopClip API to WebRenderAPI to more easily distinguish between scrolling clips and non-scrolling clips. r=jrmuizel
https://hg.mozilla.org/projects/graphics/rev/3ff6854f3ef8
Update WebRenderDisplayItemLayer to use PushClip instead of PushScrollLayer because it's pushing a non-scrolling clip. r=jrmuizel",UNCODED,0,UNMATCHED
1357065,13,"https://hg.mozilla.org/mozilla-central/rev/a189001eb45c
https://hg.mozilla.org/mozilla-central/rev/2eaff244ab0f
https://hg.mozilla.org/mozilla-central/rev/3ff6854f3ef8",UNCODED,0,UNMATCHED
1357386,2,"Created attachment 8859505
bug_1357386_telemetry_data_toplevel.patch
I am happy to modify the patch if we can think of any other information we could gather, but I think that's pretty much the best we can do, right?",CODE_IMPLEMENTATION,1,FULL_TEXT
1357386,3,"Comment on attachment 8859505
bug_1357386_telemetry_data_toplevel.patch
Review of attachment 8859505:
-----------------------------------------------------------------
datareview+",CODE_REVIEW,0,FULL_TEXT
1357386,4,"Comment on attachment 8859505
bug_1357386_telemetry_data_toplevel.patch
Review of attachment 8859505:
-----------------------------------------------------------------
Is this all the information we need? I suspect we're going to find out that compared to the number of documents and frames loaded data: urls are a very small fraction. What then? Are there types of data documents we can carve out to get a better sense of what we might break? My first thought was to count sandboxed data: documents because clearly we can't break those, but since such documents would be essentially sandboxed in Chrome already maybe web devs wouldn't bother to add that attribute.
I'd like to know what fraction of top-level data: documents are from navigations/links vs manual entry or bookmark. Whether or not there's a referrer could be a proxy for that, although Referrer Policy and/or user prefs can mess that up. Is there an easy way to check the ""real"" referrer from that point in DocShell? If not I could live with the simpler method and just hope Referrer Policy isn't used much to completely blank the referrer.
Would prefer some descriptive #define or const for the buckets rather than raw numbers, though not sure where you'd stick them that would make much sense. If we ever added buckets that we counted elsewhere it would be even more important.
r- mainly for not counting ""developer"" use of data: vs ""web"" encounters -- I think that's important to help us judge scale.",CODE_REVIEW,0,FULL_TOKEN
1357386,5,"Created attachment 8870383
bug_1357386_telemetry_data_toplevel.patch
Dan, thanks for your feedback. I flipped the patch around entirely. In fact we are only interested in top level data: URI loads and whether they are navigated or typed into the URL Bar (by a developer or also come from a bookmark).
This patch relies on the triggeringPrincipal (which in most cases is identical to the referrer but also agnostic to the referrer policy). Whenever the a toplevel page is navigated then the triggeringPricnipal is a codebasePrincipal. When typing a data URL into the address bar, the triggeringPrincipal is a systemPrincipal. Similar when clicking a bookmark, then the triggeringPrincipal is a systemPrincipal.
I think that should provide exactly the information we are seeking for: what breakage can we expect if we disallow navigations to data: URIs for toplevel loads.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1357386,6,"Pushed by mozilla@christophkerschbaumer.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/59567c6c1e71
Have loadTabs() tests provide the correct triggeringPrincipal. r=gijs,kit
https://hg.mozilla.org/integration/mozilla-inbound/rev/2b92af4575ae
Have loadTabs() provide the correct triggeringPrincipal. r=gijs,smaug",UNCODED,0,UNMATCHED
1357386,7,"Backout by cbook@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/c928f0602185
Backed out changeset 2b92af4575ae 
https://hg.mozilla.org/integration/mozilla-inbound/rev/c51a2eaa0078
Backed out changeset 59567c6c1e71 for landing with wrong bugnumber",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1357386,8,"Why aren't we interested in frames also? I would guess (based on nothing!) that data: in frames is more common than navigating or window.open()ing a data: document. 
The sad thing is that none of these measures tells us what we really want to know: how much breakage would we cause by making data: urls not inherit. We might count tons of data: documents but have them all turn out to be perfectly fine without inheritance because they were written for all the other browsers.
We have a pref that flips the behavior so we could do a shield or pref-flipping experiment -- except we need a way to measure the effects if we do so. Where's a good place for that? Maybe the cross-compartment wrapper access check? If it fails check to see if the target or source compartment is a data: url. By doing it on the failure path we should avoid perf impacts (but of course we should measure that, too, as part of the test). Some access failures might be normal, but we could compare the rates from the test groups vs the global population.
The drawback to that is that a small sample study is likely to miss the specific cases that might break: ""Firefox-required"" internal apps for particular enterprises. I guess they could just flip the pref as part of their roll-out.",SOLUTION_REVIEW,1,FULL_TOKEN
1357386,9,"Maybe we could start by testing it out in Nightly? Again, it won't tell us about the release population, but it's cheap and it might surface things we haven't thought about.",ANSWER_TO_QUESTION,0,FULL_TEXT
1357386,10,"It seems there is some confusion on what this bug is about - let me clarify: For this bug we want to measure breakage if we 'block data: URIs in top level windows' (See Bug 1331351). This measurements have nothing to do with the inheritance change of data: URIs we are doing within Bug	1324406. To this end, I don't think we are interested in (i)frame loads, only in top level loads. Ultimately we would like to distinguish how many developers type 'data:' in the URL bar to test something, we don't want to block those, but we want to figure out how many top level windows get navigated to a data: URI - those we want to measure and ultimately block.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1357386,11,"Ah. This bug is blocking both bug 1324406 and bug 1331351 so I thought it was trying to gather telemetry for both. We already have bug 1302399 for that, I guess. Can we remove bug 1324406 from the blocked list here then? Thanks for the clarification.",QUESTION,0,FULL_TEXT
1357386,12,"Comment on attachment 8870383
bug_1357386_telemetry_data_toplevel.patch
Review of attachment 8870383:
-----------------------------------------------------------------
If this telemetry is only for bug 1357386 then this is fine. r=dveditz",CODE_REVIEW,0,FULL_TEXT
1357386,13,"Ah, that caused the confusion -> Reoving Bug 1324406 from the blocklist!",ANSWER_TO_QUESTION,0,FULL_TEXT
1357386,14,"Pushed by mozilla@christophkerschbaumer.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/96875dd613f8
Gather telemetry for toplevel data: URI loads. r=dveditz,francois",PROBLEM_DESCRIPTION,0,FULL_TEXT
1357386,15,https://hg.mozilla.org/mozilla-central/rev/96875dd613f8,UNCODED,0,UNMATCHED
1359490,1,"Even something as simple as:
template<typename Pred>
void
SpinEventLoopUntil(Pred aPredicate, nsIThread* aThread = nullptr)
{
  nsIThread* thread = aThread ? aThread : NS_GetCurrentThread();
  while (!aPredicate()) {
    MOZ_ALWAYS_TRUE(NS_ProcessNextEvent(thread, true));
  }
}
would be a little bit nicer than what we have, and would be slightly more efficient for a lot of the cases that we have.  For Quantum DOM, this change would also enable us to add the thread-yielding smarts we need in one place, rather than having it scattered all over.
With any luck, we can *almost* eliminate NS_ProcessNextEvent except from a few well-known places.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1359490,2,"One sadness here is that the predicate typically has to access member variables and/or functions, and for refcounted things, that means we have to take an extra reference to satisfy the static analysis.  Kind of unfortunate, but that's life.",REQUIREMENT,0,FULL_TOKEN
1359490,3,"Would there be a way to mark such functions, to indicate that they're using their function object parameters straight away?",QUESTION,0,FULL_TEXT
1359490,4,"Probably!  But it seems better to modify the static analysis to perform some sort of limited escape analysis on the lambda.  Something like:
* Not stored anywhere;
* Not passed to other functions;
* Not captured by other lambdas (which I guess is a special case of storing?).
Lambdas that pass the above, and maybe some other checks I haven't thought of, ought to be able to capture `this` without problems...though I think last time we tried to relax the analysis, we started writing use-after-free bugs.  So we'd have to be very careful in defining our conditions.",REQUIREMENT,0,FULL_TOKEN
1359490,5,"Created attachment 8862614
add an event loop spinning abstraction function
This function is arguably nicer than calling NS_ProcessNextEvent
manually, is slightly more efficient, and will enable better auditing
for NS_ProcessNextEvent when we do Quantum DOM scheduling changes.
Things I'd especially like feedback on:
* Lambda syntax; this is my first significant patch with lambdas;
* The big comment before ProcessFailureBehavior.  Strictly speaking, we don't
  *need* the enum, as we could just do:
  while (!SpinEventLoopUntil(...)) {}
  but that seems kind of ugly.  Better ways to address this welcome.
* Other things that I may not have thought of here!",CODE_IMPLEMENTATION,1,FULL_TOKEN
1359490,6,"To be clear, this patch passes the static analysis, so the concerns from comment 1 are unfounded!",SOLUTION_VERIFICATION,0,FULL_TEXT
1359490,7,"Comment on attachment 8862614
add an event loop spinning abstraction function
Review of attachment 8862614:
-----------------------------------------------------------------
r+ with my small nits addressed (or ignored as appropriate).
Happy to re-review if you implement my crazy suggestions!
::: devtools/server/nsJSInspector.cpp
@@ +73,5 @@
'&' also captures '*this' by reference, so 'this' is not needed.
(And more cases in this patch.)
::: dom/filehandle/ActorsParent.cpp
@@ +945,5 @@
In this kind of cases (only accessing member variables), `[this]` should be enough.
::: dom/indexedDB/ActorsParent.cpp
@@ +13596,5 @@
I'd unindent `}));` to be two columns left, below `return false;`.
::: dom/network/UDPSocketChild.cpp
@@ +122,5 @@
No more warning in the error case, is that intended?
::: dom/quota/ActorsParent.cpp
@@ -2861,5 @@
You removed the MOZ_ALWAYS_TRUE, is that intended?
(Guessing: Probably yes, otherwise we would have got crash reports by now.)
::: dom/workers/ServiceWorkerRegistrar.cpp
@@ -992,5 @@
Wow, someone worked really hard to write a `do while` loop!
I'm guessing that doing the extra initial test now is fine though.
No more MOZ_ALWAYS_TRUE?
::: media/webrtc/signaling/test/signaling_unittests.cpp
@@ +3669,5 @@
Assuming gFoo is global, there's no need to capture it.
::: storage/mozStorageService.cpp
@@ +944,3 @@
Forget anyOpen, just do: `for(){if(){/*still open*/ return false;}} /*all closed*/ return true;`
::: toolkit/components/url-classifier/tests/gtest/Common.cpp
@@ -60,5 @@
You didn't keep the PR_Sleep -- intended?
::: xpcom/threads/SharedThreadPool.cpp
@@ -77,5 @@
The assertion doesn't just work inside the lambda?
::: xpcom/threads/ThrottledEventQueue.cpp
@@ -258,5 @@
No more MOZ_ALWAYS_TRUE?
::: xpcom/threads/nsThread.cpp
@@ +995,5 @@
I think you should put the full argument here!
::: xpcom/threads/nsThreadUtils.h
@@ +256,5 @@
No need for the `enum` keyword here.
@@ +259,5 @@
0. Returned bool
I think you should document what its value means, probably in the first doc block above.
And it would gently introduce the behaviors. :-)
I see most calls just ignore it. It seems a bit dangerous in a way, especially when the default behavior mentions ""Report"", but then we ignore that report!
Crazy thinking about that: How about having two specializations, so that either the function will be `void`, or will return `MOZ_MUST_USE bool` (Assuming MOZ_MUST_USE can indeed be selectively applied to a specialization.)
Tweaked behaviors could be:
- ProcessFailureBehavior::ReportToCaller -> `MOZ_MUST_USE bool`, and `return false;` if !didSomething.
- ProcessFailureBehavior::Stop -> `void`, and `return;` if !didSomething.
- ProcessFailureBehavior::IgnoreAndContinue -> `void` and no early return.
I'd vote for ReportToCaller to still be the default, as it should force people to think a bit about which behavior to pick at every call, because either they'll need to understand and deal with the return value, or explicitly choose a non-returning behavior.
1. Function name:
Strictly speaking, you're not spinning ""Until"", but more ""WhileNot"" -- i.e., the predicate is tested even before the first event-processing loop.
But it sounds a bit awkward and mind-bending, so I'm not sure it would be such a good idea?
Alternatively, you could change it to ""While"", i.e., reverse the predicate's meaning -- but then you'd have to change every caller! :-P
However most of the original loops were `while (pred)`, which means the predicate would stay the same as it was, instead of having to reverse it as you have (painfully) done!
But then again, it's probably simpler to usually think about how to end a loop, instead of when to keep it running, so as a user I would probably like Until/WhileNot better.
AARGH! Sorry for the over-thinking. I'll let you decide...
2. Predicate parameter:
Take it by '&&'. As it's a templated type, the most appropriate passing method will be taken, potentially avoiding some copies.
@@ +269,5 @@
Instead of `if (B==I) { continue; } else if (!d) {return}` you could just do `if (B==R && !d) {return}`, it feels simpler to me in this case.
::: xpfe/appshell/nsXULWindow.cpp
@@ +2003,5 @@
`[=]` seems wrong; why not `[&]` like everywhere else?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1359490,8,"To clarify, I meant two columns left compared to the return statement, i.e.:",CLARIFICATION,0,80_PCT_MATCH
1359490,9,"Thanks for the review!
Sort of.  I guess we could warn.
Ah, no.  I was originally moving MOZ_ALWAYS_TRUE into the event loop spinner itself, but that's obviously not correct in general.
Same deal here.
Ugh.  So it was intended, because this is silly code: try to process an event if one's there...if not, sleep, and then try to do the same thing again.  Why not just wait in the thread's event queue itself instead?  Probably more efficient.
I thought the condition is set by a runnable sent to the current thread.  But it can actually be triggered by runnables run on other threads (?).  The comment suggests that we have to do things this way because other code can run on this thread (?), but I think the person who wrote the comment must have been confused.
Upshot: I think the conversion is correct, but you have to squint at it kind of funny to see.
Oh, it probably does!  I guess it will be checked ""outside"" the loop, but that's probably not such a bad thing.
Same deal as before.
I kind of like this idea, but then I have to audit every site that I use this function at, and I'm not confident of being able to identify the correct behavior at every site.  I guess maybe ReportToCaller for all the places that use MOZ_ALWAYS_TRUE or similar, and IgnoreAndContinue for everybody else?  I'm also not sure that Stop would ever be the correct behavior during shutdown, for reasons (obliquely) described in the comment for the enum.
I like the Until variant, seems more natural to me.
 
Fair enough.",SOLUTION_REVIEW,1,FULL_TEXT
1359490,10,"Apparently this is not the case; the patch consistently times out on Mac GTests, while being OK everywhere else.  Henry wrote this code in bug 1339050...Henry, why are we not waiting inside NS_ProcessNextEvent here?  What do the threads doing the async update look like at this point?  Does having to busy-wait here mean that |done| is getting written from some other thread than the one doing the waiting (ugh)?",QUESTION,0,FULL_TOKEN
1359490,11,"Hi Nathan,
AysncApplyUpdate() would just post an event to a separate thread (let's call it
the update thread) for update and notify the result via a callback on the 
caller thread. 
The intention is to wrap that AysncApplyUpdate() to a synchronous update API
for test case itself. (since the very original API is synchronous and all the
test cases were written with that assumption in mind.)
I was supposed to use a condition variable or a simple busy-wait to synchronize with 
the AsyncApplyUpdate()'s completion. However, I ended up failing to do any of them
because somewhere on the update thread would ""SyncRunnable to main thread"" 
be done for initializing NS_CRYPTO_HASH_CONTRACTID [1], which is triggered by [2].
As a result, on the main thread, we have to wait and process pending events
to unblock the update thread. |done| is only a flag for the main thread to know
if AsyncApplyUpdate() has been complete.
To get rid of that busy-wait, I have no better solution than pre-initializing
NS_CRYPTO_HASH_CONTRACTID on non-main thread prior to calling AsyncApplyUpdate().
However, in that case, we still have to synchronize with the completion of 
creating NS_CRYPTO_HASH_CONTRACTID on the main thread.
[1] http://searchfox.org/mozilla-central/rev/6580dd9a4eb0224773897388dba2ddf5ed7f4216/security/manager/ssl/nsNSSComponent.cpp#101
[2] http://searchfox.org/mozilla-central/rev/6580dd9a4eb0224773897388dba2ddf5ed7f4216/toolkit/components/url-classifier/nsCheckSummedOutputStream.cpp#26",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1359490,12,"  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
Yes. |done| will be written on the ""brand new thread"" and we wait on the main thread.
The reason is AsyncApplyUpdate() notifies the result via a callback on the
""caller thread"". 
That said, SpinEventLoopUntil() is supposed to work because it looks no difference
from what I am doing, isn't it?
[1] http://searchfox.org/mozilla-central/rev/6580dd9a4eb0224773897388dba2ddf5ed7f4216/toolkit/components/url-classifier/tests/gtest/Common.cpp#48",QUESTION,0,FULL_TOKEN
1359490,13,"Would it be problematic for the callback to post an event to the caller thread instead?  That would let use spin the event loop properly, without racing on |done|.
It's not the same, because the current code uses NS_ProcessNextEvent(..., false), which checks to see if there's a runnable event, and if there's not, immediately returns.  So the SpinEventLoopUntil version has a race, which looks like:
T1: Checks value of |done|, finds it to be false.
T1: Calls NS_ProcessNextEvent.
T1: Waits for an event to show up in the event queue.
T2: Sets |done| to true.
And now T1 is waiting for an event that will never get posted.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1359490,14,"Created attachment 8865303
0001-Avoid-racing-on-done.patch",UNCODED,0,UNMATCHED
1359490,15,"Thanks for your explanation! I have changed NS_ProcessNextEvent(..., false) 
to NS_ProcessNextEvent(..., true) and it's supposed to identical to using
SpinEventLoopUntil(). The change is verified to work perfectly.
Would you like me to file a new bug and resolve it first or just merge
to your patch here?
Thank you :)",CODE_IMPLEMENTATION,1,FULL_TOKEN
1359490,16,"Please file a new bug, blocking this one.  And please change the AbstractThread::MainThread()->Dispatch(...) bit to just use NS_DispatchToMainThread instead.  Thanks!",CODE_UPDATE_REQUEST,0,FULL_TOKEN
1359490,17,"Sure Nathan :)
BTW, just out of curious, why do you hope me to use NS_DispatchToMainThread
instead of AbstractThread::MainThread()? I was told lately to use 
AbstractThread::MainThread whenever possible. Is there a specific 
reason in this case?
Thanks!",QUESTION,0,FULL_TOKEN
1359490,18,Oh!  Why were you told to use AbstractThread::MainThread()?  This is news to me. :),ANSWER_TO_QUESTION,0,FULL_TOKEN
1359490,19,"After double check, avoid using NS_DispatchToMainThread() is only limited
to content process. Sorry for confusing you :p",ANSWER_TO_QUESTION,0,FULL_TOKEN
1359490,20,Why? I think NS_DispatchToMainThread should be preferred in the content process as well. Why is it better to use AbstractThread::MainThread?,QUESTION,0,FULL_TEXT
1359490,21,"Pushed by nfroyd@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/c8840a3a2c3b
add an event loop spinning abstraction function; r=gerald",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1359490,22,https://hg.mozilla.org/mozilla-central/rev/c8840a3a2c3b,UNCODED,0,UNMATCHED
1362590,1,"The following testcase crashes on mozilla-central revision c273884ffe6b (build with --enable-debug --enable-more-deterministic, run with --fuzzing-safe --no-threads --ion-eager):
let { x } = '';
Backtrace:
#0  0x0000000000e894d4 in js::jit::FixedList<js::jit::StackValue>::operator[] (index=<optimized out>, this=0x7ffef35a09b0) at js/src/jit/FixedList.h:83
#1  js::jit::FrameInfo::rawPush (this=this@entry=0x7ffef35a09a0) at js/src/jit/BaselineFrameInfo.h:193
#2  js::jit::FrameInfo::push (this=this@entry=0x7ffef35a09a0, knownType=knownType@entry=JSVAL_TYPE_UNKNOWN, val=...) at js/src/jit/BaselineFrameInfo.h:227
#3  0x0000000000e914af in js::jit::BaselineCompiler::emit_JSOP_INITGLEXICAL (this=this@entry=0x7ffef359ff50) at js/src/jit/BaselineCompiler.cpp:3243
#4  0x0000000000eb3d38 in js::jit::BaselineCompiler::emitBody (this=this@entry=0x7ffef359ff50) at js/src/jit/BaselineCompiler.cpp:1030
#5  0x0000000000eb5511 in js::jit::BaselineCompiler::compile (this=this@entry=0x7ffef359ff50) at js/src/jit/BaselineCompiler.cpp:121
/snip
For detailed crash information, see attachment.
This crashes opt shells at a weird memory address, opt stack coming up.",STACK_TRACE,0,FULL_TOKEN
1362590,2,"Created attachment 8865038
Detailed Crash Information",UNCODED,0,UNMATCHED
1362590,3,"Created attachment 8865039
Opt stack",UNCODED,0,UNMATCHED
1362590,4,"Actually this is happening really often, and also other testcases crash with weird stacks like:
#0  0xf64ad290 in ?? ()
#1  0xf64ac470 in ?? ()
#2  0xf64ac470 in ?? ()
Thus, setting [fuzzblocker], and I'm inclined to back out the regressor.",STACK_TRACE,0,FULL_TOKEN
1362590,5,"autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset:   https://hg.mozilla.org/mozilla-central/rev/ed8623eefe6c
user:        Andr Bargull
date:        Thu Apr 27 09:24:08 2017 -0700
summary:     Bug 1360220 - Replace emitRequireObjectCoercible with JSOP_CHECKOBJCOERCIBLE. r=shu
Andre, is bug 1360220 a likely regressor?",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1362590,6,"FWIW, this bug is sort-of FIXED due to the backout of bug 1360220, but leaving this open for now till that bug is fixed.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1362590,7,"I was able to resolve this issue by adding a |frame.syncStack(0)| after |frame.push(R0)| in  BaselineCompiler::emit_JSOP_INITGLEXICAL() [1]. But I have no idea why this fixes the crash and if that's the correct approach to fix the crash. FWIW the crash can also be reproduced by removing the RequireObjectCoercible() call in BytecodeEmitter.cpp [2], so I assume this isn't a bug in BaselineCompiler::emit_JSOP_CHECKOBJCOERCIBLE(), but instead a problem in  BaselineCompiler::emit_JSOP_INITGLEXICAL().
shu, can you take a look at this issue?
[1] http://searchfox.org/mozilla-central/rev/6580dd9a4eb0224773897388dba2ddf5ed7f4216/js/src/jit/BaselineCompiler.cpp#3239
[2] http://searchfox.org/mozilla-central/rev/6580dd9a4eb0224773897388dba2ddf5ed7f4216/js/src/frontend/BytecodeEmitter.cpp#5891-5892",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1362590,8,"From reading comment 6, I think the problem is that BaselineCompiler::emit_JSOP_INITGLEXICAL pushes multiple stack values (for JSOP_SETPROP) but in vm/Opcodes.h we have nuses and ndefs 1. So we're using more frame slots than the compiler expects.",PROBLEM_REVIEW,0,FULL_TEXT
1362590,9,"Created attachment 8865716
Always give global scripts an extra frame slot in JIT code for compiling INITGLEXICAL.
I don't know how this worked before. Shouldn't have been hardcoding the extra
slot into MinJITStackSize, but should've always been conditionally giving
global scripts an extra slot.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1362590,10,"anba, does this patch fix the crashes from your patch?",QUESTION,0,FULL_TEXT
1362590,11,"Yes, the test case from comment #0 no longer crashes with the patch applied.",ANSWER_TO_QUESTION,0,FULL_TEXT
1362590,12,"Hm, I wonder if we need sec-approval for this. The bug is technically older, but I guess it was impossible to trigger?",QUESTION,0,FULL_TEXT
1362590,13,"Created attachment 8866041
Always give global scripts an extra frame slot in JIT code for compiling INITGLEXICAL.
Typo fix, carrying r=jandem.",CODE_IMPLEMENTATION,1,FULL_TEXT
1362590,14,"Comment on attachment 8866041
Always give global scripts an extra frame slot in JIT code for compiling INITGLEXICAL.
Not sure I need sec-approval, asking just in case. The bug is older but doesn't seem trigger currently.
[Security approval request comment]
I'm not sure how to exploit this.
Hard to say -- would give people ideas on where to start poking around to try to exploit, but certainly not a bulls-eye.
All
Easy to create, not risky to uplift since bugfix.
Unlikely.",UNCODED,0,UNMATCHED
1362590,15,"sec-approval+ for trunk.
We'll want this on Beta and ESR-52 as well, please nominate patches there.",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1362590,16,https://hg.mozilla.org/mozilla-central/rev/358b6ad12d18,UNCODED,0,UNMATCHED
1362590,17,Please request Beta/ESR52 approval on this when you get a chance.,UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1362590,18,"Comment on attachment 8866041
Always give global scripts an extra frame slot in JIT code for compiling INITGLEXICAL.
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
User impact if declined: 
Fix Landed on Version: 55
Risk to taking this patch (and alternatives if risky): Low, bug fix only
String or UUID changes made by this patch: None
See https://wiki.mozilla.org/Release_Management/ESR_Landing_Process for more info.
Approval Request Comment
[Feature/Bug causing the regression]: Bug 589199
[User impact if declined]: As far as I can tell, none, because the bug doesn't trigger without anba's new patch. Of course, won't rule out possible exploits 100%.
[Is this code covered by automated tests?]: Yes
[Has the fix been verified in Nightly?]: Yes
[Needs manual test from QE? If yes, steps to reproduce]: No
[List of other uplifts needed for the feature/fix]: None
[Is the change risky?]: No
[Why is the change risky/not risky?]: Bug fix
[String changes made/needed]: None",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1362590,19,"Comment on attachment 8866041
Always give global scripts an extra frame slot in JIT code for compiling INITGLEXICAL.
Fix a sec-high. Beta54+ & ESR52+. Should be in 54 beta 9.",UPLIFT_APPROVAL,0,FULL_TEXT
1362590,20,"https://hg.mozilla.org/releases/mozilla-beta/rev/c100ae56e585
https://hg.mozilla.org/releases/mozilla-esr52/rev/c1314a709b41",UNCODED,0,UNMATCHED
1373154,1,More cleanups.,UNCODED,0,UNMATCHED
1373154,2,"Created attachment 8877980
(part 1) - Remove TickSample::mTimeStamp
We can just TimeStamp::Now() directly when needed.",CODE_IMPLEMENTATION,1,FULL_TEXT
1373154,3,"Created attachment 8877981
(part 2) - Don't call AllocPlatformData() in profiler_get_backtrace()
We already have a PlatformData for the thread in its ThreadInfo.",CODE_IMPLEMENTATION,1,FULL_TEXT
1373154,4,"Created attachment 8877982
(part 3) - Overhaul TickSample and things around it
Bug 1357829 added a third kind of sample, in addition to the existing
""periodic"" and ""synchronous"" samples. This patch cleans things up around that
change. In particular, it cleans up TickSample, which is a mess of semi-related
things.
The patch does the following.
- It removes everything from TickSample except the register values and renames
  TickSample as Registers. Almost all the removed stuff is available in
  ThreadInfo anyway, and the patch adds a ThreadInfo argument to various
  functions. (Doing it this way wasn't possible until recently because a
  ThreadInfo wasn't available in profiler_get_backtrace() until recently.)
  One non-obvious consequence: in synchronous samples we used to use a value of
  0 for the stackTop. Because synchronous samples now use ThreadInfo directly,
  they are able to use the proper stack top value from ThreadInfo::mStackTop.
  This will presumably only improve the quality of the stack traces.
- It splits Tick() in two and renames the halves DoPeriodicSample() and
  DoSyncSample().
- It reorders arguments in some functions so that ProfileBuffer (the output) is
  always last, and inputs are passed in roughly the order they are obtained.
- It adds a comment at the top of platform.cpp explaining the three kinds of
  sample.
- It renames a couple of other things.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1373154,5,"Comment on attachment 8877982
(part 3) - Overhaul TickSample and things around it
Review of attachment 8877982:
-----------------------------------------------------------------
This is a great improvement.
::: tools/profiler/core/platform.cpp
@@ +1730,5 @@
Could we pass the Registers object to the aDoSample func, instead of returning them as an outparam which the caller then captures into its lambda?
@@ +2830,4 @@
Can we have a follow-up to replace all instances of ""new ProfileBuffer"" with MakeUnique<ProfileBuffer>?",CODE_REVIEW,0,FULL_TEXT
1373154,6,"Thanks! I finally feel like I understand this part of the profiler code now. Clear data structures and good names go a long way.
Sure.
Sure: bug 1373436.",NEW_ISSUE_FILING,0,FULL_TEXT
1373154,7,"https://hg.mozilla.org/integration/mozilla-inbound/rev/48767f3f315f41ff152d4d3c8a9c418c7bb29aec
Bug 1373154 (part 1) - Remove TickSample::mTimeStamp. r=mstange.
https://hg.mozilla.org/integration/mozilla-inbound/rev/0e89b1564ea466ad1434fefffe446853bb154ec4
Bug 1373154 (part 2) - Don't call AllocPlatformData() in profiler_get_backtrace(). r=mstange.
https://hg.mozilla.org/integration/mozilla-inbound/rev/ca4e62117e6ad325756b62de03917d4fb188165d
Bug 1373154 (part 3) - Overhaul TickSample and things around it. r=mstange.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1373154,8,Backed out in https://hg.mozilla.org/integration/mozilla-inbound/rev/cd069d0b934e for the horror of Windows-only timeouts in devtools perf tests like https://treeherder.mozilla.org/logviewer.html#?job_id=107548547&repo=mozilla-inbound,IMPLEMENTATION_REVERSION,0,FULL_TEXT
1373154,9,"Well, this is weird.
I did a bunch of try pushes and it clearly shows that part 1 is the culprit. Harmless looking part 1! Here's a run with just part 1 applied:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=a877377b61c2b0742e0e9fd6ae323f9ed824cc3e&selectedJob=107575159
(I also did a try run with no patches applied, just to be sure. It was all green.)
The most relevant part of the crash info is this thread:
It's crashing on the `PSAutoLock lock(gPSMutex)` line in profiler_suspend_and_sample_thread(). I can't tell from the treeherder log if this is really a crash or a hang.
A couple of other threads are waiting to lock the mutex in TimeStamp_windows.cpp. I wonder if that's relevant, given that part 1 only changed some calls to TimeStamp::Now().
Even weirder, I did a try run yesterday with all three patches applied that was fine:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=6da4c3baa7971e936bf8e541c00468b4f883cf84&selectedJob=107272738
So it seems like something landed overnight that is interacting with part 1? Ugh.",QUESTION,0,FULL_TEXT
1373154,10,"Michael, could bug 1357829 have caused the problems discussed in comment 8? My successful try push yesterday was against mozilla-central, which probably didn't have that bug's patches on it at the time.",SOLUTION_REVIEW_REQUEST,0,FULL_TEXT
1373154,11,"Wait, that can't be right, because my patches modify profiler_suspend_and_sample_thread(), which was added by bug 1357829.
Still, you have some experience with BHR strangeness, so if you could take a look anyway I'd appreciate it! Thanks.",CLARIFICATION,0,FULL_TEXT
1373154,12,"I think the answer is that we can't do what you're doing in P1. The hang is happening because on thread 1, we're getting the following: 
21:17:47     INFO - Thread 0
21:17:47     INFO -  0  ntdll.dll!RtlEnterCriticalSection + 0x17
21:17:47     INFO -     eip = 0x777977b7   esp = 0x001fde0c   ebp = 0x001fde20   ebx = 0x6b9de3b8
21:17:47     INFO -     esi = 0x6b9de3bc   edi = 0x6b9de3b8   eax = 0x6b9de3bc   ecx = 0x001fde08
21:17:47     INFO -     edx = 0x777970b4   efl = 0x00000217
21:17:47     INFO -     Found by: given as instruction pointer in context
21:17:47     INFO -  1  mozglue.dll!mozilla::PerformanceCounter [TimeStamp_windows.cpp:ca4e62117e6a : 203 + 0xc]
21:17:47     INFO -     eip = 0x6b9ca7c9   esp = 0x001fde28   ebp = 0x001fde3c
21:17:47     INFO -     Found by: call frame info
21:17:47     INFO -  2  mozglue.dll!mozilla::TimeStamp::Now(bool) [TimeStamp_windows.cpp:ca4e62117e6a : 552 + 0x5]
21:17:47     INFO -     eip = 0x6b9ca751   esp = 0x001fde44   ebp = 0x001fde6c
21:17:47     INFO -     Found by: call frame info
Namely, calling PerformanceCounter (which is part of the windows implementation of Now - http://searchfox.org/mozilla-central/rev/20d16dadd336e0c6b97e3e19dc4ff907744b5734/mozglue/misc/TimeStamp_windows.cpp#536) grabs a lock within windows. It's super dangerous to grab a lock while the main thread is suspended in the profiler, which is probably why we grabbed the timestamp before suspending the main thread before.
I would recommend just leaving in the member variable, and continuing to grab the timestamp before suspending the main thread.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1373154,13,"Thanks for the explanation! Seems plausible. Though it doesn't explain why my first try run was successful; that may have to remain a mystery.
That won't quite work with the following patches -- the containing struct is being heavily modified -- but I can do something functionally equivalent by passing in the TimeStamp as an extra argument. One downside of getting the TimeStamp in advance is that we don't need it for profiler_suspend_and_sample_thread(). But a small amount of wasted work is better than a deadlock :)",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TEXT
1373154,14,"https://hg.mozilla.org/integration/mozilla-inbound/rev/467a9d5b075a7fe2fd17ccd5c384266a78e9fb46
Bug 1373154 (part 1, attempt 2) - Add more comments about the profiler's critical section. r=me.
https://hg.mozilla.org/integration/mozilla-inbound/rev/dd7aafba79b287a27baa93be20dd688340967446
Bug 1373154 (part 2, attempt 2) - Don't call AllocPlatformData() in profiler_get_backtrace(). r=mstange.
https://hg.mozilla.org/integration/mozilla-inbound/rev/f8819d808fba2abb8f8880dd241c761fa3475940
Bug 1373154 (part 3, attempt 2) - Overhaul TickSample and things around it. r=mstange.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1373154,15,"https://hg.mozilla.org/mozilla-central/rev/467a9d5b075a
https://hg.mozilla.org/mozilla-central/rev/dd7aafba79b2
https://hg.mozilla.org/mozilla-central/rev/f8819d808fba",UNCODED,0,UNMATCHED
1373249,1,"Follow up from Bug 1364355 comment 25
Let's land the missing piece of Bug 1364355 when the popup OMTC issue was fixed by Bug 1369488.",REQUIREMENT,0,FULL_TEXT
1373249,2,"Created attachment 8878063
Bug 1373249 - Enable OMTC for composited popups,
Review commit: https://reviewboard.mozilla.org/r/149476/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/149476/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1373249,3,"Comment on attachment 8878063
Bug 1373249 - Enable OMTC for composited popups,
https://reviewboard.mozilla.org/r/149476/#review161082",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1373249,4,"Pushed by cbook@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/94e12595dad0
Enable OMTC for composited popups, r=karlt",UNCODED,0,UNMATCHED
1373249,5,https://hg.mozilla.org/mozilla-central/rev/94e12595dad0,UNCODED,0,UNMATCHED
1382702,1,"CONTEXT
The release engineering team is working on having tests migrated to Taskcluster before 56 reaches beta (August 2nd), as tier-1. We noticed a regression on our testing branch. I backfilled mozilla-inbound with these tests, and the regression comes from bug 1363372 and more precisely, this changeset[1].
NEW TESTS FAILING
You can see at [2] that the following tests started to fail:
Note: Before [1], the job was orange due to bug 1380628. A fix is ongoing there.
REASONS OF THE FAILURE?
I'm unsure what's the difference between Buildbot Windows and Taskcluster Windows. Dragana, would you see why time outs now happen?
[1] https://hg.mozilla.org/integration/mozilla-inbound/rev/bdcd3e78b4c051dd383a26ea4172b0ccdb62feaf
[2] https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&fromchange=5b29bf0b577c67d9486aa95a09f36a39c0a67754&filter-job_type_name=xpcshell&filter-platform=win&selectedJob=115976079&tochange=59c86ba2610141e0c9fa82defdae58f919a5c6bd",PROBLEM_MOTIVATION,0,FULL_TOKEN
1382702,2,"If I do not find bugs (not only this one) TFO will be disabled (most probably it will be disabled).
I would like to find out why this tests are failing. Can you run the tests with some logging turned on? (I do not develop on windows so I cannot run them locally)",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1382702,3,"Thank you for your reply. I just triggered a new xpcshell job with --verbose on it[1].
If you need print out some variables, you can perform a try run on top of mozilla-inbound (while bug 1374589 comment 25 reaches mozilla-central), with the syntax:
Then on treeherder, you just need to display tier-3 jobs. 
As an example, see this treeherder job[2], ran against this debug patch[3]. 
[1] https://treeherder.mozilla.org/#/jobs?repo=try&revision=efc67b13d1a453d4a8596cb8b9da639fb9b8be6c&filter-tier=1&filter-tier=2&filter-tier=3&selectedJob=116344431
[2] https://treeherder.mozilla.org/#/jobs?repo=try&revision=29c43de1c5ecdcca7ac9b4a8aee832e806a8df29
[3] https://hg.mozilla.org/try/rev/29c43de1c5ecdcca7ac9b4a8aee832e806a8df29",PROBLEM_REVIEW,0,80_PCT_MATCH
1382702,4,"XPCShell jobs on tc-windowns are landed on central[1]. Per the public email sent to dev-planning, dev-platform, and other mailing lists[2], some windows 10 jobs will be tier-1 on Wednesday July 26th 4pm UTC.
Network failures only occur on Windows 10[3]. Dragana, do you think it's okay to turn off TFO before this Wednesday? Or would you need more time to find bugs?
[1] https://bugzilla.mozilla.org/show_bug.cgi?id=1374589#c26
[2] on Friday July 21st 6:59pm UTC
[3] https://treeherder.mozilla.org/#/jobs?repo=mozilla-central&revision=5928d905c0bc0b28f5488b236444c7d7991cf8d4&filter-platform=win&filter-tier=1&filter-tier=2&filter-tier=3&filter-job_group_symbol=tc-X",PROBLEM_REVIEW,0,FULL_TOKEN
1382702,5,"I am trying to find out how to turn on http logging[1] on a try run. I think, or better I am sure, I can fix the test failure if I get an http log for that test.
[1] https://developer.mozilla.org/en-US/docs/Mozilla/Debugging/HTTP_logging",ANSWER_TO_QUESTION,0,FULL_TEXT
1382702,6,"Created attachment 8889544
bug_1382702_v1.patch
This is just a tmp fix, by disabling TFO for this tests. They want to turn them on on 26th and I do not want to interfere with that plan. I will leave this bug open and dig into the failure probably tomorrow.",CODE_IMPLEMENTATION,1,FULL_TEXT
1382702,7,https://treeherder.mozilla.org/#/jobs?repo=try&revision=8cc79daedc190b134934a778b300426e030641c5,UNCODED,0,UNMATCHED
1382702,8,"Comment on attachment 8889544
bug_1382702_v1.patch
Review of attachment 8889544:
-----------------------------------------------------------------
dont' you have to reset the pref at the end of the test, as these are run in suites? (with clearUserPref or something..)
also - this behavior should probly block TFO overall, right?",QUESTION,0,FULL_TOKEN
1382702,9,"I though they will be cleared automatically, or that only mochitests that clear prefs...
TFO probably will not be turned of in 56. I need one more iteration for bug 1382555, if you have time to review it, that will be good.
And we need to agree on 1384633, I have running patches for that one.
This patch is only tmp until I figure out hot to tur on logging on xpcshell test... almost there but still no logging :)",ANSWER_TO_QUESTION,0,FULL_TOKEN
1382702,10,"I'm not 100% whether xpcshell needs to be reset or not - I thought it did.
Can you either
a] find proof that xpcshell does not need a reset.. then r+
or b] just reset things.. then r+",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1382702,11,"24 failures in 174 pushes (0.138 failures/push) were associated with this bug yesterday.   
Repository breakdown:
* mozilla-inbound: 24
Platform breakdown:
* windows10-64: 11
* windows8-64: 10
* windows7-32: 2
* osx-10-10: 1
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1382702&startday=2017-07-28&endday=2017-07-28&tree=all",UNCODED,0,UNMATCHED
1382702,12,"Unlike mochitests and reftests, each xpcshell test runs in a separate xpcshell process, and each one gets a clean profile and temp dir...so I don't think it is necessary to reset prefs.
On the other hand, I notice a lot of pref-setting xpcshell tests do reset prefs...maybe a good idea in case the harness changes, etc.?
Over in bug 1384728 (and other related bugs) we're seeing extremely frequent failures. If there's going to be any delay in resolving this, please let me know and I'll skip the affected tests.",SOLUTION_REVIEW,1,FULL_TOKEN
1382702,13,"55 failures in 1008 pushes (0.055 failures/push) were associated with this bug in the last 7 days. 
This is the #44 most frequent failure this week.  
** This failure happened more than 30 times this week! Resolving this bug is a high priority. **
** Try to resolve this bug as soon as possible. If unresolved for 2 weeks, the affected test(s) may be disabled. ** 
Repository breakdown:
* mozilla-inbound: 52
* mozilla-central: 3
Platform breakdown:
* windows10-64: 29
* windows8-64: 21
* windows7-32: 3
* osx-10-10: 2
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1382702&startday=2017-07-24&endday=2017-07-30&tree=all",UNCODED,0,UNMATCHED
1382702,14,"Tests are now back to green[1] thanks to [2]. Thank you very much Dragana! 
[1] https://treeherder.mozilla.org/#/jobs?repo=mozilla-central&revision=44121dbcac6a9d3ff18ed087a09b3205e5a04db1&filter-searchStr=xpcshell&filter-tier=1&filter-tier=2&filter-tier=3&filter-platform=win
[2] https://hg.mozilla.org/mozilla-central/rev/3e01e416c117",SOLUTION_VERIFICATION,0,FULL_TEXT
1382702,15,I now know the really problem why this tests are failing. I want to run 1-2 additional tests with logging and I will open a bug and fix the test even with TFO turned on.,NEW_ISSUE_FILING,0,FULL_TEXT
1384677,1,"Near as I can tell, this is a daemon that maintains access to cookies for things like Safari, which we don't use for anything.
Try run: https://treeherder.mozilla.org/#/jobs?repo=try&revision=606879a4d952524dd9f02ab6ed4fcae99c92bc6f
(failures are all flakes, they don't reproduce locally)",PROBLEM_MOTIVATION,0,FULL_TOKEN
1384677,2,"Created attachment 8890481
Bug 1384677 - remove com.apple.cookied access from content processes;
Review commit: https://reviewboard.mozilla.org/r/161614/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/161614/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1384677,3,"Comment on attachment 8890481
Bug 1384677 - remove com.apple.cookied access from content processes;
https://reviewboard.mozilla.org/r/161614/#review166932",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1384677,4,"Pushed by ryanvm@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/61d1367ef2f1
remove com.apple.cookied access from content processes; r=haik",UNCODED,0,UNMATCHED
1384677,5,https://hg.mozilla.org/mozilla-central/rev/61d1367ef2f1,UNCODED,0,UNMATCHED
1385699,1,"Created attachment 8891735
duration.html
When loading a 'video/webm' media generated by the MediaRecorder API, the `duration` property of the video returns Infinity.
These files don't have a 'duration' set in their metadata (if I got it right, it's because of the way MediaRecorder works : metadata are written first).
This affects both files generated by chrome[1] and files generated by Firefox.
Example output of `ffmpeg -i` on such a file :
Input #0, matroska,webm, from 'video.webm':
  Metadata:
    encoder         : QTmuxingAppLibWebM-0.0.1
  Duration: N/A, start: 0.000000, bitrate: N/A
    Stream #0:0(eng): Video: vp8, yuv420p(progressive), 640x480, SAR 1:1 DAR 4:3, 1k tbr, 1k tbn, 1k tbc (default)
On version 54 and above, Firefox were able to retrieve the correct duration anyway ; since 55 it returns Infinity.
Note that chrome always returned Infinity, but there is a workaround[2] for them, which consists in setting the currentTime of the video to a large number. The duration is then correctly set. FF55+ doesn't allow this workaround to work : duration is always Infinity, even when it knows the actual duration.
The current workaround I use is to grab the value of currentTime after I set it to the large number. But currentTime property can't be overridden by scripts, so this implies an ugly _duration property...
To make things even worse, when the ended event fires, the currentTime property too is set to Infinity.
So all in all, the best would be to retrieve the previous behavior (automagically grab the duration), and if it's really too hard, at least update the duration once it is known.
[1](https://bugs.chromium.org/p/chromium/issues/detail?id=642012)
[2](https://stackoverflow.com/questions/38443084)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1385699,2,"Can you upload the file generated by MediaRecorder? It would be nice for you to update the test case to exclude the MediaRecorder API because the issue is in how our media playback stack fetches duration from the metadata, not in how the file is generated.",TESTCASE_REQUEST,0,FULL_TEXT
1385699,3,"Created attachment 8891891
webm movie from MediaRecorder  (no duration metadata)",UNCODED,0,UNMATCHED
1385699,4,"Created attachment 8891892
duration.html
updated to use static video file as requested",TEST_CASES,0,FULL_TEXT
1385699,5,"Created attachment 8891893
duration.html
Sorry always have trouble with relative urls not working here...",TEST_CASES,0,FULL_TEXT
1385699,6,"Created attachment 8892265
test_duration.html
A simplified version of the test case.
Firefox output:
got durationchange, duration=Infinity, currentTime=0
got loadedmetadata, duration=Infinity, currentTime=0
got ended, duration=Infinity, currentTime=Infinity
Chrome output:
got durationchange, duration=Infinity, currentTime=0
got loadedmetadata, duration=Infinity, currentTime=0
got durationchange, duration=6.558, currentTime=3.981834
got ended, duration=6.558, currentTime=6.558
There are several issues revealed by this bug:
1. We have MediaDecoder::mInfiniteStream==true to present an infinite stream. However, mDuration==inf can also present an infinite stream. This causes inconsistency and fails to mark the stream as finite when playback reaches the end.
2. http://searchfox.org/mozilla-central/rev/bbc1c59e460a27b20929b56489e2e55438de81fa/dom/media/MediaDecoderStateMachine.cpp#2009-2012
MDSM adjust playback position to max(clockTime, mMaster->Duration()) when playback reaches the end. Since mMaster->Duration() returns inf in this case, we end up having mediaElement.currentTime==inf.
3. http://searchfox.org/mozilla-central/rev/bbc1c59e460a27b20929b56489e2e55438de81fa/dom/media/MediaDecoderStateMachine.cpp#2252
It is bad to modify mDuration directly which should the result of RecomputeDuration(). Changing mDuration directly will break data consistency because any changes to mExplicitDuration or mObservedDuration will overwrite mDuration.",PROBLEM_REVIEW,0,FULL_TOKEN
1385699,7,"Created attachment 8893192
Bug 1385699. P1 - don't adjust playback position to the duration in MDSM at the end of playback.
We will let MediaDecoder do the final adjustment.
Review commit: https://reviewboard.mozilla.org/r/164222/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/164222/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1385699,8,"Created attachment 8893193
Bug 1385699. P2 - rewrite the code of calculating duration in MDSM.
We pretty much rewrite the whole logic of duration calculation of MDSM.
The new logic is much simpler for we have only one duration to manage
which is mDuration. Below is the details of the code changes:
1. remove the mExplicitDuration mirror since it should be handled in MediaDecoder.
2. remove mObservedDuration and mDuration will take its place.
3. mDuration is updated from:
   a. metadata
   b. playback position as playback progresses.
   c. buffer ranges.
4. change mDuration to be finite when playback reaches the end.
Review commit: https://reviewboard.mozilla.org/r/164224/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/164224/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1385699,9,"Created attachment 8893194
Bug 1385699. P3 - remove MediaDecoder::SetInfinite() and related code.
Since inf can be encoded in MDSM::mDuration, we don't need an additional flag
in MediaDecoder to indicate 'infinite' anymore. Note duration change from infinite
to finite is handled by MDSM, so we can remove the explicit calls to SetInfinite(false).
Review commit: https://reviewboard.mozilla.org/r/164226/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/164226/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1385699,10,"Created attachment 8893195
Bug 1385699. P4 - MediaDecoder::mExplicitDuration doesn't need to be a canonical anymore.
Review commit: https://reviewboard.mozilla.org/r/164228/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/164228/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1385699,11,"Created attachment 8893196
Bug 1385699. P5 - fix AudioEndTime() and VideoEndTime().
AudioEndTime() returns 0 if the media sink is not started. This is wrong
because the audio/video end time should be at least the current position
to ensure playback won't go backwards.
http://searchfox.org/mozilla-central/rev/bbc1c59e460a27b20929b56489e2e55438de81fa/dom/media/MediaDecoderStateMachine.cpp#2009-2012
This fix the case where we wrongly set playback position to 0 after seeking
to the end of resource.
Review commit: https://reviewboard.mozilla.org/r/164230/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/164230/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1385699,12,"Comment on attachment 8893192
Bug 1385699. P1 - don't adjust playback position to the duration in MDSM at the end of playback.
https://reviewboard.mozilla.org/r/164222/#review170060",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1385699,13,"Comment on attachment 8893193
Bug 1385699. P2 - rewrite the code of calculating duration in MDSM.
https://reviewboard.mozilla.org/r/164224/#review170064",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1385699,14,"Comment on attachment 8893194
Bug 1385699. P3 - remove MediaDecoder::SetInfinite() and related code.
https://reviewboard.mozilla.org/r/164226/#review170066",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1385699,15,"Comment on attachment 8893195
Bug 1385699. P4 - MediaDecoder::mExplicitDuration doesn't need to be a canonical anymore.
https://reviewboard.mozilla.org/r/164228/#review170068",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1385699,16,"Comment on attachment 8893196
Bug 1385699. P5 - fix AudioEndTime() and VideoEndTime().
https://reviewboard.mozilla.org/r/164230/#review170070
Nice, this all makes handling of infinite much better. Thanks!",CODE_REVIEW,0,FULL_TOKEN
1385699,17,Thanks for the reviews!,UNCODED,0,UNMATCHED
1385699,18,"Pushed by jwwang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e10236332d1d
P1 - don't adjust playback position to the duration in MDSM at the end of playback. r=cpearce
https://hg.mozilla.org/integration/autoland/rev/90612a88de7c
P2 - rewrite the code of calculating duration in MDSM. r=cpearce
https://hg.mozilla.org/integration/autoland/rev/c03cc5e6a7c3
P3 - remove MediaDecoder::SetInfinite() and related code. r=cpearce
https://hg.mozilla.org/integration/autoland/rev/3741783d35c1
P4 - MediaDecoder::mExplicitDuration doesn't need to be a canonical anymore. r=cpearce
https://hg.mozilla.org/integration/autoland/rev/01a413050ab7
P5 - fix AudioEndTime() and VideoEndTime(). r=cpearce",UNCODED,0,UNMATCHED
1385699,19,"https://hg.mozilla.org/mozilla-central/rev/e10236332d1d
https://hg.mozilla.org/mozilla-central/rev/90612a88de7c
https://hg.mozilla.org/mozilla-central/rev/c03cc5e6a7c3
https://hg.mozilla.org/mozilla-central/rev/3741783d35c1
https://hg.mozilla.org/mozilla-central/rev/01a413050ab7",UNCODED,0,UNMATCHED
1385699,20,"I believe that the removal of explicit duration (which is used with MSE, where we never need to set the duration in the MDSM nor guess the duration) will regress the MSE handling of duration.",ISSUE_IMPACT,0,FULL_TEXT
1385699,21,Do you have a test case to repro the regression?,QUESTION,0,FULL_TEXT
1386502,1,"When I execute something like
the reftest windows open, but they get stuck and no test runs at all.
I can see messages like:
in the console.
Those files indeed exist, and I can run the test with --disable-e10s specified.
I suppose there might probably be some issue around sandbox.",UNCODED,0,UNMATCHED
1386502,2,"Jim, is this a known issue? Could you suggest how should I workaround here?
I'm not sure why this doesn't break anything on CI, probably because CI doesn't run reftest and crashtest on Windows 10?",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1386502,3,"If it's content sandboxing related, maybe some permutation of the env vars to disable can be used as a workaround?
https://wiki.mozilla.org/Security/Sandbox#Debugging_Features",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1386502,4,Confirming this,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1386502,5,"I'm hitting this on Linux as well. In my case, I see this logging right after the reftest canvas window (& focus-stealing tiny-window) appear:
==========
Chrome file doesn't exist: /scratch/work/builds/mozilla-inbound/obj/_tests/reftest/reftest/chrome/reftest/content/reftest-content.js
[Child 27730] WARNING: NS_ENSURE_SUCCESS_VOID(rv) failed with result 0x80520015: file ../../../mozilla/dom/base/nsFrameMessageManager.cpp, line 1618
JavaScript error: file:///scratch/work/builds/mozilla-inbound/obj/dist/bin/browser/components/nsBrowserGlue.js, line 993: TypeError: win is null
[Parent 27603] WARNING: attempt to modify an immutable nsStandardURL: file /scratch/work/builds/mozilla-inbound/mozilla/netwerk/base/nsStandardURL.cpp, line 1807
[Parent 27603] WARNING: Failed to retarget HTML data delivery to the parser thread.: file /scratch/work/builds/mozilla-inbound/mozilla/parser/html/nsHtml5StreamParser.cpp, line 977
And then it just sits there doing nothing.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1386502,6,"I'm slowly narrowing in on a regression range on my linux box, with ""hg bisect"" + rebuild + ./mach reftest.  In my current ""guilty"" range, bug 1308400 (which tightened the sandbox on linux) is looking most-likely-suspicious.
(I assume Windows would have a somewhat different regression cause, since bug 1308400 was linux-only -- but I wouldn't be surprised if we made similar changes on both platforms recently.)",ISSUE_IMPACT,0,FULL_TOKEN
1386502,7,"(I spun off bug 1386826 for the linux version of this issue (my comment 4 - comment 5), since it seems that this appeared on Linux due to a linux-specific change (bug 1308400), and I don't want to derail this bug here since it was filed for Windows.)",ISSUE_IMPACT,0,FULL_TEXT
1386502,8,"Yeah, adding MOZ_DISABLE_CONTENT_SANDBOX=1 makes the test run as expected, so this is indeed because of content sandbox.
The may be regressed by different bugs, but I imagine that the fix can be the same: either disable content sandbox for reftest or add the harness directory to the whitelist somehow. So it probably isn't necessary to have a separate bug for that.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1386502,9,"Can confirm on Windows 10, adding MOZ_DISABLE_CONTENT_SANDBOX=1 fixes it.",SOLUTION_REVIEW,1,FULL_TEXT
1386502,10,"Likely correct. We can dupe as-appropriate after we've got a fix somewhere.
haik says in bug 1386826 comment 2 that (on linux at least) he can work around this by putting his objdir inside of his srcdir (e.g. in its default location -- just avoid setting MOZ_OBJDIR in your mozconfig).",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1386502,11,"That's an interesting observation. My objdir is indeed in my srcdir, so this seems to be Linux-specific, then.",CLARIFICATION,0,FULL_TEXT
1386502,12,Looks like we'll need to white-list the source and obj dirs on Windows as well.,REQUIREMENT,0,FULL_TEXT
1386502,13,"Created attachment 8894547
White-list source and obj dirs for Windows content process sandbox in developer builds
(I'll push to try as soon as the issues are sorted.)",UNCODED,0,UNMATCHED
1386502,14,"Just realised I need to update that comment, I'm actually whitelisting the comma delimited paths in pref security.sandbox.content.read_path_whitelist, which is what we do for Linux.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1386502,15,"Comment on attachment 8894547
White-list source and obj dirs for Windows content process sandbox in developer builds
Review of attachment 8894547:
-----------------------------------------------------------------
test harness wise this looks good
::: ipc/glue/GeckoChildProcessHost.cpp
@@ +343,5 @@
is there a way to not ship with this?  couldn't any addon just set this pref and then hack around the sandbox?",QUESTION,0,FULL_TOKEN
1386502,16,"... 
Potentially yes, I'm not sure if extensions couldn't just read any file they wanted anyway.
Maybe that's not true now that (I think) web extensions will be running in their own process.
Maybe this could also just be done for IsDevelopmentBuild().
Perhaps that wouldn't work if you were running tests on a packaged build.
Alex - what do you think? (I think you hit these problems initially)
Ideally, of course we should fix the tests that rely on opening files in the content process, but I'm not sure how much work that is.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1386502,17,https://treeherder.mozilla.org/#/jobs?repo=try&revision=1306c7050fc7c1f45608a94503506b23ae7e8544,UNCODED,0,UNMATCHED
1386502,18,"Can webExtensions set prefs? I didn't think they could, if so there are worse things that they could do.
The original reason IsDevelopmentBuild() and the SRCDIR and OBJDIR variables were introduced were for handling the fact that on macOS and Linux we rely on symlinks from the built application to those directories.
I don't think it's correct to use these variables if these tests need to access these directories not-via-symlinks (or stated another way, if Windows is affected, I don't think these are the right solution :-)). Right now these values are only used with InDevelopmentBuild, and we'd very much like to avoid changing that. That said, it might make sense to use these in the short term.",SOLUTION_REVIEW,1,FULL_TOKEN
1386502,19,"Created attachment 8894623
Whitelist paths added via pref for files opened in the content process during some tests.
Updated patch with revised comment, as I'll probably need to use checkin-needed.
Carrying r+ from jmaher in comment 14.
It looks like web extensions can't set prefs, so after Fx56 we should be OK.
Although we'd like to remove the need for these anyway to simplify things.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1386502,20,"Pushed by ryanvm@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/ef54a9c9f60c
Whitelist paths added via pref for files opened in the content process during some tests. r=jimm",UNCODED,0,UNMATCHED
1386502,21,https://hg.mozilla.org/mozilla-central/rev/ef54a9c9f60c,UNCODED,0,UNMATCHED
1390087,1,"The following testcase crashes on mozilla-central revision 3bfcbdf5c6c3 (build with --enable-debug, run with --fuzzing-safe --ion-offthread-compile=off --no-baseline --no-ion):
// jsfunfuzz-generated
setGCCallback({
    action: ""majorGC""
});
// Adapted from randomly chosen test: js/src/jit-test/tests/gc/bug-1374797.js
gcparam(""allocationThreshold"", 1);
offThreadCompileScript("""");
for (let i = 0; i < 99999; i++) {
    Symbol.for(i);
}
eval(0);
Backtrace:
#0  js::gc::GCRuntime::budgetIncrementalGC (this=0x7f8ca4b4d670, nonincrementalByAPI=<optimized out>, reason=<optimized out>, budget=..., lock=...) at js/src/jsgc.cpp:6791
#1  0x00000000009f626e in js::gc::GCRuntime::gcCycle (this=this@entry=0x7f8ca4b4d670, nonincrementalByAPI=nonincrementalByAPI@entry=false, budget=..., reason=reason@entry=JS::gcreason::ALLOC_TRIGGER) at js/src/jsgc.cpp:6901
#2  0x00000000009f6a85 in js::gc::GCRuntime::collect (this=this@entry=0x7f8ca4b4d670, nonincrementalByAPI=nonincrementalByAPI@entry=false, budget=..., reason=reason@entry=JS::gcreason::ALLOC_TRIGGER) at js/src/jsgc.cpp:7060
#3  0x00000000009f6ef2 in js::gc::GCRuntime::gcSlice (this=0x7f8ca4b4d670, reason=JS::gcreason::ALLOC_TRIGGER, millis=0) at js/src/jsgc.cpp:7146
#4  0x00000000009f70f1 in js::gc::GCRuntime::gcIfRequested (this=0x7f8ca4b4d670) at js/src/jsgc.cpp:7348
/snip
For detailed crash information, see attachment.
Setting s-s as a start because this seems to involve GC.",STACK_TRACE,0,FULL_TOKEN
1390087,2,"Created attachment 8896922
Detailed Crash Information",UNCODED,0,UNMATCHED
1390087,3,"autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset:   https://hg.mozilla.org/mozilla-central/rev/e33e38d61829
user:        Jon Coppeard
date:        Tue Jul 25 11:28:41 2017 +0100
summary:     Bug 1374797 - Fix logic around triggering atoms GCs r=sfink
Jon, is bug 1374797 a likely regressor?",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1390087,4,"Created attachment 8896961
bug1390087-zone-scheduling
The problem here is that when we're scheduling zones for GC and checking the GC budget we look at all zones, even those used by helper threads that we can't collect anyway.  So let's ignore these.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1390087,5,This is not a security issue.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1390087,6,"Pushed by jcoppeard@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/2e5d28a1a277
Ignore zones that we can't collect when scheduling zones for GC r=sfink",UNCODED,0,UNMATCHED
1390087,7,https://hg.mozilla.org/mozilla-central/rev/2e5d28a1a277,UNCODED,0,UNMATCHED
1390087,8,Please request Beta approval on this when you get a chance.,UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1390087,9,"Comment on attachment 8896961
bug1390087-zone-scheduling
Approval Request Comment
[Feature/Bug causing the regression]: This has been like this since forever basically.
[User impact if declined]: We could occasionally end up doing GCs non-incrementally for no good reason.
[Is this code covered by automated tests?]: Yes.
[Has the fix been verified in Nightly?]: Yes.
[Needs manual test from QE? If yes, steps to reproduce]: No.
[List of other uplifts needed for the feature/fix]: None.
[Is the change risky?]: No.
[Why is the change risky/not risky?]: It's a very simple change that ignores zones that we aren't going to collect anyway when budgeting GC.
[String changes made/needed]: None.",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1390087,10,"Comment on attachment 8896961
bug1390087-zone-scheduling
Fix an assertion. Looks low risk. Beta56+.",UPLIFT_APPROVAL,0,FULL_TEXT
1390087,11,https://hg.mozilla.org/releases/mozilla-beta/rev/594c90fb0183968b0d4ffe3ea2a5a5a0578be3bb,UNCODED,0,UNMATCHED
1390087,12,Setting qe-verify- based on Jon's assessment on manual testing needs and the fact that this fix has automated coverage.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1390087,13,"4 failures in 824 pushes (0.005 failures/push) were associated with this bug in the last 7 days.    
Repository breakdown:
* autoland: 4
Platform breakdown:
* windows7-32: 2
* windows7-32-stylo-disabled: 1
* linux32-stylo-disabled: 1
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1390087&startday=2017-10-02&endday=2017-10-08&tree=all",UNCODED,0,UNMATCHED
1390087,14,"1 failures in 947 pushes (0.001 failures/push) were associated with this bug in the last 7 days.    
Repository breakdown:
* autoland: 1
Platform breakdown:
* windows7-32: 1
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1390087&startday=2017-10-09&endday=2017-10-15&tree=all",UNCODED,0,UNMATCHED
1396319,1,"This bug was filed from the Socorro interface and is 
report bp-f34ea901-6ceb-4512-b74e-42b9a0170826.
=============================================================
Crashing Thread (7), Name: Socket Thread
Frame 	Module 	Signature 	Source
0 	xul.dll 	mozilla::MediaPipeline::RtcpPacketReceived(mozilla::TransportLayer*, unsigned char const*, unsigned __int64) 	media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:1211
1 	xul.dll 	mozilla::MediaPipeline::PacketReceived(mozilla::TransportLayer*, unsigned char const*, unsigned __int64) 	media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp:1258
2 	xul.dll 	sigslot::signal3<mozilla::TransportLayer*, unsigned char const*, unsigned __int64, sigslot::single_threaded>::operator()(mozilla::TransportLayer*, unsigned char const*, unsigned __int64) 	media/mtransport/sigslot.h:2486
3 	xul.dll 	mozilla::TransportLayerIce::IcePacketReceived(mozilla::NrIceMediaStream*, int, unsigned char const*, int) 	media/mtransport/transportlayerice.cpp:224
4 	xul.dll 	mozilla::NrIceCtx::msg_recvd(void*, nr_ice_peer_ctx_*, nr_ice_media_stream_*, int, unsigned char*, int) 	media/mtransport/nricectx.cpp:380
5 	xul.dll 	nr_ice_peer_ctx_deliver_packet_maybe 	media/mtransport/third_party/nICEr/src/ice/ice_peer_ctx.c:831
6 	xul.dll 	nr_ice_ctx_deliver_packet 	media/mtransport/third_party/nICEr/src/ice/ice_ctx.c:944
7 	xul.dll 	nr_ice_socket_readable_cb 	media/mtransport/third_party/nICEr/src/ice/ice_socket.c:191
8 	xul.dll 	mozilla::NrSocket::OnSocketReady(PRFileDesc*, short) 	media/mtransport/nr_socket_prsock.cpp:372
9 	xul.dll 	mozilla::net::nsSocketTransportService::DoPollIteration(mozilla::BaseTimeDuration<mozilla::TimeDurationValueCalculator>*) 	netwerk/base/nsSocketTransportService2.cpp:1176
10 	xul.dll 	mozilla::net::nsSocketTransportService::Run() 	netwerk/base/nsSocketTransportService2.cpp:928
11 	xul.dll 	nsThread::ProcessNextEvent(bool, bool*) 	xpcom/threads/nsThread.cpp:1418
12 	xul.dll 	NS_ProcessNextEvent(nsIThread*, bool) 	xpcom/threads/nsThreadUtils.cpp:475
13 	xul.dll 	mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) 	ipc/glue/MessagePump.cpp:338
14 	xul.dll 	MessageLoop::RunHandler() 	ipc/chromium/src/base/message_loop.cc:231
15 	xul.dll 	MessageLoop::Run() 	ipc/chromium/src/base/message_loop.cc:211
16 	xul.dll 	nsThread::ThreadFunc(void*) 	xpcom/threads/nsThread.cpp:501
17 	nss3.dll 	PR_NativeRunThread 	nsprpub/pr/src/threads/combined/pruthr.c:397
18 	nss3.dll 	pr_root 	nsprpub/pr/src/md/windows/w95thred.c:95
19 	ucrtbase.dll 	o__realloc_base 	
20 	kernel32.dll 	BaseThreadInitThunk 	
21 	ntdll.dll 	RtlUserThreadStart
crash reports with this signature seem to be newly appearing in firefox 55, but they get worse in volume during the 56.0b cycle.",STACK_TRACE,0,FULL_TOKEN
1396319,2,"Off hand, this looks like conduit_ becomes nullptr, either due to it being set to nullptr after the check is made earlier in this function, or getting stale data due to lack of synchronization. Looks similar to Bug 1382932, but may be more actionable.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1396319,3,"yeah - nullptr crash, possible (very unlikely) UAF since I'll bet it's getting cleared on one thread, and another thread is dereferencing conduit_.  That can (with very unlikely timing) lead to a UAF.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1396319,4,Note: 55.0b3 and later; not the webrtc.org update in 56.  Perhaps a bugfix uplifted to 55 beta... or just rare enough that it wasn't seen in aurora/nightly,ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1396319,5,Mass change P3->P4 to align with new Mozilla triage process.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1396319,6,My guess would be that the addition of the RTP logging in 55 changed the timing slightly so that an old lingering problem starts to result in crashes.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1396319,7,I have a friend that can consistently reproduce this crash when starting a call: https://crash-stats.mozilla.com/report/index/a6117985-e56a-4696-8186-d94c20171031.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1396319,8,"Still happening, and happening in 57/8/9.  All crashes in the last week are nullptr still, so this may in fact be a clean nullptr crash and not a sec issue.
If marco can repro this, we should look more closely.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1396319,9,"Nico, can you take a look?
Marco, do happen to have the repro steps your friend is using?",S2R_REQUEST,0,FULL_TEXT
1396319,10,"Jib, I can, though reproing on Windows[1] will take some spin up time.
[1]https://crash-stats.mozilla.com/signature/?signature=mozilla%3A%3AMediaPipeline%3A%3ARtcpPacketReceived#aggregations",ANSWER_TO_QUESTION,0,FULL_TEXT
1396319,11,He was simply joining a call on appear.in or appr.tc. The content process would crash as soon as he accepted the prompt to share the camera/microphone.,S2R,0,FULL_TEXT
1396319,12,I think this is a dupe of bug 1389793. Keeping the NI to remind me to check back again.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1396319,13,"Same as over in bug 1382932 this has last been seen crashing on 58.0b12.
Possibly fixed though bug 1425780 getting uplifted into 58 Beta on 2018-01-11.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1396319,14,"I can verify that my friend is no longer crashing, although he apparently can't use any website which requests both camera and microphone (such as appear.in, or appr.tc, or https://janus.conf.meetecho.com/echotest.html). They don't crash anymore, but his camera and microphone never actually work (both me and him can't see/hear him).
He can use demos which only request the camera though (such as https://webrtc.github.io/samples/src/content/getusermedia/gum/).",SOLUTION_VERIFICATION,0,FULL_TOKEN
1396319,15,I'm wondering if we should go ahead and close this out now? Comment 13 is probably better suited for a follow-up bug.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1396319,16,"Likewise, bug 1389793 should probably be closed as well.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1396319,17,Looks like we managed to fix this through another bug (possibly bug 1425780).,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1401299,2,"Created attachment 8909928
Bug 1401299 - Removing leftover putc(stderr, ...) from ParseNode;
Review commit: https://reviewboard.mozilla.org/r/181408/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/181408/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1401299,3,"Comment on attachment 8909928
Bug 1401299 - Removing leftover putc(stderr, ...) from ParseNode;
https://reviewboard.mozilla.org/r/181408/#review187030",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1401299,4,"Pushed by dteller@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/f3b8f72c3d89
Removing leftover putc(stderr, ...) from ParseNode;r=nbp",UNCODED,0,UNMATCHED
1401299,5,https://hg.mozilla.org/mozilla-central/rev/f3b8f72c3d89,UNCODED,0,UNMATCHED
1403319,1,Intl.NumberFormat.prototype.formatToParts reached Stage 4 at today's TC39 meeting. We can expose it now to the public! :),PROBLEM_DESCRIPTION,0,FULL_TEXT
1403319,2,"Created attachment 8912816
Bug 1403319 - Expose Intl.NumberFormat.prototype.formatToParts.
Review commit: https://reviewboard.mozilla.org/r/184124/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/184124/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1403319,3,"Andre, can you take a look? The proposal reached Stage 4 so I'd like to expose it soon.
Also, it would help a lot with our tooling if you could pick a `[:abargull]` or similar nick for bugzilla and MR when requesting reviews from you ;)",CODE_REVIEW_REQUEST,0,FULL_TOKEN
1403319,4,"Comment on attachment 8912816
Bug 1403319 - Expose Intl.NumberFormat.prototype.formatToParts.
https://reviewboard.mozilla.org/r/184124/#review189698
We should now be able to run all NumberFormat.formatToParts tests from test262, so these exclusions should be removed <http://searchfox.org/mozilla-central/rev/f54c1723befe6bcc7229f005217d5c681128fcad/js/src/tests/jstests.list#363-368>, too.
::: js/src/builtin/Intl.cpp
(Diff revision 1)
Looks like `NumberFormatFormatToParts` and `formatToParts` can both now also be removed from vm/CommonPropertyNames.h.
::: js/src/tests/Intl/NumberFormat/formatToParts.js:1
(Diff revision 1)
`typeof(newGlobal)!==""function""` can also be removed now.",CODE_REVIEW,0,FULL_TEXT
1403319,5,"Well, except for this one test which still expects Intl.NumberFormat.prototype.formatToParts.length is 0 instead of 1 <http://searchfox.org/mozilla-central/rev/f54c1723befe6bcc7229f005217d5c681128fcad/js/src/tests/test262/intl402/NumberFormat/prototype/formatToParts/length.js#9>. :-)",CLARIFICATION,0,FULL_TEXT
1403319,6,"Thanks Andre! Submitted a PR to test262 for the length issue https://github.com/tc39/test262/pull/1249
I'll keep it skipped for now and once we merge updated test262 we can reenable it.",STATUS_UPDATE,0,FULL_TOKEN
1403319,7,"Comment on attachment 8912816
Bug 1403319 - Expose Intl.NumberFormat.prototype.formatToParts.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/184124/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1403319,8,"Pushed by zbraniecki@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/353baf72f789
Expose Intl.NumberFormat.prototype.formatToParts. r=anba",UNCODED,0,UNMATCHED
1403319,9,https://hg.mozilla.org/mozilla-central/rev/353baf72f789,UNCODED,0,UNMATCHED
1403319,10,"Developer release notes
https://developer.mozilla.org/en-US/Firefox/Releases/58#JavaScript
Reference page
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat/formatToParts
Compat data 
https://github.com/mdn/browser-compat-data/pull/612 (still WIP at this point)",UNCODED,0,UNMATCHED
1405027,2,"Created attachment 8914397
Avoid using nsINode::GetChildAt() in HTMLEditor::GetElementOrParentByTagName()",PROBLEM_DESCRIPTION,0,FULL_TEXT
1405027,3,"Pushed by eakhgari@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/dd7266c2e716
Avoid using nsINode::GetChildAt() in HTMLEditor::GetElementOrParentByTagName(); r=masayuki",UNCODED,0,UNMATCHED
1405027,4,https://hg.mozilla.org/mozilla-central/rev/dd7266c2e716,UNCODED,0,UNMATCHED
1407955,1,"Created attachment 8917762
testcase, SVG text with text-shadow
See testcase: the SVG text renders with colored stroke and fill, as specified in the attributes of the <svg> element, and inherits its font family/weight/size from the body. But it fails to render the text-shadow that was also specified on the body element.
(The fact that these properties are inherited from the body in this example is irrelevant; behavior is the same if they're specified in an inline style attribute on the <text> element itself.)
Safari and Chrome both render the expected shadow on the SVG text.
The fun surprise here is that if you select any part of the text, suddenly the shadow appears (for the whole of the text element).",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1407955,2,"Created attachment 8917828
Don't skip rendering text-shadow when we're painting SVG text without selection
The example here is fixed by simply removing the \!aParams.callbacks guard that prevents us rendering the shadow in the (no-selection) PaintText path. It looks like this dates back to bug 655877, originally as the separate aCallbacks param, later moved to the PaintTextParams struct. So :heycam, do you know if removing this will break anything? (Existing reftests seem to be fine with it, according to https://treeherder.mozilla.org/#/jobs?repo=try&revision=2b5eb4766f666c114f0bf5ea348aef7f920edebc, so if it does result in problems that implies we're lacking suitable test coverage...)",CODE_IMPLEMENTATION,1,FULL_TEXT
1407955,3,bug 889235 contains a reftest why does the reftest from that bug pass and the testcase not?,QUESTION,0,FULL_TEXT
1407955,4,"The callbacks are used for two different cases.  One is when we have a <text> inside a <clipPath>, and we need to generate paths for the clip path.  The second case is when we have SVG patterns, strokes, etc.  In this case, where we're still painting the text normally, it does make sense to just go ahead and paint the shadow, and not bother about going through a callback function to do it either.
One thing to check would be that when we're in here due to <clipPath>, that aParams.IsPaintText() is indeed false.  It might be we only set that for background-clip:text.  Can you check that Jonathan?
I guess the bug 889235 testcase works because ShouldRenderAsPath() returns false, since the text has no stroke and uses a solid fill colour, so we don't have a callbacks object.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1407955,5,"Created attachment 8919360
improved testcase with shadows on various SVG text styles
Here is a more extensive testcase that renders SVG text with a variety of attributes, and (in all cases) with a text-shadow style in effect.
Currently, the most obvious bug we have is that the text-shadow only appears for text that is rendered with fill (but no stroke).
Doing a ""Select All"" on the testcase makes shadows appear on all the examples. However, looking at exactly how the shadows are rendered raises further questions:
- When the text has a stroke but no fill, should the shadow be a ""solid"" shadow as if the text were filled, or should it be a shadow of only the stroke? In both Safari and Chrome, it's the stroke that casts the shadow here.
- What about partially-opaque text: should the shadow adopt the same opacity as the element? Chrome and Safari do that for SVG text, though this does not apply to partially-opaque HTML text, which still casts a fully-opaque shadow (in all browsers). The difference between their SVG and HTML behavior seems odd.
- Is is appropriate for text-shadow to apply to text used as a clipPath (i.e. to contribute to the clip region)? It kinda does so when selected, but it looks like we get the position a bit wrong. Both Safari and Chrome do this, though in Safari the positioning also looks wrong (in a different way from ours).
(FWIW, this testcase exhibits painting bugs in both Safari and Chrome, too, so we're not alone in having issues here -- though ours seem the most glaring!)",QUESTION,0,FULL_TOKEN
1407955,6,"- Is is appropriate for text-shadow to apply to text used as a clipPath (i.e. to contribute to the clip region)? It kinda does so when selected, but it looks like we get the position a bit wrong. Both Safari and Chrome do this, though in Safari the positioning also looks wrong (in a different way from ours).
No, it should be the raw geometry only per the specification. Whether it has fill, stroke or shadow should make no difference.",ANSWER_TO_QUESTION,0,FULL_TEXT
1407955,7,"Created attachment 9317392
Bug 1407955 - Display text shadow with fill and stroke specified r=jfkthame",UNCODED,0,UNMATCHED
1407955,8,"I haven't added any tests for stroke only clipPaths because I think our rendering should probably change to that of Chrome.
Should create a new bug absent the clipPath test to track that but at least we show a shadow of some sort now that doesn't magically appear when you select something.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1407955,9,https://treeherder.mozilla.org/jobs?repo=try&revision=67287356dd36cf49395c9bcedacfc6dc919c76ab,UNCODED,0,UNMATCHED
1407955,10,"Pushed by longsonr@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/624c3df8fcd4
Display text shadow with fill and stroke specified r=jfkthame",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1407955,11,Created web-platform-tests PR https://github.com/web-platform-tests/wpt/pull/38489 for changes under testing/web-platform/tests,UNCODED,0,UNMATCHED
1407955,12,https://hg.mozilla.org/mozilla-central/rev/624c3df8fcd4,UNCODED,0,UNMATCHED
1407955,13,Upstream PR merged by moz-wptsync-bot,UNCODED,0,UNMATCHED
1410565,1,"Created attachment 8920749
test_case.mp4
#0 mozalloc_abort(char const*) /src/memory/mozalloc/mozalloc_abort.cpp:33:5
#1 Abort(char const*) /src/xpcom/base/nsDebugImpl.cpp:461:3
#2 NS_DebugBreak /src/xpcom/base/nsDebugImpl.cpp:417:7
#3 fpehandler(int, siginfo*, void*) /src/toolkit/xre/nsSigHandlers.cpp:155:5
#4 0x7f70641e538f  (/lib/x86_64-linux-gnu/libpthread.so.0+0x1138f)
#5 ToMicroseconds /src/media/libstagefright/binding/include/mp4_demuxer/MoofParser.h:39:41
#6 mp4_demuxer::Moof::ParseTrun(mp4_demuxer::Box&, mp4_demuxer::Tfhd&, mp4_demuxer::Mvhd&, mp4_demuxer::Mdhd&, mp4_demuxer::Edts&, unsigned long*, bool) /src/media/libstagefright/binding/MoofParser.cpp:684
#7 mp4_demuxer::Moof::ParseTraf(mp4_demuxer::Box&, mp4_demuxer::Trex&, mp4_demuxer::Mvhd&, mp4_demuxer::Mdhd&, mp4_demuxer::Edts&, mp4_demuxer::Sinf&, unsigned long*, bool) /src/media/libstagefright/binding/MoofParser.cpp:593:11
#8 mp4_demuxer::Moof::Moof(mp4_demuxer::Box&, mp4_demuxer::Trex&, mp4_demuxer::Mvhd&, mp4_demuxer::Mdhd&, mp4_demuxer::Edts&, mp4_demuxer::Sinf&, unsigned long*, bool) /src/media/libstagefright/binding/MoofParser.cpp:404:7
#9 mp4_demuxer::MoofParser::RebuildFragmentedIndex(mp4_demuxer::BoxContext&) /src/media/libstagefright/binding/MoofParser.cpp:65:12
#10 RebuildFragmentedIndex /src/media/libstagefright/binding/MoofParser.cpp:35:10
#11 mp4_demuxer::MoofParser::RebuildFragmentedIndex(mozilla::media::IntervalSet<long> const&, bool*) /src/media/libstagefright/binding/MoofParser.cpp:51
#12 mp4_demuxer::Index::UpdateMoofIndex(mozilla::media::IntervalSet<long> const&, bool) /src/media/libstagefright/binding/Index.cpp:433:16
#13 mozilla::MP4TrackDemuxer::EnsureUpToDateIndex() /src/dom/media/fmp4/MP4Demuxer.cpp:400:11
#14 mozilla::MP4TrackDemuxer::MP4TrackDemuxer(mozilla::MP4Demuxer*, mozilla::UniquePtr<mozilla::TrackInfo, mozilla::DefaultDelete<mozilla::TrackInfo> >&&, mp4_demuxer::IndiceWrapper const&) /src/dom/media/fmp4/MP4Demuxer.cpp:358:3
#15 mozilla::MP4Demuxer::Init() /src/dom/media/fmp4/MP4Demuxer.cpp:221:13
#16 operator() /src/dom/media/MediaFormatReader.cpp:1115:47
#17 mozilla::detail::ProxyFunctionRunnable<mozilla::MediaFormatReader::DemuxerProxy::Init()::$_10, mozilla::MozPromise<mozilla::MediaResult, mozilla::MediaResult, true> >::Run() /src/obj-firefox/dist/include/mozilla/MozPromise.h:1511
#18 mozilla::TaskQueue::Runner::Run() /src/xpcom/threads/TaskQueue.cpp:246:12
#19 nsThreadPool::Run() /src/xpcom/threads/nsThreadPool.cpp:228:14
#20 non-virtual thunk to nsThreadPool::Run() /src/xpcom/threads/nsThreadPool.cpp:156:15
#21 nsThread::ProcessNextEvent(bool, bool*) /src/xpcom/threads/nsThread.cpp:1037:14
#22 NS_ProcessNextEvent(nsIThread*, bool) /src/xpcom/threads/nsThreadUtils.cpp:513:10
#23 mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /src/ipc/glue/MessagePump.cpp:334:20
#24 RunInternal /src/ipc/chromium/src/base/message_loop.cc:326:10
#25 RunHandler /src/ipc/chromium/src/base/message_loop.cc:319
#26 MessageLoop::Run() /src/ipc/chromium/src/base/message_loop.cc:299
#27 nsThread::ThreadFunc(void*) /src/xpcom/threads/nsThread.cpp:425:11
#28 _pt_root /src/nsprpub/pr/src/pthreads/ptthread.c:216:5
#29 start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)
#30 clone /build/glibc-bfm8X4/glibc-2.23/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:109",STACK_TRACE,0,FULL_TOKEN
1410565,2,"INFO: Last good revision: aecaa85bb1d9d8b7d2cbd9ab84eb6dbc0ed9eee8
INFO: First bad revision: 4e892b27c2f112e61a74d1bd75cc1d73ff91e2b2
INFO: Pushlog:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=aecaa85bb1d9d8b7d2cbd9ab84eb6dbc0ed9eee8&tochange=4e892b27c2f112e61a74d1bd75cc1d73ff91e2b2",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1410565,3,"Created attachment 8921363
Bug 1410565 - check mTimescale to avoid dividing by zero.
Review commit: https://reviewboard.mozilla.org/r/192396/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/192396/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1410565,4,"Created attachment 8921364
Bug 1410565 - add gtest for mTimescale checking.
Review commit: https://reviewboard.mozilla.org/r/192398/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/192398/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1410565,5,"Comment on attachment 8921363
Bug 1410565 - check mTimescale to avoid dividing by zero.
https://reviewboard.mozilla.org/r/192396/#review197802",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1410565,6,"Comment on attachment 8921364
Bug 1410565 - add gtest for mTimescale checking.
https://reviewboard.mozilla.org/r/192398/#review197804",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1410565,7,"Comment on attachment 8921363
Bug 1410565 - check mTimescale to avoid dividing by zero.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/192396/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1410565,8,"Comment on attachment 8921364
Bug 1410565 - add gtest for mTimescale checking.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/192398/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1410565,9,https://treeherder.mozilla.org/#/jobs?repo=try&revision=053865aaf0f17504a6232e9023956cf6e2e2cf57,UNCODED,0,UNMATCHED
1410565,10,"Pushed by ayang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/a0282427c61c
check mTimescale to avoid dividing by zero. r=kinetik
https://hg.mozilla.org/integration/autoland/rev/a8df0a966ce6
add gtest for mTimescale checking. r=kinetik",UNCODED,0,UNMATCHED
1410565,11,"https://hg.mozilla.org/mozilla-central/rev/a0282427c61c
https://hg.mozilla.org/mozilla-central/rev/a8df0a966ce6",UNCODED,0,UNMATCHED
1421170,1,"The CustomElementUpgradeReaction and CustomElementCallbackReaction are only used inside CustomElementRegistry.cpp, so we don't need to expose them in header file.",PROBLEM_MOTIVATION,0,FULL_TEXT
1421170,2,"Created attachment 8932342
Bug 1421170 - Move the declarations of CustomElementUpgradeReaction and CustomElementCallbackReaction to CustomElementRegistry.cpp;
The CustomElementUpgradeReaction and CustomElementCallbackReaction are only used inside CustomElementRegistry.cpp,
so we don't need to expose them in header file.
Review commit: https://reviewboard.mozilla.org/r/203378/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/203378/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1421170,3,https://treeherder.mozilla.org/#/jobs?repo=try&revision=c5dab36c940118744045ede91cb6a6e7261be1bc&group_state=expanded,UNCODED,0,UNMATCHED
1421170,4,"Comment on attachment 8932342
Bug 1421170 - Move the declarations of CustomElementUpgradeReaction and CustomElementCallbackReaction to CustomElementRegistry.cpp;
https://reviewboard.mozilla.org/r/203378/#review210552",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1421170,5,"Pushed by echen@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/c7633e5266c0
Move the declarations of CustomElementUpgradeReaction and CustomElementCallbackReaction to CustomElementRegistry.cpp; r=smaug",UNCODED,0,UNMATCHED
1421170,6,https://hg.mozilla.org/mozilla-central/rev/c7633e5266c0,UNCODED,0,UNMATCHED
1430012,1,"STR.
1. set pref ""media.autoplay.enabled=false"" and ""media.autoplay.enabled.user-gestures-needed=true"".
2. goto https://alastor0325.github.io/htmltests/autoplay_tests/autoplay_test2.html
3. click the video, then video starts playing
4. close the tab
5. restore tab by keyboard shortcut ""command + shift + T""
Expect.
6. video from restored tab should not start playing
Actual.
6. video from restored tab starts playing
---
We listen ""key-up"" event to activate the document then it could gain the autoplay permission. If the event is sent to the wrong target, then the thing would go wrong.
After some investigation, the root cause should be that the ""key-up"" event is sent to the restored tab, then causes its document activation.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1430012,2,"Hi, Stone,
Could you help with this issue or NI someone who is familiar with this part?
Thanks!",ASSIGNEE_REQUEST,0,FULL_TOKEN
1430012,3,"FYI, if you restore the tab from ""History"" > ""Recently Closed Tabs"", then the issue won't happen.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1430012,4,"When investigating bug 1427984, I found that most browsers (Chrome, Firefox, Safari) fire keyup at the switched tab when the key sequence changes the current tab. I don't think this is a problem. For this use case, maybe we could handle the autoplay permission when keydown like other functionalities (e.g. ALT+N to switch tabs, ALT+F4, CTRL+SHIFT+K to open inspector). Or we could ask UX for some suggestions.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1430012,5,I learned from Alastor that keydown as suggested in comment 3 works well for him. Anything else we need to do in this bug to support block-autoplay feature?,SOLUTION_REVIEW,1,FULL_TEXT
1430012,6,"I can take it, thank for your help!",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1430012,7,We switched to acitvating in keydown in Bug 1456037.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1435264,1,"[Affected versions]:
- Latest Nightly 60.0a1 (2018-02-01) (64-bit)
[Affected platforms]:
- Windows 10x64
- Mac OS Sierra 10.12
Preconditions
Fx build with WebAuth enabled
USB hardware key
[Steps to reproduce]:
1.Go to this site: https://webauthn.bin.coffee/
2.Insert USB hardware key
3.Click on button labeled ""Create Credentials"" and perform USB verification steps
4.Click on button labeled ""Get Assertion"" and perform USB verification steps
5.Remove USB token
6.Click on button labeled ""Create Credentials""
   Click on button labeled ""Get Assertion""
7.Insert USB hardware key again
  Click on button labeled ""Create Credentials"" and perform USB verification steps
[Expected result]
7. Debug output on page should indicate successful credential creation.
[Actual result]
7. After clicking on ""Create Credentials"" the output indicates failure 
   https://i.imgur.com/dK7u2lQ.png",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1435264,2,This is probably a bug in https://webauthn.bin.coffee/ ; I'll take a look.,DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1435264,3,"Upgrading this to P1. I am totally confident now that there's no firefox bug here, just a website issue for this test site, so this should not block WebAuthn's release IMO.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1435264,4,I'm pretty sure this is fixed by https://github.com/jcjones/webauthn.bin.coffee/commit/c21d5be2a739b2b061d3ce580eb4aeb069fb7765.,CODE_IMPLEMENTATION,1,FULL_TEXT
1435456,1,"Filed by: apavel [at] mozilla.com
https://treeherder.mozilla.org/logviewer.html#?job_id=160139385&repo=mozilla-central
https://queue.taskcluster.net/v1/task/Zkxi9RvxS5u84kr60XIRPA/runs/0/artifacts/public/logs/live_backing.log
https://hg.mozilla.org/mozilla-central/raw-file/tip/layout/tools/reftest/reftest-analyzer.xhtml#logurl=https://queue.taskcluster.net/v1/task/Zkxi9RvxS5u84kr60XIRPA/runs/0/artifacts/public/logs/live_backing.log&only_show_unexpected=1
[task 2018-02-02T20:35:07.544Z] 20:35:07     INFO -  REFTEST TEST-START | http://10.0.2.2:8888/tests/layout/reftests/w3c-css/submitted/test-template-001.xht == http://10.0.2.2:8888/tests/layout/reftests/w3c-css/submitted/references/test-template-001.xht
[task 2018-02-02T20:35:07.544Z] 20:35:07     INFO -  REFTEST INFO | RESTORE PREFERENCE pref(image.downscale-during-decode.enabled,false)
[task 2018-02-02T20:35:07.545Z] 20:35:07     INFO -  REFTEST TEST-LOAD | http://10.0.2.2:8888/tests/layout/reftests/w3c-css/submitted/test-template-001.xht | 141 / 311 (45%)
[task 2018-02-02T20:35:39.566Z] 20:35:39     INFO -  INFO | automation.py | Application ran for: 0:29:11.407899
[task 2018-02-02T20:35:39.567Z] 20:35:39     INFO -  INFO | zombiecheck | Reading PID log: /tmp/tmpgglIf5pidlog
[task 2018-02-02T20:35:40.664Z] 20:35:40     INFO -  REFTEST INFO | Copy/paste: /usr/local/bin/linux64-minidump_stackwalk /tmp/tmpoz21zD/36959e31-3443-5df1-1351-2e516ea6264d.dmp /builds/worker/workspace/build/symbols
[task 2018-02-02T20:35:50.085Z] 20:35:50     INFO -  REFTEST INFO | Saved minidump as /builds/worker/workspace/build/blobber_upload_dir/36959e31-3443-5df1-1351-2e516ea6264d.dmp
[task 2018-02-02T20:35:50.085Z] 20:35:50     INFO -  REFTEST INFO | Saved app info as /builds/worker/workspace/build/blobber_upload_dir/36959e31-3443-5df1-1351-2e516ea6264d.extra
[task 2018-02-02T20:35:50.089Z] 20:35:50     INFO -  REFTEST PROCESS-CRASH | http://10.0.2.2:8888/tests/layout/reftests/w3c-css/submitted/test-template-001.xht == http://10.0.2.2:8888/tests/layout/reftests/w3c-css/submitted/references/test-template-001.xht | application crashed [@ mozilla::image::Downscaler::Downscaler]
[task 2018-02-02T20:35:50.089Z] 20:35:50     INFO -  Crash dump filename: /tmp/tmpoz21zD/36959e31-3443-5df1-1351-2e516ea6264d.dmp
[task 2018-02-02T20:35:50.089Z] 20:35:50     INFO -  Operating system: Android
[task 2018-02-02T20:35:50.090Z] 20:35:50     INFO -                    0.0.0 Linux 2.6.29-gea477bb #1 Wed Sep 26 11:04:45 PDT 2012 armv7l
[task 2018-02-02T20:35:50.090Z] 20:35:50     INFO -  CPU: arm
[task 2018-02-02T20:35:50.090Z] 20:35:50     INFO -       ARMv7 ARM Cortex-A8 features: swp,half,thumb,fastmult,vfpv2,edsp,neon,vfpv3
[task 2018-02-02T20:35:50.090Z] 20:35:50     INFO -       1 CPU
[task 2018-02-02T20:35:50.090Z] 20:35:50     INFO -  GPU: UNKNOWN
[task 2018-02-02T20:35:50.091Z] 20:35:50     INFO -  Crash reason:  SIGSEGV
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -  Crash address: 0x0
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -  Process uptime: not available
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -  Thread 45 (crashed)
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -   0  libxul.so!mozilla::image::Downscaler::Downscaler [Downscaler.cpp:5d6d869ec7becc99b8c3dc639fc52e49b1af3ef1 : 30 + 0x0]
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -       r0 = 0x000000cc    r1 = 0xd4f7cd15    r2 = 0x600cdb1e    r3 = 0x0000001f
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -       r4 = 0x0000001f    r5 = 0x00000000    r6 = 0x00000020    r7 = 0x560ff6d8
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -       r8 = 0x6a8ad90c    r9 = 0x6a8ad800   r10 = 0x00000020   r12 = 0x00000003
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -       fp = 0x0000000c    sp = 0x560ff6d0    lr = 0x5c8dd0f1    pc = 0x5d2e34e6
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -      Found by: given as instruction pointer in context
[task 2018-02-02T20:35:50.094Z] 20:35:50     INFO -   1  libxul.so!mozilla::Maybe<mozilla::image::Downscaler>::emplace<mozilla::gfx::IntSizeTyped<mozilla::gfx::UnknownUnits> &> [Maybe.h:5d6d869ec7becc99b8c3dc639fc52e49b1af3ef1 : 459 + 0x5]
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       r4 = 0x6a8ad808    r5 = 0x6a8ad90c    r6 = 0x00000020    r7 = 0x560ff6e8
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       r8 = 0x6a8ad90c    r9 = 0x6a8ad800   r10 = 0x00000020    fp = 0x0000000c
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       sp = 0x560ff6e0    lr = 0x5d2e2753    pc = 0x5d2e2753
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -      Found by: call frame info
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -   2  libxul.so!mozilla::image::Decoder::PostSize [Decoder.cpp:5d6d869ec7becc99b8c3dc639fc52e49b1af3ef1 : 431 + 0x3]
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       r4 = 0x6a8ad800    r5 = 0x00000020    r6 = 0x00000020    r7 = 0x560ff720
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       r8 = 0x6a8ad90c    r9 = 0x6a8ad800   r10 = 0x00000020    fp = 0x0000000c
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       sp = 0x560ff6f0    lr = 0x5d2e2609    pc = 0x5d2e2609
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -      Found by: call frame info
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -   3  libxul.so!mozilla::image::nsICODecoder::FinishDirEntry [nsICODecoder.cpp:5d6d869ec7becc99b8c3dc639fc52e49b1af3ef1 : 309 + 0x7]
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       r2 = 0x00000020    r3 = 0x00000000    r4 = 0x54962828    r5 = 0x54962828
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       r6 = 0x00000001    r7 = 0x560ff770    r8 = 0x6a8ada00    r9 = 0x6a8ad800
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -      r10 = 0x00000020    fp = 0x0000000c    sp = 0x560ff728    lr = 0x5d31463f
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       pc = 0x5d31463f
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -      Found by: call frame info
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -   4  libxul.so!<name omitted> [nsICODecoder.cpp:5d6d869ec7becc99b8c3dc639fc52e49b1af3ef1 : 690 + 0x3]
[task 2018-02-02T20:35:50.095Z] 20:35:50     INFO -       r4 = 0x55cea770    r5 = 0x6a8ad800    r6 = 0x6a8ad94c    r7 = 0x560ff790
[task 2018-02-02T20:35:50.096Z] 20:35:50     INFO -       r8 = 0x6a8ad94c    r9 = 0x560ff7e8   r10 = 0x560ff830    fp = 0x6a8ad884
[task 2018-02-02T20:35:50.096Z] 20:35:50     INFO -       sp = 0x560ff778    lr = 0x5d322979    pc = 0x5d322979
[task 2018-02-02T20:35:50.096Z] 20:35:50     INFO -      Found by: call frame info
[task 2018-02-02T20:35:50.096Z] 20:35:50     INFO -   5  libxul.so!mozilla::image::nsICODecoder::DoDecode [StreamingLexer.h:5d6d869ec7becc99b8c3dc639fc52e49b1af3ef1 : 649 + 0x3]
[task 2018-02-02T20:35:50.097Z] 20:35:50     INFO -       r0 = 0x560ff7e8    r1 = 0x560ff7b0    r2 = 0x00000002    r3 = 0x57d23016
[task 2018-02-02T20:35:50.097Z] 20:35:50     INFO -       r4 = 0x55cea770    r5 = 0x6a8ad800    r6 = 0x6a8ad94c    r7 = 0x560ff820
[task 2018-02-02T20:35:50.097Z] 20:35:50     INFO -       r8 = 0x6a8ad94c    r9 = 0x560ff7e8   r10 = 0x560ff830    fp = 0x6a8ad884
[task 2018-02-02T20:35:50.097Z] 20:35:50     INFO -       sp = 0x560ff798    lr = 0x5d31587d    pc = 0x5d31587d
[task 2018-02-02T20:35:50.098Z] 20:35:50     INFO -      Found by: call frame info",STACK_TRACE,0,FULL_TOKEN
1435456,2,"2 failures in 735 pushes (0.003 failures/push) were associated with this bug in the last 7 days.    
Repository breakdown:
* mozilla-central: 2
Platform breakdown:
* android-4-3-armv7-api16: 2
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1435456&startday=2018-01-29&endday=2018-02-04&tree=all",UNCODED,0,UNMATCHED
1435456,3,"Looks like the same reason as bug 1434935, so not introduced by what Andrew landed today.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1435456,4,"Agreed. Given it is a live pref and can nominally change at any time, I think we can just take out the assert.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1435456,5,"Created attachment 8949519
0001-Bug-1435456-Remove-asserts-checking-that-downscale-o.patch, v1
Fix all the broken windows! :)",CODE_IMPLEMENTATION,1,FULL_TEXT
1435456,6,"I was thinking the same thing, then I thought about it more. All image decodes should be finished when the reftest finishes. and we haven't seen this failure for years, so why are we seeing it now?",QUESTION,0,FULL_TEXT
1435456,7,"Hmm, all image decodes that are part of the current view will be finished. The images could be coming from a previous test, and if the ordering of the tests recently changed, that could be enough.",ANSWER_TO_QUESTION,0,FULL_TEXT
1435456,8,"Why would we be decoding a previous test though? Even if it is that seems like a bug, we don't need a decode of that. I suppose it could be an image in the ui like you mentioned in the commit message, that would make some sense.",QUESTION,0,FULL_TEXT
1435456,9,"Pushed by aosmond@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/4afd35f217c1
Remove asserts checking that downscale-on-decode is enabled. r=tnikkel",UNCODED,0,UNMATCHED
1435456,10,*** Bug 1427073 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1435456,11,*** Bug 1352665 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1435456,12,*** Bug 1434935 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1435456,13,*** Bug 1433726 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1435456,14,https://hg.mozilla.org/mozilla-central/rev/4afd35f217c1,UNCODED,0,UNMATCHED
1435456,15,"2 failures in 702 pushes (0.003 failures/push) were associated with this bug in the last 7 days.    
Repository breakdown:
* try: 1
* mozilla-beta: 1
Platform breakdown:
* android-4-3-armv7-api16: 2
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1435456&startday=2018-02-05&endday=2018-02-11&tree=all",UNCODED,0,UNMATCHED
1435456,16,"1 failures in 675 pushes (0.001 failures/push) were associated with this bug in the last 7 days.    
Repository breakdown:
* mozilla-inbound: 1
Platform breakdown:
* linux64-stylo-disabled: 1
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1435456&startday=2018-02-19&endday=2018-02-25&tree=all",UNCODED,0,UNMATCHED
1441779,1,"There are at least 48 calls[1] similar to array.RemoveElementAt(array.Length() - 1). This patch adds nsTArray::RemoveLastElement() and nsTArray::PopLastElement(). 
[1]: https://searchfox.org/mozilla-central/search?q=RemoveElementAt%5C(.*Length.*-.%3F1%5C)&case=false&regexp=true&path=",CODE_IMPLEMENTATION,1,FULL_TEXT
1441779,2,"Created attachment 8954680
Bug 1441779 - Part 2: Add nsTArray::RemoveLastElement() and nsTArray::PopLastElement()
Review commit: https://reviewboard.mozilla.org/r/223782/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/223782/",PROBLEM_DESCRIPTION,0,FULL_TEXT
1441779,3,"Comment on attachment 8954680
Bug 1441779 - Part 2: Add nsTArray::RemoveLastElement() and nsTArray::PopLastElement()
https://reviewboard.mozilla.org/r/223782/#review229882
With tests, too!  Yay!
Please file a followup to replace the appropriate `RemoveElementAt` calls with this new API.  Thanks!
::: xpcom/ds/nsTArray.h:1738
(Diff revision 1)
I think that we want to `mozilla::Move(LastElement())` here, so we're not copying unnecessarily, and so we can support move-only types.",NEW_ISSUE_FILING,0,FULL_TOKEN
1441779,4,"Created attachment 8955122
Bug 1441779 - Part 1: Change nsTArray<SourceBufferTask> to nsTArray<RefPtr<SourceBufferTask>>
Review commit: https://reviewboard.mozilla.org/r/224280/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/224280/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1441779,5,"Comment on attachment 8954680
Bug 1441779 - Part 2: Add nsTArray::RemoveLastElement() and nsTArray::PopLastElement()
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/223782/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1441779,6,"Comment on attachment 8955122
Bug 1441779 - Part 1: Change nsTArray<SourceBufferTask> to nsTArray<RefPtr<SourceBufferTask>>
https://reviewboard.mozilla.org/r/224280/#review230410
Good catch!",CODE_REVIEW,0,FULL_TEXT
1441779,7,"Pushed by mikokm@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/757abead90e1
Part 1: Change nsTArray<SourceBufferTask> to nsTArray<RefPtr<SourceBufferTask>> r=gerald
https://hg.mozilla.org/integration/autoland/rev/1245c42d81aa
Part 2: Add nsTArray::RemoveLastElement() and nsTArray::PopLastElement() r=froydnj",UNCODED,0,UNMATCHED
1441779,8,"https://hg.mozilla.org/mozilla-central/rev/757abead90e1
https://hg.mozilla.org/mozilla-central/rev/1245c42d81aa",UNCODED,0,UNMATCHED
1454126,1,"Created attachment 8967914
testcase.html
==83696==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x7f2bf39babcf bp 0x7fff3b755170 sp 0x7fff3b755170 T0)
==83696==The signal is caused by a READ memory access.
==83696==Hint: address points to the zero page.
    #0 0x7f2bf39babce in nsMappedAttributes::GetAttr(nsAtom*) const src/dom/base/nsMappedAttributes.cpp:183:28
    #1 0x7f2bf835819b in AttrValueIs src/obj-firefox/dist/include/mozilla/dom/Element.h:2008:46
    #2 0x7f2bf835819b in IsMozEditorBogusNode src/obj-firefox/dist/include/mozilla/EditorBase.h:1073
    #3 0x7f2bf835819b in mozilla::TextEditRules::CreateBogusNodeIfNeeded(mozilla::dom::Selection*) src/editor/libeditor/TextEditRules.cpp:1435
    #4 0x7f2bf8357ab1 in mozilla::TextEditRules::Init(mozilla::TextEditor*) src/editor/libeditor/TextEditRules.cpp:143:17
    #5 0x7f2bf836686a in mozilla::TextEditor::EndEditorInit() src/editor/libeditor/TextEditor.cpp:208:17
    #6 0x7f2bf8367958 in ~AutoEditInitRulesTrigger src/editor/libeditor/TextEditUtils.cpp:93:28
    #7 0x7f2bf8367958 in mozilla::TextEditor::Init(nsIDocument&, mozilla::dom::Element*, nsISelectionController*, unsigned int, nsTSubstring<char16_t> const&) src/editor/libeditor/TextEditor.cpp:142
    #8 0x7f2bf6849ab0 in nsTextEditorState::PrepareEditor(nsTSubstring<char16_t> const*) src/dom/html/nsTextEditorState.cpp:1414:25
    #9 0x7f2bf8b81cef in nsTextControlFrame::EnsureEditorInitialized() src/layout/forms/nsTextControlFrame.cpp:317:28
    #10 0x7f2bf66ba683 in mozilla::dom::HTMLInputElement::GetEventTargetParent(mozilla::EventChainPreVisitor&) src/dom/html/HTMLInputElement.cpp:3429:25
    #11 0x7f2bf6436cd8 in mozilla::EventTargetChainItem::GetEventTargetParent(mozilla::EventChainPreVisitor&) src/dom/events/EventDispatcher.cpp:425:12
    #12 0x7f2bf643a9af in mozilla::EventDispatcher::Dispatch(nsISupports*, nsPresContext*, mozilla::WidgetEvent*, nsIDOMEvent*, nsEventStatus*, mozilla::EventDispatchingCallback*, nsTArray<mozilla::dom::EventTarget*>*) src/dom/events/EventDispatcher.cpp:894:19
    #13 0x7f2bf89b9645 in mozilla::ScrollFrameHelper::FireScrollEvent() src/layout/generic/nsGfxScrollFrame.cpp:4972:5
    #14 0x7f2bf89b9034 in mozilla::ScrollFrameHelper::ScrollEvent::Run() src/layout/generic/nsGfxScrollFrame.cpp:4925:14
    #15 0x7f2bf85ae73b in nsRefreshDriver::DispatchScrollEvents() src/layout/base/nsRefreshDriver.cpp:1289:12
    #16 0x7f2bf85b1242 in nsRefreshDriver::Tick(long, mozilla::TimeStamp) src/layout/base/nsRefreshDriver.cpp:1893:7
    #17 0x7f2bf85c1310 in TickDriver src/layout/base/nsRefreshDriver.cpp:337:13
    #18 0x7f2bf85c1310 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray<RefPtr<nsRefreshDriver> >&) src/layout/base/nsRefreshDriver.cpp:307
    #19 0x7f2bf85c0ec4 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) src/layout/base/nsRefreshDriver.cpp:328:5
    #20 0x7f2bf85c3c4e in RunRefreshDrivers src/layout/base/nsRefreshDriver.cpp:770:5
    #21 0x7f2bf85c3c4e in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::TickRefreshDriver(mozilla::TimeStamp) src/layout/base/nsRefreshDriver.cpp:683
    #22 0x7f2bf85becf9 in mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::ParentProcessVsyncNotifier::Run() src/layout/base/nsRefreshDriver.cpp:529:20
    #23 0x7f2bf0777c89 in nsThread::ProcessNextEvent(bool, bool*) src/xpcom/threads/nsThread.cpp:1096:14
    #24 0x7f2bf07936c0 in NS_ProcessNextEvent(nsIThread*, bool) src/xpcom/threads/nsThreadUtils.cpp:519:10
    #25 0x7f2bf165c74a in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) src/ipc/glue/MessagePump.cpp:97:21
    #26 0x7f2bf15b1289 in RunInternal src/ipc/chromium/src/base/message_loop.cc:326:10
    #27 0x7f2bf15b1289 in RunHandler src/ipc/chromium/src/base/message_loop.cc:319
    #28 0x7f2bf15b1289 in MessageLoop::Run() src/ipc/chromium/src/base/message_loop.cc:299
    #29 0x7f2bf805fd3a in nsBaseAppShell::Run() src/widget/nsBaseAppShell.cpp:157:27
    #30 0x7f2bfc0ef06b in nsAppStartup::Run() src/toolkit/components/startup/nsAppStartup.cpp:290:30
    #31 0x7f2bfc2f7c1c in XREMain::XRE_mainRun() src/toolkit/xre/nsAppRunner.cpp:4834:22
    #32 0x7f2bfc2fad5c in XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) src/toolkit/xre/nsAppRunner.cpp:4979:8
    #33 0x7f2bfc2fc224 in XRE_main(int, char**, mozilla::BootstrapConfig const&) src/toolkit/xre/nsAppRunner.cpp:5071:21
    #34 0x4f168b in do_main src/browser/app/nsBrowserApp.cpp:231:22
    #35 0x4f168b in main src/browser/app/nsBrowserApp.cpp:304
    #36 0x7f2c0fe9482f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291
    #37 0x420f48 in _start (firefox+0x420f48)",STACK_TRACE,0,FULL_TOKEN
1454126,2,This may be related to bug 1454139 or bug 1454133 so marking as s-s.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1454126,3,"Masayuki, this looks editor related. Could you take a look? Thanks.",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1454126,4,"I investigated this yesterday but I still don't understand what happens. I cannot access the bugs mentioned in comment 3. If they could be good hint, could you cc me them too?",PROBLEM_REVIEW,0,FULL_TEXT
1454126,5,"Okay, got it. insertHorizontalRule command inserted <hr> element into the <input> element such DOM tree isn't expected by some places.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1454126,6,"Created attachment 8968456
Patch for m-c
See the commit message for the detail. This is caused by creating unexpected anonymous subtree in <input> element.",CODE_IMPLEMENTATION,1,FULL_TEXT
1454126,7,"Created attachment 8968457
Patch for Beta",UNCODED,0,UNMATCHED
1454126,8,I've CC'ed you on those bugs in case they would be useful.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1454126,9,"Comment on attachment 8968456
Patch for m-c
Review of attachment 8968456:
-----------------------------------------------------------------
Since this bug is marked as core-security, I think you shouldn't land test case with fix according to https://wiki.mozilla.org/Security/Bug_Approval_Process.
::: editor/libeditor/EditorDOMPoint.h
@@ +556,5 @@
nsIContent* parent?",QUESTION,0,FULL_TEXT
1454126,10,"Ah, no, parent can be a document node which is not derived from nsIContent. Therefore, mParent is nsINode. However, I used nsINode::GetParent() instead of nsINode::GetParentNode().  I'll change the method. (Although mParent shouldn't become document node in most cases.)",ANSWER_TO_QUESTION,0,FULL_TOKEN
1454126,11,"Created attachment 8968770
The patch for m-c (r=m_kato)
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
It's easy since the patch includes the testcase to reproduce this crash.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
I don't think so. This looks like just a crash bug fix if there is no link to this closed bug report.
Which older supported branches are affected by this flaw?
Not sure but ESR 52 doesn't support <detail> and the testcase won't work as expected.
If not all supported branches, which bug introduced the flaw?
Not sure. Possible to change native anonymous subtree in <input>/<textarea> with execCommand() must be long standing bug. However, the crash itself must be newer bug since a lot of safer code have been replaced with faster code with Quantum Flow.
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
I created same patch for Beta branch too.
How likely is this patch to cause regressions; how much testing does it need?
This patch just avoids to insert unexpected DOM nodes into <input>/<textarea>'s anonymous subtree.  And such behavior has never been expected.  Therefore, this patch must be safe.  And also this patch includes the testcase of comment 0.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1454126,12,"Created attachment 8968771
Patch for Beta",UNCODED,0,UNMATCHED
1454126,13,*** Bug 1454139 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1454126,14,"Actually, Dan looked at this and said it looks like a null deref and not a serious security bug. This isn't a sec-high.
I'll clear sec-approval but we REALLY shouldn't check in tests with any kind of security issue. If this was a sec-high or sec-critical, I'd deny the sec-approval and ask for a patch with no test.",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1454126,15,Hold on this is a dup of bug 1454139 which is not a null deref.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1454126,16,"Making this a sec-high. 
This needs a patch which DOES NOT include a test. We're not allowed to zero day ourselves with a checkin (that's part of why sec-approval) exits.
The test can land 3-4 weeks after we ship a release with the fix and not before then. 
Masayuki, please update with a new patch and set sec-approval? on it.",REQUIREMENT,0,FULL_TOKEN
1454126,17,"Set the in-testsuite flag to '?' when you land the patch without tests, then later when the test lands set it to in-testsuite+",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1454126,18,"Created attachment 8969163
Patch for m-c (r=m_kato)
[Security approval request comment]
See comment 10. But this does NOT include the test.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1454126,19,"Created attachment 8969164
Patch for Beta",UNCODED,0,UNMATCHED
1454126,20,"Comment on attachment 8969163
Patch for m-c (r=m_kato)
sec-approval+ for trunk. Given we have a week of betas left, I'll let release management make the decision about taking it on Beta.",CODE_REVIEW,0,FULL_TEXT
1454126,21,"Hi Masayuki, can you please nominate the patch for beta60 uplift? Thanks!",UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1454126,22,"https://hg.mozilla.org/integration/mozilla-inbound/rev/4ac461885d8c424010d4e442e649d06acb9d2d60
Bug 1454126 - HTMLEditor should adjust selection outside native anonymous subtree when it inserts something at selection r=m_kato",UNCODED,0,UNMATCHED
1454126,23,"Comment on attachment 8969164
Patch for Beta
Approval Request Comment
[Feature/Bug causing the regression]:
Not sure. This root cause must be a long standing bug. However, the crash must be caused by Quantum Flow since a lot places started to assume native anonymous subtree in <input>/<textarea> are always expected structure. Therefore, the crash is not reproducible with ESR 52.
[User impact if declined]
Might get odd HTML tree (i.e., |foo.innerHTML = bar.innerHTML;| doesn't create same DOM tree since <input> cannot have any children at parsing HTML document). And of course, may meet the crash.
[Is this code covered by automated tests?]:
Not yet. We should land it after release.
[Has the fix been verified in Nightly?]:
Not yet, but I confirmed it with local build.
[Needs manual test from QE? If yes, steps to reproduce]:
Yes, load attachment 8967914 and check if it won't cause crash.
[List of other uplifts needed for the feature/fix]:
Nothing.
[Is the change risky?]:
No.
[Why is the change risky/not risky?]:
This adds an additional check to HTMLEditor::GetBetterInsertionPointFor(). The additional new check is, if it's not in native anonymous subtree.  If it's in, it returns host element of the native anonymous subtree.
[String changes made/needed]:
Nothing.",REQUEST_FOR_UPLIFT,0,90_PCT_MATCH
1454126,24,https://hg.mozilla.org/mozilla-central/rev/4ac461885d8c,UNCODED,0,UNMATCHED
1454126,25,"Comment on attachment 8969164
Patch for Beta
Approved for today's 60.0b15 build.",UPLIFT_APPROVAL,0,FULL_TEXT
1454126,26,https://hg.mozilla.org/releases/mozilla-beta/rev/e41d8e56d3e6,UNCODED,0,UNMATCHED
1454126,27,*** Bug 1454133 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1454126,28,*** Bug 1452704 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1456911,1,"I haven't tested this yet, but it seems to be the case from code inspection: if a file descriptor in LaunchOptions::fds_to_remap has the same numeric value in the parent as the child, it won't have its close-on-exec bit cleared.  (In contrast, the general case dup2()s the descriptor, which does clear close-on-exec.)  So if the fd was close-on-exec, which is the general best practice, it will be closed on exec instead of inherited.
Note that dup2(x, x) is defined as a no-op and POSIX specifically says it won't change the close-on-exec bit, so that will need to be done explicitly.
This *probably* isn't a problem in practice, because the low-valued fds we map things to will *probably* wind up occupied by long-lived fds in the parent process but maybe not.  In any case I'd like to rule this out as a possible cause of bug 1455828.
Interestingly, Chromium's current version of this code doesn't seem to handle that either, so maybe I'm missing something... or maybe they have a 10-year-old bug.",PROBLEM_REVIEW,0,FULL_TOKEN
1456911,2,"Another possibility is to just rip out most of this code, and instead dup() as needed to keep the source and destination fd ranges disjoint, at which point everything gets dup2()ed and this isn't a special case.
That could also help for the posix_spawn implementation on Mac, which isn't using this and should be (that's another bug I'm in the middle of filing), because I've heard that OS X doesn't like identity mappings with posix_spawn_file_actions_adddup2 (which, if true, is an OS bug, and also I have no idea how it interacts with POSIX_SPAWN_CLOEXEC_DEFAULT).",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1456911,3,"I've tested this, and an identity-mapped close-on-exec file does in fact fail to be inherited.
As for comment #1:
From looking at the kernel code, OS X's implementation of posix_spawn_file_actions_adddup2 seems to correct for the old==new case, and it ought to exempt the fd from POSIX_SPAWN_CLOEXEC_DEFAULT, but I haven't tested that yet.
But, the current file_descriptor_shuffle assumes it can dup() in the child process, which will be a problem for bug 1456919, so that's another reason to rewrite.",PROBLEM_REVIEW,0,FULL_TOKEN
1456911,4,"Created attachment 8983991
Bug 1456911 - Prelude: Fix unified build breakage exposed by the next patch.
This directory has a number of places where files unintentionally depend
on `#include`s and `using` directives and forward declarations in other
files in the same unified build group.  Adding a file shifts the group
boundaries and exposes some of those bugs; this patch fixes them (but
there are others).
Review commit: https://reviewboard.mozilla.org/r/249864/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/249864/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1456911,5,"Created attachment 8983992
Bug 1456911 - Rewrite the fd shuffling to be simpler & handle identity mappings correctly.
This replaces some old Chromium code that tries to minimally disentangle
an arbitrary file descriptor mapping with simpler algorithm, for several
reasons:
1. Do something appropriate when a file descriptor is mapped to the same
fd number in the child; currently they're ignored, which means they'll
be closed if they were close-on-exec.  This implementation duplicates
the fd twice in that case, which seems to be uncommon in practice; this
isn't maximally efficient but avoids special-case code.
2. Make this more generally applicable; the previous design is
specialized for arbitrary code running between fork and exec, but we
also want to use this on OS X with posix_spawn, which exposes a very
limited set of operations.
3. Avoid the use of C++ standard library iterators in async signal safe
code; the Chromium developers mention that this is a potential problem in
some debugging implementations that take locks.
4. In general the algorithm is simpler and should be more ""obviously
correct""; more concretely, it should get complete coverage just by being
run normally in a debug build.
As a convenient side benefit, CloseSuperfluousFds now takes an arbitrary
predicate for which fds to leave open, which means it can be used in
other code that needs it without creating a fake fd mapping.
Review commit: https://reviewboard.mozilla.org/r/249866/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/249866/",CODE_IMPLEMENTATION,1,MANUAL
1456911,6,"Comment on attachment 8983991
Bug 1456911 - Prelude: Fix unified build breakage exposed by the next patch.
https://reviewboard.mozilla.org/r/249864/#review256226",UNCODED,0,UNMATCHED
1456911,7,"Comment on attachment 8983992
Bug 1456911 - Rewrite the fd shuffling to be simpler & handle identity mappings correctly.
https://reviewboard.mozilla.org/r/249866/#review256270
This is nice.
::: ipc/chromium/src/base/process_util.h:92
(Diff revision 1)
Maybe rewrite this as ""Close all file descriptors, except for std{in,out,err} and those for which the given function returns true.""?  I took the current wording to mean the function could return std{in,out,err}, which is admittedly bizarre, and that might have just been me.
::: ipc/glue/FileDescriptorShuffle.h:47
(Diff revision 1)
Should this return value be `const`?",CODE_REVIEW,0,FULL_TOKEN
1456911,8,"Thanks for the review.
Yeah, that looks a little odd; I'll reword.
Making the Span itself const won't change anything, I don't think?  And the pointer target type is already const.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1456911,9,"Comment on attachment 8983991
Bug 1456911 - Prelude: Fix unified build breakage exposed by the next patch.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/249864/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1456911,10,"Comment on attachment 8983992
Bug 1456911 - Rewrite the fd shuffling to be simpler & handle identity mappings correctly.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/249866/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1456911,11,"Pushed by jedavis@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/808a2fe2aaab
Prelude: Fix unified build breakage exposed by the next patch. r=froydnj
https://hg.mozilla.org/integration/autoland/rev/69ffa8eab9d9
Rewrite the fd shuffling to be simpler & handle identity mappings correctly. r=froydnj",UNCODED,0,UNMATCHED
1456911,12,"https://hg.mozilla.org/mozilla-central/rev/808a2fe2aaab
https://hg.mozilla.org/mozilla-central/rev/69ffa8eab9d9",UNCODED,0,UNMATCHED
1467403,1,"I cannot find any case that prologue contains source notes.
we could remove code which handles it.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1467403,2,"it's always empty.
https://treeherder.mozilla.org/#/jobs?repo=try&revision=f73c011efe69f74cf15169e8d3966587a911a5bf",PROBLEM_MOTIVATION,0,FULL_TOKEN
1467403,3,"Created attachment 8984332
Remove the source notes handling for prologue bytecode.
mostly just removed the code that handles when prologue have source notes.
BytecodeEmitter::finishTakingSrcNotes's else-clause is necessary since the delta of the source note in the main section has to be updated to reflect the prologue bytecode length.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1467403,4,"Comment on attachment 8984332
Remove the source notes handling for prologue bytecode.
Review of attachment 8984332:
-----------------------------------------------------------------
Nice!
::: js/src/frontend/BytecodeEmitter.cpp
@@ +11458,5 @@
Nit: we usually have a blank line before comments like this, if not at the start of a block?",CODE_REVIEW,0,FULL_TEXT
1467403,5,"https://hg.mozilla.org/integration/mozilla-inbound/rev/09d892dcaca7f8700a08f14b3b075b769bd82c5d
Bug 1467403 - Remove the source notes handling for prologue bytecode. r=jandem",UNCODED,0,UNMATCHED
1467403,6,https://hg.mozilla.org/mozilla-central/rev/09d892dcaca7,UNCODED,0,UNMATCHED
1479989,1,Disable BigInt variants of tests disabled due to bug 1317416.,CODE_IMPLEMENTATION,1,FULL_TEXT
1479989,2,"Created attachment 8996593
Update test262 exclusions for BigInt.
Disable BigInt variants of tests disabled due to bug 1317416.",PROBLEM_DESCRIPTION,0,FULL_TEXT
1479989,3,"Comment on attachment 8996593
Update test262 exclusions for BigInt.
Review of attachment 8996593:
-----------------------------------------------------------------
Thanks!",CODE_REVIEW,0,FULL_TEXT
1479989,4,":terpri this looks still valid, can you set checkin-needed please?",QUESTION,0,FULL_TEXT
1479989,5,"Created attachment 9024894
bug 1479989 - Update test262 exclusions for BigInt. r=anba
Disable BigInt variants of tests disabled due to bug 1079853, bug 1129202, or bug 1317416.",CODE_IMPLEMENTATION,1,FULL_TEXT
1479989,6,"still valid, but incomplete; I added some TypedArray-related exclusions",ANSWER_TO_QUESTION,0,FULL_TEXT
1479989,7,"Pushed by nbeleuzu@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/2a0b1c169e24
Update test262 exclusions for BigInt. r=wingo",UNCODED,0,UNMATCHED
1479989,8,https://hg.mozilla.org/mozilla-central/rev/2a0b1c169e24,UNCODED,0,UNMATCHED
1482681,1,"Reproducible : always:
Steps To Reproduce:
1. Open a page with iframe
   e.g, https://www.scollabo.com/banban/ref/sample/sample_61.html
2. Right click on a iframe
3. Choose ""This Frame"" > ""Open Frame in New Tab"" stops working
Actual Results:
Nothing happens.
The following error is shown in Browser Console:
Error: Required argument triggeringPrincipal missing within loadOneTab tabbrowser.js:1378:13
Expected Results:
Frame contents should open in new tab
Regression window:
https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=e17409c5199c0ade0de9899782d6a9f5f4970871&tochange=6f3907a1da34a62133832dc981e9005ee30e9388
Regressed by: Bug 1362034",PROBLEM_DESCRIPTION,0,90_PCT_MATCH
1482681,2,"Just writing up a test for this, I have a fix already.",STATUS_UPDATE,0,FULL_TEXT
1482681,3,"Created attachment 8999555
Bug 1482681 - Fix load iframe in tab context menu.",UNCODED,0,UNMATCHED
1482681,4,You should add your support file under the specific test rather than [DEFAULT].,CODE_REVIEW,0,FULL_TEXT
1482681,5,"Comment on attachment 8999555
Bug 1482681 - Fix load iframe in tab context menu.
Johann Hofmann [:johannh] has approved the revision.",CODE_REVIEW,0,FULL_TEXT
1482681,6,"Pushed by jkingston@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e8a70b46acab
Fix load iframe in tab context menu. r=johannh",UNCODED,0,UNMATCHED
1482681,7,https://hg.mozilla.org/mozilla-central/rev/e8a70b46acab,UNCODED,0,UNMATCHED
1482681,8,"Is there a followup for correcting the triggering principal here (ie use that of the enclosing document, not necessarily that of the toplevel doc) ?",QUESTION,0,FULL_TEXT
1482681,9,Bug filed: https://bugzilla.mozilla.org/show_bug.cgi?id=1484735,NEW_ISSUE_FILING,0,FULL_TEXT
1486218,1,"This bug was filed from the Socorro interface and is
report bp-d6e71090-ea55-42e0-bb39-6e0530180825.
=============================================================
Top 10 frames of crashing thread:
0 xul.dll static void std::panicking::rust_panic_with_hook src/libstd/panicking.rs:521
1 xul.dll static void std::panicking::continue_panic_fmt src/libstd/panicking.rs:426
2 xul.dll static void std::panicking::rust_begin_panic src/libstd/panicking.rs:337
3 xul.dll static void core::panicking::panic_fmt src/libcore/panicking.rs:92
4 xul.dll static void core::option::expect_failed src/libcore/option.rs:960
5 xul.dll static union core::option::Option<euclid::transform3d::TypedTransform3D<f32, webrender_api::units::LayoutPixel, webrender_api::units::LayoutPixel>> webrender::clip_scroll_tree::ClipScrollTree::get_relative_transform gfx/webrender/src/clip_scroll_tree.rs:164
6 xul.dll static void webrender::prim_store::PrimitiveStore::prepare_prim_runs gfx/webrender/src/prim_store.rs:1814
7 xul.dll static union core::option::Option<euclid::rect::TypedRect<f32, webrender_api::units::LayoutPixel>> webrender::prim_store::PrimitiveStore::prepare_prim_for_render gfx/webrender/src/prim_store.rs:1562
8 xul.dll static void webrender::prim_store::PrimitiveStore::prepare_prim_runs gfx/webrender/src/prim_store.rs:1819
9 xul.dll static union core::option::Option<euclid::rect::TypedRect<f32, webrender_api::units::LayoutPixel>> webrender::prim_store::PrimitiveStore::prepare_prim_for_render gfx/webrender/src/prim_store.rs:1562
=============================================================
There are 2 crashes (from 1 installation) in nightly 63 with buildid 20180824222409. In analyzing the backtrace, the regression may have been introduced by patch [1] to fix bug 1485691.
[1] https://hg.mozilla.org/mozilla-central/rev?node=4a57ba156ecf",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1486218,2,"Marking fix-optional for 64. We could still take a patch for 65, and if it's verified and doesn't seem risky, could still take fixes for 64 as well.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1486218,3,This will most likely be fixed by https://github.com/servo/webrender/pull/3331 when it lands in Gecko.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1486218,4,"Should be fixed now, reopen if it comes back",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1487135,1,"It looks like we always allocate an AuthorStyles in the ShadowRoot constructor.  In the case of <svg:use>, we don't do anything with stylesheets in the shadow tree, so the AuthorStyles there is unused.
In fact, maybe we should consider allocating AuthorStyles lazily in general, for all the cases when shadow trees don't have styles inside them.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1487135,2,"Created attachment 9005065
Make the allocation of AuthorStyles for ShadowRoot lazy.
So that we don't waste a bunch of memory with stuff like <svg:use>. I
plan to shrink AuthorStyles further, but this should help regardless, and isn't
very complex.",CODE_IMPLEMENTATION,1,90_PCT_MATCH
1487135,3,"Comment on attachment 9005065
Make the allocation of AuthorStyles for ShadowRoot lazy.
Xidorn Quan [:xidorn] UTC+10 has approved the revision.",CODE_REVIEW,0,FULL_TEXT
1487135,4,"Pushed by emilio@crisal.io:
https://hg.mozilla.org/integration/autoland/rev/94b793d95409
Make the allocation of AuthorStyles for ShadowRoot lazy. r=xidorn,firefox-style-system-reviewers",UNCODED,0,UNMATCHED
1487135,5,"Pushed by emilio@crisal.io:
https://hg.mozilla.org/integration/autoland/rev/752786e0dd01
followup: Add a missing check. r=me",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1487135,6,"https://hg.mozilla.org/mozilla-central/rev/94b793d95409
https://hg.mozilla.org/mozilla-central/rev/752786e0dd01",UNCODED,0,UNMATCHED
1493860,1,"In bug 1368949 I am going to change the behavior of our webidl codegen for optional dictionary-typed members of dictionaries to allow them to be ""not present"" instead of always defaulting to null.
I am adding explicit ""= null"" to all of the current uses to preserve behavior; the change is being made now so some new APIs can rely on it.
This bug is for going through those ""= null"" and deciding which of them should stay (and get upstreamed to the relevant specs) and which should go away.  In the latter case, the relevant specs should be audited to see whether they define the ""not present"" case.
We may want multiple bugs under this one tracking the various spec bits.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1493860,2,"For DeviceMotionEventInit, there is some ongoing discussion at https://github.com/w3c/deviceorientation/issues/54",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1493860,3,"Consequences of ""null becomes empty dictionary."" Will do these incrementally... starting with the easy one. 
## Payment Request
With: 
```
PaymentDetailsModifier{
  PaymentItem total = null;
}
```
Would break, `PaymentItem` has `required` members `currency` and `item`. Those members can't be defaulted, unfortunately.
## dictionary PaymentDetailsUpdate
With the following change: 
```
dictionary PaymentDetailsUpdate : PaymentDetailsBase {
  AddressErrors shippingAddressErrors = null;
  PaymentItem   total = null;
}
```
Setting `shippingAddressErrors` to null is fine, however. 
However, setting `total` to null would break for the reasons give above about `PaymentItem`.",PROBLEM_REVIEW,0,FULL_TOKEN
1493860,4,"## Audit of Web Authentication / Credential Management
1) Should the ""= null"" stay?
This is bug: https://github.com/w3c/webauthn/issues/750
And yes, it should stay. Also with the fixes in #750. 
The spec needs to be updated to deal with ""challenge"" being null, as well as some other values being nulled. 
Git blame says ask @qdot :) What happens if `mChallenge` is passed as null in `dom/webauthn/WebAuthnManager.cpp`? I'm guessing it's all good, as you reviewed bug 1368949?",PROBLEM_REVIEW,0,FULL_TOKEN
1493860,5,"## Audit of Push API
The IDL is out of date!
The proposed change was: 
```
dictionary PushSubscriptionJSON {
  PushSubscriptionKeys keys = null;
}
```
In the latest spec, it is now:
```
dictionary PushSubscriptionJSON {
  record<DOMString, USVString> keys;
}
```
This one doesn't matter. It's the result of a PushSubscription.toJSON(). 
@lina, I couldn't find a bug to update the IDL to match latest spec. Do you have any status on Push API implementation?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1493860,6,"I've sent a pull request to Payment Request to default the *Error members ones to `null`.
https://github.com/w3c/payment-request/pull/781
I've checked the algorithms in the spec, and they are all fine (basically ""For each member, show error..."" - but no requirement that any member be there). 
We now need to deal explicitly with `total`s PaymentCurrencyAmount... I don't think suggesting defaults to the Working Group for `currency` and `value` wouldn't got down well.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1493860,7,"So one complication: it's not clear to me that the ""= null"" thing is valid IDL given the current state of the IDL spec.  It works in Gecko, and I think having it work in the IDL spec would make some sense, but it's not clear that it does right now.
For WebAuthn, I'm not sure whether they decided to allow a missing challenge or to stick with the challenge being required.  Needs to get sorted out...
For payment request, if the spec algorithms handle the ""not present"" case, why would we want to add ""= null""?
What's the state of the MediaStreamTrack bit?",SOLUTION_REVIEW,1,FULL_TOKEN
1493860,8,"Bringing in :jcj since he's dealing with the WebAuthn spec, which has changed a lot since I did my work there.",STATUS_UPDATE,0,FULL_TEXT
1493860,9,"My understanding of the WebAuth issue is that null is a valid Buffer value. So even requiring it, a developer can legally pass null (and the spec doesnt seem to deal with that). 
If null becomes an empty dictionary, then it works just fine because it means one less check. But yes, checking is present works, then walk the members that are present (if any). 
Sorry, I saw the RTC folks so involved in the other bugs that I figured they had a solution. Ill deep dive into that too.",SOLUTION_REVIEW,1,FULL_TEXT
1493860,10,"It's definitely required, may not be null [0], and if we reach one of the places we copy Challenge [1][2] then badness could ensuse. Best case scenario is an untrustworthy webauthn session.
Doing this on current nightly, presumably with bug 1368949, still yields 
but I would guess we need to check each parameter on the way into the function now rather than rely on the webidl checks? Regarding the challenge field in particular, I filed Bug 1494738 to do something for the last sentence of [0].
[0] https://w3c.github.io/webauthn/#cryptographic-challenges
[1] https://searchfox.org/mozilla-central/source/dom/webauthn/WebAuthnManager.cpp#331
[2] https://searchfox.org/mozilla-central/source/dom/webauthn/WebAuthnManager.cpp#480",SOLUTION_REVIEW,1,FULL_TOKEN
1493860,11,"Right, because I explicitly kept the old behavior pending someone who knows webauthn looking at it.
What you can do is remove the ""= null"" bits from WebAuthentication.webidl and then fix the resulting compile errors in whatever way the spec says that stuff should work.   Assuming it says.",SOLUTION_REVIEW,1,FULL_TOKEN
1493860,12,":jib, I could use some help with the WebRTC parts - please see what changed in the IDL in 1368949.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1493860,13,"Thanks, I've opened bug 1497351 to fix the WebRTC parts.",NEW_ISSUE_FILING,0,FULL_TEXT
1493860,14,"Hi Marcos, I'm so sorry for the delay in getting back to you! I filed bug 1497427 to capture the work to update the Push API; bug 1497429, bug 1497430, and bug 1497431 are for the IDL bits. Unfortunately, I don't have cycles to work on them. :-(",NEW_ISSUE_FILING,0,FULL_TEXT
1493860,15,*** Bug 1505842 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1493860,16,"The remaining bug for Push is tracked by https://bugzilla.mozilla.org/show_bug.cgi?id=1497427, so closing this.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1494092,1,"The IsInObserverList related code in SVGObserverUtils.h/.cpp is unfortunate since it seems like we shouldn't need to check this. The code is only used in one place, in nsSVGIntegrationUtils::AdjustInvalidAreaForSVGEffects. This mechanism was introduced in bug 587336:
https://hg.mozilla.org/mozilla-central/rev/c7726ff56cbf
This code is from eight years ago when we were still recursing up the frame invalidating each frame whenever we needed to invalidate something. The code was introduced to prevent an invalidation loop. What was happening is that the frame with a filter(#parent) would invalidate, the recursive invalidation would recurse up the frame tree, invalidating the parent which would post a (change hint) restyle event at the original frame referencing the ""filter"" parent. Hence, invalidation loop forever.
Now that we are in a DLBI world the original reason to have this hack has gone.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1494092,2,"Unfortunately, removing this code causes the following two reftests to fail:
  layout/reftests/invalidation/scroll-inactive-layers.html
  layout/reftests/invalidation/scroll-inactive-layers-2.html
These tests check that scrolling doesn't cause repainting of inactive (opacity/transform/filter/mask) layers.
Despite the IsInObserverList code being purely for filters, it is the masked element that is repainting on scroll, causing the test failure.
The relevant change to the code is the removal of the first highlighted block here:
https://searchfox.org/mozilla-central/source/layout/svg/nsSVGIntegrationUtils.cpp#328-330,334-341
What seems to happen is that, with the removal of the first `if` block we no longer early return aInvalidRegion. Instead we enter the second `if` block because 'observers' is nullptr (since the nsSVGMaskFrame does not have a SVGFilterObserverListForCSSProp of course) and return the value computed there.
Specifically in my testing, before removing the hack we return aInvalidRegion with the values:
  left     748
  top     2104
  right    952
  bottom  4458
After removing the first `if` block we return:
  left     748
  top      254
  right    952
  bottom  4459
The much smaller value for 'top' is what makes the difference and cause us to fail.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1494092,3,"The call stack here is:
  nsSVGIntegrationUtils::AdjustInvalidAreaForSVGEffects
  mozilla::FrameLayerBuilder::AddPaintedDisplayItem
  mozilla::PaintedLayerDataNode::PopAllPaintedLayerData
  mozilla::PaintedLayerDataNode::Finish
  mozilla::PaintedLayerDataNode::FinishChildrenIntersecting
  mozilla::PaintedLayerDataTree::FinishPotentiallyIntersectingNodes
  mozilla::PaintedLayerDataTree::AddingOwnLayer
  mozilla::ContainerState::ProcessDisplayItems
  mozilla::FrameLayerBuilder::BuildContainerLayerFor
  nsDisplayList::BuildLayers
  nsDisplayList::PaintRoot
  nsLayoutUtils::PaintFrame
  mozilla::PresShell::Paint
  nsViewManager::ProcessPendingUpdatesPaint
  nsViewManager::ProcessPendingUpdatesForView
  nsViewManager::ProcessPendingUpdates
  nsRefreshDriver::Tick
Looking at AddPaintedDisplayItem, it seems that what it passes into AdjustInvalidAreaForSVGEffects as the value for aInvalidRegion is:
  frame->GetVisualOverflowRect()
    .ToOutsidePixels(appUnitsPerDevPixel);
whereas what we return when we fail is:
  (frame->GetVisualOverflowRect() + aToReferenceFrame)
    .ToOutsidePixels(appUnitsPerDevPixel)
There's clearly a bug in the removed `if` block where it fails to take account of aToReferenceFrame, and that that bug is hiding the fact that even without my change we are *already* invalidating the masked element in the two failing reftests. The only reason that the tests don't actually fail is because the preexisting bug results in the invalid area being offscreen.
The fact that these tests should already currently be failing makes me think that they shouldn't block removing this old hack. We should remove it and be honest about the state of the tests by marking them as failing (filing a follow-up bug to fix that of course).",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1494092,4,"Permalink:
https://searchfox.org/mozilla-central/rev/881a3c5664ede5e08ee986d76433bc5c4b5680e6/layout/svg/nsSVGIntegrationUtils.cpp#328-330,334-341",UNCODED,0,UNMATCHED
1494092,5,I've spun off bug 1494110 for the preexisting invalidation issue.,STATUS_UPDATE,0,FULL_TEXT
1494092,6,"Created attachment 9011962
Bug 1494092. Remove SVGFilterObserverList::IsInObserverLists. r?mattwoodrow
This code is no longer necessary since we now invalidate using Display List
Based Invalidation instead of using recursive calls up the frame tree.
The tests that are marked as failing have only been passing due to a bug in the
code that's being removed from nsSVGIntegrationUtils.cpp which coincidentally
hides the fact that we are actually invalidating in those tests given their
particular structure (which the tests are supposed to be checking we're not
doing).",CODE_IMPLEMENTATION,1,FULL_TOKEN
1494092,7,"Comment on attachment 9011962
Bug 1494092. Remove SVGFilterObserverList::IsInObserverLists. r?mattwoodrow
Matt Woodrow (:mattwoodrow) has approved the revision.",SOLUTION_VERIFICATION,0,FULL_TEXT
1494092,8,"Pushed by jwatt@jwatt.org:
https://hg.mozilla.org/integration/mozilla-inbound/rev/d2218beee052
Remove SVGFilterObserverList::IsInObserverLists and related code. r=mattwoodrow",UNCODED,0,UNMATCHED
1494092,9,https://hg.mozilla.org/mozilla-central/rev/d2218beee052,UNCODED,0,UNMATCHED
1494092,10,That's wrong. In fact it's the other way around - we should not be adding in aToReferenceFrame.,CLARIFICATION,0,FULL_TEXT
1506200,1,"The idea was to provide some distinguishing bits in case an embedding has many types of external stream. But really this is a waste of memory. It's currently unused, and in practice the underlyingSource pointer will be a pointer to some object that has a C++ vptr and can simply be asked for its type. Right?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1506200,2,Yes I agree with you. We can get rid of it.,PROBLEM_REVIEW,0,FULL_TEXT
1506200,3,"Created attachment 9025074
Bug 1506200 - Remove ReadableStream EmbeddingFlags. r?baku,jwalden",PROBLEM_DESCRIPTION,0,FULL_TEXT
1506200,4,"r?baku for the bits in dom/fetch, r?jwalden for the rest.",CODE_REVIEW_REQUEST,0,FULL_TEXT
1506200,5,https://treeherder.mozilla.org/#/jobs?repo=try&revision=35676e239e8f0056159208053ebce8cc41de7f78,UNCODED,0,UNMATCHED
1506200,6,"Pushed by jorendorff@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/b14418449896
Remove ReadableStream EmbeddingFlags. r=baku,jwalden",UNCODED,0,UNMATCHED
1506200,7,https://hg.mozilla.org/mozilla-central/rev/b14418449896,UNCODED,0,UNMATCHED
1509994,1,"This code does not exist in upstream webrtc.org, but based upon the headers in the files, it once did. Rather than restoring it each time we pull from upstream webrtc.org, we should move it elsewhere in tree.
It appears to be used by dom/media/systemservices/VideoEngine.cpp, so that seems like the logical place to put it.
We should also take the opportunity to see if we can switch to supported interfaces for accessing video / desktop capture rather than relying on code that has been undeleted from upstream.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1509994,2,"Created attachment 9027945
Bug 1509994 - Move video_engine from webrtc to systemservices; r=pehrsons!
Historically this code was part of webrtc.org but has since been removed
from upstream. Rather than maintaining it as a local diff against upstream,
we should just move it to where it is used.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1509994,3,"Created attachment 9027949
Bug 1509994 - Update gn generated json files; r=pehrsons!
Depends on D13092",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1509994,4,"Created attachment 9027950
Bug 1509994 - Update gn generated json files (part 2); r=pehrsons!
Depends on D13094",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1509994,5,"Created attachment 9027951
Bug 1509994 - Regenerate moz.build files; r=pehrsons!
Depends on D13095",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1509994,6,Phabricator choked on the size of the json update patch and I had to manually split it into two.,CODE_IMPLEMENTATION,1,FULL_TEXT
1509994,7,"Pushed by dminor@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/0fd399c6caab
Move video_engine from webrtc to systemservices; r=pehrsons
https://hg.mozilla.org/integration/autoland/rev/6cea864da2b6
Update gn generated json files; r=pehrsons
https://hg.mozilla.org/integration/autoland/rev/cab408925a76
Update gn generated json files (part 2); r=pehrsons
https://hg.mozilla.org/integration/autoland/rev/352048c07693
Regenerate moz.build files; r=pehrsons",UNCODED,0,UNMATCHED
1509994,8,"https://hg.mozilla.org/mozilla-central/rev/0fd399c6caab
https://hg.mozilla.org/mozilla-central/rev/6cea864da2b6
https://hg.mozilla.org/mozilla-central/rev/cab408925a76
https://hg.mozilla.org/mozilla-central/rev/352048c07693",UNCODED,0,UNMATCHED
1510786,1,"build of current trunk with default config fails with
...
 1:34.46 media/libdav1d
 1:34.46 /usr/bin/gcc -std=gnu99 -o cdf.o -c  -I/mnt/dan/firefox.git/obj-powerpc64le-unknown-linux-gnu/dist/system_wrappers -include /mnt/dan/firefox.git/config/gcc_hidden.h -DDEBUG=1 -DSTATIC_EXPORTABLE_JS_API -DMOZ_HAS_MOZGLUE -DMOZILLA_INTERNAL_API -DIMPL_LIBXUL -I/mnt/dan/firefox.git/media/libdav1d -I/mnt/dan/firefox.git/obj-powerpc64le-unknown-linux-gnu/media/libdav1d -I/mnt/dan/firefox.git/third_party/dav1d -I/mnt/dan/firefox.git/third_party/dav1d/include -I/mnt/dan/firefox.git/third_party/dav1d/include/dav1d -I/mnt/dan/firefox.git/third_party/dav1d/include/compat/gcc -I/mnt/dan/firefox.git/obj-powerpc64le-unknown-linux-gnu/dist/include -I/mnt/dan/firefox.git/obj-powerpc64le-unknown-linux-gnu/dist/include/nspr -I/mnt/dan/firefox.git/obj-powerpc64le-unknown-linux-gnu/dist/include/nss -fPIC -include /mnt/dan/firefox.git/obj-powerpc64le-unknown-linux-gnu/mozilla-config.h -DMOZILLA_CLIENT -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=2 -fno-strict-aliasing -fno-math-errno -pthread -pipe -g -Og -fno-omit-frame-pointer -funwind-tables -Wall -Wempty-body -Wignored-qualifiers -Wpointer-arith -Wsign-compare -Wtype-limits -Wunreachable-code -Wduplicated-cond -Wno-error=maybe-uninitialized -Wno-error=deprecated-declarations -Wno-error=array-bounds -Wno-error=free-nonheap-object -Wno-error=multistatement-macros -Wno-error=class-memaccess -Wformat -Wformat-overflow=2  -MD -MP -MF .deps/cdf.o.pp  -fdiagnostics-color  /mnt/dan/firefox.git/third_party/dav1d/src/cdf.c
 1:34.48 /mnt/dan/firefox.git/third_party/dav1d/src/cdf.c:28:10: fatal error: config.h: No such file or directory
 1:34.48  #include ""config.h""
 1:34.48           ^~~~~~~~~~
 1:34.48 compilation terminated.
I haven't looked yet if it's a build system issue or if dav1d upstream doesn't support non-x86/non-arm arches at all.",STACK_TRACE,0,FULL_TOKEN
1510786,2,"dav1d supports all platforms via C interface.  asm is x86 and arm only.
awilcox on gwyn [pts/5 Wed 28 17:59] build: meson 
The Meson build system
Version: 0.47.2
Source dir: /home/awilcox/Code/contrib/dav1d
Build dir: /home/awilcox/Code/contrib/dav1d/build
Build type: native build
Project name: dav1d
Project version: 0.0.1
Native C compiler: cc (gcc 6.4.0 ""cc (Adelie 6.4.0) 6.4.0"")
Build machine cpu family: ppc64
Build machine cpu: ppc64
Dependency threads found: YES
Check usable header ""stdatomic.h"": YES
Check usable header ""unistd.h"": YES
Checking for function ""getopt_long"" : YES
Checking for function ""posix_memalign"" : YES
Compiler for C supports arguments -fvisibility=hidden: YES
Compiler for C supports arguments -Wundef: YES
Compiler for C supports arguments -Werror=vla: YES
Compiler for C supports arguments -Wno-maybe-uninitialized -Wmaybe-uninitialized: YES
Compiler for C supports arguments -Wno-unused-parameter -Wunused-parameter: YES
Compiler for C supports arguments -Werror=missing-prototypes: YES
Compiler for C supports arguments -fomit-frame-pointer: YES
Compiler for C supports arguments -ffast-math: YES
Configuring config.h using configuration
Program doxygen found: NO
Build targets in project: 8
Found ninja-1.8.2 at /usr/bin/ninja
awilcox on gwyn [pts/5 Wed 28 17:59] build: ninja  
[63/63] Linking target tools/dav1d.
awilcox on gwyn [pts/5 Wed 28 17:59] build: ninja test
zsh: correct 'test' to 'tests' [nyae]? n
[1/2] Running all tests.
No tests defined.
awilcox on gwyn [pts/5 Wed 28 17:59] build:",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1510786,3,"What's missing is config files for non x86/x86-64/arm/arm64 systems.
https://hg.mozilla.org/mozilla-central/file/f2915d3ee5f8/media/libdav1d/moz.build#l15",QUESTION,0,FULL_TOKEN
1510786,4,"Can you please build dav1d alone, in those platforms, and provide the config.h file found in the build directory. Dav1d can be found in [1].
[1] https://code.videolan.org/videolan/dav1d",REPRODUCTION_REQUEST,0,FULL_TOKEN
1510786,5,"Created attachment 9028574
config.h
config.h - identical for ppc64, ppc64le and s390x arches, produced on Fedora",REQUIREMENT,0,FULL_TEXT
1510786,6,It feels like we could reasonably merge all those config.h files and use appropriate ifdefs.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1510786,7,"I mean, including the ones already in the tree.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1510786,8,"I would be happy to make something more elegant with those files. Can you please elaborate more with your idea.
My idea is to create the content of the file in a string variable, and then create the config file using the GENERATED_FILES[] (plus generation attributes).",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1510786,9,"Created attachment 9028604
dav1d-build-bug-ppc64-s390x
Could you please check if this patch fixes you builds?",VERIFICATION_REQUEST,0,FULL_TEXT
1510786,10,"there is a missing colon at the end of the ""elif"" line, but with that added it builds again and runs",SOLUTION_VERIFICATION,0,FULL_TEXT
1510786,11,Thank you Dan!,UNCODED,0,UNMATCHED
1510786,12,"Created attachment 9028626
Bug 1510786 - Add configuration header for ppc64 and s390x. r?glandium",UNCODED,0,UNMATCHED
1510786,13,https://treeherder.mozilla.org/#/jobs?repo=try&revision=dd127becb6b048d78f9e5c3927fd690998fcbf5f,UNCODED,0,UNMATCHED
1510786,14,For the record - I can build FF on ppc64/ppc64le/s390x with the last fix.,SOLUTION_VERIFICATION,0,FULL_TEXT
1510786,15,"Pushed by achronopoulos@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e6e6e269d09d
Add configuration header for ppc64 and s390x. r=TD-Linux",UNCODED,0,UNMATCHED
1510786,16,https://hg.mozilla.org/mozilla-central/rev/e6e6e269d09d,UNCODED,0,UNMATCHED
1514429,1,"window.inner{Width,Height} currently return the dimensions of the visual viewport. (Background of layout vs. visual viewport terminology: [1].)
This has been changed a couple of times aready (bug 602580, bug 919437), but I believe we'll need to change it again to align with Blink, which has settled on reporting the layout viewport dimensions [2].
Their justification for that choice is that we have the VisualViewport API [3] to report the visual viewport dimensions; I think that's reasonable.
We probably want to wait until shipping the Visual Viewport API (bug 1512813) before making this change.
[1] https://github.com/bokand/bokand.github.io/blob/master/web_viewports_explainer.md
[2] https://docs.google.com/spreadsheets/d/11DfDDa-s1hePVwBn3PZidlPJZ9ahhkJ44dyuMiOQtrc/edit#gid=0
[3] https://github.com/WICG/visual-viewport",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1514429,2,"I've been looking at this. The getters return visual viewport (nsIPresShell::GetVisualViewportSize) only when the visual viewport is overridden, and return the layout viewport (nsPresContext::GetVisibleArea) otherwise. Setters behave similarly. That means that most of the time we're using the layout viewport. Visual viewport override occurs when Responsive Design Mode is enabled.
I'd like to fix this right away because it is a blocker for Responsive Design Mode bugs like Bug 1504659. Given that RDM already has bugs regarding the visual viewport, is there a problem with making the change now to make innerWidth and innerHeight ALWAYS use the layout viewport?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1514429,3,"If nsIPresShell::IsVisualViewportSizeSet() returns false, the visual and layout viewports have the same size. So, it is the case that currently inner{Width,Height} always evaluates to the visual viewport size. The only reason we have a condition here [1] is that when nsIPresShell::IsVisualViewportSizeSet() returns false, no one has set nsIPresShell::mVisualViewportSize, so we'd be trying to use an empty size if we called nsIPresShell::GetVisualViewportSize() in that case.
If we make this change before shipping the Visual Viewport API, we would be depriving page authors of a way to obtain the visual viewport size.
If you give some more details about how this is causing a problem for RDM, I may be able to suggest an alternate solution.
[1] https://searchfox.org/mozilla-central/rev/76fe4bb385348d3f45bbebcf69ba8c7283dfcec7/dom/base/nsGlobalWindowOuter.cpp#3049",SOLUTION_REVIEW,1,FULL_TOKEN
1514429,4,"I had assumed that a meta viewport tag would change the layout viewport size without affecting the visual viewport, and without setting nsIPresShell::IsVisualViewportSizeSet(), leading to a mismatch. If that is not the case, and IsVisualViewportSizeSet() is equivalent to ""visual viewport may differ from layout viewport"", then I agree there is no problem here.
In Bug 1504659 I need the actual viewport width. The actual visible amount of the document. I see now that GetVisualViewportSize() returns both the viewable area and the area covered by any visible scrollbars. By subtracting away the area of the scrollbars, I should be able to get what I need. I'll needinfo you (on that bug) if I have trouble.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1514429,5,"Yep.
I believe the only scenario where we process a meta viewport tag but don't set a visual viewport size, is fixed by [this patch](https://phabricator.services.mozilla.com/D13173). So, with that patch in place, there should be no problem.
That surprises me. The visual viewport size is set [here](https://searchfox.org/mozilla-central/rev/76fe4bb385348d3f45bbebcf69ba8c7283dfcec7/layout/base/MobileViewportManager.cpp#369) based on `MobileViewportManager::GetCompositionSize()`, which subtracts the scrollbar dimensions [here](https://searchfox.org/mozilla-central/rev/76fe4bb385348d3f45bbebcf69ba8c7283dfcec7/layout/base/MobileViewportManager.cpp#357).",SOLUTION_REVIEW,1,90_PCT_MATCH
1514429,6,"Yes, you're right. I was working from memory of what I believed to be the root cause when I started working on the bug. I just pared back my patches to the minimal fix (which you've already reviewed, thank you) plus test and things look good locally. I'm doing a try server run to see if it's landable. I honestly don't know what changed between my initial landing attempt and now, but it looks like it might go through.",CLARIFICATION,0,FULL_TEXT
1514429,7,"You might not need them but I thought these links could be useful.
https://github.com/andreasbovens/understanding-viewport
http://andreasbovens.github.com/understanding-viewport/",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1514429,8,"That is a neat set of test pages, thanks!",CLARIFICATION,0,FULL_TEXT
1514429,9,"Created attachment 9087177
Bug 1514429 Part 1: Make window inner size getters and setters exclusively use the CSS viewport.",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1514429,10,https://treeherder.mozilla.org/#/jobs?repo=try&revision=6b308be86a5b8647a54c1430f50aed2408b84cc0,UNCODED,0,UNMATCHED
1514429,11,"Brad, what's the status on this bug?  I did take a look at failures in the try in comment 9.  The failure on 
test_viewport_metrics_on_landscape_content.html is a case that bug 1508177 didn't handle properly.  I am fine with replacing `is` in question with `todo` and filing a new bug for that.  As for the failure on test_innersize_scrollport.html, I believe it's no longer valid, we can drop it entirely.  As for browser_viewport_resizing_after_reload.js, I have no idea what's going on there since I can't run it locally due to bug 1595936, but you are more familiar with the code than I am, so you've already known what we should do?",CODE_REVIEW,0,FULL_TOKEN
1514429,12,*** Bug 1454652 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1514429,13,I'm rebasing my old patch and will provide a new test run shortly to see what needs to be fixed in code and in tests.,STATUS_UPDATE,0,FULL_TEXT
1514429,14,https://treeherder.mozilla.org/#/jobs?repo=try&revision=2bfb9f5cb6564add68e787d1b33e8decde57e448,UNCODED,0,UNMATCHED
1514429,15,"I can't figure out the fix for this. The test conflates layout and visual viewports starting at `const layoutViewportHeight = window.visualViewport.height;` and though I could make the test pass, I don't know how the various comparisons it makes (scrollRect, document.clientBoundingRect) should be handled. I'll add a part to the patch that disables this test.",SOLUTION_REVIEW,1,FULL_TOKEN
1514429,16,"The failure happens on [this line](https://searchfox.org/mozilla-central/rev/652014ca1183c56bc5f04daf01af180d4e50a91c/dom/base/test/file_viewport_metrics_on_landscape_content.html#44), we can just replace `is` with `todo_is` for now.
The content in the test case has `minimum-scale=0.5` and a `width: 200%` element, but the root element height is `height: 100%`, so the content is shrunk to fit the 200% width to the screen, but nsPresContext.mVisibleArea (i.e. height:100%)is unchanged, so once we return the nsPresContext.mVisibleArea for window.innnerHeight, it's no longer correct, it should be size of the expanded size by the minimum-scale.  And of course Chrome does returns the expanded size for window.innerHeight. 
Brad, would you mind filing a bug for this issue and leave a comment in the `todo_is`?
Oops, a collision happened.  I'd prefer to use todo_is instead of disabling whole test.",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1514429,17,"I think this is a foundational issue that makes several of the comparisons fail.
That line doesn't fail and two others do. I'll make a version of the patch that changes the necessary lines to todo_is and notes the new Bug 1598487 as tracking the fix.",STATUS_UPDATE,0,FULL_TEXT
1514429,18,"The fix for this test is a combination of fixing expectations in the test itself (easy) and fixing the RDM `waitForViewportResizeTo` function, which is not as easy for me. For that function ""viewport"" really means ""device size"". It looks like the internal state of the viewport React component is affected by scaling and is neither the visual viewport nor the layout viewport. I'll sort that out and then we should have a landable patch.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1514429,19,"Created attachment 9110940
Bug 1514429 Part 2: Update a test that assumes innerWidth should change while zooming.
This test treats innerWidth as being related to the visual viewport,
which is no longer is. The test has no purpose now.
Depends on D42940",CODE_IMPLEMENTATION,1,FULL_TOKEN
1514429,20,"Created attachment 9110941
Bug 1514429 Part 3: Disable parts of a test of visual vs layout viewport, and mark it for needing a correctness audit.
This test attempts to relate the visual viewport, layout viewport, the
document scroll rect and the document bounding client rect. Some of the
logic here is no longer correct and needs revision. It's also possible
that there is a bug revealed in the visualviewport API code. I can't
find a simple, logical solution so I opened Bug 1598487 for the fix.
Depends on D54350",CODE_IMPLEMENTATION,1,90_PCT_MATCH
1514429,21,"Created attachment 9110942
Bug 1514429 Part 4: Update tests and test functions that conflated visual viewport and layout viewport.
Responsive Design Mode sends internal messages for the content size and
viewport size. The viewport size used to be reflective of the visual
viewport. These changes make it use the layout viewport instead.
The viewport is also being used as a stand-in for RDM device size. That
needs more investigation since content size and viewport size should be
conceptually distinct. This need for clarity is less urgent because the
RDM feature is being rebuilt for Fission support, tracked by
Bug 1574885. If this issue becomes problematic before Bug 1574885 is
landed, then we'll need to open a new bug to resolve it.
Depends on D54351",CODE_IMPLEMENTATION,1,FULL_TOKEN
1514429,22,https://treeherder.mozilla.org/#/jobs?repo=try&revision=03ca132f33366d06cd693d3a9afb548ad8e0f849,UNCODED,0,UNMATCHED
1514429,23,https://treeherder.mozilla.org/#/jobs?repo=try&revision=6ee6a4bd5c5ccf9c955af571bf2561184d213dd4,UNCODED,0,UNMATCHED
1514429,24,"Pushed by bwerth@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/1e91e19089dd
Part 1: Make window inner size getters and setters exclusively use the CSS viewport. r=botond
https://hg.mozilla.org/integration/autoland/rev/9ba5efadaff0
Part 2: Update a test that assumes innerWidth should change while zooming. r=botond
https://hg.mozilla.org/integration/autoland/rev/33d9590eca92
Part 3: Disable parts of a test of visual vs layout viewport, and mark it for needing a correctness audit. r=hiro
https://hg.mozilla.org/integration/autoland/rev/bcdb4a6fbaf0
Part 4: Update tests and test functions that conflated visual viewport and layout viewport. r=mtigley",UNCODED,0,UNMATCHED
1514429,25,"https://hg.mozilla.org/mozilla-central/rev/1e91e19089dd
https://hg.mozilla.org/mozilla-central/rev/9ba5efadaff0
https://hg.mozilla.org/mozilla-central/rev/33d9590eca92
https://hg.mozilla.org/mozilla-central/rev/bcdb4a6fbaf0",UNCODED,0,UNMATCHED
1514429,26,"Documentation updated:
* Updated the pages about the Window properties [innerWidth](https://wiki.developer.mozilla.org/en-US/docs/Web/API/Window/innerWidth) and [innerHeight](https://wiki.developer.mozilla.org/en-US/docs/Web/API/Window/innerHeight)
* [Firefox 73 for developers](https://wiki.developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/73#APIs) now mentions this change",STATUS_UPDATE,0,90_PCT_MATCH
1514429,27,*** Bug 1615831 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1515665,1,"This is similar to bug 1510860 in nature.  When we grant a content blocking exception to a page, the localStorage API doesn't start to work on that page...
The reason is that this check <https://searchfox.org/mozilla-central/rev/2e5e28f518524f8af5b158ddb605022b6a2d68cf/dom/storage/Storage.cpp#46> is done using the principal object.  Internally this maps to <https://searchfox.org/mozilla-central/rev/232ced2697b8938073fa79b8e6aa3718876c0b69/toolkit/components/antitracking/AntiTrackingCommon.cpp#1225> in the antitracking back-end which is oblivious to the content blocking allow list because it can't walk up the window hierarchy.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1515665,2,"Created attachment 9032718
Bug 1515665 - Ensure that DOM Storage checks the content blocking allow list when performing storage access checks;",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1515665,3,"Pushed by eakhgari@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/338f4fbbfddf
Ensure that DOM Storage checks the content blocking allow list when performing storage access checks; r=baku",UNCODED,0,UNMATCHED
1515665,4,"Backed out changeset 338f4fbbfddf (Bug 1515665) for bc failures browser/components/sessionstore/test/browser_339445.js CLOSED TREE
Push with multiple failures, storage issue: https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=superseded%2Ctestfailed%2Cbusted%2Cexception%2Cusercancel%2Crunnable&revision=3a328e80b02cf3c11a36e060380277396e211cd9&selectedJob=218353178
Failure log:
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=218353178&repo=autoland&lineNumber=3240
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=218355469&repo=autoland&lineNumber=10989
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=218355472&repo=autoland&lineNumber=2054
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=218351107&repo=autoland&lineNumber=26378
Backout push: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=218351107&repo=autoland&lineNumber=26378",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1515665,5,"Backout by ebalazs@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/540b4829fd57
Backed out changeset 338f4fbbfddf for bc failures browser/components/sessionstore/test/browser_339445.js CLOSED TREE",UNCODED,0,UNMATCHED
1515665,6,"I'm still working on this...
SessionStorage has been badly busted, possibly for years.  :-(
Did people realize that mIsSessionOnly <https://searchfox.org/mozilla-central/rev/64ef7bc9fb478ba7c292f9fa57813d3fe864201e/dom/storage/Storage.cpp#53> is *never* set to true?",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1515665,7,"Created attachment 9033210
Bug 1515665 - Ensure that we perform localStorage access checks with a window always, and the sessionStorage access checks with a principal always;",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1515665,8,"[Tracking Requested - why for this release]:
Actually given how drastic the fix has turned out to be, I no longer think this is something that we want to land on 65, the risk of backporting the fix would be way too high and we don't really have any user reported bugs that we need to backport this for.  I was hoping to get this landed on 65 for completeness but I don't think it's the end of the world if it misses that train...",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1515665,9,"We're already past early beta, so I'm perfectly fine with letting this ride with 66 if the patch is riskier than you're comfortable with.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1515665,10,"Andrea, what is the meaning of mIsSessionOnly exactly?  This test (which fails with my patch, as you would expect) makes me believe that mIsSessionOnly means we have a session-only permission, not that the Storage object is a session storage object: https://searchfox.org/mozilla-central/source/dom/tests/mochitest/sessionstorage/test_cookieSession.html
I'm super confused by all of this code now...",CODE_REVIEW,0,FULL_TOKEN
1515665,11,"mIsSessionOnly is set to true when 'cookie' permission is set to session-only. test_cookieSession.html check exactly this. right? LocalStorage and SessionStorage can both have mIsSessionOnly set to true.
 
If you want to check the 'nature' of the storage, you should use |StorageType Storage::Type() const|:
https://searchfox.org/mozilla-central/rev/0ee0b63732d35d16ba22d5a1120622e2e8d58c29/dom/storage/Storage.h#39",ANSWER_TO_QUESTION,0,FULL_TOKEN
1515665,12,I'll work on this.,STATUS_UPDATE,0,FULL_TEXT
1515665,13,"I think you should be able to use parts of my patch still, but all of the argument passing through the constructors etc should be changed to ultimately set mIsSessionOnly instead of what it currently does.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1515665,14,"Created attachment 9036316
part 1 - partitioned storage renamed",UNCODED,0,UNMATCHED
1515665,15,"Created attachment 9036317
part 2 - partitioned sessionStorage
Here is the scenario I want to fix (I can move this in a separate bug if you think it's better):
1. top-level page is example.com with 2 iframes: tracker.com/inDisconnectedList and tracker.com/notInDisconnectedList
2. the 2 iframes share the same sessionStorage, but they should not.
I want to use the same storage class used for localStorage, also for sessionStorage.",CODE_IMPLEMENTATION,1,90_PCT_MATCH
1515665,16,"Created attachment 9036318
part 3 - reject_cookie policy",UNCODED,0,UNMATCHED
1515665,17,"Created attachment 9036319
part 4 - tests",UNCODED,0,UNMATCHED
1515665,18,Part 2 here needs our documentation to be updated.,REQUIREMENT,0,FULL_TEXT
1515665,19,"Comment on attachment 9036318
part 3 - reject_cookie policy
Review of attachment 9036318:
-----------------------------------------------------------------
::: dom/storage/LocalStorage.cpp
@@ +63,5 @@
Better wrap the entire block in #ifdef DEBUG.
::: dom/storage/SessionStorage.cpp
@@ +43,5 @@
Ditto.",CODE_REVIEW,0,FULL_TEXT
1515665,20,"Created attachment 9037251
part 1 - ePartitionedOrDeny for trackers
This is what we want:
1. when storage access is denied by permissions or cookie-policy, SessionStorage must throw security errors.
2. for normal pages and trackers, sessionStorage must work as usual.
In order to achieve this configuration, I need to return ePartitionedOrDeny only when rejectedReason is 'TRACKERS'.",CODE_IMPLEMENTATION,1,90_PCT_MATCH
1515665,21,"Created attachment 9037254
part 2 - SessionStorage and ePartitionedOrDeny",UNCODED,0,UNMATCHED
1515665,22,"Created attachment 9037255
part 3 - tests",UNCODED,0,UNMATCHED
1515665,23,"Comment on attachment 9037255
part 3 - tests
Not green enough on try.",SOLUTION_VERIFICATION,0,FULL_TEXT
1515665,24,"Created attachment 9037674
part 1 - exposed PartitionedOrDeny differently
Finally, a green result. This patch exposed rejectedReason in StorageAllowedForNewWindow. This will be mainly used in the next patches.
It also moves the privacy.restrict3rdpartystorage.partitionedHosts check in the localStorage code.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1515665,25,"Created attachment 9037675
part 2 - SessionStorage
sessionstorage works when rejectedReason is STATE_COOKIES_BLOCKED_FOREIGN and when StorageAccess is ePartitionedOrDeny",CODE_IMPLEMENTATION,1,FULL_TEXT
1515665,26,"Created attachment 9037676
part 3 - no window in SessionStorage.jsm
No window when restoring a window.",CODE_IMPLEMENTATION,1,FULL_TEXT
1515665,27,"Created attachment 9037677
part 4 - tests",UNCODED,0,UNMATCHED
1515665,28,"Comment on attachment 9037674
part 1 - exposed PartitionedOrDeny differently
Review of attachment 9037674:
-----------------------------------------------------------------
::: dom/base/nsContentUtils.cpp
@@ +8102,5 @@
No, you shouldn't make up non-existing errors out of thin air.  When you aren't sure why you're rejecting, you're supposed to set rejected reason to 0.
@@ +8330,5 @@
Why not make aRejectedReason a reference here so that you can remove this assertion and the weird dereferences below?
@@ +8363,2 @@
Ditto.
@@ +8367,5 @@
Again, minting synthetic rejection reasons isn't allowed.
@@ +8375,5 @@
Here too.
@@ +8449,5 @@
This change will break the privacy.restrict3rdpartystorage.partitionedHosts pref for non-trackers...  I suppose that is fine, but at the very least you need to document this change in semantics here: https://searchfox.org/mozilla-central/rev/dac799c9f4e9f5f05c1071cba94f2522aa31f7eb/modules/libpref/init/all.js#1403",CODE_REVIEW,0,FULL_TOKEN
1515665,29,"Created attachment 9038177
part 1 - exposed PartitionedOrDeny differently",UNCODED,0,UNMATCHED
1515665,30,*** Bug 1519111 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1515665,31,"Pushed by amarchesini@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/700bc7185e64
StorageAccess::ePartitionedOrDeny must be used only for trackers, rehsan
https://hg.mozilla.org/integration/mozilla-inbound/rev/188f4b17a553
SessionStorage should be allowed when StorageAccess is ePartitionedOrDeny, r=ehsan
https://hg.mozilla.org/integration/mozilla-inbound/rev/c6b3ea360251
no window passwed when creating SessionStorage in SessionStorage.jsm, r=ehsan
https://hg.mozilla.org/integration/mozilla-inbound/rev/6a1c4140f479
Tests for SessionStorage and cookie-behavior REJECTED, r=ehsan",UNCODED,0,UNMATCHED
1515665,32,Docs updated https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Privacy/Storage_access_policy$compare?from=1438241&to=1454297,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1515665,33,"https://hg.mozilla.org/mozilla-central/rev/700bc7185e64
https://hg.mozilla.org/mozilla-central/rev/188f4b17a553
https://hg.mozilla.org/mozilla-central/rev/c6b3ea360251
https://hg.mozilla.org/mozilla-central/rev/6a1c4140f479",UNCODED,0,UNMATCHED
1521066,1,"See http://elektronotdienst-nuernberg.de/Stoerung/Fuerth-Zdf-Stein-Wdst-Feucht-SC-RH/
There is a table with a solid black border around. 
That should be a double border and was for ages until recently.
I think this bug is new in Fx 64, also in Nightly 66
Markup is like this:
     <style> table { border:double } </style>
     <table rules=rows>
Works in Fx 63 (I think), Chrome, IE, etc.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1521066,2,"Created attachment 9037537
testcase",UNCODED,0,UNMATCHED
1521066,3,"https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=a7f1d2b04291a97a44fc08160b33cf3b0488127c&tochange=178218e7b57ca24ceb7f6aca3674611012fa6b2c
Looks like I broke this, sorry! Thanks a lot for the report, feels weird that nobody noticed until now... Will take a look.",STATUS_UPDATE,0,FULL_TOKEN
1521066,4,"Created attachment 9037565
Bug 1521066 - Fix double border rendering of border-collapsed tables. r=jrmuizel
Gotta love C++... I missed the `break;` for that branch so we were always
falling back to the solid border rendering path (which we use if the border is
too small).",CODE_IMPLEMENTATION,1,FULL_TOKEN
1521066,5,"Comment on attachment 9037565
Bug 1521066 - Fix double border rendering of border-collapsed tables. r=jrmuizel
[Beta/Release Uplift Approval Request]
Feature/Bug causing the regression: Bug 1487407
User impact if declined: Some tables may render solid borders instead of double.
Is this code covered by automated tests?: Yes
Has the fix been verified in Nightly?: No
Needs manual test from QE?: No
If yes, steps to reproduce: 
List of other uplifts needed: None
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): Just adds back a `break;` statement which prevents us to fall back to the solid border path we use when the border is too small.
String changes made/needed:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1521066,6,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/6c6fecd53382
Fix double border rendering of border-collapsed tables. r=jrmuizel",UNCODED,0,UNMATCHED
1521066,7,https://hg.mozilla.org/mozilla-central/rev/6c6fecd53382,UNCODED,0,UNMATCHED
1521066,8,"Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0
Confirming that testcase and URL are fixed with today's Nightly.
Thanks!",SOLUTION_VERIFICATION,0,FULL_TOKEN
1521066,9,*** Bug 1515101 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1521066,10,Created web-platform-tests PR https://github.com/web-platform-tests/wpt/pull/14963 for changes under testing/web-platform/tests,UNCODED,0,UNMATCHED
1521066,11,"Comment on attachment 9037565
Bug 1521066 - Fix double border rendering of border-collapsed tables. r=jrmuizel
[Triage Comment]
Extremely simple fix with tests for a table border rendering regression. Approved for 65.0rc1.",UPLIFT_APPROVAL,0,FULL_TOKEN
1521066,12,https://hg.mozilla.org/releases/mozilla-beta/rev/a95de9874038,UNCODED,0,UNMATCHED
1529006,1,"I split this from bug 1319468, see 
https://bugzilla.mozilla.org/show_bug.cgi?id=1319468#c5
https://mozilla.logbot.info/jsapi/20190205#c15925279
But I have some questions
1. Do we need the if clause check below?
`if (!mozilla::IsPointer<T>::value || thing)`
https://searchfox.org/mozilla-central/rev/05d4b6962a571585bd679d2bbb0df0a5fb4e4eff/js/public/GCVariant.h#50
https://searchfox.org/mozilla-central/rev/05d4b6962a571585bd679d2bbb0df0a5fb4e4eff/js/public/GCVariant.h#79
the `if (thing)` check is initially for pointer types
and the pointer check is done again in https://searchfox.org/mozilla-central/rev/05d4b6962a571585bd679d2bbb0df0a5fb4e4eff/js/src/gc/Policy.h#47
and `!mozilla::IsPointer<T>::value` is also confusing to me. 
Do we really need this?
2. Do we still need to call TraceRoot 
https://searchfox.org/mozilla-central/rev/05d4b6962a571585bd679d2bbb0df0a5fb4e4eff/js/src/vm/Realm.h#196
I think Rooted<> will call the trace function through DispatchWrapper, however the name argument is different, I am not sure if this matters.",QUESTION,0,90_PCT_MATCH
1529006,2,"Created attachment 9045942
Patch.
Hi Steve
Base on your suggestion I work out this patch, I use IgnoreGCPolicy to prevent calling 'trace' on the objects(ImmediateMetadata and DelayMetadata), can you help to check is this correct?
Thanks",CODE_IMPLEMENTATION,1,FULL_TEXT
1529006,3,"Comment on attachment 9045942
Patch.
Review of attachment 9045942:
-----------------------------------------------------------------
Oh, I hadn't thought of that approach. I was thinking of allowing Rooted<Variant<...>> to contain untraceable types. But come to think of it, your approach seems good -- it keeps the exception localized to types involved.
So I'm going to mark this feedback+ from me because I think it's a good approach, but I want to check with jonco for which one he thinks is better. I'll attach a sample patch with the approach I was originally thinking of.",CODE_REVIEW,0,FULL_TOKEN
1529006,4,"Created attachment 9046029
allowing untraceable variant types",UNCODED,0,UNMATCHED
1529006,5,"Comment on attachment 9045942
Patch.
Review of attachment 9045942:
-----------------------------------------------------------------
I like this approach, it's simple and it's obvious what's happening.  Steve's approach is more general though.
I guess we'll see how often we need this - if it turns out to be a lot we can shift to the other approach, but for now I'd say let's go with this.
::: js/src/vm/Realm.h
@@ +330,5 @@
We generally trace roots such as these manually rather than using PersistentRooted everywhere.  Can you keep this as is and call GCPolicy<NewObjectMetadataState>::trace in Realm::traceRoots()?",CODE_REVIEW,0,FULL_TOKEN
1529006,6,"Created attachment 9047168
Patch v2
addressed Jonco's comments",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1529006,7,"Comment on attachment 9047168
Patch v2
Review of attachment 9047168:
-----------------------------------------------------------------
Great!  r=me with the changes below.
::: js/src/vm/Realm.h
@@ +183,5 @@
We should be able to remove the inheritance from CustomAutoRooter now, and the empty trace() method below.",CODE_REVIEW,0,FULL_TOKEN
1529006,8,"Created attachment 9047376
Patch v3
removed inherit from CustomAutoRooter",CODE_IMPLEMENTATION,1,FULL_TEXT
1529006,9,"Pushed by allstars.chh@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/584d1d57db0b
Use Rooted for NewObjectMetadataState. r=jonco",PROBLEM_DESCRIPTION,0,FULL_TEXT
1529006,10,https://hg.mozilla.org/mozilla-central/rev/584d1d57db0b,UNCODED,0,UNMATCHED
1537936,1,"We're surprisingly close to getting this to happen.
I'll split the patch into three parts:
1) Misc. cleanup (some NameNode changes, tiny change to True/False/Undefined/NullExpr, etc.)
2) Function call cleanup.
3) Deleting pn_op and refactoring all the ParseNode constructors/FullParseHandler/etc. to not provide opcodes.
Point 2 is a little weird, because I'll be adding a CallNode that contains a JSOp field. This is because there are a *lot* of different types of calls, and those are currently encoded into JSOp (for example, CALL, SPREADCALL, NEW, SPREADNEW, SUPERCALL, SPREADSUPERCALL, the list goes on and on). I *could* make a new enum that corresponds basically 1-to-1 with the JSOp items, and make a mapping function, but... really, what's the point at that point.",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1537936,2,"Created attachment 9052674
Bug 1537936 part 1 - Remove miscellaneous uses of pn_op.",UNCODED,0,UNMATCHED
1537936,3,"Created attachment 9052675
Bug 1537936 part 2 - Move pn_op for calls to CallNode::callOp.
Depends on D24409",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1537936,4,"Created attachment 9052676
Bug 1537936 part 3 - Remove ParseNode::pn_op.
Depends on D24410",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1537936,5,"Backed out for bustages in ParseNode.h
Push with failure: https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception%2Crunnable&revision=8c405aa4467dfeb34b9df7e875c1584ed6f6a938
Failure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=235272394&repo=autoland&lineNumber=5157
Backout: https://hg.mozilla.org/integration/autoland/rev/c99b0f4470527c183d90c1e7191a08e4933ad1ac",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1537936,6,"Pushed by ahauck@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/647eb65d3451
part 1 - Remove miscellaneous uses of pn_op. r=jorendorff
https://hg.mozilla.org/integration/autoland/rev/37d0dcbdffd5
part 2 - Move pn_op for calls to CallNode::callOp. r=jorendorff",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1537936,7,"Pushed by ahauck@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/2bf248bc4f3b
part 1 - Remove miscellaneous uses of pn_op. r=jorendorff
https://hg.mozilla.org/integration/autoland/rev/4011496a13a9
part 2 - Move pn_op for calls to CallNode::callOp. r=jorendorff
https://hg.mozilla.org/integration/autoland/rev/d9660cff2091
part 3 - Remove ParseNode::pn_op. r=jorendorff",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1537936,8,"https://hg.mozilla.org/mozilla-central/rev/2bf248bc4f3b
https://hg.mozilla.org/mozilla-central/rev/4011496a13a9
https://hg.mozilla.org/mozilla-central/rev/d9660cff2091",UNCODED,0,UNMATCHED
1560574,1,[Tor 30800](https://trac.torproject.org/projects/tor/ticket/30800) reports that there's a potential fingerprinting issue on non-Windows platform.,PROBLEM_MOTIVATION,0,90_PCT_MATCH
1560574,2,"Created attachment 9075174
Bug 1560574 - use FormatPRExplodedTime to display GMT;",UNCODED,0,UNMATCHED
1560574,3,I tested the patch and it works for me. Do we actually know why only Windows is affected?,QUESTION,0,FULL_TEXT
1560574,4,"Timezone info isn't specified [here](https://searchfox.org/mozilla-central/rev/11712bd3ce7454923e5931fa92eaf9c01ef35a0a/netwerk/streamconv/converters/nsFTPDirListingConv.cpp#297), so that the parsing [here](https://searchfox.org/mozilla-central/rev/11712bd3ce7454923e5931fa92eaf9c01ef35a0a/netwerk/streamconv/converters/nsDirIndexParser.cpp#267) might have different result, where `PRTime` should always use GMT and be timezone-free.
I've updated the patch, and I think it makes more sense even on other platforms.",PROBLEM_CAUSE_IDENTIFICATION,0,90_PCT_MATCH
1560574,5,"FWIW, I tested by visiting ftp://ftp.freebsd.org/ and I found switching `privacy.resistFingerprinting` on/off doesn't affect timezone displayed here until restart Firefox. But in this bug I'm trying to make the content in [view-source:ftp://ftp.freebsd.org/](view-source:ftp://ftp.freebsd.org/) stable on all platforms.",SOLUTION_REVIEW,1,90_PCT_MATCH
1560574,6,Gary: FYI: see bug 1491343# **comment8** re RFP flipping & TZ spoofing - maybe this needs it's own bug (and tracked/linked in bug 1414162),NEW_ISSUE_FILING,0,FULL_TOKEN
1560574,7,"Update on current status:
After applying this patch, macOS will always display GMT time regardless `privacy.resistfingerprinting` is enabled or disabled, I haven't tested on Linux.
I suspect what mentioned by Simon is the root cause that my current patch doesn't work properly on mac, I didn't notice this because I was debugging with e10s disabled, that makes everything works well, including dynamically switching `privacy.resistfingerprinting` and reloading the ftp site.",SOLUTION_REVIEW,1,FULL_TOKEN
1560574,8,"It turns out that `PR_LocalTimeParameters` returns different value in the content process on macOS, and is caused by sandbox.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1560574,9,IMHO: directory-listing pages are browser-generated content. Such kind of content (except about:blank) should be just forbidden to scripts and css to access.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1560574,10,"Pushed by xeonchen@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/c4beb9353658
use FormatPRExplodedTime to display GMT; r=kershaw",UNCODED,0,UNMATCHED
1560574,11,https://hg.mozilla.org/mozilla-central/rev/c4beb9353658,UNCODED,0,UNMATCHED
1569123,2,After Bug 1569122 'Limit Worker/SharedWorker MIME type blocking to Beta/Nightly' we should keep this bug to re-enable strict mime type checking at some point.,PROBLEM_MOTIVATION,0,FULL_TEXT
1569123,3,We want to coordinate re-enabling for Release/Beta with Chrome and get the MIME type restrictions for Workers into the specification: https://github.com/whatwg/html/issues/3255.,PROBLEM_DESCRIPTION,0,FULL_TEXT
1569123,4,I think we should just do this. We had this on early-beta and nightly for half a year now. Maybe at some point the Chrome people will respond.,PROBLEM_REVIEW,0,FULL_TEXT
1569123,5,"Created attachment 9127056
Bug 1569123 - Re-enable strict MIME type checking for Worker/SharedWorker everywhere. r?ckerschb",PROBLEM_DESCRIPTION,0,FULL_TEXT
1569123,6,"Pushed by evilpies@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/72e14ab482cf
Re-enable strict MIME type checking for Worker/SharedWorker everywhere. r=ckerschb",UNCODED,0,UNMATCHED
1569123,7,Posted [site compatibility note](https://www.fxsitecompat.dev/en-CA/docs/2020/worker-scripts-with-wrong-mime-type-will-be-blocked-from-loading-with-worker-or-sharedworker/) for web developers.,ADDITIONAL_CONSIDERATION,0,90_PCT_MATCH
1569123,8,https://hg.mozilla.org/mozilla-central/rev/72e14ab482cf,UNCODED,0,UNMATCHED
1569123,9,Updated the [site compatibility note](https://www.fxsitecompat.dev/en-CA/docs/2020/worker-scripts-with-wrong-mime-type-will-be-blocked-from-loading-with-worker-or-sharedworker/).,ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1569123,10,"Bug 1623916 reverted this change again, so we need to re-enable the Worker MIME type blocking at some point in the future.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1569123,11,"It seems like some of the other changes are going to ship in 80, should we try this again?
[Telemetry](https://mzl.la/31Edh93) still looks very good `worker_load	2.22k (0%)`.",STATUS_UPDATE,0,90_PCT_MATCH
1569123,12,"I would like that, yes, but let's check with other folks to make sure we are all on the same page.
Steven, given the discussion around Bug 1623916 a few weeks back on slack. Are you fine with us re-enabling or should we hold back?",QUESTION,0,FULL_TEXT
1569123,13,I fine with re-enabling now.  Overholt do you have any issues with this (you were also part of the conversation).,ANSWER_TO_QUESTION,0,FULL_TOKEN
1569123,14,I've asked Mike to help make the decision here.,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1569123,15,"If we have been warning devs of this change via a console warning for at least three releases, let's go ahead and land this change.
If not, please file a blocking bug to land a console warning and then we can land this change after three additional releases.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1569123,16,We have had a general warning for wrong script MIME types since the beginning of 2019 (bug 1510223) on all channels. We have actively been blocking Worker loads with wrong MIME type on early-beta and nightly since about a year (bug 1569122).,CLARIFICATION,0,FULL_TEXT
1569123,17,"Created attachment 9166536
Bug 1569123 - Re-enable strict MIME type checking for Worker/SharedWorker everywhere. r?ckerschb",UNCODED,0,UNMATCHED
1569123,18,"Pushed by evilpies@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/0dd7e71184a6
Re-enable strict MIME type checking for Worker/SharedWorker everywhere. r=ckerschb",UNCODED,0,UNMATCHED
1569123,19,https://hg.mozilla.org/mozilla-central/rev/0dd7e71184a6,UNCODED,0,UNMATCHED
1569123,20,"I'm updating the MDN docs for this - [release note here](https://wiki.developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/81#WorkersService_workers).
The only thing I think might be incorrect in the docs is the note on Worker/SharedWorker: 
I THINK the change is that this should include application/javascript as an option, and also note that this is only enforced from FireFox 81. Is that correct?",QUESTION,0,FULL_TEXT
1569123,21,"PS. The extended discussion seemed to indicate that this would be done in sync with Chrome browser - did that happen, and if so do you happen to know if it would affect other ""Chromiums"" - Opera, Edge etc? This is for the browser compat data.",QUESTION,0,FULL_TEXT
1569123,22,"PPS Will this affect Firefox for Android? There doesn't seem to be any reason why not, other than the original browser compat data says it was not, and this change does not indicate either way - ie see https://wiki.developer.mozilla.org/en-US/docs/Web/API/Worker/Worker#Browser_compatibility",QUESTION,0,FULL_TEXT
1569123,23,"While `application/javascript` (and other specified JS MIME types) will work, the HTML standard says that only `text/javascript` should be used: https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#JavaScript_types https://html.spec.whatwg.org/multipage/scripting.html#scriptingLanguages
I think Chrome/Blink implemented this change, considering that they seem to to pass this test: https://wpt.fyi/results/workers/Worker_script_mimetype.htm. They however still fail the test in Chrome 85 for me, so maybe they haven't made this change in stable yet. I don't know
It should, there is nothing Desktop specific about this change.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1570673,1,"Discovered from https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!msg/discuss-webrtc/Gqo2MfnQWkw/sOZlb2EqDgAJ
There is a pernosco recording at https://pernos.co/debug/dxLVskE-28Jb11gvrw4iSA/index.html
The black frame reaches MediaPipeline but is dropped at https://searchfox.org/mozilla-central/rev/b38e3beb658b80e1ed03e0fdf64d225bd4a40327/media/webrtc/signaling/src/mediapipeline/MediaPipeline.cpp#1128.
We might want to propagate the active state into the VideoFrameConverter.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1570673,2,"There's a second bug here where frames from SameFrameTimer don't get sent due to bug 1522238. Frames broadcast by the timer have the same timestamp as the last frame and get dropped upstream.
This didn't seem to impact my manual test of the original STR, but it impacts the mochitest I wrote.",PROBLEM_REVIEW,0,FULL_TOKEN
1570673,3,"Created attachment 9082951
Bug 1570673 - Add mochitest. r?bwc",UNCODED,0,UNMATCHED
1570673,4,"Created attachment 9082952
Bug 1570673 - Add an active state to VideoFrameConverter and propagate it from MediaPipeline. r?bwc
Depends on D40597",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1570673,5,"Created attachment 9082953
Bug 1570673 - Update last frame's time on same-frame-ticks. r?bwc
Depends on D40598",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1570673,6,"Pushed by pehrsons@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/d2a030d452cb
Add mochitest. r=bwc
https://hg.mozilla.org/integration/autoland/rev/91d822ac2647
Add an active state to VideoFrameConverter and propagate it from MediaPipeline. r=bwc
https://hg.mozilla.org/integration/autoland/rev/acd8b80087e0
Update last frame's time on same-frame-ticks. r=bwc",UNCODED,0,UNMATCHED
1570673,7,"https://hg.mozilla.org/mozilla-central/rev/d2a030d452cb
https://hg.mozilla.org/mozilla-central/rev/91d822ac2647
https://hg.mozilla.org/mozilla-central/rev/acd8b80087e0",UNCODED,0,UNMATCHED
1570673,8,"Comment on attachment 9082952
Bug 1570673 - Add an active state to VideoFrameConverter and propagate it from MediaPipeline. r?bwc
### Beta/Release Uplift Approval Request
* **User impact if declined**: Chrome and safari (possibly also Edge) will not be able to receive audio from Firefox in video calls in some cases
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: Join a room on https://appr.tc with Firefox
Mute the camera in Firefox
Join the same room (same URL) with Chrome or Safari
Mute the microphone in Chrome or Safari
Expected: you can hear yourself
With bug: you can only hear yourself after unmuting the camera in Firefox
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Well covered with unittests and mochitests
* **String changes made/needed**: 
### ESR Uplift Approval Request
* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: 68 regression that got public attention: https://groups.google.com/d/msg/discuss-webrtc/Gqo2MfnQWkw/XZYGhjHvDQAJ
* **User impact if declined**: Chrome and safari (possibly also Edge) will not be able to receive audio from Firefox in video calls in some cases
* **Fix Landed on Version**: 70
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Well covered with unittests and mochitests
* **String or UUID changes made by this patch**:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1570673,9,Verified fixed on the latest Firefox Nightly (20190808214929) on Windows 10 and Mac OS 10.14.6,SOLUTION_VERIFICATION,0,FULL_TEXT
1570673,10,"Comment on attachment 9082951
Bug 1570673 - Add mochitest. r?bwc
Fixes a WebRTC interop bug which can cause users of other browsers to not receive audio from Firefox users. Approved for 69.0b13 and 68.1esr.",UPLIFT_APPROVAL,0,FULL_TEXT
1570673,11,"https://hg.mozilla.org/releases/mozilla-beta/rev/0291822afd2d
https://hg.mozilla.org/releases/mozilla-beta/rev/c63aa7985beb
https://hg.mozilla.org/releases/mozilla-beta/rev/1b6a325b60ba",UNCODED,0,UNMATCHED
1570673,12,At least the second patch needs rebasing for ESR68.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1570673,13,"Verified fixed on Windows 10, Mac OS 10.14.6 and Ubuntu 18.04 using Firefox Beta 69.0b13 (20190812173625)",SOLUTION_VERIFICATION,0,FULL_TEXT
1570673,14,Slight collision with bug 1556696. I'll have the 2nd patch up rebased for esr68 in a bit.,ISSUE_IMPACT,0,FULL_TEXT
1570673,15,"Created attachment 9085085
[esr68] Add an active state to VideoFrameConverter and propagate it from MediaPipeline
Rebased attachment 9082952 on top of esr68. Carries forward the r+.",CODE_IMPLEMENTATION,1,90_PCT_MATCH
1570673,16,"https://hg.mozilla.org/releases/mozilla-esr68/rev/4a013bedd9b2
https://hg.mozilla.org/releases/mozilla-esr68/rev/634e8c6ee728
https://hg.mozilla.org/releases/mozilla-esr68/rev/23ede143e5f2",UNCODED,0,UNMATCHED
1570673,17,"Verified fixed on Windows 10, Mac OS 10.14.6 and Ubuntu 18.04 using Firefox 68.1.0 ESR (20190814031227) downloaded from https://treeherder.mozilla.org/#/jobs?repo=mozilla-esr68",SOLUTION_VERIFICATION,0,FULL_TEXT
1571487,1,"User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) snap Chromium/76.0.3809.87 Chrome/76.0.3809.87 Safari/537.36
Steps to reproduce:
web platform tests for normalizing MathML elements
https://wpt.fyi/interop/mathml/relations/html5-tree/clipboard-event-handlers.tentative.html?label=master&label=experimental
https://wpt.fyi/results/mathml/relations/html5-tree/css-inline-style-interface.tentative.html?label=master&label=experimental
https://wpt.fyi/results/mathml/relations/html5-tree/html-or-foreign-element-interfaces.tentative.html?label=master&label=experimental
https://wpt.fyi/results/mathml/relations/html5-tree/math-global-event-handlers.tentative.html?label=master&label=experimental
failed
Actual results:
They fail, they are historically an outlier without useful IDL.
Expected results:
We'd like them to pass
https://github.com/mathml-refresh/mathml/issues/83#issuecomment-518293228",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1571487,2,We should probably land the fix for bug 1414372 first so we don't have to do extra IDL changes here after the fact.,REQUIREMENT,0,FULL_TEXT
1571487,3,"We'd also need to add an actual MathMLElement interface.
And as an implementation note, we'd need to add tabindex parsing to `nsMathMLElement::ParseAttribute`.
As a spec note, I don't see anything in https://mathml-refresh.github.io/mathml-core/#dom-and-javascript that has any mention of event handler content attributes (as opposed to IDL attributes), even though the tests test for that.  The language at https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers-on-elements,-document-objects,-and-window-objects is specific to HTML elements, obviously.  We'd need to implement event handler content attributes as well to pass these tests, which is not a pure binding issue.
Note that the mapping from attribute names to event handler event types is NOT the same for HTML and SVG, by the way.  If the intent is that MathML uses the HTML mapping, it should probably explicitly say that.  I wish SVG actually specified its behavior too...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1571487,4,"It's also possible that what should happen here is bugs blocking this one on the actual behavior changes (i.e. the handling of event handler attributes is a behavior change even if they don't get exposed via IDL), in addition to the IDL changes this bug would make.",PROBLEM_REVIEW,0,FULL_TEXT
1571487,5,"We actually had an issue discussing some of this at https://github.com/mathml-refresh/mathml/issues/118.  SVG, as I think you are saying, basically just says ""you add/drop the 'on' and you have to support the global events.  But, it sounds like you are saying they aren't the same in SVG?  Can you explain a little more so that we know the right thing to do here?  cc/amelia so maybe we can sort as much of this out as possible and un-weird these two",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1571487,6,"I see.  I filed https://github.com/w3c/svgwg/issues/719 on the SVG bits.
Past that, Gecko maps the ""onload"" attribute in SVG to the ""SVGLoad"" event, not the ""load"" event.  Similar for a number of other attributes.  See <https://searchfox.org/mozilla-central/rev/e62c920f7f6463239c6634113f8a8351e263b936/dom/svg/SVGElement.cpp#1374-1382>.  I just checked, and other browsers don't obviously seem to do that, so maybe we can drop it...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1571487,7,I guess that might be bug 620002.,CLARIFICATION,0,FULL_TEXT
1571487,8,This is now implemented in WebKit with the attribute names used in the WPT tests. Brian plans to update the MathML Core spec to make the names explicit.,STATUS_UPDATE,0,FULL_TEXT
1571487,9,"Created attachment 9091079
Bug 1571487 - Implement MathML DOM
Untested WIP patch.",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1571487,10,@Brian: I think we also need tests to check the cases when onevent attributes are dynamically added/removed/modified.,TESTCASE_REQUEST,0,FULL_TEXT
1571487,11,"(also re comment#5)
bz, speaking to amelia's reasoning for doing it the way they did on the linked svg issue - was just talking with her about how we manage to not explicitly list and be explicit enough.  Would something as simple as the following phrasing work?
""All MathML elements support event handler content attributes, as described in [HTML](https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-contentattributes).  All event handler content attributes noted by HTML as being supported by all HTMLElements are supported by all MathML elements as well, and reified as the relevant event handler IDL attributes as described in that specification, and defined in the MathMLElement IDL. """,SOLUTION_REVIEW,1,90_PCT_MATCH
1571487,12,"The link to <https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-contentattributes> you have there is broken, no?  Presumably it should link to <https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-content-attributes>.  
Past that, the ""noted by HTML as being supported by all HTML elements"" (note spelling of that last term!) text should probably link to <https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers-on-elements,-document-objects,-and-window-objects>.  In practice the intent is to pull in that first big list and oncut/oncopy/onpaste, right?
I don't know that the ""reified as ..."" bit is needed, as long as the IDL links to the right places (which presumably it does given that presumably it just pulls in the `DocumentAndElementEventHandlers` and `GlobalEventHandlers` mixins).  I'm not sure whether this ""reified as ..."" bit is actively harmful, but it did confuse me a bit, since the actual reification, if there is one, is in terms of ""event handler"" structs, and the content and IDL attributes are just ways to create and modify those structs; neither one is really the full source of truth.",SOLUTION_REVIEW,1,FULL_TOKEN
1571487,13,@Boris: Can you please take a look at the preliminary rename-only patch https://phabricator.services.mozilla.com/D45128 ? Thanks!,CODE_REVIEW_REQUEST,0,FULL_TEXT
1571487,14,"Yes, it's in my review queue...  Will get to it soon.",STATUS_UPDATE,0,FULL_TOKEN
1571487,15,"I uploaded a new patch. I think the implementation is essentially done, but we need to wait for the latest WPT changes, to send the intent-to and perhaps to write more tests for the tabIndex/focus stuff.
Brian has added more details to the MathML Core spec:
https://mathml-refresh.github.io/mathml-core/#event-handler-content-attributes
https://mathml-refresh.github.io/mathml-core/#focus",CODE_IMPLEMENTATION,1,FULL_TOKEN
1571487,16,"I wrote the intent to prototype: https://groups.google.com/forum/#!topic/mozilla.dev.platform/ssTytf-pT7k
and sent the patch for a first review.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1571487,17,"There has not been any complaint on the ""intent to"" email since I sent it one week ago. I'd like to get the MathML DOM changes landed so that we are closer to WebKit in https://mathml-refresh.github.io/mathml-core/implementation-report.html
@Boris: Can you please take a look at attachment 9091079?
IIUC, these are the main things I were not sure about:
* Whether we need a runtime flag.
* Whether we need a EventNameType_MathML flag that would basically duplicate the EventNameType_HTML one.
* Whether we can factor out shared logic between SVG & HTML and use it for MathML too (I guess yes, but that's probably something to do in a separate bug).
* Whether we need more tests for the tabindex/focus related changes.
Thanks!",QUESTION,0,90_PCT_MATCH
1571487,18,"Yes, I have been since Friday.  I was just off yesterday...
How likely is compat fallout?  If we were putting things behind a flag here, which things would go behind the flag?
The only reason the `EventNameType` thing exists is for purposes of implementing `IsEventAttributeNameInternal`.  If you can get the right behavior without adding a new one, I wouldn't introduce a new one.
That seems reasonable.  Some such logic is already factored into `nsStyledElement`.  We could either move move things into there or add another class below or above it.  Followup for this is ok, though filing the followup now, with a list of things that can be shared, might not be a bad idea.
Well, the tabindex bits definitely need more tests, since they're buggy... ;)",CODE_REVIEW,0,FULL_TOKEN
1571487,19,"As I mentioned on the mailing list, I personally don't think a flag is necessary. People currently expect elements to have the same IDL attributes as HTML elements (e.g. bug 1231085 and bug 1530110 for style) so we are really just normalizing MathML's behavior.  Apple reviewers were ok to land WebKit support without a runtime flag. Also, I'm not exactly sure what we should/can put under a flag. Anyway, if someone really feels we should, this can be reconsidered (I didn't see any complaints on the intent to ship).",ANSWER_TO_QUESTION,0,FULL_TOKEN
1571487,20,"It looks like more test updates are needed before landing this:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=d750689827750b7e7211a3bfb1a39cd94010f053",REQUIREMENT,0,FULL_TOKEN
1571487,21,"Pushed by nbeleuzu@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/718ef1098af5
Implement MathML DOM r=bzbarsky",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1571487,22,Created web-platform-tests PR https://github.com/web-platform-tests/wpt/pull/19506 for changes under testing/web-platform/tests,UNCODED,0,UNMATCHED
1571487,23,"Upstream web-platform-tests status checks passed, PR will merge once commit reaches central.",SOLUTION_VERIFICATION,0,FULL_TEXT
1571487,24,"Backed out changeset 718ef1098af5 (Bug 1571487) for causing perma wpt merges in /mathml/relations/html5-tree/tabindex-002.html CLOSED TREE
https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&fromchange=eaa0c1e72e51139f37dd0486c15753b71e33c1fd&selectedJob=269783425
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=269783425&repo=autoland&lineNumber=3818",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1571487,25,Upstream PR was closed without merging,UNCODED,0,UNMATCHED
1571487,26,"Backout by shindli@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e4fc32c3ae1d
Backed out changeset 718ef1098af5 for causing perma wpt merges in /mathml/relations/html5-tree/tabindex-002.html CLOSED TREE",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1571487,27,"I only see mathml/relations/html5-tree/tabindex-002.html failing on mac. The test passes on Linux.
(This test is basically copied from html/interaction/focus/sequential-focus-navigation-and-the-tabindex-attribute/focus-tabindex-order.html but that one does not have any failure expectation.)
@Henrik: Are you aware of any particular issue with marionette/testdriver/send_keys?  I can't find anything on Bugzilla.",QUESTION,0,FULL_TOKEN
1571487,28,Focus model is different on mac than on linux / windows. Probably the test assumes the linux / windows focus model.,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1571487,29,"In particular, iirc, on mac only buttons and inputs are tab-navigable by default, or something like that...",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1571487,30,"Created attachment 9098894
MDN: Browser compatibility table update",UNCODED,0,UNMATCHED
1571487,31,"Thanks Emilio. I tried to do a similar test using only HTML (no MathML) and indeed on macOS links are not tab-navigable by default, so the test fails... 
(see also the related https://github.com/Igalia/chromium-dev/issues/50)
@Boris: Not sure what would be the easiest way to move forward? Add a failure expectation on mac? Do not test navigation of mathml link? Find a way to force the link to be tab-navigable?",SOLUTION_VERIFICATION,0,FULL_TOKEN
1571487,32,"Well, the test is fundamentally buggy, since it assumes things that are simply not true, right?  Tests are meant to test the things specs actually require, not whatever happens to work on one particular setup or operating system.  Specs do not require links to be tab-navigable.
So the right answer in general is to fix the test so it's not testing non-spec-required things.  Depending on the purpose of the test that could mean removing the test, or removing just the `text6` bit from the test, or having it test that tab-navigability of MathML links matches tab-navigability of HTML links, or something else.  I don't know what the exact goal of this test is, so hard to say what it should test.
Short-term you can add a failure expectation on Mac, yes.  I'd probably go that way.  You could likely set the `accessibility.tabfocus` pref to `7` to override the default Mac behavior, but I would prefer we test the configurations we actually ship.  Though it might not be terrible to have a separate test that makes sure that preference works as it should, of course.  I see no such tests right now....  That's way out of the scope of this bug, though.  File a followup for that, please?",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TOKEN
1571487,33,"OK, I don't really know what's the rule for links I just learned today that they can be not tab-navigable :-)
I opened https://github.com/mathml-refresh/mathml/issues/152 and will mark this as failing on mac for now",NEW_ISSUE_FILING,0,FULL_TEXT
1571487,34,https://treeherder.mozilla.org/#/jobs?repo=try&revision=8e90179cfc85b8f5469e031d2264f92974d15a6a,UNCODED,0,UNMATCHED
1571487,35,"Pushed by btara@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/30154d163aca
Implement MathML DOM r=bzbarsky",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1571487,37,https://hg.mozilla.org/mozilla-central/rev/30154d163aca,UNCODED,0,UNMATCHED
1571487,39,"Mentioned this on Fx71 for developers:
https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/71#MathML
And also on the MathML element reference:
https://developer.mozilla.org/en-US/docs/Web/MathML/Element
The MathMLElement class is documented here:
https://developer.mozilla.org/en-US/docs/Web/API/MathMLElement",UNCODED,0,UNMATCHED
1574259,1,"I noticed some issues in ReauthenticateUserWindows:
[The doc for LsaConnectUntrusted](https://docs.microsoft.com/en-us/windows/win32/api/ntsecapi/nf-ntsecapi-lsaconnectuntrusted) says ""The handle should be closed using the LsaDeregisterLogonProcess function."" which we do, but then the `ScopedHANDLE` additionally calls `CloseHandle` which seems like one too many closings.  `lsa` should probably get its own separate RAII struct that calls `LsaDeregisterLogonProcess`. (Also this would ensure that `LsaDeregisterLogonProcess` gets called even if we take one of the early returns)
Second, this pattern around LsaLogonUser is fragile:
```
  HANDLE token;
  NTSTATUS sts = LsaLogonUser(...);
  ScopedHANDLE scopedToken(token);
  if (sts ...) {
```
Generally the contract with Windows APIs is that you can rely on them to populate output parameters as long as the API succeeds.
If the API fails, `token` may be left uninitialized, and the RAII helper's `CloseHandle` could do bad things. Either the `ScopedHandle` should be established _after_ checking the return value, or `token` should be initialized to a safe value before the API call.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1574259,2,"The priority flag is not set for this bug.
:keeler, could you have a look please?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_priority.py).",QUESTION,0,FULL_TOKEN
1574259,3,"Created attachment 9161635
Bug 1574259 - Improve resource management in ReauthenticateUserWindows r=keeler",UNCODED,0,UNMATCHED
1574259,4,"Pushed by abutkovits@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/433320ec2147
Improve resource management in ReauthenticateUserWindows r=dmajor,mhowell",UNCODED,0,UNMATCHED
1574259,5,https://hg.mozilla.org/mozilla-central/rev/433320ec2147,UNCODED,0,UNMATCHED
1581315,1,"ThrowTypeError/ThrowRangeError should probably have the annotation too.  Maybe others as well (NoteJSContextException, for example).",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1581315,2,"Created attachment 9093194
Bug 1581315 part 1.  Adjust MOZ_MUST_RETURN_FROM_CALLER to only apply to method calls on arguments.  r=nika
It doesn't really make sense to enforce this behavior for calls on stack
variables (which presumably we then want to do something with) and doesn't
necessarily make sense to enforce it for member variables either.",CODE_IMPLEMENTATION,1,90_PCT_MATCH
1581315,3,"Created attachment 9093195
Bug 1581315 part 2.  Fix incorrect behavior of PannerNode::SetRolloffFactor.  r=karlt
Our implementation modified the state, in addition to throwing the exception.
And the tests not only didn't test for this, but wouldn't have reached that
code anyway, due to the harness giving up as soon as anything failed.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1581315,4,"Created attachment 9093196
Bug 1581315 part 3.  Add MOZ_MUST_RETURN_FROM_CALLER_IF_THIS_IS_ARG to more ErrorResult methods.  r=smaug",PROBLEM_DESCRIPTION,0,80_PCT_MATCH
1581315,5,"Pushed by bzbarsky@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/4968ed697e0a
part 1.  Adjust MOZ_MUST_RETURN_FROM_CALLER to only apply to method calls on arguments.  r=nika
https://hg.mozilla.org/integration/autoland/rev/be26864d5a00
part 2.  Fix incorrect behavior of PannerNode::SetRolloffFactor.  r=karlt
https://hg.mozilla.org/integration/autoland/rev/395ae88909c6
part 3.  Add MOZ_MUST_RETURN_FROM_CALLER_IF_THIS_IS_ARG to more ErrorResult methods.  r=smaug",UNCODED,0,UNMATCHED
1581315,6,Created web-platform-tests PR https://github.com/web-platform-tests/wpt/pull/19224 for changes under testing/web-platform/tests,UNCODED,0,UNMATCHED
1581315,7,"Can't merge web-platform-tests PR due to failing upstream checks:
Github PR https://github.com/web-platform-tests/wpt/pull/19224
* Taskcluster (pull_request) (https://tools.taskcluster.net/task-group-inspector/#/dNeJ9c6jRIypfSJ0x5Ag-A)",SOLUTION_VERIFICATION,0,FULL_TOKEN
1581315,8,"The instability in Firefox causing the upstream test failure is a known issue with that test.  See bug 1560454 (which is marked fixed, but was ""fixed"" by disabling the test)...",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1581315,9,"OK, I'll force merge this once it reaches central.",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TEXT
1581315,10,"https://hg.mozilla.org/mozilla-central/rev/4968ed697e0a
https://hg.mozilla.org/mozilla-central/rev/be26864d5a00
https://hg.mozilla.org/mozilla-central/rev/395ae88909c6",UNCODED,0,UNMATCHED
1581315,11,Upstream PR merged by jgraham,UNCODED,0,UNMATCHED
1593658,1,"The issue was reported at https://github.com/mozilla-mobile/fenix/issues/6360
When link name begins with ""rmnet_data"" we consider it as mobile data device. In such case we don't hash GW address, because it changes often and we would get different ID. On some Android versions the link name is just rmnet0, rmnet1, ... It would be good if we could detect mobile data link in a different way than comparing its name. But for now let's fix it so we compare it with ""rmnet"".",PROBLEM_MOTIVATION,0,FULL_TOKEN
1593658,2,"Created attachment 9106172
Bug 1593658 - network ID: Fix detecting mobile data link on some Android versions, r=valentin
When we fail to detect the link as mobile data device, we use GW address for ID calculation. And because GW changes often in case of mobile data we often get different ID for the same network.",CODE_IMPLEMENTATION,1,FULL_TEXT
1593658,3,"Pushed by mnovotny@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/8a3a8d2a2e51
network ID: Fix detecting mobile data link on some Android versions, r=valentin",UNCODED,0,UNMATCHED
1593658,4,https://hg.mozilla.org/mozilla-central/rev/8a3a8d2a2e51,UNCODED,0,UNMATCHED
1593658,5,"Hi, verified as fixed with Samsung Galaxy 9 (Android 8.0.0) and Google Pixel 3a (Android 9) on app build Firefox Preview Nightly 191120 (Build #13240608) and Gecko View 72.0a1-20191118093852.",SOLUTION_VERIFICATION,0,FULL_TEXT
1598488,1,"`GetWidget()` seems to return the root window widget for `<menupopup>` and the popup window widget itself for `<panel>`.
`GetView()->GetWidget()` seems to return the popup window widget itself for both the `<panel>` and the `<menupopup>`.
I was caught by this in bug 1597120 and ended up using `GetView()->GetWidget()`.
I don't know if that's the intended behavior, but if it isn't, this is probably related to `GetRootViewForPopup` returning the wrong view.
:tnikkel, do you know if this behavior is intended ?",PROBLEM_MOTIVATION,0,FULL_TOKEN
1598488,2,"Thanks for reporting this!
That seems just wrong. Looking at the callers of GetWidget they are seem to want to widget of the popup and not the root widget.
Do you happen to know why GetRootViewForPopup is returning the wrong view? Is it because we skip over the widget for the popup because the window type is not eWindowType_popup? Or because the view we start with from |nsView* view = aStartFrame->GetClosestView()| is a view outside of the popup because the nsMenuPopupFrame doesn't have a view yet?",PROBLEM_REVIEW,0,FULL_TOKEN
1598488,3,"Tbh, I haven't really looked into it deeper than this (I don't have a full build locally, all of my debugging involved sending my commits to try, downloading the artifacts to test them, and reading the code).
But from reading the code, I don't think it can be the former, since we init the widget with `eWindowType_popup`: https://searchfox.org/mozilla-central/rev/581466eef9269afb03d8a0dba2f50215f3a9026c/layout/xul/nsMenuPopupFrame.cpp#270",ANSWER_TO_QUESTION,0,FULL_TOKEN
1598488,4,"Hmm, well I don't think it can be the other one actually, because you switched to GetView()->GetWidget(), so we must have a view on the menu popup frame in this case. So we don't understand what's going on here? It would be good to know what's going on.",SOLUTION_REVIEW,1,FULL_TEXT
1598488,5,"Yeah, I switched to `GetView()->GetWidget()` because `GetWidget()` wasn't correct, `GetView()->GetWidget()` returns the right thing though.",SOLUTION_REVIEW,1,FULL_TOKEN
1598488,6,How does one reproduce this to figure out whats happening?,REPRODUCTION_REQUEST,0,FULL_TEXT
1598488,7,"Ah, nevermind, I figured it out. I was missing the obvious. If our view doesn't have a widget we proceed to the parent view, it'll have a widget of the wrong type, but it won't have a parent view, and so we return that view. I'll attach a patch to get rid of this complication, it's not useful.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1598488,8,"Created attachment 9110767
Bug 1598488. Fix nsMenuPopupFrame::GetWidget. r=emilio
It can return the root widget if the menu popup frame doesn't have a widget. None of the callers want this.",CODE_IMPLEMENTATION,1,FULL_TEXT
1598488,9,"(Note that I triggered landing for bug 1597120 a few hours ago, and I see you just triggered landing here as well so I'll make sure to land a follow up here to remove my workaround)",STATUS_UPDATE,0,FULL_TEXT
1598488,10,The new code is equivalent to your work around and I think the same pattern is used elsewhere in the file so it's okay to leave it.,CLARIFICATION,0,FULL_TEXT
1598488,11,"Pushed by tnikkel@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/c038eb7d1cb1
Fix nsMenuPopupFrame::GetWidget. r=emilio",UNCODED,0,UNMATCHED
1598488,12,https://hg.mozilla.org/mozilla-central/rev/c038eb7d1cb1,UNCODED,0,UNMATCHED
1600320,1,"The attached crash information was detected while running CI tests with ThreadSanitizer on mozilla-central revision 66531295716a.
This race looks very similar to bug 1533521 with the exception that the writing code here is in the Rust function `set_len` instead of the `SetLength` C++ counterpart. Not sure if we can apply the same or a similar fix like we did in bug 1533521. Fixing this race is highly desirable because it is by far one of the most frequent races we currently have in tests (over 500 times in Mochitests alone).
### General information about TSan reports
#### Why fix races?
Data races are undefined behavior and can cause crashes as well as correctness issues. Compiler optimizations can cause racy code to have unpredictable and hard-to-reproduce behavior.
#### Rating
If you think this race can cause crashes or correctness issues, it would be great to rate the bug appropriately as P1/P2 and/or indicating this in the bug. This makes it a lot easier for us to assess the actual impact that these reports make and if they are helpful to you.
#### False Positives / Benign Races
Typically, races reported by TSan are not false positives [1], but it is possible that the race is benign. Even in this case it would be nice to come up with a fix if it is easily doable and does not regress performance. Every race that we cannot fix will have to remain on the suppression list and slows down the overall TSan performance. Also note that seemingly benign races can possibly be harmful (also depending on the compiler, optimizations and the architecture) [2][3].
[1] One major exception is the involvement of uninstrumented code from third-party libraries.
[2] http://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong
[3] How to miscompile programs with ""benign"" data races: https://www.usenix.org/legacy/events/hotpar11/tech/final_files/Boehm.pdf
#### Suppressing unfixable races
If the bug cannot be fixed, then a runtime suppression needs to be added in `mozglue/build/TsanOptions.cpp`. The suppressions match on the full stack, so it should be picked such that it is unique to this particular race. The bug number of this bug should also be included so we have some documentation on why this suppression was added.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1600320,2,"Created attachment 9112557
Detailed Crash Information",UNCODED,0,UNMATCHED
1600320,3,Sure thing.,UNCODED,0,UNMATCHED
1600320,4,"Created attachment 9112560
Bug 1600320 - Avoid writing into the empty array header. r=#style,jfkthame
The only way for this to happen is calling set_len(0) on an already-empty array.
We should be replacing these bindings by the `ThinVec` crate, but this is easier
for now.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1600320,5,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/70dac52cf66e
Avoid writing into the empty array header. r=jwatt",UNCODED,0,UNMATCHED
1600320,6,https://hg.mozilla.org/mozilla-central/rev/70dac52cf66e,UNCODED,0,UNMATCHED
1614706,1,"The attached crash information was detected while running CI tests with ThreadSanitizer on mozilla-central revision 11c9c5ce3955.
Looks like a simple race on `mStatus` being updated vs. it being used in `RemoveInput`.
### General information about TSan reports
#### Why fix races?
Data races are undefined behavior and can cause crashes as well as correctness issues. Compiler optimizations can cause racy code to have unpredictable and hard-to-reproduce behavior.
#### Rating
If you think this race can cause crashes or correctness issues, it would be great to rate the bug appropriately as P1/P2 and/or indicating this in the bug. This makes it a lot easier for us to assess the actual impact that these reports make and if they are helpful to you.
#### False Positives / Benign Races
Typically, races reported by TSan are not false positives [1], but it is possible that the race is benign. Even in this case it would be nice to come up with a fix if it is easily doable and does not regress performance. Every race that we cannot fix will have to remain on the suppression list and slows down the overall TSan performance. Also note that seemingly benign races can possibly be harmful (also depending on the compiler, optimizations and the architecture) [2][3].
[1] One major exception is the involvement of uninstrumented code from third-party libraries.
[2] http://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong
[3] How to miscompile programs with ""benign"" data races: https://www.usenix.org/legacy/events/hotpar11/tech/final_files/Boehm.pdf
#### Suppressing unfixable races
If the bug cannot be fixed, then a runtime suppression needs to be added in `mozglue/build/TsanOptions.cpp`. The suppressions match on the full stack, so it should be picked such that it is unique to this particular race. The bug number of this bug should also be included so we have some documentation on why this suppression was added.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1614706,2,"Created attachment 9125866
Detailed Crash Information",UNCODED,0,UNMATCHED
1614706,3,"Created attachment 9125951
Bug 1614706 - ThreadSanitizer: data race [@ Release] vs. [@ CloseWithStatusLocked] in CacheFileInputStream
Acquiring the lock is moved from CacheFile::RemoveInput() to CacheFileInputStream::Release(). This fixes the data race and is consistent with CacheFile::RemoveOutput() which is also called under the lock.",CODE_IMPLEMENTATION,1,FULL_TEXT
1614706,4,"Pushed by mnovotny@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/7b78962b156b
ThreadSanitizer: data race [@ Release] vs. [@ CloseWithStatusLocked] in CacheFileInputStream r=mayhemer",UNCODED,0,UNMATCHED
1614706,5,https://hg.mozilla.org/mozilla-central/rev/7b78962b156b,UNCODED,0,UNMATCHED
1623400,1,"Created attachment 9134198
bug.png
User Agent: Mozilla/5.0 (X11; Linux x86_64; rv:76.0) Gecko/20100101 Firefox/76.0
Steps to reproduce:
Update Firefox Nightly to the latest build (build 2020-03-18 in this case).
Actual results:
Dektop push notifications are no longer appearing as they used to for sites where they were previously enabled. For new sites nottifications cannot be switched on (see pic attached).
Expected results:
Notifications should appear as usual.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1623400,2,"Since the status are different for nightly and release, what's the status for beta?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#missing_beta_status.py).",QUESTION,0,FULL_TOKEN
1623400,3,Do you get the prompt to allow desktop notifications if you click the button on https://mdn.mozillademos.org/en-US/docs/Web/API/Notifications_API/Using_the_Notifications_API$samples/Tag_example?revision=1606062 ?,QUESTION,0,FULL_TEXT
1623400,4,"[Bugbug](https://github.com/mozilla/bugbug/) thinks this bug should belong to this component, but please revert this change in case of error.",ISSUE_METADATA_CHANGE,0,90_PCT_MATCH
1623400,5,Yes and notifications seem to work. Strange...,ANSWER_TO_QUESTION,0,FULL_TEXT
1623400,6,"For more info - I did some tests and several websites with push notifications seems to work.
Examples:
https://www.bennish.net/web-notifications.html
https://www.pushengage.com/demo
Not working:
https://gauntface.github.io/simple-push-demo/
and most of the sites where I use notifications like YouTube, Facebook etc.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1623400,7,"https://gauntface.github.io/simple-push-demo/ also doesn't work with Firefox 74 or 68.6.0esr here.
Do you know a website where it doesn't work, preferably without an account (or where not multiple accounts are needed)?",QUESTION,0,FULL_TEXT
1623400,8,"In Firefox 74 it is working for me.
For a website where notifications do not work right now - maybe a Polish website sportowefakty.wp.pl . After enabling notifications they should send a 'thank you' notification.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1623400,9,"I have attempted to find this bug's regressor on Windows 10 and this are my results:
    2020-03-19T11:23:20: INFO : Narrowed integration regression window from [23c4c99d, a0508ae6] (3 builds) to [f6b26481, a0508ae6] (2 builds) (~1 steps left)
    2020-03-19T11:23:20: DEBUG : Starting merge handling...
    2020-03-19T11:23:20: DEBUG : Using url: https://hg.mozilla.org/integration/autoland/json-pushes?changeset=a0508ae6c037928981ac2733860b6ec84d7069ec&full=1
    2020-03-19T11:23:22: DEBUG : Found commit message:
    Bug 1508292: Implement Sec-Fetch-*. r=baku
    Differential Revision: https://phabricator.services.mozilla.com/D66283
    2020-03-19T11:23:22: DEBUG : Did not find a branch, checking all integration branches
    2020-03-19T11:23:22: INFO : The bisection is done.
    2020-03-19T11:23:22: INFO : Stopped
NI me if it seems incorrect. Thank you.",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1623400,10,"FWIW, Sec-Fetch-* headers are enabled in Nightly only - we added a pref 'dom.security.secFetch.enabled' which should allow to figure out if the Sec-Fetch Headers are really responsible for the problem described here.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1623400,11,"Hi Dnaiel, can you confirm that this goes away with the pref 'dom.security.secFetch.enabled' switched off?",QUESTION,0,FULL_TEXT
1623400,12,Any update on the progress of this bug?,QUESTION,0,FULL_TEXT
1623400,13,"Yes, I confirm that if the ""dom.security.secFetch.enabled"" pref is switched to false, the original issue does not occur anymore.",PROBLEM_REVIEW,0,FULL_TEXT
1623400,14,"Since it's related to the ""dom.security.secFetch.enabled"" pref, would you mind taking a look into this bug, Christoph?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1623400,15,"I am willing to help, but I guess it's not a Firefox bug. More precisely, when enabled Firefox sends the Sec-fetch-* HTTP request headers [1]. It seems the problem must be on the server side of the specific app; in the case reported within http://gauntface.github.io/simple-push-demo/
Using a different demo, e.g: https://pushalert.co/demo and pressing 'Send Notification' - push notifications work as expected!
[1] https://w3c.github.io/webappsec-fetch-metadata/",PROBLEM_REVIEW,0,FULL_TOKEN
1623400,16,"Hi Mic, I am closing this then but feel free to come back in case. Thank you for reporting!",STATUS_UPDATE,0,FULL_TEXT
1623400,17,Ok I understand but isn't that strange that notifications from sites like YouTube and Facebook are not appearing?,QUESTION,0,FULL_TEXT
1623400,18,"Bug 1508292 broke send tab and I would guess Push Notifications in general. See Push log from Firefox Nightly startup:
```PushServiceWebSocket: onTimerFired() PushServiceWebSocket.jsm:174
PushServiceWebSocket: onTimerFired: Reconnecting after backoff PushServiceWebSocket.jsm:182
PushServiceWebSocket: beginWSSetup() PushServiceWebSocket.jsm:508
PushServiceWebSocket: beginWSSetup: Connecting to wss://push.services.mozilla.com/ PushServiceWebSocket.jsm:532
PushServiceWebSocket: wsOnStop() PushServiceWebSocket.jsm:1081
PushServiceWebSocket: wsOnStop: Reconnecting after socket error 2152398861 PushServiceWebSocket.jsm:1084
PushServiceWebSocket: reconnect() PushServiceWebSocket.jsm:347
PushServiceWebSocket: shutdownWS() PushServiceWebSocket.jsm:353
PushServiceWebSocket: startBackoffTimer() PushServiceWebSocket.jsm:417
PushServiceWebSocket: startBackoffTimer: Retry in 40000 Try number 4 PushServiceWebSocket.jsm:426
```
And mozregression:
```
 6:58.96 INFO: Narrowed integration regression window from [23c4c99d, a0508ae6] (3 builds) to [f6b26481, a0508ae6] (2 builds) (~1 steps left)
 6:58.96 INFO: No more integration revisions, bisection finished.
 6:58.96 INFO: Last good revision: f6b264818bbfc385da9010ed49dfecf2efd436f3
 6:58.96 INFO: First bad revision: a0508ae6c037928981ac2733860b6ec84d7069ec
 6:58.96 INFO: Pushlog:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=f6b264818bbfc385da9010ed49dfecf2efd436f3&tochange=a0508ae6c037928981ac2733860b6ec84d7069ec
```",STACK_TRACE,0,90_PCT_MATCH
1623400,19,*** Bug 1626070 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1623400,20,"Hey Edouard, I am not sure what I can do here to help. FWIW, adding Sec-Fetch-* headers (implemented in Bug 1508292 ) is behind  the pref 'dom.security.secFetch.enabled' which is only enabled in Nightly and we will not let it ride the trains for a while. I added some more information about what I think the problem is within comment 14 - if there is anything else I can be helpful with, please let me know.",PROBLEM_REVIEW,0,FULL_TOKEN
1623400,21,":ckerschb I don't think this is a server bug. 
Autopush (the mozilla push server), hasn't changed since [October of last year](https://github.com/mozilla-services/autopush-rs/releases). 
I know for a fact that it does not use any of the `Sec-Fetch-*` headers since I just found out about them today while working with the client team on this issue. In addition, if it were a server side issue, sites like https://pushalert.co/demo would also fail. I, too, am confused why that site works yet older code like https://serviceworke.rs/push-simple_demo.html does not. I'm able to connect to the push servers using a python websocket client:
```
Press Ctrl+C to quit
< {""messageType"":""hello"",""uaid"":""f916f2c314e54c579d4e598a6cb38bc1"",""status"":200,""use_webpush"":true,""broadcasts"":{}}
```
Looking at [the client code](https://hg.mozilla.org/mozilla-central/annotate/7f9f804e9dbe81bce013bf4dea28074744b568f6/dom/push/PushServiceWebSocket.jsm#l1084) that appears correct and also hasn't changed in quite some time. 
I'll admit that my expertise is in back end and not user agent code, so I'm at a loss to figure out why a connection under nightly is clearly failing. 
I know that the server will reject any connection that initially sends empty or invalid data, but again, the code linked above does not appear to do that (unless there's some recent change inside of `Ci.nsIWebSocketChannel`)
I think we're just at a loss to determine what might be causing this sudden failure.",PROBLEM_REVIEW,0,90_PCT_MATCH
1623400,22,"I am not saying the server is making use of the sec-fetch-* headers, but maybe it fails to ignore them properly?
I really can't imagine why the user agent is causing the problem here, we are really just setting new http request headers, that's it.
Maybe Dan can help us identify the problem - Dan, any suggestions?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1623400,23,"Several of the ""working"" examples are using Notifications, not push. Others are sending pushes to their own sites -- are they setting it up in the backend? Do they later have their own communication when you're on the site that tells the site to send a Notification while you're on it? I didn't see any that sent me a ""push"" when I wasn't on the site itself.
The only ""broken"" one I've seen so far is the https://gauntface.github.io/simple-push-demo/ one from earlier. Unlike comment 6 it worked just fine in Firefox 74. It's also the only demo site I've seen making requests to `wss://push.services.mozilla.com/`. With the sec-fetch- headers that request doesn't get any response at all. With the sec-fetch headers turned off then I get the expected 101 response and the websocket set-up HTTP headers.
Is there a load-balancer or something in front of that service that's choking on the sec-fetch headers? Is the server itself looking for `Sec-` headers instead of `sec-websocket-` headers and getting confused that there are too many of them?",QUESTION,0,FULL_TOKEN
1623400,24,"The server is not looking for any `Sec-*` or `sec-websocket-*` headers. I'm quite positive about that because I'm one of the authors.
I can run some experiments, but it would be helpful to have candidate headers I can use to ping off of the server.
(As an aside, in the future it would be super useful if server impacting changes to the client like these could be be run by the Services Engineering group (services-engineering@/ slack#services-engineering). We can notify other services groups if need be, but it would give us a good start.)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1623400,25,"I am really sorry about that. To emphasize, the pref [dom.security.secFetch.enabled](https://searchfox.org/mozilla-central/rev/7fba7adfcd695343236de0c12e8d384c9b7cd237/modules/libpref/init/StaticPrefList.yaml#2384) is currently only enabled in Nightly. If needed we could even flip it to false in Nightly. We are not planning to let it ride the trains in the super near future. Let me know!",SOLUTION_REVIEW,1,90_PCT_MATCH
1623400,26," I am really sorry about that. To emphasize, the pref [dom.security.secFetch.enabled](https://searchfox.org/mozilla-central/rev/7fba7adfcd695343236de0c12e8d384c9b7cd237/modules/libpref/init/StaticPrefList.yaml#2384) is currently only enabled in Nightly. If needed we could even flip it to false in Nightly. We are not planning to let it ride the trains in the super near future. Let me know!
Totally understandable, and these sorts of things can and will happen. As I know you feel intimately, there's an endless tsunami of specifications, features and changes that don't always get propagated to where they should and not everyone always has the bandwidth to monitor every change coming down the pike. It can often be better to over communicate rather than assume ""they'll find out, I suppose"". Just offering a bucket you can yell into if and when you see something that might be a concern in the future. 
Your humble server folk thank you.",SOLUTION_REVIEW,1,FULL_TEXT
1623400,27,"Using the example at https://serviceworke.rs/push-simple_demo.html I see the same behavior. The headers I get when there's no response:
```
Accept: */*
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.5
Cache-Control: no-cache
Connection: keep-alive, Upgrade
Host: push.services.mozilla.com
Origin: wss://push.services.mozilla.com/
Pragma: no-cache
Sec-Fetch-Dest: websocket
Sec-Fetch-Mode: websocket
Sec-Fetch-Site: cross-site
Sec-WebSocket-Extensions: permessage-deflate
Sec-WebSocket-Key: eyGFCl0x3LtrfBzjknmISg==
Sec-WebSocket-Protocol: push-notification
Sec-WebSocket-Version: 13
Upgrade: websocket
User-Agent: Mozilla/5.0 (Macintosh; Intel ) Gecko/20100101 Firefox/76.0
```
If I turn off the `Sec-Fetch-` headers (pref `dom.security.secFetch.enabled`) it works fine and I get the 101 response with the upgrade response headers.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1623400,28,"Ok, so doing a few experiments using a python web client:
```
--- request header ---
GET / HTTP/1.1
Upgrade: websocket
Connection: Upgrade
Host: push.services.mozilla.com
Origin: http://push.services.mozilla.com
Sec-WebSocket-Key: EXTeF8flvgcy/dU5uWp0iQ==
Sec-WebSocket-Version: 13
Sec-Fetch-Dest: websocket
Sec-Fetch-Mode: websocket
Sec-Fetch-Site: cross-site
Sec-WebSocket-Extensions: permessage-deflate
Sec-WebSocket-Protocol: push-notification
-----------------------
--- response header ---
HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Accept: fj9u9cHokh28aUGs4HJJj2PiHRM=
-----------------------
Press Ctrl+C to quit
send: '\x81\xaam\xedTN\x16\xcf9+\x1e\x9e5)\x08\xb9->\x08\xcfnl\x05\x888""\x02\xcfxl\x18\x9e1\x11\x1a\x886>\x18\x9e<lW\x99&;\x08\x90'
< text: {""messageType"":""hello"",""uaid"":""6db91383b70b49f8b06aec12b2e00bfb"",""status"":200,""use_webpush"":true,""broadcasts"":{}}
```
This is a successful connection to our push servers that uses the example headers provided in [the above comment](https://bugzilla.mozilla.org/show_bug.cgi?id=1623400#c26). I don't believe that the server or anything in between is blocking the connection from working. (note that the `send:...` is the encrypted data being relayed over websocket.) 
Please also note that the sending payload (`{""messageType"":""hello"",""use_webpush"":true}` must be entered within 2 seconds of connection otherwise the server will aggressively timeout the connection
Hopefully, this can also act as a connection proof for later integration testing verification.",PROBLEM_REVIEW,0,FULL_TOKEN
1623400,29,"The sec-fetch- code in the browser is very simple, just a pref check and a series of calls to aHTTPChannel->SetRequestHeader() which obviously succeed.
Is there an internet path issue, and it might be different from your machine to the server? If you try one of the known-broken push examples in Firefox do they work in your nightly? https://gauntface.github.io/simple-push-demo/ seems easier to use since it has a send button. In the servicework.rs example you have to reload the page for each attempt. Is the Browser Console lying about what was actually sent and received? I haven't looked at the actual traffic.",PROBLEM_REVIEW,0,FULL_TOKEN
1623400,30,"I'm doing the tests from the same machine that I am running nightly on, so the pathing should be the same.
Attempting to establish a new push subscription to the test site fails when the GET wss://push.services.mozilla.com/ does not return a response within the browser.
Making the same call using the same header values outside of firefox nightly succeeds as 
I don't have the ability to delve into the active User Agent Push internals but there are a few possible reasons for the failure:
1) The client is failing to send the push ""hello"" packet for some reason. 
2) The client is failing to accept the push ""hello"" response for some reason.
3) Something in between the WebPush.jsm calls outlined in #20 and the actual websocket network dispatch is intercepting or preventing the data. 
The push server is deeply, deeply indifferent about any additional header values. It ignores anything that is unknown or unexpected.
As noted, setting the `dom.security.secFetch.enabled` to false allows the socket data to be exchanged and the push service to resume. (I'll note that even in the case of a success, the browser console does not display the exchanged information, so I can only verify off of expected DOM event behaviors.) Therefore, I strongly assert that this is not a server based issue, and urge examining anything that may interfere with either websocket data transmission or reception, particularly around elements related to the `dom.security.secFetch` component.",PROBLEM_CAUSE_IDENTIFICATION,0,90_PCT_MATCH
1623400,31,"Created attachment 9137701
Bug 1623400: Test SecFetch Headers and websockets.",UNCODED,0,UNMATCHED
1623400,32,"I did a lot of testing trying to narrow down the problem, here is what I found out:
a) I wrote a mochitest (see phabricator) which creates a websocket also attaching the three Sec-Fetch-Headers.
The details about the websocket:
Running the mochitest -> works
b) I tested https://gauntface.github.io/simple-push-demo/ using all kinds of settings:
The details about the websocket:
I tested sending all three headers          -> failure
I tested sending only the first two headers -> works
I tested sending only the third header       -> works
Is it possible that there are some server side size constraints on request headers? Given that I also wrote a mochitest which works correctly, I still think the problem must be somewhere on the server.",QUESTION,0,FULL_TEXT
1623400,33,"This is why I was using something other than firefox in order to test the server. In my case I was using a python based websocket client app that is part of the [websocket_client](https://pypi.org/project/websocket_client/) package. There are other tools that can be used as well, such as [websocat](https://github.com/vi/websocat/releases ) which runs on a wide variety of platforms. This enables me to test the server directly. 
Using websocat from my windows platform:
```
[INFO  websocat::lints] Auto-inserting the line mode
[DEBUG websocat] Done third phase of interpreting options.
[DEBUG websocat] Done fourth phase of interpreting options.
[DEBUG websocat] Preparation done. Now actually starting.
[INFO  websocat::sessionserve] Serving Line2Message(ThreadedStdio) to Message2Line(WsClient(""wss://push.services.mozilla.com/"")) with Options { websocket_text_mode: true, websocket_protocol: None, websocket_reply_protocol: None, udp_oneshot_mode: false, unidirectional: false, unidirectional_reverse: false, exit_on_eof: false, oneshot: false, unlink_unix_socket: false, exec_args: [], ws_c_uri: ""ws://0.0.0.0/"", linemode_strip_newlines: false, linemode_strict: false, origin: None, custom_headers: [(""Sec-Fetch-Dest"", [119, 101, 98, 115, 111, 99, 107, 101, 116]), (""Sec-Fetch-Mode"", [119, 101, 98, 115, 111, 99, 107, 101, 116]), (""Sec-Fetch-Site"", [99, 114, 111, 115, 115, 45, 115, 105, 116, 101]), (""Sec-WebSocket-Extensions"", [112, 101, 114, 109, 101, 115, 115, 97, 103, 101, 45, 100, 101, 102, 108, 97, 116, 101]), (""Sec-WebSocket-Protocol"", [112, 117, 115, 104, 45, 110, 111, 116, 105, 102, 105, 99, 97, 116, 105, 111, 110])], custom_reply_headers: [], websocket_version: None, websocket_dont_close: false, one_message: false, no_auto_linemode: false, buffer_size: 65536, broadcast_queue_len: 16, read_debt_handling: Warn, linemode_zero_terminated: false, restrict_uri: None, serve_static_files: [], exec_set_env: false, reuser_send_zero_msg_on_disconnect: false, process_zero_sighup: false, process_exit_sighup: false, socks_destination: None, auto_socks5: None, socks5_bind_script: None, tls_domain: None, tls_insecure: false, headers_to_env: [], max_parallel_conns: None, ws_ping_interval: None, ws_ping_timeout: None }
[INFO  websocat::stdio_threaded_peer] get_stdio_peer (threaded)
[DEBUG websocat::sessionserve] Underlying connection established
[INFO  websocat::ws_client_peer] get_ws_client_peer
[INFO  websocat::ws_client_peer] Connected to ws
{""messageType"":""hello"",""use_webpush"":true}
[DEBUG websocat::ws_peer] incoming text
{""messageType"":""hello"",""uaid"":""7c8e82bae21d4fc2bacce8ad63d7d9b4"",""status"":200,""use_webpush"":true,""broadcasts"":{}}
^D
[DEBUG websocat::ws_peer] incoming close
[DEBUG websocat::my_copy] BrokenPipe: read_done
[DEBUG websocat::my_copy] done
[INFO  websocat::sessionserve] Reverse finished
[INFO  websocat::sessionserve] Reverse shutdown finished
[DEBUG websocat::my_copy] zero len
[DEBUG websocat::my_copy] read_done
```
While it's a bit hard to read through that output with the verbosity set high, note that I entered 
`{""messageType"":""hello"",""use_webpush"":true}` (which is a proper WebPush ""hello"" message)
and received back:
`{""messageType"":""hello"",""uaid"":""7c8e82bae21d4fc2bacce8ad63d7d9b4"",""status"":200,""use_webpush"":true,""broadcasts"":{}}`
which is the expected response.
Note also that I used the following `--header` arguments and that they were relayed in the `websocat::sessionserve` body:
* Sec-Fetch-Dest: websocket
* Sec-Fetch-Mode: websocket
* Sec-Fetch-Site: cross-site
* Sec-WebSocket-Extensions: permessage-deflate
* Sec-WebSocket-Protocol: push-notification
These include the headers you note. including `Sec-Fetch-Dest: websocket` which you report as not working. 
(The sessionserve message transcribes the values of these strings into byte arrays, so some use of an ascii chart may be required to verify.)
What this means is that a simple client that specifies these headers and values is indeed able to send and receive data from the mozilla WebPush servers. 
Look, I don't want to be contrarian or sound overly negative here, but I feel like we're arguing that the road must be broken because your car won't start after you changed the oil. I understand that firefox is a highly complex virtual machine. Far more complex than the push server. That's why I'm trying to provide as much tooling as possible so that you can solve this problem. It may not be with the code responsible for writing these headers (again, highly complex virtual machine), but it could be surfacing because of some inter-relationship around how the browser should act regarding handling these headers. I don't know, either.
In fact, if you like, you can run [a fake Push Server](https://github.com/vi/websocat) locally, and alter `dom.push.serverURL` to point to it. (Websocket is an upgraded HTTP connection, so the server should listen on ports 80 for (`ws://`) or 443 (for `wss://`) just like a normal HTTP server.) The client should connect and send the ""hello"" message I've been using. (I'll remind that firefox tends to treat `localhost` specially, so it might be worth trying a different address as well.)
I am not sure how I can possibly proceed on this further. I completely agree that firefox 76.0a1 (2020-03-18+) is unable to properly communicate to the server in order to initiate a push connection. This is not the case for older versions of firefox, or independent clients. I have neither the tools nor experience in order to work out why the internal websocket channels within firefox in order to further diagnose or resolve this issue, but continue to be happy to assist where I can. I will gleefully fix and frankly be in rapture if this does turn out to be a server side issue but I am unable to replicate it using anything other than firefox 76.0a1 (2020-03-18+) which, again, leads me to believe that the problem is not with the server.",CLARIFICATION,0,90_PCT_MATCH
1623400,34,"Dragana, Valentin, I'll do more debugging as I have time. Anything you could think of why websockets would start failing because we are adding sec-fetch-* request headers? See comment 31, for details about testing. If there is anything you could think of, please let me know. I tried all the obvious places, if you have any pointers, please let me know.",QUESTION,0,FULL_TEXT
1623400,35,"Do you know if we are sending anything  from Firefox? Do you know where exactly it is failing, e.g. we do not send a request or we send a request but server is not responding?
The comment 29 is asking similar questions.",QUESTION,0,FULL_TOKEN
1623400,36,"Your test in comment 27 did not send as many headers as the browser does in comment 26. If it's a size or # of packets issue, rather than sec-fetch- specifically, that could make a difference.",CLARIFICATION,0,FULL_TEXT
1623400,37,"Ah, indeed! Awesome, I've got a reproducible error.
using the following script:
```echo '{""messageType"":""hello"",""use_webpush"":true}' | /usr/bin/websocat -v \
    --header=""Accept: */*"" \
    --header=""Cache-Control: no-cache"" \
    --header=""Host: push.services.mozilla.com"" \
    --header=""Origin: wss://push.services.mozilla.com/"" \
    --header=""Pragma: no-cache"" \
    --header=""Sec-Fetch-Dest: websocket"" \
    --header=""Sec-Fetch-Mode: websocket"" \
    --header=""Sec-Fetch-Site: cross-site"" \
    --header=""Sec-WebSocket-Extensions: permessage-deflate"" \
    --header=""Sec-WebSocket-Protocol: push-notification"" \
    --header=""Accept-Language: en-US,en;q=0.5"" \
    --header=""Accept-Encoding: gzip, deflate, br"" \
    wss://push.services.mozilla.com
```
succeeds, but adding an additional header
```
echo '{""messageType"":""hello"",""use_webpush"":true}' | /usr/bin/websocat -v \
    --header=""Accept: */*"" \
    --header=""Cache-Control: no-cache"" \
    --header=""Host: push.services.mozilla.com"" \
    --header=""Origin: wss://push.services.mozilla.com/"" \
    --header=""Pragma: no-cache"" \
    --header=""Sec-Fetch-Dest: websocket"" \
    --header=""Sec-Fetch-Mode: websocket"" \
    --header=""Sec-Fetch-Site: cross-site"" \
    --header=""Sec-WebSocket-Extensions: permessage-deflate"" \
    --header=""Sec-WebSocket-Protocol: push-notification"" \
    --header=""Accept-Language: en-US,en;q=0.5"" \
    --header=""Accept-Encoding: gzip, deflate, br"" \
    --header=""Jabberwocky: T'was"" \
    wss://push.services.mozilla.com
```
causes the server to fail the connection. In this case I'm using a nonce header in place of the User-Agent string. 
@oremj are you aware of any ELB header restrictions which might cause these sorts of failures?",REPRODUCTION_ATTEMPT,0,90_PCT_MATCH
1623400,38,Filed: https://github.com/mozilla-services/autopush-rs/issues/136,NEW_ISSUE_FILING,0,FULL_TEXT
1623400,39,"So as a bit of follow up here while I enjoy this plate of crow:
In the rust application, we use `httparse`, which parses and reads the HTTP headers, but uses a user provided `mut slice`. (e.g.
```rust
use httparse;
let mut headers = [httparse::EMPTY_HEADER; 16];
let mut req = httparse::Request::new(&mut headers);
```
while 16 may have been plenty in the past, the new headers pushed us to 17. Literally one more than we expected, which triggered an out of bounds error that resulted in a `too many headers` debug message that got dropped because we don't log those.
The very short term fix is to just double the number of accepted headers (to 32).",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1623400,40,"Really glad that we figured out the problem. I suppose you'll keep this bug to fix the number of accepted headers? If so, I'll file a new bug for the test to land, since we already have it. If not, please assign the bug to me and I'll land the test within this bug. I am fine either way. Thank you!",CLARIFICATION,0,FULL_TEXT
1623400,41,"We tend to use github issues for tracking service projects, so whether or not this bug remains open is not really a concern. If this bug is reassigned or closed, I would very much appreciate getting a crosslink to https://github.com/mozilla-services/autopush-rs/issues/136",ANSWER_TO_QUESTION,0,FULL_TEXT
1623400,42,"If I understand correctly, in any case for the DOM: Push Notifications component there is nothing left to do here, right? So if you keep the bug, please change the component accordingly. Thank you!",CLARIFICATION,0,FULL_TEXT
1623400,43,I think that's a question for JR Conlin.,CLARIFICATION,0,FULL_TEXT
1623400,44,*** Bug 1627794 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1623400,45,"Yep. The problem is with the server accepting a limited number of headers. A quick patch is included in 
https://github.com/mozilla-services/autopush-rs/releases/tag/1.55.0
which is part of
https://bugzilla.mozilla.org/show_bug.cgi?id=1629973",CODE_IMPLEMENTATION,1,FULL_TOKEN
1623400,46,"Hi JR, (as bug 1627794 seems to be a duplicate of this) is this a common problem with the default settings of (some) servers? Do we know with which? I assume that then many websites can be bitten by this. In this case we probably should understand, to which extent we are breaking the web with this feature and what we can do about it.",ISSUE_IMPACT,0,FULL_TEXT
1623400,47,"Correct, this error is on the server and is triggered by more than 16 headers. 
It has been addressed by https://github.com/mozilla-services/autopush-rs/releases/tag/1.55.0
In our case, we were using a rust library called ""[httparse](https://crates.io/crates/httparse)"" that for reasons takes a pre-allocated set of header slots and populates them. Since we had no idea how many headers we were going to be using, we used the demo code value of ""16"". Everything worked just fine for a long time, until the new set of headers pushed us over by literally one header. That's when things broke for us. 
I've [filed an issue](https://github.com/seanmonstar/httparse/issues/70) with that packages authors to have them tweak the demo number up a significant chunk. 
I don't think it's possible to say how end sites might be impacted, since there's not a common set of actions around header processing. I'm sure that many sites will simply ignore these headers and work fine. Others might hit the new header and raise warnings, and I'm sure that some will fail for similar reasons (or maybe the request will exceed whatever buffer size they originally allocated and it'll fail for that reason). 
Honestly, the best we can do is to better advertise these headers out to server folk. I can tell you that we don't generally follow header changes with slavish devotion because we're trying to figure out why the `foo-baz` library 0.192.3 breaks code written with `foo-baz` library 0.192.2 and who the hell is using a library named `foo-baz` since all the documentation just says ""TBD"".",CLARIFICATION,0,90_PCT_MATCH
1623400,48,"Nightly is now working with the following demo sites that weren't working before:
* https://gauntface.github.io/simple-push-demo/
* https://serviceworke.rs/push-simple_demo.html",SOLUTION_VERIFICATION,0,FULL_TOKEN
1623400,49,"Any site using the Push API in Firefox causes Firefox to connect to the Mozilla push server -- so they all fail the same way and are now all fixed.
Other sites not using Push also appear to have been broken by adding the sec-fetch- headers. It may well be the same kind of issue but would have to be addressed individually at each server. These are tracked as separate regressions from bug 1508292 and will need outreach.",CLARIFICATION,0,FULL_TOKEN
1623400,50,*** Bug 1633892 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1624268,1,We introduce a flag HasStoragePermission' in Bug 1616788 which represents whether the document has the storage permission. This flag has to be updated when we add storage permission.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1624268,2,"There is one thing that is unclear to me.
I don't know if we need to update the hasStoragePermission flag in different tab when we grant the storage permission for a given tracking origin. Let's say, we grant the storage permission for the tracker.com which is loaded under the example.com. If there is another tab that has the same structure, example.com embeds tracker.com. Does the storage permission be considered as granted for the tracker.com in this tab? Or it should take effect after this tab reloads.
Baku and steve, could you provide insight on this?",SOLUTION_REVIEW,1,FULL_TOKEN
1624268,3,"According to our discussion, the storage in one tab doesn't have to reflect the storage permission grant from the other tab who has the same configuration. We would expect users to refresh the tab to really get their storage updated in this case. So, we don't really need to update the hasStoragePermission for the other tab.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1624268,4,"Per discussion with Dimi, we don't really need to update the 'hasStoragePermission' flag when allowing the storage access since the 'StorageAccessGranted' cache will handle the updating situation. So, we change this bug to implement using the 'hasStoragePermission' flag to check the storage permission.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1624268,5,*** Bug 1619401 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1624268,6,"Created attachment 9140734
Bug 1624268 - Part 1: Add checking the HasStorageAccessGranted() for the ContentBlocking::ShouldAllowAccessFor(channel). r?dimi
We need to check the HasStorageAccessGranted() in the channel version of
the ContentBlocking::ShouldAllowAccessFor(). It's because we will move
to use the flag 'HasStoragePermission' to check the permission. But, this
flag won't get updated if the storage is allowed by the heuristic. So,
we need to rely on the HasStorageAccessGranted() to check the storage
access in the channel check as well.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1624268,7,"Created attachment 9140735
Bug 1624268 - Part 2: Moving the setting of 'HasStoragePermission' flag to the WindowContext a bit earlier. r?dimi
We need the 'hasStoragePermission' flag for calculating the
HasStorageAccess() value. Right now the setting of the flag is later
than the calculation. So, we move the setting before the calculation.
Depends on D71031",CODE_IMPLEMENTATION,1,FULL_TOKEN
1624268,8,"Created attachment 9140736
Bug 1624268 - Part 3: Use the 'HasStoragePermission' flag to check the storage permission. r?dimi
We move to use the 'HasStoragePermission' flag to check the storage
permission. For the storage permission check of windows, the flag would
come from the WindowContext. For the check of channels, the flag would
come from the loadInfo of the channel.
Depends on D71032",CODE_IMPLEMENTATION,1,FULL_TOKEN
1624268,9,"Created attachment 9140737
Bug 1624268 - Part 4: Remove unnecessary code for ContentBlocking::ShouldAllowAccessFor(). r?dimi
As we change to use the 'HasStoragePermission' flag, there are some code
became uncessary. This patch removes those code.
Depends on D71033",CODE_IMPLEMENTATION,1,FULL_TOKEN
1624268,10,"Pushed by tihuang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/8af99a5ecd54
Part 1: Add checking the HasStorageAccessGranted() for the ContentBlocking::ShouldAllowAccessFor(channel). r=dimi,baku
https://hg.mozilla.org/integration/autoland/rev/c947c72829a6
Part 2: Moving the setting of 'HasStoragePermission' flag to the WindowContext a bit earlier. r=dimi,baku
https://hg.mozilla.org/integration/autoland/rev/06adb66489b8
Part 3: Use the 'HasStoragePermission' flag to check the storage permission. r=dimi,baku
https://hg.mozilla.org/integration/autoland/rev/d58da2438eee
Part 4: Remove unnecessary code for ContentBlocking::ShouldAllowAccessFor(). r=dimi,baku",UNCODED,0,UNMATCHED
1624268,11,"Backed out 4 changesets (Bug 1624268) for causing brwoser-chrome failure at toolkit/components/antitracking/test/browser/browser_partitionedSharedWorkers.js
Push with failure: https://treeherder.mozilla.org/#/jobs?repo=autoland&selectedJob=298095356&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&revision=d58da2438eee32708ab04a2a2313c9d6a5d27fbe
Failure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=298089873&repo=autoland&lineNumber=50228
Backout link: https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&revision=0c70ad5623dc33fc7af66625ebcde34bd73f984e
```
[task 2020-04-17T13:07:37.679Z] 13:07:37     INFO - TEST-PASS | toolkit/components/antitracking/test/browser/browser_partitionedSharedWorkers.js | We expected 1 connection - true == true - 
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - Buffered messages finished
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - TEST-UNEXPECTED-FAIL | toolkit/components/antitracking/test/browser/browser_partitionedSharedWorkers.js | We expected 2 connection for 3rd party SharedWorker - false == true - got false, expected true (operator ==)
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - Stack trace:
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - ok@resource://specialpowers/SpecialPowersSandbox.jsm:86:21
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - msg@chrome://mochitests/content/browser/toolkit/components/antitracking/test/browser/dynamicfpi_head.js:95:19
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - EventListener.handleEvent*@chrome://mochitests/content/browser/toolkit/components/antitracking/test/browser/dynamicfpi_head.js:87:21
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - @chrome://mochitests/content/browser/toolkit/components/antitracking/test/browser/dynamicfpi_head.js:68:17
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - execute@resource://specialpowers/SpecialPowersSandbox.jsm:140:12
[task 2020-04-17T13:07:37.680Z] 13:07:37     INFO - _spawnTask@resource://specialpowers/SpecialPowersChild.jsm:1729:15
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - receiveMessage@resource://specialpowers/SpecialPowersChild.jsm:281:21
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - JSWindowActor query*receiveMessage@resource://specialpowers/SpecialPowersParent.jsm:1063:12
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - JSWindowActor query*spawn@resource://specialpowers/SpecialPowersChild.jsm:1684:17
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - runTest/<@chrome://mochitests/content/browser/toolkit/components/antitracking/test/browser/dynamicfpi_head.js:58:27
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - Async*Tester_execTest/<@chrome://mochikit/content/browser-test.js:1039:34
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - Tester_execTest@chrome://mochikit/content/browser-test.js:1074:11
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - nextTest/<@chrome://mochikit/content/browser-test.js:904:14
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - SimpleTest.waitForFocus/waitForFocusInner/focusedOrLoaded/<@chrome://mochikit/content/tests/SimpleTest/SimpleTest.js:918:23
[task 2020-04-17T13:07:37.681Z] 13:07:37     INFO - Removing the tab
```",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1624268,12,"Pushed by tihuang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/601005e66807
Part 1: Add checking the HasStorageAccessGranted() for the ContentBlocking::ShouldAllowAccessFor(channel). r=dimi,baku
https://hg.mozilla.org/integration/autoland/rev/8b7137730c6b
Part 2: Moving the setting of 'HasStoragePermission' flag to the WindowContext a bit earlier. r=dimi,baku
https://hg.mozilla.org/integration/autoland/rev/9d97ffda84cb
Part 3: Use the 'HasStoragePermission' flag to check the storage permission. r=dimi,baku
https://hg.mozilla.org/integration/autoland/rev/b53169070af1
Part 4: Remove unnecessary code for ContentBlocking::ShouldAllowAccessFor(). r=dimi,baku",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1624268,13,"https://hg.mozilla.org/mozilla-central/rev/601005e66807
https://hg.mozilla.org/mozilla-central/rev/8b7137730c6b
https://hg.mozilla.org/mozilla-central/rev/9d97ffda84cb
https://hg.mozilla.org/mozilla-central/rev/b53169070af1",UNCODED,0,UNMATCHED
1625850,1,"This bug is for crash report bp-0fbe6c56-64ba-4fac-9415-51fd30200329.
```
Top 10 frames of crashing thread:
0 libxul.so nsGNOMEShellSearchProvider::LaunchWithID /builddir/build/BUILD/firefox-74.0/browser/components/shell/nsGNOMEShellSearchProvider.cpp:560
1 libxul.so nsGNOMEShellSearchProvider::ActivateResult /builddir/build/BUILD/firefox-74.0/browser/components/shell/nsGNOMEShellSearchProvider.cpp:639
2 libdbus-1.so.3.19.11 _dbus_object_tree_dispatch_and_unlock ../../dbus/dbus-object-tree.c:1020
3 libdbus-1.so.3.19.11 <name omitted> ../../dbus/dbus-connection.c:4576
4 libdbus-glib-1.so.2.3.4 message_queue_dispatch /usr/src/debug/dbus-glib-0.110-6.fc31.x86_64/dbus-gmain/dbus-gmain.c:89
5 libglib-2.0.so.0.6200.6 <name omitted> ../glib/gmain.c:3881
6 libglib-2.0.so.0.6200.6 g_main_context_iterate ../glib/gmain.c:3954
7 libglib-2.0.so.0.6200.6 <name omitted> ../glib/gmain.c:4015
8 libxul.so nsAppShell::ProcessNextNativeEvent /builddir/build/BUILD/firefox-74.0/widget/gtk/nsAppShell.cpp:274
9 libxul.so nsBaseAppShell::DoProcessNextNativeEvent /builddir/build/BUILD/firefox-74.0/widget/nsBaseAppShell.cpp:120
```
I'm not sure if this the right component. The crash seems Fedora-specific. One user left a comment that looks like a useful STR:
```
Here is the way I can reproduce this crash: I have firefox open. I press the super key going navigating to Gnome search. I miss-spell 'slakc' + enter (The last step needs to be done fast, when I do it slow, nothing happens, specially the sequence of the last characters and pressing enter, like kc[Enter]) Then firefox crashes! 
```
I'm also CC'ing users who reported this and have a bugzilla account.",ERROR_MESSAGE,0,FULL_TOKEN
1625850,2,"Another Fedora user here, I can confirm that I'm having Firefox crash sometimes when using Gnome search quickly and making a typo, as odd as it sounds.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1625850,3,"I guess it's because keyIndex at nsGNOMEShellSearchProvider::LaunchWithID() is invalid so we get null nsCOMPtr<nsINavHistoryResultNode> child
and then crash at  child->GetUri(uri);
Let's fix that in next iteration of Bug 1239694.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1625850,4,Should be fixed by Bug 1239694.,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1629902,1,"Bug 1610373 is now fixed, and we have a new method - `nsICookieManager::getCookieSince`. We should use this to get the cookies instead of `Services.cookies.cookies`.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1629902,2,"Created attachment 9165874
Bug 1629902 - Use nsICookieManager.getCookiesSince() to get cookies in PurgeTrackerService.jsm. r?ewright!",UNCODED,0,UNMATCHED
1629902,3,"Pushed by tihuang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/6380a8b421a1
Use nsICookieManager.getCookiesSince() to get cookies in PurgeTrackerService.jsm. r=ewright",UNCODED,0,UNMATCHED
1629902,4,https://hg.mozilla.org/mozilla-central/rev/6380a8b421a1,UNCODED,0,UNMATCHED
1637897,1,Because we will use 'http' scheme in this test for Fission. We need to enable the pref 'browser_blockingDOMCache.js' to allow it can use DOM cache in insecure context.,PROBLEM_MOTIVATION,0,FULL_TEXT
1637897,2,"Created attachment 9149388
Bug 1637897 - Enable pref ""dom.caches.testing.enabled"" for the test 'browser_blockingDOMCache.js'. r?baku!
We need to enable this pref to allow the DOM cache in insecure context
when this test runs in Fission.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1637897,3,"Pushed by tihuang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/febf9ee6d477
Enable pref ""dom.caches.testing.enabled"" for the test 'browser_blockingDOMCache.js'. r=baku",UNCODED,0,UNMATCHED
1637897,4,https://hg.mozilla.org/mozilla-central/rev/febf9ee6d477,UNCODED,0,UNMATCHED
1640135,1,"`mFirstPartyDomain` was introduced by first-party isolation (FPI), and dynamic first-party isolation (dFPI) reuses this attribute. This may be problematic especially when both mode are enabled (see bug 1631676).
Adding another attribute for dFPI seems reasonable and is quite cheap, we should probably consider doing this.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1640135,2,"I think we already settled that FPI and dFPI should be mutually exclusive, right? I.e., if you enable one, the other is disabled.
Then in bug 1637516 we'd like to move the keying from top-level registrable domain to site. If we did that on top of `mFirstPartyDomain` it would contain a different value based on which of FPI or dFPI is enabled. That probably works, but starts getting confusing. (Migrating FPI to site is being considered as well, but is much more complicated as it already shipped.)
Also, dFPI will be impacted by follow-up projects to Fission eventually where there is a desire to hide values from processes the process would not otherwise have access to, i.e., the top-level site (when its referrer policy is ""no-referrer""). We don't have to tackle that now, but that would also impact this key and not having it impact FPI in addition would probably make that easier.
Then in discussions we've considered adding even more keying for non-storage state, though that would likely require another attribute whichever way we go.",SOLUTION_REVIEW,1,FULL_TOKEN
1640135,3,"Created attachment 9153591
Bug 1640135 - P1: add new attribute for dFPI;",UNCODED,0,UNMATCHED
1640135,4,"Created attachment 9153592
Bug 1640135 - P2: add new setter;
Depends on D77914",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1640135,5,"Created attachment 9153593
Bug 1640135 - P3: implement new setter;
Depends on D77915",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1640135,6,"Created attachment 9153594
Bug 1640135 - P4: update usage of PartitionKey;
Depends on D77916",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1640135,7,"Created attachment 9153595
Bug 1640135 - P5: update tests;
Depends on D77917",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1640135,8,"Pushed by xeonchen@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/42f2bdd06a95
P1: add new attribute for dFPI; r=timhuang
https://hg.mozilla.org/integration/autoland/rev/9a58e5805c83
P2: add new setter; r=timhuang
https://hg.mozilla.org/integration/autoland/rev/bd311336daa7
P3: implement new setter; r=timhuang
https://hg.mozilla.org/integration/autoland/rev/64399b8f0d7c
P4: update usage of PartitionKey; r=timhuang
https://hg.mozilla.org/integration/autoland/rev/f318f0c9b8f3
P5: update tests; r=timhuang",UNCODED,0,UNMATCHED
1640135,9,"https://hg.mozilla.org/mozilla-central/rev/42f2bdd06a95
https://hg.mozilla.org/mozilla-central/rev/9a58e5805c83
https://hg.mozilla.org/mozilla-central/rev/bd311336daa7
https://hg.mozilla.org/mozilla-central/rev/64399b8f0d7c
https://hg.mozilla.org/mozilla-central/rev/f318f0c9b8f3",UNCODED,0,UNMATCHED
1651332,2,"Created attachment 9162115
Bug 1651332. Create a pref to gate the new scrollbar code on. r?kats
I could have use apz.allow_zooming but using a separate pref means we can flip the pref to check if the new scrollbar code is the source of a regression. Also I haven't tested the code on Fenix at all, so we can disable it there for now.",CODE_IMPLEMENTATION,1,FULL_TEXT
1651332,3,"Created attachment 9162116
Bug 1651332. Update scrollbar attrs to use visual viewport offset. r?kats
Depends on D82684",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1651332,4,"Created attachment 9162117
Bug 1651332. Update how the compositor adjust scroll thumbs. r?kats
Now that layout places the scroll thumbs at the visual viewport offset instead of the layout scroll position we need to update how the compositor adjusts them.
Depends on D82685",CODE_IMPLEMENTATION,1,FULL_TOKEN
1651332,5,"Created attachment 9162118
Bug 1651332. Update scrollbar position when the visual viewport offset changes. r?kats
The scrollbar is now positioned using the visual viewport offset, so we need to update when that changes.
Depends on D82686",CODE_IMPLEMENTATION,1,FULL_TOKEN
1651332,6,"Created attachment 9162119
Bug 1651332. Use purely relative scroll offset updates for many scrollbar initiated scrolls. r?kats
We already have relative updates (they use a base offset and compute the difference from that to get the offset to apply) but they only seem to know about layout scroll positions. Ideally these two would be merged.
We need to communicate with apz to do the scroll because we need to update the visual viewport offset (apz is in charge of that), and usually we need to smooth scroll to the new offset.
Depends on D82687",CODE_IMPLEMENTATION,1,FULL_TOKEN
1651332,7,I'm having trouble making sense of that last patch. Can you provide more context in this bug as to what kind of problem that patch is solving? In general it's also good to link this bug to the other ones (presumably 1639450 and 1642500) that this work supports and describe what kind of problems this bug is solving or how these patches help those bugs.,QUESTION,0,FULL_TEXT
1651332,8,"Right sorry. I'll explain a little here and then update the commit message with some more details.
The last patch is basically to make clicking in the scrollbar track outside of the scrollthumb ""work"", so it's pretty close to bug 1639450. Clicking in the scrollbar track usually does a page scroll via nsSliderFrame::PageScroll. This eventually ends up in ScrollFrameHelper::ScrollBy where turn the request from a relative one (""scroll by a page"") into an absolute one (""scroll to this position"").
This page scroll is typically a smooth scroll and is currently done on the main thread/layout side. Once we start scrolling the visual viewport offset with the scrollbars we can no longer do this purely on the layout side, we at least need the help of the compositor side. I think the simplest way to do this is to hand the scroll request off to the compositor and have it handle the whole thing.
Now we need to consider the following situation: user clicks scrollbar track to page scroll, smooth scroll gets partway complete on the compositor, user clicks again on scrollbar track for a further page scroll. The main thread can't send an absolute scroll offset update request to the compositor at this point because it has outdated information (it needs a 'starting position' to add the page scroll offset amount) so it'll end up scrolling to the wrong place. It has to send a relative scroll offset update.
We already have a mechanism to send relative scroll offset updates. It is implemented by sending a base scroll offset and the desired scroll offset, and then on the compositor send the difference between those two is computed and then added to the scroll offset.
I used a new mechanism (so called ""pure relative"") that just sends a relative offset update without any absolute scroll positions. The reason I did this is because the existing relative scroll offset update mechanism is not aware of visual viewport offsets, but rather only layout scroll position. For example, here
https://searchfox.org/mozilla-central/rev/8d55e18875b89cdf2a22a7cba60dc40999c18356/layout/generic/nsGfxScrollFrame.h#446
the value we use for the base scroll offset (mApzScrollPos) is set to the layout scroll position. It may be entirely reasonable to make this existing mechanism vv offset aware, but I wanted to implement something to get it working with a smaller chance of regressions to things that already exist and work. We could unify these two mechanisms either before or after landing this bug by either: 1) making the existing relative scroll update mechanism work with vv offsets and using it for this bug, 2) moving the existing relative scroll offset updates consumers to the new ""pure relative"" way.
2) assumes that there isn't a good reason to encode relative scroll offset updates as the difference between two scroll positions that I missed. 
So there are a couple of open questions there. Is a purely relative scroll offset update a good idea? Should we move to the pure relative way? Or to the existing difference between absolute scroll offsets way? And how much of that work is what we want to do right now vs follow ups.",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1651332,9,"Sorry for the delay, was on PTO Friday and AFK for most of the weekend.
Thanks, the explanation makes sense and helps a lot!
In the long term I think we'll want to handle this on the APZ side, the way we do scrollthumb dragging. But that might be a bit complicated so for the short term doing it on the main thread seems like a reasonable option. And we might need the main-thread mechanism even in the long term as a fallback if there are cases we can't handle in the compositor.
Seems reasonable, yes.
The existing mechanism for sending smooth scrolls to the compositor lives in [`ScrollFrameHelper::ApzSmoothScrollTo`](https://searchfox.org/mozilla-central/rev/af5cff556a9482d7aa2267a82f2ccfaf18e797e9/layout/generic/nsGfxScrollFrame.cpp#7280) and involves setting `mApzSmoothScrollDestination` to the scroll position at the end of the smooth scroll. Currently that is (I believe) a layout viewport position, and only ever used for deduplicating smooth scroll requests, but in theory it should be possible to have it be a visual viewport position, and then use it as a ""base"" for computing a new destination in the case of multiple consecutive page scrolls. I'm not saying we *should* do this, since I'm not sure offhand if the complexity/error-prone-ness of this approach will be more or less than what you have now. But I just wanted to mention it as a possible alternative solution.
Ok. Seems like we have a lot of different options here for future consolidation :) One thing I just thought of that we might want to do regardless of which option we do is introduce a new type so that we can distinguish between layout-viewport scroll offsets (e.g. mApzScrollPos) and visual-viewport scroll offsets. That might make things a little less error-prone, and might have saved you some time during your investigations.
I don't think there is. At least, I just looked at all the places `FrameMetrics::mBaseScrollOffset` gets used and it seems to always be in combination with either `FrameMetrics::mScrollOffset` or `FrameMetrics::mSmoothScrollOffset`. So in theory we could just have `mScrollOffset` or `mSmoothScrollOffset` hold the ""pure relative"" value and use the `mIsRelative` flag to know that it's a relative value rather than an absolute value.
Yeah, I don't know the answers here, but if you have a working solution now I'm inclined to get that landed first. Then we should add a test or two to cover the situation these patches fix, and then look at followups that improve the code structure without regressing the tests.",SOLUTION_REVIEW,1,90_PCT_MATCH
1651332,10,"Oh, maybe I was wrong. There's the use at https://searchfox.org/mozilla-central/rev/af5cff556a9482d7aa2267a82f2ccfaf18e797e9/gfx/layers/FrameMetrics.h#268 which I think can't be supported if we just have a pure relative offset in the metrics.",SOLUTION_REVIEW,1,FULL_TEXT
1651332,11,"Hmm, that seems broken because mBaseScrollOffset is always layout scroll position but mScrollOffset is vv offset.
So if we need to support this we can keep sending a base scroll offset for this purpose only.",CLARIFICATION,0,FULL_TOKEN
1651332,12,"After updating my tree and testing with the new patches the smooth scroll animation sometimes stops on the first frame because it hits this line 
https://searchfox.org/mozilla-central/rev/1b95a0179507a4dc7d4b0c94c2df420dc1a72885/gfx/layers/apz/src/AsyncPanZoomController.cpp#725
looking into why that is.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1651332,13,"The problem seems to be webrender specific: when starting an APZ animation we will get sample times that have large non-monotonic  jumps in them regularly:
0x13db6f000 AsyncPanZoomController::StartAnimation mLastSampleTime 13.079496
0x13db6f000 AsyncPanZoomController::UpdateAnimation mLastSampleTime 11.261767
0x13db6f000 AsyncPanZoomController::UpdateAnimation mLastSampleTime 13.096266
mLastSampleTime comes from two different sources, either GetFrameTime() or WebRenderBridgeParent::SetAPZSampleTime. The WebRenderBridgeParent::SetAPZSampleTime ones seem to be the problem.
This causes us to scroll to the right place but instantly instead of smoothly when it happens. This clearly does not seem like an issue with these patches but it would be good to resolve it before landing because otherwise these patches would regress the smooth scrolling for any users with webrender and zooming turned on (it happens even if you never pinch zoom though).",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1651332,14,Filed bug 1653796 for that issue.,NEW_ISSUE_FILING,0,FULL_TEXT
1651332,15,"Pushed by tnikkel@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d71765b6908f
Create a pref to gate the new scrollbar code on. r=kats
https://hg.mozilla.org/integration/autoland/rev/c99841ff8519
Update scrollbar attrs to use visual viewport offset. r=kats
https://hg.mozilla.org/integration/autoland/rev/251aa3acc01f
Update how the compositor adjust scroll thumbs. r=kats
https://hg.mozilla.org/integration/autoland/rev/8309d62060f0
Update scrollbar position when the visual viewport offset changes. r=kats
https://hg.mozilla.org/integration/autoland/rev/138e7b575614
Use purely relative scroll offset updates for many scrollbar initiated scrolls. r=kats",UNCODED,0,UNMATCHED
1651332,16,"https://hg.mozilla.org/mozilla-central/rev/d71765b6908f
https://hg.mozilla.org/mozilla-central/rev/c99841ff8519
https://hg.mozilla.org/mozilla-central/rev/251aa3acc01f
https://hg.mozilla.org/mozilla-central/rev/8309d62060f0
https://hg.mozilla.org/mozilla-central/rev/138e7b575614",UNCODED,0,UNMATCHED
1651332,17,"How should this interact with `general.smoothScroll`? I have it disabled, but now I get the smooth scrolling effect when e.g. pressing the arrow keys. Is that intentional?
On a related note, page down sometimes scrolls immediately on the first press, then the animation works on the following ones. Maybe it figures it's running behind and skips the animation.",QUESTION,0,FULL_TOKEN
1651332,18,"Hmm, interesting, I'll look into this.
That's bug 1653796.",ANSWER_TO_QUESTION,0,FULL_TEXT
1651593,1,"The return value of `db::GetKnownBodyIds()` is not checked at https://searchfox.org/mozilla-central/rev/85ae3b91/dom/cache/Manager.cpp#136.
This function executes SQL and thus is not infallible. Is there any reason to skip the check?",PROBLEM_DESCRIPTION,0,80_PCT_MATCH
1651593,2,Thanks for catching this! I don't think there is a good reason to skip the check. I will submit a patch for that.,PROBLEM_REVIEW,0,FULL_TEXT
1651593,3,"Created attachment 9162410
Bug 1651593 - Check the return value of db::GetKnownBodyIds();",UNCODED,0,UNMATCHED
1651593,4,"Pushed by ttung@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/fa56a323d153
Check the return value of db::GetKnownBodyIds(); r=dom-workers-and-storage-reviewers,sg",UNCODED,0,UNMATCHED
1651593,5,https://hg.mozilla.org/mozilla-central/rev/fa56a323d153,UNCODED,0,UNMATCHED
1654383,1,"The CDM headers have a definition of encryption scheme[0] we can use rather than re-implementing our own type[1]. Historically we've used our own types, but in this case we're just adding an extra conversion step.
If we ever need more flexibility we can add back in our own type, but for now this allows us to cut some code.
[0] https://searchfox.org/mozilla-central/rev/3b6958c26049c1e27b2790a43154caaba9f6dd4a/dom/media/gmp/widevine-adapter/content_decryption_module.h#101
[1] https://searchfox.org/mozilla-central/rev/3b6958c26049c1e27b2790a43154caaba9f6dd4a/dom/media/gmp/gmp-api/gmp-video-codec.h#222",PROBLEM_MOTIVATION,0,FULL_TOKEN
1654383,2,"Created attachment 9165208
Bug 1654383 - Replace GMPEncryptionType with cdm::EncryptionScheme. r?alwu,dminor
This removes the need to do some conversions and simplifies the code a little.
Drive by remove an assert which is already covered by a switch statement
containing a MOZ_ASSERT_UNREACHABLE in ChromiumCDMParent.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1654383,3,"Pushed by bvandyk@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/9cec7707e84d
Replace GMPEncryptionType with cdm::EncryptionScheme. r=alwu,dminor",UNCODED,0,UNMATCHED
1654383,4,"Backed out for bustages on GMPTypes.h
Backout link: https://hg.mozilla.org/integration/autoland/rev/65bce61606aad1a5c472c5275e9502c77f5dc878
Log link: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=311176641&repo=autoland&lineNumber=18211",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1654383,5,"Ah, good ole X11 defines [0]. Looks like the problem is we get X11 headers which `#define Status int` and then when we compile the ipdl files we include the CDM headers which have an unscoped enum named Status that gets turned into `enum int : uint32_t` which breaks building the ipdl protocols[1].
We're able to use types from the CDM headers in other ipc[2]. I'm not 100% clear on what exactly is going on with the build. Chromium have updated their headers so the enum causing us problems here no longer exists. Re-pulling the headers may be an easier way to fix this than messing with the build. It certainly is from my perspective.
[0] https://searchfox.org/mozilla-central/source/gfx/src/X11UndefineNone.h
[1] https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/python/mozbuild/mozbuild/frontend/data.py#377
[2] https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/dom/media/gmp/PChromiumCDM.ipdl#9",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1654383,6,"Re-pulling headers may not work, as I see there exist at least one other `Status` enum that continues to exist after the update. I wonder if the #define trampling here but not in the other files is a product of the unified build boundaries. Going to be on PTO shortly, holding NI for when I'm back.",SOLUTION_REVIEW,1,FULL_TOKEN
1654383,7,"Suggestion to self when I return to this is to create a header that contains the CDM header, but ensures Status is undefined. We already do this in GMPUtils [0], we can just shift that into a unified build friendly header so that we can use the CDM symbols without breaking the build in different contexts. Gfx does similarly for X11 [1].
Alternatively we could find what's dragging X11 headers into the unified build and fix that. In some ways that seems more ideal, but I don't know how to quickly do that, and the above seems like a more pragmatic use of time.
[0] https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/dom/media/gmp/GMPMessageUtils.h#13
[1] https://searchfox.org/mozilla-central/rev/c6676771df58c6e0098574bc6b11517acbf264cf/gfx/src/X11Util.h#15",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TOKEN
1654383,8,"There's a r+ patch which didn't land and no activity in this bug for 2 weeks.
:bryce, could you have a look please?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#not_landed.py).",CODE_REVIEW_REQUEST,0,FULL_TOKEN
1654383,9,"Thanks bot. Been on pto, but acking the need to action this.",UNCODED,0,UNMATCHED
1654383,10,"Pushed by bvandyk@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/9ba10704b7e3
Replace GMPEncryptionType with cdm::EncryptionScheme. r=alwu,dminor",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1654383,11,https://hg.mozilla.org/mozilla-central/rev/9ba10704b7e3,UNCODED,0,UNMATCHED
1662097,2,"Created attachment 9173036
Bug 1662097 - QM_TRY/QM_TRY_VAR cleanup functions should have access to tryTempResult; r=#dom-workers-and-storage-reviewers
Depends on D88764",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1662097,3,"Pushed by jvarga@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/94524708719a
QM_TRY/QM_TRY_VAR cleanup functions should have access to tryTempResult; r=dom-workers-and-storage-reviewers,sg",UNCODED,0,UNMATCHED
1662097,4,https://hg.mozilla.org/mozilla-central/rev/94524708719a,UNCODED,0,UNMATCHED
1666607,1,"This issue is hit frequently, marking as a [fuzzblocker](https://firefox-source-docs.mozilla.org/tools/fuzzing/index.html#fuzz-blockers).
Requires a builds with UBSan `enum` enabled (`--enable-fuzzing` & `--enable-address-sanitizer`). 
```
/gecko/gfx/layers/wr/AsyncImagePipelineManager.h:187:21: runtime error: load of value 3840206052, which is not a valid value for type 'VideoInfo::Rotation'
    #0 0x7f1ecfcb7991 in mozilla::layers::AsyncImagePipelineManager::AsyncImagePipeline::Update(mozilla::gfx::RectTyped<mozilla::LayoutDevicePixel, float> const&, mozilla::VideoInfo::Rotation, mozilla::wr::ImageRendering const&, mozilla::wr::MixBlendMode const&) /gecko/gfx/layers/wr/AsyncImagePipelineManager.h:187:21
    #1 0x7f1ecfcb7486 in mozilla::layers::AsyncImagePipelineManager::UpdateAsyncImagePipeline(mozilla::wr::PipelineId const&, mozilla::gfx::RectTyped<mozilla::LayoutDevicePixel, float> const&, mozilla::VideoInfo::Rotation, mozilla::wr::ImageRendering const&, mozilla::wr::MixBlendMode const&) /gecko/gfx/layers/wr/AsyncImagePipelineManager.cpp:198:13
    #2 0x7f1ecfd1873f in mozilla::layers::WebRenderBridgeParent::ProcessWebRenderParentCommands(nsTArray<mozilla::layers::WebRenderParentCommand> const&, mozilla::wr::TransactionBuilder&) /gecko/gfx/layers/wr/WebRenderBridgeParent.cpp:1373:29
    #3 0x7f1ecfd17fe4 in mozilla::layers::WebRenderBridgeParent::ProcessDisplayListData(mozilla::layers::DisplayListData&, mozilla::wr::Epoch, mozilla::TimeStamp const&, bool, bool) /gecko/gfx/layers/wr/WebRenderBridgeParent.cpp:1089:7
    #4 0x7f1ecfd194ef in mozilla::layers::WebRenderBridgeParent::RecvSetDisplayList(mozilla::layers::DisplayListData&&, nsTArray<mozilla::layers::OpDestroy>&&, unsigned long const&, mozilla::layers::BaseTransactionId<mozilla::layers::TransactionIdType> const&, bool const&, mozilla::layers::BaseTransactionId<mozilla::VsyncIdType> const&, mozilla::TimeStamp const&, mozilla::TimeStamp const&, mozilla::TimeStamp const&, nsTString<char> const&, mozilla::TimeStamp const&, nsTArray<mozilla::layers::CompositionPayload>&&) /gecko/gfx/layers/wr/WebRenderBridgeParent.cpp:1142:8
    #5 0x7f1ecec773f4 in mozilla::layers::PWebRenderBridgeParent::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PWebRenderBridgeParent.cpp:395:28
    #6 0x7f1ece473bc8 in mozilla::layers::PCompositorManagerParent::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PCompositorManagerParent.cpp:197:32
    #7 0x7f1ece262a4e in mozilla::ipc::MessageChannel::DispatchAsyncMessage(mozilla::ipc::ActorLifecycleProxy*, IPC::Message const&) /gecko/ipc/glue/MessageChannel.cpp:2150:25
    #8 0x7f1ece25ea04 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /gecko/ipc/glue/MessageChannel.cpp:2074:9
    #9 0x7f1ece260808 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /gecko/ipc/glue/MessageChannel.cpp:1922:3
    #10 0x7f1ece2612d8 in mozilla::ipc::MessageChannel::MessageTask::Run() /gecko/ipc/glue/MessageChannel.cpp:1953:13
    #11 0x7f1eccf82f24 in nsThread::ProcessNextEvent(bool, bool*) /gecko/xpcom/threads/nsThread.cpp:1234:14
    #12 0x7f1eccf8d6ac in NS_ProcessNextEvent(nsIThread*, bool) /gecko/xpcom/threads/nsThreadUtils.cpp:513:10
    #13 0x7f1ece26ce52 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /gecko/ipc/glue/MessagePump.cpp:332:5
    #14 0x7f1ece170071 in RunInternal /gecko/ipc/chromium/src/base/message_loop.cc:334:10
    #15 0x7f1ece170071 in RunHandler /gecko/ipc/chromium/src/base/message_loop.cc:327:3
    #16 0x7f1ece170071 in MessageLoop::Run() /gecko/ipc/chromium/src/base/message_loop.cc:309:3
    #17 0x7f1eccf7b9f5 in nsThread::ThreadFunc(void*) /gecko/xpcom/threads/nsThread.cpp:442:10
    #18 0x7f1ee60bf42e in _pt_root /gecko/nsprpub/pr/src/pthreads/ptthread.c:201:5
    #19 0x7f1ee99cc608 in start_thread /build/glibc-YYA7BZ/glibc-2.31/nptl/pthread_create.c:477:8
    #20 0x7f1ee9595102 in clone /build/glibc-YYA7BZ/glibc-2.31/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:95
```",REQUIREMENT,0,90_PCT_MATCH
1666607,2,A Pernosco session is available here: https://pernos.co/debug/0U_kejRQ30UcFbETZZx96w/index.html,UNCODED,0,UNMATCHED
1666607,3,"Tyson says it's hit frequently, and that this number is what it usually is, not random uninitialized memory.
On the assumption a bad value just results in bad drawing and not writing out of bounds anywhere, calling it sec-low.",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1666607,4,"Created attachment 9181894
testcase.html",UNCODED,0,UNMATCHED
1666607,5,"Created attachment 9181895
prefs.js",UNCODED,0,UNMATCHED
1666607,6,"Bugmon Analysis:
Unable to reproduce bug using the following builds:
Removing bugmon keyword as no further action possible.
Please review the bug and re-add the keyword for further analysis.",REPRODUCTION_ATTEMPT,0,80_PCT_MATCH
1666607,8,":jimm, this issue is frequently hit by fuzzers, is there someone available to have a look?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1666607,9,Looks like mRotation is just not initialized. It was added in bug 1653166 by Matt. Matt can you look into this?,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1666607,10,"Created attachment 9193170
Bug 1666607 - Set initial valuye for mRotation. r?jrmuizel
Depends on D99741",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1666607,11,https://hg.mozilla.org/integration/autoland/rev/4ce960f145fc49d5573a062fac57b23bcd4e424f,UNCODED,0,UNMATCHED
1666607,12,https://hg.mozilla.org/mozilla-central/rev/4ce960f145fc,UNCODED,0,UNMATCHED
1677183,1,"See https://gpuweb.github.io/gpuweb/#dom-gpuqueue-copyimagebitmaptotexture
This is required to run the textured-cube WebGPU example.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1677183,2,Related to our ability to flip Y,PROBLEM_REVIEW,0,FULL_TEXT
1677183,3,"Created attachment 9274712
Bug 1677183 - Implement WebGPU's Queue.copyExternalImageToTexture. r=jgilbert",UNCODED,0,UNMATCHED
1677183,4,"Here's what I ended up thinking about CORS:
Only DOM element objects have CORS.
Both DOM element objects and non-DOM objects have ""`origin-clean`"" flags.
In Gecko, we implement `origin-clean` via `isWriteOnly`, where `origin-clean` IFF `!isWriteOnly`.
See 
https://html.spec.whatwg.org/multipage/canvas.html#the-image-argument-is-not-origin-clean for how CORS becomes `origin-clean = false`.
See https://html.spec.whatwg.org/multipage/canvas.html#security-with-canvas-elements for how this propagates.
In particular:
I think we might have some of our CORS checks wrong, but I want to think more about it. But this is unblocked and good to land.",UNCODED,0,UNMATCHED
1677183,5,"Pushed by nsilva@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/4e76508f9136
Implement WebGPU's Queue.copyExternalImageToTexture. r=jgilbert,jimb,emilio",UNCODED,0,UNMATCHED
1677183,6,"Backed out for causing mochitest failures on test_queue_copyExternalImageToTexture.html
[Backout link](https://hg.mozilla.org/integration/autoland/rev/517a737e0698f339102921ef72355949a93d09bb)
[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=testfailed%2Cbusted%2Cexception&revision=4e76508f913665d4ddd038b68f4a9a7476c1cbba&searchStr=webgpu&selectedTaskRun=akzdSad_RjyyIfDIKgm22g.0)
[Failure log 1](https://treeherder.mozilla.org/logviewer?job_id=386645901&repo=autoland&lineNumber=2939) // [Failure log 2](https://treeherder.mozilla.org/logviewer?job_id=386647338&repo=autoland&lineNumber=2163)",IMPLEMENTATION_REVERSION,0,90_PCT_MATCH
1677183,7,"Pushed by nsilva@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/746fbd28a600
Implement WebGPU's Queue.copyExternalImageToTexture. r=jgilbert,jimb,emilio",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1677183,8,https://hg.mozilla.org/mozilla-central/rev/746fbd28a600,UNCODED,0,UNMATCHED
1683093,2,"Created attachment 9193727
Bug 1683093 - Remove MCompare::determineCompareType. r?jandem",UNCODED,0,UNMATCHED
1683093,3,"Created attachment 9193728
Bug 1683093 - Remove Compare_Bitwise. r?jandem
Depends on D100012",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1683093,4,"Created attachment 9193729
Bug 1683093 - Remove Compare_DoubleMaybeCoerce. r?jandem
Depends on D100013",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1683093,5,Technically Compare_Boolean and Compare_StrictString are also unused. Should we look into supporting these cases in CacheIR instead? Or rather just remove them now.,QUESTION,0,FULL_TEXT
1683093,6,"Pushed by evilpies@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/5d416b2096d7
Remove MCompare::determineCompareType. r=jandem
https://hg.mozilla.org/integration/autoland/rev/d7be751c9b43
Remove Compare_Bitwise. r=jandem
https://hg.mozilla.org/integration/autoland/rev/074c9b0a8e77
Remove Compare_DoubleMaybeCoerce. r=jandem",UNCODED,0,UNMATCHED
1683093,7,"https://hg.mozilla.org/mozilla-central/rev/5d416b2096d7
https://hg.mozilla.org/mozilla-central/rev/d7be751c9b43
https://hg.mozilla.org/mozilla-central/rev/074c9b0a8e77",UNCODED,0,UNMATCHED
1686219,1,Currently we store all pre-chunk data as a trailer at the end of the chunk.  This means the offset to this data depends on the size of the chunk.  If we store it at the start then it becomes a constant.  There are a bunch of hardcoded offsets like this defined in HeapAPI.h.  It should also be possible have the compiler generate these for us.,PROBLEM_MOTIVATION,0,FULL_TOKEN
1686219,2,"Created attachment 9197110
Bug 1686219 - Add BitSet::SetAll and ResetAll methods r?heycam
This clears or sets every bit, taking care not to set trailing unused bits at the end of storage.",CODE_IMPLEMENTATION,1,FULL_TEXT
1686219,3,"Created attachment 9197111
Bug 1686219 - Use mozilla::BitSet for the chunk decommit state r?sfink
Previouly this used SpiderMonkey's BitArray, but that's not public.  BitSet performs the same function.
Depends on D101775",CODE_IMPLEMENTATION,1,FULL_TOKEN
1686219,4,"Created attachment 9197113
Bug 1686219 - Store chunk information at the start rather than the end of the chunk r?sfink
This moves the chunk metadata to the start of the chunk and defines the data structures in the public header.  This simplifies accessing this data and removes the need for hardcoded offsets.
Requesting review from jandem for JIT updates.
Depends on D101776",CODE_IMPLEMENTATION,1,FULL_TOKEN
1686219,5,"Pushed by jcoppeard@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/cc7e6feeb95a
Add BitSet::SetAll and ResetAll methods r=heycam
https://hg.mozilla.org/integration/autoland/rev/496d47ff3fa1
Use mozilla::BitSet for the chunk decommit state r=sfink
https://hg.mozilla.org/integration/autoland/rev/43978ebfc7ac
Store chunk information at the start rather than the end of the chunk r=sfink",UNCODED,0,UNMATCHED
1686219,6,"https://hg.mozilla.org/mozilla-central/rev/cc7e6feeb95a
https://hg.mozilla.org/mozilla-central/rev/496d47ff3fa1
https://hg.mozilla.org/mozilla-central/rev/43978ebfc7ac",UNCODED,0,UNMATCHED
1686238,1,"[Tracking Requested - why for this release]:
Central-as-beta simulation : 
https://treeherder.mozilla.org/jobs?repo=try&selectedTaskRun=fYmHIR_OTAe2Qfdp4CvXmg.0&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel&classifiedState=classified&revision=995b9253ec9cb21c1908c737f1b50878b1b01c8b&searchStr=bc
Failure log: 
https://treeherder.mozilla.org/logviewer?job_id=326457278&repo=try&lineNumber=1589",UNCODED,0,UNMATCHED
1686238,2,"Changing the priority to p2 as the bug is tracked by a release manager for the current nightly.
See [What Do You Triage](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html) for more information",ISSUE_METADATA_CHANGE,0,90_PCT_MATCH
1686238,3,"1 failures in 3810 pushes (0.0 failures/push) were associated with this bug in the last 7 days.
Repository breakdown:
* try: 1
Platform breakdown:
* macosx1014-64-devedition-qr: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1686238&startday=2021-01-11&endday=2021-01-17&tree=all",UNCODED,0,UNMATCHED
1686238,4,"Merge day is next Monday, please get the fix for this landed this week (together with bug 1685768).",CODE_UPDATE_REQUEST,0,FULL_TEXT
1686238,5,patch pushed here which should fix 1686164,CODE_IMPLEMENTATION,1,FULL_TEXT
1686238,6,"This bug and bug 1685768 are still observed with [today's central-as-beta simulations](https://treeherder.mozilla.org/logviewer?job_id=327479966&repo=try). What's the plan forward to resolve them and when (merge to beta on Monday, test only fixes?)?",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1686238,7,"Created attachment 9198734
Bug 1686238: Only attempt to traverse containers menu if containers are enabled and defined r?yzen",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1686238,8,The issue affects both devedition and beta. Beta example: https://treeherder.mozilla.org/jobs?repo=try&revision=87bdd775f40f00139a5f19a998293964b5280b5e&selectedTaskRun=LXjVf98IS3CAJrWwEwQA8w.0,ISSUE_IMPACT,0,FULL_TEXT
1686238,9,https://treeherder.mozilla.org/#/jobs?repo=try&revision=5cf727e00f44a4933d9fd8f4fb17511eccfbc1c6,UNCODED,0,UNMATCHED
1686238,10,"Pushed by mreschenberg@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/767c22222bec
Only attempt to traverse containers menu if containers are enabled and defined r=yzen",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1686238,11,https://hg.mozilla.org/mozilla-central/rev/767c22222bec,UNCODED,0,UNMATCHED
1686238,12,Verified fixed with [yesterday's central-as-beta simulation](https://treeherder.mozilla.org/jobs?repo=try&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&revision=fe7cbb5789684e42697b12664236e929e2995aec).,UNCODED,0,UNMATCHED
1688325,1,"+++ This bug was initially created as a clone of Bug #1686606 +++
STR:
1. Run Firefox with about:config `widget.disable-native-theme-for-content` set to `true`.
2. View https://bugzilla.mozilla.org/attachment.cgi?id=9196980
3. Focus the textarea (the lower/taller form control)
ACTUAL RESULTS:
In the textarea, the blinking cursor is flush with (or maybe even overlaps?) the top border.  This makes it look a bit misaligned / overflowing.
For comparison: in the textfield (the first widget), there's a little bit of space between the cursor and the borders, as of today's Nightly (thanks to bug 1686606).
EXPECTED RESULTS:
There should be a little bit of blank padding-area between the blinking cursor and the textarea's border, to visually separate them.",S2R,0,90_PCT_MATCH
1688325,2,"ni=emilio in case he's up for taking a look, since he just landed a fix for related bug 1686606.",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1688325,3,"We don't have any padding on textareas by default. I see the same behavior on other themes. We could certainly add some (Chrome seems to have 2px padding by default). But this doesn't seem like a non-native theme specific thing, unless I'm missing something?",PROBLEM_REVIEW,0,FULL_TEXT
1688325,4,"Hmm -- on Ubuntu and MacOS, I do indeed see that there's no padding by default.
However, on Windows (where most of our users are), there does seem to be 2px of padding, in the default theme on Firefox release. (screenshot coming up).  So we probably don't want to regress that; and given that it seems webcompat-friendly (per Chrome's behavior), maybe we should adopt it as our cross-platform standard behavior in the new non-native theme?",PROBLEM_REVIEW,0,FULL_TOKEN
1688325,5,"Created attachment 9198793
screenshot of rough expected rendering, using textarea on Win10 with Firefox release (v84)",AUTO_ATTACH_SCREENSHOT,0,80_PCT_MATCH
1688325,6,"Created attachment 9198794
screenshot of computed 'padding' properties on Win10 with current Firefox release (for reference)
Here's the default computed 'padding' styles of a `textarea`, in current Firefox on Win10 -- as you can see, it's 2px on all sides.
(On Ubuntu [not shown here], I do see that we have 0px padding on the top and bottom, by default. But on Win10, we seem to use 2px on all sides.)",SCREENSHOT,0,FULL_TOKEN
1688325,7,"Created attachment 9198833
Bug 1688325 - Make textarea default padding 2px on all platforms. r=dholbert
This matches other browsers, and the default themed textareas on Windows
too.
To be landed after the soft freeze, just in case, of course.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1688325,8,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/64682b454ac6
Make textarea default padding 2px on all platforms. r=dholbert",UNCODED,0,UNMATCHED
1688325,9,"Backed out for causing failures on browser_inplace-editor_maxwidth.js.
Backout link: https://hg.mozilla.org/integration/autoland/rev/31462a8e07406103e8d97b19faf9af3bd63530b6
Push with failures: https://treeherder.mozilla.org/jobs?repo=autoland&selectedTaskRun=E9eyDlOnQi6c4aq97GSfGw.0&revision=64682b454ac62a9ad7bccedd3efce40e1dab29ae&searchStr=dt
Failure log: https://treeherder.mozilla.org/logviewer?job_id=327674911&repo=autoland&lineNumber=4367",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1688325,10,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/f2cef92ec339
Make textarea default padding 2px on all platforms. r=dholbert,jdescottes",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1688325,11,https://hg.mozilla.org/mozilla-central/rev/f2cef92ec339,UNCODED,0,UNMATCHED
1705253,1,"This test has a part where it expects AXMenuOpened events for context menus, which are not observable for us when native context menus are used.
It also has a part where it inspects the accessibility-exposed contents of a context menu. This is not testable with native context menus either, so that part of the test needs to be disabled.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1705253,2,"Created attachment 9215943
Bug 1705253 - Partially disable accessible/tests/browser/mac/browser_app.js when native context menus are used. r=Jamie
This test has a part where it expects AXMenuOpened events for context menus, which are not observable for us when native context menus are used.
It also has a part where it inspects the accessibility-exposed contents of a context menu. This is not testable with native context menus either, so that part of the test needs to be disabled.",PROBLEM_DESCRIPTION,0,FULL_TEXT
1705253,3,"Pushed by mstange@themasta.com:
https://hg.mozilla.org/integration/autoland/rev/6ac255a315ca
Partially disable accessible/tests/browser/mac/browser_app.js when native context menus are used. r=morgan",UNCODED,0,UNMATCHED
1705253,4,https://hg.mozilla.org/mozilla-central/rev/6ac255a315ca,UNCODED,0,UNMATCHED
1705768,2,"Created attachment 9216447
Bug 1705768 - Update dom/ipc/tests/JSWindowActor/browser_contentWindow.js to pass with Fission+BFCache, r=kmag
Depends on D111403",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1705768,3,"Pushed by opettay@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/5ec8c0e30942
Update dom/ipc/tests/JSWindowActor/browser_contentWindow.js to pass with Fission+BFCache, r=kmag",UNCODED,0,UNMATCHED
1705768,4,https://hg.mozilla.org/mozilla-central/rev/5ec8c0e30942,UNCODED,0,UNMATCHED
1706916,2,"Created attachment 9217672
Bug 1706916 - Land some in-tree docs for TRR r=#necko,nhnt11",PROBLEM_DESCRIPTION,0,FULL_TEXT
1706916,3,"Pushed by valentin.gosu@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/673e7a764fae
Land some in-tree docs for TRR r=nhnt11",UNCODED,0,UNMATCHED
1706916,4,https://hg.mozilla.org/mozilla-central/rev/673e7a764fae,UNCODED,0,UNMATCHED
1716655,1,"Created attachment 9227277
testcase.html
Found while fuzzing m-c 20210613-f531f12e5c35 (--enable-address-sanitizer --enable-fuzzing)
```
==11910==ERROR: AddressSanitizer: SEGV on unknown address 0x0000000001e0 (pc 0x7f7f4cbe25db bp 0x7fff398888b0 sp 0x7fff398888b0 T0)
==11910==The signal is caused by a READ memory access.
==11910==Hint: address points to the zero page.
    #0 0x7f7f4cbe25db in mozilla::dom::Document::GetRootElement() const /gecko/dom/base/Document.cpp:6928:11
    #1 0x7f7f517abfac in nsPresContext::Init(nsDeviceContext*) /gecko/layout/base/nsPresContext.cpp:646:30
    #2 0x7f7f5173a121 in nsDocumentViewer::SetPrintSettingsForSubdocument(nsIPrintSettings*) /gecko/layout/base/nsDocumentViewer.cpp:3526:24
    #3 0x7f7f5088434f in mozilla::dom::BrowserChild::RecvCloneDocumentTreeIntoSelf(mozilla::dom::MaybeDiscarded<mozilla::dom::BrowsingContext> const&, mozilla::embedding::PrintData const&) /gecko/dom/ipc/BrowserChild.cpp:1096:12
    #4 0x7f7f4b55dbee in mozilla::dom::PBrowserChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PBrowserChild.cpp:4135:56
    #5 0x7f7f4abd23cb in mozilla::dom::PContentChild::OnMessageReceived(IPC::Message const&) /builds/worker/workspace/obj-build/ipc/ipdl/PContentChild.cpp:8322:32
    #6 0x7f7f4a94541a in mozilla::ipc::MessageChannel::DispatchAsyncMessage(mozilla::ipc::ActorLifecycleProxy*, IPC::Message const&) /gecko/ipc/glue/MessageChannel.cpp:2155:25
    #7 0x7f7f4a941b48 in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message&&) /gecko/ipc/glue/MessageChannel.cpp:2079:9
    #8 0x7f7f4a9434a5 in mozilla::ipc::MessageChannel::RunMessage(mozilla::ipc::MessageChannel::MessageTask&) /gecko/ipc/glue/MessageChannel.cpp:1924:3
    #9 0x7f7f4a94400b in mozilla::ipc::MessageChannel::MessageTask::Run() /gecko/ipc/glue/MessageChannel.cpp:1955:13
    #10 0x7f7f49769592 in mozilla::RunnableTask::Run() /gecko/xpcom/threads/TaskController.cpp:479:16
    #11 0x7f7f49736200 in mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /gecko/xpcom/threads/TaskController.cpp:782:26
    #12 0x7f7f49733a48 in mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) /gecko/xpcom/threads/TaskController.cpp:618:15
    #13 0x7f7f4973415d in mozilla::TaskController::ProcessPendingMTTask(bool) /gecko/xpcom/threads/TaskController.cpp:402:36
    #14 0x7f7f49773604 in operator() /gecko/xpcom/threads/TaskController.cpp:138:37
    #15 0x7f7f49773604 in mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_1>::Run() /gecko/xpcom/threads/nsThreadUtils.h:534:5
    #16 0x7f7f49750978 in nsThread::ProcessNextEvent(bool, bool*) /gecko/xpcom/threads/nsThread.cpp:1159:16
    #17 0x7f7f4975b6bc in NS_ProcessNextEvent(nsIThread*, bool) /gecko/xpcom/threads/nsThreadUtils.cpp:548:10
    #18 0x7f7f4a94cb94 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /gecko/ipc/glue/MessagePump.cpp:107:5
    #19 0x7f7f4a854031 in RunInternal /gecko/ipc/chromium/src/base/message_loop.cc:335:10
    #20 0x7f7f4a854031 in RunHandler /gecko/ipc/chromium/src/base/message_loop.cc:328:3
    #21 0x7f7f4a854031 in MessageLoop::Run() /gecko/ipc/chromium/src/base/message_loop.cc:310:3
    #22 0x7f7f51111037 in nsBaseAppShell::Run() /gecko/widget/nsBaseAppShell.cpp:137:27
    #23 0x7f7f5537e6af in XRE_RunAppShell() /gecko/toolkit/xre/nsEmbedFunctions.cpp:910:20
    #24 0x7f7f4a854031 in RunInternal /gecko/ipc/chromium/src/base/message_loop.cc:335:10
    #25 0x7f7f4a854031 in RunHandler /gecko/ipc/chromium/src/base/message_loop.cc:328:3
    #26 0x7f7f4a854031 in MessageLoop::Run() /gecko/ipc/chromium/src/base/message_loop.cc:310:3
    #27 0x7f7f5537e088 in XRE_InitChildProcess(int, char**, XREChildData const*) /gecko/toolkit/xre/nsEmbedFunctions.cpp:742:34
    #28 0x5557196cf74d in content_process_main(mozilla::Bootstrap*, int, char**) /gecko/browser/app/../../ipc/contentproc/plugin-container.cpp:57:28
    #29 0x5557196cfb7d in main /gecko/browser/app/nsBrowserApp.cpp:313:18
    #30 0x7f7f6b16f0b2 in __libc_start_main /build/glibc-eX1tMB/glibc-2.31/csu/../csu/libc-start.c:308:16
    #31 0x555719620a49 in _start (/home/worker/builds/m-c-20210613214113-fuzzing-asan-opt/firefox+0x5ba49)
```",STACK_TRACE,0,FULL_TOKEN
1716655,2,A Pernosco session is available here: https://pernos.co/debug/vBAj1QMOyaoDIb3C7G77VA/index.html,UNCODED,0,UNMATCHED
1716655,3,"**Bugmon Analysis**
Unable to reproduce bug using build mozilla-central 20210613214113-f531f12e5c35.  Without a baseline, bugmon is unable to analyze this bug.
Removing bugmon keyword as no further action possible.  Please review the bug and re-add the keyword for further analysis.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1716655,4,"Hi Emilio, the test is about print preview, so I bring it to your radar.",CLARIFICATION,0,FULL_TEXT
1716655,5,"Created attachment 9239771
Bug 1716655 - Prevent creating print presentation for a destroyed content viewer. r=nika
nsDocumentViewer::mDocument ends up null because Destroy() is called
as a result of nsGlobalWindowOuter::SetNewDocument failing because of
the AncestorsAreCurrent check:
    https://searchfox.org/mozilla-central/rev/d6188c9ce02efeea309e7177fc14c9eb2f09db37/dom/base/Document.cpp#13026-13030
    https://searchfox.org/mozilla-central/rev/d6188c9ce02efeea309e7177fc14c9eb2f09db37/layout/base/nsDocumentViewer.cpp#1888
    https://searchfox.org/mozilla-central/rev/d6188c9ce02efeea309e7177fc14c9eb2f09db37/dom/base/nsGlobalWindowOuter.cpp#2089-2091
Just bail out if we don't have a document when creating the print
presentation, as that presentation won't be shown either way.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1716655,6,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d6edefc4bd97
Prevent creating print presentation for a destroyed content viewer. r=nika",UNCODED,0,UNMATCHED
1716655,7,https://hg.mozilla.org/mozilla-central/rev/d6edefc4bd97,UNCODED,0,UNMATCHED
1716655,8,":emilio, since this bug contains a bisection range, could you fill (if possible) the regressed_by field?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#fuzzing_bisection_without_regressed_by.py).",QUESTION,0,FULL_TOKEN
1718748,1,"Created attachment 9229412
Peek 2021-06-30 13-34.gif
**Affected versions:**
- Nightly 91.0a1
**Affected platforms:**
- Ubuntu 20.04.2 LTS
**Unaffected platforms:**
- Windows 10x64
- macOs 10.15
**Steps to reproduce:**
1. Launch Firefox.
2. Go to Customize toolbar (Hamburger menu   More tools  Customize toolbar).
3. On the lower part of the page click on the  Themes button and select Dark theme from the list.
**Expected result:**
All customization footer buttons are clearly visible.
**Actual result:**
Customization footer buttons  are not visible until you hover over them.
**Regression range:**
This is a regression: 
- pushlog: https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=152fdda295bb5f6658d65c2bc48bc6aae499b526&tochange=b873d938120e2cfac6ba3332c663b503dc45d17e
- possible regressor: Bug 1717077
**Additional notes**
Screen cast attached to observe the issue.",S2R,0,90_PCT_MATCH
1718748,2,"Hi Emilio,
It seems that mozregression pointed out Bug 1717077 for causing this regression. 
Can you please take a look?
Thanks!",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1718748,3,Set release status flags based on info from the regressing bug 1717077,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1718748,4,"Created attachment 9229581
Bug 1718748 - Ensure that changing browser.theme.toolbar-theme triggers an style/layout update. r=stransky,mstange
Otherwise nothing invalidates for the potential theme change that it
causes on GTK / macOS with dark-mode enabled.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1718748,5,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/bc079cbb02ff
Ensure that changing browser.theme.toolbar-theme triggers an style/layout update. r=stransky",UNCODED,0,UNMATCHED
1718748,6,https://hg.mozilla.org/mozilla-central/rev/bc079cbb02ff,UNCODED,0,UNMATCHED
1718748,7,"Created attachment 9233304
imgpsh_fullsize_anim.gif
I managed to reproduce the issue using Nightly from 2021-06-30 on Ubuntu 18.04 x64. 
I retested everything on Latest Nightly 92.0a1 and Firefox 91.0b7 using the same os. The issue is not reproducing anymore. However there is a bit of a delay on beta that is not reproducing on Nightly.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1718748,8,That is expected in beta since beta doesn't have the patches here.,CLARIFICATION,0,FULL_TEXT
1718748,9,According to comment 6 and comment 7 I will mark this bug as verified fixed.,UNCODED,0,UNMATCHED
1732739,2,"Created attachment 9264311
Bug 1732739 - Enable session change handling of window occlusion on Windows for nightly and early beta",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1732739,3,"Pushed by sikeda.birchill@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/9625bb4726b1
Enable session change handling of window occlusion on Windows for nightly and early beta r=gfx-reviewers,nical",UNCODED,0,UNMATCHED
1732739,4,https://hg.mozilla.org/mozilla-central/rev/9625bb4726b1,UNCODED,0,UNMATCHED
1733898,1,"`test262-update.py --pull` allows downloading a test262 pull request, but the current implementation doesn't support pagination, which means downloading a large pull request like <https://github.com/tc39/test262/pull/3199> only downloads the first few files instead of all files changed in the pull request.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1733898,2,"Created attachment 9244141
Bug 1733898: Support pagination when downloading a test262 pull request. r=mgaudet!",PROBLEM_DESCRIPTION,0,FULL_TEXT
1733898,3,"Pushed by andre.bargull@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/0f58e89683f2
Support pagination when downloading a test262 pull request. r=mgaudet",UNCODED,0,UNMATCHED
1733898,4,https://hg.mozilla.org/mozilla-central/rev/0f58e89683f2,UNCODED,0,UNMATCHED
1742664,1,"**Filed by:** apavel [at] mozilla.com
**Parsed log:** https://treeherder.mozilla.org/logviewer?job_id=358990343&repo=mozilla-central
**Full log:** https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/Etg6SaGMQk2vBY4JPUh7uA/runs/0/artifacts/public/logs/live_backing.log
---
```
[task 2021-11-23T17:57:03.485Z] 17:57:03     INFO - TEST-START | /paint-timing/replaced-content-image.html
[task 2021-11-23T17:57:03.581Z] 17:57:03     INFO - .
[task 2021-11-23T17:57:03.581Z] 17:57:03     INFO - Closing window 81d42f9f-70ea-47f1-8b29-62481093c3c9
[task 2021-11-23T17:57:04.159Z] 17:57:04     INFO - 
[task 2021-11-23T17:57:04.159Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""false""],[""justifycenter"",""""]] ""<div align=justify><p>[foo<p>bar}</div><p>extra"" queryCommandValue(""justifycenter"") before 
[task 2021-11-23T17:57:04.159Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""false""],[""justifycenter"",""""]] ""<div align=justify><p>[foo<p>bar}</div><p>extra"" queryCommandIndeterm(""justifycenter"") after 
[task 2021-11-23T17:57:04.160Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""false""],[""justifycenter"",""""]] ""<div align=justify><p>[foo<p>bar}</div><p>extra"" queryCommandState(""justifycenter"") after 
[task 2021-11-23T17:57:04.161Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""false""],[""justifycenter"",""""]] ""<div align=justify><p>[foo<p>bar}</div><p>extra"" queryCommandValue(""justifycenter"") after 
[task 2021-11-23T17:57:04.161Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""true""],[""defaultparagraphseparator"",""div""],[""justifycenter"",""""]] ""<div style=text-align:justify><p>[foo]<p>bar</div><p>extra"": execCommand(""stylewithcss"", false, ""true"") return value 
[task 2021-11-23T17:57:04.163Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""true""],[""defaultparagraphseparator"",""div""],[""justifycenter"",""""]] ""<div style=text-align:justify><p>[foo]<p>bar</div><p>extra"": execCommand(""defaultparagraphseparator"", false, ""div"") return value 
[task 2021-11-23T17:57:04.163Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""true""],[""defaultparagraphseparator"",""div""],[""justifycenter"",""""]] ""<div style=text-align:justify><p>[foo]<p>bar</div><p>extra"": execCommand(""justifycenter"", false, """") return value 
[task 2021-11-23T17:57:04.164Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""true""],[""defaultparagraphseparator"",""div""],[""justifycenter"",""""]] ""<div style=text-align:justify><p>[foo]<p>bar</div><p>extra"" checks for modifications to non-editable content 
[task 2021-11-23T17:57:04.166Z] 17:57:04     INFO - TEST-FAIL | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""true""],[""defaultparagraphseparator"",""div""],[""justifycenter"",""""]] ""<div style=text-align:justify><p>[foo]<p>bar</div><p>extra"" compare innerHTML - assert_equals: Unexpected innerHTML (after normalizing inline style) expected ""<div style=\""text-align:justify\""><div style=\""text-align:center\""><p>foo</p></div><p>bar</p></div><p>extra</p>"" but got ""<div style=\""text-align:justify\""><p style=\""text-align:center\"">foo</p><p>bar</p></div><p>extra</p>""
[task 2021-11-23T17:57:04.166Z] 17:57:04     INFO - runConformanceTest/<@http://web-platform.test:8000/editing/include/tests.js:5679:24
[task 2021-11-23T17:57:04.167Z] 17:57:04     INFO - Test.prototype.step@http://web-platform.test:8000/resources/testharness.js:2087:25
[task 2021-11-23T17:57:04.167Z] 17:57:04     INFO - test@http://web-platform.test:8000/resources/testharness.js:557:30
[task 2021-11-23T17:57:04.169Z] 17:57:04     INFO - subsetTest@http://web-platform.test:8000/common/subset-tests.js:54:14
[task 2021-11-23T17:57:04.170Z] 17:57:04     INFO - runConformanceTest@http://web-platform.test:8000/editing/include/tests.js:5667:15
[task 2021-11-23T17:57:04.170Z] 17:57:04     INFO - @http://web-platform.test:8000/editing/run/justifycenter.html?2001-3000:49:18
[task 2021-11-23T17:57:04.170Z] 17:57:04     INFO - @http://web-platform.test:8000/editing/run/justifycenter.html?2001-3000:59:3
[task 2021-11-23T17:57:04.170Z] 17:57:04     INFO - TEST-PASS | /editing/run/justifycenter.html?2001-3000 | [[""stylewithcss"",""true""],[""defaultparagraphseparator"",""div""],[""justifycenter"",""""]] ""<div style=text-align:justify><p>[foo]<p>bar</div><p>extra"" queryCommandIndeterm(""stylewithcss"") before 
[task 2021-11-23T17:57:04.171Z] 17:57:04     INFO - TEST-UNEXPECTED-PASS | /paint-timing/replaced-content-image.html | Replaced content image triggers First Contentful Paint. - expected TIMEOUT
[task 2021-11-23T17:57:04.171Z] 17:57:04     INFO - TEST-INFO | expected TIMEOUT
[task 2021-11-23T17:57:04.172Z] 17:57:04     INFO - TEST-UNEXPECTED-OK | /paint-timing/replaced-content-image.html | expected TIMEOUT
[task 2021-11-23T17:57:04.172Z] 17:57:04     INFO - TEST-INFO expected TIMEOUT | took 743ms
[task 2021-11-23T17:57:04.290Z] 17:57:04     INFO - ........................................................
[task 2021-11-23T17:57:04.291Z] 17:57:04     INFO - TEST-OK | /editing/run/justifycenter.html?2001-3000 | took 6327ms
```",PROBLEM_DESCRIPTION,0,90_PCT_MATCH
1742664,2,"Created attachment 9252168
Bug 1742664 - set paint-timing/replaced-content-image.html as passing. DONTBUILD
The tested behavior got corrected in bug 1742411.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1742664,3,"Pushed by archaeopteryx@coole-files.de:
https://hg.mozilla.org/integration/autoland/rev/3214e3babc2b
set paint-timing/replaced-content-image.html as passing. DONTBUILD",UNCODED,0,UNMATCHED
1742664,4,https://hg.mozilla.org/mozilla-central/rev/3214e3babc2b,UNCODED,0,UNMATCHED
1742664,5,"62 failures in 582 pushes (0.107 failures/push) were associated with this bug yesterday.
Repository breakdown:
* mozilla-central: 62
Platform and build breakdown:
* windows10-32-2004-qr: 2
  * debug: 2
* linux1804-64-qr: 6
  * debug: 6
* android-em-7-0-x86_64-lite-qr: 2
  * debug: 2
* macosx1015-64-qr: 2
  * debug: 2
* linux1804-64-asan-qr: 14
  * opt: 14
* android-em-7-0-x86_64-qr: 4
  * debug: 4
* linux1804-64-tsan-qr: 4
  * opt: 4
* windows10-64-2004-qr: 6
  * debug: 6
* linux1804-64-ccov-qr: 2
  * opt: 2
* windows10-64-2004-shippable-qr: 4
  * opt: 4
* linux1804-32-shippable-qr: 2
  * opt: 2
* windows10-32-2004-shippable-qr: 2
  * opt: 2
* linux1804-64-shippable-qr: 4
  * opt: 4
* macosx1015-64-shippable-qr: 2
  * opt: 2
* android-em-7-0-x86_64-shippable-qr: 2
  * opt: 2
* android-em-7-0-x86_64-shippable-lite-qr: 2
  * opt: 2
* windows10-64-2004-ccov-qr: 2
  * opt: 2
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1742664&startday=2021-11-23&endday=2021-11-23&tree=all",UNCODED,0,UNMATCHED
1742664,6,"62 failures in 2819 pushes (0.022 failures/push) were associated with this bug in the last 7 days.
This is the #14 most frequent failure this week.
** This failure happened more than 30 times this week! Resolving this bug is a high priority. **
** Try to resolve this bug as soon as possible. If unresolved for 2 weeks, the affected test(s) may be disabled. ** 
Repository breakdown:
* mozilla-central: 62
Platform and build breakdown:
* windows10-32-2004-qr: 2
  * debug: 2
* linux1804-64-qr: 6
  * debug: 6
* android-em-7-0-x86_64-lite-qr: 2
  * debug: 2
* macosx1015-64-qr: 2
  * debug: 2
* linux1804-64-asan-qr: 14
  * opt: 14
* android-em-7-0-x86_64-qr: 4
  * debug: 4
* linux1804-64-tsan-qr: 4
  * opt: 4
* windows10-64-2004-qr: 6
  * debug: 6
* linux1804-64-ccov-qr: 2
  * opt: 2
* windows10-64-2004-shippable-qr: 4
  * opt: 4
* linux1804-32-shippable-qr: 2
  * opt: 2
* windows10-32-2004-shippable-qr: 2
  * opt: 2
* linux1804-64-shippable-qr: 4
  * opt: 4
* macosx1015-64-shippable-qr: 2
  * opt: 2
* android-em-7-0-x86_64-shippable-qr: 2
  * opt: 2
* android-em-7-0-x86_64-shippable-lite-qr: 2
  * opt: 2
* windows10-64-2004-ccov-qr: 2
  * opt: 2
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1742664&startday=2021-11-22&endday=2021-11-28&tree=all",UNCODED,0,UNMATCHED
1742770,1,"I've prototyped a new libfuzzer-based fuzzing target that uses dom::ipc::StructuredCloneData as its entry point to cover the StructuredCloneReader code that is browser-only. The target code has not landed on mozilla-central yet, if you need it to reproduce (in case stack + test attached do not suffice), please let me know.
The attached testcase crashes on mozilla-central revision bf638341288e+:
Backtrace:
    ==12538==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x7fc6bd8a6500 bp 0x7ffd8eaabd90 sp 0x7ffd8eaab9e0 T0)
    ==12538==The signal is caused by a WRITE memory access.
    ==12538==Hint: address points to the zero page.
        #0 0x7fc6bd8a6500 in mozilla::NullPrincipal::CreateInternal(mozilla::OriginAttributes const&, bool, nsIURI*, nsIPrincipal*) caps/NullPrincipal.cpp:134:3
        #1 0x7fc6bd8a7175 in mozilla::NullPrincipal::Create(mozilla::OriginAttributes const&, nsIURI*) caps/NullPrincipal.cpp:71:10
        #2 0x7fc6bc047b82 in mozilla::ipc::PrincipalInfoToPrincipal(mozilla::ipc::PrincipalInfo const&) ipc/glue/BackgroundUtils.cpp:75:19
        #3 0x7fc6bd8b09b5 in nsJSPrincipals::ReadKnownPrincipalType(JSContext*, JSStructuredCloneReader*, unsigned int, JSPrincipals**) caps/nsJSPrincipals.cpp:318:25
        #4 0x7fc6bf3d1470 in mozilla::dom::StructuredCloneHolder::ReadFullySerializableObjects(JSContext*, JSStructuredCloneReader*, unsigned int) dom/base/StructuredCloneHolder.cpp:437:10
        #5 0x7fc6bf3d4bab in mozilla::dom::StructuredCloneHolder::CustomReadHandler(JSContext*, JSStructuredCloneReader*, JS::CloneDataPolicy const&, unsigned int, unsigned int) dom/base/StructuredCloneHolder.cpp:1008:10
        #6 0x7fc6cd76aead in JSStructuredCloneReader::startRead(JS::MutableHandle<JS::Value>, js::gc::InitialHeap) js/src/vm/StructuredClone.cpp:2815:11
        #7 0x7fc6cd74a4fb in JSStructuredCloneReader::read(JS::MutableHandle<JS::Value>, unsigned long) js/src/vm/StructuredClone.cpp:3227:8
        #8 0x7fc6cd749cf2 in ReadStructuredClone(JSContext*, JSStructuredCloneData const&, JS::StructuredCloneScope, JS::MutableHandle<JS::Value>, JS::CloneDataPolicy const&, JSStructuredCloneCallbacks const*, void*) js/src/vm/StructuredClone.cpp:698:12
        #9 0x7fc6cd775927 in JS_ReadStructuredClone(JSContext*, JSStructuredCloneData const&, unsigned int, JS::StructuredCloneScope, JS::MutableHandle<JS::Value>, JS::CloneDataPolicy const&, JSStructuredCloneCallbacks const*, void*) js/src/vm/StructuredClone.cpp:3383:10
        #10 0x7fc6bf3d116e in mozilla::dom::StructuredCloneHolder::ReadFromBuffer(nsIGlobalObject*, JSContext*, JSStructuredCloneData&, unsigned int, JS::MutableHandle<JS::Value>, JS::CloneDataPolicy const&, mozilla::ErrorResult&) dom/base/StructuredCloneHolder.cpp:409:8
        #11 0x7fc6bf3d1074 in mozilla::dom::StructuredCloneHolder::ReadFromBuffer(nsIGlobalObject*, JSContext*, JSStructuredCloneData&, JS::MutableHandle<JS::Value>, JS::CloneDataPolicy const&, mozilla::ErrorResult&) dom/base/StructuredCloneHolder.cpp:395:3
        #12 0x7fc6c650454c in mozilla::dom::ipc::StructuredCloneData::Read(JSContext*, JS::MutableHandle<JS::Value>, JS::CloneDataPolicy const&, mozilla::ErrorResult&) dom/ipc/StructuredCloneData.cpp:116:3
        #13 0x7fc6c64f570c in mozilla::dom::ipc::StructuredCloneData::Read(JSContext*, JS::MutableHandle<JS::Value>, mozilla::ErrorResult&) dom/ipc/StructuredCloneData.cpp:104:3
        #14 0x7fc6b80c0dec in FuzzingRunDomSC(unsigned char const*, unsigned long) dom/base/fuzztest/FuzzStructuredClone.cpp:59:10
        [...]
This is a release assert. Can we handle this case instead to make this fuzzer work? It has found a few bugs already it would be great to be able to run this on a regular basis. Marking s-s because the toplevel effort is s-s for now.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1742770,2,"Created attachment 9252266
Detailed Crash Information",UNCODED,0,UNMATCHED
1742770,3,"Created attachment 9252267
Testcase",UNCODED,0,UNMATCHED
1742770,4,"Nika, should we validate and handle this error in the `PrincipalInfo::TNullPrincipalInfo` case in `mozilla::ipc::PrincipalInfoToPrincipal` instead? I can try to come up with a patch.",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1742770,5,"That's a great idea! Thanks for doing this, I imagine we'll find some useful bugs.
Yeah, we should definitely validate that we're getting a valid `moz-nullprincipal:` URI when deserializing a null principal from `PrincipalInfoToPrincipal`. It'd be nice if we could validate more than just the `moz-nullprincipal` scheme as well, though I suppose that'll be more work.
Every valid `moz-nullprincipal` URI is currently created in `NullPrincipal::CreateURI` and so follows the pattern of `moz-nullprincipal:{uuidhere-edae-4733-9a29-99abcace2a48}` with an optional `?https://precursor.spec` query at the end. 
that being said, it occurs to me that we might want to include more validation in general when serializing & deserializing URIs, as right now the process might have some validation holes (potentially which this process will help us find!)",SOLUTION_REVIEW,1,FULL_TOKEN
1742770,6,"Created attachment 9252371
Bug 1742770 - Properly validate URI for null principals. r?nika",UNCODED,0,UNMATCHED
1742770,7,"Properly validate URI for null principals. r=nika
https://hg.mozilla.org/integration/autoland/rev/718e41d0127adc4e0facb59656e18131a677dc34
https://hg.mozilla.org/mozilla-central/rev/718e41d0127a",UNCODED,0,UNMATCHED
1742770,8,Please nominate this for ESR approval when you get a chance. It grafts cleanly.,UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1742770,9,"I don't think we need this on ESR. This is only marked as sec-bug because of the parent dependency and the validation here is optional (without it, we still have the release assert in place). So I'd let this ride the trains.",CLARIFICATION,0,FULL_TEXT
1748376,2,"Created attachment 9257411
Bug 1748376 - Enable more wpt page-name tests with the proper pref.",UNCODED,0,UNMATCHED
1748376,3,"Pushed by emcdonough@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/b2d26d7b7645
Enable more wpt page-name tests with the proper pref. r=layout-reviewers,hiro",UNCODED,0,UNMATCHED
1748376,4,https://hg.mozilla.org/mozilla-central/rev/b2d26d7b7645,UNCODED,0,UNMATCHED
1748902,2,"Created attachment 9257916
Bug 1748902 - Add test for Uncatchable Size Callback Exceptions, and Handle Size Callback Uncatchable Exceptions. r?saschanaz",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1748902,3,"Pushed by mgaudet@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/4d8f095bf2c1
Add test for Uncatchable Size Callback Exceptions, and Handle Size Callback Uncatchable Exceptions. r=saschanaz",UNCODED,0,UNMATCHED
1748902,4,https://hg.mozilla.org/mozilla-central/rev/4d8f095bf2c1,UNCODED,0,UNMATCHED
1751268,1,"Maybe Fission related. (DOMFissionEnabled=1)
Crash report: https://crash-stats.mozilla.org/report/index/5dfc948c-b928-487e-a58e-6b8810220120
MOZ_CRASH Reason: ```MOZ_DIAGNOSTIC_ASSERT(!IsDoc())```
Top 10 frames of crashing thread:
```
0 xul.dll mozilla::a11y::RemoteAccessibleBase<mozilla::a11y::RemoteAccessible>::Shutdown accessible/ipc/RemoteAccessibleBase.cpp:41
1 xul.dll mozilla::a11y::DocAccessibleParent::ShutdownOrPrepareForMove accessible/ipc/DocAccessibleParent.cpp:185
2 xul.dll mozilla::a11y::DocAccessibleParent::ShutdownOrPrepareForMove accessible/ipc/DocAccessibleParent.cpp:194
3 xul.dll mozilla::a11y::DocAccessibleParent::ShutdownOrPrepareForMove accessible/ipc/DocAccessibleParent.cpp:194
4 xul.dll mozilla::a11y::DocAccessibleParent::ShutdownOrPrepareForMove accessible/ipc/DocAccessibleParent.cpp:194
5 xul.dll mozilla::a11y::DocAccessibleParent::ShutdownOrPrepareForMove accessible/ipc/DocAccessibleParent.cpp:194
6 xul.dll mozilla::a11y::DocAccessibleParent::ShutdownOrPrepareForMove accessible/ipc/DocAccessibleParent.cpp:194
7 xul.dll mozilla::a11y::DocAccessibleParent::ShutdownOrPrepareForMove accessible/ipc/DocAccessibleParent.cpp:194
8 xul.dll mozilla::a11y::DocAccessibleParent::RecvHideEvent accessible/ipc/DocAccessibleParent.cpp:244
9 xul.dll mozilla::a11y::PDocAccessibleParent::OnMessageReceived ipc/ipdl/PDocAccessibleParent.cpp:348
```
There are 106 crashes (from 42 installations) in nightly 98 starting with buildid 20220120100401. In analyzing the backtrace, the regression may have been introduced by patch [1] to fix bug 1748878.
[1] https://hg.mozilla.org/mozilla-central/rev?node=6c3a672524b7",STACK_TRACE,0,FULL_TOKEN
1751268,2,"I'm pretty sure this is due to bug 1748450, not bug 1748878.",PROBLEM_LOCALIZATION,0,FULL_TEXT
1751268,3,"Not sure if this is helpful, but I'm getting this crash 100% consistently when I open a message in ProtonMail.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1751268,4,"un-ni?ing me since after chatting with Jamie this seems unrelated to my work 
:Jamie lemme know if/how I should go about relanding my patch on bug 1748878 :)",STATUS_UPDATE,0,FULL_TOKEN
1751268,5,"Note that bug 1748450 has been backed out, which should fix this.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1751721,1,"Once bug 1749323 and bug 1751205 land, we can turn on OffscreenCanvas for Zoom domains. This will grant users access to gallery view on Firefox.",PROBLEM_MOTIVATION,0,FULL_TEXT
1751721,2,"Created attachment 9260533
Bug 1751721 - Add Zoom to the OffscreenCanvas domain allowlist and turn it on for users.
This will allow users to use gallery view with the web client for Zoom
in Firefox.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1751721,3,"Turns out we need bug 1746750 as well for it to work properly. The lack of text isn't an issue, no console errors from my attempts at using it in meetings.",REQUIREMENT,0,FULL_TEXT
1751721,4,"There's a r+ patch which didn't land and no activity in this bug for 2 weeks.
:aosmond, could you have a look please?
If you still have some work to do, you can add an action ""Plan Changes"" in Phabricator.
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#not_landed.py).",CODE_REVIEW_REQUEST,0,FULL_TOKEN
1751721,5,"Pushed by aosmond@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/430986e11fd2
Add Zoom to the OffscreenCanvas domain allowlist and turn it on for users. r=gfx-reviewers,lsalzman,jgilbert",UNCODED,0,UNMATCHED
1751721,6,https://hg.mozilla.org/mozilla-central/rev/430986e11fd2,UNCODED,0,UNMATCHED
1751721,7,*** Bug 1749061 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1751919,1,"58 crashes starting with Firefox 96+.
Crash report: https://crash-stats.mozilla.org/report/index/d250cb76-f52f-41ca-a3eb-127df0220125
Reason: ```EXCEPTION_ACCESS_VIOLATION_READ```
Top 10 frames of crashing thread:
```
0 xul.dll mozilla::dom::SessionHistoryEntry::ReplaceWith docshell/shistory/SessionHistoryEntry.cpp:1380
1 xul.dll mozilla::dom::CanonicalBrowsingContext::SessionHistoryCommit docshell/base/CanonicalBrowsingContext.cpp:819
2 xul.dll mozilla::dom::ContentParent::RecvHistoryCommit dom/ipc/ContentParent.cpp:7226
3 xul.dll mozilla::dom::PContentParent::OnMessageReceived ipc/ipdl/PContentParent.cpp:12742
4 xul.dll mozilla::ipc::MessageChannel::DispatchMessage ipc/glue/MessageChannel.cpp:1964
5 xul.dll mozilla::ipc::MessageChannel::MessageTask::Run ipc/glue/MessageChannel.cpp:1851
6 xul.dll mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal xpcom/threads/TaskController.cpp:771
7 xul.dll NS_ProcessNextEvent xpcom/threads/nsThreadUtils.cpp:467
8 xul.dll mozilla::ipc::MessagePump::Run ipc/glue/MessagePump.cpp:85
9 xul.dll MessageLoop::RunHandler ipc/chromium/src/base/message_loop.cc:324
```",STACK_TRACE,0,FULL_TOKEN
1751919,2,"Created attachment 9261280
Bug 1751919 - Crash in [@ mozilla::dom::SessionHistoryEntry::ReplaceWith]. r?smaug!",PROBLEM_DESCRIPTION,0,FULL_TEXT
1751919,3,"Pushed by pvanderbeken@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/aef69344a652
Crash in [@ mozilla::dom::SessionHistoryEntry::ReplaceWith]. r=smaug",UNCODED,0,UNMATCHED
1751919,4,https://hg.mozilla.org/mozilla-central/rev/aef69344a652,UNCODED,0,UNMATCHED
1751919,5,"Comment on attachment 9261280
Bug 1751919 - Crash in [@ mozilla::dom::SessionHistoryEntry::ReplaceWith]. r?smaug!
### Beta/Release Uplift Approval Request
* **User impact if declined**: Null-pointer crashes.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: 
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Just adds a null-check. We don't know how to trigger this crash, but it's showing up in crash-stats.
* **String changes made/needed**:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1751919,6,"Comment on attachment 9261280
Bug 1751919 - Crash in [@ mozilla::dom::SessionHistoryEntry::ReplaceWith]. r?smaug!
97 was merged to release, moving the request over.",UPLIFT_APPROVAL,0,FULL_TEXT
1751919,7,"Comment on attachment 9261280
Bug 1751919 - Crash in [@ mozilla::dom::SessionHistoryEntry::ReplaceWith]. r?smaug!
Low-risk crash fix, approved for 97.0rc2.",UPLIFT_APPROVAL,0,FULL_TEXT
1751919,8,https://hg.mozilla.org/releases/mozilla-release/rev/23074f64c57d,UNCODED,0,UNMATCHED
1761435,1,Switch mMoveToRectPopupRect to mMoveToRectPopupSize.,UNCODED,0,UNMATCHED
1761435,2,"Created attachment 9269373
Bug 1761435 [Wayland] Store only move-to-rect popup size r?emilio",UNCODED,0,UNMATCHED
1761435,3,"Pushed by stransky@redhat.com:
https://hg.mozilla.org/integration/autoland/rev/bcb89b91fa11
[Wayland] Store only move-to-rect popup size r=emilio",UNCODED,0,UNMATCHED
1761435,4,https://hg.mozilla.org/mozilla-central/rev/bcb89b91fa11,UNCODED,0,UNMATCHED
1761826,2,"Created attachment 9270003
Bug 1761826 - Enable disallowing relaxing referrer policies. r?#anti-tracking-reviewers",UNCODED,0,UNMATCHED
1761826,3,"Pushed by tihuang@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/a06fd3da6b88
Enable disallowing relaxing referrer policies. r=anti-tracking-reviewers,bvandersloot",UNCODED,0,UNMATCHED
1761826,4,https://hg.mozilla.org/mozilla-central/rev/a06fd3da6b88,UNCODED,0,UNMATCHED
1761994,1,Break the sum out into the component parts,CODE_IMPLEMENTATION,1,FULL_TEXT
1761994,2,"Created attachment 9269896
Bug 1761994. Expand dropped frames telemetry. , data-review=chutten
Break the sum out into the component parts",PROBLEM_DESCRIPTION,0,FULL_TEXT
1761994,3,"Created attachment 9269905
request.md",UNCODED,0,UNMATCHED
1761994,4,"Comment on attachment 9269905
request.md
DATA COLLECTION REVIEW RESPONSE:
    Is there or will there be documentation that describes the schema for the ultimate data set available publicly, complete and accurate?
Yes.
    Is there a control mechanism that allows the user to turn the data collection on and off?
Yes. This collection is Telemetry so can be controlled through Firefox's Preferences.
    If the request is for permanent data collection, is there someone who will monitor the data over time?
Yes, Jeff Muizelaar is responsible.
    Using the category system of data types on the Mozilla wiki, what collection type of data do the requested measurements fall under?
Category 1, Technical.
    Is the data collection request for default-on or default-off?
Default on for all channels.
    Does the instrumentation include the addition of any new identifiers?
No.
    Is the data collection covered by the existing Firefox privacy notice?
Yes.
    Does the data collection use a third-party collection tool?
No.
---
Result: datareview+",UNCODED,0,UNMATCHED
1761994,5,"Pushed by jmuizelaar@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/ac698a0182d7
Expand dropped frames telemetry. , data-review=chutten r=alwu",UNCODED,0,UNMATCHED
1761994,6,https://hg.mozilla.org/mozilla-central/rev/ac698a0182d7,UNCODED,0,UNMATCHED
1762088,2,"Created attachment 9269971
Bug 1762088 - Allow to derive Parse/ToCss/SpecifiedValueInfo on bitflags. r=#style,#layout-reviewers
We keep getting this pattern of properties that have a set of joint and
disjoint flags, and copy-pasting or writing the same parsing and
serialization code in slightly different ways.
container-type is one such type, and I think we should have a single way
of dealing with this, thus implement deriving for various traits for
bitflags, with an attribute that says which flags are single vs mixed.
See docs and properties I ported. The remaining ones I left TODOs with,
they are a bit trickier but can be ported with some care.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1762088,3,"Created attachment 9269972
Bug 1762088 - Implement parsing / serialization for container{,-type,-name} CSS properties. r=#style,#layout-reviewers
Two noteworthy details that may seem random otherwise:
 * Moving values around in nsStyleDisplay is needed so that the struct
   remains under the size limit that we have to avoid jumping allocator
   buckets.
 * All the test expectation churn is because tests depend on
   `container-type: size` parsing to run, and now they run. Tests for
   the relevant bits I implemented are passing, with the only exception
   of some `container-name-computed.html` failures which are
   https://github.com/w3c/csswg-drafts/issues/7181. Safari agrees with
   us there.
Other notes when looking at the spec and seeing how it matches the
implementation:
 * `container` syntax doesn't match spec, but matches tests and sanity:
   https://github.com/w3c/csswg-drafts/issues/7180
 * `container-type` syntax doesn't _quite_ match spec, but matches tests
   and I think it's a spec bug since the definition for the missing
   keyword is gone:
   https://github.com/w3c/csswg-drafts/issues/7179
Depends on D142418",CODE_IMPLEMENTATION,1,FULL_TOKEN
1762088,4,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/1bb4d3114199
Allow to derive Parse/ToCss/SpecifiedValueInfo on bitflags. r=firefox-style-system-reviewers,layout-reviewers,boris",UNCODED,0,UNMATCHED
1762088,5,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/bdaf003569a7
Implement parsing / serialization for container{,-type,-name} CSS properties. r=firefox-style-system-reviewers,layout-reviewers,boris",PROBLEM_DESCRIPTION,0,90_PCT_MATCH
1762088,6,Created web-platform-tests PR https://github.com/web-platform-tests/wpt/pull/33463 for changes under testing/web-platform/tests,UNCODED,0,UNMATCHED
1762088,7,"Pushed by emilio@crisal.io:
https://hg.mozilla.org/integration/autoland/rev/d9f904ba9e20
Remove assert that doesn't hold for text-decorations because of presentation hints.",UNCODED,0,UNMATCHED
1762088,8,"Pushed by emilio@crisal.io:
https://hg.mozilla.org/integration/autoland/rev/122d5fa4212e
Annotate a test that expectedly fails on android due to overlay scrollbars.",UNCODED,0,UNMATCHED
1762088,9,"https://hg.mozilla.org/mozilla-central/rev/1bb4d3114199
https://hg.mozilla.org/mozilla-central/rev/bdaf003569a7
https://hg.mozilla.org/mozilla-central/rev/d9f904ba9e20
https://hg.mozilla.org/mozilla-central/rev/122d5fa4212e",UNCODED,0,UNMATCHED
1762088,11,"Should we dupe bug 1744223, bug 1744224, and bug 1744228 over to this bug?
It looks like those were basically-fixed (at a CSS parsing/serialization level) by https://hg.mozilla.org/mozilla-central/rev/bdaf003569a7
(There's more to be done to support them in layout, but I'm not sure that these individual per-property bugs are the best spot to do that.)",QUESTION,0,FULL_TOKEN
1762088,12,*** Bug 1744228 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1762088,13,*** Bug 1744224 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1762088,14,*** Bug 1744223 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1764716,1,"The following testcase crashes on mozilla-central revision 20220413-4f936f5e57c8 (debug build, run with --fuzzing-safe --ion-offthread-compile=off --baseline-eager test.js):
    [].constructor.call(undefined, 2)
Backtrace:
    received signal SIGSEGV, Segmentation fault.
    #0  0x5865e3a2 in js::jit::GetIndexOfArgument(js::jit::ArgumentKind, js::jit::CallFlags, bool*) ()
    #1  0x588894e9 in js::jit::CacheIRWriter::loadArgumentFixedSlot(js::jit::ArgumentKind, unsigned int, js::jit::CallFlags) ()
    #2  0x588a9d88 in js::jit::InlinableNativeIRGenerator::tryAttachArrayConstructor() ()
    #3  0x588a5277 in js::jit::InlinableNativeIRGenerator::tryAttachStub() ()
    #4  0x588a4b93 in js::jit::CallIRGenerator::tryAttachFunCall(JS::Handle<JSFunction*>) ()
    #5  0x588aef4d in js::jit::CallIRGenerator::tryAttachStub() ()
    #6  0x585f7e4d in js::jit::DoCallFallback(JSContext*, js::jit::BaselineFrame*, js::jit::ICFallbackStub*, unsigned int, JS::Value*, JS::MutableHandle<JS::Value>) ()
    [...]
    #10 0x58a557b2 in js::jit::MaybeEnterJit(JSContext*, js::RunState&) ()
    [...]
    #19 0x57ab58d6 in main ()
    eax	0x56845b6d	1451514733
    ebx	0x591587c4	1494583236
    ecx	0x5915a29c	1494590108
    edx	0xf7b74cc7	-138982201
    esi	0xff9fe15b	-6299301
    edi	0xff9fe260	-6299040
    ebp	0xff9fe138	4288667960
    esp	0xff9fe120	4288667936
    eip	0x5865e3a2 <js::jit::GetIndexOfArgument(js::jit::ArgumentKind, js::jit::CallFlags, bool*)+530>
    => 0x5865e3a2 <_ZN2js3jit18GetIndexOfArgumentENS0_12ArgumentKindENS0_9CallFlagsEPb+530>:	movl   $0x1c8,0x0
       0x5865e3ac <_ZN2js3jit18GetIndexOfArgumentENS0_12ArgumentKindENS0_9CallFlagsEPb+540>:	call   0x57b3e9ef <abort>
Marking as fuzzblocker due to frequent failures since the test is really easy.",STACK_TRACE,0,FULL_TOKEN
1764716,2,"Created attachment 9272268
Detailed Crash Information",UNCODED,0,UNMATCHED
1764716,3,"Created attachment 9272269
Testcase",UNCODED,0,UNMATCHED
1764716,4,Likely from bug 1738413.,FILED_FROM_OTHER_ISSUE,0,FULL_TEXT
1764716,5,"Created attachment 9272292
Bug 1764716: Use standard call flags when inlining the Array constructor through Function.prototype.call. r=jandem!
`GetIndexOfArgument()` doesn't yet support `CallFlags::FunCall`, so when we inline
the Array constructor through `Function.prototype.call`, use `CallFlags::Standard`
instead.
This is the only place where `CallFlags::FunCall` can be passed through to
`GetIndexOfArgument()`.
Changing `GetIndexOfArgument()` to support `CallFlags::FunCall` isn't straight
forward, because the argument indices are different depending on whether or not
this is an inlined or non-inlined `Function.prototype.call`.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1764716,6,"Yes, it's from bug 1738413.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1764716,7,"FWIW, I don't think this issue needs to be hidden, because we always hit a `MOZ_CRASH`.",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1764716,8,"Pushed by andre.bargull@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/e3cd64982070
Use standard call flags when inlining the Array constructor through Function.prototype.call. r=jandem",UNCODED,0,UNMATCHED
1764716,9,"**Bugmon Analysis**
Verified bug as reproducible on mozilla-central 20220414092955-6c55ba30c858.
The bug appears to have been introduced in the following build range:",UNCODED,0,UNMATCHED
1764716,10,https://hg.mozilla.org/mozilla-central/rev/e3cd64982070,UNCODED,0,UNMATCHED
1764716,11,"**Bugmon Analysis**
Verified bug as fixed on rev mozilla-central 20220414214512-d8f67ac43580.
Removing bugmon keyword as no further action possible.  Please review the bug and re-add the keyword for further analysis.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1764716,12,":anba, since this bug contains a bisection range, could you fill (if possible) the regressed_by field?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#fuzzing_bisection_without_regressed_by.py).",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1764716,13,Set release status flags based on info from the regressing bug 1738413,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1769254,1,"11 crashes from 6 installations, all with Firefox 102.0a1 (on macOS obviously), first reported build ID is 20220505185614.
Crash report: https://crash-stats.mozilla.org/report/index/4b88927e-489d-4eb6-be12-5024c0220512
Reason: ```EXC_BAD_ACCESS / KERN_INVALID_ADDRESS```
Top 10 frames of crashing thread:
```
0 XUL mozilla::wr::RenderMacIOSurfaceTextureHost::GetSize const gfx/webrender_bindings/RenderMacIOSurfaceTextureHost.cpp:68
1 XUL mozilla::layers::NativeLayerCA::AttachExternalImage gfx/layers/NativeLayerCA.mm:779
2 XUL mozilla::wr::RenderCompositorNative::AttachExternalImage gfx/webrender_bindings/RenderCompositorNative.cpp:321
3 XUL webrender::renderer::Renderer::update_native_surfaces gfx/wr/webrender/src/renderer/mod.rs:4688
4 XUL webrender::renderer::Renderer::render_impl gfx/wr/webrender/src/renderer/mod.rs:1976
5 XUL webrender::renderer::Renderer::render gfx/wr/webrender/src/renderer/mod.rs:1737
6 XUL wr_renderer_render gfx/webrender_bindings/src/bindings.rs:616
7 XUL mozilla::wr::RenderThread::UpdateAndRender gfx/webrender_bindings/RenderThread.cpp:537
8 XUL mozilla::wr::RenderThread::HandleFrameOneDoc gfx/webrender_bindings/RenderThread.cpp:387
9 XUL mozilla::detail::RunnableMethodImpl<mozilla::wr::RenderThread*, void  xpcom/threads/nsThreadUtils.h:1200
```",STACK_TRACE,0,FULL_TOKEN
1769254,2,"I can reproduce this crash with SWGL enabled after accelerated Canvas2D bug 1773712 landed. However, this crash bug is not a regression from that Canvas2D bug because the Canvas2D change landed today and this crash bug was filed a month ago.
I bisected the crash with my STR to this pushlog with Canvas2D bug 1773712:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=ec7e694733a0dc3d956b6a3ea3a323fc1d41264c&tochange=5c16ac03eca7a366057cb2ac7a6f376f98dd8bf0
### Steps to reproduce
1. Enable SWGL (`gfx.webrender.software` = true) (UPDATED: and `gfx.canvas.accelerated` = true)
2. Load https://results.enr.clarityelections.com/CA/Contra_Costa/114138/web.285569/#/summary
3. Scroll down to the ""GOVERNOR"" section.
4. Click on the ""Show Chart"" button to the right of the ""GOVERNOR"" section title.
### Result
Crash bp-842adff9-37bc-4858-b749-f9cd30220612 in [@ mozilla::wr::RenderMacIOSurfaceTextureHost::GetSize ]",S2R,0,90_PCT_MATCH
1769254,3,"[Tracking Requested - why for this release]:
Kelsey, this crash is a regression from canvas color space bug 1703654.
Since accelerated Canvas2D bug 1773712 just enabled the `gfx.canvas.accelerated` pref, I bisected my crash STR again with that pref force-enabled and landed on this earlier pushlog for canvas color space bug 1703654:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=88a64ff079e144ce530a7f3121244604c29ddf92&tochange=f2d46bb91c9ddd9e6b43c315be70917b334d52a0",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1769254,4,"The crashes are gated to nightly build, so no need to track for 102 and 102ESR, but we should track for nightly as this is a top crasher on macOS and we should decide rapidly on backing out or not bug 1773712 on Nightly.",PROBLEM_REVIEW,0,FULL_TEXT
1769254,5,Requesting a backout of Bug 1773712  until the crash is investigated,ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1769254,6,"Setting 103 to disabled,  Bug 1773712 was backed out of central",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1769254,7,"The STR I found required the accelerated canvas be enabled (bug 1773712).
But this crash signature started in Nightly 102 before the accelerated canvas was enabled and we still have some crash reports from Beta (and DevEdition) 102. Example: bp-cf91cbe1-d3c6-4c54-ba60-59fc70220613 
So there may be other STR that hit this same crash without the accelerated canvas. I bisected the original crash to bug 1703654, which landed in Nightly 102.",PROBLEM_REVIEW,0,FULL_TOKEN
1769254,8,"I believe this is from
```
  wr::RenderMacIOSurfaceTextureHost* texture = aExternalImage->AsRenderMacIOSurfaceTextureHost();
  MOZ_ASSERT(texture);   <- I bet this is the issue, and that we would crash here if we did MOZ_RELEASE_ASSERT
  mTextureHost = texture;
  gfx::IntSize oldSize = mSize;
  mSize = texture->GetSize(0);   <- crashes here
```",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1769254,9,"I tried this STR, setting gfx.webrender.software and gfx.canvas.accelerated to true, but I don't get a crash. Is there anything else I am missing to repro this?",QUESTION,0,FULL_TEXT
1769254,10,"My hunch is that the SharedSurfaceIO is not keeping alive the MacIOSurface long with out-of-process WebGL, so it exports a SurfaceDescriptor from GPU process to content process, then back to GPU process for WebRender, but in that gap, for some reason, the SharedSurfaceIO goes away, so that when the MacIOSurfaceTextureHostOGL goes to create it from the SurfaceDescriptor for WebRender, it is already gone, so we end up with a null IOSurface that is causing these crashes downwind.
I would need a more reliable repro to test this, but Sotaro is working on something to fix a similar problem in D3D11 that might fix the issue here as well if this is actually the problem.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1769254,11,"Created attachment 9281292
about:support
I don't know of any other steps or settings missing from my STR. I'll attach my about:support info. Maybe there is something peculiar about my hardware (a 2015 MacBook Pro).
Summarizing my findings:
My STR crashes on this build with a clean profile when gfx.webrender.software and gfx.canvas.accelerated are true:
`mach mozregression --launch 5c16ac03eca7a366057cb2ac7a6f376f98dd8bf0 --pref ""gfx.webrender.software:true"" ""gfx.canvas.accelerated:true"" -a ""https://results.enr.clarityelections.com/CA/Contra_Costa/114138/web.285569/#/summary""`
But doesn't crash on the same build if gfx.webrender.software or gfx.canvas.accelerated are false:
`mach mozregression --launch 5c16ac03eca7a366057cb2ac7a6f376f98dd8bf0 --pref ""gfx.webrender.software:true"" ""gfx.canvas.accelerated:false"" -a ""https://results.enr.clarityelections.com/CA/Contra_Costa/114138/web.285569/#/summary""`
`mach mozregression --launch 5c16ac03eca7a366057cb2ac7a6f376f98dd8bf0 --pref ""gfx.webrender.software:false"" ""gfx.canvas.accelerated:true"" -a ""https://results.enr.clarityelections.com/CA/Contra_Costa/114138/web.285569/#/summary""`",PROBLEM_REVIEW,0,FULL_TOKEN
1769254,12,Set release status flags based on info from the regressing bug 1703654,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1769254,13,"[Tracking Requested - why for this release]:
Lee, I can reproduce this SWGL crash again (using the STR in comment #1) now that `gfx.canvas.accelerated` has been re-enabled in bug 1773712.
bp-43999729-23c4-40db-ab68-930260220806",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1769254,14,"What's the target release for shipping accelerated canvas, Lee?",QUESTION,0,FULL_TEXT
1769254,15,I hit this saving an edited (pdfjs.annotationEditorMode=0) PDF to PDF in yesterday(?)'s nightly on macOS.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1769254,16,I've hit this four times while using Google Maps over the last two days.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1769254,17,"Sotaro, any ideas here?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1769254,18,100% repro visiting starlink.sx,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1769254,19,"Created attachment 9289156
Bug 1769254 - Check for null texture host. r?aosmond",UNCODED,0,UNMATCHED
1769254,20,"Pushed by lsalzman@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/0f1fe5d29884
Check for null texture host. r=aosmond",UNCODED,0,UNMATCHED
1769254,21,https://hg.mozilla.org/mozilla-central/rev/0f1fe5d29884,UNCODED,0,UNMATCHED
1769254,22,This patch should at least avoid the crashes while we're investigating this bug.,CLARIFICATION,0,FULL_TEXT
1769254,23,"We mark every external image in an async image pipeline as preferring a compositor surface:
https://searchfox.org/mozilla-central/rev/6a37a2ab9328bec6a29f688d1b2fba6974d34905/gfx/layers/wr/AsyncImagePipelineManager.cpp#453
There are additional requirements that must be met, so I am guessing that is why or part of why it doesn't always trip:
https://searchfox.org/mozilla-central/rev/43ba67391e71c57a14420e554e9d381543292611/gfx/wr/webrender/src/picture.rs#2520
As such, I don't think there is any guarantee we will get the expected type:
https://searchfox.org/mozilla-central/rev/43ba67391e71c57a14420e554e9d381543292611/gfx/layers/NativeLayerCA.mm#805
Should we be performing more checks before we set the flag? Or is it the responsibility of the compositing code to do the check?",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1769254,24,"Problem seems to exists at canUpdate check in [AsyncImagePipelineManager::UpdateImageKeys()](https://searchfox.org/mozilla-central/rev/6ec440e105c2b75d5cae9d34f957a2f85a106d54/gfx/layers/wr/AsyncImagePipelineManager.cpp#254). It could not detect TextureHost change from MacIOSurfaceTextureHostOGL to ShmemTextureHost with same format and size.
It happened when accelerated canvas was fallback to sw canvas.",SOLUTION_VERIFICATION,0,90_PCT_MATCH
1769254,25,"Created attachment 9289618
Bug 1769254 - Add TextureHost type check for using update in AsyncImagePipelineManager::UpdateImageKeys()",UNCODED,0,UNMATCHED
1769254,26,"Pushed by sikeda.birchill@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/74587348428c
Add TextureHost type check for using update in AsyncImagePipelineManager::UpdateImageKeys() r=gfx-reviewers,lsalzman",UNCODED,0,UNMATCHED
1769254,27,https://hg.mozilla.org/mozilla-central/rev/74587348428c,UNCODED,0,UNMATCHED
1769254,28,"Reproduced this issue on an affected Nightly build from 2022-05-13 using the STR from Comment 1, on macOS 10.15.
Verified as fixed on Firefox 105.0b5 (20220830185924) on the above OS.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1769748,1,"+++ This bug was initially created as a clone of Bug #1769624 +++
**Filed by:** csabou [at] mozilla.com
**Parsed log:** https://treeherder.mozilla.org/logviewer?job_id=378238762&repo=autoland
**Full log:** https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/ZNsDBxMTSF6GxG019l2mXA/runs/0/artifacts/public/logs/live_backing.log
---
```
[task 2022-05-16T17:20:13.709Z] 17:20:13     INFO - TEST-START | browser/components/resistfingerprinting/test/mochitest/test_speech_synthesis.html
[task 2022-05-16T17:20:13.751Z] 17:20:13     INFO - GECKO(1475) | [Parent 1475, Main Thread] WARNING: NS_ENSURE_TRUE(inst) failed: file StaticComponents.cpp:9282
[task 2022-05-16T17:20:13.787Z] 17:20:13     INFO - GECKO(1475) | MEMORY STAT | vsize 14858MB | residentFast 113MB | heapAllocated 16MB
[task 2022-05-16T17:20:13.800Z] 17:20:13     INFO - TEST-OK | browser/components/resistfingerprinting/test/mochitest/test_speech_synthesis.html | took 92ms
[task 2022-05-16T17:20:13.829Z] 17:20:13     INFO - TEST-START | Shutdown
[task 2022-05-16T17:20:13.829Z] 17:20:13     INFO - Passed:  698
[task 2022-05-16T17:20:13.829Z] 17:20:13     INFO - Failed:  0
[task 2022-05-16T17:20:13.830Z] 17:20:13     INFO - Todo:    6
[task 2022-05-16T17:20:13.830Z] 17:20:13     INFO - Mode:    e10s
[task 2022-05-16T17:20:13.831Z] 17:20:13     INFO - Slowest: 4399ms - /tests/browser/components/resistfingerprinting/test/mochitest/test_reduce_time_precision.html
[task 2022-05-16T17:20:13.831Z] 17:20:13     INFO - SimpleTest FINISHED
[task 2022-05-16T17:20:13.831Z] 17:20:13     INFO - TEST-INFO | Ran 1 Loops
[task 2022-05-16T17:20:13.831Z] 17:20:13     INFO - SimpleTest FINISHED
[task 2022-05-16T17:20:13.859Z] 17:20:13     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: '!CanSend() || !mManager || !mManager->CanSend()', file /builds/worker/checkouts/gecko/dom/ipc/jsactor/JSWindowActorChild.cpp:44
[task 2022-05-16T17:20:13.859Z] 17:20:13     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: '!CanSend() || !mManager || !mManager->CanSend()', file /builds/worker/checkouts/gecko/dom/ipc/jsactor/JSWindowActorChild.cpp:44
[task 2022-05-16T17:20:13.862Z] 17:20:13     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: '!CanSend() || !mManager || !mManager->CanSend()', file /builds/worker/checkouts/gecko/dom/ipc/jsactor/JSWindowActorChild.cpp:44
[task 2022-05-16T17:20:13.867Z] 17:20:13     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: '!CanSend() || !mManager || !mManager->CanSend()', file /builds/worker/checkouts/gecko/dom/ipc/jsactor/JSWindowActorChild.cpp:44
[task 2022-05-16T17:20:13.872Z] 17:20:13     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: '!CanSend() || !mManager || !mManager->CanSend()', file /builds/worker/checkouts/gecko/dom/ipc/jsactor/JSWindowActorChild.cpp:44
[task 2022-05-16T17:20:13.872Z] 17:20:13     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: '!CanSend() || !mManager || !mManager->CanSend()', file /builds/worker/checkouts/gecko/dom/ipc/jsactor/JSWindowActorChild.cpp:44
[task 2022-05-16T17:20:13.881Z] 17:20:13     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: '!CanSend() || !mManager || !mManager->CanSend()', file /builds/worker/checkouts/gecko/dom/ipc/jsactor/JSWindowActorChild.cpp:44
[task 2022-05-16T17:20:13.886Z] 17:20:13     INFO - GECKO(1475) | JavaScript error: resource://gre/modules/AsyncShutdown.jsm, line 575: NotFoundError: No such JSWindowActor 'SpecialPowers'
[task 2022-05-16T17:20:13.903Z] 17:20:13     INFO - GECKO(1475) | JavaScript error: resource://gre/modules/AsyncShutdown.jsm, line 575: NotFoundError: No such JSWindowActor 'AppTestDelegate'
[task 2022-05-16T17:20:13.903Z] 17:20:13     INFO - GECKO(1475) | JavaScript error: resource://gre/modules/AsyncShutdown.jsm, line 575: NotFoundError: No such JSWindowActor 'AppTestDelegate'
[task 2022-05-16T17:20:13.937Z] 17:20:13     INFO - GECKO(1475) | 1652721613936	Marionette	TRACE	Received observer notification quit-application
[task 2022-05-16T17:20:13.937Z] 17:20:13     INFO - GECKO(1475) | 1652721613936	Marionette	INFO	Stopped listening on port 2828[task 2022-05-16T17:20:14.042Z] 17:20:14     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_StartedGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.043Z] 17:20:14     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_DoneGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.044Z] 17:20:14     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_StartedGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.044Z] 17:20:14     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_DoneGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.047Z] 17:20:14     INFO - GECKO(1475) | [Child 1480, Main Thread] WARNING: NS_ENSURE_TRUE(Preferences::InitStaticMembers()) failed: file /builds/worker/checkouts/gecko/modules/libpref/Preferences.cpp:4571
[task 2022-05-16T17:20:14.062Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_DoneGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.136Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_StartedGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.147Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_DoneGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.152Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: Extra shutdown CC: 'i < NORMAL_SHUTDOWN_COLLECTIONS', file /builds/worker/checkouts/gecko/xpcom/base/nsCycleCollector.cpp:3359
[task 2022-05-16T17:20:14.154Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: NS_ENSURE_TRUE(InitStaticMembers()) failed: file /builds/worker/workspace/obj-build/dist/include/mozilla/Preferences.h:129
[task 2022-05-16T17:20:14.154Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_StartedGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.156Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_DoneGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.156Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_StartedGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.157Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: IPC message 'PIdleScheduler::Msg_DoneGC' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.159Z] 17:20:14     INFO - GECKO(1475) | [Child 1483, Main Thread] WARNING: NS_ENSURE_TRUE(Preferences::InitStaticMembers()) failed: file /builds/worker/checkouts/gecko/modules/libpref/Preferences.cpp:4571
[task 2022-05-16T17:20:14.161Z] 17:20:14     INFO - GECKO(1475) | [2022-05-16T17:20:14Z WARN  xulstore::persist] tried to remove key that isn't in the store[task 2022-05-16T17:20:14.658Z] 17:20:14     INFO - GECKO(1475) | Assertion failure: false (MOZ_ASSERT_UNREACHABLE: Failure when starting actor), at /builds/worker/checkouts/gecko/ipc/glue/UtilityProcessManager.cpp:248
[task 2022-05-16T17:20:14.658Z] 17:20:14     INFO - GECKO(1475) | [RDD 1509, Main Thread] WARNING: IPC message 'PRDD::Msg_FOGData' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:14.659Z] 17:20:14     INFO - GECKO(1475) | [RDD 1509, Main Thread] WARNING: nsAppShell::Exit() called redundantly: file /builds/worker/checkouts/gecko/widget/cocoa/nsAppShell.mm:823
[task 2022-05-16T17:20:14.661Z] 17:20:14     INFO -  Initializing stack-fixing for the first stack frame, this may take a while...
[task 2022-05-16T17:20:21.967Z] 17:20:21     INFO - GECKO(1475) | #01: mozilla::MozPromise<bool, nsresult, false>::ThenValue<RefPtr<mozilla::MozPromise<bool, nsresult, false> > mozilla::ipc::UtilityProcessManager::StartUtility<mozilla::ipc::UtilityAudioDecoderChild>(RefPtr<mozilla::ipc::UtilityAudioDecoderChild>, mozilla::ipc::SandboxingKind)::{lambda()#1}, RefPtr<mozilla::MozPromise<bool, nsresult, false> > mozilla::ipc::UtilityProcessManager::StartUtility<mozilla::ipc::UtilityAudioDecoderChild>(RefPtr<mozilla::ipc::UtilityAudioDecoderChild>, mozilla::ipc::SandboxingKind)::{lambda(nsresult)#1}>::DoResolveOrRejectInternal(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) [xpcom/threads/MozPromise.h:850]
[task 2022-05-16T17:20:21.968Z] 17:20:21     INFO - GECKO(1475) | [RDD 1509, Main Thread] WARNING: NS_ENSURE_TRUE(Preferences::InitStaticMembers()) failed: file /builds/worker/checkouts/gecko/modules/libpref/Preferences.cpp:4571
[task 2022-05-16T17:20:21.968Z] 17:20:21     INFO - GECKO(1475) | #02: mozilla::MozPromise<bool, nsresult, false>::ThenValueBase::ResolveOrRejectRunnable::Run() [xpcom/threads/MozPromise.h:488]
[task 2022-05-16T17:20:21.968Z] 17:20:21     INFO - GECKO(1475) | #03: mozilla::RunnableTask::Run() [xpcom/threads/TaskController.cpp:476]
[task 2022-05-16T17:20:21.969Z] 17:20:21     INFO - GECKO(1475) | #04: mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [xpcom/threads/TaskController.cpp:788]
[task 2022-05-16T17:20:21.969Z] 17:20:21     INFO - GECKO(1475) | #05: mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [xpcom/threads/TaskController.cpp:620]
[task 2022-05-16T17:20:21.970Z] 17:20:21     INFO - GECKO(1475) | #06: mozilla::TaskController::ProcessPendingMTTask(bool) [xpcom/threads/TaskController.cpp:398]
[task 2022-05-16T17:20:21.970Z] 17:20:21     INFO - GECKO(1475) | #07: mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_1>::Run() [xpcom/threads/nsThreadUtils.h:532]
[task 2022-05-16T17:20:21.970Z] 17:20:21     INFO - GECKO(1475) | #08: nsThread::ProcessNextEvent(bool, bool*) [xpcom/threads/nsThread.cpp:1184]
[task 2022-05-16T17:20:21.970Z] 17:20:21     INFO - GECKO(1475) | #09: nsThread::Shutdown() [xpcom/threads/nsThread.cpp:875]
[task 2022-05-16T17:20:21.971Z] 17:20:21     INFO - GECKO(1475) | #10: mozilla::net::WaitForThreadShutdown::Run() [netwerk/base/nsPACMan.cpp:170]
[task 2022-05-16T17:20:21.971Z] 17:20:21     INFO - GECKO(1475) | #11: mozilla::RunnableTask::Run() [xpcom/threads/TaskController.cpp:476]
[task 2022-05-16T17:20:21.971Z] 17:20:21     INFO - GECKO(1475) | #12: mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [xpcom/threads/TaskController.cpp:788]
[task 2022-05-16T17:20:21.972Z] 17:20:21     INFO - GECKO(1475) | #13: mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [xpcom/threads/TaskController.cpp:620]
[task 2022-05-16T17:20:21.972Z] 17:20:21     INFO - GECKO(1475) | #14: mozilla::TaskController::ProcessPendingMTTask(bool) [xpcom/threads/TaskController.cpp:398]
[task 2022-05-16T17:20:21.972Z] 17:20:21     INFO - GECKO(1475) | #15: mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_1>::Run() [xpcom/threads/nsThreadUtils.h:532]
[task 2022-05-16T17:20:21.973Z] 17:20:21     INFO - GECKO(1475) | #16: nsThread::ProcessNextEvent(bool, bool*) [xpcom/threads/nsThread.cpp:1184]
[task 2022-05-16T17:20:21.973Z] 17:20:21     INFO - GECKO(1475) | #17: nsThread::Shutdown() [xpcom/threads/nsThread.cpp:875]
[task 2022-05-16T17:20:21.973Z] 17:20:21     INFO - GECKO(1475) | #18: mozilla::dom::RemoteWorkerService::Observe(nsISupports*, char const*, char16_t const*) [dom/workers/remoteworkers/RemoteWorkerService.cpp:168]
[task 2022-05-16T17:20:21.974Z] 17:20:21     INFO - GECKO(1475) | #19: nsObserverList::NotifyObservers(nsISupports*, char const*, char16_t const*) [xpcom/ds/nsObserverList.cpp:69]
[task 2022-05-16T17:20:21.974Z] 17:20:21     INFO - GECKO(1475) | #20: nsObserverService::NotifyObservers(nsISupports*, char const*, char16_t const*) [xpcom/ds/nsObserverService.cpp:295]
[task 2022-05-16T17:20:21.974Z] 17:20:21     INFO - GECKO(1475) | #21: mozilla::AppShutdown::AdvanceShutdownPhaseInternal(mozilla::ShutdownPhase, bool, char16_t const*, nsCOMPtr<nsISupports> const&) [xpcom/base/AppShutdown.cpp:374]
[task 2022-05-16T17:20:21.975Z] 17:20:21     INFO - GECKO(1475) | #22: mozilla::ShutdownXPCOM(nsIServiceManager*) [xpcom/build/XPCOMInit.cpp:623]
[task 2022-05-16T17:20:21.975Z] 17:20:21     INFO - GECKO(1475) | #23: ScopedXPCOMStartup::~ScopedXPCOMStartup() [toolkit/xre/nsAppRunner.cpp:2050]
[task 2022-05-16T17:20:21.975Z] 17:20:21     INFO - GECKO(1475) | #24: XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) [toolkit/xre/nsAppRunner.cpp:5954]
[task 2022-05-16T17:20:21.975Z] 17:20:21     INFO - GECKO(1475) | #25: XRE_main(int, char**, mozilla::BootstrapConfig const&) [toolkit/xre/nsAppRunner.cpp:5992]
[task 2022-05-16T17:20:21.976Z] 17:20:21     INFO - GECKO(1475) | #26: main [browser/app/nsBrowserApp.cpp:397][task 2022-05-16T17:20:21.976Z] 17:20:21     INFO - GECKO(1475) | [Utility 1510, Main Thread] WARNING: IPC Connection Error: [Child][PUtilityProcessChild] Send(msgname=PUtilityProcess::Msg_InitCompleted) Channel closing: too late to send/recv, messages will be lost: file /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1908
[task 2022-05-16T17:20:21.977Z] 17:20:21     INFO - GECKO(1475) | [Utility 1510, Main Thread] WARNING: IPC Connection Error: [Child][PUtilityProcessChild] RunMessage(msgname=PUtilityProcess::Msg_Init) Channel closing: too late to send/recv, messages will be lost: file /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1908
[task 2022-05-16T17:20:21.977Z] 17:20:21     INFO - GECKO(1475) | [Utility 1510, Main Thread] WARNING: IPC Connection Error: [Child][PUtilityProcessChild] RunMessage(msgname=PUtilityProcess::Msg_InitProfiler) Channel closing: too late to send/recv, messages will be lost: file /builds/worker/checkouts/gecko/ipc/glue/MessageChannel.cpp:1908
[task 2022-05-16T17:20:21.978Z] 17:20:21     INFO - GECKO(1475) | [Utility 1510, Main Thread] WARNING: IPC message 'PUtilityProcess::Msg_FOGData' discarded: actor cannot send: file /builds/worker/checkouts/gecko/ipc/glue/ProtocolUtils.cpp:509
[task 2022-05-16T17:20:28.705Z] 17:20:28     INFO - GECKO(1475) | [Utility 1510, Main Thread] WARNING: nsAppShell::Exit() called redundantly: file /builds/worker/checkouts/gecko/widget/cocoa/nsAppShell.mm:823
[task 2022-05-16T17:20:28.707Z] 17:20:28     INFO - GECKO(1475) | [Utility 1510, Main Thread] WARNING: NS_ENSURE_TRUE(Preferences::InitStaticMembers()) failed: file /builds/worker/checkouts/gecko/modules/libpref/Preferences.cpp:4571
[task 2022-05-16T17:20:34.488Z] 17:20:34     INFO - TEST-INFO | Main app process: exit 1
[task 2022-05-16T17:20:34.489Z] 17:20:34     INFO - Buffered messages finished
[task 2022-05-16T17:20:34.489Z] 17:20:34    ERROR - TEST-UNEXPECTED-FAIL | Last test finished | application terminated with exit code 1
[task 2022-05-16T17:20:34.489Z] 17:20:34     INFO - runtests.py | Application ran for: 0:00:37.081579
[task 2022-05-16T17:20:34.490Z] 17:20:34     INFO - zombiecheck | Reading PID log: /var/folders/q9/5j_g_7qx1sj911tgxnc5htdr000014/T/tmpi3l5r4ohpidlog
[task 2022-05-16T17:20:34.490Z] 17:20:34     INFO - ==> process 1475 launched child process 1480
[task 2022-05-16T17:20:34.490Z] 17:20:34     INFO - ==> process 1475 launched child process 1481
[task 2022-05-16T17:20:34.491Z] 17:20:34     INFO - ==> process 1475 launched child process 1482
[task 2022-05-16T17:20:34.491Z] 17:20:34     INFO - ==> process 1475 launched child process 1483
[task 2022-05-16T17:20:34.491Z] 17:20:34     INFO - ==> process 1475 launched child process 1484
[task 2022-05-16T17:20:34.491Z] 17:20:34     INFO - ==> process 1475 launched child process 1499
[task 2022-05-16T17:20:34.492Z] 17:20:34     INFO - ==> process 1475 launched child process 1508
[task 2022-05-16T17:20:34.492Z] 17:20:34     INFO - ==> process 1475 launched child process 1509
[task 2022-05-16T17:20:34.492Z] 17:20:34     INFO - ==> process 1475 launched child process 1510
[task 2022-05-16T17:20:34.492Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1508
[task 2022-05-16T17:20:34.493Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1509
[task 2022-05-16T17:20:34.493Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1510
[task 2022-05-16T17:20:34.493Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1480
[task 2022-05-16T17:20:34.493Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1481
[task 2022-05-16T17:20:34.494Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1482
[task 2022-05-16T17:20:34.494Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1483
[task 2022-05-16T17:20:34.494Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1484
[task 2022-05-16T17:20:34.495Z] 17:20:34     INFO - zombiecheck | Checking for orphan process with PID: 1499[task 2022-05-16T17:20:34.497Z] 17:20:34     INFO - mozcrash Copy/paste: /opt/worker/tasks/task_165272122675722/fetches/minidump-stackwalk/minidump-stackwalk --symbols-url=https://symbols.mozilla.org/ --human /var/folders/q9/5j_g_7qx1sj911tgxnc5htdr000014/T/tmph5flkqnm.mozrunner/minidumps/B0EC0806-2D56-45B9-91B7-FD17DDCF5925.dmp /opt/worker/tasks/task_165272122675722/build/symbols
[task 2022-05-16T17:20:39.696Z] 17:20:39     INFO - mozcrash Saved minidump as /opt/worker/tasks/task_165272122675722/build/blobber_upload_dir/B0EC0806-2D56-45B9-91B7-FD17DDCF5925.dmp
[task 2022-05-16T17:20:39.696Z] 17:20:39     INFO - mozcrash Saved app info as /opt/worker/tasks/task_165272122675722/build/blobber_upload_dir/B0EC0806-2D56-45B9-91B7-FD17DDCF5925.extra
[task 2022-05-16T17:20:39.953Z] 17:20:39     INFO - PROCESS-CRASH | Last test finished | application crashed [@ mozilla::MozPromise<bool, nsresult, false>::ThenValue<RefPtr<mozilla::MozPromise<bool, nsresult, false> > mozilla::ipc::UtilityProcessManager::StartUtility<mozilla::ipc::UtilityAudioDecoderChild>(RefPtr<mozilla::ipc::UtilityAudioDecoderChild>, mozilla::ipc::SandboxingKind)::{lambda()#1}, RefPtr<mozilla::MozPromise<bool, nsresult, false> > mozilla::ipc::UtilityProcessManager::StartUtility<mozilla::ipc::UtilityAudioDecoderChild>(RefPtr<mozilla::ipc::UtilityAudioDecoderChild>, mozilla::ipc::SandboxingKind)::{lambda(nsresult)#1}>::DoResolveOrRejectInternal(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&)]
[task 2022-05-16T17:20:39.953Z] 17:20:39     INFO - Mozilla crash reason: MOZ_ASSERT(false) (MOZ_ASSERT_UNREACHABLE: Failure when starting actor)
[task 2022-05-16T17:20:39.953Z] 17:20:39     INFO - Crash dump filename: /var/folders/q9/5j_g_7qx1sj911tgxnc5htdr000014/T/tmph5flkqnm.mozrunner/minidumps/B0EC0806-2D56-45B9-91B7-FD17DDCF5925.dmp
[task 2022-05-16T17:20:39.953Z] 17:20:39     INFO - Operating system: Mac OS X
[task 2022-05-16T17:20:39.953Z] 17:20:39     INFO -                   10.15.7 19H524
[task 2022-05-16T17:20:39.953Z] 17:20:39     INFO - CPU: amd64
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      family 6 model 158 stepping 10
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      12 CPUs
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - 
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - Crash reason:  EXC_BAD_ACCESS / KERN_INVALID_ADDRESS
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - Crash address: 0x0
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - Mac Crash Info:
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - 
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - Process uptime: 17 seconds
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - 
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO - Thread 0 MainThread (crashed)
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -  0  XUL!mozilla::MozPromise<bool, nsresult, false>::ThenValue<RefPtr<mozilla::MozPromise<bool, nsresult, false> > mozilla::ipc::UtilityProcessManager::StartUtility<mozilla::ipc::UtilityAudioDecoderChild>(RefPtr<mozilla::ipc::UtilityAudioDecoderChild>, mozilla::ipc::SandboxingKind)::{lambda()#1}, RefPtr<mozilla::MozPromise<bool, nsresult, false> > mozilla::ipc::UtilityProcessManager::StartUtility<mozilla::ipc::UtilityAudioDecoderChild>(RefPtr<mozilla::ipc::UtilityAudioDecoderChild>, mozilla::ipc::SandboxingKind)::{lambda(nsresult)#1}>::DoResolveOrRejectInternal(mozilla::MozPromise<bool, nsresult, false>::ResolveOrRejectValue&) [MozPromise.h:46fce4bc8cd488edfcf904febadba61be749708f : 850 + 0x29]
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      rax = 0x000000011d6d0052    rdx = 0x0000000000000000
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      rcx = 0x000000010f2c33e8    rbx = 0x00000001272b3e40
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      rsi = 0x00000000000120a8    rdi = 0x00007fff9a08eca8
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      rbp = 0x00007ffee0a01b90    rsp = 0x00007ffee0a01b80[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -       r8 = 0x00000000000130a8     r9 = 0x0000000000000000
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      r10 = 0x00007fff9a08ecc8    r11 = 0x00007fff9a08ecc0
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      r12 = 0x000000010f590a6e    r13 = 0xaaaaaaaaaaaaaaaa
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      r14 = 0x00000001135dc150    r15 = 0x0000000125c3edc0
[task 2022-05-16T17:20:39.954Z] 17:20:39     INFO -      rip = 0x00000001144cd82d
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -     Found by: given as instruction pointer in context
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -  1  XUL!mozilla::MozPromise<bool, nsresult, false>::ThenValueBase::ResolveOrRejectRunnable::Run() [MozPromise.h:46fce4bc8cd488edfcf904febadba61be749708f : 487 + 0x2c]
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      rbx = 0x0000000000000032    rbp = 0x00007ffee0a01bb0
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      rsp = 0x00007ffee0a01ba0    r12 = 0x000000010f590a6e
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      r13 = 0xaaaaaaaaaaaaaaaa    r14 = 0x00000001135dc150
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      r15 = 0x0000000125c3edc0    rip = 0x000000011385bc14
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -  2  XUL!mozilla::RunnableTask::Run() [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 475 + 0x12]
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      rbx = 0x0000000000000032    rbp = 0x00007ffee0a02030
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      rsp = 0x00007ffee0a01bc0    r12 = 0x000000010f590a6e
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      r13 = 0xaaaaaaaaaaaaaaaa    r14 = 0x000000011e6738d0
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      r15 = 0x0000000125c3edc0    rip = 0x0000000113b33abb
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -  3  XUL!mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 788 + 0x8]
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      rbx = 0x000000011355f800    rbp = 0x00007ffee0a02210
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02040    r12 = 0x000000010f590a40
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      r13 = 0xaaaaaaaaaaaaaaaa    r14 = 0x00007ffee0a020c8
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      r15 = 0x0000000125c3edc0    rip = 0x0000000113b0ddc5
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -     Found by: call frame info[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -  4  XUL!mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 620 + 0xa]
[task 2022-05-16T17:20:39.955Z] 17:20:39     INFO -      rbx = 0x0000000000000001    rbp = 0x00007ffee0a02260
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02220    r12 = 0x000000011355f800
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02401
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r15 = 0x00007ffee0a02278    rip = 0x0000000113b0c9e5
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -  5  XUL!mozilla::TaskController::ProcessPendingMTTask(bool) [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 398 + 0x7]
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rbx = 0x0000000000000001    rbp = 0x00007ffee0a022b0
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02270    r12 = 0x0000006535f17c1e
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02401
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r15 = 0x000000011355f800    rip = 0x0000000113b0ccbe
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -  6  XUL!mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_1>::Run() [nsThreadUtils.h:46fce4bc8cd488edfcf904febadba61be749708f : 531 + 0x15]
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rbx = 0x00007ffee0a02350    rbp = 0x00007ffee0a022c0
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rsp = 0x00007ffee0a022c0    r12 = 0x0000006535f17c1e
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02401
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r15 = 0x000000012ef5ad01    rip = 0x0000000113b3924a
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -  7  XUL!nsThread::ProcessNextEvent(bool, bool*) [nsThread.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 1180 + 0x15]
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rbx = 0x00007ffee0a02350    rbp = 0x00007ffee0a023e0
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rsp = 0x00007ffee0a022d0    r12 = 0x0000006535f17c1e
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02401
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r15 = 0x000000012ef5ad01    rip = 0x0000000113b21e9e
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -     Found by: call frame info[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -  8  XUL!nsThread::Shutdown() [nsThread.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 875 + 0x2e4]
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rbx = 0x000000010f590900    rbp = 0x00007ffee0a02610
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      rsp = 0x00007ffee0a023f0    r12 = 0xaaaaaaaaaaaaaaaa
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r13 = 0xaaaaaaaaaaaaaaaa    r14 = 0x00007ffee0a02438
[task 2022-05-16T17:20:39.956Z] 17:20:39     INFO -      r15 = 0x000000012ef5ad50    rip = 0x0000000113b20af0
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -  9  XUL!mozilla::net::WaitForThreadShutdown::Run() [nsPACMan.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 169 + 0x5]
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      rbx = 0x00000001262c5ac0    rbp = 0x00007ffee0a02630
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02620    r12 = 0x000000010f590a00
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      r13 = 0xaaaaaaaaaaaaaaaa    r14 = 0x000000011e6738d0
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      r15 = 0x0000000126bce280    rip = 0x0000000113d1e2ae
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO - 10  XUL!mozilla::RunnableTask::Run() [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 475 + 0x12]
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      rbx = 0x000000000000001a    rbp = 0x00007ffee0a02ab0
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02640    r12 = 0x000000010f590a00
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      r13 = 0xaaaaaaaaaaaaaaaa    r14 = 0x000000011e6738d0
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      r15 = 0x0000000126bce280    rip = 0x0000000113b33abb
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO - 11  XUL!mozilla::TaskController::DoExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 788 + 0x8]
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      rbx = 0x000000011355f800    rbp = 0x00007ffee0a02c90
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02ac0    r12 = 0x000000010f590a40
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      r13 = 0xaaaaaaaaaaaaaaaa    r14 = 0x00007ffee0a02b48
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -      r15 = 0x0000000126bce280    rip = 0x0000000113b0ddc5
[task 2022-05-16T17:20:39.957Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO - 12  XUL!mozilla::TaskController::ExecuteNextTaskOnlyMainThreadInternal(mozilla::detail::BaseAutoLock<mozilla::Mutex&> const&) [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 620 + 0xa]
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      rbx = 0x0000000000000001    rbp = 0x00007ffee0a02ce0
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02ca0    r12 = 0x000000011355f800
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02e01
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      r15 = 0x00007ffee0a02cf8    rip = 0x0000000113b0c9e5
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -     Found by: call frame info[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO - 13  XUL!mozilla::TaskController::ProcessPendingMTTask(bool) [TaskController.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 398 + 0x7]
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      rbx = 0x0000000000000001    rbp = 0x00007ffee0a02d30
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02cf0    r12 = 0x0000006535eef580
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02e01
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      r15 = 0x000000011355f800    rip = 0x0000000113b0ccbe
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO - 14  XUL!mozilla::detail::RunnableFunction<mozilla::TaskController::InitializeInternal()::$_1>::Run() [nsThreadUtils.h:46fce4bc8cd488edfcf904febadba61be749708f : 531 + 0x15]
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      rbx = 0x00007ffee0a02dd0    rbp = 0x00007ffee0a02d40
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02d40    r12 = 0x0000006535eef580
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02e01
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      r15 = 0x0000000127552201    rip = 0x0000000113b3924a
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO - 15  XUL!nsThread::ProcessNextEvent(bool, bool*) [nsThread.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 1180 + 0x15]
[task 2022-05-16T17:20:39.958Z] 17:20:39     INFO -      rbx = 0x00007ffee0a02dd0    rbp = 0x00007ffee0a02e60
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02d50    r12 = 0x0000006535eef580
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r13 = 0x000000010f590900    r14 = 0x00007ffee0a02e01
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r15 = 0x0000000127552201    rip = 0x0000000113b21e9e
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO - 16  XUL!nsThread::Shutdown() [nsThread.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 875 + 0x2e4]
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      rbx = 0x000000010f590900    rbp = 0x00007ffee0a03090
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      rsp = 0x00007ffee0a02e70    r12 = 0xaaaaaaaaaaaaaaaa
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r13 = 0x000000011d552645    r14 = 0x00007ffee0a02eb8
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r15 = 0x00000001275522d0    rip = 0x0000000113b20af0
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO - 17  XUL!mozilla::dom::RemoteWorkerService::Observe(nsISupports*, char const*, char16_t const*) [RemoteWorkerService.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 167 + 0x11]
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      rbx = 0x0000000127552200    rbp = 0x00007ffee0a030e0
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      rsp = 0x00007ffee0a030a0    r12 = 0x000000010f590ac0
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r13 = 0x000000011d552645    r14 = 0x0000000125cc6d30
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r15 = 0x0000000125cc6d48    rip = 0x0000000117849acb
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -     Found by: call frame info[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO - 18  XUL!nsObserverList::NotifyObservers(nsISupports*, char const*, char16_t const*) [nsObserverList.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 70 + 0x22]
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      rbx = 0x000000000000007a    rbp = 0x00007ffee0a03120
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      rsp = 0x00007ffee0a030f0    r12 = 0x000000010f590ac0
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r13 = 0x000000011d552645    r14 = 0x0000000000000000
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -      r15 = 0x000000011d552645    rip = 0x0000000113a752af
[task 2022-05-16T17:20:39.959Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO - 19  XUL!nsObserverService::NotifyObservers(nsISupports*, char const*, char16_t const*) [nsObserverService.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 292 + 0x18]
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      rbx = 0x0000000000000000    rbp = 0x00007ffee0a03240
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      rsp = 0x00007ffee0a03130    r12 = 0x0000000113538178
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      r13 = 0x000000011d552645    r14 = 0x0000000000000000
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      r15 = 0x0000006535b39376    rip = 0x0000000113a78648
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO - 20  XUL!mozilla::AppShutdown::AdvanceShutdownPhaseInternal(mozilla::ShutdownPhase, bool, char16_t const*, nsCOMPtr<nsISupports> const&) [AppShutdown.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 372 + 0xf]
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      rbx = 0x0000000000000008    rbp = 0x00007ffee0a03290
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      rsp = 0x00007ffee0a03250    r12 = 0x00007ffee0a032c0
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      r13 = 0x0000000000000000    r14 = 0x0000000000000000
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      r15 = 0x000000011d552645    rip = 0x00000001139f6093
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO - 21  XUL!mozilla::ShutdownXPCOM(nsIServiceManager*) [XPCOMInit.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 623 + 0xe]
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      rbx = 0x00007ffee0a032c0    rbp = 0x00007ffee0a03330
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      rsp = 0x00007ffee0a032a0    r12 = 0x000000010f5c21c0
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      r13 = 0x0000000000000000    r14 = 0x000000010f590ac8
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -      r15 = 0x00007ffee0a03460    rip = 0x0000000113b6f1c3
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.960Z] 17:20:39     INFO - 22  XUL!ScopedXPCOMStartup::~ScopedXPCOMStartup() [nsAppRunner.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 2049 + 0x7]
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rbx = 0x0000000000000000    rbp = 0x00007ffee0a033c0
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rsp = 0x00007ffee0a03340    r12 = 0x000000010f5c21c0
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r13 = 0x0000000000000000    r14 = 0x000000010f50d378
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r15 = 0x00007ffee0a03460    rip = 0x0000000119915646
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -     Found by: call frame info[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO - 23  XUL!XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) [nsAppRunner.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 5954 + 0x18]
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rbx = 0x000000010f50d378    rbp = 0x00007ffee0a03450
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rsp = 0x00007ffee0a033d0    r12 = 0x000000010f5c21c0
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r13 = 0x0000000000000000    r14 = 0x0000000000000000
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r15 = 0x00007ffee0a03460    rip = 0x00000001199233d5
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO - 24  XUL!XRE_main(int, char**, mozilla::BootstrapConfig const&) [nsAppRunner.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 5992 + 0xf]
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rbx = 0x0000000000000005    rbp = 0x00007ffee0a03590
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rsp = 0x00007ffee0a03460    r12 = 0x00007ffee0a03460
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r13 = 0x0000000000000005    r14 = 0x00007ffee0a035c0
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r15 = 0x00007ffee0a03a38    rip = 0x0000000119923c15
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO - 25  firefox!main [nsBrowserApp.cpp:46fce4bc8cd488edfcf904febadba61be749708f : 397 + 0x115]
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rbx = 0x00007ffee0a03d49    rbp = 0x00007ffee0a03a10
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rsp = 0x00007ffee0a035a0    r12 = 0x000000010f1fe343
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r13 = 0x0000000000000005    r14 = 0x00007ffee0a03a38
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r15 = 0x000000000000006d    rip = 0x000000010f1fc06e
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -     Found by: call frame info
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO - 26  libdyld.dylib!start + 0x0
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rbx = 0x0000000000000000    rbp = 0x00007ffee0a03a28
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      rsp = 0x00007ffee0a03a20    r12 = 0x0000000000000000
[task 2022-05-16T17:20:39.961Z] 17:20:39     INFO -      r13 = 0x0000000000000000    r14 = 0x0000000000000000
[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO -      r15 = 0x0000000000000000    rip = 0x00007fff737e2cc9
[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO -     Found by: call frame info[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO - 27  libdyld.dylib!start + 0x0
[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO -      rbx = 0x0000000000000000    rbp = 0x00007ffee0a03a28
[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO -      rsp = 0x00007ffee0a03a28    r12 = 0x0000000000000000
[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO -      r13 = 0x0000000000000000    r14 = 0x0000000000000000
[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO -      r15 = 0x0000000000000000    rip = 0x00007fff737e2cc9
[task 2022-05-16T17:20:39.962Z] 17:20:39     INFO -     Found by: call frame info
```
Windows crash seems to be on startup",STACK_TRACE,0,FULL_TOKEN
1769748,2,"A successfull test execution is fast:
```
[task 2022-05-16T14:14:59.358Z] 14:14:59     INFO - TEST-START | dom/canvas/test/webgl-mochitest/test_video_fastpath_mp4.html
[task 2022-05-16T14:14:59.430Z] 14:14:59     INFO - GECKO(6052) | [Child 5428, Main Thread] WARNING: Failed to bind API to GL!: file /builds/worker/checkouts/gecko/gfx/gl/GLContextProviderEGL.cpp:622
[task 2022-05-16T14:14:59.430Z] 14:14:59     INFO - GECKO(6052) | [Child 5428, Main Thread] WARNING: Failed to create GLContext from PBuffer: file /builds/worker/checkouts/gecko/gfx/gl/GLContextProviderEGL.cpp:1159
[task 2022-05-16T14:14:59.431Z] 14:14:59     INFO - GECKO(6052) | [Child 5428, Main Thread] WARNING: Failed to create EGLContext with khr_rbab_attribs: file /builds/worker/checkouts/gecko/gfx/gl/GLContextProviderEGL.cpp:720
[task 2022-05-16T14:14:59.431Z] 14:14:59     INFO - GECKO(6052) | Initializing context 000001B79D7EE000 surface 000001B795C7DCC0 on display 000001B79C607700
[task 2022-05-16T14:14:59.620Z] 14:14:59     INFO - GECKO(6052) | ### XPCOM_MEM_BLOAT_LOG defined -- logging bloat/leaks to C:\Users\task_165270933684606\AppData\Local\Temp\tmpn2fbyuwz.mozrunner\runtests_leaks_rdd_pid4844.log
[task 2022-05-16T14:14:59.620Z] 14:14:59     INFO - GECKO(6052) | [4844, Main Thread] WARNING: XPCOM_MEM_BLOAT_LOG is set, disabling native allocations.: file /builds/worker/checkouts/gecko/tools/profiler/core/platform.cpp:339
[task 2022-05-16T14:14:59.816Z] 14:14:59     INFO - GECKO(6052) | MEMORY STAT | vsize 7063MB | vsizeMaxContiguous 80980577MB | residentFast 250MB | heapAllocated 11MB
[task 2022-05-16T14:14:59.833Z] 14:14:59     INFO - TEST-OK | dom/canvas/test/webgl-mochitest/test_video_fastpath_mp4.html | took 475ms
```
It could still be that we are getting `IsShutdown()` while starting the process, and then this is no different than bug 1769624",PROBLEM_REVIEW,0,FULL_TOKEN
1769748,3,Set release status flags based on info from the regressing bug 1769547,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1769748,4,"From https://treeherder.mozilla.org/jobs?repo=try&revision=15f854fcde646992c271cd6cf43b8b3a7fb67f5e: 
 - seems like it's not a shutdown issue
 - seems like it's not intermittent",PROBLEM_REVIEW,0,FULL_TOKEN
1769748,5,"It looks like this has become [perma](https://treeherder.mozilla.org/jobs?repo=autoland&selectedTaskRun=XCe984CNTLmOn61wOvJ8Ew.0&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel&fromchange=63ba821ba5280c2052c690e5b4376d04e423b483&searchStr=windows%2C10%2Cx64%2C2004%2Cmingw%2Cwebrender%2Cdebug%2Cmochitests%2Cwith%2Cwebgl%2Cover%2Cipc%2Cwith%2Cfission%2Cenabled%2Ctest-windows10-64-2004-mingwclang-qr%2Fdebug-mochitest-webgl2-ext-gli-fis-e10s%2Cgl2e2).
Could you take a look? 
Thanks",PROBLEM_REVIEW,0,FULL_TOKEN
1769748,6,(In reply to Atila Butkovits from comment #4),UNCODED,0,UNMATCHED
1769748,7,"Weird. According to https://treeherder.mozilla.org/jobs?repo=try&revision=75b643d11393c983fc10833139f301dd5b35787a even RDD decoder does not work on try for that platform.
However, a local build running on a win10-64 VM is able to perform audio decoding on both RDD or Utility",PROBLEM_REVIEW,0,FULL_TOKEN
1769748,8,"Created attachment 9277007
Bug 1769748 - Disable dynamic code mitigation on MinGW64 builds r?bobowen!
Depends on D146639",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1769748,9,"64 failures in 667 pushes (0.096 failures/push) were associated with this bug yesterday.
Repository breakdown:
* autoland: 36
* mozilla-central: 28
Platform and build breakdown:
* windows10-64-2004-mingwclang-qr: 64
  * debug: 64
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1769748&startday=2022-05-17&endday=2022-05-17&tree=all",UNCODED,0,UNMATCHED
1769748,10,https://treeherder.mozilla.org/jobs?repo=try&revision=009f4439b1d5e3b3994dfc735b165774ce5c7869,UNCODED,0,UNMATCHED
1769748,11,"Pushed by alissy@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/465b8737f9fd
Disable dynamic code mitigation on MinGW64 builds r=bobowen",UNCODED,0,UNMATCHED
1769748,12,https://hg.mozilla.org/mozilla-central/rev/465b8737f9fd,UNCODED,0,UNMATCHED
1769748,13,"Does ""Investiate"" in comment mean ""Investigate""?",UNCODED,0,UNMATCHED
1769748,14,"60 failures in 585 pushes (0.103 failures/push) were associated with this bug yesterday.
Repository breakdown:
* mozilla-central: 28
* autoland: 32
Platform and build breakdown:
* windows10-64-2004-mingwclang-qr: 58
  * debug: 58
* windows10-32-2004-mingwclang-qr: 1
  * debug: 1
* macosx1015-64-qr: 1
  * debug: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1769748&startday=2022-05-18&endday=2022-05-18&tree=all",UNCODED,0,UNMATCHED
1769748,15,making fun of people is not fun,UNCODED,0,UNMATCHED
1769748,16,"so yes, I made a typo",UNCODED,0,UNMATCHED
1769748,17,"124 failures in 2694 pushes (0.046 failures/push) were associated with this bug in the last 7 days.
This is the #8 most frequent failure this week.
** This failure happened more than 75 times this week! Resolving this bug is a very high priority. ** 
** Try to resolve this bug as soon as possible. If unresolved for 1 week, the affected test(s) may be disabled. ** 
Repository breakdown:
* autoland: 68
* mozilla-central: 56
Platform and build breakdown:
* windows10-64-2004-mingwclang-qr: 122
  * debug: 122
* windows10-32-2004-mingwclang-qr: 1
  * debug: 1
* macosx1015-64-qr: 1
  * debug: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1769748&startday=2022-05-16&endday=2022-05-22&tree=all",UNCODED,0,UNMATCHED
1774026,1,"Perhaps bug 1772839 is because the when one compositor is paused the egl surface is still current, so does not get destroyed and detached from the Android Surface. Then when the next compositor is resumed we fail to create the new surface.
Just wild speculation, but worth a try.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1774026,2,"Created attachment 9281039
Bug 1774026 - Make EGL Surface non-current before destroying. r?#gfx-reviewers
This is a purely speculative attempt to fix bug 1772839. The theory
being perhaps that due to the EGL Surface being current,
eglDestroySurface does not detach it from the Android Surface. This
would cause the subsequent eglCreateWindowSurface to fail as the
Android Surface is still attached.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1774026,3,"For the record this is what we used to do with layers: `CompositorOGL::Pause` called `GLContextProviderEGL::ReleaseSurface()`, which called `eglMakeCurrent(EGL_NO_SURFACE, EGL_NO_SURFACE, EGL_NO_CONTEXT)`.
But then again, we also used to silently ignore the error when we couldn't create a surface, so it's possible the root cause of bug 1772839 has existed for years.",SOLUTION_REVIEW,1,FULL_TOKEN
1774026,4,"Pushed by jnicol@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/ad0d465dcf91
Make EGL Surface non-current before destroying. r=gfx-reviewers,aosmond",UNCODED,0,UNMATCHED
1774026,5,https://hg.mozilla.org/mozilla-central/rev/ad0d465dcf91,UNCODED,0,UNMATCHED
1774026,6,"It's definitely too early to tell definitively whether this has worked, but there's been no crashes on nightly in the 24h since it shipped. Let's uplift to beta.",UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1774026,7,"Comment on attachment 9281039
Bug 1774026 - Make EGL Surface non-current before destroying. r?#gfx-reviewers
### Beta/Release Uplift Approval Request
* **User impact if declined**: Crashes for some Android 9 users. Not entirely confident this will fix it but it seems worthwhile trying.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: 
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Obviously drivers can have bugs, but there should be no problem calling eglMakeCurrent(NO_SURFACE) before we call eglDestroySurface. - we must call eglMakeCurrent again prior to rendering anything anyway.
This is also what we used to do when using the old layers compositor.
* **String changes made/needed**: 
* **Is Android affected?**: Yes",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1774026,8,"Comment on attachment 9281039
Bug 1774026 - Make EGL Surface non-current before destroying. r?#gfx-reviewers
A couple crashes have come in on nightly since this patch landed, so it doesn't appear to have worked.",SOLUTION_VERIFICATION,0,FULL_TEXT
1778644,1,"STR (with NVDA + CTW):
1. Open https://treeherder.mozilla.org/jobs?repo=try&selectedTaskRun=boxco99xQLiWqSj6L1hzqQ.0&revision=6664ba8aa4f29c6ad352243cfee1646dd09b12a8
2. Press t to navigate to the table.
    - Expected: NVDA should move to the jobs table.
    - Actual: NVDA says: ""no next table""
This doesn't happen when CTW is disabled. My guess (not yet verified) is that when the table is added to the tree, it is considered a layout table, but it then mutates such that it's not a layout table. We aren't handling that mutation correctly.
This will probably be fixed by pushing a cache update for layout-guess if children are added or removed from the table.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1778644,2,"Created attachment 9284869
Bug 1778644: When a row is added to a table, push a cache update for the table's layout guess.",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1778644,3,"Pushed by jteh@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/8c19a2c5a423
When a row is added to a table, push a cache update for the table's layout guess. r=morgan",UNCODED,0,UNMATCHED
1778644,4,https://hg.mozilla.org/mozilla-central/rev/8c19a2c5a423,UNCODED,0,UNMATCHED
1790543,1,"The following testcase crashes on mozilla-central revision 20220912-b66bbbcc4467 (debug build, run with --fuzzing-safe --ion-offthread-compile=off):
    __proto__[0] = a = [];
    for (;;)
      a.push(0);
Backtrace:
    received signal SIGSEGV, Segmentation fault.
    #0  0x00005555577ff895 in js::jit::ArrayPushDense(JSContext*, JS::Handle<js::ArrayObject*>, JS::Handle<JS::Value>, unsigned int*) ()
    #1  0x000013ff8c2109c4 in ?? ()
    #2  0x0000000000000000 in ?? ()
    rax	0x555555842fc1	93824995307457
    rbx	0x7ffff4e44010	140737301987344
    rcx	0x5555582cdae8	93825039915752
    rdx	0x0	0
    rsi	0x7ffff7105770	140737338431344
    rdi	0x7ffff7104540	140737338426688
    rbp	0x7fffffffbd00	140737488338176
    rsp	0x7fffffffbcd0	140737488338128
    r8	0x7ffff7105770	140737338431344
    r9	0x7ffff7f99800	140737353717760
    r10	0x0	0
    r11	0x0	0
    r12	0x7ffff602a100	140737320755456
    r13	0x7fffffffbd48	140737488338248
    r14	0x7fffffffbd20	140737488338208
    r15	0x7fffffffbd50	140737488338256
    rip	0x5555577ff895 <js::jit::ArrayPushDense(JSContext*, JS::Handle<js::ArrayObject*>, JS::Handle<JS::Value>, unsigned int*)+501>
    => 0x5555577ff895 <_ZN2js3jit14ArrayPushDenseEP9JSContextN2JS6HandleIPNS_11ArrayObjectEEENS4_INS3_5ValueEEEPj+501>:	movl   $0x28e,0x0
       0x5555577ff8a0 <_ZN2js3jit14ArrayPushDenseEP9JSContextN2JS6HandleIPNS_11ArrayObjectEEENS4_INS3_5ValueEEEPj+512>:	callq  0x555556c349f4 <abort>
This happens with high frequency, marking as fuzzblocker.",STACK_TRACE,0,FULL_TOKEN
1790543,2,"Created attachment 9294378
Detailed Crash Information",UNCODED,0,UNMATCHED
1790543,3,"Created attachment 9294379
Testcase",UNCODED,0,UNMATCHED
1790543,4,"Created attachment 9294391
Bug 1790543: Remove an overzealous assertion. r=jandem!
The assertion also rejects (non-frozen) dense elements on the prototype chain,
even though those are actually allowed.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1790543,5,"Pushed by andre.bargull@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/ad955304487e
Remove an overzealous assertion. r=jandem",UNCODED,0,UNMATCHED
1790543,6,"**Bugmon Analysis**
Verified bug as reproducible on mozilla-central 20220912214055-b66bbbcc4467.
The bug appears to have been introduced in the following build range:",UNCODED,0,UNMATCHED
1790543,7,Setting `Regressed by` field after analyzing regression range found by bugmon in comment #5.,ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1790543,8,Set release status flags based on info from the regressing bug 1790275,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1790543,9,https://hg.mozilla.org/mozilla-central/rev/ad955304487e,UNCODED,0,UNMATCHED
1790543,10,"**Bugmon Analysis**
Verified bug as fixed on rev mozilla-central 20220913154221-26065fde0af4.
Removing bugmon keyword as no further action possible.  Please review the bug and re-add the keyword for further analysis.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1792203,2,"Created attachment 9295982
Bug 1792203 - Add gtest coverage for AsyncBlockers r?nika!",UNCODED,0,UNMATCHED
1792203,3,"Created attachment 9295986
Bug 1792203 - Immediately resolve AsyncBlockers when no blocker are registered r?nika!
Depends on D158025",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1792203,4,"The severity field is not set for this bug.
:jld, could you have a look please?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_severity.py).",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1792203,5,I'm getting some weird asan issue: https://treeherder.mozilla.org/logviewer?job_id=394095938&repo=try&lineNumber=12188,SOLUTION_VERIFICATION,0,FULL_TEXT
1792203,6,"Pushed by alissy@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/862f59a3f38c
Add gtest coverage for AsyncBlockers r=nika
https://hg.mozilla.org/integration/autoland/rev/b597f145ec59
Immediately resolve AsyncBlockers when no blocker are registered r=nika",UNCODED,0,UNMATCHED
1792203,7,"Backed out for causing Gtest failures.
Backout link: https://hg.mozilla.org/integration/autoland/rev/77643f3c53d4e7316174f9a220a5aae9fb965ddb
Push with failures: https://treeherder.mozilla.org/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel&revision=b597f145ec5933fbbc8f11130b0b4cadd31832b6&selectedTaskRun=HI3ooE0mQzu1suJQQ7USKQ.0
Failure log: https://treeherder.mozilla.org/logviewer?job_id=394180955&repo=autoland&lineNumber=4520",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1792203,8,"Pushed by alissy@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/119c65339140
Add gtest coverage for AsyncBlockers r=nika
https://hg.mozilla.org/integration/autoland/rev/d9048386628e
Immediately resolve AsyncBlockers when no blocker are registered r=nika",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1792203,9,"Backed out for causing gtest failures.
[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception%2Crunnable&searchStr=gtest&tochange=d9048386628eedc94975c56a563dea59e604d9ce&fromchange=59151d6a9b0b543c1f0146678bb1d645217bc405&selectedTaskRun=GAVKgd9QQk6siJtOrteaDg.0)
[Failure log](https://treeherder.mozilla.org/logviewer?job_id=394293580&repo=autoland&lineNumber=11508)
we also got the time out followed by this crash: https://treeherder.mozilla.org/logviewer?job_id=394287507&repo=autoland&lineNumber=11515
[Backout link](https://hg.mozilla.org/integration/autoland/rev/f5fd4153fbb4361606c51e1a704b60cd69c017a0)
```
[task 2022-10-25T18:34:01.522Z] 18:34:01     INFO -  TEST-START | TestAsyncBlockers.DeregisterEmpty
[task 2022-10-25T18:34:01.763Z] 18:34:01     INFO -  Running GTest tests...
[task 2022-10-25T18:39:02.214Z] 18:39:02     INFO -  gtest INFO | gtest | process wait complete, returncode=5
[task 2022-10-25T18:39:02.215Z] 18:39:02  WARNING -  gtest TEST-UNEXPECTED-FAIL | gtest | timed out after 300 seconds without output
[task 2022-10-25T18:39:02.215Z] 18:39:02     INFO -  mozcrash checking /opt/worker/tasks/task_166672249260018/build/tests/gtest for minidumps...
[task 2022-10-25T18:39:02.215Z] 18:39:02     INFO -  mozcrash INFO | Downloading symbols from: https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/Mm1pD--kSHCrboCql7iUbg/artifacts/public/build/target.crashreporter-symbols.zip
[task 2022-10-25T18:39:22.382Z] 18:39:22     INFO -  mozcrash INFO | Copy/paste: /opt/worker/tasks/task_166672249260018/fetches/minidump-stackwalk/minidump-stackwalk --symbols-url=https://symbols.mozilla.org/ --human /opt/worker/tasks/task_166672249260018/build/tests/gtest/FD101C90-9AAD-40A6-9A36-85CB3A332285.dmp /var/folders/g7/vplxp93107b0ynpl9047dz78000014/T/tmp906ywwyg
[task 2022-10-25T18:39:30.195Z] 18:39:30     INFO -  mozcrash INFO | Saved minidump as /opt/worker/tasks/task_166672249260018/build/blobber_upload_dir/FD101C90-9AAD-40A6-9A36-85CB3A332285.dmp
[task 2022-10-25T18:39:30.195Z] 18:39:30     INFO -  mozcrash INFO | Saved app info as /opt/worker/tasks/task_166672249260018/build/blobber_upload_dir/FD101C90-9AAD-40A6-9A36-85CB3A332285.extra
[task 2022-10-25T18:39:30.195Z] 18:39:30  WARNING -  PROCESS-CRASH | gtest | application crashed [@ read + 0xa]
[task 2022-10-25T18:39:30.196Z] 18:39:30     INFO -  Crash dump filename: /opt/worker/tasks/task_166672249260018/build/tests/gtest/FD101C90-9AAD-40A6-9A36-85CB3A332285.dmp
[task 2022-10-25T18:39:30.196Z] 18:39:30     INFO -  Operating system: Mac OS X
[task 2022-10-25T18:39:30.196Z] 18:39:30     INFO -                    10.15.7 19H524
[task 2022-10-25T18:39:30.196Z] 18:39:30     INFO -  CPU: amd64
[task 2022-10-25T18:39:30.196Z] 18:39:30     INFO -       family 6 model 158 stepping 10
[task 2022-10-25T18:39:30.196Z] 18:39:30     INFO -       12 CPUs
[task 2022-10-25T18:39:30.197Z] 18:39:30     INFO -  Crash reason:  EXC_SOFTWARE / SIGABRT
[task 2022-10-25T18:39:30.197Z] 18:39:30     INFO -  Crash address: 0x7fff6ddc581e
[task 2022-10-25T18:39:30.197Z] 18:39:30     INFO -  Mac Crash Info:
[task 2022-10-25T18:39:30.197Z] 18:39:30     INFO -  Process uptime: 523 seconds
[task 2022-10-25T18:39:30.197Z] 18:39:30     INFO -  Thread 0 MainThread (crashed)
[task 2022-10-25T18:39:30.198Z] 18:39:30     INFO -   0  libsystem_kernel.dylib!read + 0xa
[task 2022-10-25T18:39:30.198Z] 18:39:30     INFO -       rax = 0x0000000000000004    rdx = 0x0000000000000001
[task 2022-10-25T18:39:30.198Z] 18:39:30     INFO -       rcx = 0x00007ffeeca8f398    rbx = 0x0000000112da9ce0
[task 2022-10-25T18:39:30.198Z] 18:39:30     INFO -       rsi = 0x00007ffeeca8f48f    rdi = 0x0000000000000021
[task 2022-10-25T18:39:30.198Z] 18:39:30     INFO -       rbp = 0x00007ffeeca8f5e0    rsp = 0x00007ffeeca8f398
[task 2022-10-25T18:39:30.199Z] 18:39:30     INFO -        r8 = 0x00000000000130a8     r9 = 0x0000000000000000
[task 2022-10-25T18:39:30.199Z] 18:39:30     INFO -       r10 = 0x93b21e9073cb00f1    r11 = 0x0000000000000206
[task 2022-10-25T18:39:30.199Z] 18:39:30     INFO -       r12 = 0x0000000112da9ce0    r13 = 0x0000000103860670
[task 2022-10-25T18:39:30.199Z] 18:39:30     INFO -       r14 = 0x00007ffeeca8f48f    r15 = 0x0000000103466400
[task 2022-10-25T18:39:30.200Z] 18:39:30     INFO -       rip = 0x00007fff6ddc581e
[task 2022-10-25T18:39:30.200Z] 18:39:30     INFO -      Found by: given as instruction pointer in context
[task 2022-10-25T18:39:30.200Z] 18:39:30     INFO -   1  XUL!testing::internal::ForkingDeathTest::Wait() [gtest-death-test.cc:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 1086 + 0x4]
[task 2022-10-25T18:39:30.200Z] 18:39:30     INFO -       rbp = 0x00007ffeeca8f710    rsp = 0x00007ffeeca8f5f0
[task 2022-10-25T18:39:30.201Z] 18:39:30     INFO -       rip = 0x00000001080a5124
[task 2022-10-25T18:39:30.201Z] 18:39:30     INFO -      Found by: previous frame's frame pointer
[task 2022-10-25T18:39:30.201Z] 18:39:30     INFO -   2  XUL!TestAsyncBlockers_DeregisterEmpty_Test::TestBody() [TestAsyncBlockers.cpp:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 177 + 0x3e]
[task 2022-10-25T18:39:30.201Z] 18:39:30     INFO -       rbx = 0x0000000112da9ce0    rbp = 0x00007ffeeca8f7e0
[task 2022-10-25T18:39:30.201Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8f720    r12 = 0x0000000112da9ce0
[task 2022-10-25T18:39:30.202Z] 18:39:30     INFO -       r13 = 0x0000000103860670    r14 = 0x00000001034c1070
[task 2022-10-25T18:39:30.202Z] 18:39:30     INFO -       r15 = 0x0000000103466400    rip = 0x0000000107e06345
[task 2022-10-25T18:39:30.202Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.202Z] 18:39:30     INFO -   3  XUL!testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*)
[task 2022-10-25T18:39:30.203Z] 18:39:30     INFO -      Found by: inlining
[task 2022-10-25T18:39:30.203Z] 18:39:30     INFO -   4  XUL!testing::Test::Run() [gtest.cc:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 2674 + 0x17]
[task 2022-10-25T18:39:30.203Z] 18:39:30     INFO -       rbx = 0x0000000112da3fa0    rbp = 0x00007ffeeca8f810
[task 2022-10-25T18:39:30.203Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8f7f0    r12 = 0x0000000112da3fa0
[task 2022-10-25T18:39:30.204Z] 18:39:30     INFO -       r13 = 0x0000000103860670    r14 = 0x00000001034c1070
[task 2022-10-25T18:39:30.204Z] 18:39:30     INFO -       r15 = 0x0000000103466400    rip = 0x00000001080b6f19
[task 2022-10-25T18:39:30.204Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.204Z] 18:39:30     INFO -   5  XUL!testing::TestInfo::Run() [gtest.cc:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 2853 + 0x7]
[task 2022-10-25T18:39:30.204Z] 18:39:30     INFO -       rbx = 0x000000010385e1c0    rbp = 0x00007ffeeca8f850
[task 2022-10-25T18:39:30.205Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8f820    r12 = 0x0000000112da3fa0
[task 2022-10-25T18:39:30.205Z] 18:39:30     INFO -       r13 = 0x0000000103860670    r14 = 0x00000001034c1070
[task 2022-10-25T18:39:30.205Z] 18:39:30     INFO -       r15 = 0x0000000103466400    rip = 0x00000001080b7f09
[task 2022-10-25T18:39:30.205Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.206Z] 18:39:30     INFO -   6  XUL!testing::TestSuite::Run() [gtest.cc:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 3012 + 0x4]
[task 2022-10-25T18:39:30.206Z] 18:39:30     INFO -       rbx = 0x00000001034c1070    rbp = 0x00007ffeeca8f8a0
[task 2022-10-25T18:39:30.206Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8f860    r12 = 0x0000000000000000
[task 2022-10-25T18:39:30.206Z] 18:39:30     INFO -       r13 = 0x2e8ba2e8ba2e8ba3    r14 = 0x000000010385d280
[task 2022-10-25T18:39:30.207Z] 18:39:30     INFO -       r15 = 0x0000000000000005    rip = 0x00000001080b8a3e
[task 2022-10-25T18:39:30.207Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.207Z] 18:39:30     INFO -   7  XUL!testing::internal::UnitTestImpl::RunAllTests() [gtest.cc:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 5870 + 0x4]
[task 2022-10-25T18:39:30.207Z] 18:39:30     INFO -       rbx = 0x00000000000000a9    rbp = 0x00007ffeeca8f960
[task 2022-10-25T18:39:30.208Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8f8b0    r12 = 0x0000000103466400
[task 2022-10-25T18:39:30.208Z] 18:39:30     INFO -       r13 = 0x0000000000001b6d    r14 = 0x0000000000000000
[task 2022-10-25T18:39:30.208Z] 18:39:30     INFO -       r15 = 0x0000000103466618    rip = 0x00000001080c752e
[task 2022-10-25T18:39:30.208Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.209Z] 18:39:30     INFO -   8  XUL!testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool>(testing::internal::UnitTestImpl*, bool (testing::internal::UnitTestImpl::*)(), char const*)
[task 2022-10-25T18:39:30.209Z] 18:39:30     INFO -      Found by: inlining
[task 2022-10-25T18:39:30.209Z] 18:39:30     INFO -   9  XUL!testing::UnitTest::Run() [gtest.cc:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 5444 + 0x12]
[task 2022-10-25T18:39:30.209Z] 18:39:30     INFO -       rbx = 0x0000000103466400    rbp = 0x00007ffeeca8f9a0
[task 2022-10-25T18:39:30.210Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8f970    r12 = 0x0000000103484be0
[task 2022-10-25T18:39:30.210Z] 18:39:30     INFO -       r13 = 0x0000000000000000    r14 = 0x00000001034665f0
[task 2022-10-25T18:39:30.210Z] 18:39:30     INFO -       r15 = 0x00007ffeeca8fc70    rip = 0x00000001080c6bdf
[task 2022-10-25T18:39:30.210Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.211Z] 18:39:30     INFO -  10  XUL!RUN_ALL_TESTS() [gtest.h:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 2295]
[task 2022-10-25T18:39:30.211Z] 18:39:30     INFO -      Found by: inlining
[task 2022-10-25T18:39:30.211Z] 18:39:30     INFO -  11  XUL!mozilla::RunGTestFunc(int*, char**) [GTestRunner.cpp:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 167 + 0xc]
[task 2022-10-25T18:39:30.211Z] 18:39:30     INFO -       rbx = 0x00007ffeeca8fa00    rbp = 0x00007ffeeca8fab0
[task 2022-10-25T18:39:30.212Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8f9b0    r12 = 0x0000000103484be0
[task 2022-10-25T18:39:30.212Z] 18:39:30     INFO -       r13 = 0x0000000000000000    r14 = 0x00000001034665f0
[task 2022-10-25T18:39:30.212Z] 18:39:30     INFO -       r15 = 0x00007ffeeca8fc70    rip = 0x0000000108098fb6
[task 2022-10-25T18:39:30.212Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.213Z] 18:39:30     INFO -  12  XUL!XREMain::XRE_mainStartup(bool*) [nsAppRunner.cpp:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 4771 + 0xf]
[task 2022-10-25T18:39:30.213Z] 18:39:30     INFO -       rbx = 0x00007ffeeca8fc18    rbp = 0x00007ffeeca8fbe0
[task 2022-10-25T18:39:30.213Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8fac0    r12 = 0x0000000103484be0
[task 2022-10-25T18:39:30.213Z] 18:39:30     INFO -       r13 = 0x0000000000000000    r14 = 0x00007ffeeca8fbf0
[task 2022-10-25T18:39:30.213Z] 18:39:30     INFO -       r15 = 0x00007ffeeca8fc70    rip = 0x000000010ce56604
[task 2022-10-25T18:39:30.214Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.214Z] 18:39:30     INFO -  13  XUL!XREMain::XRE_main(int, char**, mozilla::BootstrapConfig const&) [nsAppRunner.cpp:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 5904 + 0x7]
[task 2022-10-25T18:39:30.214Z] 18:39:30     INFO -       rbx = 0x00007ffeeca8fc18    rbp = 0x00007ffeeca8fc60
[task 2022-10-25T18:39:30.214Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8fbf0    r12 = 0x0000000103484be0
[task 2022-10-25T18:39:30.214Z] 18:39:30     INFO -       r13 = 0x0000000000000000    r14 = 0x00007ffeeca8fdd0
[task 2022-10-25T18:39:30.214Z] 18:39:30     INFO -       r15 = 0x00007ffeeca8fc70    rip = 0x000000010ce5c117
[task 2022-10-25T18:39:30.214Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.215Z] 18:39:30     INFO -  14  XUL!XRE_main(int, char**, mozilla::BootstrapConfig const&) [nsAppRunner.cpp:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 5972 + 0xf]
[task 2022-10-25T18:39:30.215Z] 18:39:30     INFO -       rbx = 0x0000000000000003    rbp = 0x00007ffeeca8fda0
[task 2022-10-25T18:39:30.215Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8fc70    r12 = 0x00007ffeeca8fc70
[task 2022-10-25T18:39:30.215Z] 18:39:30     INFO -       r13 = 0x0000000000000003    r14 = 0x00007ffeeca8fdd0
[task 2022-10-25T18:39:30.216Z] 18:39:30     INFO -       r15 = 0x00007ffeeca90220    rip = 0x000000010ce5c538
[task 2022-10-25T18:39:30.216Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.216Z] 18:39:30     INFO -  15  firefox!do_main(int, char**, char**) [nsBrowserApp.cpp:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 226]
[task 2022-10-25T18:39:30.216Z] 18:39:30     INFO -      Found by: inlining
[task 2022-10-25T18:39:30.217Z] 18:39:30     INFO -  16  firefox!main [nsBrowserApp.cpp:032a7ecf82a89ad3fcd51243d2c0d1f0c212a577 : 428 + 0x18a]
[task 2022-10-25T18:39:30.217Z] 18:39:30     INFO -       rbx = 0x00007ffeeca904ec    rbp = 0x00007ffeeca90200
[task 2022-10-25T18:39:30.217Z] 18:39:30     INFO -       rsp = 0x00007ffeeca8fdb0    r12 = 0x0000000103171ced
[task 2022-10-25T18:39:30.217Z] 18:39:30     INFO -       r13 = 0x0000000000000003    r14 = 0x00007ffeeca90220
[task 2022-10-25T18:39:30.217Z] 18:39:30     INFO -       r15 = 0x0000000000000075    rip = 0x0000000103170579
[task 2022-10-25T18:39:30.218Z] 18:39:30     INFO -      Found by: call frame info
[task 2022-10-25T18:39:30.218Z] 18:39:30     INFO -  17  libdyld.dylib!start + 0x0
[task 2022-10-25T18:39:30.218Z] 18:39:30     INFO -       rbx = 0x0000000000000000    rbp = 0x00007ffeeca90210
[task 2022-10-25T18:39:30.218Z] 18:39:30     INFO -       rsp = 0x00007ffeeca90210    r12 = 0x0000000000000000
[task 2022-10-25T18:39:30.218Z] 18:39:30     INFO -       r13 = 0x0000000000000000    r14 = 0x0000000000000000
[task 2022-10-25T18:39:30.219Z] 18:39:30     INFO -       r15 = 0x0000000000000000    rip = 0x00007fff6dc83cc9
[task 2022-10-25T18:39:30.219Z] 18:39:30     INFO -      Found by: call frame info
```",IMPLEMENTATION_REVERSION,0,90_PCT_MATCH
1792203,10,The crash reports started because of bug 1797104: Now gtest timeouts trigger and report a crash stack (I hope that's helpful!).,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1792203,11,Looks like death gtest is behaving non intuitively on macOS especially in opt and others gtest looks to be avoiding this,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1792203,12,"Pushed by alissy@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/05e994e8e3b5
Add gtest coverage for AsyncBlockers r=nika
https://hg.mozilla.org/integration/autoland/rev/5e334e2e3906
Immediately resolve AsyncBlockers when no blocker are registered r=nika",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1792203,13,"https://hg.mozilla.org/mozilla-central/rev/05e994e8e3b5
https://hg.mozilla.org/mozilla-central/rev/5e334e2e3906",UNCODED,0,UNMATCHED
1794237,1,"There was a recent spike of these crashes in Fenix Nightly 107.0a1, but there was also spike in Fenix 99.1.1 and 99.2.0 for some reason.
Crash report: https://crash-stats.mozilla.org/report/index/0fddf748-6740-42db-98f5-758460221008
Reason: ```SIGBUS / BUS_ADRALN```
Top 10 frames of crashing thread:
```
0 libxul.so mozilla::WebGLContext::UniformData const dom/canvas/WebGLContextGL.cpp:1358
1 libxul.so mozilla::HostWebGLContext::UniformData const dom/canvas/HostWebGLContext.h:598
1 libxul.so mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  const dom/canvas/WebGLCommandQueue.h:246
1 libxul.so std::__ndk1::__invoke_constexpr<mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  /builds/worker/fetches/android-ndk/sources/cxx-stl/llvm-libc++/include/type_traits:3507
1 libxul.so std::__ndk1::__apply_tuple_impl<mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  /builds/worker/fetches/android-ndk/sources/cxx-stl/llvm-libc++/include/tuple:1390
1 libxul.so std::__ndk1::apply<mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  /builds/worker/fetches/android-ndk/sources/cxx-stl/llvm-libc++/include/tuple:1399
1 libxul.so mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  dom/canvas/WebGLCommandQueue.h:237
1 libxul.so mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  dom/canvas/WebGLCommandQueue.h:251
1 libxul.so mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  dom/canvas/WebGLCommandQueue.h:251
1 libxul.so mozilla::MethodDispatcher<mozilla::WebGLMethodDispatcher,  dom/canvas/WebGLCommandQueue.h:251
```",STACK_TRACE,0,FULL_TOKEN
1794237,2,All the crashes come from the GPU process and it seems to be specific to 32-bit builds. There's a wide range of hardware in the crashes (both different device and GPU vendors) so it looks like this isn't a device-specific issue.,PROBLEM_REVIEW,0,FULL_TEXT
1794237,3,"The bug is linked to a topcrash signature, which matches the following [criterion](https://wiki.mozilla.org/CrashKill/Topcrash):
- Top 10 AArch64 and ARM crashes on nightly 
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#topcrash_add_keyword.py).",PROBLEM_REVIEW,0,90_PCT_MATCH
1794237,4,"@ Kelsey and Chun-Min, do you think either of your changes could to have caused this Android WebGLContext crash regression?
* Kelsey preffing on `webgl.out-of-process` on Android in bug 1793679
* Chun-Min implementing VideoFrame in bug 1774300 (which touches some canvas code)
This is an old crash signature, but it spiked in 107.0a1. The earliest 107.0a1 crash reports are from build ID 20221005094233. Here is the pushlog between 2022-10-04 and 20221005094233, which includes both bugs:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=73c16d284362ba24606a516cd454dd3fe395b9b6&tochange=c14f7934269f333be9e65958c7a012899b3123bd
Curiously, 99% of these crash reports are from 32-bit ARM.
About 80% of the crash reports are from the GPU process, 20% from the parent process.",QUESTION,0,FULL_TOKEN
1794237,5,"Two more crash signatures with similar stack traces:
[@ mozilla::gl::GLContext::fUniform1fv]
[@ mozilla::gl::GLContext::fUniform2fv]",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1794237,6,"The bug is marked as tracked for firefox107 (beta). However, the bug still isn't assigned.
:bhood, could you please find an assignee for this tracked bug? If you disagree with the tracking decision, please talk with the release managers.
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#tracked_attention.py).",ASSIGNEE_REQUEST,0,FULL_TOKEN
1794237,7,It's hard to see how bug 1774300 can cause the crash from the stack. Keep NI for now,STATUS_UPDATE,0,FULL_TEXT
1794237,8,"Hey Bob, can we push the remote webgl change back to 108 to avoid shipping with this? (REO triage)",QUESTION,0,FULL_TEXT
1794237,9,"Jamie and I spoke about this yesterday, and he is hinting that OOP WebGL will likely have to be disabled because of the issues that are arising (like this).  I'll emphasis this with him today.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1794237,10,"I'll disable it for beta but keep OOP-webgl enabled on Nightly, in the hopes that a user will come forward with a crashing URL to help us diagnose the crash.",SOLUTION_REVIEW,1,FULL_TEXT
1794237,11,"Created attachment 9300233
Bug 1794237 - Ensure worst case alignment of UniformData Range when serialized. r?jgilbert
The UniformData call accepts a Range<uint8_t>. When serialized by ClientWebGLContext,
however, the data is only serialized to the alignment of the supplied uint8_t type.
The HostWebGLContext may then alias it to a Range<uint32_t> or similar, while the data
was only aligned to 1-byte alignment. On some platforms such as ARM, these unaligned
accesses can cause a SIGBUS.
As a temporary workaround, we will now pessimistically align such ranges as if they
might be accessed as any possible data type with kUniversalAlignment.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1794237,12,"Pushed by lsalzman@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/0cbb0a1bb813
Ensure worst case alignment of UniformData Range when serialized. r=jgilbert",UNCODED,0,UNMATCHED
1794237,13,"Backed out for causing multiple WebGL related failures.
[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&selectedTaskRun=JnLrB34jSHKwRi84brmC-w.0&resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception%2Crunnable&revision=0cbb0a1bb81367d41f3ccfd889113f2666b60211).
 * [Failure log when it fails with Assertion failure: [GFX1]: mBindFailureGuard failure: Generating error <enum 0x0500>: WebGL warning: bindBuffer: target: Invalid enum value <enum 0x0004>, at /builds/worker/checkouts/gecko/gfx/2d/Logging.h:754](https://treeherder.mozilla.org/logviewer?job_id=394326454&repo=autoland&lineNumber=4140)
 * [Failure log when it fails with TEST-UNEXPECTED-FAIL | dom/canvas/test/webgl-conf/generated/test_conformance__offscreencanvas__offscreencanvas-transfer-image-bitmap.html | OffscreenCanvas.webgl: This pixel should be [255, 255, 0, 255], but it is: [255, 0, 0, 255].](https://treeherder.mozilla.org/logviewer?job_id=394327728&repo=autoland&lineNumber=7780)
 * [Failure log when it fails with TEST-UNEXPECTED-FAIL | dom/canvas/test/test_offscreencanvas_toimagebitmap.html | [after gl.clear] gl.readPixels(0,0,1,1) was [0,0,0,0], expected [0,255,0,255]](https://treeherder.mozilla.org/logviewer?job_id=394327205&repo=autoland&lineNumber=1963)
 * [Failure log when it fails with REFTEST TEST-UNEXPECTED-FAIL | dom/canvas/test/reftest/webgl-clear-test.html == dom/canvas/test/reftest/wrapper.html?green.png | image comparison, max difference: 255, number of differing pixels: 65536](https://treeherder.mozilla.org/logviewer?job_id=394326854&repo=autoland&lineNumber=5218)
 * [Failure log when it fails with REFTEST TEST-UNEXPECTED-FAIL | dom/canvas/test/reftest/color_quads.html?e_context=webgl == dom/canvas/test/reftest/color_quads.html?= | image comparison, max difference: 255, number of differing pixels: 130000](https://treeherder.mozilla.org/logviewer?job_id=394327309&repo=autoland&lineNumber=39660)
 * [Failure log when it fails with REFTEST PROCESS-CRASH | Last test finished | application crashed [@ mozilla::gfx::Log<1, mozilla::gfx::CriticalLogger>::WriteLog(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&)]](https://treeherder.mozilla.org/logviewer?job_id=394327815&repo=autoland&lineNumber=17846)
 * [Failure log when it fails with PROCESS-CRASH | /html/canvas/element/manual/imagebitmap/imageBitmapRendering-transferFromImageBitmap-webgl.html | application crashed [@ mozilla::gfx::Log<1, mozilla::gfx::CriticalLogger>::WriteLog(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&)]](https://treeherder.mozilla.org/logviewer?job_id=394330443&repo=autoland&lineNumber=2153)
 * [Failure log when it fails with TEST-UNEXPECTED-FAIL | /html/canvas/offscreen/manual/the-offscreen-canvas/offscreencanvas.resize.html | Verify that writing to the width and height attributes of an OffscreenCanvas works when there is a webgl context attached. - assert_equals: expected 30 but got 1](https://treeherder.mozilla.org/logviewer?job_id=394327217&repo=autoland&lineNumber=4571)
[Backout link](https://hg.mozilla.org/integration/autoland/rev/7c71e9b22862d4f26a1521047bd21adac92d4c3b).",IMPLEMENTATION_REVERSION,0,FULL_TEXT
1794237,14,"Pushed by lsalzman@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/4bf6c23773ea
Ensure worst case alignment of UniformData Range when serialized. r=jgilbert",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1794237,15,https://hg.mozilla.org/mozilla-central/rev/4bf6c23773ea,UNCODED,0,UNMATCHED
1794237,16,"We should disable webgl out-of-process on 107, since we turned it on ""because why not"".",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1794237,17,"Oops, that aspect was fixed in bug 1797347.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1794237,18,":lsalzman/:jnicol sorry for the double needinfo
Bug 1797347 supposedly disabled this in Beta, and made its way to Fenix 107.0b4.
107 is marked as disabled in Bug 1794237
The volume of crashes in the table for 107.0b4 are similar to before it was disabled in Bug 1797347. 
Setting 107 back to affected while this is investigated.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1794237,19,"Jamie, it still looks like out-of-process is enabled in 107 somehow?",QUESTION,0,FULL_TEXT
1794237,20,"Oh, whoops. As Lee points out, `XP_LINUX` evaluates true on Android [here](https://searchfox.org/mozilla-central/rev/a3decf626dabd89620171f0ea7840cc4351fe218/modules/libpref/init/StaticPrefList.yaml#14023), so we are still enabling the pref on Android by accident.",ANSWER_TO_QUESTION,0,90_PCT_MATCH
1794237,21,"Created attachment 9301400
Bug 1794237 - Actually disable OOP webgl on Android on non-nightly. r?lsalzman
This was accidentally left enabled by the previous patch, since
XP_LINUX is true on Android. We must therefore use
    defined(XP_LINUX) && !defined(ANDROID)
instead, as we did prior to enabling OOP webgl on Android in the first
place.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1794237,22,"Comment on attachment 9301400
Bug 1794237 - Actually disable OOP webgl on Android on non-nightly. r?lsalzman
Revision D160951 was moved to bug 1797347. Setting attachment 9301400 to obsolete.",STATUS_UPDATE,0,90_PCT_MATCH
1794237,23,"The patch landed in nightly and beta is affected.
:lsalzman, is this bug important enough to require an uplift?
- If yes, please nominate the patch for beta approval.
- If no, please set `status-firefox107` to `wontfix`.
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).",UPLIFT_NOMINATION_REQUEST,0,FULL_TOKEN
1794237,24,"Follow-up patch in Bug 1797347 uplifted to 107. It will be included in Fenix/Focus 107.0b6.
Setting 107 fixed on this bug, but will monitor Fenix/Focus 107.0b6 stability.",UPLIFT_APPROVAL,0,FULL_TOKEN
1794237,25,"Slight correction, 107 should be disabled",CLARIFICATION,0,FULL_TEXT
1818468,2,"Created attachment 9319436
Bug 1818468 - Throw `signal.reason` when already aborted in `navigator.locks.request` r=evilpie",UNCODED,0,UNMATCHED
1818468,3,"Pushed by krosylight@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/9e364e2eda05
Throw `signal.reason` when already aborted in `navigator.locks.request` r=evilpie",UNCODED,0,UNMATCHED
1818468,4,https://hg.mozilla.org/mozilla-central/rev/9e364e2eda05,UNCODED,0,UNMATCHED
597071,1,"This came out of bug 596592, where entering PB mode with just a popup and then leaving causes the last opened window to reopen.
_getCurrentState is actually lying about the current state when there is a single window open and it's a popup (and there was a recently closed non-popup). It shifts a closed window into the open window list
http://mxr.mozilla.org/mozilla-central/source/browser/components/sessionstore/src/nsSessionStore.js#1953
This is fine for when quitting and we've been doing such for a long time. But I don't think it's the right thing to do when entering/exiting private browsing mode.",PROBLEM_MOTIVATION,0,FULL_TOKEN
597071,2,How can we detect whether _getCurrentState is called during shutdown?,QUESTION,0,FULL_TEXT
597071,3,"if (_this._loadState == STATE_QUITTING)
  // move last closed non-popup
I think we also want to check something about _restoreLastWindow (for the all browser windows are closed, but view-source was left open), since we'll still have STATE_RUNNING.",ANSWER_TO_QUESTION,0,FULL_TOKEN
597071,4,"Created attachment 476464
Patch v0.1
Fix it all up and it even includes a test (win/linux only).
I didn't have a windows machine handy, but Sean has run this and says it passes with the fix, and fails without.",CODE_IMPLEMENTATION,1,FULL_TOKEN
597071,5,"Comment on attachment 476464
Patch v0.1
Dietrich / Dolske: whoever gets to it first wins! I know the timing is pretty crappy, but Panorama needs this to fix a b7 blocker (it really just makes test behavior for some private browsing tests accurate).
It is a bit changy - API consumers will get an accurate state as opposed to the fake state we've been providing.",STATUS_UPDATE,0,FULL_TOKEN
597071,6,"Comment on attachment 476464
Patch v0.1
Alas, I think dietrich should do the review here, I don't know session restore well enough to judge the impact of this. Even though it's a 1-line change.
...
Really? :)",CODE_REVIEW,0,FULL_TEXT
597071,7,"I pushed a workaround for this in bug 596592:
http://hg.mozilla.org/mozilla-central/rev/f1eec85dcfdc
It should be backed out when this bug is fixed.",SOLVED_BY_OTHER_ISSUE,0,FULL_TOKEN
597071,8,"Comment on attachment 476464
Patch v0.1
This makes sense, makes the API more consistent. To make the test only run for Win/Linux, move the check to the makefile so that it doesn't run at all. r=me w/ that change.",CODE_REVIEW,0,FULL_TEXT
597071,9,Sent to try with 595236,STATUS_UPDATE,0,FULL_TEXT
597071,10,"Try server failed this bug's test (timeout) on linux, see try build http://hg.mozilla.org/try/rev/617debdc2f5e",SOLUTION_VERIFICATION,0,FULL_TEXT
597071,11,"Rather, here's the proper build log: http://tinderbox.mozilla.org/showlog.cgi?log=MozillaTry/1285017295.1285018434.11888.gz&fulltext=1",CLARIFICATION,0,FULL_TEXT
597071,12,"Created attachment 477282
Patch v1.0 (for checkin)
Used #ifndef XP_MACOSX in the Makefile to target win/linux. Also moved the listener off the tabContainer to gBrowser, since that's what was most likely causing the timeout (tabContainer doesn't capture page loads, just favicons)",CODE_IMPLEMENTATION,1,FULL_TEXT
597071,13,Pushed http://hg.mozilla.org/mozilla-central/rev/03a1f45d2099,UNCODED,0,UNMATCHED
597071,14,Pushed http://hg.mozilla.org/mozilla-central/rev/7b85cdce3ea6 to followup on the bustage. I can't do what I had done in the Makefile (don't know why it worked locally!),CODE_IMPLEMENTATION,1,FULL_TEXT
658675,1,"When using a slow-ish internet connection, the captcha wizard page is a UX nightmare. There's little to no indication that there's even something loading. When using a custom server, we briefly display the page until we find out that there's a 404 and we move on. That flicker should also go away.
The solution that I'm proposing is to preload the captcha as soon as the user decides to create a new sync account rather than connect to an existing one.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
658675,2,"Tricky bit is custom servers, each server has a separate captcha keypair, so I wouldn't prefetch then.  There's definitely room for prefetching though, maybe once we have a validated username?",SOLUTION_REVIEW,1,FULL_TOKEN
658675,3,"Yes, when the user changes the server setting to use a custom server, we'll have to refetch the captcha. But given how few people do that, I'm willing to accept that. I'm not sure what the captcha has to do with the username at all.",ANSWER_TO_QUESTION,0,FULL_TEXT
658675,4,"Created attachment 537459
v1",UNCODED,0,UNMATCHED
658675,5,"Comment on attachment 537459
v1
Review of attachment 537459:
-----------------------------------------------------------------
OK, this looks good to me. Really need a way of testing with a 404 captcha page, though.",CODE_REVIEW,0,FULL_TEXT
658675,6,"I tested with server-full running on localhost (it has captchas disabled by default), but I've just noticed a small problem with the last wizard page, it doesn't always close properly, probably because of my wizard.pageIndex hackery. New patch coming up.",CODE_REVIEW,0,FULL_TEXT
658675,7,"Created attachment 537475
v2
Use wizard.advance() instead of manipulating wizard.pageIndex and move this piece of code from onWizardAdvance to onPageShow to avoid infinite recursion.
Also don't call Service.login(). It made closing the wizard kind of slow and jerky and it's so not needed anymore.
Asking for review again for those two changes.",CODE_IMPLEMENTATION,1,FULL_TOKEN
658675,8,"Comment on attachment 537475
v2
Review of attachment 537475:
-----------------------------------------------------------------
Looks good to me.",CODE_REVIEW,0,FULL_TEXT
658675,9,http://hg.mozilla.org/services/services-central/rev/c69124dfd7b7,UNCODED,0,UNMATCHED
658675,10,verified with latest s-c builds,SOLUTION_VERIFICATION,0,FULL_TEXT
658675,11,http://hg.mozilla.org/mozilla-central/rev/c69124dfd7b7,UNCODED,0,UNMATCHED
667586,1,"Steps to reproduce:
1. Go to https://twitter.com
2. Focus the URL bar and start typing.
Expected results:
The identity box with the text ""Twitter Inc."" should disappear.
Actual results:
The identity box remains, which is confusing, because it looks like you're entering a search to Twitter or giving it a command.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
667586,2,"Alex, do you think it makes sense to do this now, or should we wait for the larger identity block changes that will come with the conditional forward button, etc.?",QUESTION,0,FULL_TEXT
667586,3,"Never mind. After revising the bug to fix what is actually broken, it makes sense to do this now.",CLARIFICATION,0,FULL_TEXT
667586,4,"Created attachment 542247
patch
On a non-verified page, typing in the URL bar makes the identity box revert to default favicon, no text, and gray background.
This simply makes it work the same way for verified pages to avoid mode errors.",CODE_IMPLEMENTATION,1,FULL_TOKEN
667586,5,"This seems less than ideal when editing a URL rather than replacing it, which could be the reason why it wasn't done this way in the first place.",SOLUTION_REVIEW,1,FULL_TEXT
667586,6,"We're already clearing the favicon. If you're concerned about the shifting of the input text, how about setting visibility: hidden on #identity-icon-labels, instead of visibility: collapse?
The main thing is that we don't want the browser to look like it's in a domain-specific mode, because it's not.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
667586,7,"Yes.
Might look weird, but that's the only compromise I could think of as well.",SOLUTION_REVIEW,1,FULL_TEXT
667586,8,Maybe the label could be really faint instead of hidden to prevent the identity box from looking broken.,SOLUTION_REVIEW,1,FULL_TEXT
667586,9,"Created attachment 542324
method 1: clear text & icons but keep gray bg & border
Making that entire region blank felt weird, since it left the text floating in space, so I removed the text & icons while leaving the block's background and border.",CODE_IMPLEMENTATION,1,FULL_TEXT
667586,10,"Created attachment 542325
method 2: hide the entire block, including its border
Here's the alternate approach of hiding the entire identity block (and the arrow panel icons to the left of it) including its border.
Feels weird, since it leaves the URL bar text floating a large number of pixels away from the left border of the URL bar.",CODE_IMPLEMENTATION,1,FULL_TOKEN
667586,11,"Created attachment 542338
method 1: clear text & icons but keep gray bg & border
s/visibility: hidden/opacity: 0/",CODE_IMPLEMENTATION,1,FULL_TEXT
667586,12,"Comment on attachment 542338
method 1: clear text & icons but keep gray bg & border
This breaks the autocomplete activity icon. Also, clicking the identity block is supposed to restore the page's URL.",CODE_REVIEW,0,FULL_TEXT
667586,13,"If it is easy enough to clear the identity block out of the ui, without shifting the text of the URL (just having it turn invible), then I'm fine with us doing this now.  It does bother me that it looks like you are sending information to the identity of the site that you are currently on.  If it isn't easy, we can just try to fix this with a bunch of proposed changes later on.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
667586,14,"It's really easy. How clear should it be? Should the entire space taken up by the block  turn white, or should its contents simply become blank while retaining its background and border?",QUESTION,0,FULL_TOKEN
667586,15,"I don't have that much of a problem with the URL floating in the location bar with some odd white padding on the right side for now.  Not ideal, but I think it works better than a grey box that exists but contains no information.  We'll want to play with it on the UX branch though.",ANSWER_TO_QUESTION,0,FULL_TOKEN
667586,16,"It's not clear to me that this bug even started with the right premise. While the identity box doesn't correspond to the location bar value anymore when editing it, which can hardly be a surprise to someone editing the value, it does correspond to the page. I see no reason to give this away when all proposed solutions are somehow weird in their own way.",SOLUTION_REVIEW,1,FULL_TEXT
667586,17,"We hide the bookmark star while the location bar value is being edited exactly because this UI is confusing.
If we end up moving the identity block as part with the changes for bug 674744, then this problem will also be fixed. I won't be working on this anymore until there's a clear direction following those changes.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
667586,18,*** Bug 711761 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
667586,19,*** Bug 754498 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
667586,20,"Created attachment 625287
Patch for bug
This reverts the identity block to the generic state when the pageproxystate is invalid.",CODE_IMPLEMENTATION,1,FULL_TEXT
667586,21,"Created attachment 625313
Patch for bug v2
This patch moves the attribute selector to the right-most selector so it will be a little more efficient, as well as removes the need to reset properties since it will now only apply the elevated identity states if the pageproxystate is valid.",CODE_IMPLEMENTATION,1,FULL_TEXT
667586,22,"Comment on attachment 625313
Patch for bug v2
As mentioned here before, shifting the input text via hiding #identity-icon-labels is undesirable. I have no good proposal what to do about this, other than not worrying about this bug; the icon always and reliably reflecting the current page's security status can easily be seen as a feature.",CODE_REVIEW,0,FULL_TEXT
667586,23,I don't think the movement is as jarring as is claimed. This fixes an inconsistency within our UI and is consistent with Chrome and Opera.,CLARIFICATION,0,FULL_TEXT
667586,24,"Comment on attachment 625313
Patch for bug v2
I helped Jared produce this version of the patch and approve of it from a UX standpoint. This keeps the identity block consistent with the rest of the URL bar's state, especially when the URL bar is not focused.",CODE_REVIEW,0,FULL_TEXT
667586,25,"It's not as consistent as you may think. The globe icon has a meaning as well, one that doesn't really make sense here. Chrome changes the icon to a search glass and blocks clicks on it, whereas we revert the location bar value and show the identity popup.",SOLUTION_REVIEW,1,FULL_TEXT
667586,26,"It changes to a search glass to reflect that the current entered value will navigate to a search result page upon submission. We should do that (and blocking clicks) too, but our uriFixup code is currently non-deterministic (i.e. we don't know whether we will end up on a search results page b/c we try unqualified host lookup first), so we need to fix that first.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
667586,27,"To be clear, I don't mean at all that we should block this on fixing uriFixup.",CLARIFICATION,0,FULL_TEXT
667586,28,"Created attachment 627367
Patch for bug v3
This version of the patch removes the ability to click on the identity block to revert the URL bar values.
If we land this patch, then I'll update bug 406779 to state that we have dropped this ability.",CODE_IMPLEMENTATION,1,FULL_TOKEN
667586,29,"Comment on attachment 627367
Patch for bug v3
Review of attachment 627367:
-----------------------------------------------------------------
::: browser/base/content/browser.js
@@ +2650,5 @@
We already null-check for gURLBar, so remove this `if` condition.",CODE_REVIEW,0,FULL_TEXT
667586,30,"I kind of wish we could avoid spreading the use of the horribly-named ""pageproxystate"" attribute and use some other name, but I guess inconsistency with the URL bar attribute name would be a worse problem (and I can't really think of a better name).",CODE_REVIEW,0,FULL_TEXT
667586,31,"I wish the boolean attribute didn't use ""valid""/""invalid"", making it not 100% clear that it's boolean, resulting in unnecessary `else if` conditions:
https://mxr.mozilla.org/mozilla-central/source/browser/base/content/browser.js#2657
And also makes it not obviously clear that the following states are the same:
`if (element.getAttribute(""pageproxystate"") != ""valid"")`
`element[pageproxystate=""invalid""]`",CODE_REVIEW,0,FULL_TOKEN
667586,32,"Comment on attachment 627367
Patch for bug v3
This isn't actually needed. You can just write #urlbar[pageproxystate=invalid] > #identity-box.
Why this change?
Don't put this in theme code.",CODE_REVIEW,0,FULL_TEXT
667586,33,"Created attachment 627430
Patch for bug v4
I made this change for consistency between the three themes.
- Winstripe was set to 0.5 opacity when the blank favicon was updated to the dotted outline.
- Pinstripe was set to 0.5 opacity somewhere around Bug 587901 (which was backed out). The history is a little cloudy here because a lot of lines got moved around so I couldn't find a more definitive answer.
- Gnomestripe was set to 0.3 opacity by the patch for bug 621091, which switched Linux to using the stock icon for gtk files for blank documents instead of the default favicon.
Now that all platforms use the same icon for generic documents, I think we should standardize on the opacity of the icon for its disabled state.",CODE_IMPLEMENTATION,1,FULL_TOKEN
667586,34,"Comment on attachment 627430
Patch for bug v4
The comment doesn't match the code anymore. Maybe you should mention why the pageproxystate check is needed even though you already set pointer-events: none.
You could also make this a separate if (...) return; block or add it to if (this._mode == this.IDENTITY_MODE_CHROMEUI) for the sake of the above block's readability.
Since the globe icon doesn't represent an identity state anymore and since the icon isn't clickable anymore, making winstripe and pinstripe follow gnomestripe might make more sense.",CODE_REVIEW,0,FULL_TOKEN
667586,35,"Created attachment 627459
Patch for bug v5
Addressed feedback. Yeah, I think we can use the more transparent 0.3 value.",CODE_IMPLEMENTATION,1,FULL_TEXT
667586,36,"Comment on attachment 627459
Patch for bug v5
In the case of IDENTITY_MODE_CHROMEUI, this covers left clicks as well as enter or space.",CODE_REVIEW,0,FULL_TEXT
667586,37,https://hg.mozilla.org/integration/mozilla-inbound/rev/af889781505c,UNCODED,0,UNMATCHED
667586,38,https://hg.mozilla.org/mozilla-central/rev/af889781505c,UNCODED,0,UNMATCHED
667586,39,*** Bug 267146 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
682449,1,"************************************************************
* Call to xpconnect wrapped JSObject produced this error:  *
[Exception... ""Component returned failure code: 0x80520012 (NS_ERROR_FILE_NOT_FOUND) [nsIXPCComponents_Utils.import]""  nsresult: ""0x80520012 (NS_ERROR_FILE_NOT_FOUND)""  location: ""JS frame :: resource://services-sync/status.js :: checkSetup :: line 93""  data: no]
************************************************************
Caused by:
JS Component Loader: ERROR resource://services-sync/resource.js:412
                     SyntaxError: redefining delete is deprecated",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
682449,2,"I love how something that's ""deprecated"" throws a SyntaxError.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
682449,3,"Created attachment 556165
v1",UNCODED,0,UNMATCHED
682449,4,http://hg.mozilla.org/services/services-central/rev/84c0f1877335,UNCODED,0,UNMATCHED
682449,5,http://hg.mozilla.org/mozilla-central/rev/84c0f1877335,UNCODED,0,UNMATCHED
687754,1,"Created attachment 561102
unread - fix
While the first tab gets the attribute after it finished loading the page, all other tabs are getting it far to early (at start of loading).
Attribute should not reset when in _previewMode.
Added patch to fix both",CODE_IMPLEMENTATION,1,FULL_TOKEN
687754,2,"Comment on attachment 561102
unread - fix
Review of attachment 561102:
-----------------------------------------------------------------
::: browser/base/content/tabbrowser.xml
@@ +567,5 @@
Can ""unread"" state be set on DOMTitleChanged as well? DOMTitleChanged means another kind of ""unread"", doesn't it? Plus it will avoid the inconsistency between the first tab and other tabs.
@@ +877,5 @@
Move it lower to be parallel to removeAttribute(""titlechanged"").",CODE_REVIEW,0,FULL_TEXT
687754,3,"'unread' is indicating a new/reloaded document in a tab that is not selected.
DOMTitleChanged doesn't necessary indicates a new/reloaded document and fires on selected tabs too.
Some JS in a document could for example change the title every few seconds.
You see the difference?
The attachment is fixing the inconsistency between the first and the following tabs. It was caused by the different handling of those tabs by the tabbrowser itself. Now all tabs get the unread attribute after they finished loading the document. A selected tab will not have that attribute.
Example of use of 'unread' in userChrome.css:
/* set color for unread (and not selected) tabs to blue */
.tabbrowser-tab[unread]
{ color: blue ! important; }
If you additionally want the same coloring while a document loads and if the title has changed, you can add that to the css selector. Watch out that 'busy' and 'titlechanged' both need the additional not(selected).",SOLUTION_REVIEW,1,FULL_TOKEN
687754,4,"Comment on attachment 561102
unread - fix
Looking into a minor change.
Modified version should be up in a few hours.",STATUS_UPDATE,0,FULL_TOKEN
687754,5,"Created attachment 562201
unread - fix (new)
A little cleaner and better fitting into the latest code change",CODE_IMPLEMENTATION,1,FULL_TEXT
687754,6,"If Gmail changes its title in background, I'm sure it should be marked as unread. If some JS changes the title indeed, it must indicate that there's something new, otherwise it could be a fault.",SOLUTION_REVIEW,1,FULL_TEXT
687754,7,"- unread points to the document in the tab
- titleChanged points to the title of the document in the tab
If Gmail has reloaded the page, I agree and would wonder if it wouldn't be marked unread.
If Gmail only changes the title on an already read page, you can mark that easy with .tabbrowser-tab[titleChanged]
I wouldn't like to see a tab marked unread after I did read it, only because the page likes to circle through a couple of headlines in the title.
I prefer to differ between page title and the page itself. So you have the choice to mark the tab depending on which one you want and how. Give the user a chance to decide what he wants.
If you want both marked the same way, you can do it for example like this:
/* set color for titleChanged and unread (and not selected) tabs to blue */
.tabbrowser-tab[unread],
.tabbrowser-tab[titleChanged]
{ color: blue ! important; }
You can even mark the case of a changed title on an already read tab differently (i.e. red).
Or you could use the text color for one case and the background color for the other case.
The user has the choice.",SOLUTION_REVIEW,1,FULL_TOKEN
687754,8,"Comment on attachment 562201
unread - fix (new)
...
We don't need these comments, they just read out the code.",CODE_REVIEW,0,FULL_TEXT
687754,9,http://hg.mozilla.org/mozilla-central/rev/0eacb6c66396,UNCODED,0,UNMATCHED
687754,10,Backed out since this contained a typo (mismatched brackets) that completely broke Firefox.,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
687754,11,Sorry about that. Leftover from a test line when copying over.,CLARIFICATION,0,FULL_TEXT
687754,12,"Created attachment 562836
unread - fix (corr)
Comments deleted, typo corrected",CODE_IMPLEMENTATION,1,FULL_TEXT
687754,13,"http://mxr.mozilla.org/mozilla-central/source/browser/base/content/tabbrowser.xml#911
913             if (!this._previewMode) {
914 #ifdef MOZ_E10S_COMPAT
915               // Bug 666816 - TypeAheadFind support for e10s
916 #else
917               this._fastFind.setDocShell(this.mCurrentBrowser.docShell);
918 #endif
919 
920               this.updateTitlebar();
921 
922               this.mCurrentTab.removeAttribute(""titlechanged"");
923             }
It would be better to place removeAttribute(""unread"") here.",CODE_REVIEW,0,FULL_TEXT
687754,14,"I think I have answered that before in comment #6.
""titlechanged"" /= ""unread""
Basically ""unread"" says 'page is loaded from network in background' and removed as soon as the tab is selected.
It is not and should not been connected to the title. ""titlechanged"" has it's own logic when it is set and removed. You will have some overlapping but that is all. ""titlechanged"" might come without ""unread"", but it's nothing that ""unread"" has to worry about.
""unread"" tells you if you have selected (unread/read) a tab after a page was loaded from the web.
""titlechanged"" tells you if the title of a tab has changed (no matter what caused it).
To move removeAttribute(""unread"") down to where you suggested means, to put it after several ProcessListeners are started and than into or after the patch of bug 540248 (related to titlebar).
To remove unread right after selecting a tab (selected -> read) and than let the ProcessListeners get called seems the far better choice to me.
You have the chance to let both attributes lead to the same marking of the tab, like you want to. Others like me don't like that and can handle them separate or ignore ""titlechanged"".",SOLUTION_REVIEW,1,FULL_TOKEN
687754,15,"I see no difference. My suggestion was just for code formatting, not for other purpose.",CLARIFICATION,0,FULL_TEXT
687754,16,Why exactly would it matter whether the attribute got removed before or after calling these listeners?,QUESTION,0,FULL_TEXT
687754,17,"a) Maybe switching lines
to
if that seems more convenient.
This would still keep it right were the tab gets selected and viewed, the reason why ""unread"" is getting removed. It's a clear chain of commands that are logically tight connected to each other. Like removing ""busy"" leads to setting ""unread"" (if not selected). Easy to understand and maintain.
b) I can't guarantee the Listener calls do not lead to (rare) cases where ""unread"" wouldn't be removed. Is there someone able to guarantee that for now and in the future? Why even take that risk? At this point in code the tab is already selected and shouldn't have the attribute anymore.
c) After those Listeners we have the code block that handles fastFind and TitleBar if not in _previewMode.
The only connection I can see here is _previewMode.
Does it really make sense to move it down 40+ lines to save a single 'if' and at the same time loosing the easy logical understanding of why it has to be removed (selected/viewed => read) plus wondering if those Listener calls might at some point cause something related to removing ""unread"" we haven't thought of right now.
If those arguments don't catch, we can even try to move it down another 30+ lines to the TabSelect events where the _previewMode is handled too and test it there.",SOLUTION_REVIEW,1,MANUAL
687754,18,"All of updateCurrentBrowser runs because the tab gets selected.
I don't see why it wouldn't be removed.
Right.",ANSWER_TO_QUESTION,0,FULL_TEXT
687754,19,"So you want the attribute to be removed down where the tab select events are?
This would make more sense to me than the fastFind/TitleBar block.
In a few hours I could run some quick tests and upload the new patch.",STATUS_UPDATE,0,FULL_TOKEN
687754,20,It is slightly different for add-ons to put it before or after the TabSelect event's dispatching.,ANSWER_TO_QUESTION,0,FULL_TEXT
687754,21,"The attribute removal should happen before the TabSelect event, I think. Other than that, it's not really correlated with the TabSelect event. As I said, everything in this method is about a tab being selected.",REQUIREMENT,0,FULL_TEXT
687754,22,"fastFind and TitleBar are even less related. So using the 'if (!this._previewMode)' of the TabSelect block makes more sense if we want to move it down to save a separate 'if' for removing the attribute.
Anyway. To make some progress I am going to split the patch into 2 parts:
Part 1: Only set unread when busy is removed
Part 2: Don't remove unread in preview mode (fix on old position)
Part 2 alternate: Don't remove unread in preview mode (moved down to use existing if)
This way part 1 can get applied and you can choose (or we can discuss further) which one of part 2 is better.
After the fixes did land in mozilla-central, we should take care they are getting in aurora too before FF9 moves to beta.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
687754,23,"Created attachment 565090
Only set unread when busy is removed
Fixes the different times ""unread"" is set in tab 1 and tab 2+",CODE_IMPLEMENTATION,1,FULL_TEXT
687754,24,"Created attachment 565092
Don't remove unread in preview mode
Fix on old position",CODE_IMPLEMENTATION,1,FULL_TEXT
687754,25,"Created attachment 565093
Don't remove unread in preview mode (alternative version)
Alternative version; moved down to use existing if",CODE_IMPLEMENTATION,1,FULL_TEXT
687754,26,"Comment on attachment 565093
Don't remove unread in preview mode (alternative version)
Please move this to the earlier !this._previewMode section. It doesn't matter that it doesn't correlate with the other pieces there, as those pieces don't correlate with each other either.",CODE_REVIEW,0,FULL_TEXT
687754,27,"Created attachment 565359
Don't remove unread in preview mode (next try)
Additionally moved leading comment into the 'if' to avoid confusion with that other patch.",CODE_IMPLEMENTATION,1,FULL_TEXT
687754,28,"Comment on attachment 565359
Don't remove unread in preview mode (next try)
just remove this comment",CODE_REVIEW,0,FULL_TEXT
687754,29,"Created attachment 565397
Don't remove unread in preview mode (final)
Done.",UNCODED,0,UNMATCHED
687754,30,"Checkin to mozilla-central needed
Additional approval for mozilla-aurora requested",UPLIFT_NOMINATION_REQUEST,0,FULL_TOKEN
687754,31,"http://hg.mozilla.org/integration/mozilla-inbound/rev/2561f2a8512c
http://hg.mozilla.org/integration/mozilla-inbound/rev/52bde8206312",UNCODED,0,UNMATCHED
687754,32,"https://hg.mozilla.org/mozilla-central/rev/2561f2a8512c
https://hg.mozilla.org/mozilla-central/rev/52bde8206312",UNCODED,0,UNMATCHED
687754,33,"Comment on attachment 565090
Only set unread when busy is removed
This feels like a bug with low user impact that can wait until 10 ships. If there's some large number of users having a really bad experience can you please explain that and re-nominate.",CODE_REVIEW,0,FULL_TEXT
687754,34,"Comment on attachment 565397
Don't remove unread in preview mode (final)
This feels like a bug with low user impact that can wait until 10 ships. If there's some large number of users having a really bad experience can you please explain that and re-nominate.",UNCODED,0,UNMATCHED
687754,35,"The unread attribute got added to FF9 on 2011-09-15 (see Bug 487242) and I think it would be better to have it completely fixed before FF9 is getting released.
It's a no risk fix. Since this second patch only moves the 3 lines (add and remove attribute) of the first patch to a different position in the code, there is no reason why it should have any bad impact.
Seamonkey already released version 2.4 with the adapted patch from bug 487242 and there is a question from only 2 days ago if this second patch will be adapted too. I saw on userstyles.org the addition of ""unread"" in FF9 is noted there too. I think this shows the interest in having this old regression (bug 487242) finally fixed.",CLARIFICATION,0,FULL_TOKEN
735312,1,"Looks like even after bug 591884, that fixed toolbar importing, we are failing when trying to import default bookmarks.html file.
investigating.",PROBLEM_MOTIVATION,0,FULL_TOKEN
735312,2,"we try to import bookmarks.html from the profile folder, but looks like now that file is inside the omni.jar (my guess is this happens from Bug 556644).
In debug builds we commonly use, we don't use the omni.jar, so when ProfDef gets copied, bookmarks.html is, and ends up in the profile folder, then everything works fine.
nsBrowserGlue was updated to import from resource:///defaults/profile/bookmarks.html but the migrators code was not, it still tries to directly read from the profile folder.",PROBLEM_REVIEW,0,FULL_TOKEN
735312,3,"Created attachment 605593
patch v1.1
Importing a separate bookmarks.html file in the test ended up covering this issue, so I removed it.
The resource address automatically resolves to the right destination, depending on whether omni.ja exists.
Will likely make a try to help testing.",CODE_IMPLEMENTATION,1,FULL_TOKEN
735312,4,Looks like this is getting rid of the only caller of ImportHTMLFromFileToFolder. Can we remove that too?,SOLUTION_REVIEW,1,FULL_TEXT
735312,5,"Try run for c4cd8ee2197e is complete.
Detailed breakdown of the results available here:
    https://tbpl.mozilla.org/?tree=Try&rev=c4cd8ee2197e
Results (out of 25 total builds):
    success: 21
    warnings: 1
    failure: 3
Builds (or logs if builds failed) available at:
http://ftp.mozilla.org/pub/mozilla.org/firefox/try-builds/mak77@bonardo.net-c4cd8ee2197e",SOLUTION_VERIFICATION,0,FULL_TOKEN
735312,6,"yes, looks like add-ons (we know about) are not using it. Though I'd prefer doing it as a follow-up, cause I'd still like to backport the patch here to Aurora/Beta while we are at the beginning of the cycle. Will file that bug and attach patch.
looks like I forgot to import Util.h, will fix it.",STATUS_UPDATE,0,FULL_TEXT
735312,7,"Comment on attachment 605593
patch v1.1
Vlad, could you preventive check the Windows try builds and tell me if now they correctly import for you?",VERIFICATION_REQUEST,0,FULL_TEXT
735312,8,"Comment on attachment 605593
patch v1.1
Review of attachment 605593:
-----------------------------------------------------------------
::: browser/components/migration/src/nsBrowserProfileMigratorUtils.cpp
@@ +164,4 @@
CC'ed Mano as I'm not sure if he was using ImportBookmarksHTML in his refactoring
::: browser/components/migration/src/nsIEProfileMigrator.cpp
@@ +1406,5 @@
With this check, the NS_ENSURE_SUCCESS(rv, rv) in ImportDefaultBookmarks seems redundant. You could just `return rv` there and keep this check here
::: browser/components/migration/src/nsSafariProfileMigrator.cpp
@@ +980,5 @@
tbpl showed that we'll need to include mozilla/Util.h for DebugOnly here",CODE_REVIEW,0,FULL_TEXT
735312,9,"his refactoring is a rewrite, will have to apply this fix to his patch as well (added dependency).",CLARIFICATION,0,FULL_TEXT
735312,10,"Unrelated to this fix, but worth following up later is to take a look at tests that are referring to bookmarks.html or these functions: http://mxr.mozilla.org/mozilla-central/source/toolkit/components/places/tests/head_common.js#413
Some of them might be relying in not using omni.ja{r} for tests which means other things might be broken but passing tests.",NEW_ISSUE_FILING,0,FULL_TOKEN
735312,11,"Sure, though most of those are to import from an external file or a pre-places file, not for default bookmarks that is the only case affected by omni.ja. Btw, will look and file eventual follow-ups as needed.",STATUS_UPDATE,0,FULL_TEXT
735312,12,"Hi Marco
Can you please provide the link to the try builds
Thanks",QUESTION,0,FULL_TOKEN
735312,13,See comment 4,ANSWER_TO_QUESTION,0,FULL_TEXT
735312,14,"Created attachment 605749
screenshot
I've tested using the try build and the favorites from IE9 are imported in Bookmarks Menu but items are not present in a new directory and also are not in the same order as in IE9.
See the screenshot.",SOLUTION_VERIFICATION,0,FULL_TOKEN
735312,15,"I see, they are imported in alphabetical order.  Btw that's another bug, we should not deal with that here, likely would be better to fix that in the new JS rewrite. What we care here is that all bookmarks are imported to the menu and toolbar.",CLARIFICATION,0,FULL_TOKEN
735312,16,I added a note in bug 710895 about alphabetical order.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
735312,17,"what does this mean?
Note that, when importing from the initial wizard items are places in the menu/toolbar directly.
Instead when importing manually we create an ""Imported from BROWSERNAME"" folder, and import inside it. this is by (old) design and expected.",CLARIFICATION,0,FULL_TOKEN
735312,18,"Forget about it. You just gave me the explanation.
 ",ANSWER_TO_QUESTION,0,FULL_TEXT
735312,19,https://hg.mozilla.org/integration/mozilla-inbound/rev/a10f5ab758b4,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
735312,20,"and a follow-up, since I forgot a namespace + minor cleanup.
https://hg.mozilla.org/integration/mozilla-inbound/rev/88112eb6a1f5",NEW_ISSUE_FILING,0,FULL_TOKEN
735312,21,"Created attachment 605959
patch v1.2
coalesced patch for approval, once we get positive testing in Nightly.",CODE_IMPLEMENTATION,1,FULL_TEXT
735312,22,"https://hg.mozilla.org/mozilla-central/rev/a10f5ab758b4
https://hg.mozilla.org/mozilla-central/rev/88112eb6a1f5",UNCODED,0,UNMATCHED
735312,23,"Comment on attachment 605959
patch v1.2
[Approval Request Comment]
Regression caused by (bug #): bug 556644
User impact if declined: As expressed in the original bug 591884, our rate conversion from IE is declining, and this may be one of the failure points. In bug 591884 I thought this was just a minor bug related to the toolbar, but instead we really don't import ANY bookmark from IE in the original migrator.
Testing completed (on m-c, etc.): m-c
Risk to taking this patch (and alternatives if risky): The change is limited and explicitly removes an error check (converted to an assertion) to let the migrator proceed in any case. That said, this couldn't be more broken than it is now.
String changes made by this patch: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
735312,24,"Comment on attachment 605959
patch v1.2
Given that, approving for Aurora 13 and Beta 12.",UPLIFT_APPROVAL,0,FULL_TEXT
735312,25,"Thanks.
https://hg.mozilla.org/releases/mozilla-aurora/rev/245b87d73a55
https://hg.mozilla.org/releases/mozilla-beta/rev/32515f50755a",UNCODED,0,UNMATCHED
735312,26,"Created attachment 609119
(AAv1) Remove MIGRATION_BUNDLE leftover
[Checked in: Comment 27]",UNCODED,0,UNMATCHED
735312,27,"Comment on attachment 609119
(AAv1) Remove MIGRATION_BUNDLE leftover
[Checked in: Comment 27]
Review of attachment 609119:
-----------------------------------------------------------------
the patch is technically correct, though note that we are about to kill these files really shortly (As soon as the new Safari and IE js migrators land), so I'd not spend time in cleaning them up perfectly.",CODE_REVIEW,0,FULL_TEXT
735312,28,"Comment on attachment 609119
(AAv1) Remove MIGRATION_BUNDLE leftover
[Checked in: Comment 27]
https://hg.mozilla.org/mozilla-central/rev/a996d3df12a3",UNCODED,0,UNMATCHED
735312,29,"Changing the flag to verified on:
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:12.0) Gecko/20100101 Firefox/12.0 beta 3
All the favorites are imported in alphabetical order from IE9.",SOLUTION_VERIFICATION,0,FULL_TOKEN
735312,30,"Mozilla/5.0 (Windows NT 6.1; rv:14.0) Gecko/20120426 Firefox/14.0a2 
Built from http://hg.mozilla.org/releases/mozilla-aurora/rev/7525533b3e42
Verified that the Favorites are imported from IE9, but the folder ""Websites for United States"" (which is a default Favorites folder) is imported as ""Links for United States"" in Firefox",SOLUTION_VERIFICATION,0,FULL_TOKEN
735312,31,"may depend on the Windows localization? We just read folder names, maybe that is a special folder that gets a different translation in the IE UI only.",CLARIFICATION,0,FULL_TEXT
735312,32,"I don't see any favorite folder called ""Websites for United States"" in my IE 9.0.8112.16421.
All bookmarks are successfully imported in FF 13b3: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Gecko/20100101 Firefox/13.0
Verified fixed",SOLUTION_VERIFICATION,0,FULL_TOKEN
794101,1,"Changes since the last update:
#2089 Removes unnecessary ctx.mozCurrentTransformInverse transforms
#2091 Refresh the zoom settings after rotating the pages
#2102 Fix regression from #2087.
#2107 Fix gh-pages bloat
#2106 Adds text layer testing
#2111 Move font translation to the worker
#2100 Fix zoom out keyboard shortcut for mac.
#2115 Refactor text extraction / font loading logic
#2122 Update index template.
#2123 Fixes RTL text extraction
#2125 Add 'text' test coverage for simpletype3font + arabiccidtruetype-pdf test PDF
#2130 Update Japanese l10n
#2132 Update zh-TW translation
#2136 Fix l10n labels ids for rotation menu items
#2124 Provides right fallback fonts for text layer
#2116 Mozilla central change for metro.
#2118 Removing font loading hack from MOZCENTRAL
#2110 Use document fragment in text layer
#2143 Fix current.x for type3 font word break
#2131 Metadata optimization
#2058 Small fixes for normal and potential post-compilation bugs
#2145 Renaming export to exportData
#2155 Fix issue #2141
#2144 Update the Arabic translation
#2160 Handle Arabic Ligatures in issue #2141
#2162 Fullscreen updates for latest (unprefixed) spec.
#2146 Workaround for android gb browser bug
#2153 Renames fullscreen to presentation mode
#2127 Use the text extracted in the getTextContent function for the divs of the textLayer.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
794101,2,"Created attachment 664519
Update pdf.js to version 0.5.184
Dave, mind taking a look?",CODE_REVIEW_REQUEST,0,FULL_TEXT
794101,3,https://hg.mozilla.org/integration/mozilla-inbound/rev/59a16157483a,UNCODED,0,UNMATCHED
794101,4,https://hg.mozilla.org/mozilla-central/rev/59a16157483a,UNCODED,0,UNMATCHED
916390,1,"I was looking at the form saving code, and I can't quite figure out this field. In theory, it acts like a cache so that we don't collect form data if it hasn't changed. However, there doesn't seem to be any placed to save the cached form data, as far as I can see. That is, if browser.__SS_formDataSaved is true, we just don't appear to save any form data for the given tab in sessionstore.js.
The problem is mostly mitigated by the TabStateCache, since we don't typically collect data for a page more than once. However, I wonder how this worked before the TabStateCache was implemented. Perhaps I've misread the code?
In any case, it would be nice if we could just eliminate this field. Now that we have the TabStateCache, I doubt that it saves us much work. What do you guys think?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
916390,2,I think,UNCODED,0,UNMATCHED
916390,3,"Bah. I think that in its current state we might even be losing form data when:
1) form data is saved and formDataSaved=true
2) something calls TabStateCache.delete(tab)
3) we re-collect all data except form data
Boom, lost. This flag assumes that the tabData is re-used in _collectBaseTabData() which is only the case if the session history didn't change.",S2R,0,FULL_TOKEN
916390,4,"Ok it's a little more complex than that STR above:
1) have a tab with inputs and modify them
2) form data is saved and formDataSaved=true
3) append an ""#"" to the tab's URI
4) change sessionstorage data
5) collect data for the tab
The tab should still have the same form data but the number of session history entries changed and that makes us re-collect session history entries (and form data). Due to formDataSaved still being true we skip form data collection though.",S2R,0,FULL_TOKEN
916390,5,"This bug has probably existed before, though. We just didn't need step (4) because there was no cache in between.",CLARIFICATION,0,FULL_TEXT
916390,6,Removing __SS_formDataSaved shouldn't really hurt as well because MozStorageChanged seems to be the only event where we call TabStateCache.delete() without at the same time setting formDataSaved=false. There shouldn't be a lot more overhead now when always collecting form data.,SOLUTION_REVIEW,1,FULL_TEXT
916390,7,"Created attachment 805340
Remove __SS_formDataSaved
I added a test for the ancient bug anyway.",STATUS_UPDATE,0,FULL_TEXT
916390,8,"Comment on attachment 805340
Remove __SS_formDataSaved
Review of attachment 805340:
-----------------------------------------------------------------
::: browser/components/sessionstore/src/SessionStore.jsm
@@ +2269,5 @@
I don't quite understand why there was a |if (aIncludePrivateData)|, but then, I'm not sure why you have removed it.
::: browser/components/sessionstore/test/Makefile.in
@@ +135,5 @@
Couldn't we take an opportunity to give a better name to the test?",CODE_REVIEW,0,FULL_TEXT
916390,9,"Because we always want to re-collect form data when cloning a tab, as that might include form data from sites that would usually be excluded due to the current privacy level.
The parameter aUpdateFormData was removed because it's always true now. We always want to collect form data. With aUpdateFormData=true the condition (aIncludePrivateData || aUpdateFormData) becomes (aIncludePrivateData || true). So I just removed it.
Sure.",ANSWER_TO_QUESTION,0,FULL_TEXT
916390,10,https://hg.mozilla.org/integration/fx-team/rev/86eff36caecf,UNCODED,0,UNMATCHED
916390,11,https://hg.mozilla.org/mozilla-central/rev/86eff36caecf,UNCODED,0,UNMATCHED
948882,1,"With the current plan to harden the security of Firefox, we want to disallow internal privileged pages to use inline JavaScript. Since their amount is fairly limited, we start this by rewriting them bit by bit.",PROBLEM_MOTIVATION,0,FULL_TEXT
948882,2,Hello I want to work on this. I am very new but I want to start work here.Please guide me how to do that.,ASSIGNEE_REQUEST,0,FULL_TEXT
948882,3,"Hi this is my first try at bug so questions maybe bit naive. The JS for this already seems to have been moved to separate crashes.js. But I found this css that was still inline 
<style type=""text/css"">
:root {
  font-family: sans-serif;
}
table {
  padding-bottom: 2em;
}
th {
  text-align: left;
  white-space: nowrap;
}
th[chromedir=""rtl""] {
  text-align: right;
}
/* name */
th:first-child {
  -moz-padding-end: 2em;
}
:link, :visited {
  display: block;
  min-height: 17px;
}
/* date */
td:first-child + td {
  -moz-padding-start: 1em;
  -moz-padding-end: .5em;
  white-space: nowrap;
}
/* time */
td:last-child {
  -moz-padding-start: .5em;
  white-space: nowrap;
}
#clear-reports {
  float: right;
}
#clear-reports[chromedir=""rtl""] {
  float: left;
}
.submitting {
  background-image: url(chrome://global/skin/icons/loading_16.png);
  background-repeat: no-repeat;
  background-position: right;
}
</style>
Does this needs to be moved too? If so I will submit a patch for it soon.",QUESTION,0,FULL_TOKEN
948882,4,"Yes, the inline style should be moved to an external file. I haven't checked dirListing.css, but it looks like we should create a new file for this (crashes.css or so).
Please also move the inline JavaScript in line 77 (onclick=...) to crashes.js.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
948882,5,"Hi, 
I was looking for some good first bugs and stumbles upon this one. I would like to start with this as my first bug. Can I work on it? Thanks :)",ASSIGNEE_REQUEST,0,FULL_TOKEN
948882,6,"I was hoping that the person in comment 2 will continue their work. 
lp, please take another bug :)",DEVELOPER_SELECTION_DECISION,0,FULL_TOKEN
948882,7,"Rishabh, do you still plan to work on this?
(Someone in #introduction is interested in this bug too)",QUESTION,0,FULL_TOKEN
948882,8,"Never mind, he found a bug.",STATUS_UPDATE,0,FULL_TEXT
948882,9,Hey Sorry Manish I totally missed it I would like to continue the work on this bug if you don't mind. I will try to send a patch as soon as possible,STATUS_UPDATE,0,FULL_TEXT
948882,10,No hurry though. I was just wondering if you were still interested :),CLARIFICATION,0,FULL_TEXT
948882,11,Any news?,QUESTION,0,FULL_TEXT
948882,12,"Created attachment 8407744
bug-948882.patch
I am noob here.This is my first patch .",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
948882,13,"Comment on attachment 8407744
bug-948882.patch
Review of attachment 8407744:
-----------------------------------------------------------------
This looks good, aside from the small nits below :)
::: toolkit/crashreporter/content/crashes.xhtml
@@ +13,5 @@
Nit: Change the extra space here at the end to a />
(instead of `...crashes.css"" >`, have `...crashes.css""/>`)
::: toolkit/crashreporter/jar.mn
@@ +4,5 @@
Nit: There's an extra space, try to align the parentheses.",CODE_REVIEW,0,FULL_TOKEN
948882,14,"Created attachment 8408443
bug.patch
Hi Manish 
Added !",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
948882,15,"Comment on attachment 8408443
bug.patch
Review of attachment 8408443:
-----------------------------------------------------------------
This looks good :)",CODE_REVIEW,0,FULL_TEXT
948882,16,"Comment on attachment 8408443
bug.patch
Review of attachment 8408443:
-----------------------------------------------------------------
OK, looking good for a first start :-)
This removes the inline styles but leaves inline scripts. Can you modify crashes.xhtml so that ""onclick"" and ""onload"" attributes are replaced by JavaScript that adds event handlers (in crashes.js)?
You can look how other volunteers have fixed this (In bug 948881 for example).
See also our project wiki page! https://wiki.mozilla.org/Security/Inline_Scripts_and_Styles",CODE_UPDATE_REQUEST,0,FULL_TOKEN
948882,17,"Created attachment 8410229
bug_final.patch
Hello Frederik 
Done ! I have attached here also.",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
948882,18,"Comment on attachment 8410229
bug_final.patch
Review of attachment 8410229:
-----------------------------------------------------------------
This looks good. Some indentation may be called for (split the handlers across multiple lines), but otherwise it should work.",CODE_REVIEW,0,FULL_TEXT
948882,19,"This looks good.
Can you use DOMContentLoaded instead of window's onload?",CODE_REVIEW,0,FULL_TOKEN
948882,20,"Created attachment 8410903
bug_final.patch
Done !",UNCODED,0,UNMATCHED
948882,21,"Comment on attachment 8410903
bug_final.patch
Review of attachment 8410903:
-----------------------------------------------------------------
One small fix, and then I think you're all set :)
::: toolkit/crashreporter/content/crashes.js
@@ +15,5 @@
Nit: There's an extra space right before ""DomContentLoaded""",CODE_REVIEW,0,FULL_TEXT
948882,22,"Created attachment 8410915
bug_final.patch
Sorry ! Thanks for pointing out",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
948882,23,whoops,UNCODED,0,UNMATCHED
948882,24,"Comment on attachment 8410915
bug_final.patch
Review of attachment 8410915:
-----------------------------------------------------------------
Good progress!
::: toolkit/crashreporter/content/crashes.js
@@ +14,5 @@
Sorry I *just* noticed this: The tag with the 'clear-reports' Id is only available after the page has loaded, not when the script is executed.
You could add some newlines about the following DOMContentLoaded handler and add this click event handler in there!
Would you please test your next patch? I know it's a steep curve, but it's not that hard: https://developer.mozilla.org/en-US/docs/Simple_Firefox_build",CODE_REVIEW,0,FULL_TOKEN
948882,25,"Biraj, can you address my recent comments? This patch is nearly ready!",CODE_UPDATE_REQUEST,0,FULL_TEXT
948882,26,"Created attachment 8421506
bug_final.patch
sorry for late reply. I was busy with my project.
I have attached the patch here.",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
948882,27,"Comment on attachment 8421506
bug_final.patch
Review of attachment 8421506:
-----------------------------------------------------------------
Looks good. One more thing though:
::: toolkit/crashreporter/content/crashes.js
@@ +14,5 @@
Adding the event listener for clear-reports has to be placed in the event handler for DOMContentLoaded, otherwise JavaScript doesn't see the button yet.
Can you please address this and test your next patch?",CODE_REVIEW,0,FULL_TOKEN
948882,28,"Created attachment 8424383
bug_final.patch
Added !",UNCODED,0,UNMATCHED
948882,29,"Comment on attachment 8424383
bug_final.patch
Review of attachment 8424383:
-----------------------------------------------------------------
Closer and closer :)
Please address the following comments:
::: toolkit/crashreporter/content/crashes.js
@@ +14,5 @@
I just noticed your querySelector is not working. It is also better for performance if you use document.getElementById() instead.
You can wrap all your DOMContentLoaded things into one function. Please introduce line breaks after { and } and use indentation as discussed in our style guides (https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/Coding_Style#JavaScript_practices)
You may start with something like this:
Thanks!",CODE_REVIEW,0,FULL_TOKEN
948882,30,"Created attachment 8868445
Bug 948882 - Move inline scripts and styles into separate file for toolkit/crashreporter/content/crashes.xhtml (URL=about:crashes).
Review commit: https://reviewboard.mozilla.org/r/140048/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/140048/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
948882,31,"Comment on attachment 8868445
Bug 948882 - Move inline scripts and styles into separate file for toolkit/crashreporter/content/crashes.xhtml (URL=about:crashes).
https://reviewboard.mozilla.org/r/140048/#review143376
Looks good! Note, that I am not a browser peer, so we need another reviewer here.",CODE_REVIEW,0,FULL_TEXT
948882,32,"Ok, thank you!
I'm new around here, do you have any idea who could be a browser peer or where to find one?
Thanks again!",QUESTION,0,FULL_TEXT
948882,33,"Excellent. I'll let you know how other folks do it, instead of magically coming up with a name.
You said you're new here, but it looks like your other patches went really well, so I trust you'll be up to this challenge?
I usually look into 'hg log <file>' to find previous commits. The commit message has reviewer names, that I then hunt on IRC.
Try looking at <https://hg.mozilla.org/mozilla-central/log/tip/toolkit/crashreporter/content/crashes.xhtml> and find someone in #fx-team or #developers.
P.S: I was lazy enough to search for ""crashes.xhtml"" in searchfox.org and then find a link to the public version history.",ANSWER_TO_QUESTION,0,FULL_TOKEN
948882,34,"Pushed by gijskruitbosch@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/1034f8be097f
Move inline scripts and styles into separate file for toolkit/crashreporter/content/crashes.xhtml (about:crashes). r=freddyb,gijs",UNCODED,0,UNMATCHED
948882,35,"I happened to come across this bug, so rs=me on the patch from Santiago, and I landed it:
https://hg.mozilla.org/integration/mozilla-inbound/rev/1034f8be097fd6d2f8eda8f7f7d277b92d91ff41",CODE_IMPLEMENTATION,1,FULL_TOKEN
948882,36,"Backed out for ESlint failures on /toolkit/crashreporter/content/crashes.js
backout: https://hg.mozilla.org/integration/mozilla-inbound/rev/dfff9e92ca9710b2e56e0a38f86362b7a8903049
push with failures: https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&revision=1034f8be097fd6d2f8eda8f7f7d277b92d91ff41&selectedJob=183762018
failure log: https://treeherder.mozilla.org/logviewer.html#?job_id=183762018&repo=mozilla-inbound&lineNumber=245
[task 2018-06-19T10:03:36.725Z] copying build/lib.linux-x86_64-2.7/psutil/_psutil_linux.so -> psutil
[task 2018-06-19T10:03:36.725Z] copying build/lib.linux-x86_64-2.7/psutil/_psutil_posix.so -> psutil
[task 2018-06-19T10:03:36.725Z] 
[task 2018-06-19T10:03:36.725Z] Error processing command. Ignoring because optional. (optional:packages.txt:comm/build/virtualenv_packages.txt)
[task 2018-06-19T10:08:46.466Z] TEST-UNEXPECTED-ERROR | /builds/worker/checkouts/gecko/toolkit/crashreporter/content/crashes.js:15:55 | Unexpected space before function parentheses. (space-before-function-paren)
[task 2018-06-19T10:08:46.466Z] TEST-UNEXPECTED-ERROR | /builds/worker/checkouts/gecko/toolkit/crashreporter/content/crashes.js:17:27 | Strings must use doublequote. (quotes)
[task 2018-06-19T10:08:46.466Z] TEST-UNEXPECTED-ERROR | /builds/worker/checkouts/gecko/toolkit/crashreporter/content/crashes.js:17:78 | Unexpected space before function parentheses. (space-before-function-paren)
[taskcluster 2018-06-19 10:08:46.842Z] === Task Finished ===
[taskcluster 2018-06-19 10:08:46.842Z] Unsuccessful task run with exit code: 1 completed in 551.489 seconds",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
948882,37,"Pushed by gijskruitbosch@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/75df8c6facf7
Move inline scripts and styles into separate file for toolkit/crashreporter/content/crashes.xhtml (about:crashes). r=freddyb,gijs",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
948882,38,https://hg.mozilla.org/mozilla-central/rev/75df8c6facf7,UNCODED,0,UNMATCHED
1073339,1,"Bug 1072320 ended up being quite a rabbithole of inproductivity. We have a set of tests that aren't reliable on Linux (and so have been disabled there):
browser_action_keyword.js
browser_action_searchengine.js
browser_action_searchengine_alias.js
AFAICT, this is because when the test tries to interact with the autocomplete result, nothing happens. My assumption is that this is due to focus issues around popups on Linux, which we've had troubles with in the past.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1073339,2,"Also browser_search_favicon.js.  I can see the same problem intermittently with e10s on Windows, and see no reason to believe they are different - so I'm opening a new bug to also disable these tests with e10s keeping this bug number as the reason.
As to the reason: I'm seeing that the failure in e10s is caused due to detachController in autocomplete.xml being called during the test, causing the search to stop before we've got the results we expect.  detachController is called via:
_adjustFocusAfterTabSwitch@chrome://browser/content/tabbrowser.xml:1251:9
_finalizeTabSwitch@chrome://browser/content/tabbrowser.xml:3273:11
set_selectedIndex/<@chrome://browser/content/tabbrowser.xml:5252:15
Handler.prototype.process@resource://gre/modules/Promise.jsm -> resource://gre/modules/Promise-backend.js:865:23
this.PromiseWalker.walkerLoop@resource://gre/modules/Promise.jsm -> resource://gre/modules/Promise-backend.js:744:7
which is tabbrowser focusing the new tab asynchronously.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1073339,3,"Created attachment 8527295
0001-Bug-1073339-Enable-autocomplete-tests-for-Linux-and-.patch
This is based off of the patches from bug 1075450.",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1073339,4,"Created attachment 8527296
0002-Bug-1073339-Convert-from-CRLF-to-LF-for-browser_acti.patch
Windows -> Unix line endings.",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1073339,5,https://tbpl.mozilla.org/?tree=Try&rev=ce898dc49b21,UNCODED,0,UNMATCHED
1073339,6,"Comment on attachment 8527295
0001-Bug-1073339-Enable-autocomplete-tests-for-Linux-and-.patch
Review of attachment 8527295:
-----------------------------------------------------------------
Thanks for looking into this :) It's been driving me batty.
Will also need to deal with browser_autocomplete_autoselect.js, added in bug 1067903.
::: browser/base/content/test/general/browser_action_searchengine.js
@@ +8,5 @@
Nit: Rename, so we don't accidentally assume it's a global?",CODE_REVIEW,0,FULL_TOKEN
1073339,7,"Oh, would be good to also update browser_autocomplete_a11y_label.js too, for consistency.",REQUIREMENT,0,FULL_TEXT
1073339,8,"Created attachment 8530242
0001-Bug-1073339-Enable-autocomplete-tests-for-Linux-and-.patch, v2",UNCODED,0,UNMATCHED
1073339,9,"Created attachment 8530243
0002-Bug-1073339-Convert-from-CRLF-to-LF-for-autocomplete.patch, v2",UNCODED,0,UNMATCHED
1073339,10,"Try push with unifiedcomplete=false:
https://tbpl.mozilla.org/?tree=Try&rev=3ee73b9c370d
Try push with unifiedcomplete=true:
https://tbpl.mozilla.org/?tree=Try&rev=2d7106bda22e",CODE_IMPLEMENTATION,1,FULL_TOKEN
1073339,11,Doesn't look great with e10s and unifiedcomplete enabled. If only I could run e10s tests locally...,SOLUTION_VERIFICATION,0,FULL_TEXT
1073339,12,you can by passing --e10s to mach mochitest-browser?,COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TEXT
1073339,13,Currently broken due to bug 1103159 unfortunately.,COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1073339,14,"Comment on attachment 8530242
0001-Bug-1073339-Enable-autocomplete-tests-for-Linux-and-.patch, v2
Review of attachment 8530242:
-----------------------------------------------------------------
I don't see any obvious reason why this is failing on Try :\",CODE_REVIEW,0,FULL_TEXT
1073339,15,"Created attachment 8535550
0002-Bug-1073339-Convert-from-CRLF-to-LF-for-autocomplete.patch, v3
Updated due to test changes.",CODE_IMPLEMENTATION,1,FULL_TEXT
1073339,16,"Created attachment 8535551
0001-Bug-1073339-Enable-autocomplete-tests-for-Linux-and-.patch, v3
This is looking better:
https://tbpl.mozilla.org/?tree=Try&rev=497aac59ca3a
https://tbpl.mozilla.org/?tree=Try&rev=d98d73126544",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1073339,17,"Comment on attachment 8535551
0001-Bug-1073339-Enable-autocomplete-tests-for-Linux-and-.patch, v3
Review of attachment 8535551:
-----------------------------------------------------------------
::: browser/base/content/test/general/browser.ini
@@ -110,5 @@
Look like browser_action_keyword.js should get updated too.",CODE_REVIEW,0,FULL_TEXT
1073339,18,"Created attachment 8536635
0001-Bug-1073339-Enable-autocomplete-tests-for-Linux-and-.patch, v4",UNCODED,0,UNMATCHED
1073339,19,https://tbpl.mozilla.org/?tree=Try&rev=b8a1b38b172c,UNCODED,0,UNMATCHED
1073339,20,"https://hg.mozilla.org/integration/fx-team/rev/d68830b2ce47
https://hg.mozilla.org/integration/fx-team/rev/704ca3c0bb46",UNCODED,0,UNMATCHED
1073339,21,"https://hg.mozilla.org/mozilla-central/rev/d68830b2ce47
https://hg.mozilla.org/mozilla-central/rev/704ca3c0bb46",UNCODED,0,UNMATCHED
1079905,1,"Created attachment 8501777
greenbuttons.jpg
The green buttons with the video/audio icons may not be distinct enough, we should evaluate some alternatives (including color-only changes).",PROBLEM_MOTIVATION,0,FULL_TEXT
1079905,2,"Created attachment 8506358
loop-button-options.png
Philipp, not sure if you have any comments here or if we should get legal involved? Do you think changing the color is best? I personally find option A most appealing, the only drawback is that the green/action buttons get lost with all the other blue buttons we have.",SOLUTION_REVIEW,1,FULL_TEXT
1079905,3,"Would love to also get shorlander and mmaslaney's thoughts here. For legal concerns, we are trying to avoid the rounded green camera buttons.",CLARIFICATION,0,FULL_TEXT
1079905,4,"Couple options to consider
Version 1: Normal style button + green icon
Version 2: Default style button
Version 3: Teal
Version 4: Teal Gradient 
http://people.mozilla.org/~mmaslaney/hello/Hello-button-variations.png",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1079905,5,"I think the blue version works best. We'll also use it in the permissions UI for device sharing, so it's consistent with that.
Teal also looks very nice, but I'm afraid it wouldn't solve the possible legal issues.
By the way: another way to work around this besides the color would be changing the icon itself significantly. I took a stab at this once, but didn't really get to a good solution.",SOLUTION_REVIEW,1,FULL_TOKEN
1079905,6,"Something I haven't seen considered is green on green or teal on teal http://cl.ly/image/351M2k0o370o
I like the teal but I prefer the green in this case because it is farther away from the blue we are using in other places.
Alternative Icon ideas http://cl.ly/image/2h3s093H263i",SOLUTION_REVIEW,1,FULL_TOKEN
1079905,7,"Ok, I'm leaning towards the teal background with white text/icon. Same icon as we currently have. Michael/Stephen, can you confirm for me that this teal is something you're willing to live with as part of our ongoing palette? Is there an existing palette you're drawing this from?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1079905,8,"I OK with using Teal or blue using the same icon. The Teal was taken from a color palette Sean Martell worked up for Project Chameleon.
Stephen, I love the idea of using green, but I think we face a bit of a challenge trying to define an alternative video icon.",SOLUTION_REVIEW,1,FULL_TEXT
1079905,9,"Ok, so going with replacing all green buttons in the Hello UI with Summit Teal vibrant (#5BC0A4) and white foreground (text + icons). Also shifting the pill button in the contacts UI to a shorter, rounded rect, in line with our other Hello buttons (see bug 1075203). Thanks everyone!",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1092808,1,"STR:
1. set browser.polaris.enabled to true
2. disable tracking protection in about:preferences privacy tab
3. restart Firefox
Expected:
Tracking protection is still disabled.
Actual:
Tracking protection is enabled.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1092808,2,I confirmed this on a new profile. Either https://bugzilla.mozilla.org/show_bug.cgi?id=1031033 is wrong or we are getting a pref changed event for polaris that is resetting related prefs in https://bugzilla.mozilla.org/show_bug.cgi?id=1081343.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1092808,3,"Hello Gavin and Tomasz,
We are getting a pref-changed event on startup in https://hg.mozilla.org/mozilla-central/rev/54fab44be5f3#l2.30 that is causing tracking protection to be enabled on restart if polaris is enabled. What's the right thing to do here?
Monica",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1092808,4,The same changeset also doesn't disable the preferences UI if the user clears the polaris pref mid-session.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1092808,5,"The stack to the pref observer being called in this scenario is the following:
I didn't think reading the user pref file triggered preference change observers, but apparently it does if you register your observer early enough. So let's just register the observer later during startup.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1092808,6,"Created attachment 8516217
patch
This adds the observer during finalUIStartup (shortly before first window open), which is late enough that it isn't triggered while reading user prefs in my testing. This seems like a prefs API foot gun in general, and this is just dodging it.",CODE_IMPLEMENTATION,1,FULL_TEXT
1092808,7,https://hg.mozilla.org/integration/fx-team/rev/1e99e10579d2,UNCODED,0,UNMATCHED
1092808,8,https://hg.mozilla.org/mozilla-central/rev/1e99e10579d2,UNCODED,0,UNMATCHED
1092808,9,"Verified on Windows 7 64bit, Ubuntu 13.10 32bit and Mac OSX 10.9.5: 
- using latest Aurora 36.0a2 (07-01-2015) : the UI for tracking protection is not uplifted yet to Aurora
- using latest Nightly 37.0a1 (07-01-2015) : the issue is fixed.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1097236,1,"Created attachment 8520863
twoarrows.png
User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0
Build ID: 20141110004002
Steps to reproduce:
Switched the Dev Edition to the light theme via the radio button the in the devtools options.
Actual results:
The dropdown arrow in the search field became two arrows, one gray and one a glowing blue.
Expected results:
Only a single gray arrow should appear.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1097236,2,cc @bgrins,UNCODED,0,UNMATCHED
1097236,3,Windows 7,UNCODED,0,UNMATCHED
1097236,4,I also see this.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1097236,5,"Created attachment 8520894
Patch",UNCODED,0,UNMATCHED
1097236,6,"Created attachment 8520896
Patch v1.1
Fixed error in commit message",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1097236,7,"Comment on attachment 8520896
Patch v1.1
Review of attachment 8520896:
-----------------------------------------------------------------
This image is only swapped out in the dark theme, so this makes sense (although it's a bit weird, so please add a comment explaining this).  Reassigning the review to someone who can do it.",CODE_REVIEW_REQUEST,0,FULL_TEXT
1097236,8,"Comment on attachment 8520896
Patch v1.1
Review of attachment 8520896:
-----------------------------------------------------------------
As a browser peer, I will delegate review for this to bgrins.",CODE_REVIEW_REQUEST,0,FULL_TEXT
1097236,9,"Comment on attachment 8520896
Patch v1.1
Review of attachment 8520896:
-----------------------------------------------------------------
::: browser/themes/windows/devedition.css
@@ +103,5 @@
We normally use #main-window instead of :root for some but I don't know why.",CODE_REVIEW,0,FULL_TEXT
1097236,10,"I meant ""for some reason"". I see :root is already being used in this file though",CLARIFICATION,0,FULL_TEXT
1097236,11,"Created attachment 8520981
Patch v1.2
Added comment explaining the selector.",CODE_IMPLEMENTATION,1,FULL_TEXT
1097236,12,"Created attachment 8520984
Patch v1.3
Well, looks like the comment didn't get added.",CODE_IMPLEMENTATION,1,FULL_TEXT
1097236,13,https://hg.mozilla.org/integration/fx-team/rev/ef46e2f147ed,UNCODED,0,UNMATCHED
1097236,14,https://hg.mozilla.org/mozilla-central/rev/ef46e2f147ed,UNCODED,0,UNMATCHED
1097236,15,"Comment on attachment 8520984
Patch v1.3
Approval Request Comment
[Feature/regressing bug #]: Devedition theme
[User impact if declined]: This is an obvious visual glitch in Windows with the devedition light theme.  There is a duplicated icon when there should only be one.
[Describe test coverage new/current, TBPL]: None, CSS only
[Risks and why]: Low, CSS only affecting the Windows devedition light theme.
[String/UUID change made/needed]:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1097236,16,*** Bug 1097562 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1097236,17,https://hg.mozilla.org/releases/mozilla-aurora/rev/92a9effa0ed4,UNCODED,0,UNMATCHED
1132964,1,"We should be loading the first tab remote but aren't for some reason. This is breaking some of my SDK tests since they assume a child process is running after the browser starts.
Regressed somewhere in here, bisecting now
https://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=2cb22c058add&tochange=ee093ca70666",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1132964,2,"I have a workaround for my test now, turns out this was actually cause by bug 1047603. Not sure how important this is to fix in Firefox",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1132964,3,"Can we close this? It appears to be working as desired:
Name 	Firefox
Version 	46.0a2
Build ID 	20160205004003
User Agent 	Mozilla/5.0 (Windows NT 6.1; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0",SOLUTION_VERIFICATION,0,FULL_TOKEN
1183934,1,"Created attachment 8633836
0001-Bug-XXXXXXX-only-log-an-error-saving-JSON-if-an-erro.patch
Sync logs may include an entry similar to:
1436815520239	Sync.Engine.History	ERROR	null
This is more of a problem since bug 1148980 landed as any ""error"" entry in the logs cause Sync to generate an error log and note the error in the browser console.
Although I haven't yet reproduced this, I'm confident the problem is https://hg.mozilla.org/mozilla-central/file/e7e69cc8c07b/services/sync/modules/engines.js#l786. This is the callback from Utils.jsonSave, which is at https://hg.mozilla.org/mozilla-central/file/e7e69cc8c07b/services/sync/modules/util.js#l369, and as you can see, the callback is made with null when there's no error - but we still log it.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1183934,2,"Created attachment 8633837
0001-Bug-XXXXXXX-only-log-an-error-saving-JSON-if-an-erro.patch
Actually, let's make the error more descriptive while we are at it.",CODE_IMPLEMENTATION,1,FULL_TEXT
1183934,3,https://hg.mozilla.org/integration/fx-team/rev/e37fbad568b7,UNCODED,0,UNMATCHED
1183934,4,https://hg.mozilla.org/mozilla-central/rev/e37fbad568b7,UNCODED,0,UNMATCHED
1203253,1,"Some of the tests that got removed in bug 1140495 should still be kept around as copies of them did not exist under the in-content/ directory, and they are not specific to the windowed preferences.
See https://hg.mozilla.org/mozilla-central/rev/189cf9021f8b for the files that got removed.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1203253,2,[Tracking Requested - why for this release]: The tests were removed in Firefox43 while on m-c (and uplifted to Aurora42). We should get these added back soon before a regression gets created and unnoticed.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1203253,3,"jaws, are you looking for someone else to do this or are you intending to take it on?",ASSIGNEE_REQUEST,0,FULL_TEXT
1203253,4,"Yeah, I'm going to take this.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1203253,5,"Created attachment 8659898
WIP Patch
This adds back the tests that shouldn't have been removed.
All tests pass except for browser_cookies_exceptions.js, which as a weird failure at line 66, where params.tree.view is undefined for some reason that I can't pinpoint. Any ideas, Matt?",CODE_IMPLEMENTATION,1,FULL_TOKEN
1203253,6,"Comment on attachment 8659898
WIP Patch
Review of attachment 8659898:
-----------------------------------------------------------------
::: browser/components/preferences/permissions.js
@@ -158,5 @@
this change can be removed.",CODE_REVIEW,0,FULL_TEXT
1203253,7,"Created attachment 8665146
Patch
Gijs, do you have any idea why the browser_cookies_exception.js test is failing at the line annotated with ""Test failing with params.tree.view is undefined, see bug XXX""
The original test doesn't fail here.
Try push, https://treeherder.mozilla.org/#/jobs?repo=try&revision=09e8e1eb849e",CODE_IMPLEMENTATION,1,FULL_TOKEN
1203253,8,"Comment on attachment 8665146
Patch
Review of attachment 8665146:
-----------------------------------------------------------------
Discussed on vidyo - failures because of the permission manager observer that nukes the tab before the test finishes.",CODE_REVIEW,0,FULL_TEXT
1203253,9,"Created attachment 8665416
Patch v2
Thanks for your help in debugging the test failure over Vidyo.
The permission observer was fired while the test was running, and the permission observer was set up to close the preferences once it had been hit. Since test case #5 adds a permission during the test run using the permission manager, the permission observer is ran before the test has completed. This caused the tab to close and thus the tree.view getting destroyed.
In the old version of the prefs, the dialog's window.close() was either being done async and/or the references to the dialog within the test kept the window alive long enough to continue the test. However, the test was still written as a no-op since the permission observer was supposed to call cleanUp which would remove the newly added permission causing the rows to be empty at the following check anyways. But... cleanUp() wasn't called, because the permObserver had a typo that was checking for `cleanup`, not `cleanUp`. This is all fixed now.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1203253,10,"Comment on attachment 8665416
Patch v2
Review of attachment 8665416:
-----------------------------------------------------------------
::: browser/components/preferences/in-content/tests/browser_cookies_exceptions.js
@@ +198,5 @@
nit: doc,
(don't need to repeat a local variable name if the property has the same name)",CODE_REVIEW,0,FULL_TOKEN
1203253,11,https://hg.mozilla.org/integration/fx-team/rev/8045d8fcbfe5,UNCODED,0,UNMATCHED
1203253,12,"Backed out for bustage: https://treeherder.mozilla.org/logviewer.html#?job_id=4819315&repo=fx-team
https://hg.mozilla.org/integration/fx-team/rev/cb4bff637489",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1203253,13,https://hg.mozilla.org/integration/fx-team/rev/ee1649a0952f,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1203253,14,"The previous landing of the patch for this bug had two issues with the browser.ini changes. In both instances, the 'skip-if' line was not kept adjacent to their associated test, causing browser_change_app_handler.js to run on non-Windows platforms (as well as browser_healthreport.js).",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1203253,15,"I backed that out in https://hg.mozilla.org/integration/fx-team/rev/c6d706919dd2 for bustage
https://treeherder.mozilla.org/logviewer.html#?job_id=4839107&repo=fx-team",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1203253,16,https://hg.mozilla.org/integration/fx-team/rev/3db46f5d82cc,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1203253,17,https://hg.mozilla.org/mozilla-central/rev/3db46f5d82cc,UNCODED,0,UNMATCHED
1203253,18,"Comment on attachment 8665416
Patch v2
Approval Request Comment
[Feature/regressing bug #]: bug 1140495
[User impact if declined]: no impact, only additional automated tests
[Describe test coverage new/current, TreeHerder]: automated tests being run on mozilla-central
[Risks and why]: none expected
[String/UUID change made/needed]: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1203253,19,"Comment on attachment 8665416
Patch v2
Test-only change; ok to uplift to aurora.",UPLIFT_APPROVAL,0,FULL_TEXT
1203253,20,https://hg.mozilla.org/releases/mozilla-aurora/rev/b60e63d9a14b,UNCODED,0,UNMATCHED
1249818,1,"STR:
1. Open new window
2. Open new tab in that window
3. Switch it to normal (not maximized) mode
4. Hover mouse over the top 2 pixels of background tab
5. Hold left mouse button
6. Move mouse pointer in any direction
AR:  Nothing
ER:  Either A or B
 A) After Step 5 the background tab should become selected, i.e. fix bug 1200877 already
 B) At least for now (while 1200877 isn't fixed), window should follow the pointer in Step 6
This is regression from bug 1219215 (presumably). Regression range:",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1249818,2,"I'm pretty sure we'd want to fix this and wontfix bug 1200877, see:
https://dxr.mozilla.org/mozilla-central/rev/af6356a3e8c56036b74ba097395356d9c6e6c5a3/browser/themes/windows/browser.css#2007-2015
and bug 987067 / bug 887397.
It looks like this regression has affected OS X ever since they made the switch away from mozmousehittest, but nobody noticed. Since bug 1219215 it will have affected Windows as well. The cause is that the entire tab element is marked as ""no-drag"", and we use the clip-path only on the background of the tab. So we should probably tweak the drag region for these items in Firefox's theme code...",PROBLEM_REVIEW,0,FULL_TOKEN
1249818,3,"Do the following lines look strange to you?
3) bug 887397 was requested by MAC USERS ONLY
4) You got pretty clear feedback in bug 986942 and 5 other duplicates that it's unwanted on Windows
(3) and (2) mean that they simply wanted a change for change's sake. Therefore (4) means that it's better to let them have their personal regression not affecting at least Windows users.",CLARIFICATION,0,FULL_TOKEN
1249818,4,"You mean that bug 887397 and the 3 dupes that were filed were all from people that were just imagining things, that their problems were somehow not real?
People would be so much more receptive to your arguments if you weren't so adversarial.
Anyway.
Philipp, should we remove the clip path on Windows?",QUESTION,0,FULL_TEXT
1249818,5,"Philipp is out, moving to Stephen - Stephen, can you take a look at comment #3 and let me know your thoughts? Thanks!",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1249818,6,"I'd like to sum up _facts_ about this whole thing:
1) It started in bug 887397 where _firefox_developers_ (who of course were using MacOS) decided
   to fix their flaw in Australis theme (on MacOS). There're also 2 duplicates reported for MacOS.
2) Bug 887397 was fixed in a very unusual way: instead of increasing margin (or height of empty area)
   it was decided to ""sometimes ignore mouse actions applied to background tab""
   Firefox is the only application in my lifetime which does such malicious thing.
3) As a response to bug 887397 (MacOS-only issue, remember?) there were several reports from
   Windows users. It's a real breakage on Windows (let's forget about Australis itself for now).
4) All users in CC list in bug 887397 are familiar to Nightly, except for arminwagner2008, but still
   there're no reports about this issue, and most of those people aren't even in CC list in this bug.
   I conclude that they just wanted that fancy breakage for one moment, and now they forgot about it.
5)(minor) On Windows (if you ever used it), it's really convenient to drag window using area around
   caption buttons (minimize,resize,close).
It'd be a great idea (at least on Windows) to remove the bug implemented in bug 887397 and instead create/improve a special empty area preserved for dragging OR increase draggable area above tabs as said in (2). OR compress background tabs in height (also a bad option), to avoid 'dead areas' and 'magic buttons' occurrences. OR just remove the bug 887397, because there were no such bug on Windows.
// I just noticed that I already left similar comment, but now (4) is way more actual
That's quite ""adversarial"" as well, don't you think? Yes, I meant that, and yet I'm right, see (4)
BUT, even if it was real issue, it doesn't mean that the issue must be resolved the way it was ""fixed"" in bug 887397. Moreover, it doesn't mean that MacOS users can speak for Windows users.
Nobody reported such issue on Windows -> ""don't fix it if it ain't broke""",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1249818,7,"While this is a recent regression in 47, it seems polishy to me. If the end-users happen to click on the top 5 pixels and are unable to switch tabs, they can workaround by using the other areas of the background tab header area and switch tabs. I think it might be too late to fix this in 47 and would not consider it a release blocker.",PROBLEM_REVIEW,0,FULL_TEXT
1249818,8,"Can we not wait further for UX input here and just fix the regression? Nothing really changed since this was implemented for Australis, so no strong reason to contest the behavior that we had intentionally implemented.",QUESTION,0,FULL_TEXT
1249818,9,How do you intend to fix the regression?,QUESTION,0,FULL_TEXT
1249818,10,"I have no intention, it's your regression ;)
Are you implying that there's no good way to fix this regression? In that case we should just go ahead and remove the clip-path without waiting for UX input, since the current behavior is clearly broken and the worst of all available options.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1249818,11,"Well, removing the clip-path is one option to ""fix"" the regression instance. I am not sure whether or not there are (immediate/easy/upliftable) others, which is why I asked - I don't know that there's a way to restrict the drag stuff without e.g. applying the clip path to the tabstrip (and even then... not 100% that would fix it) which I'd expect to cause other issues (e.g. with dnd on the tabstrip).
However, I disagree that the current state is necessarily worse than the result of removing the clip path. If we accept the original reason for having the clip path, which was to avoid misclicks/drags on tabs when trying to interact with the titlebar, then the failure mode that results from removing the clip path is worse than having the clip path be dead space. That is, if you try and move a window or otherwise interact with the titlebar and ""miss"" and hit the tabs instead, ""nothing happens"" is better than ""you detach a tab into a window"" or ""you change tab selection and lose your context"".
As a result I don't think this bug warrants doing anything right now. We can ping Stephen when he's awake and see if we can make progress that way.",SOLUTION_REVIEW,1,FULL_TOKEN
1249818,12,"I think the decision in bug 887397 was the wrong one.
On OS X you can drag the entire window by using any visible chrome surface and on Windows the window drag area is not very short.
What we currently have due to this bug is dead space. We should make the tab area manipulate the tab and the window area manipulate the window.",SOLUTION_REVIEW,1,FULL_TOKEN
1249818,13,"Created attachment 8768358
patch",UNCODED,0,UNMATCHED
1249818,14,"Pushed by dgottwald@mozilla.com:
https://hg.mozilla.org/integration/fx-team/rev/4eedf5c4e7e2
Remove clip-path from background tabs. r=gijs",UNCODED,0,UNMATCHED
1249818,15,https://hg.mozilla.org/mozilla-central/rev/4eedf5c4e7e2,UNCODED,0,UNMATCHED
1249818,16,*** Bug 986942 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1249818,17,"Comment on attachment 8768358
patch
Approval Request Comment
[Feature/regressing bug #]: bug 1219215
[User impact if declined]: see comment 0
[Describe test coverage new/current, TreeHerder]: n/a
[Risks and why]: simple code removal, low risk
[String/UUID change made/needed]: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1249818,18,"Comment on attachment 8768358
patch
Review of attachment 8768358:
-----------------------------------------------------------------
This patch fixes a regression. Take it in beta 7 and aurora.",UPLIFT_APPROVAL,0,FULL_TEXT
1249818,19,"https://hg.mozilla.org/releases/mozilla-aurora/rev/9f0d18b6adc5
https://hg.mozilla.org/releases/mozilla-beta/rev/ebd3919e8a3a",UNCODED,0,UNMATCHED
1249818,20,"I managed to reproduce this bug on Nightly 47.0a1 (2016-02-19).
I also investigated it using 
- Windows 10 x64
- Ubuntu 14.04 x86
- Mac OS X 10.11.1
There are some problems with latest Nightly 50.0a1 (2016-07-10) build on Mac - there is a narrow area
for which two actions are overlapping: window dragging and tab dragging (see the screencast https://drive.google.com/file/d/0B0nYKG6PRiCcVFdNMEh2a21NVnc/view?usp=sharing).
Also, it seems that on Windows and Mac the fix didn't land yet for Aurora and Beta. I will continue the verification process when the fix will land.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1249818,21,"Could you please check if it was reproducible before bug 887397, e.g. on Nightly from 2014-03-06 ?",VERIFICATION_REQUEST,0,FULL_TEXT
1249818,22,"I tested this on Nightly 2014-03-06 and also on Nightly 2014-03-08 and I couldn't reproduce the overlapping. Besides this, this problem is encountered on Nightly 2016-07-06 (before Bug 1249818 fix landed to mozilla-central). I will further investigate this as soon as possible.",SOLUTION_VERIFICATION,0,FULL_TEXT
1249818,23,"I managed to verify this bug on 
- latest Nightly 50.0a1 (2016-07-13)
- latest Aurora 49.0a2 (2016-07-13)
- 48.0b7 build1 (20160711002726)
using 
- Windows 10 x64
- Ubuntu 14.04 x86
- Mac OS X 10.11
The fix landed and it works as expected. I didn't notice any misbehaviour, except the issue mentioned in comment 19, but it seems that this is an old regression and so, I logged Bug 1286545 for it. 
I will set the corresponding flags.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1254694,1,"After upgrading from Firefox 44.0.2 64 bit to 45.0 64 bit on a Windows 8.1 machine, my search engines have all lost their keywords and their order (it's alphabetic now). I wasn't able to reproduce with a new profile created in 44.0.2 and launching that in 45.0 but will test with a copy of my backup tomorrow.
Further information:
- The profile is very old. But this shouldn't matter since the search engines got migrated from files to a database like structure.
- Some of the search engines got added with the extension 'Add To Search Bar': https://addons.mozilla.org/firefox/addon/add-to-search-bar/
- amazon.de is twice in my list of search engines (might have been done by myself): Once as 'amazon.de', once as 'Amazon.de'",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1254694,2,"Steps to reproduce:
1. Create a new profile in Firefox 44.0.2.
2. Install the German language pack from https://ftp.mozilla.org/pub/firefox/releases/44.0.2/win32/xpi/de.xpi
3. Open about:config.
4. Set general.useragent.locale to 'de'
5. Close and relaunch Firefox.
6. Open search settings.
7. Set keyword for Bing search to 'bg'.
8. Close Firefox.
9. Launch profile in Firefox 45.0 and accept to upgrade for the language pack.
10. Open search settings.
Actual result:
Search keyword for Bing is gone (search engines have still their order). If I reorder the search engines in step 7, they will be order alphabetically after step 10.
There is no error in the Browser Console.
If the language pack doesn't get updated in step 9, keyword and order are untouched after step 10.
Expected result:
Search engines unaltered.
See also bug 1236347 which is also about issues with language packs starting in Firefox 45.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1254694,3,"Florian, any clue? Merci",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1254694,4,This is likely a side effect of bug 1203167 (large search service refactoring that landed for Firefox 45).,PROBLEM_REVIEW,0,FULL_TEXT
1254694,5,will demote if appropriate after understand what is happening and how large the impact - scope.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1254694,6,"Florian, just passing on some information from JorgeV as others noticed this bug being flagged as well
 
<jorgev> this should give you a rough idea https://addons.mozilla.org/en-US/firefox/search/?appver=45.0&atype=5
<jorgev> potentially millions
<kev> yeah, don't know how many people change order of searches and/or use keywords
  eviljeff suspects few of the former and very few for the latter
 <kev> same but should be evaluated, all the same
<jorgev> also, it looks like the real current usage of these language packs is much higher than the average",PROBLEM_REVIEW,0,FULL_TOKEN
1254694,7,:aryx pointed me to this bug. I'm using the en-GB locale build with no language packs installed.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1254694,8,Do you have specific steps to reproduce that don't involve a language pack?,S2R_REQUEST,0,FULL_TEXT
1254694,9,"I have just upgraded from 44.0.2 to 45. And I don't have search engine related extensions neither. No extra steps.
My default search provider is DuckDuckGo that remains as-is. The order of other search providers, Google was first in my case, was lost, and some of my disabled search providers, Bing and Chanbers (UK), were enabled once upgraded.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1254694,10,"I can't reproduce, so there must be a detail or a step missing.
What do you mean with ""enabled""?",QUESTION,0,FULL_TEXT
1254694,11,"Created attachment 8728922
Fix v1
One-line fix. I'll try to write a test.",CODE_IMPLEMENTATION,1,FULL_TEXT
1254694,12,"Created attachment 8728932
Fix for synchronous code path
Someone very helpfully emailed me the relevant parts of a profile that could reproduce the issue without lang pack involved. This profile contains lots of user-installed engines (42), and for some reason the synchronous initialization code path gets triggered. Turns out that code path isn't currently covered by tests, and had trivial mistakes.",CODE_IMPLEMENTATION,1,FULL_TEXT
1254694,13,"Those providers have appeared in the search bar's drop down list.
I have ""user-installed engines"" but only 4, including Bugzilla@Mozilla (this site), FxSiteCompat.com (my site), MDN and GitHub.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1254694,14,"Do you have an add-on enabled that forces a synchronous initialization of the search service? (This causes a warning in the browser console)
If you would like me to try to reproduce with your profile, you can email me these files from the profile:
- search.json
- search-metadata.json
- the searchplugins/ folder",INFO_REQUEST,0,FULL_TOKEN
1254694,15,"Created attachment 8728957
Fix synchronous code path v2 (with test)
Note: Surprisingly, the patch was developped against mozilla-release, but also applies cleanly to the current fx-team.",CODE_IMPLEMENTATION,1,FULL_TEXT
1254694,16,"Created attachment 8729028
Fix for engines from language packs, v2 (with test)",UNCODED,0,UNMATCHED
1254694,17,https://treeherder.mozilla.org/#/jobs?repo=try&revision=324cc19768c3,UNCODED,0,UNMATCHED
1254694,18,"OK, the loss of order and keywords happened before -- annoying but I have already made a txt list that helps me to restore it manually.
However with this latest update (v45.0) I cannot even edit the keywords! There's no option for that. Extremely annoying as I do a lot of research and use them hundreds of times every day.
How is this related to a language pack anyway? I am using English Mozilla.. I think I only have additional Russian spell-checking dictionary installed.
Florian, can I use the fixes you provided and how?",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1254694,19,"See bug 1138112.
If you think you are encountering a different case I may not have identified yet, and would like me to try to reproduce with the search settings of the profile, you can email me the relevant files (see comment 13).
Not until they are released.",ANSWER_TO_QUESTION,0,FULL_TEXT
1254694,20,"Thanks, Florian -- I thought I tried everything, glad the keywords still work.
I think my case is the same as https://bugzilla.mozilla.org/show_bug.cgi?id=1254694#c11 -- lots of search engines installed. In fact I am now removing some that I don't ever use.",CLARIFICATION,0,FULL_TOKEN
1254694,21,"https://hg.mozilla.org/integration/fx-team/rev/eed38188ee0ef70c90db4767dd614508a1a9042c
Bug 1254694 - Fix synchronous code path for search engines metadata migration, r=adw.
https://hg.mozilla.org/integration/fx-team/rev/0837015740ff57ed9c40a6733987f437985b9d9b
Bug 1254694 - Fix search engines metadata migration for engines from language packs, r=adw.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1254694,22,"https://hg.mozilla.org/mozilla-central/rev/eed38188ee0e
https://hg.mozilla.org/mozilla-central/rev/0837015740ff",UNCODED,0,UNMATCHED
1254694,23,"Comment on attachment 8728957
Fix synchronous code path v2 (with test)
Approval Request Comment
[Feature/regressing bug #]: bug 1203167
[User impact if declined]: users with lots of user-installed search plugins are likely to lose search engine metadata (aliases, order, removed default engine).
[Describe test coverage new/current, TreeHerder]: the patch contains an xpcshell test.
[Risks and why]: very low, the patch fixes trivial mistakes in a code path that isn't used in the general case, and that's wrapped in a try/catch block. The code touched by the patch is completely broken without the patch.
[String/UUID change made/needed]: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1254694,24,"Comment on attachment 8729028
Fix for engines from language packs, v2 (with test)
Approval Request Comment
[Feature/regressing bug #]: bug 1203167
[User impact if declined]: users using a language pack are likely to lose search engine metadata (aliases, order, removed default engine).
[Describe test coverage new/current, TreeHerder]: the patch contains an xpcshell test.
[Risks and why]: low; one line fix, modifying the engine id, which is only ever used during metadata migration.
[String/UUID change made/needed]: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1254694,25,"Comment on attachment 8728957
Fix synchronous code path v2 (with test)
Fix a migration issue, taking it on all branches.",UPLIFT_APPROVAL,0,FULL_TEXT
1254694,26,"https://hg.mozilla.org/releases/mozilla-aurora/rev/5b899aff5f55
https://hg.mozilla.org/releases/mozilla-aurora/rev/83559d0c94aa",UNCODED,0,UNMATCHED
1254694,27,"https://hg.mozilla.org/releases/mozilla-beta/rev/6f9cd7e53af2
https://hg.mozilla.org/releases/mozilla-beta/rev/67c6886836d1",UNCODED,0,UNMATCHED
1254694,28,"https://hg.mozilla.org/releases/mozilla-release/rev/6b27b0a8ade6
https://hg.mozilla.org/releases/mozilla-release/rev/156844d61287",UNCODED,0,UNMATCHED
1254694,29,"https://hg.mozilla.org/releases/mozilla-esr45/rev/6b27b0a8ade6
https://hg.mozilla.org/releases/mozilla-esr45/rev/156844d61287",UNCODED,0,UNMATCHED
1254694,30,We should perform further Exploratory Testing around this scenario.,VERIFICATION_REQUEST,0,FULL_TEXT
1254694,31,*** Bug 1256737 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1254694,32,"Added to the release notes with ""Fix a regression causing search engine metadata to be lost in some context (1254694)"" as wording",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1254694,33,"""metadata"" seems a bit jargon-ish to me, maybe ""settings"" instead would be more understandable?",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1254694,34,"Right, updated, merci!",UNCODED,0,UNMATCHED
1254694,35,"I. 
Initial Scenario:  Using steps from comment 1 and referring only to the update scenario which breaks search settings.
44.02 (update to) 45.0
44.02 (update to) 45.0.1
45ESR (update to) 45.0.1 ESR
Windows10 -> reproducible
Mac -> not reproducible
Ubuntu -> reproducible
The update/migration bug can be verified fixed on WINDOWS and UBUNTU for 45.0.1, 45.0.1 ESR with the note that (comment 1) wasn't reproducible on MAC. 
II. 
What I noticed for all OS'es was that installing the language pack and setting the "" general.useragent.locale to 'de' "", then just restarting FF was causing the search engines settings to break. (behavior reproducible for 44.02, 45, 45.01, 45.01ESR)
I also went back a bit and checked if I. and II. scenarios are reproducible for older releases: 42.0 and 43.0.1 with the following result: I. No  II. Yes.
Please advise if scenario II. should be split up into a separate issue.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1254694,36,"Unless I'm misunderstanding something, II. may not be a real issue. When you switch to a different language pack, you switch to a different set of default search engines, so settings can't really be kept, or at least not all of them. We may want to try to preserve the settings automatically for engines that have the same name for both languages (eg. 'Google'), but that's not something we should attempt to do in a dot release. Us losing some settings when the user actively switches back and forth between languages is very different from (and less problematic than) losing settings during an update.",CLARIFICATION,0,FULL_TEXT
1254694,37,"I agree that the scope of this bug was to track and fix the version update issue that was ruining the search settings. In regards to it, the fix can be marked as verified;
I can also confirm that the bug does not regress on build 2 for 45.0.1 ESR:
45.0.1 Build-ID  20160316151906User-Agent  Mozilla/5.0 (Windows NT 10.0; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0
45.0.1Build-ID 20160316151906 Mozilla/5.0 (X11; Linux i686; rv:45.0) Gecko/20100101 Firefox/45.0
45.0.1 Build-ID 20160316151906 User-Agent Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:45.0) Gecko/20100101 Firefox/45.0
Adding the above to comment 34 /point I., we can mark this issues as verified on: Ubuntu14.04/Mac10.11/Windows10 for Release 45.0.1 and 45.0.1ESR (build1+build2)",SOLUTION_VERIFICATION,0,FULL_TOKEN
1265066,1,"I have a bookmark keyword ""b"" for going to Bugzilla bugs.  Typing ""b 12345"" ends up looking like this, with a dash is shown at the end:
bugzilla.mozilla.org: 12345 --",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1265066,2,"Created attachment 8741930
MozReview Request: Bug 1265066 - Hide the separator em dash in bookmark keyword awesomebar results. r?mak
Review commit: https://reviewboard.mozilla.org/r/46849/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/46849/",CODE_IMPLEMENTATION,1,80_PCT_MATCH
1265066,3,https://treeherder.mozilla.org/#/jobs?repo=try&revision=a13a484b9480,UNCODED,0,UNMATCHED
1265066,4,"Comment on attachment 8741930
MozReview Request: Bug 1265066 - Hide the separator em dash in bookmark keyword awesomebar results. r?mak
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/46849/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1265066,5,"Test fixes due to re-setting the type attribute:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=7058cf4d38c7",CODE_IMPLEMENTATION,1,FULL_TOKEN
1265066,6,The leaks on try are due to an unrelated commit that was backed out of fx-team shortly after I refreshed my local copy.,STATUS_UPDATE,0,FULL_TEXT
1265066,7,"Comment on attachment 8741930
MozReview Request: Bug 1265066 - Hide the separator em dash in bookmark keyword awesomebar results. r?mak
https://reviewboard.mozilla.org/r/46849/#review44185",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1265066,8,https://hg.mozilla.org/integration/fx-team/rev/0ae340c9ece2,UNCODED,0,UNMATCHED
1265066,9,https://hg.mozilla.org/mozilla-central/rev/0ae340c9ece2,UNCODED,0,UNMATCHED
1265066,10,"I have reproduced this with Nightly 48.0a1 (2016-04-16) on Elementary OS 64bit. 
This fix is now verified on Firefox release 48.0
Build ID 	20160726073904
User Agent 	Mozilla/5.0 (X11; Linux x86_64; rv:48.0) Gecko/20100101 Firefox/48.0
[bugday-20160803]",SOLUTION_VERIFICATION,0,FULL_TOKEN
1271750,1,"This is e10s specific issue when shim is disabled.  When e10s is disabled, the addon works fine regadless of the shim status (true or false).
Steps to Reproduce:
1.Install addon from https://addons.mozilla.org/en-US/firefox/addon/awesome-screenshot-capture-/?src=search
2.Go to about:config 
3.Set 'extensions.interposition.enabled' to 'false' to disable shim
4.Access https://pinterest.com/
5.Select an option from the addon menu to take screenshot
Actual Result:
Addon does not take screenshot.
Expected Result:
Addon should take screenshot with e10s enabled and shim disabled.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1271750,2,perfect - thank you Abe for the information!,UNCODED,0,UNMATCHED
1271750,3,Is this not a dupe of 1271725?,QUESTION,0,FULL_TEXT
1271750,4,"Highly related but not 100% the same. Bug 1271725 is specific to mac which is the addon [awesome screenshot] does not function in e10s enabled Firefox with shim enabled or not. Unlike mac, in windows and Linux the addon works fine with e10s and shim enabled. 
When shim is disabled and e10s is enabled, the addon does not work in all platforms.Which is this bug is about.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1271750,5,"What version of Awesome Screenshot were you testing? According to its version history a new release came out on June 7.
https://addons.mozilla.org/en-US/firefox/addon/awesome-screenshot-capture-/versions/?page=1#version-2.4.11
Any way to tell if the new version fixes the issue?",QUESTION,0,FULL_TOKEN
1271750,6,"I can still able to reproduce this with version 2.4.11.
But it is no more reproducible with the addon's latest version,3.0.7.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1271750,7,resolving unless beta shows some issues - all awesome screen shot issues should be resolved.  no longer use shims.  this was in the late July fix that they worked on with our testing.,STATUS_UPDATE,0,FULL_TOKEN
1353954,1,"The pref controls whether the search field within the about:preferences is visible.
We may enable it for Nightly builds only at some point, but will eventually need to enable it for release builds. This bug will track enabling it for release builds.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1353954,2,"Neeinfo myself, I will work on this once we could enable the search feature.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1353954,3,"Created attachment 8877421
Bug 1353954 - Enable browser.preferences.search by default
Review commit: https://reviewboard.mozilla.org/r/148814/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/148814/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1353954,4,"Comment on attachment 8877421
Bug 1353954 - Enable browser.preferences.search by default
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/148814/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1353954,5,"There are few bugs remained for completing Photon Search, we've decided to enable this flag earlier and hopefully we can start putting QA work once it get finished.
Once this feature is stable, we'll have a follow-up to clean up all Enable browser.preferences.search flags (firefox.js and mochites) in codebase.",STATUS_UPDATE,0,FULL_TOKEN
1353954,6,"Release Note Request (optional, but appreciated)
[Why is this notable]: Enables searching within preferences
[Affects Firefox for Android]: no
[Suggested wording]: Search within the Preferences to find relevant options across categories
[Links (documentation, blog post, etc)]: n/a",UNCODED,0,UNMATCHED
1353954,7,"Comment on attachment 8877421
Bug 1353954 - Enable browser.preferences.search by default
https://reviewboard.mozilla.org/r/148814/#review153536",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1353954,8,"Pushed by rchien@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/abf6d08bb386
Enable browser.preferences.search by default r=jaws",UNCODED,0,UNMATCHED
1353954,9,"release note added for Firefox Nigtly 56.0a1. I changed slightly the wording for ""Search within the Options/Preferences panel to find relevant options across categories""",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1353954,10,https://hg.mozilla.org/mozilla-central/rev/abf6d08bb386,UNCODED,0,UNMATCHED
1353954,11,"This feature ""Enable the browser.preferences.search preference to turn on in-content filtering of the preferences"" has been implemented with Latest Nightly 56.0a1 on Windows 10 (64 Bit). 
Build ID: 20170615030208
User Agent : Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0
[bugday-20170614]",SOLUTION_VERIFICATION,0,FULL_TOKEN
1353954,12,"Build ID: 20170618030207
User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0
""browser.preferences.search"" pref is turned on by default on Firefox Nightly 56.0a1 on Windows 10 x 64, Mac OS X 10.12 and Ubuntu 16.04 x64.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1353954,13,Added to Fx56 (Beta) release notes.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1355481,1,"Not a giant perf impact (9ms in my profile), but this doesn't seem intended.
This is when accessing Weave.Status at http://searchfox.org/mozilla-central/rev/624d25b2980cf5f83452b040e6d664460f9b7ec5/browser/base/content/browser-syncui.js#68
Of course this is on a profile where sync isn't configured, otherwise I assume these status.js and browserid_identity.js modules would already be loaded.
See the profile at https://perfht.ml/2nABiet",PROBLEM_MOTIVATION,0,FULL_TOKEN
1355481,2,"It looks like this should be referencing this.weaveService.ready, as already done a few lines up in that function.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1355481,3,"Created attachment 8858914
Bug 1355481 - Avoid initializing Sync on window unload if Sync is not configured.
Review commit: https://reviewboard.mozilla.org/r/130904/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/130904/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1355481,4,"Comment on attachment 8858914
Bug 1355481 - Avoid initializing Sync on window unload if Sync is not configured.
https://reviewboard.mozilla.org/r/130904/#review133636",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1355481,5,"Pushed by eoger@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e5e754f197cd
Avoid initializing Sync on window unload if Sync is not configured. r=markh",UNCODED,0,UNMATCHED
1355481,6,"Backed out for breaking many tests:
https://hg.mozilla.org/integration/autoland/rev/b708d01388e3862be454e28985755687fe2bb0d4
Push with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=e5e754f197cd5f1f0bc3c4179c9f1236b3b43c48&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception&filter-resultStatus=retry&filter-resultStatus=usercancel&filter-resultStatus=runnable
Failure log: https://treeherder.mozilla.org/logviewer.html#?job_id=92380435&repo=autoland
[task 2017-04-18T15:33:23.675276Z] 15:33:23     INFO - GECKO(1239) | TEST-UNEXPECTED-FAIL | unknown test url | uncaught exception - TypeError: this.weaveService is undefined at onUnload@chrome://browser/content/browser-syncui.js:70:1
[task 2017-04-18T15:33:23.676853Z] 15:33:23     INFO - GECKO(1239) | EventListener.handleEvent*init@chrome://browser/content/browser-syncui.js:64:5
[task 2017-04-18T15:33:23.676933Z] 15:33:23     INFO - GECKO(1239) | _delayedStartup@chrome://browser/content/browser.js:1510:5
[task 2017-04-18T15:33:23.677771Z] 15:33:23     INFO - GECKO(1239) | EventListener.handleEvent*onLoad@chrome://browser/content/browser.js:1239:5
[task 2017-04-18T15:33:23.679405Z] 15:33:23     INFO - GECKO(1239) | onload@chrome://browser/content/browser.xul:1:1
[task 2017-04-18T15:33:23.679495Z] 15:33:23     INFO - GECKO(1239) | JavaScript error: chrome://browser/content/browser-syncui.js, line 70: TypeError: this.weaveService is undefined",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1355481,7,"Comment on attachment 8858914
Bug 1355481 - Avoid initializing Sync on window unload if Sync is not configured.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/130904/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1355481,8,"I got bit by the |this| scoping, sorry about this.",CLARIFICATION,0,FULL_TEXT
1355481,9,"Pushed by eoger@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/533c5fc7c41a
Avoid initializing Sync on window unload if Sync is not configured. r=markh",UNCODED,0,UNMATCHED
1355481,10,https://hg.mozilla.org/mozilla-central/rev/533c5fc7c41a,UNCODED,0,UNMATCHED
1357049,1,Should add one button which opens private browsing window in the Private Browsing onBoarding tour,PROBLEM_DESCRIPTION,0,FULL_TEXT
1357049,2,The latest specs have become as adding one button in the Private Browsing onBoarding tour which highlights the Private Window button in the hamburger menu,PROBLEM_DESCRIPTION,0,80_PCT_MATCH
1357049,3,*** Bug 1357047 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1357049,4,"Suppose we can dupe this. Let's close it and just reopen it if the works there are too much to do.
*** This bug has been marked as a duplicate of bug 1357046 ***",STATUS_UPDATE,0,FULL_TEXT
1357049,5,remove whiteboard tag due to its duplicated,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1357049,6,Reopened for the reason addressed in bug 1357046.,STATUS_UPDATE,0,FULL_TEXT
1357049,7,"I'd still like to use the <script> method of running the script in the webpage, it will ensure that we're using the webpage's privileges to run it safely.
Have you tried using a resource URI instead of a chrome one. Both should work from the content process in theory but maybe because we're loading from chrome we're getting the wrong privileges.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1357049,8,"I think we don't need to include the full UITour-lib into onboarding.
Since the only function we use in UITour is `showHighlight`, we can pick the message sending portion from UITour and do it in onboarding. I tested the following script on about:home, about:newtab, and activity-stream, they all works fine.
Put `_sendEvent` as one of the onboarding method
```
  _sendEvent(action, data) {
    var event = new this._window.CustomEvent(""mozUITour"", {
      bubbles: true,
      detail: {
      action,
      data: data || {}
      }
    });
    this._window.document.dispatchEvent(event);
  }
```
Embed this in button action (this might be too simple to not worth wrap another layer)
```
this._sendEvent(""showHighlight"", {
  target: ""addons""
});
```",SOLUTION_REVIEW,1,FULL_TOKEN
1357049,9,"Just discussed this offline and we think we're not sure if it's an API that keep unchanged, and there's no similar way of using the library like that. So maybe we should try using UI-Tourlib.js as a whole first.",SOLUTION_REVIEW,1,FULL_TEXT
1357049,10,"Created attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
Review commit: https://reviewboard.mozilla.org/r/147540/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/147540/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1357049,11,"I tried to move UITour-lib.js as resource:// but the result is the same. I can't access Mozilla.UITour created from content window from framescript. But scripts inside content window can access it.
I was told it's blocked intentionally for content window (but I didn't remember the detail for now, I'll put the corresponding details if needed).
So some solutions came to me are to move some code to content window altogether. The selections may be like
1. Just move the event listener out to content window. And when we need to communicate something between listener and  framescript we just dispatch a new CustomEvent.
2. Move almost all the code out to the content window, but we're not able to move them out completely since we still need some code from framescript for jobs like accessing properties in the future.
3. other possibility?
I personally more prefer the 1st choice and just made a sample patch based on that. Mossop how do you think about it?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1357049,12,"Oh I didn't realise you were trying to access it from the framescript. You'd need to bypass the X-ray wrappers to get at the object in the content window.
This sounds like a sane approach to me. I'll review the patch now.",SOLUTION_REVIEW,1,FULL_TEXT
1357049,13,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review151940
This looks good, please just double check the button wording before landing.
::: browser/extensions/onboarding/locales/en-US/onboarding.properties:14
(Diff revision 1)
This prototype suggests the button should be ""Show Me Where To Find Private Browsing"". Is there a more up to date spec?
https://dl.dropboxusercontent.com/u/105549/tour2.framer/index.html",QUESTION,0,FULL_TEXT
1357049,14,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152210
Thank you for the works.
::: browser/extensions/onboarding/content/onboarding.css:172
(Diff revision 1)
Nit: please use `.onboarding-no-button` since we are scoping our selectors and have doen this with other selectors, thanks.",CODE_REVIEW,0,FULL_TEXT
1357049,15,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152214
Nice to got some progress here!
To make a correct button action I think we should also take `setCompleted` into consideration
::: browser/extensions/onboarding/content/onboarding-tour-agent.js:10
(Diff revision 1)
let's organize with alphabet order
::: browser/extensions/onboarding/content/onboarding-tour-agent.js:11
(Diff revision 1)
Though `setCompleted` is now a placeholder, we still need to call `setCompleted` from the target tour to mark the call-to-action as completed (and implement the action later). 
So to complete a button action, we need find a way to access `tour.setCompleted` in this script.",CODE_REVIEW,0,FULL_TOKEN
1357049,16,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152258
::: browser/extensions/onboarding/content/onboarding.css:204
(Diff revision 1)
a redundant line here",CODE_REVIEW,0,FULL_TEXT
1357049,17,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152264
::: browser/extensions/onboarding/content/onboarding.css:188
(Diff revision 1)
put button in grid can't fulfill the spec position requirement. I suggest use `position: absolute` (as close button) instead. With this way we don't need to add `onboarding-no-button` class as well.
Here's the style I've tested
```
.onboarding-tour-button > button {
  position: absolute;
  bottom: 30px;
  offset-inline-end: 26px;
  padding: 10px 20px;
  font-size: 15px;
  font-weight: 600;
  line-height: 21px;
  background: #0d96ff;
  border: none;
  border-radius: 3px;
  color: #fff;
  box-shadow: 0 1px 0 rgba(0,0,0,0.23);
  cursor: pointer;
}
```",CODE_REVIEW,0,FULL_TOKEN
1357049,18,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/147540/diff/1-2/",UNCODED,0,UNMATCHED
1357049,19,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152264
I saw you modified that in the polish bug, should I just leave that to you?",QUESTION,0,FULL_TEXT
1357049,20,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152214
For me this was in the scope of other bugs for checking tour's completion, but it's easy to fix. I've included that in the revised version.",STATUS_UPDATE,0,FULL_TEXT
1357049,21,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review151940
Since we got l10n string updated and l10n review in bug 1357046, I made the l10n string of the button there to reduce some review process. So no more l10n strings in this patch.",STATUS_UPDATE,0,FULL_TEXT
1357049,22,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/147540/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1357049,23,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152846",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1357049,24,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152264
Please fix in this bug. We may need to wait the final images in the polish bug.",ANSWER_TO_QUESTION,0,FULL_TEXT
1357049,25,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/147540/diff/3-4/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1357049,26,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/147540/diff/4-5/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1357049,27,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review152264
The easiest solution for me is to stretch the range of the page grid to the bottom of the page, see the patch. Although page grid overlaps footer, but as long as we don't write page description and footer super long it should be fine, and we can place button near the bottom to met the latest spec.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1357049,28,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
https://reviewboard.mozilla.org/r/147540/#review153258
please make sure other tests green before landing
::: browser/extensions/onboarding/content/onboarding.js:128
(Diff revision 5)
don't need this now",CODE_REVIEW,0,FULL_TEXT
1357049,29,"Comment on attachment 8876111
Bug 1357049 - add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/147540/diff/5-6/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1357049,30,"Pushed by rchien@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/8da76b2d3d1c
add one button in the Private Browsing and Search tour of onBoarding overlay to demonstrate the corresponding features. r=Fischer,gasolin,mossop",UNCODED,0,UNMATCHED
1357049,31,*** Bug 1357036 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1357049,32,https://hg.mozilla.org/mozilla-central/rev/8da76b2d3d1c,UNCODED,0,UNMATCHED
1357049,33,*** Bug 1371534 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1357049,34,"I have seen the feature being implemented with latest Nightly 56.0a1 on Windows 10 (64 bit).
This bug's fix is now verified in Latest Nightly.
Build ID   :   20170616030207
User Agent :   Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0
[bugday 20170614]",SOLUTION_VERIFICATION,0,FULL_TOKEN
1357049,35,This issue has been verified on Win 10 x64.,SOLUTION_VERIFICATION,0,FULL_TEXT
1401249,1,"+++ This bug was initially created as a clone of Bug #1397379 +++
In bug 1357517, Preferences.get was replaced by getStringPref.  In bug 1397379, we added an `undefined` parameter to it as the default return value, to avoid it throwing an error.
That worked in preventing the error from being thrown, but turns out that the value returned is actually `null` instead of `undefined` (as documented in bug 1357517 comment 63), but the switch statement below only checks for `undefined`.
[Tracking Requested - why for this release]:
Breaks the Flash Click-to-Play rollout for fresh profiles. Note: this is *not* a regression from bug 1390705. It is from bug 1357517, which should have been fixed by 1397379, but the fix was incomplete.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1401249,2,"Created attachment 8909869
Bug 1401249 - Fix getStringPref usage in clicktoplay-rollout.
getStringPref(.., undefined) actually returns null instead of undefined.
Review commit: https://reviewboard.mozilla.org/r/181366/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/181366/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1401249,3,"Comment on attachment 8909869
Bug 1401249 - Fix getStringPref usage in clicktoplay-rollout.
https://reviewboard.mozilla.org/r/181366/#review186590",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1401249,4,"Pushed by felipc@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/d94508124715
Fix getStringPref usage in clicktoplay-rollout. r=Gijs",UNCODED,0,UNMATCHED
1401249,5,"Comment on attachment 8909869
Bug 1401249 - Fix getStringPref usage in clicktoplay-rollout.
Approval Request Comment
[Feature/Bug causing the regression]: bug 1357517
[User impact if declined]: Flash will fail to go Click-to-Play for *new* profiles.
[Is this code covered by automated tests?]: No
[Has the fix been verified in Nightly?]: Not applicable, as it depends on the update channel being ""release""
[Needs manual test from QE? If yes, steps to reproduce]: Yes. Mihai discovered this on bug 1390705. Once we have a new RC with this fix in place, he should retest it.
[List of other uplifts needed for the feature/fix]: None
[Is the change risky?]: No
[Why is the change risky/not risky?]: Just fixes the flash clicktoplay rollout, doesn't affect any other areas of the code.
[String changes made/needed]: none",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1401249,6,"Comment on attachment 8909869
Bug 1401249 - Fix getStringPref usage in clicktoplay-rollout.
Fix for click to play system addon, so that new users will get this option. 
This should be in the 56 RC2 later on this week.",UPLIFT_APPROVAL,0,FULL_TOKEN
1401249,7,https://hg.mozilla.org/releases/mozilla-release/rev/2f265cbbebc6e5797cb5ab39eaa1be2c70f2fb29,UNCODED,0,UNMATCHED
1401249,8,https://hg.mozilla.org/mozilla-central/rev/d94508124715,UNCODED,0,UNMATCHED
1401249,9,"I managed to verify this issue on Firefox 57.0a1 (2017-09-19) (64-bit), under Windows 10x64.
Click-to-Play staged rollout is set to 1.4 by default and Shockwave Flash is set to 'Ask to Activate' by default. 
I'm not marking this issue Verified Fix until I can confirm the fix also on Firefox 56.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1401249,10,"I managed to verify this issue also on Firefox 56.0-build3, under Windows 10x64, macOS 10.12 and under Ubuntu 16.04x64. Shockwave Flash is set by default to 'Ask to Activate' and Click-to-Play staged rollout is set to 1.4.",SOLUTION_VERIFICATION,0,FULL_TEXT
1407435,1,"STR:
- Right click on any toolbar button
- Click ""Remove from Toolbar""
- Go inside customization mode
AR:
- The button that was just removed has an invisible icon
ER:
- The button icon should be visible
It seems like the animate-out class is not properly removed.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1407435,2,Regression of bug 1390313,PROBLEM_LOCALIZATION,0,FULL_TEXT
1407435,3,"Erica, could you take this?",ASSIGNEE_REQUEST,0,FULL_TEXT
1407435,4,"Created attachment 8917513
Bug 1407435 - After animating out from the toolbar, the widget no longer remains invisible.
Review commit: https://reviewboard.mozilla.org/r/188470/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/188470/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1407435,5,"Comment on attachment 8917513
Bug 1407435 - After animating out from the toolbar, the widget no longer remains invisible.
https://reviewboard.mozilla.org/r/188470/#review193730
Thanks, I was able to reproduce the bug (aNode.parentNode is null) as well as confirm that the patch fixed it.",SOLUTION_VERIFICATION,0,FULL_TEXT
1407435,6,"Pushed by ntim.bugs@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/462c85ecfe5b
After animating out from the toolbar, the widget no longer remains invisible. r=jaws",UNCODED,0,UNMATCHED
1407435,7,https://hg.mozilla.org/mozilla-central/rev/462c85ecfe5b,UNCODED,0,UNMATCHED
1407435,8,"I was able to reproduce the issue on Nightly build (2017-10-10) using Windows 7 x64. 
Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:58.0) Gecko/20100101 Firefox/58.0
Verified fixed on latest Nightly 58.0a1 (2017-10-16) across platforms: Windows 10 x64, Windows 7 x64, Mac OS X 10.13 and Ubuntu 16.04 x64.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1421905,1,"Created attachment 8933193
synced-tabs-sidebar-is-blank.png
Steps to reproduce:
1. Launch the latest Nightly
2. Open synced tabs sidebar with tabs disable state
   => Shows sync-illustration-issue.svg, message and button
3. Restart Nightly
Actual Results:
Synced tabs sidebar is blank. It will be shown after reopening sidebar (or switching menu).
Expected Results:
Same with before restarting Nightly.
Regression range:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=5043401c5447ab8cfb6edef4b806e1ad52e53ddc&tochange=8696159a170c286813795dba1fe1cebb623e3410",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1421905,2,"Thank you for the report and for the regression range.
What I'm seeing here is a good ol' race: in the sidebar initialization code, in some rare cases we might update the UI before we are done initializing Weave.Service [0][1][2]. That means we show a blank screen.
From there it all goes downhill: since the tab engine is disabled, SyncedTabs.jsm never triggers a UI update since it only listens to ""tab engine sync finished"" events [3]. So we stay on that blank screen forever.
A simple fix is to listen to ""weave:service:ready"", so we can update the UI one last time.
Ultimately, I don't think isConfiguredToSyncTabs is the right abstraction because it assumes that the tab engine is enabled if Service is not ready. We should refactor that to explicitly make the distinction between these states, but it is a bit more work.
Patch to come.
[0] https://searchfox.org/mozilla-central/rev/be78e6ea9b10b1f5b2b3b013f01d86e1062abb2b/browser/components/syncedtabs/SyncedTabsDeckComponent.js#78,92
[1] https://searchfox.org/mozilla-central/rev/be78e6ea9b10b1f5b2b3b013f01d86e1062abb2b/services/sync/modules/SyncedTabs.jsm#208
[2] https://searchfox.org/mozilla-central/rev/be78e6ea9b10b1f5b2b3b013f01d86e1062abb2b/browser/components/syncedtabs/SyncedTabsDeckComponent.js#128,132
[3] https://searchfox.org/mozilla-central/rev/be78e6ea9b10b1f5b2b3b013f01d86e1062abb2b/services/sync/modules/SyncedTabs.jsm#176",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1421905,3,"Created attachment 8933378
Bug 1421905 - Listen to service start notification in Synced Tabs sidebar.
Review commit: https://reviewboard.mozilla.org/r/204290/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/204290/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1421905,4,"Comment on attachment 8933378
Bug 1421905 - Listen to service start notification in Synced Tabs sidebar.
https://reviewboard.mozilla.org/r/204290/#review209940
Thanks!
::: browser/components/syncedtabs/SyncedTabsDeckComponent.js:116
(Diff revision 1)
please comment that this is an intended fallthrough.",CODE_REVIEW,0,FULL_TEXT
1421905,5,"Comment on attachment 8933378
Bug 1421905 - Listen to service start notification in Synced Tabs sidebar.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/204290/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1421905,6,"Pushed by eoger@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/5dfa3982d405
Listen to service start notification in Synced Tabs sidebar. r=markh",UNCODED,0,UNMATCHED
1421905,7,https://hg.mozilla.org/mozilla-central/rev/5dfa3982d405,UNCODED,0,UNMATCHED
1421905,8,This bug fix has verified in Nightly build (20180104220114). Thanks!,SOLUTION_VERIFICATION,0,FULL_TEXT
1442559,1,"central-as-beta simulation: https://treeherder.mozilla.org/#/jobs?repo=try&revision=d41944694361da6a2742694bf2c6cd0ca79d1b4e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception&filter-resultStatus=retry&filter-resultStatus=usercancel&filter-resultStatus=runnable&selectedJob=165416922
Log: https://treeherder.mozilla.org/logviewer.html#?job_id=165416922&repo=try
Unused whitelist item. sourceName: /(?:res|gre-resources)\/(ua|html)\.css$/i errorMessage: /Unknown pseudo-class .*\bfullscreen\b/i",UNCODED,0,UNMATCHED
1442559,2,"Xidorn, you fixed this in bug 1333175. Any reason why this is failing again?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1442559,3,"Oh, are we shipping this now in 60 so we can remove it from the whitelist? I'm not sure why this isn't failing on Nightly builds though.",QUESTION,0,FULL_TEXT
1442559,4,"This new central-as-beta simulation has the check below the list removed and passes: https://treeherder.mozilla.org/#/jobs?repo=try&revision=4d8d55b5b0c758813921149b9594519e1b3a1e22&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception&filter-resultStatus=retry&filter-resultStatus=usercancel&filter-resultStatus=runnable
So is this code still of use? https://dxr.mozilla.org/mozilla-central/rev/df0e967f8e8fa30a69338008b6ee296bf5e9c545/browser/base/content/test/static/browser_parsable_css.js#140-146
The pref associated with it - full-screen-api.unprefix.enabled - is false on release and beta but true on nightly: https://dxr.mozilla.org/mozilla-central/rev/df0e967f8e8fa30a69338008b6ee296bf5e9c545/modules/libpref/init/all.js#5160-5164",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1442559,5,"Created attachment 8955699
Bug 1442559 - Remove unused CSS whitelist entry for fullscreen.
Review commit: https://reviewboard.mozilla.org/r/224784/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/224784/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1442559,6,"We are not shipping unprefixed fullscreen in 60, so I don't expect it to become useless. There must be some other reason...",PROBLEM_REVIEW,0,FULL_TEXT
1442559,7,"So the reason here is that the propName items added in bug 1441882 whitelists all warnings, and thus any whitelist item appended after them would be reported unused.
Sounds like bug 1441882 is basically making the whole whitelist meaningless. You can remove everything before the first {propName} item and the test would still pass.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1442559,8,The reason is that function ignoredError would always return true if there is a whitelist item contains neither sourceName nor errorMessage.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1442559,9,"To avoid this kind of issue happens again, we probably should really add a catch all whitelist item and ensure that it never touched.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1442559,10,"Comment on attachment 8955699
Bug 1442559 - Remove unused CSS whitelist entry for fullscreen.
https://reviewboard.mozilla.org/r/224784/#review230814
r- per bug comments that this isn't the right fix.",CODE_REVIEW,0,FULL_TOKEN
1442559,11,Working on a patch.,STATUS_UPDATE,0,FULL_TEXT
1442559,12,"Created attachment 8955728
Bug 1442559 part 1 - Make it clearer what whitelist item filters the error.
Review commit: https://reviewboard.mozilla.org/r/224804/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/224804/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1442559,13,"Created attachment 8955729
Bug 1442559 part 2 - Use a separate whitelist for prop names.
Review commit: https://reviewboard.mozilla.org/r/224806/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/224806/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1442559,14,"Created attachment 8955730
Bug 1442559 part 3 - Detect whitelist item which doesn't have any condition.
Review commit: https://reviewboard.mozilla.org/r/224808/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/224808/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1442559,15,"Comment on attachment 8955728
Bug 1442559 part 1 - Make it clearer what whitelist item filters the error.
https://reviewboard.mozilla.org/r/224804/#review230840
::: browser/base/content/test/static/browser_parsable_css.js:164
(Diff revision 1)
Nit:
```js
return JSON.stringify(item, (key, value) => {
  return (value instanceof RegExp) ? value.toString() : value;
});
```
::: browser/base/content/test/static/browser_parsable_css.js:192
(Diff revision 1)
Nit: add `because of whitelist item` to the string before dumping the whitelist item, please.",CODE_REVIEW,0,FULL_TOKEN
1442559,16,"Comment on attachment 8955729
Bug 1442559 part 2 - Use a separate whitelist for prop names.
https://reviewboard.mozilla.org/r/224806/#review230842
::: browser/base/content/test/static/browser_parsable_css.js:488
(Diff revision 1)
Looks like this could also use `dumpWhitelistItem`?
::: browser/base/content/test/static/browser_parsable_css.js:499
(Diff revision 1)
Ditto.
More generally, can you factor these 3 loops out into a function that just takes the whitelist in question as an argument, with perhaps an argument to use in the error message string to clarify which whitelist this came from - though if we use `dumpWhitelistItem` everywhere I don't think it'll be much of an issue figuring out what it is anyway.",CODE_REVIEW,0,FULL_TOKEN
1442559,17,"Comment on attachment 8955730
Bug 1442559 part 3 - Detect whitelist item which doesn't have any condition.
https://reviewboard.mozilla.org/r/224808/#review230844",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1442559,18,"Comment on attachment 8955728
Bug 1442559 part 1 - Make it clearer what whitelist item filters the error.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/224804/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1442559,19,"Comment on attachment 8955729
Bug 1442559 part 2 - Use a separate whitelist for prop names.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/224806/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1442559,20,"Comment on attachment 8955730
Bug 1442559 part 3 - Detect whitelist item which doesn't have any condition.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/224808/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1442559,21,"Pushed by xquan@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/b2bf42743feb
part 1 - Make it clearer what whitelist item filters the error. r=Gijs
https://hg.mozilla.org/integration/autoland/rev/6371120b7c1c
part 2 - Use a separate whitelist for prop names. r=Gijs
https://hg.mozilla.org/integration/autoland/rev/d540c55c96c5
part 3 - Detect whitelist item which doesn't have any condition. r=Gijs",UNCODED,0,UNMATCHED
1442559,22,"Backed out for eslint failure at /builds/worker/checkouts/gecko/browser/base/content/test/static/browser_parsable_css.js:474
Push that caused the failure: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=d540c55c96c5e4fdab1434032628fa876152b8e1
Failure log: https://treeherder.mozilla.org/logviewer.html#?job_id=165884240&repo=autoland&lineNumber=240
Backout: https://hg.mozilla.org/integration/autoland/rev/53f082b32ba9eb0b9febdc97373c89b9ac500bd3",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1442559,23,"Comment on attachment 8955728
Bug 1442559 part 1 - Make it clearer what whitelist item filters the error.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/224804/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1442559,24,"Comment on attachment 8955729
Bug 1442559 part 2 - Use a separate whitelist for prop names.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/224806/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1442559,25,"Comment on attachment 8955730
Bug 1442559 part 3 - Detect whitelist item which doesn't have any condition.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/224808/diff/2-3/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1442559,26,"Pushed by xquan@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/4d6a3eb93a00
part 1 - Make it clearer what whitelist item filters the error. r=Gijs
https://hg.mozilla.org/integration/autoland/rev/756d5b77b540
part 2 - Use a separate whitelist for prop names. r=Gijs
https://hg.mozilla.org/integration/autoland/rev/39e3ac3b1194
part 3 - Detect whitelist item which doesn't have any condition. r=Gijs",UNCODED,0,UNMATCHED
1442559,27,"6 failures in 831 pushes (0.007 failures/push) were associated with this bug in the last 7 days.    
Repository breakdown:
* mozilla-beta: 6
Platform breakdown:
* windows7-32-nightly: 1
* windows7-32-devedition: 1
* windows10-64-nightly: 1
* windows10-64-devedition: 1
* macosx64-nightly: 1
* macosx64-devedition: 1
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1442559&startday=2018-02-26&endday=2018-03-04&tree=all",SOLUTION_VERIFICATION,0,FULL_TOKEN
1442559,28,"https://hg.mozilla.org/mozilla-central/rev/4d6a3eb93a00
https://hg.mozilla.org/mozilla-central/rev/756d5b77b540
https://hg.mozilla.org/mozilla-central/rev/39e3ac3b1194",UNCODED,0,UNMATCHED
1442559,29,"Comment on attachment 8955729
Bug 1442559 part 2 - Use a separate whitelist for prop names.
https://reviewboard.mozilla.org/r/224806/#review230918
Code analysis found 1 defect in this patch:
 - 1 defect found by mozlint
You can run this analysis locally with:
 - `./mach lint path/to/file` (JS/Python)
If you see a problem in this automated review, please report it here: http://bit.ly/2y9N9Vx
::: browser/base/content/test/static/browser_parsable_css.js:472
(Diff revision 2)
Error: 'whitelist' is already declared in the upper scope. [eslint: no-shadow]",CODE_REVIEW,0,FULL_TOKEN
1442559,30,"Comment on attachment 8955730
Bug 1442559 part 3 - Detect whitelist item which doesn't have any condition.
https://reviewboard.mozilla.org/r/224808/#review230920
Code analysis found 1 defect in this patch:
 - 1 defect found by mozlint
You can run this analysis locally with:
 - `./mach lint path/to/file` (JS/Python)
If you see a problem in this automated review, please report it here: http://bit.ly/2y9N9Vx
::: browser/base/content/test/static/browser_parsable_css.js:480
(Diff revision 2)
Error: 'whitelist' is already declared in the upper scope. [eslint: no-shadow]",UNCODED,0,UNMATCHED
1442559,31,Verified fixed with the latest central-as-beta simulation: https://treeherder.mozilla.org/#/jobs?repo=try&revision=dc0e79a9e1e17888ac8cebe43ae3bdaf1c7b4a57&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception&filter-resultStatus=retry&filter-resultStatus=usercancel&filter-resultStatus=runnable,SOLUTION_VERIFICATION,0,FULL_TEXT
1455735,1,"Chutten found this while working on bug 1450690. Here's a traceback of the error preventing enrollment:
InvalidStateError: A mutation operation was attempted on a database that did not allow mutations. JS Stack trace: transaction@IndexedDB.jsm:289:39
objectStore@IndexedDB.jsm:317:23
getStore@AddonStudies.jsm:87:10
start@AddonStudies.jsm:273:13
Async*wrapAsync/</<@SandboxManager.jsm:108:9
wrapAsync/<@SandboxManager.jsm:103:14
execute@SandboxManager.jsm:57:2272
async*registerAction/<@SandboxManager.jsm:61:18
@SandboxManager.jsm:58:53
evalInSandbox@SandboxManager.jsm:57:12
runAsyncCallback@ActionSandboxManager.jsm:74:26
async*runRecipe@ActionsManager.jsm:97:17
async*run@RecipeRunner.jsm:240:9
async*init@RecipeRunner.jsm:80:13
async*finishInit@Normandy.jsm:97:11
async*observe@Normandy.jsm:53:7
ssi_sendRestoreCompletedNotifications@SessionStore.jsm:4584:7
ssi_restoreWindow@SessionStore.jsm:3523:5
ssi_restoreWindows@SessionStore.jsm:3629:5
initializeWindow@SessionStore.jsm:1177:11
onBeforeBrowserWindowShown/<@SessionStore.jsm:1328:9
promise callback*onBeforeBrowserWindowShown@SessionStore.jsm:1313:5
ssi_observe@SessionStore.jsm:764:9
onLoad@browser.js:1337:5
onload@browser.xul:1:1",STACK_TRACE,0,FULL_TOKEN
1455735,2,"In my testing,. Fx60 is not affected by this.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1455735,3,"Chutten: I'm having trouble reproducing this on a fresh profile with a build from mozilla-central (cset 5d73549d363f, if it matters). I'm using the STR from bug 1450690, and everything seems to be working fine.
An easier way to exercise the code path in question is something like this in the console:
ChromeUtils.import(""resource://normandy/lib/AddonStudies"");
AddonStudies.start({recipeId: 1, name: ""test"", description: ""test test"", addonUrl: ""https://net-mozaws-prod-us-west-2-normandy.s3.amazonaws.com/extensions/taarexpv2@shield.mozilla.org-1.0.13-signed.xpi""})
Can you get some situation where you can reproduce the error? Either with the stage server, or with the snippet above? I'm starting to wonder if this is an intermittent bug, or if there is something else going on that we haven't noticed.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1455735,4,"Using the default settings in a prefs.js as follows with a new profile:
user_pref(""security.content.signature.root_hash"", ""DB:74:CE:58:E4:F9:D0:9E:E0:42:36:BE:6C:C5:C4:F6:6A:E7:74:7D:C0:21:42:7A:03:BC:2F:57:0C:8B:9B:90"");
user_pref(""extensions.shield-recipe-client.api_url"", ""https://normandy.stage.mozaws.net/api/v1"");
user_pref(""app.normandy.dev_mode"", true);
user_pref(""app.normandy.logging.level"", 0);
I'm getting 8 addons installed currently from staging, nothing in about:studies, no enrollment in about:telemetry.
Also browser console logs:
1524573762197	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 329
1524573762200	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 309
1524573762201	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 308
1524573762202	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 304
1524573762203	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 302
1524573762204	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 298
1524573762205	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 269
1524573762205	app.normandy.normandy-driver.actions	DEBUG	Starting study for recipe 268",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1455735,5,"Created attachment 8970677
Bug 1455735 - Await running recipes
Review commit: https://reviewboard.mozilla.org/r/239412/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/239412/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1455735,6,"My reduced test case in 2 bypassed the actual problem. I was able to reproduce the problem today, and the attached patch fixes the problem for me. The problem I fixed here was a regression caused by the changes in bug 1436113.",SOLUTION_VERIFICATION,0,FULL_TEXT
1455735,7,"Comment on attachment 8970677
Bug 1455735 - Await running recipes
https://reviewboard.mozilla.org/r/239412/#review245280
Gah, sorry for not catching this in review. :-(",UNCODED,0,UNMATCHED
1455735,8,"Pushed by mcooper@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/801fa27ae7b8
Await running recipes r=Gijs",UNCODED,0,UNMATCHED
1455735,9,I mispoke in comment 5. The regressing bug is *not* bug 1436113. The regressing bug is bug 1440777.,CLARIFICATION,0,FULL_TEXT
1455735,10,https://hg.mozilla.org/mozilla-central/rev/801fa27ae7b8,UNCODED,0,UNMATCHED
1455735,11,Marking this as verified per https://bugzilla.mozilla.org/show_bug.cgi?id=1450690#c54.,SOLUTION_VERIFICATION,0,FULL_TEXT
1458856,1,"[Description:]
The following reproduces only on a FF client when using a new non-existent preference added manually from about:config.
[Prerequisites:]
You need access to New Admin interface (https://normandy-admin.stage.mozaws.net/control-new)
1. Set the app.normandy.dev_mode preference to true to run recipes immediately on startup.
2. Set the app.normandy.logging.level preference to 0 to enable more logging.
3. Set the security.content.signature.root_hash preference to DB:74:CE:58:E4:F9:D0:9E:E0:42:36:BE:6C:C5:C4:F6:6A:E7:74:7D:C0:21:42:7A:03:BC:2F:57:0C:8B:9B:90.
4. Set the preference value for app.normandy.api_url set to https://normandy.stage.mozaws.net/api/v1
[Steps:]
1. Open Firefox client with a new profile.
2. Open about:config in a new tab and right click and add a new preferences: e.g. non_existent_preference, int, with value 10.
3. Open Admin center and create a new rollout type recipe, targeting the step2 preference, changing the value to something else, e.g. 12.
4. Publish step 3 recipe.
5. On the profile from step 1, set prerequisites and restart.
6. Open browser console and check the results.
[Actual Result:]
1525337683826	app.normandy.recipe-runner	INFO	Executing recipe ""pref-r-2"" (action=preference-rollout)
[Exception... ""Component returned failure code: 0x8000ffff (NS_ERROR_UNEXPECTED) [nsIPrefBranch.getIntPref]"" nsresult: ""0x8000ffff (NS_ERROR_UNEXPECTED)"" location: ""JS frame :: resource://normandy/lib/PrefUtils.jsm :: getPref :: line 34"" data: no]
getPref resource://normandy/lib/PrefUtils.jsm:34:16 	_run/newRollout.preferences< resource://normandy/actions/PreferenceRolloutAction.jsm:41:24 	map self-hosted:292:17 	_run resource://normandy/actions/PreferenceRolloutAction.jsm:38:20 	InterpretGeneratorResume self-hosted:1264:8
[Expected Result:]
The preference rollout should be executed successfully with no browser console error.",ERROR_MESSAGE,0,FULL_TOKEN
1458856,2,"Created attachment 8973029
Bug 1458856 - Handle prefs with only a user value in preference rollout
Review commit: https://reviewboard.mozilla.org/r/241560/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/241560/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1458856,3,"Comment on attachment 8973029
Bug 1458856 - Handle prefs with only a user value in preference rollout
https://reviewboard.mozilla.org/r/241560/#review247390
Code analysis found 1 defect in this patch:
 - 1 defect found by mozlint
You can run this analysis locally with:
 - `./mach lint path/to/file` (JS/Python)
If you see a problem in this automated review, please report it here: http://bit.ly/2y9N9Vx
::: toolkit/components/normandy/lib/PrefUtils.jsm:46
(Diff revision 1)
Error: Unnecessary 'else' after 'return'. [eslint: no-else-return]",CODE_REVIEW,0,FULL_TOKEN
1458856,4,"Comment on attachment 8973029
Bug 1458856 - Handle prefs with only a user value in preference rollout
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/241560/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1458856,5,"Comment on attachment 8973029
Bug 1458856 - Handle prefs with only a user value in preference rollout
https://reviewboard.mozilla.org/r/241560/#review247516",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1458856,6,"Pushed by mcooper@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/b28e041ff83c
Handle prefs with only a user value in preference rollout r=Gijs",UNCODED,0,UNMATCHED
1458856,7,https://hg.mozilla.org/mozilla-central/rev/b28e041ff83c,UNCODED,0,UNMATCHED
1458856,8,"Verified as fixed on the following builds:
Beta 61.0b6(20180517141400) and Nightly 62.0a1(20180520220103).
No error is displayed in browser console when a rollout is performed on a new non-existent preference.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1462624,1,"We have detected a build metrics regression from push:
https://hg.mozilla.org/integration/autoland/pushloghtml?changeset=79ab9d3259944b808a88f0c6783504e269bcff2c
As author of one of the patches included in that push, we need your help to address this regression.
Regressions:
  >100KBytes  installer size windows2012-64 pgo      60,131,949.00 -> 60,304,238.58
  >100KBytes  installer size osx-cross opt           66,436,988.83 -> 66,610,752.67
  >100KBytes  installer size windows2012-32 pgo      55,905,641.67 -> 56,047,577.67
You can find links to graphs and comparison views for each of the above tests at: https://treeherder.mozilla.org/perf.html#/alerts?id=13279
On the page above you can see an alert for each affected platform as well as a link to a graph showing the history of scores for this test. There is also a link to a treeherder page showing the jobs in a pushlog format.
To learn more about the regressing test(s), please see: https://developer.mozilla.org/en-US/docs/Mozilla/Performance/Automated_Performance_Testing_and_Sheriffing/Build_Metrics",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1462624,2,":Mardak Please look for reducing installer size increases, caused by bug 1462427.",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1462624,3,I'm going to make an assumption here that this is caused by https://github.com/mozilla/activity-stream/commit/c132f298c64b3e357d8a492e77299fcf2c3c25fa bug 1448918 and it should be expected.,PROBLEM_LOCALIZATION,0,FULL_TEXT
1462624,4,"About 80KB-82KB of that can be accounted for by images added in https://github.com/mozilla/activity-stream/commit/c132f298c64b3e357d8a492e77299fcf2c3c25fa, and likely the rest by the code changes.",PROBLEM_LOCALIZATION,0,FULL_TEXT
1462624,5,"In addition, https://github.com/mozilla/activity-stream/commit/49d13ab4dfd6c549bf9672c61e92ff69cac88512 for bug 1432676 added about ~67KB for illustrations for the new onboarding tour, which should also be expected",PROBLEM_LOCALIZATION,0,FULL_TEXT
1462624,6,"Created attachment 8977045
png compression
Looks like there's some savings to be made in the newly added pngs.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1462624,7,"Created attachment 8977047
Link to GitHub pull-request: https://github.com/mozilla/activity-stream/pull/4157",UNCODED,0,UNMATCHED
1462624,8,"Commit pushed to master at https://github.com/mozilla/activity-stream
https://github.com/mozilla/activity-stream/commit/365c10e75037ed6d3d8141b52f530efddb6db590
chore(images): Compress recently added pngs (#4157)
Fix Bug 1462624 - 0.25 - 0.29% installer size (osx-cross, windows2012-32, windows2012-64) regression on push 79ab9d3259944b808a88f0c6783504e269bcff2c (Fri May 18 2018)",PROBLEM_DESCRIPTION,0,FULL_TEXT
1462624,9,https://hg.mozilla.org/mozilla-central/rev/238c2caac25d,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1465254,2,"Created attachment 8981676
Bug 1465254 - Fix copy error in periodic updates task
Review commit: https://reviewboard.mozilla.org/r/247816/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/247816/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1465254,3,"Comment on attachment 8981676
Bug 1465254 - Fix copy error in periodic updates task
https://reviewboard.mozilla.org/r/247816/#review253912",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1465254,4,"Pushed by sfraser@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/c094fc31b95f
Fix copy error in periodic updates task r=sfraser",UNCODED,0,UNMATCHED
1465254,5,https://hg.mozilla.org/mozilla-central/rev/c094fc31b95f,UNCODED,0,UNMATCHED
1469362,1,"+++ This bug was initially created as a clone of Bug #1468991 +++
Changes since last update:
#9595 Disable ftp support in Chrome 59+, add file chooser at file
#9819 Fix regression affecting the horizontal `viewerContainer` offset for small window widths (PR 9816 follow-up)
#9809 Allow `FontFaceObject.getPathGenerator` to ignore non-embedded fonts during rendering
#9802 Update `ColorSpace` and `PDFImage` to use `Uint8ClampedArray`s and remove manual clamping/rounding
#9821 Set the correct document title when opening a new file in the `GENERIC` default viewer",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1469362,2,"Pushed by ryanvm@gmail.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/280327567bdf
Update pdf.js to version 2.0.602. r=bdahl",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1469362,3,https://hg.mozilla.org/mozilla-central/rev/280327567bdf,UNCODED,0,UNMATCHED
1479309,1,"shield-content-frame.js is only needed in content processes when an event received from a shield page. It's only ever really needed when about:studies has been loaded in a process, but the quickest path to getting rid of it it is just loading it when we get a ""ShieldPageEvent"" event in a frame script.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1479309,2,"Created attachment 8995828
Bug 1479309: Don't load shield-content-frame.js until needed.
Review commit: https://reviewboard.mozilla.org/r/260166/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/260166/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1479309,3,"Comment on attachment 8995828
Bug 1479309: Don't load shield-content-frame.js until needed.
Review request updated; see interdiff: https://reviewboard.mozilla.org/r/260166/diff/1-2/",AUTO_REV_REQ_UP_CODE_IMPLEMENTATION,0,FULL_TEXT
1479309,4,"Comment on attachment 8995828
Bug 1479309: Don't load shield-content-frame.js until needed.
https://reviewboard.mozilla.org/r/260166/#review267386
Thanks!
Also, since this is blocking the memshrink bug, I'm curious if you've profiled how much memory these changes save? If you haven't already profiled it, don't worry about. I'm sure the the changes are worth it, I'm just curious.",CODE_REVIEW,0,FULL_TOKEN
1479309,5,"See whiteboard. According to dominator tree analysis, this frame script uses about 7K in a process with a single tab (more for processes with multiple tabs). In practice, actual savings tend to be slightly more than that tool reports, though.",ANSWER_TO_QUESTION,0,FULL_TEXT
1479309,6,"https://hg.mozilla.org/integration/mozilla-inbound/rev/2d46e1fe31214d36d1e11218deb44423baee2c26
Bug 1479309: Don't load shield-content-frame.js until needed. r=mythmon",CODE_IMPLEMENTATION,1,FULL_TOKEN
1479309,7,https://hg.mozilla.org/mozilla-central/rev/2d46e1fe3121,UNCODED,0,UNMATCHED
1479309,8,"Backout by csabou@mozilla.com:
https://hg.mozilla.org/mozilla-central/rev/fe6020e5c9d9
Backed out 12 changesets (bug 1479309, bug 1479312, bug 1479313, bug 1479310, bug 1479235, bug 1479945, bug 1479241, bug 1479318) for causing a big performance regression on OS X. a=backout",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1479309,9,"Backed out for causing a big performance regression on OS X and as request by igoldan. 
https://hg.mozilla.org/mozilla-central/rev/fe6020e5c9d901a40fa2e7ea2f1ab2a36bf6d856",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1479309,10,"https://hg.mozilla.org/integration/mozilla-inbound/rev/a396e7027858121f002ff1544fd28fabe5996685
Bug 1479309: Don't load shield-content-frame.js until needed. r=mythmon",CODE_IMPLEMENTATION,1,FULL_TOKEN
1479309,11,https://hg.mozilla.org/mozilla-central/rev/a396e7027858,UNCODED,0,UNMATCHED
1485422,1,"We'd like to add rating stars for CFR according to the UX spec:
https://mozilla.invisionapp.com/share/V9LVKJUACMD#/screens",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1485422,2,"Created attachment 9005038
stars design capture
Stars seem to be available here (and I've attached a capture of it)
https://mozilla.invisionapp.com/share/YWLSGDZGUSF#/screens/316896230",SCREENSHOT,0,FULL_TOKEN
1485422,3,"Created attachment 9005050
wip screenshot",UNCODED,0,UNMATCHED
1485422,4,"Created attachment 9005416
Link to GitHub pull-request: https://github.com/mozilla/activity-stream/pull/4393",UNCODED,0,UNMATCHED
1485422,5,"Created attachment 9005445
Bug 1485422 - Add rating stars to CFR
Depends on D4532",AUTO_ATTACH_CODE_IMPLEMENTATION,0,95_PCT_MATCH_PROCESSED
1485422,6,"Comment on attachment 9005445
Bug 1485422 - Add rating stars to CFR
Adam Hillier :ahillier has approved the revision.",CODE_REVIEW,0,FULL_TEXT
1485422,7,"Pushed by elee@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/0cdebe3c53f8
Add rating stars to CFR r=ahillier",UNCODED,0,UNMATCHED
1485422,8,"Commit pushed to master at https://github.com/mozilla/activity-stream
https://github.com/mozilla/activity-stream/commit/9ab80ad72851e430ea55bdd4f2dba7033fb508b9
Bug 1485422 - Add rating stars to CFR (#4393)",UNCODED,0,UNMATCHED
1485422,9,https://hg.mozilla.org/mozilla-central/rev/0cdebe3c53f8,UNCODED,0,UNMATCHED
1485422,10,https://hg.mozilla.org/mozilla-central/rev/8937a84b0811,UNCODED,0,UNMATCHED
1485422,11,"I have verified that the issue is no longer reproducible on Nightly 63.0a1 (20180902220539) and the latest Nightly 64.0a1 (20180923220427) on Windows 10 x64, Mac 10.13.3, and Arch Linux x64.",SOLUTION_VERIFICATION,0,FULL_TEXT
1513854,1,"In Bug 1506175, we introduced the ability to fetch recipes from Remote Settings. 
The pref ""app.normandy.remotesettings.enabled"" is false by default.
We could gradually enable this feature once the server parts are in place.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1513854,2,"The Data Science ticket for the progressive rollout using Feature Gate for Fx 67 is Bug 1533030
I suggest that we use this ticket to enable it by default in Fx 68",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1513854,3,"Created attachment 9052036
Bug 1513854 - Read Normandy recipes from Remote Settings on Nightly
Read Normandy recipes from Remote Settings by default",CODE_IMPLEMENTATION,1,FULL_TEXT
1513854,4,"Mike, how should we proceed now that Bug 1538248 landed?
Can we use Feature Gates to enable it for Nightly users? (Leaving the default setting to false) 
Or shall we set default to false in Nightly only using `#ifdef RELEASE_OR_BETA` in the prefs file?
In terms of QA, I'd imagine that we can take an existing test plan and just add the pref flip parts...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1513854,5,"I thought about this a bit, and realized we have a small bug in how feature gates manage prefs. I filed (and added a patch for) bug 1541469 for that issue. Once that is done, we should be able to turn this on for Nightly users only by updating the feature definition to have:
```toml
default-value:
  default: false
  nightly: true
```
Then later when we want to turn this on for all channels and let it ride the train, we can update it again to be
```toml
default-value: true
```
Additionally, QA will be able to test this by setting the pref to true. After bug 1541469 they'll need to add the pref, as it won't exist by default.",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1513854,6,https://treeherder.mozilla.org/#/jobs?repo=try&revision=90bd702a3db7f0d9afa762308989f422cc57d17b,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1513854,7,"Ciprian, how does it look on the QA side?
Mike, does the patch seem ok?",CODE_REVIEW_REQUEST,0,FULL_TOKEN
1513854,8,https://treeherder.mozilla.org/#/jobs?repo=try&revision=4722646312bfab234a14fd3f3d6f654d70b3879e,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1513854,9,The patch looks good.,CODE_REVIEW,0,FULL_TEXT
1513854,10,"Pushed by mleplatre@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/9b66e9b91074
Read Normandy recipes from Remote Settings on Nightly r=mythmon",UNCODED,0,UNMATCHED
1513854,11,"Backed out 2 changesets (Bug 1535056, Bug 1513854) for linux build bustages and failed Gecko Decision Task CLOSED TREE
https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&selectedJob=244114623
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=244114623&repo=autoland&lineNumber=36549",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1513854,12,https://treeherder.mozilla.org/#/jobs?repo=try&revision=cd990ee93c08e87b5351cf3cd086d3b0b306c392,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1513854,13,https://treeherder.mozilla.org/#/jobs?repo=try&revision=d5da6d732eb41b2021e5e893ed94a65392c24327,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
1513854,14,"Pushed by mleplatre@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/4e111da82652
Read Normandy recipes from Remote Settings on Nightly r=mythmon",UNCODED,0,UNMATCHED
1513854,15,https://hg.mozilla.org/mozilla-central/rev/4e111da82652,UNCODED,0,UNMATCHED
1513854,16,Looks like Mathieu took care of my ni?,STATUS_UPDATE,0,FULL_TEXT
1513854,17,Removing the ni? as we signed off on the feature as GREEN.,SOLUTION_VERIFICATION,0,FULL_TEXT
1519164,1,"The UI tours live behind a pref. A new pref needs to be uplifted so that 65 Release users are served the correct tour. To do this, Johann needs the exact URLs.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1519164,2,"This just made it to production:
Normal window:
- https://www.mozilla.org/en-US/firefox/65.0/content-blocking/start/?newtab=true
- https://www.mozilla.org/en-US/firefox/65.0/content-blocking/start/?newtab=true&variation=2
Private Window:
- https://www.mozilla.org/en-US/firefox/65.0/content-blocking/start/
- https://www.mozilla.org/en-US/firefox/65.0/content-blocking/start/?variation=2",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1519164,3,Great! Thank you.,UNCODED,0,UNMATCHED
1519164,4,"[Tracking Requested - why for this release]:
New URLs for content blocking tour (just a pref update)",UNCODED,0,UNMATCHED
1519164,5,"Created attachment 9035876
Bug 1519164 - Update content blocking UI tour url. r=nhnt11",UNCODED,0,UNMATCHED
1519164,6,"Pushed by jhofmann@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/939479cc5903
Update content blocking UI tour url. r=nhnt11",UNCODED,0,UNMATCHED
1519164,7,https://hg.mozilla.org/mozilla-central/rev/939479cc5903,UNCODED,0,UNMATCHED
1519164,8,Please nominate this for Beta approval when you get a chance.,UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1519164,9,"Comment on attachment 9035876
Bug 1519164 - Update content blocking UI tour url. r=nhnt11
[Beta/Release Uplift Approval Request]
Feature/Bug causing the regression: None
User impact if declined: Content blocking UI tour URL isn't up to date (we might do changes on the new version only)
Is this code covered by automated tests?: No
Has the fix been verified in Nightly?: No
Needs manual test from QE?: Yes
If yes, steps to reproduce: Try to open the content blocking tour through different means, e.g. on first use or on about:privatebrowsing. It should still work, but the url should contain ""content-blocking"" instead of ""tracking-protection""
List of other uplifts needed: None
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): Simple pref update
String changes made/needed: None",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1519164,10,"Comment on attachment 9035876
Bug 1519164 - Update content blocking UI tour url. r=nhnt11
[Triage Comment]
Ensures that the Content Blocking UI tour URL is up to date. Approved for 65.0b11.",UPLIFT_APPROVAL,0,FULL_TEXT
1519164,11,https://hg.mozilla.org/releases/mozilla-beta/rev/7448d41d4fdc,UNCODED,0,UNMATCHED
1519164,12,"I have verified that the Content Blocking UI tour is correctly displayed in normal/private browsing and the URL contains the ""content-blocking"" string. Tested on latest Nightly 66.0a1 and Beta 65.0b11 across OSes: Win 10 x64, macOS 10.13 and Ubuntu 16.04 x86.",SOLUTION_VERIFICATION,0,FULL_TEXT
1526439,1,"Required by DOD Stig
extensions.update.enabled
false",PROBLEM_MOTIVATION,0,FULL_TOKEN
1526439,2,"Created attachment 9042597
Bug 1526439 - Add an enteprise policy for extension updates.",UNCODED,0,UNMATCHED
1526439,3,Forgot the ftl,UNCODED,0,UNMATCHED
1526439,4,"Pushed by mozilla@kaply.com:
https://hg.mozilla.org/integration/autoland/rev/2eec2334d48f
Add an enteprise policy for extension updates. r=Felipe,flod",UNCODED,0,UNMATCHED
1526439,5,https://hg.mozilla.org/mozilla-central/rev/2eec2334d48f,UNCODED,0,UNMATCHED
1526439,6,*** Bug 1507855 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1526439,7,*** Bug 1507577 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1526439,8,"Comment on attachment 9042597
Bug 1526439 - Add an enteprise policy for extension updates.
### ESR Uplift Approval Request
* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: Policy related
* **User impact if declined**: 60.7 policy won't match 67
* **Fix Landed on Version**: Firefox 67
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Policy only, has test
* **String or UUID changes made by this patch**: None. FTL change is not needed for ESR.",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1526439,9,"Comment on attachment 9042597
Bug 1526439 - Add an enteprise policy for extension updates.
New policy, OK for ESR 60.7.",UPLIFT_APPROVAL,0,FULL_TEXT
1526439,10,https://hg.mozilla.org/releases/mozilla-esr60/rev/3fcb4a70f591,UNCODED,0,UNMATCHED
1565273,1,"Reproducible: always
Steps To Reproduce:
1. Open any web page
2. Wait for page loading
3. Right click Address bar
Actual Results:
Caret blinks at beginning of url. And context Menu Pops Up
Expected Results:
Whole url should be selected. And context Menu Pops Up
Regression window:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=9381b434999bc6f36111d1d307416a1f6d57c84c&tochange=759f043488918654501e945736c825529ea70fa5
Regressed by: 759f043488918654501e945736c825529ea70fa5 	harry  Bug 1562145 - Fix mouse-dragging regression caused by patch to 1554864. r=dao
harry,
Your patch seems to cause the regression. Can you please look into this?",S2R,0,90_PCT_MATCH
1565273,2,"please, let's add simple mochitest-browser for these basic selection/selectall actions.",TESTCASE_REQUEST,0,FULL_TEXT
1565273,3,"Created attachment 9077544
Bug 1565273 - Context menu clicks ignore browser.urlbar.clickSelectsAll pref. Add tests for selectAll behaviour. r?mak",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1565273,4,"Sorry to only post a WIP patch for this, but I'm out of office tomorrow. I think this issue only affects Windows, and I've removed the part that would cause the issue. Unfortunately I don't have access to a Windows machine or a VM atm-- maybe someone with one could take a look and see if this patch works and if it causes further issues.
This patch also includes tests, but they're WIP and some of them fail/hang the browser. Dao, if you have time, would you mind taking a look to see if there's something obviously wrong with the tests, esp the right-click test? That's the one that hangs. I haven't written too many of these so it might be a beginner's mistake.
If we want to get the fix out quickly so we can uplift bug 1562145 ASAP, someone could post the fix part tomorrow (provided it works...). Otherwise, I could read feedback on the tests and work on them on the weekend/Monday.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1565273,5,"This is outdated, right? The bug affects all the cases where clickSelectsAll is true, I didn't test on Mac the before/after situation though. On linux clickSelectsAll is false, but one can set it to true, and afaict it will work as on Windows.
And if I read the patch correctly, we are indeed not making a distinction anymore. Is this correct?",CODE_REVIEW,0,FULL_TOKEN
1565273,6,"This bug doesn't affect me on my Mac. I think the bad behaviour is caused by the Windows platform gate (removed in the attached patch), meaning this issue only affects Windows. This bug is independent of the `browser.urlbar.clickSelectsAll` pref and whether `clickSelectsAll` happens at all -- it only affects contextmenu clicks, and only the contextmenu handler has the Windows platform gate.
The Windows platform gate originates here: https://searchfox.org/mozilla-central/source/toolkit/content/widgets/textbox.xml#248. I ported it over to the UrlbarInput contextmenu handler when I was removing the clickSelectsAll behaviour from XUL textboxes. This bug shows that the platform gate now causes issues -- I believe Windows was getting its contextmenu clickSelectsAll behaviour from somewhere else in `textbox.xml`, and that is now removed.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1565273,7,"With version 68, on Linux if I set clickSelectsAll to false, it doesn't select on contextmenu. It does with CSA set to true.
On Windows it does regardless of CSA.
With your patch, on all platforms it acts like on Linux, that is not the old behavior. I think the old Windows behavior makes more sense for all the platforms, on right click we should select all regardless of clickSelectsAll.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1565273,8,"FWIW, on GNOME Web, the behavior is what exists currently in Firefox (at least on Linux). Same with Falkon. 
Chromium does the previous Windows behavior.
Safari doesn't place a cursor or perform any selection, it just shows a context menu. 
I'm not sure that the GNOME Web behavior is desirable (or even designed behavior), but figured I would note it, since I am generally in favor of good platform integration.",PROBLEM_REVIEW,0,FULL_TOKEN
1565273,9,"Pushed by htwyford@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/89925bf4fa18
Context menu clicks ignore browser.urlbar.clickSelectsAll pref. Add tests for selectAll behaviour. r=mak",UNCODED,0,UNMATCHED
1565273,10,"Backed out for bc failures on browser_urlbar_selection.js
Backout link: https://hg.mozilla.org/integration/autoland/rev/ecee4c970f98a929f5b2795438f5ec57ab3dd6df
Log link: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=258514024&repo=autoland&lineNumber=38068",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1565273,11,*** Bug 1569473 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1565273,12,I've pushed a new revision to Phabricator that passes try on all platforms: https://treeherder.mozilla.org/#/jobs?repo=try&revision=da2bcef0ca0855637bad7f1e91b796557f7c085d&selectedJob=258793266,CODE_IMPLEMENTATION,1,FULL_TEXT
1565273,13,"Pushed by htwyford@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d6d95a998ee9
Context menu clicks ignore browser.urlbar.clickSelectsAll pref. Add tests for selectAll behaviour. r=mak",UNCODED,0,UNMATCHED
1565273,14,"This was backed out because of frequent failures of Bug 1569813.
Push with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&revision=d6d95a998ee92e29376666d918c6b52dfd651917&selectedJob=258879611
https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&selectedJob=258896828&resultStatus=testfailed%2Cbusted%2Cexception&revision=8419292a5c75752f661b0ca7f1d2dde341faa8ce&searchStr=os%2Cx%2C10.14%2Cshippable%2Copt%2Cmochitests%2Ctest-macosx1014-64-shippable%2Fopt-mochitest-browser-chrome-e10s-2%2Cm%28bc2%29
Failure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=258896828&repo=autoland&lineNumber=4034
[task 2019-07-29T23:46:06.588Z] 23:46:06     INFO - TEST-OK | browser/components/urlbar/tests/browser/browser_urlbar_selection.js | took 318ms
[task 2019-07-29T23:46:06.600Z] 23:46:06     INFO - checking window state
[task 2019-07-29T23:46:06.611Z] 23:46:06    ERROR - GECKO(1882) | TEST-UNEXPECTED-FAIL | unknown test url | uncaught exception - NS_ERROR_FAILURE: Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIController.doCommand] at doCommand@chrome://global/content/elements/textbox.js:221:18
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | _initUI/<@chrome://global/content/elements/textbox.js:110:16
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | EventListener.handleEvent*_initUI@chrome://global/content/elements/textbox.js:107:22
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | connectedCallback@chrome://global/content/elements/textbox.js:73:12
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | LifecycleConnectedCallback*@chrome://global/content/elements/textbox.js:232:18
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | @chrome://global/content/customElements.js:727:29
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | @chrome://global/content/customElements.js:746:3
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | observe@resource://gre/modules/CustomElementsListener.jsm:25:31
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | JavaScript error: chrome://global/content/elements/textbox.js, line 221: NS_ERROR_FAILURE: Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIController.doCommand]
[task 2019-07-29T23:46:06.612Z] 23:46:06     INFO - GECKO(1882) | JavaScript error: resource://testing-common/PromiseTestUtils.jsm, line 112: uncaught exception: Object",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1565273,15,"Backout by csabou@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e1464f88d798
Backed out changeset d6d95a998ee9 for causing bug 1569813.",UNCODED,0,UNMATCHED
1565273,16,"These test failures on Mac look like they might be fairly involved to solve, so on mak's recommendation I've disabled the new tests on Mac and filed follow-up bug 1570474. A new revision with the tests disabled on Mac is now on Phabricator. Here's try with `browser_urlbar_selection.js` re-run a number of times on Windows and Linux to check for intermittent failure: https://treeherder.mozilla.org/#/jobs?repo=try&revision=76e992ee84aa9e9d2412e8ebe67e8dda6b49e72f",CODE_IMPLEMENTATION,1,FULL_TOKEN
1565273,17,"Pushed by htwyford@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/0ab19ed23861
Context menu clicks ignore browser.urlbar.clickSelectsAll pref. Add tests for selectAll behaviour. r=mak",UNCODED,0,UNMATCHED
1565273,18,https://hg.mozilla.org/mozilla-central/rev/0ab19ed23861,UNCODED,0,UNMATCHED
1565273,19,"Harry, could you please ask for Beta uplift?",UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1565273,20,"Comment on attachment 9077544
Bug 1565273 - Context menu clicks ignore browser.urlbar.clickSelectsAll pref. Add tests for selectAll behaviour. r?mak
### Beta/Release Uplift Approval Request
* **User impact if declined**: Annoying user interface regression.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: 
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The change to user interface behaviour is very small: just a couple of lines. It affects only text-selection behaviour, so the worst-case outcome is just some other similar text-selection regression. The vast majority of this patch is simply new tests, for both the new and existing text-selection behaviour.
* **String changes made/needed**:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1565273,21,I think we should have QA do some testing around this since this is itself a regression from another patch which landed in this code.,VERIFICATION_REQUEST,0,FULL_TEXT
1565273,22,"Comment on attachment 9077544
Bug 1565273 - Context menu clicks ignore browser.urlbar.clickSelectsAll pref. Add tests for selectAll behaviour. r?mak
Fixes a regression in URL bar behavior in Fx69. Approved for 69.0b11.",UPLIFT_APPROVAL,0,FULL_TEXT
1565273,23,Ah! Is it too late to retract beta approval? I just realized there are a couple of nits in this patch that I didn't fix. I'm going to fix them and post a new patch shortly.,STATUS_UPDATE,0,FULL_TEXT
1565273,24,"Comment on attachment 9077544
Bug 1565273 - Context menu clicks ignore browser.urlbar.clickSelectsAll pref. Add tests for selectAll behaviour. r?mak
No worries. Just attach a rolled-up patch for Beta uplift when you're ready to do so and re-request approval (you don't need to fill out the questionnaire again, just setting the flag is enough).",CODE_UPDATE_REQUEST,0,FULL_TEXT
1565273,25,"Created attachment 9082691
bug_1565273_beta.diff
### Beta/Release Uplift Approval Request
* **User impact if declined**: 
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: 
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: 
* **String changes made/needed**:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1565273,26,I removed two `console.log` statements that snuck their way into the previous patch. I'll prepare a patch removing those statements from Nightly as well.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1565273,27,"Comment on attachment 9082691
bug_1565273_beta.diff
Thanks.",UNCODED,0,UNMATCHED
1565273,28,"Created attachment 9082694
Bug 1565273 - Remove unnecessary console.logs. r?mak",UNCODED,0,UNMATCHED
1565273,29,https://hg.mozilla.org/releases/mozilla-beta/rev/209780edbdf9,UNCODED,0,UNMATCHED
1565273,30,"Backed out changeset 209780edbdf9 (Bug 1565273) for browser-chrome failures at browser/components/urlbar/tests/browser/browser_urlbar_selection.js
Push with failure: https://treeherder.mozilla.org/#/jobs?repo=mozilla-beta&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&revision=209780edbdf9b660eb86fc50dea6041b3a4f977f
Failure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=259797469&repo=mozilla-beta&lineNumber=4003
Backout link: https://treeherder.mozilla.org/#/jobs?repo=mozilla-beta&selectedJob=259797469&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&revision=1270a56d8bb7f6df12008e24b0e56d3b7cf9a160
```
[task 2019-08-03T20:50:47.777Z] 20:50:47     INFO - TEST-PASS | browser/components/urlbar/tests/browser/browser_urlbar_selection.js | The entire URL should be selected. - 21 == 21 - 
[task 2019-08-03T20:50:47.777Z] 20:50:47     INFO - Buffered messages finished
[task 2019-08-03T20:50:47.778Z] 20:50:47     INFO - TEST-UNEXPECTED-FAIL | browser/components/urlbar/tests/browser/browser_urlbar_selection.js | Uncaught exception - at chrome://mochitests/content/browser/browser/components/urlbar/tests/browser/browser_urlbar_selection.js:150 - TypeError: gURLBar.querySelector is not a function
[task 2019-08-03T20:50:47.778Z] 20:50:47     INFO - Stack trace:
[task 2019-08-03T20:50:47.778Z] 20:50:47     INFO - rightClickSelectsAll@chrome://mochitests/content/browser/browser/components/urlbar/tests/browser/browser_urlbar_selection.js:150:29
[task 2019-08-03T20:50:47.782Z] 20:50:47     INFO - Leaving test bound rightClickSelectsAll
[task 2019-08-03T20:50:47.782Z] 20:50:47     INFO - Entering test bound contextMenuDoesNotCancelSelection
[task 2019-08-03T20:50:47.783Z] 20:50:47     INFO - TEST-PASS | browser/components/urlbar/tests/browser/browser_urlbar_selection.js | The selection should not have changed. - 3 == 3 - 
[task 2019-08-03T20:50:47.783Z] 20:50:47     INFO - TEST-PASS | browser/components/urlbar/tests/browser/browser_urlbar_selection.js | The selection should not have changed. - 7 == 7 - 
[task 2019-08-03T20:50:47.784Z] 20:50:47     INFO - Not taking screenshot here: see the one that was previously logged
[task 2019-08-03T20:50:47.784Z] 20:50:47     INFO - TEST-UNEXPECTED-FAIL | browser/components/urlbar/tests/browser/browser_urlbar_selection.js | Uncaught exception - at chrome://mochitests/content/browser/browser/components/urlbar/tests/browser/browser_urlbar_selection.js:210 - TypeError: gURLBar.querySelector is not a function
[task 2019-08-03T20:50:47.784Z] 20:50:47     INFO - Stack trace:
[task 2019-08-03T20:50:47.785Z] 20:50:47     INFO - contextMenuDoesNotCancelSelection@chrome://mochitests/content/browser/browser/components/urlbar/tests/browser/browser_urlbar_selection.js:210:11
[task 2019-08-03T20:50:47.789Z] 20:50:47     INFO - Leaving test bound contextMenuDoesNotCancelSelection
[task 2019-08-03T20:50:47.793Z] 20:50:47     INFO - Entering test bound dragSelect
```",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1565273,31,*** Bug 1571601 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1565273,32,"I tested this issue on Windows 10, and Ubuntu 18.04, using the Nightly build from July 30 (build id 20190730095207) where the issue is reproducible, and I tested it on the latest Nightly from August 5th (build id 20190805095413) where the issue is fixed. Note that I also checked on Mac 10.14 using the latest Nightly, and issue is not reproducible. (based on comment 5)
Based on this, I can confirm the issue is fixed.
I will also verify this on beta when the fix lands.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1565273,33,"Pushed by htwyford@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d1b00f87871a
Remove unnecessary console.logs. r=mak",UNCODED,0,UNMATCHED
1565273,34,"Created attachment 9083353
bug_1565273_beta_updated.diff
Here's the updated beta diff. The old one was backed out since I used `gURLBar.querySelector` to fetch the contextmenu, but this behaviour was recently changed. The attached diff uses `document.getAnonymousElementByAttribute` which works in beta. Here's a green beta try: https://treeherder.mozilla.org/#/jobs?repo=try&revision=cfd9849d1ac79fe07a7ea799d5684c34f0c4aa26&selectedJob=260118746 (there's an opt build failure on Linux -- looks like it's an intermittent? I don't see the specific change in this patch causing a build failure).
Because of the previous backouts, Mak could you please take one last look at this patch before I request beta uplift?",CODE_IMPLEMENTATION,1,FULL_TOKEN
1565273,35,"Comment on attachment 9083353
bug_1565273_beta_updated.diff
### Beta/Release Uplift Approval Request
* **User impact if declined**: 
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: 
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: 
* **String changes made/needed**:",UNCODED,0,UNMATCHED
1565273,36,"Mak messaged me that he's having issues posting on Bugzilla today, but that the patch looks good. I requested uplift -- please see filled-out uplift request in comment 19.",CODE_REVIEW,0,FULL_TEXT
1565273,37,https://hg.mozilla.org/mozilla-central/rev/d1b00f87871a,UNCODED,0,UNMATCHED
1565273,38,"Comment on attachment 9083353
bug_1565273_beta_updated.diff
Fixes a regression in URL bar behavior in Fx69, patch has tests. Approved for 69.0b12, thanks.",UPLIFT_APPROVAL,0,FULL_TEXT
1565273,39,https://hg.mozilla.org/releases/mozilla-beta/rev/d09aa77d6ee4,UNCODED,0,UNMATCHED
1565273,40,"Hi, 
I tested this issue on Windows 10 and Ubuntu 18.04, using the Beta version 69.0b12 where the issue is indeed fixed. Given that it's fixed on Nightly and Beta, I changed the status of the bug to verified fixed.
Best regards, Flor.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1571472,1,"I noticed the stat calls on omni.ja in this profile: https://perfht.ml/2OPUqTM
Looking at the code, https://searchfox.org/mozilla-central/rev/0ffa9e372df56c95547fed9c3433ddec4fbf6f11/toolkit/components/corroborator/Corroborate.jsm#37 does 2 .exists() calls that do a stat on the main thread.
Given the function is already async, using OS.File instead to check if the files exist should be easy.
I haven't seen it in profiles yet, but I'm almost sure calling .directoryEntries at https://searchfox.org/mozilla-central/rev/0ffa9e372df56c95547fed9c3433ddec4fbf6f11/toolkit/components/corroborator/Corroborate.jsm#47 also does main thread I/O. OS.File has a directory iterator that could be used.
And finally, https://searchfox.org/mozilla-central/rev/0ffa9e372df56c95547fed9c3433ddec4fbf6f11/browser/components/BrowserGlue.jsm#1970 loads Corroborate.jsm right at the end of the session restore, likely piling up on existing jank. Unless I missed something, it could be triggered using an idle dispatch from _scheduleStartupIdleTasks instead.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1571472,2,I think this slipped through the startup tests because https://searchfox.org/mozilla-central/rev/0ffa9e372df56c95547fed9c3433ddec4fbf6f11/browser/base/content/test/performance/browser_startup_mainthreadio.js#569-580 was already in the whitelist due to bug 1543090 which is now fixed.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1571472,3,This is only on by default for Nightly btw - the plan is to enable it experimentally on Beta/Release but not to enable it by default.,STATUS_UPDATE,0,FULL_TEXT
1571472,4,"Even if it's Nightly only, the things I pointed out seem really easy to fix, so I think it's worth fixing in Nightly just so that we can remove the whitelist entry in the test and catch it immediately if there's a regression in the future.",PROBLEM_MOTIVATION,0,FULL_TEXT
1571472,5,"Oh definitely, just wanted to make sure nobody thought this would escape to release :) Thanks for the details in comment 0, I can fix this up.",CLARIFICATION,0,FULL_TEXT
1571472,6,"[Bugbug](https://github.com/mozilla/bugbug/) thinks this bug is a [defect](https://mozilla.github.io/bug-handling/bug-types), but please change it back in case of error.",ISSUE_METADATA_CHANGE,0,90_PCT_MATCH
1571472,7,"Created attachment 9084950
Bug 1571472 - remove checks for corrupt system add-ons r?bdanforth
Per https://bugzilla.mozilla.org/show_bug.cgi?id=1515173#c24 we aren't going to sign these and they will instead move into omni.ja",CODE_IMPLEMENTATION,1,FULL_TEXT
1571472,8,"Created attachment 9084951
Bug 1571472 - use async I/O for checking corrupt omni jar r?bdanforth
Depends on D41691",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1571472,9,"Created attachment 9084952
Bug 1571472 - use idle dispatch to start up corroborator r?bdanforth
Depends on D41692",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1571472,10,It looks like all patches here are accepted - is this good to land now?,QUESTION,0,FULL_TEXT
1571472,11,"I am running a tryserver job first just to make sure I didn't bust anything unexpected:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=54abbee14a13ef75cc30aab0cbab3d2887f6d9d8",ANSWER_TO_QUESTION,0,FULL_TOKEN
1571472,12,"Hm, this test is still failing: `browser/base/content/test/performance/browser_startup_mainthreadio.js | unused whitelist entry before handling user events: Z:\task_1566235067\build\application\firefox\omni.ja`
https://treeherder.mozilla.org/#/jobs?repo=try&selectedJob=262304880&revision=54abbee14a13ef75cc30aab0cbab3d2887f6d9d8
mconley/florian, this is behind a ` Services.tm.idleDispatchToMainThread()` in `BrowserGlue.jsm` now, is that somehow expected, or did I miss something? Thanks!",SOLUTION_VERIFICATION,0,FULL_TOKEN
1571472,13,"Hey rhelmer,
Coming at this having not really examined the patches, Corroborate.jsm, or anything like that, but I've seen failures like this before.
So we have this whitelist of main-thread IO for different stages of start-up. We fail in one of two cases:
1. We see new IO that isn't already in the whitelist
2. We fail to see IO that is in the whitelist
The error message that you're seeing is for case (2) - we expected to see some IO, and we didn't. This can be a good thing - in the best case, presuming this isn't intermittent, it means that we've successfully moved some IO off of the main thread and now we need to update the whitelist.
Here are the relevant parts of the log:
```
[task 2019-08-19T17:28:35.448Z] 17:28:35     INFO - TEST-PASS | browser/base/content/test/performance/browser_startup_mainthreadio.js | stat on Z:\task_1566235067\build\application\firefox\omni.ja allowed 1 more times before handling user events - 
[task 2019-08-19T17:28:35.449Z] 17:28:35     INFO - Buffered messages finished
[task 2019-08-19T17:28:35.449Z] 17:28:35     INFO - TEST-UNEXPECTED-FAIL | browser/base/content/test/performance/browser_startup_mainthreadio.js | unused whitelist entry before handling user events: Z:\task_1566235067\build\application\firefox\omni.ja - 
[task 2019-08-19T17:28:35.449Z] 17:28:35     INFO - Stack trace:
[task 2019-08-19T17:28:35.450Z] 17:28:35     INFO - chrome://mochikit/content/browser-test.js:test_ok:1576
[task 2019-08-19T17:28:35.450Z] 17:28:35     INFO - chrome://mochitests/content/browser/browser/base/content/test/performance/browser_startup_mainthreadio.js:null:992
[task 2019-08-19T17:28:35.450Z] 17:28:35     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest/<:1346
[task 2019-08-19T17:28:35.450Z] 17:28:35     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest:1381
[task 2019-08-19T17:28:35.451Z] 17:28:35     INFO - chrome://mochikit/content/browser-test.js:nextTest/<:1209
[task 2019-08-19T17:28:35.451Z] 17:28:35     INFO - chrome://mochikit/content/tests/SimpleTest/SimpleTest.js:SimpleTest.waitForFocus/waitForFocusInner/focusedOrLoaded/<:803
[task 2019-08-19T17:28:35.451Z] 17:28:35     INFO - TEST-PASS | browser/base/content/test/performance/browser_startup_mainthreadio.js | stat on Z:\task_1566235067\build\application\firefox\browser\omni.ja allowed 2 more times before handling user events - 
[task 2019-08-19T17:28:35.452Z] 17:28:35     INFO - Not taking screenshot here: see the one that was previously logged
[task 2019-08-19T17:28:35.452Z] 17:28:35     INFO - TEST-UNEXPECTED-FAIL | browser/base/content/test/performance/browser_startup_mainthreadio.js | unused whitelist entry before handling user events: Z:\task_1566235067\build\application\firefox\browser\omni.ja - 
```
[and here are the application/firefox/omni.ja and application/firefox/browser/omni.ja whitelist entries for this phase of start-up](https://searchfox.org/mozilla-central/rev/428cf94f4ddfb80eebc6028023a7d89eb277791b/browser/base/content/test/performance/browser_startup_mainthreadio.js#569-580)
So looking at the log, before that first failure, we see 1 expected stat on application/firefox/user.ja, and then we leave the ""before handling user events"" stage before seeing the other stat, and then the test freaks out because we didn't see the remaining XCurProcD:omni.ja or the one remaining GreD:omni.ja.
So presuming this isn't an intermittent, I think this can be addressed by updating the whitelist to remove the one GreD:omni.ja entry entirely, and reduce the number of stats for the XCurProcD:omni.ja entry by 1.",COLLATERAL_PROBLEM_ANALYSIS,0,90_PCT_MATCH
1571472,14,"Oh thanks for explaining this... sounds like a good problem to have then :)
I've added a new patch which I am running through tryserver now:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=a3537b588f9e7b044c2c4a8b235577e6a6a9816b",CODE_IMPLEMENTATION,1,FULL_TOKEN
1571472,15,"Huh - still orange. It's complaining about the other omni.ja whitelist entry also being unused... maybe I misinterpreted the first log, and you can just wipe out those whitelist entries entirely?",CODE_UPDATE_REQUEST,0,FULL_TEXT
1571472,16,"Was just looking at that and pushed a new one:
https://treeherder.mozilla.org/#/jobs?repo=try&selectedJob=262376665&revision=e8edd28ee13cbf57ca672ec58dfeac2218cf91a9",CODE_IMPLEMENTATION,1,FULL_TOKEN
1571472,17,"Created attachment 9086555
Bug 1571472 - remove expectation of GreD and decrement XCurProcD omni jar file stats r?mconley
Corroborator.jsm no longer causes file I/O on early startup before user input is possible.
Depends on D41693",CODE_IMPLEMENTATION,1,FULL_TOKEN
1571472,18,"Pushed by rhelmer@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/94045206f9dc
remove checks for corrupt system add-ons r=bdanforth
https://hg.mozilla.org/integration/autoland/rev/11b5503a39e0
use async I/O for checking corrupt omni jar r=bdanforth
https://hg.mozilla.org/integration/autoland/rev/419e84fea55d
use idle dispatch to start up corroborator r=bdanforth
https://hg.mozilla.org/integration/autoland/rev/21cc49705ca8
remove expectation of GreD and decrement XCurProcD omni jar file stats r=mconley",UNCODED,0,UNMATCHED
1571472,19,"https://hg.mozilla.org/mozilla-central/rev/94045206f9dc
https://hg.mozilla.org/mozilla-central/rev/11b5503a39e0
https://hg.mozilla.org/mozilla-central/rev/419e84fea55d
https://hg.mozilla.org/mozilla-central/rev/21cc49705ca8",UNCODED,0,UNMATCHED
1571472,20,"Indeed, the test just verifies (should I say celebrate?) that the patches here actually fix the bug! :) Thanks!",SOLUTION_VERIFICATION,0,FULL_TEXT
1576600,1,"Created attachment 9088090
Peek 2019-08-26 14-28.gif
**Affected versions**
* Firefox 70.a01
**Affected platforms**
* Windows 10 x64
* Ubuntu 18.04 x64
* macOS 10.13
**Steps to reproduce**
1. Open any site with a new profile or click on the shield icon from URL bar and then on the ""i"" symbol. 
2.  Hover the cursor over ""Learn more"". 
**Expected result**
* The cursor changes and the text has a link hover effect. 
 
**Actual result**
* The cursor changes. 
**Regression range**
* I don't think this is a regression. 
**Additional notes**
* Please look at the attached gif.",S2R,0,90_PCT_MATCH
1576600,2,"Should this be required for 70/Skyline, or do you want to make it a lower priority? I'd still take a patch for this in beta.",QUESTION,0,FULL_TEXT
1576600,3,Will triage,STATUS_UPDATE,0,FULL_TEXT
1576600,4,"Created attachment 9096925
Bug 1576600 - Fix styling of Learn More link in protections panel info message. r=andreio",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1576600,5,"Pushed by nhnt11@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/d1fe84998565
Fix styling of Learn More link in protections panel info message. r=andreio",UNCODED,0,UNMATCHED
1576600,6,"Backed out 4 changesets (bug 1583355, bug 1576600, bug 1576601, bug 1583350) for browser-chrome failures at browser/base/content/test/siteProtections/browser_protections_UI.js
Backout: https://hg.mozilla.org/integration/autoland/rev/283763664a4b94cdfe9124846cdb04114c197440
Failure push: https://treeherder.mozilla.org/#/jobs?repo=autoland&revision=d1fe84998565c0a1f22979b467eb4e21862dc5c0
Failure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=269024083&repo=autoland&lineNumber=6488
[task 2019-09-30T11:07:41.359Z] 11:07:41     INFO - TEST-PASS | browser/base/content/test/siteProtections/browser_protections_UI.js | recorded full_report telemetry event - 
[task 2019-09-30T11:07:41.360Z] 11:07:41     INFO - Leaving test bound testShowFullReportButton
[task 2019-09-30T11:07:41.360Z] 11:07:41     INFO - Entering test bound testMiniPanel
[task 2019-09-30T11:07:41.361Z] 11:07:41     INFO - Buffered messages finished
[task 2019-09-30T11:07:41.361Z] 11:07:41     INFO - TEST-UNEXPECTED-FAIL | browser/base/content/test/siteProtections/browser_protections_UI.js | The section 'protections-popup-mainView-panel-header-section' is hidden in the toast. - 
[task 2019-09-30T11:07:41.362Z] 11:07:41     INFO - Stack trace:
[task 2019-09-30T11:07:41.362Z] 11:07:41     INFO - chrome://mochikit/content/browser-test.js:test_ok:1580
[task 2019-09-30T11:07:41.363Z] 11:07:41     INFO - chrome://mochitests/content/browser/browser/base/content/test/siteProtections/browser_protections_UI.js:testMiniPanel:277
[task 2019-09-30T11:07:41.363Z] 11:07:41     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest/<:1350
[task 2019-09-30T11:07:41.364Z] 11:07:41     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest:1385
[task 2019-09-30T11:07:41.364Z] 11:07:41     INFO - chrome://mochikit/content/browser-test.js:nextTest/<:1213
[task 2019-09-30T11:07:41.364Z] 11:07:41     INFO - chrome://mochikit/content/tests/SimpleTest/SimpleTest.js:SimpleTest.waitForFocus/waitForFocusInner/focusedOrLoaded/<:805",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1576600,7,"Pushed by nhnt11@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/298653e2ce27
Fix styling of Learn More link in protections panel info message. r=andreio",UNCODED,0,UNMATCHED
1576600,8,"Created attachment 9097373
Bug 1576600 - Ensure Learn More link is visible in dark mode. r=andreio",UNCODED,0,UNMATCHED
1576600,9,"Pushed by nhnt11@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/991d6d6efcca
Ensure Learn More link is visible in dark mode. r=andreio",UNCODED,0,UNMATCHED
1576600,10,https://hg.mozilla.org/mozilla-central/rev/298653e2ce27,UNCODED,0,UNMATCHED
1576600,11,https://hg.mozilla.org/mozilla-central/rev/991d6d6efcca,UNCODED,0,UNMATCHED
1576600,12,"Comment on attachment 9096925
Bug 1576600 - Fix styling of Learn More link in protections panel info message. r=andreio
### Beta/Release Uplift Approval Request
* **User impact if declined**: Inferior Skyline feature onboarding experience.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: Open the protections panel and click the ""i"" icon. The ""Learn More"" link should be underlined on hover and the mouse pointer should change. The link should be white in both light and dark modes.
* **List of other uplifts needed**: Bug 1583350, Bug 1576601, Bug 1576600, Bug 1583355
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Small change, visual polish.
* **String changes made/needed**:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1576600,13,"Comment on attachment 9096925
Bug 1576600 - Fix styling of Learn More link in protections panel info message. r=andreio
Polish for Skyline feature, fine for uplift for beta 12.",UPLIFT_APPROVAL,0,FULL_TEXT
1576600,14,"https://hg.mozilla.org/releases/mozilla-beta/rev/5e3a5cbccbb7
https://hg.mozilla.org/releases/mozilla-beta/rev/5058b0483693",UNCODED,0,UNMATCHED
1576600,15,"I verified the fix using latest Nightly 71.0a1 and Firefox 70.0b12 on Windows 10 x64, macOS 10.13 and Ubuntu 18.04 x64. The issue is not reproducing anymore.",SOLUTION_VERIFICATION,0,FULL_TEXT
1576778,1,"When bug 1543812 landed it:
1) added an extra parameter (permissionID) to the function getMultichoiceStateLabel (https://searchfox.org/mozilla-central/source/browser/modules/SitePermissions.jsm#883) but it wasn't documented in the comments above it probably needs to be something like:
   * @param {string} permissionID
   *        The permission to get the label for.
2) added an extra supported option for gPermissionObject but nothing was added to the comments for that object about it, maybe something like:
   *  - getMultichoiceStateLabel 
   *    Allows for custom logic for getting its default value.
3) created a typo Unkown rather than Unknown (https://searchfox.org/mozilla-central/source/browser/modules/SitePermissions.jsm#1028)
Unfortunately bugzilla incorrectly autoformats the suggestions",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1576778,2,"Hello, Can I take up this issue?
Thanks :)
Aarushi",ASSIGNEE_REQUEST,0,FULL_TOKEN
1576778,3,"Assigned you. Thanks!
Let me know if you have any questions.",DEVELOPER_SELECTION_DECISION,0,FULL_TOKEN
1576778,4,"Created attachment 9135356
Bug 1576778 - Missing comment changes and typo in SitePermissions.jsm r=pbz",PROBLEM_DESCRIPTION,0,80_PCT_MATCH
1576778,5,"Pushed by aiakab@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/264817cbee37
Missing comment changes and typo in SitePermissions.jsm r=pbz",UNCODED,0,UNMATCHED
1576778,6,https://hg.mozilla.org/mozilla-central/rev/264817cbee37,UNCODED,0,UNMATCHED
1579004,2,"Yes, it should unfocus on any click outside. The intention is that clicking back in will restore the previous state (another item on the list from last week). So for example, if I had typed ""Firefox"" and the dropdown was open with search and history suggestions and I click outside, the dropdown will close and the bar will unfocus. And then when I click back inside, the bar will focus and the dropdown with my results will open back up.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1579004,3,"A couple more questions in the same vein:
- We currently remember which tabs the Urlbar is focused in and re-focus it when the user switches to those tabs. Seeing as clicks in the tab bar now unfocus the Urlbar, is this functionality being removed? What about when the user switches between tabs with the keyboard?
- Similarly, we unfocus the Urlbar when the user switches out of the Firefox window and then, if it was focused before, refocus the Urlbar when the user refocuses Firefox. Is this being removed, since a click outside the Urlbar unfocuses it? What about when the user switches out of Firefox with the keyboard?",QUESTION,0,FULL_TOKEN
1579004,4,"Created attachment 9093961
bar-states.png
I updated Invision and attached the relevant section here.
In this case, let's use the new ""focused & collapsed"" state.
This should work same as it does today. So for example, if the bar is focused & expanded and I click on the desktop it should become unfocused & collapsed. If I then Alt+Tab back to Firefox it should return to focused & expanded.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1579004,5,"Created attachment 9094009
Bug 1579004 - Clicking empty parts of the toolbar should collapse the megabar. r?dao",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1579004,6,"Pushed by htwyford@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/b37620ff38b6
Clicking empty parts of the toolbar should collpase the megabar. r=dao",UNCODED,0,UNMATCHED
1579004,7,"Backout by malexandru@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/ececf9f6d9a5
Backed out changeset b37620ff38b6 for failures browser_urlbar_collapseOnChromeMousedown.js CLOSED TREE",UNCODED,0,UNMATCHED
1579004,8,"Backed out changeset b37620ff38b6  for failures browser_urlbar_collapseOnChromeMousedown.js
Backout link: https://hg.mozilla.org/integration/autoland/rev/ececf9f6d9a52ef0a6c3a25699bae62f2f5c2272
Push with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&tochange=ececf9f6d9a52ef0a6c3a25699bae62f2f5c2272&fromchange=b37620ff38b60aa8cf34bd02c4ea5d8cd0afb118&selectedJob=268223800
Failure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=268223800&repo=autoland&lineNumber=1719
[task 2019-09-24T19:40:13.086Z] 19:40:13     INFO - TEST-PASS | browser/components/urlbar/tests/browser/browser_urlbar_collapseOnChromeMousedown.js | The Urlbar should be focused. - true == true - 
[task 2019-09-24T19:40:13.087Z] 19:40:13     INFO - Buffered messages finished
[task 2019-09-24T19:40:13.088Z] 19:40:13     INFO - TEST-UNEXPECTED-FAIL | browser/components/urlbar/tests/browser/browser_urlbar_collapseOnChromeMousedown.js | The Urlbar should have the breakout-extend attribute. - false == true - JS frame :: chrome://mochitests/content/browser/browser/components/urlbar/tests/browser/browser_urlbar_collapseOnChromeMousedown.js :: <TOP_LEVEL> :: line 43
[task 2019-09-24T19:40:13.088Z] 19:40:13     INFO - Stack trace:
[task 2019-09-24T19:40:13.088Z] 19:40:13     INFO - chrome://mochitests/content/browser/browser/components/urlbar/tests/browser/browser_urlbar_collapseOnChromeMousedown.js:null:43
[task 2019-09-24T19:40:13.089Z] 19:40:13     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest/<:1350
[task 2019-09-24T19:40:13.090Z] 19:40:13     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest:1385
[task 2019-09-24T19:40:13.091Z] 19:40:13     INFO - chrome://mochikit/content/browser-test.js:nextTest/<:1207
[task 2019-09-24T19:40:13.091Z] 19:40:13     INFO - chrome://mochikit/content/tests/SimpleTest/SimpleTest.js:SimpleTest.waitForFocus/waitForFocusInner/focusedOrLoaded/<:805
[task 2019-09-24T19:40:13.091Z] 19:40:13     INFO - Leaving test bound 
[task 2019-09-24T19:40:13.092Z] 19:40:13     INFO - GECKO(1154) | MEMORY STAT vsizeMaxContiguous not supported in this build configuration.
[task 2019-09-24T19:40:13.093Z] 19:40:13     INFO - GECKO(1154) | MEMORY STAT | vsize 2902MB | residentFast 415MB | heapAllocated 181MB
[task 2019-09-24T19:40:13.094Z] 19:40:13     INFO - TEST-OK | browser/components/urlbar/tests/browser/browser_urlbar_collapseOnChromeMousedown.js | took 2592ms",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1579004,9,I pushed a new revision to Phabricator with a green try: https://treeherder.mozilla.org/#/jobs?repo=try&revision=881defd8994906a91a2d4ca4e957f51febf32619&selectedJob=268231104. I'm going to attempt to push again.,CODE_IMPLEMENTATION,1,FULL_TEXT
1579004,10,"Pushed by htwyford@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e59677a62de7
Clicking empty parts of the toolbar should collapse the megabar. r=dao",UNCODED,0,UNMATCHED
1579004,11,https://hg.mozilla.org/mozilla-central/rev/e59677a62de7,UNCODED,0,UNMATCHED
1584273,1,I think this would be an accessibility win that would be reasonably easy to implement.,PROBLEM_REVIEW,0,FULL_TEXT
1584273,2,"Created attachment 9096756
Bug 1584273 - Disable the megabar animation when prefers-reduced-motion is true. r?dao",PROBLEM_DESCRIPTION,0,FULL_TEXT
1584273,3,"Pushed by dgottwald@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/ff6180341e4d
Disable the megabar animation when prefers-reduced-motion is true. r=dao",UNCODED,0,UNMATCHED
1584273,4,https://hg.mozilla.org/mozilla-central/rev/ff6180341e4d,UNCODED,0,UNMATCHED
1615767,1,"User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:74.0) Gecko/20100101 Firefox/74.0
Steps to reproduce:
74.0b3, adding one flexible spacebar to the left of my bookmark toolbar doesn't work, it's there, but when closing customization menu, the bookmark toolbar is still stuck all the way to the left.
Actual results:
when closing customization menu, the bookmark toolbar is still stuck all the way to the left.
Expected results:
Should behave just like Firefox 73 behaved/behaves.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1615767,2,"Ok, I'm switching over to 73 as my default browser then (was using 74 for lots of months), until this is fixed. :/",UNCODED,0,UNMATCHED
1615767,3,"I can't reproduce; I see no difference between behaviour on 72, 73, 74 and 75 - the spacer adds several cm of horizontal empty space on the left-hand side of the toolbar.
Can you find a regression window with mozregression ( https://mozilla.github.io/mozregression/ ), and take screenshots before/after to indicate what you're seeing (presumably different from my machine)? Can you reproduce on a clean profile?",REPRODUCTION_REQUEST,0,FULL_TEXT
1615767,4,"Ok very interesting, NOT occuring with new profile! (on current FF Beta)
What do you suggest as next step to ""fix"" my profile?",QUESTION,0,FULL_TEXT
1615767,5,"Attach your about:support data to the bug and I'll see if anything obvious shows up: https://bugzilla.mozilla.org/attachment.cgi?bugid=1615767&action=enter
Then try copying `prefs.js` from your ""broken"" profile to the clean/new profile, see if that ""breaks"" the new/clean profile.
Otherwise, do you use userChrome.css tweaks of some sort?",ANSWER_TO_QUESTION,0,FULL_TOKEN
1615767,6,"[Bugbug](https://github.com/mozilla/bugbug/) thinks this bug is a regression, but please revert this change in case of error.",STATUS_UPDATE,0,90_PCT_MATCH
1615767,7,We don't have enough information either way right now.,STATUS_UPDATE,0,FULL_TEXT
1615767,8,"Created attachment 9128196
file",UNCODED,0,UNMATCHED
1615767,9,"I don't see anything obvious in the about:support data. Did copying prefs.js from your old profile to a clean one break the flexible spaces there, too?
If so, what's the value of the `browser.uiCustomization.state` pref? (It's not in the about:support data)",QUESTION,0,FULL_TOKEN
1615767,10,"No, copying prefs.js didn't break it.",ANSWER_TO_QUESTION,0,FULL_TEXT
1615767,11,Then I don't know what causes this in the profile where this is broken. Are there a lot of bookmarks in your bookmarks toolbar? Any other widgets in the bookmarks toolbar?,QUESTION,0,FULL_TEXT
1615767,12,"oh yes, I have looooots of bookmarks in my bookmark toolbar, and a lot of folders. What do you mean by ""widgets"" ?",QUESTION,0,FULL_TEXT
1615767,13,"If you copy all the files labeled `places` from the broken profile to the new profile, does that break things in the new profile?
toolbar buttons or the search box or any of the other items you can move around in customize mode, besides the bookmarks toolbar items themselves.",QUESTION,0,FULL_TOKEN
1615767,14,"I can also reproduce this, if the bookmark toolbar is overflowed with bookmarks (and the chevron icon is visible at the end).
I have only bookmarks and folder there without any other toolbar items.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1615767,15,"So STR from clean profile:
1. open nightly
2. make bookmarks toolbar visible
3. fill the bookmarks container, e.g. by:
3a. open bookmarks manager, switch to bookmarks toolbar container
3b. copy the bookmark that's there
3c. paste a few times
3d. select all bookmarks in that folder in the bookmarks manager, copy, paste a few times
4. verify the chevron ( >> ) has appeared in the toolbar
5. open customize mode
6. add a flexible space at the start of the bookmarks toolbar, before the ""bookmarks toolbar items""
7. exit customize mode
Expected:
flexible space takes up ""some"" amount of space.
Actual:
it takes up no space at all.
This was regressed by bug 1601334 because it changed the min-width of toolbarsprings everywhere, including the bookmarks toolbar, and apparently the way XUL layout works is that we end up squashing the spacer to nothing when the toolbar is full. The min-width of 1px was then removed entirely in bug 1608638.
We should probably bring back the original min-width outside of the navbar.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1615767,16,"Created attachment 9128839
Bug 1615767 - re-introduce a min-width for flexible spacers so they work as expected outside the navbar, r?dao",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1615767,17,"Pushed by gijskruitbosch@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/bc2743384f7b
re-introduce a min-width for flexible spacers so they work as expected outside the navbar, r=dao",UNCODED,0,UNMATCHED
1615767,18,https://hg.mozilla.org/mozilla-central/rev/bc2743384f7b,UNCODED,0,UNMATCHED
1615767,19,"I assume we don't need to worry about uplift since the megabar isn't riding 74 to release, but feel free to nominate for approval if that's incorrect.",UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1615767,20,"Fixed on latest Nightly.
Also, I don't think this is related to the urlbar/magebar in any way.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1615767,21,"Thanks!! (and fixed within 2 weeks even, thx a lot!)",UNCODED,0,UNMATCHED
1615767,22,"This was a CSS change (to fix a regression from another CSS change) and affects other things than the megabar, and isn't disabled by the pref being off, so yeah, it can do with uplifting.",CLARIFICATION,0,FULL_TEXT
1615767,23,"Comment on attachment 9128839
Bug 1615767 - re-introduce a min-width for flexible spacers so they work as expected outside the navbar, r?dao
### Beta/Release Uplift Approval Request
* **User impact if declined**: spacers become useless in the bookmarks toolbar / menubar in some cases
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: 
* **List of other uplifts needed**: n/a
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: CSS only change to revert the effect of part of the regressing bug
* **String changes made/needed**: nope",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1615767,24,"Comment on attachment 9128839
Bug 1615767 - re-introduce a min-width for flexible spacers so they work as expected outside the navbar, r?dao
Low risk css change, uplift approved for 74 beta 9, thanks.",UPLIFT_APPROVAL,0,FULL_TEXT
1615767,25,https://hg.mozilla.org/releases/mozilla-beta/rev/1a254f4ac528,UNCODED,0,UNMATCHED
1618477,1,"Created attachment 9129427
permission prompt issue.mp4
#### Affected versions:
ALL
#### Affected platforms:
Windows 10, Ubuntu 18.04
#### Steps:
  1. Launch Firefox with a new profile and go to: https://joo.crater.uberspace.de/frame-permissions.html
  2. Click on the notifications icon and click on ""Allow notifications"".
  3. Click on the Camera or Microphone button from ""https://permission.site with FP allowed"" iFrame and click Allow.
  4. In the ""https://permission.site with FP allowed"" iFrame right click -> This Frame -> Open Frame in New Tab.
  5. In the new tab opened click on the Camera or Microphone and allow access.
  6. Click on the Camera/Microphone icon from control sharing panel (the small upper panel).
#### Actual result:
The permission prompt is not displayed.
#### Expected result:
The permissions prompt should be displayed by clicking on the control sharing panel.
Note: This issue only occurs on Windows and Ubuntu, on Mac the permission prompt is displayed.
Please see the video attachment for a better understanding.",S2R,0,90_PCT_MATCH
1618477,2,"Created attachment 9129428
Permission prompt issue.mp4",UNCODED,0,UNMATCHED
1618477,3,"Thanks!
Having two or more tabs with active webRTC sharing state seems to break the sharing indicator button.
In case of multiple tabs with active sharing state we should focus one of the tabs and open the identity panel. If a tab with active sharing state is currently in focus that should be prioritized.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1618477,4,I would like to be assigned this bug. Thank you.,DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1618477,5,"Created attachment 9132538
Bug 1618477 - The permissions prompt is not displayed by clicking on the control sharing panel. r=prathiksha,johannh",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1618477,6,"Pushed by jhofmann@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/fb90c9d68198
The permissions prompt is not displayed by clicking on the control sharing panel. r=johannh",UNCODED,0,UNMATCHED
1618477,7,https://hg.mozilla.org/mozilla-central/rev/fb90c9d68198,UNCODED,0,UNMATCHED
1618477,8,Verified - Fixed in latest Nightly 76.0a1 (Build id: 20200318041411) using Windows 10 and Ubuntu 18.04.,SOLUTION_VERIFICATION,0,FULL_TEXT
1618477,9,"The patch landed in nightly and beta is affected.
:ratnabalidutta26, is this bug important enough to require an uplift?
If not please set `status_beta` to `wontfix`.
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).",QUESTION,0,FULL_TEXT
1618477,10,Forwarding this to the reviewer since the assignee is a new contributor.,STATUS_UPDATE,0,FULL_TEXT
1618477,11,Probably don't need to bother with that :),STATUS_UPDATE,0,FULL_TEXT
1630806,1,"+++ This bug was initially created as a clone of Bug #1629150 +++
Changes since last update:
#11800 Remove any mention of Gitpod from the README (issue 11732)
#11809 Update Prettier to version 2.0
#11806 [api-minor] Fix the return value of `PDFDocumentProxy.getViewerPreferences` when no viewer preferences are present (PR 10738 follow-up)
#11810 A couple of small `String.fromCodePoint` improvements (PR 11698 and 11769 follow-up)
#11805 Always skip over any additional, unexpected, RSTx (restart) markers in corrupt JPEG images (issue 11794)
#11813 Suppress browser autofill on page number",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1630806,2,"Created attachment 9141130
Bug 1630806 - Update pdf.js to version 2.5.95. r=bdahl",PROBLEM_DESCRIPTION,0,FULL_TEXT
1630806,3,"Pushed by rvandermeulen@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/97b24ed0fc55
Update pdf.js to version 2.5.95. r=bdahl",UNCODED,0,UNMATCHED
1630806,4,https://hg.mozilla.org/mozilla-central/rev/97b24ed0fc55,UNCODED,0,UNMATCHED
1634650,1,"Currently, it is only possible to whitelist complete domains and prevent them from redirecting to search using `browser.fixup.domainwhitelist.yourdomain.yoursuffix`.
It should also be possible to also whitelist whole suffixes/TLDs. This is useful in case of local development using reserved TLDs (bug 1634592) because users don't need to manually whitelist every domain. It is also useful with non-IANA-managed TLDs like OpenNIC or extensions that add support for domains of some other project (like `.eth` or `.bit`).
Although reserved TLDs and OpenNIC domains use a custom DNS server, so Firefox can use that to offer users to automatically whitelist a certain domain, this can't be said for extension-based domains. For such domains, the only way of accessing them is to manually whitelist every domain in `about:config` or manually type `http://` before the domain.
It should also be possible to also whitelist whole suffixes/TLDs. With this, users could just add, for example, `.local`, `.libre` or `.eth` as a whitelisted suffix and all search queries with that suffix will be interpreted as website/domain request.
Additionally, API for whitelisting suffixes/TLDs could be exposed to extensions. This would be useful in cases where extensions are used for handling custom domains (like MetaMask for `.eth`, PeerName or Blockchain DNS for `.bit`, `.emc` and few others...). Without such API, users would have to install such extension and them manually whitelist suffix/TLD that extension uses. With such API, users would just need to install the extension, and extension would automatically register TLDs that it handles as whitelisted domain TLDs.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1634650,2,"I have some idea how whitelisting suffixes could look like:
Pref could be something like `browser.fixup.suffixwhitelist.yoursuffix`, so all searches which end with `.yoursuffix` would be considered as URLs. Additionally, if pref is set to, for example `browser.fixup.suffixwhitelist.local.domain`, searches which end with `.local.domain` would be considered as URLs, but searches ending on  just `.domain` won't be.
For extensions API for whitelisting TLDs, there are more approaches:
1. If an extension requires host permission (in the manifest) for specific domain/URL, automatically treat that URL as whitelisted domain/suffix. For example, if extension requires `*://*.bit/*`, automatically treat all searches ending with `.bit` as whitelisted suffixes, and if extension requires `*://*.local.domain`, treat searches ending with `.local.domain` as URLs. The benefit is that it doesn't require changing most of the extensions. However, the problem with this is that it is not really configurable. But much configuration is probably not really needed here, because if extension wants to access websites on some suffix, we can assume that that suffix contains websites.
2. Providing another manifest permission similar to host permission, which is only used to tell Firefox that specific suffix should be whitelisted. The advantage is that it is more configurable. Disadvantages are that the extension would need to be updated to start using it, and would probably result in duplicated configuration/permissions (you would need to set both normal host permission and this new ""suffix permission"" in manifest). And in most, if not all, cases, separate configuration probably won't be needed.
3. Exposing API to JavaScript in some way. The advantage is that it is dynamic. Disadvantage is also that is dynamic, which means that is is probably harder to handle it, and can also cause security and usability problems. And probably also results in duplicated configuration.
Of those three approaches, I most like first, because it doesn't result in too much configuration and can work with existing extensions.",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1634650,3,"We should implement the whitelist prefs here, For clarity I think we should go with browser.fixup.domainsuffixwhitelist.yoursuffix
(I would have preferred a more readable name but that train left so we're stuck with this).
By default we should whitelist the reserved TLDs from bug 1634592.
It may be useful to also have a policy.
I don't think we can add suffix providers as prefs though, we'd need an updated list in the product, like the PSL, to support an high number of suffixes, we don't have such a list.
A WebExtension API is an interesting idea, but honestly it should be filed separately. I must note though that currently the isDomainWhitelisted API we use is synchronous and it would not cope well with the async WebExt API, thus someone should either fix all the isDomainWhitelisted call points (not trivial) or figure out an API that just updates an in-memory list asynchronously, and accept that some hits may fail. Though can't WebExt already intercept traffic? If so it looks like it would be possible to redirect it already.
Anyway, please file any WebExt request apart, we don't have the resources to do it here.",SOLUTION_REVIEW,1,FULL_TOKEN
1634650,4,"Mike, do we have a policy for browser.fixup.domainwhitelist? could you please point to the code for it?
Is it just managed though autoconfig?",QUESTION,0,FULL_TOKEN
1634650,5,"We don't have a policy for this, it's being managed through autoconfig.
The only fixup policy we have is:
browser.fixup.dns_first_for_single_words
although there have been requests for others.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1634650,6,"I guess either policies or a WebExt API as requested in bug 1635062 may be useful to setup suffixes collections.
Atm we don't have the resources in the Search team to look after those, hopefully the community can pick up those items and provide solutions that would be nicer than autoconfig.",SOLUTION_REVIEW,1,FULL_TOKEN
1634650,7,"Created attachment 9146093
Bug 1634650 - Add whitelisting of domain suffixes for URIFixup. r=harry",UNCODED,0,UNMATCHED
1634650,8,"Pushed by mak77@bonardo.net:
https://hg.mozilla.org/integration/autoland/rev/57d78ba110be
Add whitelisting of domain suffixes for URIFixup. r=harry",UNCODED,0,UNMATCHED
1634650,9,"Backed out changeset 57d78ba110be (bug 1634650) for marionette failures in migration/tests/marionette/test_refresh_firefox.py. CLOSED TREE
Log:
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=301214468&repo=autoland&lineNumber=55936
Push with failures:
https://treeherder.mozilla.org/#/jobs?repo=autoland&group_state=expanded&revision=57d78ba110be3a6db82c7ed4b43c4d0220c8c24a
Backout:
https://hg.mozilla.org/integration/autoland/rev/9d97dc6359a52aebe9655bfa6a3171320871b240",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1634650,10,it looks intermittent from treeherder and there's bug 1614678 filed about it... did you respin and assigned to my bug because the previous changeset had no failures at all?,QUESTION,0,FULL_TEXT
1634650,11,The problem is I don't see anything in test_refresh_firefox.py that may be affected by my changes...,SOLUTION_VERIFICATION,0,FULL_TEXT
1634650,12,"Ok I see the retriggers, I'm totally puzzled, I think some timing changes made an intermittent a bit more frequent, for now I don't have other ideas.",SOLUTION_VERIFICATION,0,FULL_TEXT
1634650,13,Note that this bug is about an exit code of `0` whilst yours show an exit code of `11`. As Gijs mentioned this is a crash. Interesting that no minidump files are found or processed.,ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1634650,14,"It must be a crash happening due to some timing changes, we can't exclude this isn't the same failure with different outcomes, due to the code changes in the last 2 months.
My changes should only affect page loads starting from user input, and afaict there's nothing like that in this test.
Without any kind of stack though I wonder how we can figure out anything, and this is also an intermittent, there are green runs on and after my push.
It seems to only affect Linux 18.04 x64 shippable opt, that makes me think if we can't get a useful stack, we may have to skip-if = os == ""linux"" && bits == 64 && !debug, but of course I'd prefer to find what's up.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1634650,15,"Interesting. I wonder if this might be something related to bug 1607713, which is a high intermittent crash with the ""new"" Ubuntu 18.04 jobs. 
Maybe we could try to run the Marionette job with the old 16.04 image on try and check if the test passes fine there with a couple of retriggers. I would assume we have to add a worker setting like for our [puppeteer jobs](https://searchfox.org/mozilla-central/rev/dc4560dcaafd79375b9411fdbbaaebb0a59a93ac/taskcluster/ci/source-test/remote.yml#20-22) to the [Marionette Taskcluster configs](https://searchfox.org/mozilla-central/rev/dc4560dcaafd79375b9411fdbbaaebb0a59a93ac/taskcluster/ci/test/marionette.yml#5).",COLLATERAL_PROBLEM_ANALYSIS,0,90_PCT_MATCH
1634650,16,"So, we are in testResetEverything.
The restart we crash on is apparently the one after the first checkProfile.
One thing I don't understand, by looking at a PASS log, is why after the first self.checkProfile(expect_sync_user=True) and the restart, I cannot find traces of the second self.checkProfile(has_migrated=True, expect_sync_user=True), I instead see a TEST-PASS just after the restart.
For example, looking for the string ""services.sync.username"" in the log, I see it set by self.createProfileData() and then get by the first self.checkProfile(expect_sync_user=True), then I don't see it again, but the second self.checkProfile call should get it again, it's like we don't run the second checkProfile at all.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1634650,17,"I downloaded the build and tried to run the test on Ubuntu 18.04, I was never able to crash it. I'll file a separate bug for it and likely disable on that platform there, we'll have to figure out why there's no minidump, and whether this is related to bug 1607713. But There's no change I can do to the patch to avoid this, afaict.",NEW_ISSUE_FILING,0,FULL_TEXT
1634650,18,"As a heads up, if you're still interested in running Marionette with the old 16.04 image (still in-tree), you could remove these clauses and it will revert: https://searchfox.org/mozilla-central/source/taskcluster/taskgraph/transforms/tests.py#621-623",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1634650,19,I'll do a Try push with those lines removed and annotate the results in bug 1636706,NEW_ISSUE_FILING,0,FULL_TEXT
1634650,20,"Pushed by mak77@bonardo.net:
https://hg.mozilla.org/integration/autoland/rev/0230d23f652f
Add whitelisting of domain suffixes for URIFixup. r=harry",UNCODED,0,UNMATCHED
1634650,21,https://hg.mozilla.org/mozilla-central/rev/0230d23f652f,UNCODED,0,UNMATCHED
1634650,22,"Thank you for fixing this! How do you feel about uplifting this, so this is in the same release as  Bug 1080682?",QUESTION,0,FULL_TOKEN
1634650,23,"I can't uplift atm, there's a crash bug that I'm still investigating and that makes me nervous and doubtful about uplifts.",ANSWER_TO_QUESTION,0,FULL_TEXT
1634650,24,Is it possible this is causing a regression in golinks as per bug 1642435?,QUESTION,0,FULL_TEXT
1634650,25,not this bug.,ANSWER_TO_QUESTION,0,FULL_TEXT
1634650,26,*** Bug 1645810 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1634650,27,*** Bug 1634592 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1634650,28,*** Bug 1648940 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1634650,29,*** Bug 1649135 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1634650,30,*** Bug 1779813 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1644719,2,"Created attachment 9157259
Bug 1644719  -  Add a new API that tells us if SUMO is unreachable. r=prathiksha",UNCODED,0,UNMATCHED
1644719,3,"Created attachment 9158318
Bug 1644719 - Add a new API that tells us if SUMO is unreachable. r=prathiksha",UNCODED,0,UNMATCHED
1644719,4,"Created attachment 9177917
Bug 1644719 - Add basic functionality to display offline support pages when SUMO is unreachable from certerror pages.",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1644719,5,"We are manually downloading support content using support.mozilla.org's KB end-point and shipping them in Firefox here. There are plans to ship a script in Firefox to automate this process.
Offline support content is displayed when users cannot access the SUMO website by clicking on ""Learn More..."" links from cert and net error pages. For example, if a user has a clock issue rendering certificate errors whenever they try to access a website in Firefox, we display an offline support page in place of a certerror on the SUMO website.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1644719,6,"Pushed by prathikshaprasadsuman@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/a96912059b4c
Add basic functionality to display offline support pages when SUMO is unreachable from certerror pages. r=nhnt11",UNCODED,0,UNMATCHED
1644719,7,"Backed out changeset a96912059b4c (Bug 1644719) for causing failures in browser_all_files_referenced.js CLOSED TREE
Push with failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&selectedTaskRun=ZUkMNrmeTRWp5TemkWDvew.0&resultStatus=testfailed%2Cbusted%2Cexception&revision=a96912059b4c1bffe46e8160c055ffd05ff44bea
Failure log: https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=317173348&repo=autoland&lineNumber=2227
https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=317175191&repo=autoland&lineNumber=3062
Backout: https://hg.mozilla.org/integration/autoland/rev/1ac1b37d394e0c7bf03805c1fee7440a67b52b9e",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1644719,8,"Created attachment 9215460
Bug 1644719 - Add basic support to display offline support pages when SUMO is unreachable. r=prathiksha",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1644719,9,"Pushed by prathikshaprasadsuman@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/43711f4646a7
Add basic support to display offline support pages when SUMO is unreachable. r=prathiksha,desktop-theme-reviewers,harry",UNCODED,0,UNMATCHED
1644719,10,"Backed out for causing failures on browser_aboutCertError_offlineSupport.js.
Backout link: https://hg.mozilla.org/integration/autoland/rev/eb0ac0c5c2150c70a90cf8da9a31a373f46ef73f
Push with failures: https://treeherder.mozilla.org/jobs?repo=autoland&selectedTaskRun=G0wjMr2uRoaHv5Je1_HD4g.0&revision=2c4c902ee034512d97ea7638fecb31be175db470&searchStr=os%2Cx%2C10.14%2Cwebrender%2Cdebug%2Cmochitests%2Ctest-macosx1014-64-qr%2Fdebug-mochitest-browser-chrome-e10s%2Cbc7
Failure log: https://treeherder.mozilla.org/logviewer?job_id=337143791&repo=autoland&lineNumber=3041",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1644719,11,"Pushed by prathikshaprasadsuman@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/435434f6e0ba
Add basic support to display offline support pages when SUMO is unreachable. r=prathiksha,desktop-theme-reviewers,harry",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1644719,12,https://hg.mozilla.org/mozilla-central/rev/435434f6e0ba,UNCODED,0,UNMATCHED
1661727,1,"In order to drive homepage remediation through the CFR/messaging. We need to set up an action that remedates the page away from custom domains. The use case here would be as follows
* I have search.com as my homepage
* CFR tells me to switch
* I click CFR
* My homepage is now set to a search-only default experience
Here's a little fake Schema that is meant to just describe requirements
```
name: SET_HOMEPAGE 
params: {
  home: one of 'default', 'blank', <url>
  newtab: one of 'default', 'blank', <url>
  layout: <optional, specified to update layout of default page> one of 'search_only' or 'standard'
}
```
We could get fancy and make the layout parametric for different layouts (ie, topSiteRows: 5) or whatever, but that seems like follow up here.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1661727,2,"Created attachment 9173116
Bug 1661727 - Messaging System action to allow configuration of the new tab page",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1661727,3,"Pushed by aoprea@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/73c68b95c696
Messaging System action to allow configuration of the new tab page r=nanj",UNCODED,0,UNMATCHED
1661727,4,https://hg.mozilla.org/mozilla-central/rev/73c68b95c696,UNCODED,0,UNMATCHED
1661727,5,This enhancement was part of the work done on [PI-789](https://jira.mozilla.com/browse/PI-789) that was signed off as GREEN. Considering this I am marking this as Verified.,SOLUTION_VERIFICATION,0,90_PCT_MATCH
1689742,1,I'm going to go with CSS grid based <stack> + visibility here since the button for one pane is slightly higher.,PROBLEM_MOTIVATION,0,FULL_TEXT
1689742,2,"Created attachment 9200133
Bug 1689742 - Stop using XUL <deck> for #setDefaultPane.",PROBLEM_DESCRIPTION,0,FULL_TEXT
1689742,3,"Pushed by ntim.bugs@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/89f8a1784f5a
Stop using XUL <deck> for #setDefaultPane. r=preferences-reviewers,Gijs",UNCODED,0,UNMATCHED
1689742,4,https://hg.mozilla.org/mozilla-central/rev/89f8a1784f5a,UNCODED,0,UNMATCHED
1703558,1,This test is my nemesis.,UNCODED,0,UNMATCHED
1703558,2,"Oops, wrong bug.",UNCODED,0,UNMATCHED
1703558,3,"Created attachment 9214147
Bug 1703558 - fix UITour available targets accountStatus state with proton enabled, r?jaws",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1703558,4,"Pushed by gijskruitbosch@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/f63b119397f3
fix UITour available targets accountStatus state with proton enabled, r=jaws",UNCODED,0,UNMATCHED
1703558,5,https://hg.mozilla.org/mozilla-central/rev/f63b119397f3,UNCODED,0,UNMATCHED
1705327,1,See https://bugzilla.mozilla.org/show_bug.cgi?id=1705060#c2:,UNCODED,0,UNMATCHED
1705327,2,"Created attachment 9216037
Bug 1705327 - Remove infobar notification from pdf viewer
Recommandation from UX is to not show this bar, so remove it.",CODE_IMPLEMENTATION,1,FULL_TEXT
1705327,3,"Pushed by cdenizet@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/a802bfb09181
Remove infobar notification from pdf viewer r=bdahl",UNCODED,0,UNMATCHED
1705327,4,"Backed out for failures on browser_pdfjs_notification_close_on_navigation.js
*backout:* https://hg.mozilla.org/integration/autoland/rev/b0887ad1341fa9e85b7bfd4bcf007cc912937aac
*push:* https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&revision=a802bfb0918178fc4599cf39de344ce3c4648ae3&selectedTaskRun=IO-hloKBQBWZD0Uu1NAy6g.0
*failure log:* https://treeherder.mozilla.org/logviewer?job_id=336718237&repo=autoland&lineNumber=2707
[task 2021-04-15T22:53:52.328Z] 22:53:52     INFO - Buffered messages logged at 22:53:44
[task 2021-04-15T22:53:52.329Z] 22:53:52     INFO - Entering test bound test_notification_is_removed_upon_navigation
[task 2021-04-15T22:53:52.332Z] 22:53:52     INFO - Buffered messages finished
[task 2021-04-15T22:53:52.333Z] 22:53:52     INFO - TEST-UNEXPECTED-FAIL | toolkit/components/pdfjs/test/browser_pdfjs_notification_close_on_navigation.js | Uncaught exception - waiting for notification - timed out after 50 tries.
[task 2021-04-15T22:53:52.334Z] 22:53:52     INFO - Leaving test bound test_notification_is_removed_upon_navigation
[task 2021-04-15T22:53:52.336Z] 22:53:52     INFO - GECKO(1534) | MEMORY STAT | vsize 3127MB | residentFast 334MB | heapAllocated 91MB
[task 2021-04-15T22:53:52.337Z] 22:53:52     INFO - TEST-OK | toolkit/components/pdfjs/test/browser_pdfjs_notification_close_on_navigation.js | took 7733ms",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1705327,5,"Also failing: [TEST-UNEXPECTED-FAIL | dom/base/test/test_user_select.html | testE: selected text - got """", expected ""aa\nbbbb\nee""](https://treeherder.mozilla.org/logviewer?job_id=336720835&repo=autoland&lineNumber=4744)
[task 2021-04-15T23:31:24.790Z] 23:31:24     INFO - Buffered messages finished
[task 2021-04-15T23:31:24.790Z] 23:31:24     INFO - TEST-UNEXPECTED-FAIL | dom/base/test/test_user_select.html | testE: selected text - got """", expected ""aa\nbbbb\nee""
[task 2021-04-15T23:31:24.790Z] 23:31:24     INFO -     SimpleTest.is@SimpleTest/SimpleTest.js:500:14
[task 2021-04-15T23:31:24.790Z] 23:31:24     INFO -     checkText@dom/base/test/test_user_select.html:108:7
[task 2021-04-15T23:31:24.790Z] 23:31:24     INFO -     test@dom/base/test/test_user_select.html:242:12
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO - Not taking screenshot here: see the one that was previously logged
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO - TEST-UNEXPECTED-FAIL | dom/base/test/test_user_select.html | testE: Selection range count - got +0, expected 3
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO -     SimpleTest.is@SimpleTest/SimpleTest.js:500:14
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO -     checkRangeCount@dom/base/test/test_user_select.html:127:7
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO -     test@dom/base/test/test_user_select.html:243:18
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO - Not taking screenshot here: see the one that was previously logged
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO - TEST-UNEXPECTED-FAIL | dom/base/test/test_user_select.html | uncaught exception - IndexSizeError: Selection.getRangeAt: 0 is out of range at checkRange@http://mochi.test:8888/tests/dom/base/test/test_user_select.html:132:17
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO - test@http://mochi.test:8888/tests/dom/base/test/test_user_select.html:244:13
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO - 
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO -     simpletestOnerror@SimpleTest/SimpleTest.js:2112:18
[task 2021-04-15T23:31:24.791Z] 23:31:24     INFO - GECKO(1553) | JavaScript error: http://mochi.test:8888/tests/dom/base/test/test_user_select.html, line 132: IndexSizeError: Selection.getRangeAt: 0 is out of range
[task 2021-04-15T23:31:24.792Z] 23:31:24     INFO - GECKO(1553) | MEMORY STAT | vsize 20974971MB | residentFast 1350MB
[task 2021-04-15T23:31:24.792Z] 23:31:24     INFO - TEST-OK | dom/base/test/test_user_select.html | took 507ms",UNCODED,0,UNMATCHED
1705327,6,"Pushed by cdenizet@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/0851da1d6c1d
Remove infobar notification from pdf viewer r=bdahl",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1705327,7,"Backed out for causing mochitest plain failures
Backout link: https://hg.mozilla.org/integration/autoland/rev/120aba36a06e7ae6dbd608e7791b139f25f01878
[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception%2Crunnable&revision=089fd9e33fe26d5b4215692f84493b2026a071f2&searchStr=mochitest%2Cplain&selectedTaskRun=GMMNMWOlQAOVLTGhebnXYg.0)
[Failure log](https://treeherder.mozilla.org/logviewer?job_id=336760569&repo=autoland&lineNumber=5249)
INFO - Buffered messages finished
[task 2021-04-16T08:46:31.750Z] 08:46:31     INFO - TEST-UNEXPECTED-FAIL | dom/base/test/test_user_select.html | testE: selected text - got """", expected ""aa\nbbbb\nee""
[task 2021-04-16T08:46:31.750Z] 08:46:31     INFO -     SimpleTest.is@SimpleTest/SimpleTest.js:500:14
[task 2021-04-16T08:46:31.751Z] 08:46:31     INFO -     checkText@dom/base/test/test_user_select.html:108:7
[task 2021-04-16T08:46:31.751Z] 08:46:31     INFO -     test@dom/base/test/test_user_select.html:242:12
[task 2021-04-16T08:46:31.752Z] 08:46:31     INFO - Not taking screenshot here: see the one that was previously logged
[task 2021-04-16T08:46:31.753Z] 08:46:31     INFO - TEST-UNEXPECTED-FAIL | dom/base/test/test_user_select.html | testE: Selection range count - got +0, expected 3
[task 2021-04-16T08:46:31.754Z] 08:46:31     INFO -     SimpleTest.is@SimpleTest/SimpleTest.js:500:14
[task 2021-04-16T08:46:31.754Z] 08:46:31     INFO -     checkRangeCount@dom/base/test/test_user_select.html:127:7
[task 2021-04-16T08:46:31.755Z] 08:46:31     INFO -     test@dom/base/test/test_user_select.html:243:18
[task 2021-04-16T08:46:31.755Z] 08:46:31     INFO - Not taking screenshot here: see the one that was previously logged
[task 2021-04-16T08:46:31.756Z] 08:46:31     INFO - TEST-UNEXPECTED-FAIL | dom/base/test/test_user_select.html | uncaught exception - IndexSizeError: Selection.getRangeAt: 0 is out of range at checkRange@http://mochi.test:8888/tests/dom/base/test/test_user_select.html:132:17
[task 2021-04-16T08:46:31.756Z] 08:46:31     INFO - test@http://mochi.test:8888/tests/dom/base/test/test_user_select.html:244:13",IMPLEMENTATION_REVERSION,0,90_PCT_MATCH
1705327,8,":sandor, I don't think this failure is related to the patch I landed.
When I open log and then I open the job for this log I get:
https://treeherder.mozilla.org/jobs?repo=autoland&revision=089fd9e33fe26d5b4215692f84493b2026a071f2&selectedTaskRun=GMMNMWOlQAOVLTGhebnXYg.0
I can see this failing job:
https://treeherder.mozilla.org/jobs?repo=autoland&selectedTaskRun=AGz6wbbxRfm3ynvhBgtYug.0
but its name `16-089fd9e33fe2-bk` seems to indicate again an issue with the above patch. 
Could you fix that please ?",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1705327,9,"That log is from where we discovered the failures.
You can see in this range,that the test under your patch are green and they are starting to fail after your patch
https://treeherder.mozilla.org/jobs?repo=autoland&resultStatus=success%2Ctestfailed%2Cbusted%2Cexception%2Crunning%2Cpending%2Crunnable&fromchange=a00cdb29df1f9c9939332094c15c89026f31eb66&searchStr=linux%2C18.04%2Cx64%2Cdebug%2Cmochitests%2Ctest-linux1804-64%2Fdebug-mochitest-plain-e10s%2C16&tochange=089fd9e33fe26d5b4215692f84493b2026a071f2&group_state=expanded&selectedTaskRun=AGz6wbbxRfm3ynvhBgtYug.0
The name is from the backfilling action task. it shows from what change set the backfill started. 
You can read about this feature [here](https://wiki.mozilla.org/Sheriffing/Manifest_Scheduling)",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1705327,10,":sandor, ok I understand the backout.
I'm pretty sure that this patch is not the real culprit since it just aims to remove an infobar from pdf reviewer and there nothing related to text selection here.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1705327,11,"So there is something wrong with tests here:
https://searchfox.org/mozilla-central/source/dom/base/test/mochitest.ini
I just disabled the two tests related to pdf and I got the same error:
https://treeherder.mozilla.org/jobs?repo=try&revision=49d1a46d59b564305924db02204f038f53f673d7
So my patch is not the root cause of the regression but just highlights something wrong.
This test: https://searchfox.org/mozilla-central/source/dom/base/test/test_pdf_print.html
loads a bad pdf and so two (??) infobars are displayed.
So my patch implies that these infobars aren't displayed anymore (the innerHeight property isn't the same).
Since I can reproduce locally, I made a try in keeping only pdf tests and `test_user_select` in the `mochitest.ini` and of course everything runs fine !? so something else is wrong.
Using luck and dichotomy, I managed to get similars errors with `test_user_select` with this basic `mochitest.ini`:
```ini
[test_meta_viewport_fixed_width_and_zero_display_width.html]
[test_user_select.html]
```
:botond, would you have an idea here ?",SOLUTION_VERIFICATION,0,90_PCT_MATCH
1705327,12,"I can reproduce the failure with those two tests run in sequence, and it certainly looks weird visually (as if the whole harness page briefly zooms in, although I'm not seeing an actual change to the resolution that would result in that).
I will try to get to the bottom of it, but if you need a quick fix in the meantime, moving the `test_meta_viewport_*` tests into their own subdirectory should help.",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TOKEN
1705327,13,"Investigation so far shows that, at the beginning of `test_user_select.html`, the top-level content window (the one containing the mochitest harness) has a nonzero scroll position. That scroll seems to come from [here](https://searchfox.org/mozilla-central/rev/6a41d8d7ad42d57cf1adcc7067fd8f1689c42ab3/testing/mochitest/tests/SimpleTest/TestRunner.js#416). Not sure yet why the previous test affects whether or not that happens.",COLLATERAL_PROBLEM_ANALYSIS,0,90_PCT_MATCH
1705327,14,"Seems to be related to `test_meta_viewport_fixed_with_and_zero_display_width.html` [changing layout.css.devPixelsPerPx](https://searchfox.org/mozilla-central/rev/6a41d8d7ad42d57cf1adcc7067fd8f1689c42ab3/dom/base/test/viewport_helpers.js#4) via `scaleRatio()` [here](https://searchfox.org/mozilla-central/rev/6a41d8d7ad42d57cf1adcc7067fd8f1689c42ab3/dom/base/test/test_meta_viewport_fixed_width_and_zero_display_width.html#19). This does cause the whole test harness to zoom in, albeit using full-zoom rather than resolution.",COLLATERAL_PROBLEM_ANALYSIS,0,90_PCT_MATCH
1705327,15,"Ok, so the logical fix seems to be to pair [this call to `pushPrefEnv()`](https://searchfox.org/mozilla-central/rev/6a41d8d7ad42d57cf1adcc7067fd8f1689c42ab3/dom/base/test/test_meta_viewport_fixed_width_and_zero_display_width.html#19) (which changes `layout.css.devPixelsPerPx`) with a corresponding call to `popPrefEnv()` at the end of the test.
However, this does not seem to have the desired effect. While the device pixel ratio is changed back to 60, and we get e.g. a call to [`AppUnitsPerDevPixelChanged()`](https://searchfox.org/mozilla-central/rev/6a41d8d7ad42d57cf1adcc7067fd8f1689c42ab3/layout/base/nsPresContext.cpp#427) for it, the visible area of the root content document's pres shell remains stuck at a size corresponding to the old ratio, and while the root content doc does get reflowed, it's reflowed into this stale size.
I'm not sure what is supposed to trigger the updating of the pres shell's visible area and a reflow to the correct size after the device pixel ratio changes. cc'ing Emilio in case he has some ideas.
Perhaps changing `layout.css.devPixelsPerPx`, which is an action that affects the mochitest harness document itself, is not a well-behaved thing for a mochitest to be doing in the first place?",COLLATERAL_POTENTIAL_SOLUTION,0,90_PCT_MATCH
1705327,16,"Pushed by cdenizet@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/45376b7c2ff5
Remove infobar notification from pdf viewer r=bdahl",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1705327,17,https://hg.mozilla.org/mozilla-central/rev/45376b7c2ff5,UNCODED,0,UNMATCHED
1705327,18,":RT, do you want to have this patch in 89 ?",QUESTION,0,FULL_TEXT
1705327,19,"Yes please, the infobar shows currently on 89, which is counter to our proton goals so can we please consider this as part of the proton uplifts?",UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1705327,20,"Comment on attachment 9216037
Bug 1705327 - Remove infobar notification from pdf viewer
### Beta/Release Uplift Approval Request
* **User impact if declined**: User will continue to see the infobar when opening some specific pdfs.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: 
* **List of other uplifts needed**: Bug 1706021
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Because it just removes an infobar.
* **String changes made/needed**:",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1705327,21,"Comment on attachment 9216037
Bug 1705327 - Remove infobar notification from pdf viewer
Looks low risk, has tests and baked a few days on nightly, approved for 89 beta 5, thanks.",UPLIFT_APPROVAL,0,FULL_TEXT
1705327,22,https://hg.mozilla.org/releases/mozilla-beta/rev/120a5201ab31,UNCODED,0,UNMATCHED
1705327,23,"Looks like this was a dupe of bug 1701006, copying its proton flags over",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1705327,24,*** Bug 1701006 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1705327,25,"Verified as fixed using the latest Nightly 90.0a1 and the latest Firefox 89 beta 9 - the PDF Infobar notification has been removed. Verified on macOS BigSur 11, Ubuntu 20.04, and Windows 10.",SOLUTION_VERIFICATION,0,FULL_TEXT
1715838,1,"In order to get started on Bug 1696573, we'll want to create a pref to ""hide"" the ongoing screenshots refactor. This will help us land patches and ensure we do not break current screenshots functionality. 1 will be in progress, and the other is the current implementation.
This is very similar to how we implemented the new print preview with `print.tab_modal.enabled` [[1]]. If the pref is true, taking a screenshot should bring up the new screenshots UI (maintained as a browser component). If false, we should operate with the current setup. 
We'll have to add the pref to `StaticPrefList.yaml`, similar to the printing pref [[2]].
Then, in the places where we usually make calls to the screenshots extension UI [[3]] [[4]], we should notify the observers if the pref is false. As a reference, here is how the printing service would accomplish that: https://searchfox.org/mozilla-central/rev/2c991232499e826e46f9d976eb653817340ba389/toolkit/components/printing/content/printUtils.js#38-43,342-343
[1]: https://searchfox.org/mozilla-central/search?q=print.tab_modal.enabled&path=
[2]: https://searchfox.org/mozilla-central/rev/2c991232499e826e46f9d976eb653817340ba389/modules/libpref/init/StaticPrefList.yaml#9869-9875
[3]: https://searchfox.org/mozilla-central/rev/2c991232499e826e46f9d976eb653817340ba389/browser/base/content/nsContextMenu.js#1291-1293
[4]: https://searchfox.org/mozilla-central/rev/2c991232499e826e46f9d976eb653817340ba389/browser/components/customizableui/CustomizableWidgets.jsm#505",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1715838,2,"Created attachment 9226819
Bug 1715838 - Creates preference for new screenshot components. r?emalysz",UNCODED,0,UNMATCHED
1715838,3,"Pushed by emalysz@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/bea5b6f80aa6
Creates preference for new screenshot components. r=emalysz",UNCODED,0,UNMATCHED
1715838,4,https://hg.mozilla.org/mozilla-central/rev/bea5b6f80aa6,UNCODED,0,UNMATCHED
1717682,1,"We're going to be looking at an experiment and layout change for newtab that is more compact cards, and 4 card rows.",PROBLEM_DESCRIPTION,0,FULL_TEXT
1717682,2,"Created attachment 9228451
Bug 1717682 - Newtab Pocket layout for compact 4 card layout",UNCODED,0,UNMATCHED
1717682,3,"Created attachment 9240691
Bug 1717682 - Pref and implementation for compact 4 card row layout for Pocket newtab.",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1717682,4,"To test:
1. Start a new profile
Expected: Should look no different than what's in nightly, and should not have any visual regressions.
Expected: Try different screen sizes, should also not regress anything.
Expected: Dark mode or other themes should not look any different.
1. Start a new profile.
2. Go to about:config
3. Flip browser.newtabpage.activity-stream.discoverystream.compactLayout.enabled to true
4. Open a new tab
Expected: Cards should now be more compact.
Expected: Should have 4 cards per row.
Expected: read time should show a number in minutes, it could also fallback to nothing, which is ok but rare. This is also the part that's translated with Fluent.
Expected: Spocs should have their sponsored by label under the thumbnail now.
Expected: Different screen sizes should look reasonable.
Expected: Dark mode or other themes should look reasonable.",S2R,0,90_PCT_MATCH
1717682,5,"Pushed by sdowne@getpocket.com:
https://hg.mozilla.org/integration/autoland/rev/44b5100cceca
Pref and implementation for compact 4 card row layout for Pocket newtab. r=fluent-reviewers,gvn,flod",UNCODED,0,UNMATCHED
1717682,6,https://hg.mozilla.org/mozilla-central/rev/44b5100cceca,UNCODED,0,UNMATCHED
1718031,1,"**Filed by:** abutkovits [at] mozilla.com
**Parsed log:** https://treeherder.mozilla.org/logviewer?job_id=343727663&repo=autoland
**Full log:** https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/Fr8SNnSkTXCz_sNjn_2r4g/runs/0/artifacts/public/logs/live_backing.log
**Reftest URL:** https://hg.mozilla.org/mozilla-central/raw-file/tip/layout/tools/reftest/reftest-analyzer.xhtml#logurl=https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/Fr8SNnSkTXCz_sNjn_2r4g/runs/0/artifacts/public/logs/live_backing.log&only_show_unexpected=1
---
```
[task 2021-06-24T10:18:39.387Z] 10:18:39     INFO - TEST-START | toolkit/components/nimbus/test/browser/browser_remotesettingsexperimentloader_remote_defaults.js
[task 2021-06-24T10:18:39.389Z] 10:18:39     INFO - TEST-INFO | started process screenshot
[task 2021-06-24T10:18:39.474Z] 10:18:39     INFO - TEST-INFO | screenshot: exit 0
[task 2021-06-24T10:18:39.474Z] 10:18:39     INFO - Buffered messages logged at 10:18:39
[task 2021-06-24T10:18:39.475Z] 10:18:39     INFO - Entering test bound test_remote_fetch_and_ready
[task 2021-06-24T10:18:39.475Z] 10:18:39     INFO - Buffered messages finished
[task 2021-06-24T10:18:39.475Z] 10:18:39     INFO - TEST-UNEXPECTED-FAIL | toolkit/components/nimbus/test/browser/browser_remotesettingsexperimentloader_remote_defaults.js | This prop does not exist before we sync - 42 == ""undefined"" - JS frame :: chrome://mochitests/content/browser/toolkit/components/nimbus/test/browser/browser_remotesettingsexperimentloader_remote_defaults.js :: test_remote_fetch_and_ready :: line 145
[task 2021-06-24T10:18:39.475Z] 10:18:39     INFO - Stack trace:
[task 2021-06-24T10:18:39.475Z] 10:18:39     INFO - chrome://mochitests/content/browser/toolkit/components/nimbus/test/browser/browser_remotesettingsexperimentloader_remote_defaults.js:test_remote_fetch_and_ready:145
[task 2021-06-24T10:18:39.476Z] 10:18:39     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest/<:1086
[task 2021-06-24T10:18:39.476Z] 10:18:39     INFO - chrome://mochikit/content/browser-test.js:Tester_execTest:1126
[task 2021-06-24T10:18:39.476Z] 10:18:39     INFO - chrome://mochikit/content/browser-test.js:nextTest/<:937
[task 2021-06-24T10:18:39.476Z] 10:18:39     INFO - chrome://mochikit/content/tests/SimpleTest/SimpleTest.js:SimpleTest.waitForFocus/<:1041
```",STACK_TRACE,0,FULL_TOKEN
1718031,2,"14 failures in 3115 pushes (0.004 failures/push) were associated with this bug in the last 7 days.
Repository breakdown:
* autoland: 14
Platform and build breakdown:
* linux1804-64-qr: 2
  * opt: 1
  * debug: 1
* linux1804-64: 2
  * opt: 1
  * debug: 1
* windows10-32-qr: 2
  * opt: 1
  * debug: 1
* windows10-64-qr: 2
  * debug: 1
  * opt: 1
* windows10-64: 2
  * debug: 1
  * opt: 1
* macosx1015-64-qr: 4
  * debug: 2
  * opt: 2
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1718031&startday=2021-06-21&endday=2021-06-27&tree=all",UNCODED,0,UNMATCHED
1718031,3,"Created attachment 9229283
Bug 1718031 - Intermittent [tier2] TV toolkit/components/nimbus/test/browser/browser_remotesettingsexperimentloader_remote_defaults.js",UNCODED,0,UNMATCHED
1718031,4,"Pushed by aoprea@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/296412895f45
Intermittent [tier2] TV toolkit/components/nimbus/test/browser/browser_remotesettingsexperimentloader_remote_defaults.js r=k88hudson",UNCODED,0,UNMATCHED
1718031,5,https://hg.mozilla.org/mozilla-central/rev/296412895f45,UNCODED,0,UNMATCHED
1762292,1,"Created attachment 9270147
single zap example
Designs currently have a double zap under ""Yous"" of 100 Thank Yous. But that might have spacing/overlap issues for translations that have ""Yous"" not as the last word. It seems like current styling should work okay with a single zap.",PROBLEM_MOTIVATION,0,FULL_TEXT
1762292,2,"emcminn, with bug 1762488 patch adding zap for any Localized, this bug should just be activating zap, e.g., `hero_text: { zap: true, `",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1762292,3,"Created attachment 9270478
Bug 1762292 - Turn on Zap for hero text r=mviar",UNCODED,0,UNMATCHED
1762292,4,"Pushed by elee@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/6dd62bffb5c1
Turn on Zap for hero text r=Mardak,mviar",UNCODED,0,UNMATCHED
1762292,5,https://hg.mozilla.org/mozilla-central/rev/6dd62bffb5c1,UNCODED,0,UNMATCHED
1762292,6,"== Change summary for alert #33748 (as of Wed, 06 Apr 2022 04:42:32 GMT) ==
### Improvements:
| **Ratio** | **Test** | **Platform** | **Options** | **Absolute values (old vs new)**| 
|--|--|--|--|--| 
| 9% | [welcome](https://firefox-source-docs.mozilla.org/testing/perfdocs/raptor.html#welcome-c) ContentfulSpeedIndex | macosx1015-64-shippable-qr | cold fission webrender | 1,942.00 -> 1,775.92 |
| 7% | [welcome](https://firefox-source-docs.mozilla.org/testing/perfdocs/raptor.html#welcome-c) ContentfulSpeedIndex | macosx1015-64-shippable-qr | fission warm webrender | 1,822.58 -> 1,686.33 |
For up to date results, see: https://treeherder.mozilla.org/perfherder/alerts?id=33748",SOLUTION_VERIFICATION,0,90_PCT_MATCH
1762292,7,Hello Emily! Could you help figure out which of the two patches (this one or [1762290](https://bugzilla.mozilla.org/show_bug.cgi?id=1762290)) corresponds to the performance improvement for the alert posted above ? Thank you!,CODE_REVIEW_REQUEST,0,90_PCT_MATCH
1762292,8,"Hi Alex! 
I've chatted with my team a bit and the only thing we can come up with is that the perf improvement may be coming from https://phabricator.services.mozilla.com/D142709; which changed the about:welcome background image to a 3kb .svg (the previous image was a 103kb .avif). These patches were all stacked and landed together, which could explain why the alert is showing up here instead. (Oddly D1422709 has a regression attached to it.) I'll make a note here if I come across anything new.",CODE_REVIEW,0,FULL_TOKEN
1762292,9,This enhancement was part of the work done on QA-1448 for which we sent a Preliminary checkpoint. Considering this I am marking it as Verified.,SOLUTION_VERIFICATION,0,FULL_TEXT
1762292,10,"Hi Emily! Thank you for the response! Unfortunately, there was a regression associated with this revision, so I added both 1762292 and 1762290 as regressed by the [logged regression defect](https://bugzilla.mozilla.org/show_bug.cgi?id=1765183). Once the source of the regression is identified between the two bugs, could you please remove 1765183 from the other bug's ""Regressed by"" field ? Thanks!",ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1768744,1,In Bug 1768470 the colorway closet theme selector displays a users active theme via a check mark. This should be made accessible by announcing the status to screen readers.,PROBLEM_MOTIVATION,0,FULL_TEXT
1768744,2,"Created attachment 9275986
Bug 1768744 - Add aria-current to active theme button. r=dao",UNCODED,0,UNMATCHED
1768744,3,We should also attribute `aria-checked` for the current theme selection. Perhaps through an event listener.,ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1768744,4,"Pushed by achurchwell@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d8a1b85ea733
Add aria-current to active theme button. r=dao",UNCODED,0,UNMATCHED
1768744,5,https://hg.mozilla.org/mozilla-central/rev/d8a1b85ea733,UNCODED,0,UNMATCHED
1769085,1,"Fix of Bug 1765907 , tried to invoke Spotlight flow from test file 'browser_privatebrowsing_about_nimbus_messaging.js' using Sinon causing two backout of the patch due to intermittents.
https://phabricator.services.mozilla.com/D144871
Scope of this bug is to investigate intermittent failure seen with patch and refactor test to handle opening spotlight from tests in PBM mode.
Gist below shows the stub usage in  test
https://gist.github.com/punamdahiya/8c9922a4acea3ace1c753dc44fb85199
With this Stub usage in 'browser_privatebrowsing_about_nimbus_messaging.js, intermittent failure was seen in browser_privatebrowsing_focus_promo.js  due to not able to show promo
https://treeherder.mozilla.org/jobs?repo=try&author=pdahiya%40mozilla.com&selectedTaskRun=abpWjvG5TlWQI2NdJIOEDg.0&searchStr=Linux%2C18.04%2Cx64%2CWebRender%2Casan%2Copt%2CMochitests%2Cwith%2Csoftware%2Cwebrender%2Cwith%2Cfission%2Cenabled%2Ctest-linux1804-64-asan-qr%2Fopt-mochitest-browser-chrome-swr-fis-e10s%2Cbc2
If stub calls are changed to spy , intermittent failure below is seen for different tests on linux in private browsing browser_privatebrowsing_localStorage.js , browser_privatebrowsing_noSessionRestoreMenuOption.js, browser_privatebrowsing_protocolhandler.js
A promise chain failed to handle a rejection: Could not get children of file(/tmp/tmp9c8f4krj.mozrunner/settings/main/ms-images) because it does not exist - stack: (No stack available.)
https://treeherder.mozilla.org/logviewer?job_id=377220226&repo=autoland&lineNumber=19988
https://mozilla.slack.com/archives/G90HG2UQH/p1652141301328679?thread_ts=1652119806.446959&cid=G90HG2UQH",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1769085,2,"Fix of https://bugzilla.mozilla.org/show_bug.cgi?id=1759214 should help with below error seen due to issue around remote images cleanup
A promise chain failed to handle a rejection: Could not get children of file(/tmp/tmp9c8f4krj.mozrunner/settings/main/ms-images) because it does not exist - stack: (No stack available.)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1769085,3,"Created attachment 9277852
Bug 1769085 - Fix PBM tests to handle opening Spotlight",PROBLEM_DESCRIPTION,0,FULL_TEXT
1769085,4,"The severity field is not set for this bug.
:tspurway, could you have a look please?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_severity.py).",UNCODED,0,UNMATCHED
1769085,5,"Pushed by pdahiya@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/b65557af5363
Fix PBM tests to handle opening Spotlight r=mviar",UNCODED,0,UNMATCHED
1769085,6,https://hg.mozilla.org/mozilla-central/rev/b65557af5363,UNCODED,0,UNMATCHED
1811466,1,"Created attachment 9313233
Video of the bad behaviour and the correct one
User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:109.0) Gecko/20100101 Firefox/110.0
Steps to reproduce:
(I've confirmed this in a fresh profile, video of the behaviour, and a correct behaviour from previous version is attached)
When you have the ""menu bar"" enabled (the one with File, Edit, View etc) move your mouse over any of them, don't click, just move the mouse over it, then move it anywhere else, again without clicking it.
Actual results:
The item you hovered on will be lit as if you were still hovering over it, and no firefox keyboard shortcuts will work (ctrl + t, ctrl + shift + p etc) and all key inputs will be interpreted as if you really are focused on the menu bar (left and right arrows will move you left and right on the menu bar items, down arrow will open the curently selected item etc) until you either press the alt key (which does normaly focus / defocus the menu bar) to defocus the bar, or click anywhere else in any window (this is new in 110.0b3, previously in 110.0b2 the only way was to click any menu item).
Expected results:
The focus should happen on mouse over, but when the mouse leaves, it should defocus it (as it was before and should still be, based on normal Windows window behaviour)",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1811466,2,"The [Bugbug](https://github.com/mozilla/bugbug/) bot thinks this bug should belong to the 'Firefox::Menus' component, and is moving the bug to that component. Please correct in case you think the bot is wrong.",ISSUE_METADATA_CHANGE,0,90_PCT_MATCH
1811466,3,"[Tracking Requested - why for this release]:Menu hover state is broken due to regression from Bug 1805414
Regression window:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=0c989b2bcd7882a9e7106e7879ab8933c2e09071&tochange=47c002d3637247e71ee901f32421deaecc9d8ea3",PROBLEM_LOCALIZATION,0,FULL_TOKEN
1811466,4,":emilio, since you are the author of the regressor, bug 1805414, could you take a look? Also, could you set the severity field?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#needinfo_regression_author.py).",ASSIGNEE_REQUEST,0,FULL_TOKEN
1811466,5,"Created attachment 9313321
Bug 1811466 - Restore menubar activation behavior from before bug 1811466. r=smaug",UNCODED,0,UNMATCHED
1811466,6,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e301f5641226
Restore menubar activation behavior from before bug 1811466. r=smaug",UNCODED,0,UNMATCHED
1811466,7,https://hg.mozilla.org/mozilla-central/rev/e301f5641226,UNCODED,0,UNMATCHED
1811466,8,Emilio should we uplift? Thanks,UPLIFT_NOMINATION_REQUEST,0,FULL_TEXT
1811466,9,"Comment on attachment 9313321
Bug 1811466 - Restore menubar activation behavior from before bug 1811466. r=smaug
### Beta/Release Uplift Approval Request
* **User impact if declined**: comment 0
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: comment 0
* **List of other uplifts needed**: none
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Very targeted fix.
* **String changes made/needed**: none
* **Is Android affected?**: No",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1811466,10,"Comment on attachment 9313321
Bug 1811466 - Restore menubar activation behavior from before bug 1811466. r=smaug
Approved for 110 beta 8, thanks.",UPLIFT_APPROVAL,0,FULL_TEXT
1811466,11,https://hg.mozilla.org/releases/mozilla-beta/rev/cf0e5ad1054a,UNCODED,0,UNMATCHED
1811466,12,"Reproduced this issue on an affected Nightly build from 2023-01-20 ON Win 10, using the STR from Comment 0.
Verified as fixed on Firefox 111.0a1 (20230131093335) and 110.0b8 (treeherder build - 20230130164457) on Windows 10 and Ubuntu 22.04.
I have verified this issue on Ubuntu with Light and Dark theme enabled. System theme does not have a visible hover effect on the menu bar items and for this issue I have filled Bug 1814079.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1815706,1,"I noticed a bug with how the cumulative histogram telemetry was implemented in bug 1801290 a few months ago. If you click *anywhere* on the sidebar, it triggers the [onclick handler](https://searchfox.org/mozilla-central/source/browser/components/places/content/historySidebar.js#92), updates the histograms and clears the counters. 
This needs to be fixed so that the histograms are only updated when a history entry is clicked.
Additionally, Leif suggested we add a counter for total history clicks in a session, which we don't currently have.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1815706,2,"Created attachment 9317067
Bug 1815706 - Update history sidebar telemetry r=mak,mkaply
* fix sidebar click event handling
* Add scalar for total number of history entries per session
* Add test for scalar",CODE_IMPLEMENTATION,1,FULL_TOKEN
1815706,3,"Created attachment 9317332
Firefox View Data Collection Request - additional Sidebar Telemetry probe",UNCODED,0,UNMATCHED
1815706,4,"Comment on attachment 9317332
Firefox View Data Collection Request - additional Sidebar Telemetry probe
DATA COLLECTION REVIEW RESPONSE:
    Is there or will there be documentation that describes the schema for the ultimate data set available publicly, complete and accurate?
Yes.
    Is there a control mechanism that allows the user to turn the data collection on and off?
Yes. This collection can be controlled through Firefox's Preferences.
    If the request is for permanent data collection, is there someone who will monitor the data over time?
Yes, John Hall is responsible.
    Using the category system of data types on the Mozilla wiki, what collection type of data do the requested measurements fall under?
Category 2, Interaction.
    Is the data collection request for default-on or default-off?
Default on for all channels.
    Does the instrumentation include the addition of any new identifiers?
No.
    Is the data collection covered by the existing Firefox privacy notice?
Yes.
    Does the data collection use a third-party collection tool?
No.
---
Result: datareview+",UNCODED,0,UNMATCHED
1815706,5,"Pushed by sclements@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/b26a56aab365
Update history sidebar telemetry r=mak,kcochrane",UNCODED,0,UNMATCHED
1815706,6,"Backed out for causing failures on browser_sidebar_history_telemetry.js
* *backout:* https://hg.mozilla.org/integration/autoland/rev/02449d7e49332c534a95afe7def303ba1fcfaff3
* *push:* https://treeherder.mozilla.org/jobs?repo=autoland&selectedTaskRun=PnABZl-MQIOnkiVVQdR2tQ.0&revision=b26a56aab365ebd5590a8145f82d11340defe87f&group_state=expanded
* *failure log:* https://treeherder.mozilla.org/logviewer?job_id=406073543&repo=autoland&lineNumber=7447
```
[task 2023-02-17T19:43:36.371Z] 19:43:36     INFO - TEST-PASS | browser/components/places/tests/browser/browser_sidebar_history_telemetry.js | sidebar.link must contain the 'history' key. - true == true - 
[task 2023-02-17T19:43:36.372Z] 19:43:36     INFO - Buffered messages finished
[task 2023-02-17T19:43:36.374Z] 19:43:36     INFO - TEST-UNEXPECTED-FAIL | browser/components/places/tests/browser/browser_sidebar_history_telemetry.js | sidebar.link['history'] must contain the expected value - 5 == 4 - {""filename"":""resource://testing-common/TelemetryTestUtils.sys.mjs"",""name"":""assertKeyedScalar"",""sourceId"":1585,""lineNumber"":47,""columnNumber"":12,""sourceLine"":"""",""asyncCause"":null,""asyncCaller"":null,""caller"":{""filename"":""chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_sidebar_history_telemetry.js"",""name"":""test_click_multiple_history_entries/<"",""sourceId"":2344,""lineNumber"":84,""columnNumber"":24,""sourceLine"":"""",""asyncCause"":null,""asyncCaller"":null,""caller"":null,""formattedStack"":""test_click_multiple_history_entries/<@chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_sidebar_history_telemetry.js:84:24\n"",""nativeSavedFrame"":{}},""formattedStack"":""assertKeyedScalar@resource://testing-common/TelemetryTestUtils.sys.mjs:47:12\ntest_click_multiple_history_entries/<@chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_sidebar_history_telemetry.js:84:24\n"",""nativeSavedFrame"":{}}
[task 2023-02-17T19:43:36.374Z] 19:43:36     INFO - Stack trace:
[task 2023-02-17T19:43:36.374Z] 19:43:36     INFO - resource://testing-common/TelemetryTestUtils.sys.mjs:assertKeyedScalar:47
[task 2023-02-17T19:43:36.374Z] 19:43:36     INFO - chrome://mochitests/content/browser/browser/components/places/tests/browser/browser_sidebar_history_telemetry.js:test_click_multiple_history_entries/<:84
[task 2023-02-17T19:43:36.406Z] 19:43:36     INFO - Leaving test bound test_click_multiple_history_entries
[task 2023-02-17T19:43:36.408Z] 19:43:36     INFO - Entering test bound test_search_and_filter
[task 2023-02-17T19:43:36.409Z] 19:43:36     INFO - withSidebarTree: waiting sidebar load
[task 2023-02-17T19:43:36.565Z] 19:43:36     INFO - GECKO(6984) | JavaScript error: resource://devtools/client/jsonview/Sniffer.sys.mjs, line 50: NS_ERROR_NOT_AVAILABLE: Component returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIChannel.contentType]
[task 2023-02-17T19:43:36.592Z] 19:43:36     INFO - Console message: [JavaScript Error: ""NS_ERROR_NOT_AVAILABLE: Component returned failure code: 0x80040111 (NS_ERROR_NOT_AVAILABLE) [nsIChannel.contentType]"" {file: ""resource://devtools/client/jsonview/Sniffer.sys.mjs"" line: 50}]
[task 2023-02-17T19:43:36.592Z] 19:43:36     INFO - getMIMETypeFromContent@resource://devtools/client/jsonview/Sniffer.sys.mjs:50:13
[task 2023-02-17T19:43:36.592Z] 19:43:36     INFO - 
```
Marco, can you take a look at this since Sarah is away until the 27th?",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1815706,7,"Pushed by kcochrane@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/99ac48311f47
Update history sidebar telemetry r=mak,mkaply",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1815706,8,https://hg.mozilla.org/mozilla-central/rev/99ac48311f47,UNCODED,0,UNMATCHED
1815706,9,"Comment on attachment 9317067
Bug 1815706 - Update history sidebar telemetry r=mak,mkaply
### Beta/Release Uplift Approval Request
* **User impact if declined**: Telemetry for the History sidebar will be recorded somewhat improperly and will not be as robust.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: Open history sidebar using View > Sidebar > History. Ensure telemetry is recorded properly for cumulative searches within the History sidebar before opening a history link(s) from that same sidebar. This can be viewed as a Histogram ""PLACES_SEARCHBAR_CUMULATIVE_SEARCHES"". Also ensure that telemetry is recorded each time one of these history links is opened from the sidebar (using a new keyed scalar for ""sidebar.link"" with the name ""history"").
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Updates existing telemetry and adds a new keyed scalar. New and existing telemetry is covered by automated tests.
* **String changes made/needed**: N/A
* **Is Android affected?**: No",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1815706,10,"Comment on attachment 9317067
Bug 1815706 - Update history sidebar telemetry r=mak,mkaply
Approved for 111.0b5",UPLIFT_APPROVAL,0,FULL_TEXT
1815706,11,https://hg.mozilla.org/releases/mozilla-beta/rev/cc5d4b96b0dc,UNCODED,0,UNMATCHED
1815706,12,"Hello! Reproduced the initial issue with Firefox 111.0b4 on Windows 10x64. Clicking anywhere on the sidebar will increase the `PLACES_SEARCHBAR_CUMULATIVE_SEARCHES` and `PLACES_SEARCHBAR_CUMULATIVE_FILTER_COUNT` histogram numbers.
The above histograms are no longer increased by clicking on the sidebar with Firefox 111.0b5 from comment 10 and Firefox 112.0a1 (2023-02-23) on Windows 10x64, macOS 11, and Ubuntu 20.04. Also the new keyed scalar for `sidebar.link > history` number is correctly increased each time a history link is clicked inside the history sidebar.",SOLUTION_VERIFICATION,0,FULL_TOKEN
819493,1,"I was talking with some folks today about how we have too many notification bars happening on first/second/third run (know your rights, telemetry, obsolete plugins, FHR). When we wrote the Know Your Rights notification box, we didn't have about:home and its dynamic snippet area, but now we do. I suggest that we remove the notification bar for that and instead make it the snippet displayed on first run, before we go and fetch the dynamic snippets we display on future page loads.
I think the code here should be simple, but I'd like to from marketing and legal about whether there are any gotchas here. Gavin notes that we'll need to be a little careful about how we implement it, since the current default snippet isn't guaranteed to be shown, but presumably we'd want that, here.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
819493,2,Filed legal bug 819495 to ensure that we're covered there.,NEW_ISSUE_FILING,0,FULL_TEXT
819493,3,"This sounds good to me. Agree with the alert overload upon first run experience. 
This may require a update to the Snippet Service. From the Engagement perspective, serving out custom communication based on user life-cycle is something we've wanted to have the ability to do for a while. Perhaps we look at it that way instead of focusing on having the ""default"" snippet do this job. Those default snippets contain evergreen content designed to show when the snippet service is down. They have generic messaging to fit any user experience. Ideally in this snippet we would want to say ""Welcome to Firefox! Did you know..."" 
Perhaps file a bug for the Snippet Service, and focus this bug on simply removing the Alert bar?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
819493,4,"I don't think we want to block this on snippet service improvements, since that complicates the dependency chain significantly. We don't need to use the existing default snippet mechanism for this; we could have a hard-coded ""first run"" snippet separate from the default snippets, that is used only first run.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
819493,5,"Fine by me. 
Marketing requirement: Make sure this First Run snippet is shown only once, to new users only.  I'm happy to provide the copy, graphic, and link - let me know when you need this.",REQUIREMENT,0,FULL_TOKEN
819493,6,"Yes, please. Pre-emptive ui-r+ from us. :)",UNCODED,0,UNMATCHED
819493,7,"Who, I wonder aloud, but mostly to Gavin and Dolske, can own such a thing? It doesn't trump other important work, but it is a nice little win and (I would hope, given comment 3 and comment 4) a well-scoped one.",ASSIGNEE_REQUEST,0,FULL_TEXT
819493,8,Gavin and I already talked about it last week (ohai MWC). Progress soon.,DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
819493,9,"I will fix up the logic bits, then I'll ping Laura if I need any graphic work done.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
819493,10,"Created attachment 721272
This is how it looks like after the patch is applied
All the snippet needs is an image that gives an extra ""oompf!"" to the message. Laura, could you take a look at that, or do you think it's a-ok like this?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
819493,11,"Created attachment 721275
this patch moves the 'Know Your Rights' notification box to a snippet",UNCODED,0,UNMATCHED
819493,12,coming up: JSON data exchange and unit test.,STATUS_UPDATE,0,FULL_TEXT
819493,13,"I'm very happy to see this progress and can work with Creative to get a graphic. 
Questions first:
1. Can we optimize the copy string? That messaging is sorely out of date and could read a lot stronger. 
2. When exactly will a user see this snippet?",QUESTION,0,FULL_TOKEN
819493,14,"Answers to your questions:
1. You can optimize the copy string to whatever you like, as far as I'm concerned, but I don't know whether the legal dept needs to check that change too.
2. A user will see this snippet at the exact same time when the notification bar appeared. This is the same as before:
  1. `browser.rights.override` is set to `true` in about:config
  2. the message was not seen by the user before (for example the first launch after a fresh install)",ANSWER_TO_QUESTION,0,FULL_TOKEN
819493,15,"Thanks. Then two more questions:
3. Can we verify the legal necessity and legal requirements of this messaging? (the answer may be in legal bug 819495 which I do not have access to)
4. How many times will a new user (individual new profile, etc) see this snippet?",QUESTION,0,FULL_TOKEN
819493,16,Done - I now have access to this bug. Thanks Johnath.,STATUS_UPDATE,0,FULL_TEXT
819493,17,"Removing the Creative bug as a dependency. Let's not have that block this goodness and implement this first basic step as is (no graphic, same copy). Will follow up with graphic/copy changes in a patch.",STATUS_UPDATE,0,FULL_TEXT
819493,18,In which case I'd say this bug now blocks bug 848118 instead!,ISSUE_IMPACT,0,FULL_TEXT
819493,19,"Created attachment 721710
Added unit tests and now passing serialized JSON between documents",UNCODED,0,UNMATCHED
819493,20,"Comment on attachment 721710
Added unit tests and now passing serialized JSON between documents
Hrm, this image (and the 2x version) doesn't seem to be in the patch. Did you forget to |hg add| it?
I actually kind of prefer having it all on one line, much easier to copy/paste and replace.
aw yeah proper bracing style
This string concatenation may not be acceptable for localization and/or RTL. I think we might need to do something like http://hg.mozilla.org/mozilla-central/annotate/1b49fb552e18/browser/base/content/aboutDialog.xul#l71, where we allow localizers to add text before and after the link. But I'm not certain about this - ask Axel?
Seems like it might be simpler to just have this code be something like:
let knowYourRightsData = AboutHomeUtils.knowYourRightsData;
if (knowYourRightsData)
  docElt.setAttribute(...)
and have AboutHomeUtils return null when nothing needs to be shown (and have the code in aboutHome.js just check for the presence of the attribute, rather than rightsData.show).
Hrm, now it's starting to seem gratuitous :)
clearUserPref before setBoolPref is redundant, FWIW.
You should remove it from EXTRA_JS_MODULES if you're adding it here, otherwise we will copy it over twice unecessarily during build time.
r- for the potential l10n issue and missing images, but with all of these comments addressed this should be ready to go.",CODE_REVIEW,0,FULL_TOKEN
819493,21,"Created attachment 726131
Update as oer Gavin's review and comments
Gavin, thanks for the thorough review!
* The background images won't be added until bug 848118 is resolved (see comment 16)
* You're right about the l10n issue here, so I changed the locale properties
* put back the one-line PNG for OSX
* implemented knowYourRights attribute handling on the pages' documentElement as per your suggestion and adjusted the tests accordingly
Over the years I've adopted the practice to 'correct' coding style mis-alignments whenever I touch that code directly. My idea behind this is that doing it like this gives me the idea that we keep striving for a uniform codebase, while not acting like style-nazi and start correcting each and every flaw in random files.
This is off-topic, but I wanted to mention it anyway: when I look at the codebase as a whole, I get the feeling that too many patches were landed in the past where reviewers eventually skipped over the nits. I actually respect reviewers that dare putting 'Nit: ...' style comments in a review, because it shows that he or she cares about keeping the tree clean and exemplary.",CODE_IMPLEMENTATION,1,FULL_TOKEN
819493,22,"Comment on attachment 726131
Update as oer Gavin's review and comments
Seems like you shouldn't add the related style yet, then (or the empty #rightsSnippet {} block).
Please avoid making the bracing changes in this patch.
This could check ""rightsData.start || rightsData.end"" to be localization-agnostic (we don't currently run browser-chrome tests in non-en-US builds, but we might want to someday).
Wouldn't a more accurate description be ""after it has already been shown once (in the previous test)""?
Hrm, don't think is kosher. IIRC formatStringFromName can do bad things if it's expecting a variable to substitute and doesn't find one in the string. Axel would probably know the details. But in any case it seems like this would be simpler if you added the relevant strings to aboutHome.dtd, similar to how abouthome.defaultSnippet1.v1 works:
<!-- LOCALIZATION NOTE (rightsSnippet.message) text in <a> will be linked to about:rights -->
<!ENTITY rightsSnippet.message ""&brandShortName; is free and open source software from the non-profit Mozilla Foundation. <a>Know your rights</a>"">
and then have the about:home code linkify the <a> appropriately.
(I think both this link and the default snippet links should actually be branding-specific, i.e. in brand.dtd, but I can file a separate bug about that.)
It's a bit risky that the setting of the ""shown"" pref is now decoupled from the actual showing. This currently relies on the AboutHomeUtils.knowYourRightsData getter only ever being called when about:home is going to be displayed, which seems a bit fragile. It would be nice to avoid that somehow - I suppose you could just move this block of code to the browser.js block where the AboutHomeUtils.knowYourRightsData is currently accessed.
This #define will never be true, because you didn't also move over the block at:
http://hg.mozilla.org/mozilla-central/annotate/5dbcbd03d7ba/browser/components/Makefile.in#l23
to browser/modules/Makefile.in. Should test this manually to make sure official/non-official builds work properly.",CODE_REVIEW,0,FULL_TOKEN
819493,23,"People will generally tolerate this to a certain degree, but in general if roughly half of the hunks in the patch are style changes, people will call you on it :)
""striving for a uniform codebase"" is relatively low on our list of priorities, particularly given the diversity and breadth of Mozilla's code and dev community. So ""make patches that are simple to review"" often trumps ""converge on a single bracing style"".",UNCODED,0,UNMATCHED
819493,24,"*sigh* I knew this is one trait that would end up biting me instead, but the solution is simple: I will refrain from doing this from now on.",UNCODED,0,UNMATCHED
819493,25,"Created attachment 732300
Know Your Rights notification box has moved to be shown as default snippet on first startup
Locale data is now in a DTD. I am trying to build an Official Build to test the build flags, I will report back here when I've succeeded.
Gavin: I think I addressed the issues from your review. Could you check that for me?",CODE_IMPLEMENTATION,1,FULL_TEXT
819493,26,"Comment on attachment 732300
Know Your Rights notification box has moved to be shown as default snippet on first startup
Hrm, does this work? In HTML its the existence of the ""hidden"" attribute that matters, rather than its value, so I would think this would need to be removeAttribute(""hidden"")... Oh, I see that you added a #rightsSnippet[hidden=false] rule - just switch this and remove that, I think.
Might be worth adding a comment that this stuff all needs to happen before setting searchEngineURL, since that's what triggers the display of the snippets.
nit: these checks are redundant, and the term ""attribute value"" is kind of vague. Since you're checking that the snippet was actually shown anyways, I don't think it's useful to check the AboutHomeUtils getter directly.
nit: similarly, this doesn't accurately describe what it's checking. The value of AboutHomeUtils.knowYourRightsData doesn't reflect whether a snippet was shown, so adjust the message accordingly.
This is not actually used anymore so perhaps you shouldn't add it.
You can get rid of the corresponding DEFINES line in browser/components/Makefile.in now, since this is its only use.
""will be linked to about:rights""
Seems like this should just return a boolean.
nit: copy/paste means these lines are indented too much
Worth filing a followup to remove this now (it hasn't been set since forever).
r=me with those addressed, thanks for being patient with the multiple review cycles!",CODE_REVIEW,0,FULL_TEXT
819493,27,"Created attachment 732768
Know Your Rights notification box has moved to be shown as default snippet on first startup",UNCODED,0,UNMATCHED
819493,28,"Comment on attachment 732768
Know Your Rights notification box has moved to be shown as default snippet on first startup
Review of attachment 732768:
-----------------------------------------------------------------
Since I want to be annoying today, https://developer.mozilla.org/en-US/docs/Developer_Guide/Coding_Style#JavaScript_objects has braces on a new line for functions :)
This is not to say it's important, it's not. Just wanted to point out how it's hard (and pointless) to have a common style that everyone likes.
Fwiw, some of us also likes using a space to label anonymous functions, thus why you found ""function ()"" instead of ""function()"".
Again, this doesn't matter, we usually just care a single code module is coherent with itself.
::: browser/base/content/abouthome/aboutHome.js
@@ +294,5 @@
trailing space
::: browser/base/content/browser.js
@@ +2654,4 @@
this will always set to true, no need to cache showRights into a temp var, you may just
if (AboutHomeUtils.showKnowYourRights) {
  docElt.setAttribute(""showKnowYourRights"", ""true"");
::: browser/base/content/test/browser_aboutHome.js
@@ +212,5 @@
why the need for beforeRun instead of using setup?
@@ +221,5 @@
the test should cleanup after itself, this test is setting a pref and not clearing it before existing.
@@ +230,5 @@
ditto
@@ +234,5 @@
trailing spaces",CODE_REVIEW,0,FULL_TOKEN
819493,29,"Created attachment 732857
Know Your Rights notification box has moved to be shown as default snippet on first startup
Adjust code as per Marco's comments.
Marco: you are right about the style guide. I did not try to intentionally piss you off, please understand that. I didn't realize I used a different formatting in the test file, so I changed it to be consistent throughout.
In the test I introduced `beforeRun`, because when I used `setup` instead, the tests I wrote would fail, due to a timing issue.
I re-added `tearDown` to clean up the prefs after the test has run. I hope that is to your liking and/ or acceptable.",CODE_IMPLEMENTATION,1,FULL_TOKEN
819493,30,"I hate that document because it's usually a lie, but I fixed that example anyways.",UNCODED,0,UNMATCHED
819493,31,"setup runs after the snippets have been initialized, which is too late for this AIUI.",ANSWER_TO_QUESTION,0,FULL_TEXT
819493,32,"Comment on attachment 732857
Know Your Rights notification box has moved to be shown as default snippet on first startup
The more times you ask me to review this the more comments I'll find :P
This shouldn't be needed, since ""hidden"" in HTML should just work?
FWIW clearUserPref now never throws (since bug 487059), so the try/catches aren't necessary.
The default value of this pref differs depending on whether DEBUG is defined, so I think this test may not work consistently.
I also just realized that the test profile has browser.EULA.override set (http://hg.mozilla.org/mozilla-central/annotate/3a5929ebc886/build/automation.py.in#l485), which may be messing with these tests in unexpected ways. It's a bit frustrating that there's no easy way to test the thing we actually want to test, which is that the rights snippet shows up on first launch.
While we're at it, can you rename OFFICIAL_BUILD to MOZILLA_OFFICIAL to match the thing it's actually depends on? Mapping MOZILLA_OFFICIAL to a slightly differently named define is just confusing.",CODE_REVIEW,0,FULL_TOKEN
819493,33,"setup() should run after the snippets map has been initialized but before loadSnippets has been invoked. some of the tests are indeed setting ""snippets"" in setup(). If that's not the case, there must be something broken.",CLARIFICATION,0,FULL_TEXT
819493,34,"and fwiw, you don't need a teardown(), just do whatever you need at the end of run()?",CODE_REVIEW,0,FULL_TEXT
819493,35,"ah, rather the problem is that the attribute is set on the document element before setup(), so changing the prefs in setup is not enough, they must be changed before the tab is loaded, though setup may probably directly change the attribute.",CODE_REVIEW,0,FULL_TEXT
819493,36,"Created attachment 732983
Know Your Rights notification box has moved to be shown as default snippet on first startup
added proposed changes of Gavin and Marco.",CODE_IMPLEMENTATION,1,FULL_TEXT
819493,37,"Created attachment 732985
Know Your Rights notification box has moved to be shown as default snippet on first startup
updated commit message, carrying over r+",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
819493,38,"Comment on attachment 732985
Know Your Rights notification box has moved to be shown as default snippet on first startup
You seem to have forgotten to remove this, per comment 25 and comment 31.",CODE_REVIEW,0,FULL_TEXT
819493,39,"Gavin: I didn't forget it, because 'hidden' apparently doesn't work in this case; the CSS 'display' attribute may override this. It inherits the 'display:block' style from the other default snippets and I didn't want to touch that too much, so I opted for this solution - to explicitly set 'display' depending on the hidden attribute being set.",ANSWER_TO_QUESTION,0,FULL_TEXT
819493,40,This doesn't apply cleanly to inbound. Please rebase.,UNCODED,0,UNMATCHED
819493,41,"Created attachment 735481
Know Your Rights notification box has moved to be shown as default snippet on first startup
unbitrotted, carrying over r+",CODE_IMPLEMENTATION,1,FULL_TEXT
819493,42,"Created attachment 735483
Know Your Rights notification box has moved to be shown as default snippet on first startup
updated commit message. carrying over r+=gavin",CODE_IMPLEMENTATION,1,80_PCT_MATCH
819493,43,RyanVM: I'm sorry to have wasted your time with this outdated patch! updated and tested the current one.,UNCODED,0,UNMATCHED
819493,44,https://hg.mozilla.org/integration/mozilla-inbound/rev/b50153f9e011,UNCODED,0,UNMATCHED
819493,45,"Backed out in https://hg.mozilla.org/integration/mozilla-inbound/rev/278ea1d0e072 - I don't really know what that buildstep is doing, apparently some sort of test for whether we're breaking l10n repacks, but if you search for ""mozpack.errors.AccumulatedErrors"" in https://tbpl.mozilla.org/php/getParsedLog.php?id=21625292&tree=Mozilla-Inbound, you'll see the thing that failed in a couple of Windows opt builds.
I look forward to hearing the explanation you find out, about what on earth it is, and whether the way it only failed in some builds means that it has broken dependencies, or that whenever you remove a dtd/properties file, you now have to clobber, or have to clobber Windows, or... dunno.",SOLUTION_VERIFICATION,0,FULL_TOKEN
819493,46,"e:\builds\moz2_slave\m-in-w32-000000000000000000000\build\browser\build.mk:55:0: command 'C:/mozilla-build/python27/python.exe e:/builds/moz2_slave/m-in-w32-000000000000000000000/build/build/pymake/pymake/../make.py -C browser/locales l10n-check' failed, return code 2
Error: Missing file: ../../dist/xpi-stage/locale-x-test\chrome/x-test/locale/x-test/global/aboutRights.properties
The patch removes aboutRights.properties. philor suggests a clobber might solve it, but I'd like to understand why that would be needed. Is the ""$(RM) -rf x-test"" in ""make l10n-check"" somehow failing (without showing an error in the log...)? Note also this seems to only happen on some slaves/builds, which suggests some build config/harness issue.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
819493,47,"No idea, I can't really read logs these days. From glancing at it, it seems that the installer repacks OK, but the zip doesn't. Maybe glandium has an idea.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
819493,48,"I think this is what is happening:
- on incremental builds, we re-use dist/bin, which contains aboutRights.properties from a previous build.
- dist/bin is packaged in dist/firefox and then as a package, which thus contains aboutRights.properties
- the package is unpacked for l10n-check
- then a new directory is created for the x-test locale, and filled according to the jar manifests, thus not copying aboutRights.properties.
- the l10n-repack code wants all chrome locale files from the original locale (en-US, coming from the unpacked package) to be found in the new locale (x-test, filled above), and fails because x-test doesn't have aboutRights.properties.
Maybe we should remove dist/bin when starting an incremental build as we currently do for sdk, include, etc. That would avoid a clobber in such cases.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
819493,49,"At least, until we have something better.",CLARIFICATION,0,FULL_TEXT
819493,50,https://hg.mozilla.org/mozilla-central/rev/b50153f9e011,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
819493,51,"m-cMerge, y u no see my backouts?",UNCODED,0,UNMATCHED
819493,52,Sounds reasonable. Do you know when this became a problem? Is it related to your relatively recent packaging changes? I have a hard time believing we haven't removed a properties file since then.,QUESTION,0,FULL_TEXT
819493,53,"The recent l10n repack changes (for some value of recent) are what causes l10n-check to fail, because the new l10n repack code is stricter (which is good). We've been badly handling file removals for like ever, but there must have been no localized properties file removal since the l10n repack landing.",ANSWER_TO_QUESTION,0,FULL_TEXT
819493,54,"Re-landed on top of bug 860371:
https://hg.mozilla.org/integration/mozilla-inbound/rev/c950d2ea4c5b",CODE_IMPLEMENTATION,1,FULL_TOKEN
819493,55,https://hg.mozilla.org/mozilla-central/rev/c950d2ea4c5b,UNCODED,0,UNMATCHED
819493,56,"Hi Gavin,
Taking a look at our current ""first run"" default snippet as well as our two other default snippets (pointing to features and addons) - I would like to explore in updating copy/icon and CTAs. Are there legal ramifications or reasons that these snippets have to be what they currently are or do we have the flexibility to change them?
Please let me know, thanks!
Jean",QUESTION,0,FULL_TOKEN
819493,57,"Hi Jean,
The wording of the ""first run"" snippet was chosen carefully, since it was a straight replacement for the ""know your rights"" info bar. Changing that would require a discussion to make sure that we're not losing important first-run messaging.
The wording and style of the other two ""default snippets"" are completely open to modification - feel free to file a bug and CC me to discuss any changes.",ANSWER_TO_QUESTION,0,FULL_TOKEN
819493,58,*** Bug 730179 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1439571,1,"From https://bugzilla.mozilla.org/show_bug.cgi?id=1438892#c1:
WR @ 1a7bda5a12236f1ea727ae748d604e2e2a56b0bf
https://treeherder.mozilla.org/#/jobs?repo=try&revision=210015507bc6ffb914673697748b975fff5439f5
https://treeherder.mozilla.org/#/jobs?repo=try&revision=6acc361bd7ccae3eafed17ae6a5a57d77033e014
R4 reftest failures, but they're nondeterministic. I retriggered a few times and get slightly difference results. In all cases a subset of the following tests are failing with fuzz(14,8):
layout/reftests/css-invalid/input/input-radio-required.html
layout/reftests/css-invalid/input/input-radio-customerror.html
layout/reftests/css-invalid/input/input-radio-dyn-valid-1.html
layout/reftests/css-invalid/input/input-radio-dyn-valid-2.html
layout/reftests/css-invalid/input/input-radio-nogroup-required-valid.html
layout/reftests/css-invalid/input/input-radio-nogroup-required-invalid.html
layout/reftests/css-invalid/input/input-radio-focus-click.html
While I could just mark them fuzzy-if(webrender,0-14,0-8) it might be worth investigating why we get correct rendering sometimes and fuzzy at other times. ni? Gankro since this is likely coming from servo/webrender#2405.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1439571,2,Glenn said this might be caused by https://github.com/servo/webrender/issues/1943,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1439571,3,clearing ni; the referenced issue seems to have all the relevant details.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1439571,4,"I removed the fuzzy marker and re-ran these tests, and they're still failing:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=aa564e82e9fb651cee824a4f2549a288b08cb5c5",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1439571,5,"I looked at 5 examples of failures of input-radio-required.html and the test image is fairly consistently darker than the reference image, e.g:
(TEST): data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAPoCAYAAAAmy5qxAAAU/ElEQVR4nO3csWnDQACGUY+eLTKLZkjjATyAVR64UCF02SBxiPMF7Pfa44drPw7pNAEAACKn/74AAADwOgQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEBGgAAAAJkfBch+7HNsY663dY5tzP3Y/2QDAAA8p7sD5JjHHNuY5+t5Lpdlnq/nObbx8A0AAPC87g6Q/djnelvnclnm+8f7XC7LXG/rwzcAAMDz8gICAABkfAMCAABkfvUXrNPb1/PvzgEAgNeiEAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgIwAAQAAMgIEAADICBAAACAjQAAAgMwntM3xVNZSX2cAAAAASUVORK5CYII=
(REFERENCE): data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAPoCAYAAAAmy5qxAAAU/ElEQVR4nO3csW3DMBBAUQ/qvbxFes2QRgN4AKsU4EKFIGYFB3Z+APu9ljiA7QfBOw0AAIDI6b8vAAAAfA4BAgAAZAQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEBGgAAAABkBAgAAZAQIAACQESAAAEDmVwGyH/tYt3Us92Ws2zr2Y/+TGQAA4D09HCDHOMa6rWO+zWO6TmO+zWPd1pfPAAAA7+vhANmPfSz3ZUzXaVy+L2O6TmO5Ly+fAQAA3pcXEAAAIOMPCAAAkHlqC9b56/zUOQAA8Fms4QUAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADICBAAAyAgQAAAgI0AAAICMAAEAADI/9U3zIC3kelkAAAAASUVORK5CYII=",SOLUTION_VERIFICATION,0,FULL_TOKEN
1439571,6,"pcwalton suggested he may have incidentally fixed this, tagging to confirm",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1439571,7,Hi Kats -- Can I ask you to re-test this (since you were the reporter) and report back if it's fixed?  Thanks!,VERIFICATION_REQUEST,0,FULL_TOKEN
1439571,8,"Pixel differences on reftests are now reported for all reftests in the log, so we can just look at a recent m-c log to see what the current differences are on these tests. [1] is such a log for linux-qr opt, and it shows 0,0 difference. I looked at a couple of other logs too (linux debug, mac opt) and they are all reporting 0 differences, so it's likely fixed. (Could be just an intermittent 0,0 though). I'll do a try push with the fuzzy annotations removed and retrigger a bunch to confirm.
[1] https://treeherder.mozilla.org/logviewer.html#?job_id=202171044&repo=mozilla-central&lineNumber=11124",SOLUTION_VERIFICATION,0,FULL_TOKEN
1439571,9,https://treeherder.mozilla.org/#/jobs?repo=try&revision=18c72ba5c43bf91b0f1374f040e4a40ced4331d4,UNCODED,0,UNMATCHED
1439571,10,"Another one with a couple more tests that I missed the first time: https://treeherder.mozilla.org/#/jobs?repo=try&bugfiler=&group_state=expanded&revision=21fbae0ac9d621d0ab287a645bce28195267d6a3
Anyway, looking green.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1439571,11,"Created attachment 9012899
Remove fuzzy-if",UNCODED,0,UNMATCHED
1439571,12,"Pushed by kgupta@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/cda12b20e872
Remove fuzzy-if annotation that is no longer necessary. r=Gankro",UNCODED,0,UNMATCHED
1439571,13,https://hg.mozilla.org/mozilla-central/rev/cda12b20e872,UNCODED,0,UNMATCHED
1096093,1,"Scrollbar does not show up when e10s enabled but shows up fine when disabled.
Build: 	20141109030205",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1096093,2,this works for me. Got a screenshot? what platform? any addons?,QUESTION,0,FULL_TEXT
1096093,3,"Hi Brad,
Here is the behavior with e10s on http://youtu.be/8dWzdp2omGQ this is with LastPass, Awesome Screenshot and BugzillaJS. I also disabled all addons and the behavior persisted and also tested in a new profile.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1096093,4,"Hi Benjamin, there are known problems with LastPass. Can you try with that disabled? If it still persists please try with the other two disabled as well.",REPRODUCTION_REQUEST,0,FULL_TEXT
1096093,5,*** Bug 1097143 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1096093,6,*** Bug 1097601 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1096093,7,"From bug 1097601 - I have this whenever I'm using session restore which is all the time on my main profile as I've got tab groups.
It happens on all sites. Whereas opening in non-e10s is fine.
I've also replicated this with not using tab groups, but using the History -> Restore Previous Session option.
I'm using MacBook Pro 10.8 with a retina display on the laptop, and a non-retina external display.
I noticed something this morning: I happened to be on just the laptop display, and the scrollbars were there. Now I've switched back to my normal setup I've lost them again (it took a couple of restarts though). My normal setup has the non-retina display as the ""master"" showing the app bar and menu bar.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1096093,8,I have tried it with all addons disabled and e10s on gives me no scrollbars and e10s off acts normal.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1096093,9,"Benjamin & Mark, do you use an external display?",QUESTION,0,FULL_TEXT
1096093,10,I've seen this with both internal and external displays,ANSWER_TO_QUESTION,0,FULL_TEXT
1096093,11,"Have you seen it when you haven't had an external display plugged in during the lifetime of Firefox?
To clarify, I haven't seen this. I don't use an external display, so I'm wondering if that's a key part of reproducing this.",CLARIFICATION,0,FULL_TEXT
1096093,12,"Definitely, I haven't connected to an external display since leaving home on Saturday and I've restarted Firefox multiple times since then.",ANSWER_TO_QUESTION,0,FULL_TEXT
1096093,13,"Yes, I'm on an external display which is non-retina and hooked up via the thunderbolt port, via hdmi.",ANSWER_TO_QUESTION,0,FULL_TEXT
1096093,14,I am on a internal display when I run into this,ANSWER_TO_QUESTION,0,FULL_TEXT
1096093,15,I think this really needs to block the aurora uplift,REQUIREMENT,0,FULL_TEXT
1096093,16,Starting to investigate this.,STATUS_UPDATE,0,FULL_TEXT
1096093,17,What I would absolutely love is for some reliable STR for this bug to aid in my analysis. Anybody got some? bkerensa - are you still able to reproduce this reliably?,QUESTION,0,FULL_TEXT
1096093,18,"Hi Mike,
STR is pretty simple just enabling e10s on OSX on any nightly for me totally makes scrollbars stop working. Would you like a video? There is no step to reproduce aside from enabling e10s and them immediately not working once the browser restarts.
If I turn them off the scrolls bars are back like magic :)",S2R,0,FULL_TOKEN
1096093,19,"Can you tell me more about your setup? Specifically:
1) What version of OS X you're running
2) What your setting is in System Preferences > General, ""Show scroll bars""
3) Whether or not you have a mouse plugged in when you see this issue
4) Whether or not you can reproduce this with a new profile
Thanks!",QUESTION,0,FULL_TOKEN
1096093,20,"10.10.3 (also happened in 10.10)
Automatically based on mouse or trackpad (OSX Default)
Mouse is plugged in (Unplugged mouse still happens with trackpad)
Can reproduce with fresh profile",ANSWER_TO_QUESTION,0,FULL_TOKEN
1096093,21,"Still no luck reproducing. :(
:tracy, got any cycles to help me figure out what I need to do to see this?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1096093,22,"I've tried toggling various scroll settings in both Nightly and the System prefs, Session restoring, using external or laptop screen.  I am not having any success reproducing this either.  Something non-obvious is in play.",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1096093,23,"allowed today's nightly to update and restart caused scrolls bars to disappear for me this morning.
Here are the JS warnings, errors and logs
flags argument of String.prototype.{search,match,replace} is deprecated d3f13b20b98c56fc4227aea92752bc90.js:1681:15
mutating the [[Prototype]] of an object will cause your code to run very slowly; instead create the object with the correct initial [[Prototype]] value using Object.create browser.js:5292:2
TypeError: this.controller is undefined browserPlacesViews.js:258:0
uncaught exception: 2147942487 <unknown>
OpenGL compositor Initialized Succesfully.
Version: 2.1 NVIDIA-8.26.28 310.40.55b01
Vendor: NVIDIA Corporation
Renderer: NVIDIA GeForce GT 750M OpenGL Engine
FBO Texture Target: TEXTURE_2D
uncaught exception: 2147942487 <unknown>
OpenGL compositor Initialized Succesfully.
Version: 2.1 NVIDIA-8.26.28 310.40.55b01
Vendor: NVIDIA Corporation
Renderer: NVIDIA GeForce GT 750M OpenGL Engine
FBO Texture Target: TEXTURE_2D
1428419585176	FirefoxAccounts	ERROR	FxA rejecting with error NO_ACCOUNT, details: undefined Log.jsm:749:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0
unsafe CPOW usage BrowserUtils.jsm:115:0
unsafe CPOW usage findbar.xml:740:0
unsafe CPOW usage findbar.xml:743:0
unsafe CPOW usage findbar.xml:746:0",ERROR_MESSAGE,0,FULL_TOKEN
1096093,24,"Created attachment 8589141
restart.js
I was finally able to reproduce this. My STR (likely not minimal, but it's a start):
0) Make sure Firefox is set up to restore your tabs / windows from last time when starting up
1) Open a single tab in Firefox that is long (requires a vertical scrollbar). The root document needs to be long - no CSS trickery (so a dxr page is no good. This Bugzilla bug is probably a good page to load, actually).
2) Make sure devtools.chrome.enabled and devtools.debugger.remote-enabled are set to true
3) Open up the Scratchpad from DevTools, and in the titlebar, set Environment to Browser
4) Paste the script I've attached to this bug (""restart.js"") into the Scratchpad, and click ""Run""
The browser should restart and load the test page. Every now and then, the vertical scrollbar is missing.",S2R,0,FULL_TOKEN
1096093,25,"Ok, I have more minimal STR:
0) Make sure Firefox is set up to restore your tabs / windows from last time when starting up and is using e10s.
1) Make sure a mouse is plugged in, and make sure that OS X is configured to show scrollbars ""Automatically based on mouse or trackpad"" (that's in System Preferences > General).
2) Open this bug in one tab, and then again in a second tab.
3) Quit the browser
4) Start the browser
5) Note that the initial re-opened browser has overlay scrollbars instead of the inline scrollbars.
6) Switch to the other tab - notice that the scrollbar track is just a blank area.",S2R,0,FULL_TOKEN
1096093,26,"Maybe it's helpful or not, but if you restore session from about:home this bug does not reproduce.  What is it doing that's different from update or on restart session restore?",QUESTION,0,FULL_TEXT
1096093,27,"I suspect the flurry of remote browsers being restored on a restart is contributing to a race that we're less likely to hit after start-up has completed. I also suspect that if about:home was a tall page and had a scrollbar, we'd hit this again. I will actually try that experiment.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1096093,28,"So I've done a bit of analysis, and here are my findings:
Suppose we're starting Firefox and it automatically restores a session where the selected browser has a vertical scrollbar.
In single-process Firefox on post-Lion OS X, we don't initially draw the scrollbar, because we assume that we're using overlay scrollbars. We're constantly polling this nsLookAndFeel metric for overlay scrollbars and it's returning ""true"".
OS X has noticed that we're asking about the scrollbars, and after it's done an analysis of the peripherals and user preferences, it tells us ""Actually, we're supposed to use permanent scrollbars here"". nsChildView.mm hears that via the NSPreferredScrollerStyleDidChangeNotification that gets handled by ChildView's scrollbarSystemMetricChanged method. This causes nsPresContext to realize that the theme has changed, and it flushes all caches of the look and feel, and recomputes the layout of the page to draw the scrollbars correctly.
In the multi-process case, the look-and-feel metric changes, but the child never hears about the scrollbarSystemMetricChanged event, because the content process doesn't have a ChildView. So the nsPresContext never gets ThemeChanged called on it, and we don't re-lay out the page.
So that's the problem. I'm evaluating solutions now.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1096093,29,"Created attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - [WIP] Cache overlay scrollbar LookAndFeel metric, and invalidate in the content process when parent sends Refresh message. r=?
Pull down this commit:
hg pull -r 58f48da582c157e3a25d53dc194840afc31d15cf https://reviewboard-hg.mozilla.org/gecko/",CODE_IMPLEMENTATION,1,FULL_TEXT
1096093,30,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Cache overlay scrollbar LookAndFeel metric, and allow parent process to send down cache to content process. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
Pull down these commits:
hg pull -r 078699a501806305a33d51617e71527be08c8dd6 https://reviewboard-hg.mozilla.org/gecko/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1096093,31,"https://reviewboard.mozilla.org/r/7305/#review6069
::: dom/ipc/PBrowser.ipdl:676
(Diff revision 2)
Add documentation.
::: layout/base/nsPresContext.cpp:1745
(Diff revision 2)
This comment is wrong.
::: widget/LookAndFeel.h:589
(Diff revision 2)
TODO.
::: widget/nsXPLookAndFeel.cpp:709
(Diff revision 2)
Remove extra newline.
::: widget/nsXPLookAndFeel.cpp:715
(Diff revision 2)
Remove extra newline.",CODE_REVIEW,0,FULL_TEXT
1096093,32,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Cache overlay scrollbar LookAndFeel metric, and allow parent process to send down cache to content process. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
Pull down these commits:
hg pull -r 1d6f0c882c01500fbcce22a0cbeb71a7c91ee17c https://reviewboard-hg.mozilla.org/gecko/",UNCODED,0,UNMATCHED
1096093,33,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
Pull down these commits:
hg pull -r 4abd57038185299027d51eedd5524439293e0abb https://reviewboard-hg.mozilla.org/gecko/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1096093,34,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
Pull down these commits:
hg pull -r 4abd57038185299027d51eedd5524439293e0abb https://reviewboard-hg.mozilla.org/gecko/",UNCODED,0,UNMATCHED
1096093,35,"https://reviewboard.mozilla.org/r/7307/#review6071
::: widget/LookAndFeel.h:592
(Diff revision 4)
I think this can be
static InfallibleTArray<LookAndFeelInt> GetIntCache();
nowadays.
::: widget/LookAndFeel.h:593
(Diff revision 4)
Better make this take a const InfallibleTArray<LookAndFeelInt>& aLookAndFeelIntCache.",CODE_REVIEW,0,FULL_TOKEN
1096093,36,"https://reviewboard.mozilla.org/r/7329/#review6073
Ship It!
::: widget/cocoa/nsLookAndFeel.mm:677
(Diff revision 1)
for (auto entry : *lookAndFeelIntCache) {
  ...
}",CODE_REVIEW,0,FULL_TOKEN
1096093,38,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=?.
Pull down these commits:
hg pull -r 969f30cc8c7a05541111f92f994aabb92d6e5fdf https://reviewboard-hg.mozilla.org/gecko/",UNCODED,0,UNMATCHED
1096093,40,"https://reviewboard.mozilla.org/r/7307/#review6147
::: widget/nsXPLookAndFeel.h:84
(Diff revision 5)
This semicolon is unexpected. Does it compile?
::: widget/nsXPLookAndFeel.cpp:710
(Diff revision 5)
I think this can just be ""return InfallibleTArray<LookAndFeelInt>()"".",CODE_REVIEW,0,FULL_TEXT
1096093,41,"https://reviewboard.mozilla.org/r/7307/#review6149
It does indeed, but I can remove it.
Okie doke, I'll update the patch.",STATUS_UPDATE,0,FULL_TEXT
1096093,42,"https://reviewboard.mozilla.org/r/7327/#review6151
Ship It!
::: dom/ipc/TabParent.cpp:967
(Diff revision 4)
You don't need the lookAndFeelCache intermediate variable here.",CODE_REVIEW,0,FULL_TEXT
1096093,43,"https://reviewboard.mozilla.org/r/7329/#review6153
Ship It!
::: widget/cocoa/nsLookAndFeel.mm:32
(Diff revision 2)
Please initialize these members in the member initializer list, and not in the constructor body.",CODE_REVIEW,0,FULL_TEXT
1096093,44,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=mstange.
Pull down these commits:
hg pull -r f5ff3638d841e7e5297538acd0e1bd6866dec6ae https://reviewboard-hg.mozilla.org/gecko/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1096093,45,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=mstange.
Pull down these commits:
hg pull -r f5ff3638d841e7e5297538acd0e1bd6866dec6ae https://reviewboard-hg.mozilla.org/gecko/",UNCODED,0,UNMATCHED
1096093,46,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=?
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=mstange.
Pull down these commits:
hg pull -r 3d61e9e8599c0e7b59db677cdbf67a5a734450e5 https://reviewboard-hg.mozilla.org/gecko/",UNCODED,0,UNMATCHED
1096093,47,"https://reviewboard.mozilla.org/r/7329/#review6159
::: widget/cocoa/nsLookAndFeel.mm:652
(Diff revision 4)
so here's a question - on Windows I can go in and set ui.useOverlayScrollbars to true and get overlay behavior. This works with e10s. I'm assuming we can do the same on mac, but I'm wondering if the change takes effect?",CODE_REVIEW,0,FULL_TEXT
1096093,48,"https://reviewboard.mozilla.org/r/7307/#review6163
::: dom/ipc/ContentChild.cpp:18
(Diff revision 6)
On this particular patch, which you flagged me on, r+.",CODE_REVIEW,0,FULL_TEXT
1096093,49,"https://reviewboard.mozilla.org/r/7307/#review6165
Ship It!",UNCODED,0,UNMATCHED
1096093,50,"document->GetShell() may return null, and so may presShell->GetPresContext();
Not sure about the coding style for */LookAndFeel.h, but
2 spaces for indentation and aFoo naming for arguments?
widget/WidgetMessageUtils.h
new code should follow Mozilla coding style. So, 2 spaces for indentation.
InfallibleTArray<LookAndFeelInt> GetIntCacheImpl();
huh, I _hate_ implicit ctor+Move(). So very much hides that we aren't doing copying. Oh well, if other people
can live with that insanity, I can survive too (but it does make reviewing slower since one need to look at the ctor implementation).",CODE_REVIEW,0,FULL_TOKEN
1096093,51,(I have no idea why you're using InfallibleTArray and not shorter nsTArray),CODE_REVIEW,0,FULL_TEXT
1096093,52,I've wondered this myself. It seems to be used in ipdl interfaces only for some reason.,ANSWER_TO_QUESTION,0,FULL_TEXT
1096093,53,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=jimm.
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=smaug.
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=mstange.
Pull down these commits:
hg pull -r ad01a0e24fd924ea9d88b1744ae63a4a864cb09a https://reviewboard-hg.mozilla.org/gecko/",UNCODED,0,UNMATCHED
1096093,54,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
/r/7307 - Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?
/r/7327 - Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=smaug.
/r/7329 - Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=mstange.
Pull down these commits:
hg pull -r bba18dfa277315e48699d55523942cf9dd1fe6f3 https://reviewboard-hg.mozilla.org/gecko/",UNCODED,0,UNMATCHED
1096093,55,"Hey jimm,
I pushed my last set of patches up to Try, and oranged out because the LookAndFeel stuff was getting initted when the ContentChild was starting up, and without a display (like when running xpcshell tests), that was causing our GTK self-tests to fail.
After consulting with karlt, my solution is to have LookAndFeel in the content process query the parent only when nsXPLookAndFeel::Init is called (so only when layout/painting needs LookAndFeel).
Here's the interdiff:
https://reviewboard.mozilla.org/r/7307/diff/7-8/
Here's the new try push:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=4e057bc88610",CODE_IMPLEMENTATION,1,FULL_TOKEN
1096093,56,"https://reviewboard.mozilla.org/r/7307/#review6261
looks good.",CODE_REVIEW,0,FULL_TEXT
1096093,57,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley
https://reviewboard.mozilla.org/r/7305/#review6155
::: widget/cocoa/nsLookAndFeel.mm:652
(Diff revision 5)
It's not officially supported, but the overlay scrollbar setting can be set on other platforms. Is there any way we can move this out to XPLookAndFeel so it applies to all platforms?",CODE_REVIEW,0,FULL_TEXT
1096093,58,"^^^^^^
ignore",UNCODED,0,UNMATCHED
1096093,59,"https://hg.mozilla.org/integration/mozilla-inbound/rev/5f9c7cd773a5
https://hg.mozilla.org/integration/mozilla-inbound/rev/8ed8157d26a2
https://hg.mozilla.org/integration/mozilla-inbound/rev/70c19dd86f63",AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TOKEN
1096093,60,sorry had to back this out for bustage like https://treeherder.mozilla.org/logviewer.html#?job_id=9226985&repo=mozilla-inbound,IMPLEMENTATION_REVERSION,0,FULL_TEXT
1096093,61,"Backout:
https://hg.mozilla.org/integration/mozilla-inbound/rev/9b70530c5898
https://hg.mozilla.org/integration/mozilla-inbound/rev/805d4233dc4b
https://hg.mozilla.org/integration/mozilla-inbound/rev/d13a8cde5695",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1096093,62,"Looks like I was missing a header file that b2g didn't use.
Here's a new try that's looking pretty green:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=f87eaa8bf913
I'll wait for these last few to come in and re-land.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1096093,63,Try looks green - relanding...,SOLUTION_VERIFICATION,0,FULL_TEXT
1096093,64,"https://reviewboard.mozilla.org/r/7305/#review6299
I'll open up a follow-up to investigate this, and link it to bug 1096093.",NEW_ISSUE_FILING,0,FULL_TEXT
1096093,65,"https://hg.mozilla.org/integration/mozilla-inbound/rev/fc5b0c1a9a86
https://hg.mozilla.org/integration/mozilla-inbound/rev/4cc6d2d9c5dc
https://hg.mozilla.org/integration/mozilla-inbound/rev/a5edb5f659d7",AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TOKEN
1096093,66,"https://hg.mozilla.org/mozilla-central/rev/fc5b0c1a9a86
https://hg.mozilla.org/mozilla-central/rev/4cc6d2d9c5dc
https://hg.mozilla.org/mozilla-central/rev/a5edb5f659d7",UNCODED,0,UNMATCHED
1096093,67,"Created attachment 8598685
Bugnotes
http://people.mozilla.org/~mconley2/bugnotes/bug-1096093.html",UNCODED,0,UNMATCHED
1096093,68,"Comment on attachment 8594783
MozReview Request: bz://1096093/mconley",UNCODED,0,UNMATCHED
1096093,69,"Created attachment 8618581
MozReview Request: Bug 1096093 - Have Cocoa widget backend cache overlay scrollbar metrics. r=mstange.",UNCODED,0,UNMATCHED
1096093,70,"Created attachment 8618582
MozReview Request: Bug 1096093 - Add infrastructure for LookAndFeel metric caching, and allowing the parent process to send down cache to content process. r=?",UNCODED,0,UNMATCHED
1096093,71,"Created attachment 8618583
MozReview Request: Bug 1096093 - Send ThemeRefresh message from parent down to content process. r=smaug.",UNCODED,0,UNMATCHED
593387,1,"User-Agent:       Mozilla/5.0 (Windows NT 6.1; WOW64; rv:2.0b6pre) Gecko/20100903 Firefox/4.0b6pre
Build Identifier: 
Looks like it doesn't like being loaded in an iframe. I see an error page on screen, and a really long error logged to the error console (due to all of my extensions being parts of the requested URL?).
Reproducible: Always
Steps to Reproduce:
1. Open Addons Manager
2. Go to ""Get Addons"" pane
3. See the error.
Actual Results:  
Content from AMO is restricted by X-FRAME-OPTIONS header.
Expected Results:  
Content from AMO is displayed in the pane.
X-FRAME-OPTIONS: blocked https://services.addons.mozilla.org/en-US/firefox/discovery/4.0b6pre/WINNT#{%22CompactMenuCE@Merci.chao%22:{%22name%22:%22Personal%20Menu%22,%22version%22:%224.3.2%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22contacts@labs.mozilla.com%22:{%22name%22:%22Contacts%22,%22version%22:%220.3.2%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22dataman@kairo.at%22:{%22name%22:%22Data%20Manager%22,%22version%22:%221.0.1%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22downloadbadge@jes_jm.software%22:{%22name%22:%22Download%20Badge%22,%22version%22:%220.1.7%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22firebug@software.joehewitt.com%22:{%22name%22:%22Firebug%22,%22version%22:%221.6X.0b1%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22inspector@mozilla.org%22:{%22name%22:%22DOM%20Inspector%22,%22version%22:%222.0.8%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22jid0-t3eeRQgGANLCH9c50lPqcTDuNng@jetpack%22:{%22name%22:%22Add-ons%20Builder%20Helper%22,%22version%22:%220.0.5%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:false,%22isBlocklisted%22:false},%22locationbar2@design-noir.de%22:{%22name%22:%22Locationbar%C2%B2%22,%22version%22:%221.0.5%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22omnibar@ajitk.com%22:{%22name%22:%22Omnibar%22,%22version%22:%220.7.0.20100707%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:false,%22isBlocklisted%22:false},%22rtse-nightly@shawnwilsher.com%22:{%22name%22:%22RT%20Site%20Extender%22,%22version%22:%221.2.0.20100829%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22siteprefs.mehdi@mozilla.com%22:{%22name%22:%22Site%20Preferences%22,%22version%22:%220.1.2%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22tabsintitlebar@roosterteethsiteextender.com%22:{%22name%22:%22Tabs%20in%20Titlebar%22,%22version%22:%220.1%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:true,%22isBlocklisted%22:false},%22testpilot@labs.mozilla.com%22:{%22name%22:%22Test%20Pilot%22,%22version%22:%221.0.1%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:false,%22isBlocklisted%22:false},%22twitternotifier@naan.net%22:{%22name%22:%22Echofon%22,%22version%22:%221.9.6.5RC2%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{02450954-cdd9-410f-b1da-db804e18c671}%22:{%22name%22:%22Screengrab%22,%22version%22:%220.96.3%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{1280606b-2510-4fe0-97ef-9b5a22eafe80}%22:{%22name%22:%22Console%C2%B2%22,%22version%22:%220.6.1%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{2e61e246-e640-4c56-b1ed-f146dbed48cd}%22:{%22name%22:%22Stop%20Autoplay%22,%22version%22:%220.7.6%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{46551EC9-40F0-4e47-8E18-8E5CF550CFB8}%22:{%22name%22:%22Stylish%22,%22version%22:%221.0.11%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{59c81df5-4b7a-477b-912d-4e0fdf64e5f2}%22:{%22name%22:%22ChatZilla%22,%22version%22:%220.9.86%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{d10d0bf8-f5b5-c8b4-a8b2-2b9879e08c5d}%22:{%22name%22:%22Adblock%20Plus%22,%22version%22:%221.3a.20100831%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{e4a8a97b-f2ed-450b-b12d-ee082ba24781}%22:{%22name%22:%22Greasemonkey%22,%22version%22:%220.8.20100408.6.3%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{000a9d1c-beef-4f90-9363-039d445309b8}%22:{%22name%22:%22Google%20Gears%22,%22version%22:%220.5.36.0%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{3252b9ae-c69a-4eaf-9502-dc9c1f6c009e}%22:{%22name%22:%22Default%20Manager%22,%22version%22:%222.2%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{27182e60-b5f3-411c-b545-b44205977502}%22:{%22name%22:%22Search%20Helper%20Extension%22,%22version%22:%221.0%22,%22type%22:%22extension%22,%22userDisabled%22:true,%22isCompatible%22:false,%22isBlocklisted%22:false},%22{73a6fe31-595d-460b-a920-fcc0f8843232}%22:{%22name%22:%22NoScript%22,%22version%22:%222.0.2.5rc1%22,%22type%22:%22extension%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{972ce4c6-7e08-4474-a285-3208198ce6fd}%22:{%22name%22:%22Default%22,%22version%22:%224.0b6pre%22,%22type%22:%22theme%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%2233@personas.mozilla.org%22:{%22name%22:%22Groovy%20Blue%22,%22version%22:%22%22,%22type%22:%22theme%22,%22userDisabled%22:true,%22isCompatible%22:true,%22isBlocklisted%22:false},%22215507@personas.mozilla.org%22:{%22name%22:%22Firefox%20Cup%20-%20USA%22,%22version%22:%22%22,%22type%22:%22theme%22,%22userDisabled%22:true,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{06b38f9d-7392-47a0-b3de-bb9304e66837}%22:{%22name%22:%22Microsoft%C2%AE%20Windows%20Media%20Player%20Firefox%20Plugin%22,%22version%22:%221.0.0.8%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{9b29438d-3436-4cc8-821e-d2cf929caa9c}%22:{%22name%22:%22Foxit%20Reader%20Plugin%20for%20Mozilla%22,%22version%22:%221.0.1.1117%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{776c1d62-6afa-49e3-ba60-6c8e02129836}%22:{%22name%22:%22Google%20Update%22,%22version%22:%221.2.183.29%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{6a5396e5-ae37-4c8e-b7bc-7d9a2ac0fed7}%22:{%22name%22:%22Shockwave%20Flash%22,%22version%22:%2210.1.82.76%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{ea5854ac-49c9-4532-97c0-1216098104c4}%22:{%22name%22:%22Garmin%20Communicator%20Plug-In%22,%22version%22:%222.8.1.0%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{f723e9b0-4dff-48f1-8e4e-76154c57abe6}%22:{%22name%22:%22Java(TM)%20Platform%20SE%206%20U21%22,%22version%22:%226.0.210.7%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{cacaa5d6-9843-4b9e-b013-8ec3c3247ec4}%22:{%22name%22:%22Java%20Deployment%20Toolkit%206.0.210.7%22,%22version%22:%226.0.210.7%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{76952b67-64de-4320-9cd2-2f2dd392ef84}%22:{%22name%22:%22Silverlight%20Plug-In%22,%22version%22:%224.0.50524.0%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{6870bba4-7f50-4676-8fb2-784bcccee91b}%22:{%22name%22:%22Microsoft%20Office%202010%22,%22version%22:%2214.0.4730.1010%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{b9284f3e-b0fc-4115-9c49-eadfc63c47a6}%22:{%22name%22:%22Microsoft%20Office%202010%22,%22version%22:%2214.0.4761.1000%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{0410798f-2e26-40f7-bd38-c1cfd461dc57}%22:{%22name%22:%22Microsoft%20Office%20Live%20Plug-in%20for%20Firefox%22,%22version%22:%222.0.3009.0%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{e1274911-3d4c-483d-a5c5-89d15abe4ec6}%22:{%22name%22:%22Windows%20Live%C2%99%20Photo%20Gallery%22,%22version%22:%2215.4.3002.810%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false},%22{f6df2a89-4624-4cc4-a3af-8724e8dc6c81}%22:{%22name%22:%22VLC%20Multimedia%20Plug-in%22,%22version%22:%221.0.5.0%22,%22type%22:%22plugin%22,%22userDisabled%22:false,%22isCompatible%22:true,%22isBlocklisted%22:false}}",PROBLEM_DESCRIPTION,0,FULL_TOKEN
593387,2,"This feels like a bug in the X-FRAME-OPTIONS implementation, since we are a
chrome privileged page loading content in browser element.",PROBLEM_LOCALIZATION,0,FULL_TOKEN
593387,3,"Blocks last beta I think, though I think it'd be really really good to see a fix somehow for b6, maybe involving removing the header from AMO till this is done.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
593387,4,*** Bug 593346 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
593387,5,Taking this.  Will have a patch shortly.,DEVELOPER_SELECTION_DECISION,0,FULL_TOKEN
593387,6,Sadly this prevents us also in Beta5 and down to Beta3 to show the one and only location where the Addons Compatibility Reporter is promoted. I would expect more negative via feedback.,ISSUE_IMPACT,0,FULL_TEXT
593387,7,"Created attachment 471899
screenshot
Oddly, if the ""Get Add-ons"" pane is pre-selected when the addon manager loads (previously open the AOM, click ""get addons"", close the tab, reopen the tab), I get this page loading.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
593387,8,That is the unrelated bug 584693,UNCODED,0,UNMATCHED
593387,9,"Created attachment 471922
fix
Add a system principal check.  Boris, perhaps you can tell me the most efficient way to get a principal from a nsIDOMWindow.  I'll also add a test.",CODE_IMPLEMENTATION,1,FULL_TOKEN
593387,10,"Comment on attachment 471922
fix
  nsCOMPtr<nsIScriptObjectPrincipal> objPrin = do_QueryInterface(topWindow);
  nsIPrincipal* topPrincipal = objPrin->GetPrincipal();
This should be a subsumes() check.
Or more interest to me....  Why is this a problem at all?  Are we seriously loading content off the web in a chrome-type iframe, and if so, why?",CODE_REVIEW,0,FULL_TOKEN
593387,11,"Created attachment 471988
fix v2
The Add-ons Manager folks will have to speak to that, but in the meantime here's the patch with the Subsumes check.
I'm still having trouble with the test, but I'll see if I can get attached to the bug relatively soon.",STATUS_UPDATE,0,FULL_TEXT
593387,12,"Oh, wait.  I guess this is about the add-ons-manager-in-browser-tab case? In that situation, I can see why this is being a problem....",CLARIFICATION,0,FULL_TOKEN
593387,13,"Two comments on the patch:
1)  If a chrome page in a content docshell loads site A which then frames site B, the framing will be allowed with this patch.  Is this desired?
2)  Getting the principal of the current document can just be done with
    NodePrincipal(); no need to get it off thisWindow.",CODE_REVIEW,0,FULL_TOKEN
593387,14,*** Bug 593819 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
593387,15,"Comment on attachment 471988
fix v2
Pending answers to the questions.",UNCODED,0,UNMATCHED
593387,16,"Good point.  I'm not sure how often we have chrome top-level page framing web content, but this would happen in those cases.  Perhaps I should get DocShells and call GetSameTypeRootTreeItem()?
Yep, I'll fix this for the next version of the patch.",ANSWER_TO_QUESTION,0,FULL_TOKEN
593387,17,I'm not sure what you mean; what policy are you trying to enforce?,QUESTION,0,FULL_TEXT
593387,18,"X-Frame-Options 1) restricts ""DENY"" documents from being framed in any context and 2) restricts ""SAMEORIGIN"" documents to be framed only if the top-level browsing context is the same origin as the document.
This bug is about adding exceptions to the above policy for chrome.  We want to allow chrome to frame any resource but we don't want to allow content to frame other content if it would violate any of the above policy.
My thinking about GetSameTypeRootTreeItem is:
1) any inner content document with X-F-O: DENY should be blocked if there exists a content docshell anywhere in its parent chain
2) any inner content document with X-F-O: SAMEORIGIN should be blocked if the top content docshell in its parent chain is a different origin
3) we don't need to worry about the ""content > chrome > content"" chain because we don't allow content to frame chrome in any case
How does that sound?
FYI, the canonical documentation for the feature is still Eric Lawrence's blog post:
http://blogs.msdn.com/b/ieinternals/archive/2010/03/30/combating-clickjacking-with-x-frame-options.aspx",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
593387,19,"It not relevant here, since in this case the chrome is being loaded in a content-type docshell, so the top content docshell in this case is the chrome page...  That old issue with chrome principal vs chrome docshell coming back to bite us.  :(",SOLUTION_REVIEW,1,FULL_TOKEN
593387,20,What are the chances of this making b6? I don't think it blocks it but it'd be super awesome to get it in as AMO are going to be rolling out the new UI in there next week,STATUS_UPDATE,0,FULL_TEXT
593387,21,"A new issue.
With current trunk and pending patch for bug 584693 applied, this patch no longer causes the Get Add-ons content to display.
For whatever it is worth, the original patch here at least still works.",NEW_ISSUE_FILING,0,FULL_TOKEN
593387,22,"The issue here seems to be that we are trying to display content in an iframe where the server specifically says:
x-frame-options: DENY
It seems to me this really should just not work.
Perhaps if the header said x-frame-options: SAMEORIGIN some exception for this case would make more sense?  Perhaps somehow treating about:addons and addons.mozilla.org as being the same origin? Still a kludge but makes more sense than permitting something that there is an explicit specific deny on the server-side.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
593387,23,"Of course, if besides DENY and SAMEORIGIN, x-frame-options could also specify a whitelist of things permitted to include this in a frame, this would probably be helpful not only here, but in other cases as well.  But, I guess Microsoft never thought of that when they specified this.",SOLUTION_REVIEW,1,FULL_TOKEN
593387,24,*** Bug 595494 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
593387,25,"This simple answer to the b6 issue would be to NOT specify the x-frame-options header on the 4.0b6 page on the server side, yet continue to specify it on the 4.0b7pre page so that this issue can continue to be worked.
This would result in Get Add-ons working for the beta builds only.",ANSWER_TO_QUESTION,0,FULL_TOKEN
593387,26,"Bummer.  Well, that proposal was only to prevent the case in the first part of your comment 12:
I suppose we can punt on that case since we ultimately get to decide who the site A is that we'll be framing in the product, and we can avoid choosing sites that will be framing other X-F-O:DENY pages.  Sound fair?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
593387,27,"And by ""punt on that case"" I mean ""allow chrome to frame any document regardless of its X-F-O preferences"".",ANSWER_TO_QUESTION,0,FULL_TEXT
593387,28,It sounds like a footgun to me...  I doubt people expect that loading a chrome page in a content area will suddenly give it less secure behavior than loading it as chrome to start with.,ANSWER_TO_QUESTION,0,FULL_TOKEN
593387,29,"I am not sure if I am parsing your comment incorrectly or if you are misunderstanding the use case. Aren't we talking about loading a _content_ page in a _chrome area_?  This bug addresses the case where about:addons frames a page from services.addons.mozilla.org.
If we go forward with comment 26, the only cases where we end up with less secure behavior is if chrome frames a page that in turn frames another page who doesn't want to be framed.  This proposal would allow that inner page to be framed because the top-level context is chrome.  For there to be any real security impact, the page we chose to frame under the top-level chrome document would have to be a bad actor and do something malicious with the page it in turn framed (e.g. clickjacking).  It seems highly unlikely that we would frame any web content in the product that we don't trust or have control over.
Can you explain the danger you see here a bit more?  What are the cases where we load a chrome page in a content area and how is our comparison between the framed content and the top-level page not sufficient for those cases?",SOLUTION_REVIEW_REQUEST,0,FULL_TOKEN
593387,30,"We're talking about loading a document that has the system principal (so is trusted) in a type=""content"" docshell and this document then creating a subframe into which it loads an untrusted document.
If the document that has the system principal were loaded in a type=""chrome"" docshell itself, there would be no issue; X-Frame-Options would not treat it as the root document for the content and everything would Just Work (this is the case for the browser itself, say, where the XUL document for the UI is loaded in a chrome docshell and has type=""content"" subframes).  But the ""ui in tab"" thing is implemented in a particularly silly way in that it uses type=""content"" docshells.  As a result, anything that gets same-type docshell parents for subframes of that UI will find the docshell the UI is loaded in (e.g. if you frame AMO in the addons manager, window.top evaluated on AMO will actually return the addons manager window).  So X-Frame-Options is finding the addons UI as the root docshell, and you get this bug.
Are we on the same page so far?
Yes.
Where the first ""we"" includes extensions, right?  It doesn't seem that unlikely to me, given that...
All the in-tab UI stuff, plus any extensions that do similar things.",ANSWER_TO_QUESTION,0,FULL_TOKEN
593387,31,"Just spoke to Boris and we decided on a better approach which is to mimic the GetSameTypeRootTreeItem behavior for finding the ""top"" docshell, but with an additional check that will make us stop when we find the first non-SystemPrinicpal-having item.  Patch coming up...",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
593387,32,"Created attachment 475890
fix v3
Find the top non-systemPrincipal docshell in our parent chain to avoid comparing principals with chrome documents (who are allowed to frame X-F-O pages).",CODE_IMPLEMENTATION,1,FULL_TEXT
593387,33,"Comment on attachment 475890
fix v3
Just nsIPrincipal* is fine.
Call that curDocShellItem or something?
You only use these inside the loop.  Why not just declare them there?
I'd think we want to fail safe here (so deny if we can't get an SSM).
I'm pretty sure you should be able to assert that topDoc is non-null, but if we want ot keep the null-check we should just fail out if !topDoc. 
r=me woth those nits addressed.",CODE_REVIEW,0,FULL_TOKEN
593387,34,"This is marked betaN but I would really like to see this in for feature freeze. Brandon, possible to get the comments and checkin turned around today?",CODE_UPDATE_REQUEST,0,FULL_TEXT
593387,35,"Created attachment 476053
fix v4
This addresses Boris' review comments, but I'm still struggling to get a test working.  If drivers want to land this in the meantime, by all means...",CODE_IMPLEMENTATION,1,FULL_TOKEN
593387,36,I really do not understand this bug at all.  THe client is trying to display from the server in a frame.  THe server sepcifacally says this content can not be displayed in a frame under any circumstances.  So exactly why should code be changed to actually allow the content to be displyed in the frame??,QUESTION,0,FULL_TOKEN
593387,37,"Because the ""frame"" in this case is actually the same thing as a browser tab for practical purposes.  It happens to have a slightly different implementation in the layout engine, but that's just a bug that needs to be fixed.  If that bug were fixed, this issue would not arise at all; this patch is just working around that bug.",ANSWER_TO_QUESTION,0,FULL_TOKEN
593387,38,"Created attachment 476434
fix v5
Now with test.  Carrying forward Boris' review.",CODE_IMPLEMENTATION,1,FULL_TOKEN
593387,39,"If you're going to use checkin-needed, please include a commit message in your patch.  (Really, you should always include it so the reviewer can review it.)
I don't understand this well enough to write a good commit message, so I can't check it in.",CODE_REVIEW,0,FULL_TOKEN
593387,40,"http://hg.mozilla.org/mozilla-central/rev/f5c0015afe0e
I used the bug summary as the commit message, which seems suboptimal.",CODE_IMPLEMENTATION,1,FULL_TOKEN
593387,41,"While we're at it, this bug seems to be in the wrong component as well.",UNCODED,0,UNMATCHED
593387,42,*** Bug 594682 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
593387,43,*** Bug 601521 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
593387,44,Verified fixed with Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0b7pre) Gecko/20101006 Firefox/4.0b7pre. Also tested with 4.0b8pre builds on other platforms.,SOLUTION_VERIFICATION,0,FULL_TEXT
593387,45,*** Bug 605005 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
593387,46,"User-Agent:       Mozilla/5.0 (Windows NT 5.1; rv:2.0b6) Gecko/20100101
Firefox/4.0b6
Build Identifier: Mozilla/5.0 (Windows NT 5.1; rv:2.0b6) Gecko/20100101
Firefox/4.0b6
I'm here as a Dupe via Comment 44 .
Fixed ? : When I click [Tools][Add-ons] I get this page as the default http://www.mozilla.org/ , and if I click another Tab below ""Get Add-ons"" (EG: Extensions, Themes, or Plug-ins) and then ""Get Add-ons"" again I get a Blank rendering - there is NO frame. A right-click the SECOND time (in the frame area) says the URL is now ""about:addons"" (the ""frame"" is gone).
Rob",SOLUTION_VERIFICATION,0,FULL_TOKEN
593387,47,It's been fixed after beta 6 was released. The (hopefully) upcoming beta 7 will include the fix.,STATUS_UPDATE,0,FULL_TEXT
552359,1,"Created attachment 432476
Log with data: URIs
http://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1268611926.1268613545.12202.gz
OS X 10.5.2 mozilla-central opt test reftest on 2010/03/14 17:12:06
See attach error log snippet for test image vs. reference image.",STACK_TRACE,0,90_PCT_MATCH
552359,2,"Looking at the test images, the <input> have the placeholder text, so it
seems to not have focus when the snapshot was taken?
I don't see how my caret cleanup (bug 544852) could have broken this
but I could be missing something...",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
552359,3,"http://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1269511430.1269512875.31049.gz
OS X 10.5.2 mozilla-central opt test reftest on 2010/03/25 03:03:50  
s: moz2-darwin9-slave17",UNCODED,0,UNMATCHED
552359,4,"http://tinderbox.mozilla.org/showlog.cgi?log=Firefox/1269516844.1269518375.8836.gz
OS X 10.5.2 mozilla-central opt test reftest on 2010/03/25 04:34:04
s: moz2-darwin9-slave18",UNCODED,0,UNMATCHED
552359,5,This orange boils down to the fact that the input text boxes are not actually focused.  I think the issue will be solved by making sure that the reftest window is in foreground while reftests are running.  I'm still investigating a solution.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
552359,6,"Created attachment 434998
WIP
So, this patch does two things.  First, it uses the onfocus event handler on input elements to make sure to run the test only when they're focused.  It also modifies the reftest platform to make sure that the window is raised and focused before running each test.
This same code is used for browser chrome tests, but it doesn't work in the reftest framework.  I couldn't figure out why, asking for Neil's feedback who knows a lot more about our focus code than me.",CODE_IMPLEMENTATION,1,FULL_TOKEN
552359,7,Hmmm.  I rather liked the idea that reftests can work even when the window isn't focused.  I wonder if it's worth converting these to mochitests in order to preserve that.  Thoughts?,CODE_REVIEW,0,FULL_TOKEN
552359,8,"Caret reftests depend on having focus too.
What I would really like to do is have a way for tests to *pretend* a browser window has OS-level focus when it really doesn't.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
552359,9,"This particular problem, I think, shows an actual problem in the focus code.  Neil said that he's willing to debug this.
To debug this, run the reftests like this:
/path/to/firefox -reftest layout/reftests/forms/placeholder/reftest.list
so that the Firefox window is initially in the background.  Running tests that way makes them fail 100% of the time for me.",PROBLEM_REVIEW,0,FULL_TOKEN
552359,10,"Replacing the focus manager with a mock (controllable by preference) might be an interesting possibility, although preserving ability to dispatch and respond to OS-level events seems tricky.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
552359,11,"Created attachment 435325
Patch (v1)
So, Neil said that the main reason behind the problem is that the XUL browser element inside the chrome document is not focused.  Calling gBrowser.focus() seems to solve the problem.
So, I've fixed that problem in this patch.  I've also modified the placeholder reftests to actually depends on the focus event.  This means that they would still fail if the window is not focused, but they would time out this time, which is a lot better (at least, it's not misleading as a rendering problem.)
Also, note that the Tinderbox machines use |make reftest| which uses automation.py which passes -foreground to firefox, and it makes sure that the window is initially raised on Mac.
I think that the attached patch is enough for this bug.",CODE_IMPLEMENTATION,1,FULL_TOKEN
552359,12,http://hg.mozilla.org/mozilla-central/rev/e75d28fbaa0b,UNCODED,0,UNMATCHED
552359,13,"FYI, on Linux, you can use Xephyr to run tests on its own X server to avoid
focus problems.  As a bonus, it also makes it easier to limit CPU resources
using 'nice' for the tests.",PROBLEM_REVIEW,0,FULL_TOKEN
552359,14,"I still have a random orange for placeholder-7.html. On 10 tries, I got it failing 7 times.
I simple workaround is to change disableReftestWait(); to setTimeout(disableReftestWait, 5);.",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TEXT
552359,15,"Created attachment 439691
Patch for placeholder-7.html",UNCODED,0,UNMATCHED
552359,16,"Adding timeouts generally doesn't fix orange, it just makes it harder to reproduce.
We need to understand why this test fails without the timeout and then we can fix it properly.",CODE_REVIEW,0,FULL_TOKEN
552359,17,"Comment on attachment 439691
Patch for placeholder-7.html
Canceling review per previous comment.
Someone else can reproduce this random failure ?",VERIFICATION_REQUEST,0,FULL_TEXT
552359,18,"Mounir, how did you run the tests?  Did you use |make reftest| or |firefox -reftest ...|?  Also, which platform did you try this on?",QUESTION,0,FULL_TOKEN
552359,19,I used |firefox - reftest| on a x86 platform.,ANSWER_TO_QUESTION,0,FULL_TEXT
552359,20,"I meant, which OS?  ;-)",QUESTION,0,FULL_TOKEN
552359,21,"Oups, why did I forget that? :)
I'm using GNU/Linux.",ANSWER_TO_QUESTION,0,FULL_TOKEN
552359,22,"So, when you run the test, does the window appear in the foreground or in the background?  Also, is it focued or not?  What happens when you use make reftest instead?  Also, do you get a reftest failure, or a timeout?
Here's why I'm asking these questions.  I found out that on Mac, if you use firefox -reftest, the Firefox window will appear in the background, so the text boxes are not focused, and that obviously messes up the placeholder tests, because they rely on the reftest window being focused.  Using make reftest solves this, because it runs Firefox in the foreground (and make reftest is what Tinderbox machines use).
On Linux, however, this should _not_ be an issue, AFAIK.",QUESTION,0,FULL_TOKEN
552359,23,"It shows in foreground so the issue is not linked with an unfocused input otherwise, |setTimeout| wouldn't fix it. It sounds much more like a repaint which is done after the reftest check.
There is a way to launch |make reftest| without doing _ALL_ reftests ? There is no 'reftest' target inside layout/ directory.
Btw, it also concerns placeholder-8.html.",ANSWER_TO_QUESTION,0,FULL_TOKEN
552359,24,"Then I think this should be another bug, but let's make sure.
Yes:
make -C /path/to/objdir reftest TEST_PATH=layout/reftests/forms/placeholder/reftest.list
If you get the same failure with make reftest as well, please file a new bug and attach a reftest log of the failure.",ANSWER_TO_QUESTION,0,FULL_TOKEN
552359,25,"Let me be more clear here.  Unless we have a log besides the one attached in comment 0 which shows that this failure happens when the window actually has the focus here, I think this is a focus related issue, and this bug is FIXED now.",CLARIFICATION,0,FULL_TOKEN
552359,26,"Created attachment 444802
Log for placeholder-7.html randomness",UNCODED,0,UNMATCHED
552359,27,"Hmm, based on this log, this is a different bug.  Please file it separately.
Also, it would be great if you could debug this locally (because I haven't been able to reproduce this).  You could set a breakpoint in nsCaret::DrawCaret, and see the code path which invokes it for the reference file, and see what happens differently in the original test file when this fails randomly.
Marking this bug as FIXED again.",VERIFICATION_REQUEST,0,FULL_TOKEN
552359,28,bug 565594 opened. Thansk Ehsan :),NEW_ISSUE_FILING,0,FULL_TEXT
1298588,1,"In Servo the initial computed values for all the properties is completely static. In Gecko, most style struct constructors take a value that is presshell dependent.
This allows handling, for example, the initial font size depending on zooming[1], and other similar, document-dependent stuff.
We need to align this behavior between both, but I think it's hard if not impossible handling the amount of things Gecko handles there without per-document style data.
[1]: http://searchfox.org/mozilla-central/source/layout/style/nsStyleStruct.cpp#224",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1298588,2,"Yeah, I was hoping that we could keep the initial computed values totally static and share them across documents (that's why I introduced StyleStructContext). However, last I talked to dbaron he was skeptical about this approach (in particular with respect to text zooming, IIRC).
David, could you have a look at http://searchfox.org/mozilla-central/rev/f80822840bc5f3d2d3cae3ece621ddbce72e7f54/layout/style/StyleStructContext.h#15 (both the comment and API surface) and let us know whether you think this is a feasible approach, or whether we should just bite the bullet and make style structs per-document?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1298588,3,"I guess the basic alternative I was imagining would be that consumers (which are document-aware) would post-process the values when they're used. So I guess the question is whether there are transformations that are not commutative with respect to the cascade.
Also, the only time that Gecko calls these constructors is for the initial computed values (everything else is copy-on-write modified from those). Does that match Gecko, and is there any reason that would cause problems if we started making the style structs document-dependent? We'd presumably need to throw them away and regenerate them if text zoom changes, but I wonder if there's anything else.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1298588,4,"I guess that's not really feasible, given the conversion from relative units to computed values depend on this too. Once you exit the style system you don't have rem units, for example, you should have already converted them to computed values. And to do so you need the font-size of the root.
Worth waiting for David's input though.",SOLUTION_REVIEW,1,FULL_TOKEN
1298588,5,"From https://public.etherpad-mozilla.org/p/stylo-taipei :
It seems that the initial style structs depend on a few different external values (Content-Language for 'direction', device pixel ratio, ...) so we should just have per-document initial style structs rather than sharing them across all documents.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1298588,6,Boris is going to work on this.,DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1298588,7,"Some other items that would be good to handle here or in followups:
* Set things up so that we regenerate the initial style structs in whatever situations cause them to be invalidated (presumably some subset of the things that trigger whole-document restyle).
* Fix things up so that we call Servo_Init()/Servo_Shutdown() properly for the content process in e10s mode.
* See if things run without --disable-e10s. If they do, file a bug to remove that from our stylo mozconfig file. If they don't, file followups for the remaining issues.",REQUIREMENT,0,FULL_TOKEN
1298588,8,"Created attachment 8822369
part 1.  Make StyleStructContext work with a const nsPresContext",UNCODED,0,UNMATCHED
1298588,9,"Created attachment 8822386
part 2.  Pass through an nsPresContext to the PerDocumentStyleData constructor",UNCODED,0,UNMATCHED
1298588,10,"Created attachment 8822387
part 3.  Add a default ComputedValues member to PerDocumentStyleData",UNCODED,0,UNMATCHED
1298588,11,"Created attachment 8822388
part 4.  Recreate the default computed values for a document as needed",UNCODED,0,UNMATCHED
1298588,12,"Created attachment 8822390
part 5.  Store a ComputedValues on SharedStyleContext
The servo side of this is pretty much being left to https://github.com/servo/servo/issues/14773",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1298588,13,"Created attachment 8822391
part 6.  Stop using initial_values when doing inheritance in Gecko glue code",UNCODED,0,UNMATCHED
1298588,14,"Created attachment 8822392
part 7.  Stop using initial_values in general in Gecko glue code",UNCODED,0,UNMATCHED
1298588,15,"Created attachment 8822393
part 8.  Pass a SharedStyleContext, not a Stylist, to Legalizer methods",UNCODED,0,UNMATCHED
1298588,16,"Created attachment 8822395
part 9.  Pass through useful default styles to cascade()",UNCODED,0,UNMATCHED
1298588,17,"Created attachment 8822397
part 10.  Pass through useful default styles to apply_declarations()",UNCODED,0,UNMATCHED
1298588,18,"Created attachment 8822398
part 11.  Pass through useful default styles to CascadePropertyFn",UNCODED,0,UNMATCHED
1298588,19,"Created attachment 8822399
part 12.  Compile some bits that call ComputedValues::initial_values only for servo, not stylo
I'm not super-happy with this, but a better solution is best done after we decide how we're doing media queries in stylo.",CODE_IMPLEMENTATION,1,FULL_TEXT
1298588,20,"Created attachment 8822400
part 13.  Make sure Device has a ComputedValues for stylo
Again, a cleaner solution is pending media query stuff being sorted out",CODE_IMPLEMENTATION,1,80_PCT_MATCH
1298588,21,"Created attachment 8822401
part 14.  Remove ComputedValues::initial_values for stylo",UNCODED,0,UNMATCHED
1298588,22,"Created attachment 8822402
part 15.  Rip out the initial() methods on style structs in stylo",UNCODED,0,UNMATCHED
1298588,23,"Created attachment 8822403
part 16.  Remove StyleStructContext",UNCODED,0,UNMATCHED
1298588,24,"I believe this is more or less done in the attached patches, except for the Device bits.
As far as I can tell this already happens.
Things seem to run fine that way (or as fine as without these patches, at least).  That said, I don't see --disable-e10s in browser/config/mozconfigs/linux64/stylo or browser/config/mozconfigs/linux64/stylo-debug.  So not sure where things need removing from.",SOLUTION_REVIEW,1,FULL_TOKEN
1298588,25,"Comment on attachment 8822400
part 13.  Make sure Device has a ComputedValues for stylo
Review of attachment 8822400:
-----------------------------------------------------------------
::: servo/components/style/gecko/data.rs
@@ +67,5 @@
I wouldn't worry too much about the `Device` right now because I probably need to rewrite it in Stylo for bug 1325878. So it's probably acceptable to leave this as-is in the meantime.",CODE_REVIEW,0,FULL_TEXT
1298588,26,"Comment on attachment 8822399
part 12.  Compile some bits that call ComputedValues::initial_values only for servo, not stylo
Review of attachment 8822399:
-----------------------------------------------------------------
Can we compile out ComputedValues::initial_values too?",CODE_REVIEW,0,FULL_TEXT
1298588,27,"NVM, saw the next patch.",UNCODED,0,UNMATCHED
1298588,28,"\o/
Are you sure? The existing failure mode without --disable-e10s is that the initial computed values are null, which I always assumed was because we call Servo_Init in nsAppRunner rather than nsLayoutStatics [1]. The reason for this, which is explained above [1], is obsoleted by your patches. So I think we just need another patch to move the calls back to nsLayoutStatics.
Yeah, I realized that we're currently building both e10s and non-e10s, so we're actually good there.
NI on the Servo_Init patch. I'll see if I can review the rest of the patches now.
[1] http://searchfox.org/mozilla-central/rev/51aa673e28802fe6ea89f4793721fc55334a6ac8/toolkit/xre/nsAppRunner.cpp#4390",SOLUTION_REVIEW,1,FULL_TEXT
1298588,29,"Comment on attachment 8822386
part 2.  Pass through an nsPresContext to the PerDocumentStyleData constructor
Review of attachment 8822386:
-----------------------------------------------------------------
lgtm. Flagging Manish for a quick look at the FFI glue if he gets the chance. No need to block on it to land.",CODE_REVIEW_REQUEST,0,FULL_TEXT
1298588,30,"Comment on attachment 8822387
part 3.  Add a default ComputedValues member to PerDocumentStyleData
Review of attachment 8822387:
-----------------------------------------------------------------
::: servo/components/style/properties/gecko.mako.rs
@@ +132,5 @@
Nit: The convention in Servo is to do:
FIXME(bz): This seems dubious
Same below.",CODE_REVIEW,0,FULL_TOKEN
1298588,31,"Comment on attachment 8822388
part 4.  Recreate the default computed values for a document as needed
Review of attachment 8822388:
-----------------------------------------------------------------
::: layout/base/ServoRestyleManager.cpp
@@ +96,5 @@
Yes, I think that would be better. Can you file a blocker against stylo-incremental to implement this method correctly?",CODE_REVIEW,0,FULL_TEXT
1298588,32,"Comment on attachment 8822386
part 2.  Pass through an nsPresContext to the PerDocumentStyleData constructor
Review of attachment 8822386:
-----------------------------------------------------------------
::: layout/style/ServoStyleSet.cpp
@@ +28,5 @@
I assume this is never null, since we later pass it unchecked to appendstylesheet.",CODE_REVIEW,0,FULL_TEXT
1298588,33,"Comment on attachment 8822399
part 12.  Compile some bits that call ComputedValues::initial_values only for servo, not stylo
Review of attachment 8822399:
-----------------------------------------------------------------
Please add some comments explaining why we're compiling these out.",CODE_REVIEW,0,FULL_TEXT
1298588,34,"Comment on attachment 8822401
part 14.  Remove ComputedValues::initial_values for stylo
Review of attachment 8822401:
-----------------------------------------------------------------
\o/",UNCODED,0,UNMATCHED
1298588,35,"Comment on attachment 8822400
part 13.  Make sure Device has a ComputedValues for stylo
Review of attachment 8822400:
-----------------------------------------------------------------
Probably worth filing a bug depending on bug 1290228 and blocking the stylo metabug to make sure that we end up updating these values.",CODE_REVIEW,0,FULL_TEXT
1298588,36,"I'll update the patches and whatnot tomorrow, and answer needinfos.  I did have one question: what is the landing procedure for this?  Ideally one that preserves bisectability on both Gecko and Servo side...",QUESTION,0,FULL_TOKEN
1298588,37,"That's hard to do right now, the only properly bisectable commits are the syncs, which are ""known good"" builds.
You should land the Servo part independently doing a PR to servo/servo (to export your patches you can use `git format-patch <revision> --relative=servo`), and then land the gecko patches independently (I usually do `git format-patch --relative=layout`, but maybe there's a better way?).",ANSWER_TO_QUESTION,0,FULL_TOKEN
1298588,38,"OK, I guess I just don't understand what the current integration testing story is.  On the _gecko_ side we will certainly want all commits to be bisectable; I guess I should build just the Gecko parts one by one without the servo parts and see if they actually compile when not doing --enable-stylo...
The git commands are not relevant to me, because I'm not using git here to start with.  ;)  I know how to produce patches; the question is what patches to produce.",ANSWER_TO_QUESTION,0,FULL_TOKEN
1298588,39,You should also push your patches to try with the target platform linux64-stylo and see how the results compare to https://treeherder.mozilla.org/#/jobs?repo=stylo&revision=68a742b057d75c060fc7e37b8ab89bbffbbb9e2e,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1298588,40,"Fwiw, the changes in bug 1324627 bitrotted part 6 of this bug.  I'm going to back out some of those changes, so I keep having a PerDocumentStyleData in ResolveStyle.  Please let me know whether you want to re-review the resulting part 6.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1298588,41,"Created attachment 8823160
Interdiff for part 6
OK, fixing things turned out to be a big more complicated than a simple backout.  Here's an interdiff of the actual changes needed to make part 6 work again.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1298588,42,"Apart from ""both are totally orange""?
The reftest failures seem about the same.
For crashtest, I see a ton more assertions in my try push, coming from CounterStyleManager::NotifyRuleChanged called from the mPresContext->FlushCounterStyles() call in PresShell::FlushPendingNotifications.  But I'm not sure why this wouldn't get hit without my patches; I would expect this assert to be hit all the time as things stand...",SOLUTION_VERIFICATION,0,FULL_TOKEN
1298588,43,"Oh, and for the separate-landing bits... where do I land the Gecko patches?  Inbound?  The incubator repo directly?  Something else?",QUESTION,0,FULL_TOKEN
1298588,44,Inbound. Rebase them onto tip and remove the servo/ changes. https://public.etherpad-mozilla.org/p/stylo#lineNumber=52 has a git-filter-branch invocation that helps if you're using cinnabar.,ANSWER_TO_QUESTION,0,FULL_TEXT
1298588,45,"Comment on attachment 8823160
Interdiff for part 6
Review of attachment 8823160:
-----------------------------------------------------------------
::: layout/style/ServoStyleSet.cpp
@@ +558,5 @@
nit: whitespace",CODE_REVIEW,0,FULL_TEXT
1298588,46,"OK, the crashtest bit was because we started calling CounterStyleManager::BuildCounterStyle() from the default nsStyleFont ctor.  I'm going to just hack around it to keep not doing that for now for the servo case.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TOKEN
1298588,47,"nsStyleList, of course.",COLLATERAL_PROBLEM_ANALYSIS,0,FULL_TEXT
1298588,48,"Created attachment 8823361
Interdiff for part 3 to ""fix"" the crashtest asserts.
The real fix will be bug 1328319",CODE_IMPLEMENTATION,1,95_PCT_MATCH_PROCESSED
1298588,49,"Created attachment 8823362
Interdiff for part 16 to keep avoiding the assert",UNCODED,0,UNMATCHED
1298588,50,"No.  I saw nothing that would prevent XREMain::XRE_mainRun from running in the child process... but I guess the point is that we just fork _after_ that or something.  Though I wonder how we bring up XPCOM in the child process in that case...
In any case, I filed bug 1328651 on this; will fix.
Fixed.
Filed bug 1328652.
Correct.
Done.
Bug 1328655 filed.",CODE_IMPLEMENTATION,1,FULL_TEXT
1298588,51,https://github.com/servo/servo/pull/14848,UNCODED,0,UNMATCHED
1298588,52,"Pushed by bzbarsky@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/82ae3ed4c30c
part 1.  Make StyleStructContext work with a const nsPresContext.  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/f230c3fb62f5
part 2, gecko piece.  Pass through an nsPresContext to the PerDocumentStyleData constructor.  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/94daa42ee46f
part 3, gecko piece.  Add a default ComputedValues member to PerDocumentStyleData.  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/6d4f963d3655
part 4, gecko piece.  Recreate the default computed values for a document as needed.  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/47a58ef26a92
part 6, gecko piece.  Stop using initial_values when doing inheritance in Gecko glue code.  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/ac84ae5fa2da
part 7, gecko piece.  Stop using initial_values in general in Gecko glue code.  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/4ccc8126ea20
part 9, gecko piece.  Pass through useful default styles to cascade().  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/6994a692b48c
part 10, gecko piece.  Pass through useful default styles to apply_declarations().  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/0978881c4e10
part 15, gecko piece.  Rip out the initial() methods on style structs in stylo.  r=bholley
https://hg.mozilla.org/integration/mozilla-inbound/rev/e743dff9dca1
part 16.  Remove StyleStructContext.  r=bholley",UNCODED,0,UNMATCHED
1298588,53,"https://hg.mozilla.org/mozilla-central/rev/82ae3ed4c30c
https://hg.mozilla.org/mozilla-central/rev/f230c3fb62f5
https://hg.mozilla.org/mozilla-central/rev/94daa42ee46f
https://hg.mozilla.org/mozilla-central/rev/6d4f963d3655
https://hg.mozilla.org/mozilla-central/rev/47a58ef26a92
https://hg.mozilla.org/mozilla-central/rev/ac84ae5fa2da
https://hg.mozilla.org/mozilla-central/rev/4ccc8126ea20
https://hg.mozilla.org/mozilla-central/rev/6994a692b48c
https://hg.mozilla.org/mozilla-central/rev/0978881c4e10
https://hg.mozilla.org/mozilla-central/rev/e743dff9dca1",UNCODED,0,UNMATCHED
1298588,54,"Pushed by bzbarsky@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/f6c47ff600f7
followup whitespace fix to address a missed review comment.  DONTBUILD",UNCODED,0,UNMATCHED
1298588,55,https://hg.mozilla.org/mozilla-central/rev/f6c47ff600f7,UNCODED,0,UNMATCHED
1179123,1,"Created attachment 8628124
testcase
In non-e10s mode, if a page request fullscreen and call window.exit() in the fullscreenchange handler, Firefox would crash.
Steps to reproduce:
1. open a non-e10s window if in e10s mode
2. open the attachment page
3. click the page, a new tab will be open
4. click the newly opened page
Expected result:
the new page is closed properly
Actual result:
Firefox crashes
I cannot reproduce this in release channel, hence likely a regression.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1179123,2,"Since it causes crash in the coming Beta, mark it as security sensitive bug.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1179123,3,Is this just on OS X? Do you have a crashreport ID or stack? Am I right in thinking 39 is not affected?,QUESTION,0,FULL_TEXT
1179123,4,"No. Actually I initially met this crash on Windows, and I can reproduce this on OS X as well.
I just reproduced it and submit one: bp-e2b8091e-7f3d-4167-8bf1-121152150701
I'm not sure. I haven't tested Firefox 39. But I guess it shouldn't be affected.",ANSWER_TO_QUESTION,0,FULL_TEXT
1179123,5,"This is null pointer crash, so shouldn't need to be security sensitive.",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1179123,6,"I can repro on windows on 42, but not on 39.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1179123,7,Confirmed it is a regression since bug 947854.,REPRODUCTION_ATTEMPT,0,FULL_TEXT
1179123,8,"It seems this bug is fixed by some other bug (likely bug 1168705), but we do need some more safeguard as well as patch for uplift.",REQUIREMENT,0,FULL_TEXT
1179123,9,"Created attachment 8629165
safeguard patch
This would still trigger assertion in existing versions, but won't crash.
I tried to thoroughly fix it, but failed to figure out how.
This bug happened at the end of nsINode::doRemoveChildAt().
That method calls nsXULElement::UnbindFromTree() there, which calls nsFrameLoader::Destroy() -> nsDocument::SetSubDocumentFor() to remove the child document from the XUL document, then calls nsElement::UnbindFromTree() -> nsDocument::ExitFullscreen() to exit fullscreen on the root document. Since the child document has been detached at this point, we won't be able to visit that document to exit fullscreen there.
Then the method calls the destructor of mozAutoDocUpdate, which eventually calls nsDocument::OnPageHide() which again tries to exit fullscreen, but finds the root has exited fullscreen.
Not sure how this is fixed in the current m-i.
I thought about replacing FullscreenRoots with FullscreenLeaves to track the leaf documents instead of roots. That could work now, but once the Fullscreen API spec is updated so that the fullscreen element is no longer necessarily in the same containing chain, maintaining the list of leaf documents could be more tricky.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1179123,10,"Created attachment 8629169
mochitest patch",UNCODED,0,UNMATCHED
1179123,11,"Hmm, my patches for bug 1160014 reintroduce this bug again. If I land the mochitest before that, I would probably have hard time then. :(",STATUS_UPDATE,0,FULL_TEXT
1179123,12,"Actually, what is the test trying to test? Making sure we don't crash here anymore? Well, 
why do we want to execute NS_NOTREACHED(""Fullscreen root should be a fullscreen doc..."");
while running mochitets?",QUESTION,0,FULL_TOKEN
1179123,13,"Comment on attachment 8629169
mochitest patch
So I don't know how we could then land this.",CODE_REVIEW,0,FULL_TEXT
1179123,14,"Comment on attachment 8629165
safeguard patch
And in fact, this feels like a valid case, so I don't see need for 
NS_NOTREACHED. Just return. With that, r+",CODE_REVIEW,0,FULL_TOKEN
1179123,15,"Comment on attachment 8629169
mochitest patch
One day I'll learn why people like Promises so much.
This took about 10x more time to read than if this hadn't been so Promise heavy ;)
I can perhaps blame myself, since I write so little JS.
rs+",CODE_REVIEW,0,FULL_TOKEN
1179123,16,"https://hg.mozilla.org/integration/mozilla-inbound/rev/aba278798298
https://hg.mozilla.org/integration/mozilla-inbound/rev/1d669992e0da",AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TOKEN
1179123,17,https://hg.mozilla.org/integration/mozilla-inbound/rev/688ccfafb3fb,UNCODED,0,UNMATCHED
1179123,18,"https://hg.mozilla.org/mozilla-central/rev/aba278798298
https://hg.mozilla.org/mozilla-central/rev/1d669992e0da
https://hg.mozilla.org/mozilla-central/rev/688ccfafb3fb",UNCODED,0,UNMATCHED
1179123,19,Is this something that you plan to uplift to 40? Tracking in 40 because regression.,QUESTION,0,FULL_TEXT
1179123,20,"Tracking in other 41, 42 as well because regression.",STATUS_UPDATE,0,FULL_TEXT
1179123,21,"Created attachment 8630195
safeguard patch for uplift, r=smaug
Approval Request Comment
[Feature/regressing bug #]: bug 947854
[User impact if declined]: may crash in some cases
[Describe test coverage new/current, TreeHerder]: test added on m-c
[Risks and why]: no risk, just a safeguard to ensure we won't crash
[String/UUID change made/needed]: n/a",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1179123,22,Sorry I forgot that...,ANSWER_TO_QUESTION,0,FULL_TEXT
1179123,23,"Comment on attachment 8630195
safeguard patch for uplift, r=smaug
Seems like a pretty safe fix for a crash and has been on m-c for a few days. Let's get this into beta3. Beta+ Aurora+",UPLIFT_APPROVAL,0,FULL_TEXT
1179123,24,https://hg.mozilla.org/releases/mozilla-aurora/rev/4d659b6e1c67,UNCODED,0,UNMATCHED
1179123,25,https://hg.mozilla.org/releases/mozilla-beta/rev/35932b9e5b6a,UNCODED,0,UNMATCHED
1823751,1,"Numerous Mac OS users reported this problem on SUMO starting March 16, 2023. As a Windows person, I cannot replicate the problem.
* https://support.mozilla.org/questions/1408246
* https://support.mozilla.org/questions/1408495
* https://support.mozilla.org/questions/1408594
* https://support.mozilla.org/questions/1408603
* https://support.mozilla.org/questions/1408612
* https://support.mozilla.org/questions/1408620
Suggestions for SUMO contributors about what to suggest or what to ask can be added in the following thread as well: 
https://support.mozilla.org/en-US/forums/contributors/716226#post-85164",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1823751,2,"Ran mozgression and found this push
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=9759c11fa52fe6ae5ddb74767fadb7f93a3464a7&tochange=330c5c6b4f5bd2ba3818e6859d1757023a5ac29a
Bug 1798548",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1823751,3,":evilpie, since you are the author of the regressor, bug 1798548, could you take a look?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#needinfo_regression_author.py).",PROBLEM_REVIEW_REQUEST,0,FULL_TOKEN
1823751,4,"I am not a mac developer what I can say is that I am very surprised that this even worked before, because from what I remember this was giving me some kind of error: https://hg.mozilla.org/integration/autoland/rev/330c5c6b4f5bd2ba3818e6859d1757023a5ac29a#l3.12
Brad do you want to take a look?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1823751,5,I'll look at this soon. Do you recall why it was necessary to change the pasteboard type from `NSString` to `NSData`? Did that make some test pass?,QUESTION,0,FULL_TOKEN
1823751,6,"I had to change this, because I got an exception in the new test that I was adding: https://phabricator.services.mozilla.com/D160944#5424063.",ANSWER_TO_QUESTION,0,FULL_TEXT
1823751,7,"Well, I can replicate and now that I know which test was the inspiring case for the change, I'm happy to take the Bug and try to keep the test passing while restoring the interactive behavior.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1823751,8,"Replicating this in a local build generates this console output:
```
Mozilla has caught an Obj-C exception [NSInvalidArgumentException: Calling -setString:forType: on NSPasteboard or NSPasteboardItem with object of type NSConcreteMutableData instead of NSString.]
```
which seems to indicate that the pasteboard will only accept `NSString` for the `""public.file-url""` key.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1823751,9,"Created attachment 9324558
Bug 1823751: Make macOS pasteboard use NSString for urls, and don't convert to NSData.
This change makes PasteboardDictFromTransferable use NSString to store the
file url in the NSDictionary, and then when converting to the native
pasteboard, check whether we should use the setString method for strings,
or the setData method for all other values. This complies with the macOS
requirement that NSString content is used for the kUTTypeFileURL key.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1823751,10,Thank you for fixing this Brad. I hope we can add this to the QA drag&drop manual tests so that we don't regress it again on any platform.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1823751,11,*** Bug 1824201 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1823751,12,"Pushed by bwerth@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/baa3ac5e605e
Make macOS pasteboard use NSString for urls, and don't convert to NSData. r=mac-reviewers,spohl",UNCODED,0,UNMATCHED
1823751,13,https://hg.mozilla.org/mozilla-central/rev/baa3ac5e605e,UNCODED,0,UNMATCHED
1823751,14,"The patch landed in nightly and beta is affected.
:bradwerth, is this bug important enough to require an uplift?
- If yes, please nominate the patch for beta approval.
- If no, please set `status-firefox112` to `wontfix`.
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#uplift_beta.py).",UNCODED,0,UNMATCHED
1823751,15,":bradwerth could you also add release uplift approval when adding beta uplift approval?
We may not have another 111 dot release, but could consider taking this if we do.",ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1823751,16,"Comment on attachment 9324558
Bug 1823751: Make macOS pasteboard use NSString for urls, and don't convert to NSData.
### Beta/Release Uplift Approval Request
* **User impact if declined**: macOS users can't drag-and-drop file URLs (bookmarks, downloads) from Firefox to desktop or to other applications.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: Download any file, open the Downloads panel and drag the icon of the downloaded file to the desktop. Expected results: icon appears on desktop.
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This partially reverts a recent change to return to longstanding pasteboard behavior which has worked correctly.
* **String changes made/needed**: 
* **Is Android affected?**: No",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1823751,17,"Comment on attachment 9324558
Bug 1823751: Make macOS pasteboard use NSString for urls, and don't convert to NSData.
Release uplift request same as comment 15.",STATUS_UPDATE,0,FULL_TEXT
1823751,18,"Comment on attachment 9324558
Bug 1823751: Make macOS pasteboard use NSString for urls, and don't convert to NSData.
Approved for 112.0b8",UPLIFT_APPROVAL,0,FULL_TEXT
1823751,19,https://hg.mozilla.org/releases/mozilla-beta/rev/9d54dc129415,UNCODED,0,UNMATCHED
1823751,20,*** Bug 1824966 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1823751,21,"Reproduced the initial issue using a Firefox 111.0.1 on a macOS 13, and also verified that using the latest Firefox Beta build 112.0b8 and latest Nightly 113.0a1 from today I now can drag drop downloaded files to the desktop without issues. 
I did noticed that the icons for the dragged files are cropped or very tiny while dragged and not dropped. Once they are dropped the correct icon is displayed for the file, will log an additional bug asap. Will leave this bug as RESOLVED for now and not move it to VERIFIED since Firefox 111 is still affected and maybe will be uplifted there as well.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1823751,22,"Comment on attachment 9324558
Bug 1823751: Make macOS pasteboard use NSString for urls, and don't convert to NSData.
There is no 111 dot release planned before 112 go-live. 
This will ride the trains with 112.",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1823751,23,"Logged Bug 1825782 as an enhancement for this.
Also closing this bug as VERIFIED since this will not land in Fx 111.",ISSUE_IMPACT,0,FULL_TEXT
1340967,1,"Created attachment 8839050
not_aligned_search_label.png
STR:
1. Set browser.storageManager.enabled to true
2. Go to about:preferences > Advanced > Network
3. Scroll to Site Data
4. Click ""Settings"" button to open the Settings dialog
Actual result:
""Search"" input label in Settings of Site Data is not vertically center-aligned. See the attached not_aligned_search_label.png.
Expected result:
""Search"" input label in Settings of Site Data is vertically center-aligned.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1340967,2,"Created attachment 8839051
aligned_search_label.png",UNCODED,0,UNMATCHED
1340967,3,"Created attachment 8839054
Bug 1340967 - Search input label in Settings of Site Data is not vertically center-aligned
Review commit: https://reviewboard.mozilla.org/r/113800/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/113800/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1340967,4,"Comment on attachment 8839054
Bug 1340967 - Search input label in Settings of Site Data is not vertically center-aligned
Gijs,
Fix to align ""Search"" input label. Please see [1], thanks.
[1] attachment 8839051: aligned_search_label.png",CODE_REVIEW_REQUEST,0,90_PCT_MATCH
1340967,5,"Comment on attachment 8839054
Bug 1340967 - Search input label in Settings of Site Data is not vertically center-aligned
https://reviewboard.mozilla.org/r/113800/#review115386
I wonder if this should use 'baseline' instead. Can you check and use either that or 'center' as makes sense? (see docs at https://developer.mozilla.org/en-US/docs/Web/CSS/box-align )",CODE_REVIEW,0,FULL_TEXT
1340967,6,"Tried 'baseline' and it turned out that the position is not centered but slightly upward shifted.
TRY: https://treeherder.mozilla.org/#/jobs?repo=try&revision=f9bf47b562e2951855bcd67943bb3dc8936f2200",CODE_IMPLEMENTATION,1,FULL_TOKEN
1340967,7,"Pushed by cbook@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/e25127db470c
Search input label in Settings of Site Data is not vertically center-aligned r=Gijs",UNCODED,0,UNMATCHED
1340967,8,https://hg.mozilla.org/mozilla-central/rev/e25127db470c,UNCODED,0,UNMATCHED
1340967,9,"I think it would be better to have the ""search"" as placeholder text like it has been done in bug 1324171.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1340967,10,"Fischer, can you check with UX and file a followup for this? Thanks.",SOLUTION_REVIEW_REQUEST,0,FULL_TEXT
1340967,11,"Mark,
It seems there is a rule for the search label of a search input box.
Could you please check, thanks.",SOLUTION_REVIEW,1,FULL_TOKEN
1340967,12,Just check with UX: Mark. The spec will be updated.,SOLUTION_REVIEW,1,FULL_TEXT
1340967,13,"I have reproduced this bug with Nightly 54.0a1 (2017-02-19) on Windows 10, 64 bit!
The Bug's fix is now verified on Latest Nightly 54.0a1
Build ID 	20170228030203
User Agent 	Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:54.0) Gecko/20100101 Firefox/54.0
[bugday-20170301]",SOLUTION_VERIFICATION,0,FULL_TOKEN
1340967,14,"Created attachment 8842466
Search_is_less_center_aligned.JPG
While verifying the fix of this bug with Latest Nightly 54.0a1 (2017-02-28) on Windows 8.1, 64 bit, I felt that the ""search"" is still less center aligned. 
I have attached a screenshot of the fix that I saw. But this doesn't resemble to the one of comment 1. Is the current fix (attached in the attachment) should be expected as the fix?",SOLUTION_VERIFICATION,0,FULL_TOKEN
1340967,15,While testing with 54.0a1 (2017-03-01) (32-bit) i see the same issue as Azmina : label is under aligned,SOLUTION_VERIFICATION,0,FULL_TEXT
1340967,16,"This is going away in bug 1343477 anyway, but I expect what you're comparing is the end of the label only, which is obviously shorter, rather than taking into account the rest of the label, with the top of the S and h. If you measure those distances, this looks centered to me (plus, if align=center didn't do its job here, that wouldn't be this bug's fault but a separate bug in XUL or Layout land).
Given all of this, going to mark this verified.",SOLUTION_REVIEW,1,FULL_TEXT
1514062,1,"There are multiple reports on reddit[0][1] of performance issues with CDM version 4.10.1196.0. This appears to be linked to multiple displays -- with current reports indicating 3 or more being problematic.
I will reach out to Widevine and provide more details here as I become aware of them.
[0]: https://www.reddit.com/r/firefox/comments/a5qsjw/netflix_on_version_64_was_making_my_machine_lag/
[1]: https://www.reddit.com/r/firefox/comments/a5xdyo/widevine_drm_causing_whole_pc_mouse_stutter/",STATUS_UPDATE,0,FULL_TEXT
1514062,2,"Failed to mention in comment #0: users are reporting that reverting to 1.4.9.1088 fixes this. If you're encountering the issue it would be also be useful to know if reverting to 4.10.1146.0 fixes it (this CDM has a Mac specific crash that shouldn't impact Windows users). To revert your CDM:
- Locate your profile directory (you can find this in about:support in the Profile Folder entry).
- In that directory there should be a `gmp-widevinecdm` dir, inside that there should be a `4.10.1196.0` directory, inside that dir there should be 5 files, a license, a manifest, and 3 widevine files. These files are the CDM.
- Download the old CDM from https://redirector.gvt1.com/edgedl/widevine-cdm/1.4.9.1088-win-x64.zip or https://redirector.gvt1.com/edgedl/widevine-cdm/4.10.1146.0-win-x64.zip
- Close Firefox.
- Backup the files in the `4.10.1196.0` directory by copying them somewhere else, we're going to want to restore them later.
- Extract the files from the `1.4.9.1088-win-x64.zip` or `4.10.1146.0-win-x64.zip` downloaded above over those in the `4.10.1196.0` directory.
- Start Firefox (with the profile we've changed the CDM for).
- Check if this fixes the issue.
- Close Firefox.
- (Optional since this appears to cause issues) Restore the old files to `4.10.1196.0` that we backed up earlier. If something goes wrong with the backup, the files can also be downloaded from https://redirector.gvt1.com/edgedl/widevine-cdm/4.10.1196.0-win-x64.zip",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1514062,3,"Can confirm that it works when reverting the CDM to 4.9.1088 or 4.10.1146.0.
I only have two monitors, but do experience the problem. (2* 1920x1080 @ 60Hz)
See attached about:support files.
(they show the netflix-1808p extension, but the problem still exists when disabling it, this has of course been my first test; also the fact that swapping CDM versions as per :bryce's post worked seemed to point to the latter as the culprit)",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1514062,4,"Created attachment 9031288
About:support from affected system (text)",UNCODED,0,UNMATCHED
1514062,5,"Created attachment 9031290
about:support from affected system (raw/json)",UNCODED,0,UNMATCHED
1514062,6,"Seems like this needs a Widevine fix and I'm not sure we'd update 64 for that. RyanVM told me we're also not serving this version so I'll mark it 'disabled' for 64,",ISSUE_METADATA_CHANGE,0,FULL_TEXT
1514062,7,"We've moved to serve the old version of the CDM on Windows (bug 1514206) while we wait to hear back from Widevine regarding this. The fallback downloader has not yet been adjusted, in hopes that the roll back is a temporary solution.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1514062,8,"Ice, we've updated to a newer version of Widevine on Windows. Can you confirm that you haven't seen this issues happen again?",VERIFICATION_REQUEST,0,FULL_TEXT
1514062,9,"The problem seems solved for me.
Just to be sure, I just did a quick test on two different VOD services that use Widevine on Firefox, and the playback is similar to Edge (EdgeHTML, which uses Microsoft's own DRM IIRC, and not Edge Chromium) in terms of quality.
I didn't encounter mouse stutter, timestamp not updating, or video stutter, as far as I can tell.
FYI, the versions are as follows :
Os : Windows 10 x64
Firefox: 70.0.1 
Widevine : 4.10.1440.19",SOLUTION_VERIFICATION,0,FULL_TOKEN
1514062,10,Thanks for confirming. It sounds like the issue is unique to Widevine 4.10.1196.0.,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1514062,11,"I'm still having stutter problem on Amazon Video Japan. Disconnecting non-primary displays and reloading the page fixes it.
My system has three displays.
OS: Windows 8.1 (build 9600)
Browser: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:80.0) Gecko/20100101 Firefox/80.0
Widevine: 4.10.1582.2
GPU: nvidia GTX950
Issue #1544108 is probably the same problem.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1093374,1,"Created attachment 8516340
tab-controls.png
See screenshot",UNCODED,0,UNMATCHED
1093374,2,It's because of the moz-appearance set here: http://dxr.mozilla.org/mozilla-central/source/browser/themes/osx/browser.css#3082,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1093374,3,"Created attachment 8516403
tabstoolbar-overflowing-tabs.patch
Another case where I'm not sure if it would be best to just use !important or to just copy the selector list from browser.css.  I went ahead and copied the list but let me know if you think there's a better way to do this.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1093374,4,"Comment on attachment 8516403
tabstoolbar-overflowing-tabs.patch
You can use !important here. The selector should be as simple as '#TabsToolbar', as I understand it. Or am I missing some case where -moz-appearance:none isn't wanted?",CODE_REVIEW,0,FULL_TEXT
1093374,5,Good point - I can't really think of a time we don't want -moz-appearance none here so I'll update the patch to use !important.,STATUS_UPDATE,0,FULL_TEXT
1093374,6,"Created attachment 8516772
tabstoolbar-overflowing-tabs.patch
This fixes the issue for me",SOLUTION_VERIFICATION,0,FULL_TEXT
1093374,7,"Comment on attachment 8516772
tabstoolbar-overflowing-tabs.patch
stealing again",CODE_REVIEW,0,FULL_TEXT
1093374,8,"Created attachment 8516783
tabstoolbar-overflowing-tabs-r=dao.patch
Thanks!  Updated commit message and pushed to fx-team: https://hg.mozilla.org/integration/fx-team/rev/de9c2a2f67eb",CODE_IMPLEMENTATION,1,FULL_TOKEN
1093374,9,https://hg.mozilla.org/mozilla-central/rev/de9c2a2f67eb,UNCODED,0,UNMATCHED
1093374,10,This looks fixed in latest gum build (https://hg.mozilla.org/projects/gum/rev/f426e446b9aa) using Mac OS X 10.9.5.,SOLUTION_VERIFICATION,0,FULL_TEXT
1093374,11,https://hg.mozilla.org/releases/mozilla-aurora/rev/1fc29c60fb1f,UNCODED,0,UNMATCHED
855335,1,"Compiling the SIPCC code with log macros expanded directly to printf() yields approximately 300 formatting-related warnings. Most of these are benign, but some could be problematic. This bug represents an audit task to examine and fix (or suppress) these warnings.",PROBLEM_DESCRIPTION,0,FULL_TEXT
855335,2,"marking s-s since we expect there will be some log messages that invoke memory errors.  Note however that any security issue would only apply if logging is turned on, which means debug builds or private builds typically, unless the module is forcing PR_LOGGING on.
Likely anything found would be sec-low or at most sec-moderate for that reason",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
855335,3,"Created attachment 734456
Format Warnings from Signaling code
Output of the format-related warnings in the signaling code of Mozilla-Central as of today - rev 7c3cb087620b",ERROR_MESSAGE,0,80_PCT_MATCH
855335,4,"Looking at this list I see a bunch that could cause crashes in the future.  
I'm going to take this bug and start with a patch that resolves the -Wformat warnings.  After that we can tackle the -Wformat-security and -Wformat-extra-args",STATUS_UPDATE,0,FULL_TOKEN
855335,5,"Excellent, thanks.
I would propose that the first step is to run debugging all the way up to 9, run a text call, and then fix the first message that causes a segfault. Repeat as necessary.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
855335,6,"Created attachment 735883
Patch for testing only. Sends logging to printf",UNCODED,0,UNMATCHED
855335,7,"Created attachment 735884
Signaling - fix Wformat warnings in logging",UNCODED,0,UNMATCHED
855335,8,"Created attachment 735936
Signaling - fix Wformat warnings in logging",UNCODED,0,UNMATCHED
855335,9,"Comment on attachment 735936
Signaling - fix Wformat warnings in logging
This should fix all of the -Wformat warnings, but not the -Wformat-extra-args or -Wformat-security ones.
You can now run with NSPR_LOG_MODULES=signaling:9 without crashing.
There is a test patch above that redefines the logging to printf if you want to check the warnings on your build.",CODE_REVIEW,0,FULL_TOKEN
855335,10,https://hg.mozilla.org/integration/mozilla-inbound/rev/146c6ca0aa6d,AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TEXT
855335,11,Assuming from comment 8 that this is leave-open for now,STATUS_UPDATE,0,FULL_TEXT
855335,12,https://hg.mozilla.org/mozilla-central/rev/146c6ca0aa6d,UNCODED,0,UNMATCHED
855335,13,reopening since this is [leave-open],STATUS_UPDATE,0,FULL_TEXT
855335,14,"Created attachment 736506
Patch 2 - Signaling fix warnings format-extra-args and format-security",UNCODED,0,UNMATCHED
855335,15,"Comment on attachment 736506
Patch 2 - Signaling fix warnings format-extra-args and format-security
Review of attachment 736506:
-----------------------------------------------------------------
This fixes all of the -Wformat-extra-args warnings and all of the -Wformat-security warnings except the ones in fsmcnf.c and fsmdef.c which are caused by the format parameter being the return of another function (get_debug_string).  I chose not to address those since that would entail getting replacing all of the get_debug_string calls with literals.
I don't think this patch fixes anything that would cause a crash, those were fixed in the first patch.",CODE_REVIEW,0,FULL_TOKEN
855335,16,https://hg.mozilla.org/integration/mozilla-inbound/rev/16b7c4a657df,UNCODED,0,UNMATCHED
855335,17,"https://hg.mozilla.org/mozilla-central/rev/16b7c4a657df
Sorry about that, don't know how I missed the [leave open].",UNCODED,0,UNMATCHED
855335,18,"BTW, you know you can get gcc to generate these warnings without such hackery, right? See the ""format"" attribute at http://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html",CLARIFICATION,0,FULL_TEXT
1142350,1,"It doesn't look like nsIUserCertPicker is used anymore, so the interface and its implementation can be removed. As far as I can tell, that's the only user of nsICertPickDialogs, so I think the interface, its implementation, and associated xul/js/l10n strings/etc. can also be removed.",PROBLEM_MOTIVATION,0,FULL_TEXT
1142350,2,"Unfortunately this might still be in use in c-c (not sure whether this code is dead or not though):
https://hg.mozilla.org/comm-central/annotate/84ac3c711098/mailnews/extensions/smime/content/am-smime.js#l271",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1142350,3,"Ah, good call. Maybe we can move it to c-c and remove it from m-c.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1142350,4,"It's not, and it is essential for configuring S/MIME signing or encryption, actually, see also https://support.mozilla.org/en-US/kb/configuration-options-certificates",CLARIFICATION,0,FULL_TEXT
1142350,5,"P2 because I intend to remove this code within a few weeks.
I will look into moving this code to c-c, but if that fails, I will just remove the code from m-c.
Alternatively, if someone working on c-c code would like to reimplement the code in a cleaner fashion (the current code suffers from basically the same issues as the client auth code as pointed out in Bug 307081), then I can wait for that work to finish first.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1142350,6,"Created attachment 8793284
Bug 1142350 - Remove nsIUserCertPicker, nsICertPickDialogs and associated code from mozilla-central.
The code is used in comm-central, but is unused in mozilla-central. It will be
imported into comm-central in Bug 1297368.
Review commit: https://reviewboard.mozilla.org/r/80070/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/80070/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1142350,7,"Comment on attachment 8793284
Bug 1142350 - Remove nsIUserCertPicker, nsICertPickDialogs and associated code from mozilla-central.
https://reviewboard.mozilla.org/r/80070/#review78916
Awesome - r=me.",CODE_REVIEW,0,FULL_TEXT
1142350,8,"Thanks!
https://treeherder.mozilla.org/#/jobs?repo=try&revision=2a7daa5338134c1e589a7ddf3ec360e6ea5850f2",UNCODED,0,UNMATCHED
1142350,9,"Pushed by ryanvm@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/75a0213cc965
Remove nsIUserCertPicker, nsICertPickDialogs and associated code from mozilla-central. r=keeler",UNCODED,0,UNMATCHED
1142350,10,https://hg.mozilla.org/mozilla-central/rev/75a0213cc965,UNCODED,0,UNMATCHED
585832,1,"Seen while running  Mozilla/5.0 (Windows; Windows NT 6.1; WOW64; rv:2.0b3) Gecko/20100805 Firefox/4.0b3. I tried in 32 bit mode and the same thing happens.
STR:
1. Enable WebGL with the about:config pref
2. Load the site in the URL, or one of the demos from http://www.ambiera.com/copperlicht/demos.html
Expected: it would work as it does using Windows XP and Vista using the same build
Actual: I get an error saying that ""This demo requires a WebGL-enabled browser""
I have seen Bug 560975 and I do not have those prefs set in about:config since I am using a new profile.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
585832,2,I tested this on my HP TouchSmart tx2 laptop which runs Windows 7 and that machine loads the sites such as https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/sdk/demos/google/particles/index.html fine. Perhaps this is hardware related?,QUESTION,0,FULL_TEXT
585832,3,What is the graphics card in the machine that can't run WebGL demos?,QUESTION,0,FULL_TEXT
585832,4,"Since 20100917 build, I have the same issue with a new profile.
I checked that webgl.enabled_for_all_site is set to true.
It seems to be linked to bug 594874 fix.
Every Intel card as been declared as ""Webgl not recommended"", so webgl is not enabled. 
Either, ""webgl not recommended"" status must not disabled webgl, or at least some recent graphic cards must have ""webgl available"" status.
Adapter Description : Mobile Intel(R) 4 Series Express Chipset Family
Vendor ID : 8086
Device ID : 2a42
Adapter RAM : Unknown
Adapter Drivers : igdumd64 igd10umd64 igdumdx32 igd10umd32
Driver Version : 8.15.10.2202
Driver Date : 8-25-2010
Direct2D Enabled : true
DirectWrite Enabled : true
GPU Accelerated Windows1/1 Direct3D 9",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
585832,5,"Created attachment 476323
relax graphics feature tests
OK, indeed our feature tests were too strict in that ""not recommended"" ended up blocking. This patch relaxes them so we only block when the feature is really blocked or not available.",CODE_IMPLEMENTATION,1,FULL_TEXT
585832,6,"Marcia: still need to know what's your graphics card! If it's Intel and doesn't have GL drivers on Windows, then your issue is a dupe of the fact that we need to use ANGLE in your case (known issue).",INFO_REQUEST,0,FULL_TEXT
585832,7,"Created attachment 476815
relax WebGL feature test
ok, let's play safe and only do this for WebGl.",CODE_IMPLEMENTATION,1,FULL_TEXT
585832,8,"Created attachment 476827
relax WebGL feature test
Regenerated the patch (line ending issue)",CODE_IMPLEMENTATION,1,FULL_TEXT
585832,9,http://hg.mozilla.org/mozilla-central/rev/901fd772c4da,UNCODED,0,UNMATCHED
1728953,1,"https://searchfox.org/mozilla-central/rev/55e8eba74b60b92d04b781f7928f54ef76b13fa9/js/xpconnect/src/nsXPConnect.cpp#927-931
```
NS_IMETHODIMP
nsXPConnect::WriteScript(nsIObjectOutputStream* stream, JSContext* cx,
                         JSScript* scriptArg) {
...
  uint8_t flags = 0;  // We don't have flags anymore.
  nsresult rv = stream->Write8(flags);
  if (NS_FAILED(rv)) {
    return rv;
  }
...
NS_IMETHODIMP
nsXPConnect::ReadScript(nsIObjectInputStream* stream, JSContext* cx,
                        const JS::ReadOnlyCompileOptions& options,
                        JSScript** scriptp) {
  uint8_t flags;
  nsresult rv = stream->Read8(&flags);
  if (NS_FAILED(rv)) {
    return rv;
  }
```
we can remove the flags byte.
NOTE: the code is going to be moved to dom/xul/nsXULElement.cpp in https://phabricator.services.mozilla.com/D121254",PROBLEM_MOTIVATION,0,FULL_TOKEN
1728953,2,"Created attachment 9242415
Bug 1728953 - Remove unused flag from nsXULPrototypeCache. r?kmag!",PROBLEM_DESCRIPTION,0,FULL_TEXT
1728953,3,"Pushed by arai_a@mac.com:
https://hg.mozilla.org/integration/autoland/rev/51e004a9b248
Remove unused flag from nsXULPrototypeCache. r=kmag",UNCODED,0,UNMATCHED
1728953,4,https://hg.mozilla.org/mozilla-central/rev/51e004a9b248,UNCODED,0,UNMATCHED
1187966,1,"Looks like GTK3 fallout?
http://people.mozilla.org/~coop/hsts_failures/central-failure-july25.log
INFO: Generating new HSTS preload list...
INFO: Running ""LD_LIBRARY_PATH=. ./xpcshell /builds/slave/m-cen-l64-periodicupdate-00000/getHSTSPreloadList.js /builds/slave/m-cen-l64-periodicupdate-00000/""
./xpcshell: error while loading shared libraries: libcairo-gobject.so.2: cannot open shared object file: No such file or directory",STACK_TRACE,0,FULL_TOKEN
1187966,2,The environment running this job obviously doesn't have gtk3 installed.,CLARIFICATION,0,FULL_TEXT
1187966,3,Thanks for the helpful reply. Any ideas who might be able to assist in getting this security process unbroken?,ASSIGNEE_REQUEST,0,FULL_TEXT
1187966,4,"Well, it's probably going to be me.",DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1187966,5,"I mucked around with this on a dev slave and managed to get it working. Since we only need xpcshell and not a fully functional browser context, I was able to download the gtk3 tarball via tooltool and then get the periodic_update script working by setting the LD_LIBRARY_PATH.
Should have a patch tomorrow, and I can always run it by hand if we need the in-tree updates sooner.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1187966,6,"Created attachment 8640779
[tools] Download gtk3 for periodic update script
xpcshell requires gtk3 now, so we download it via tooltool and then set the LD_LIBRARY_PATH.",CODE_IMPLEMENTATION,1,FULL_TEXT
1187966,7,"Created attachment 8640783
[buildbotcustom] Set the env for periodic file update jobs.
We inherit the env so we can make use of TOOLTOOL_CACHE.",CODE_IMPLEMENTATION,1,FULL_TEXT
1187966,8,"Here's the job output from these changes running in dry-run mode (-n) in staging. The script returns 2 in dry-run mode if there are updates which is why it's marked as failed.
http://dev-master2.bb.releng.use1.mozilla.com:8044/builders/Linux%20x86-64%20mozilla-central%20periodic%20file%20update/builds/0",SOLUTION_VERIFICATION,0,FULL_TEXT
1187966,9,"Comment on attachment 8640783
[buildbotcustom] Set the env for periodic file update jobs.
Review of attachment 8640783:
-----------------------------------------------------------------
https://hg.mozilla.org/build/buildbotcustom/rev/dc0535892866",CODE_REVIEW,0,FULL_TEXT
1187966,10,"Comment on attachment 8640779
[tools] Download gtk3 for periodic update script
Review of attachment 8640779:
-----------------------------------------------------------------
https://hg.mozilla.org/build/tools/rev/7a9a79f809aa",CODE_REVIEW,0,FULL_TEXT
1187966,11,In production: https://hg.mozilla.org/build/buildbotcustom/rev/dc0535892866,UNCODED,0,UNMATCHED
1187966,12,"I kicked off a build and it succeeded. Here's the treeherder job triggered by the updates:
https://treeherder.mozilla.org/#/jobs?repo=mozilla-central&revision=23e525e2ba35",SOLUTION_VERIFICATION,0,FULL_TOKEN
1809080,1,"In Nightly, pinching on the MacBook trackpad leads to zoom all the window content (pdf.js toolbar included) when it must only zooms the pages.
In using mozregression, I got:
https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=db51149fe9596f05600937729cb381b9a3ac390b&tochange=46dae1c56dade459258373ddfed526da69c68c49",PROBLEM_DESCRIPTION,0,FULL_TEXT
1809080,2,"Set release status flags based on info from the regressing bug 1781960
:cpeterson, since you are the author of the regressor, bug 1781960, could you take a look? Also, could you set the severity field?
For more information, please visit [auto_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#needinfo_regression_author.py).",QUESTION,0,FULL_TEXT
1809080,3,"Because of the mentioned patch, the getter here doesn't return the same value as before:
https://searchfox.org/mozilla-central/rev/d62c4c4d5547064487006a1506287da394b64724/toolkit/components/pdfjs/content/PdfStreamConverter.jsm#386
and consequently we don't catch the wheel events anymore:
https://github.com/mozilla/pdf.js/blob/067d3b70aa46e1b2a3dff768c36ff5ba670407f2/web/app.js#L2631-L2641
So we need have a way to guess that `ctrl+wheel` is coming from a pinch.",SOLUTION_REVIEW,1,FULL_TOKEN
1809080,4,"Created attachment 9311295
pr 15907: Fix pinch-to-zoom on a macbook trackpad (bug 1809080)",UNCODED,0,UNMATCHED
1809080,5,"Created attachment 9311569
Bug 1809080 - Pinch-to-zoom in pdf viewer when using the trackpad on Mac r=#pdfjs-reviewers,RyanVM",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1809080,6,"Comment on attachment 9311569
Bug 1809080 - Pinch-to-zoom in pdf viewer when using the trackpad on Mac r=#pdfjs-reviewers,RyanVM
### Beta/Release Uplift Approval Request
* **User impact if declined**: Mac users who are zooming a pdf in using pinch-to-zoom on a trackpad will be disappointed.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: - Open a pdf on mac
- pinch in using the trackpad
- only the pdf must be zoomed and not the toolbar
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Only few lines, easy to test and pdf.js is self-contained.
* **String changes made/needed**: 
* **Is Android affected?**: No",REQUEST_FOR_UPLIFT,0,FULL_TOKEN
1809080,7,"Comment on attachment 9311569
Bug 1809080 - Pinch-to-zoom in pdf viewer when using the trackpad on Mac r=#pdfjs-reviewers,RyanVM
Approved for 109.0rc2, thanks.",UPLIFT_APPROVAL,0,FULL_TEXT
1809080,8,https://hg.mozilla.org/releases/mozilla-release/rev/ea0c9f5c9b90,UNCODED,0,UNMATCHED
1809080,9,"Reproduced the issue with Firefox 110.0a1 (2023-01-08) on macOS 11.5. PDF toolbar is also zoomed when using pinch to zoom on a PDF.
The issue is verified fixed with Firefox 110.0a1 (2022-01-12) and Firefox 109.0RC2 (20230112150232) on macOS 10.15, 11.5, and 12. PDF toolbar is no longer zoomed in and the PDF can be successfully zoomed out when using pinch to zoom on a PDF while using a trackpad.",SOLUTION_VERIFICATION,0,FULL_TOKEN
1622369,1,"**Filed by:** apavel [at] mozilla.com
**Parsed log:** https://treeherder.mozilla.org/logviewer.html#?job_id=293080829&repo=autoland
**Full log:** https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/fBOF6Va9QAeOZf42j1TrGA/runs/0/artifacts/public/logs/live_backing.log
---
[task 2020-03-13T18:47:45.440Z] 18:47:45     INFO - TEST-START | /web-animations/timing-model/timelines/update-and-send-events-replacement.html
[task 2020-03-13T18:47:45.448Z] 18:47:45     INFO - Closing window 11
[task 2020-03-13T18:47:47.083Z] 18:47:47     INFO - 
[task 2020-03-13T18:47:47.083Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Does NOT remove an animation after making a redundant change to another animation's current time 
[task 2020-03-13T18:47:47.083Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Does NOT remove an animation after making a redundant change to its current time 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Does NOT remove an animation after making a redundant change to another animation's timeline 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Does NOT remove an animation after making a redundant change to its timeline 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Does NOT remove an animation after making a redundant change to another animation's effect's properties 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Does NOT remove an animation after making a redundant change to its effect's properties 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Updates ALL timelines before checking for replacement 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Dispatches remove events after finish events 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Fires remove event before requestAnimationFrame 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-PASS | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Queues all remove events before running them 
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-UNEXPECTED-FAIL | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | Performs removal in deeply nested iframes - assert_equals: expected ""removed"" but got ""active""
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - @http://web-platform.test:8000/web-animations/timing-model/timelines/update-and-send-events-replacement.html:1013:16
[task 2020-03-13T18:47:47.084Z] 18:47:47     INFO - TEST-INFO | expected TIMEOUT
[task 2020-03-13T18:47:47.441Z] 18:47:47     INFO - TEST-UNEXPECTED-OK | /web-animations/timing-model/timelines/update-and-send-events-replacement.html | expected TIMEOUT
[task 2020-03-13T18:47:47.441Z] 18:47:47     INFO - TEST-INFO expected TIMEOUT | took 1998ms
[task 2020-03-13T18:47:48.376Z] 18:47:48     INFO - Closing logging queue
[task 2020-03-13T18:47:48.376Z] 18:47:48     INFO - queue closed
[task 2020-03-13T18:47:48.392Z] 18:47:48     INFO - Setting up ssl
[task 2020-03-13T18:47:48.473Z] 18:47:48     INFO - certutil | 
[task 2020-03-13T18:47:48.568Z] 18:47:48     INFO - certutil | 
[task 2020-03-13T18:47:48.584Z] 18:47:48     INFO - certutil | 
[task 2020-03-13T18:47:48.584Z] 18:47:48     INFO - Certificate Nickname                                         Trust Attributes
[task 2020-03-13T18:47:48.584Z] 18:47:48     INFO -                                                              SSL,S/MIME,JAR/XPI
[task 2020-03-13T18:47:48.584Z] 18:47:48     INFO - 
[task 2020-03-13T18:47:48.584Z] 18:47:48     INFO - web-platform-tests                                           CT,, 
[task 2020-03-13T18:47:48.584Z] 18:47:48     INFO - 
[task 2020-03-13T18:47:51.480Z] 18:47:51     INFO - adb Granting important runtime permissions to org.mozilla.geckoview.test
[task 2020-03-13T18:47:52.871Z] 18:47:52     INFO - adb launch_application: am start -W -n org.mozilla.geckoview.test/org.mozilla.geckoview.test.TestRunnerActivity -a android.intent.action.MAIN --es env9 MOZ_DISABLE_NONLOCAL_CONNECTIONS=1 --es env8 R_LOG_DESTINATION=stderr --es args ""-no-remote -profile /sdcard/tests/profile --marionette about:blank"" --es env3 MOZ_HIDE_RESULTS_TABLE=1 --es env2 R_LOG_VERBOSE=1 --es env1 MOZ_WEBRENDER=0 --es env0 MOZ_CRASHREPORTER=1 --es env7 MOZ_CRASHREPORTER_SHUTDOWN=1 --es env6 MOZ_IN_AUTOMATION=1 --es env5 MOZ_LOG=signaling:3,mtransport:4,DataChannel:4,jsep:4 --es env4 STYLO_THREADS=1 --ez use_multiprocess True --es env12 R_LOG_LEVEL=6 --es env11 MOZ_PROCESS_LOG=/tmp/tmpvix8Fspidlog --es env10 MOZ_CRASHREPORTER_NO_REPORT=1
[task 2020-03-13T18:47:54.684Z] 18:47:54     INFO - Starting runner",PROBLEM_DESCRIPTION,0,90_PCT_MATCH
1622369,2,"Retriggered:
https://treeherder.mozilla.org/#/jobs?repo=autoland&searchStr=android%2C7.0%2Cx86-64%2Copt%2Cweb%2Cplatform%2Ctests%2Ctest-android-em-7.0-x86_64%2Fopt-geckoview-web-platform-tests-e10s-12%2Cw%28wpt12%29&tochange=8ef0a54d7715018ad09e5b6b53d3321252422e44&fromchange=ff66e60f8eea539594b1dee5e333b983a18ef742
Looks like it stated from the wpt sync push.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1622369,3,"14 failures in 5336 pushes (0.003 failures/push) were associated with this bug in the last 7 days.
Repository breakdown:
* autoland: 6
* mozilla-central: 7
* try: 1
Platform breakdown:
* android-em-7-0-x86_64: 7
* linux1804-64-shippable-qr: 2
* windows10-64-shippable-qr: 2
* windows10-64-qr: 2
* linux1804-64-qr: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1622369&startday=2020-03-09&endday=2020-03-15&tree=all",UNCODED,0,UNMATCHED
1622369,4,Brian: is this something you hae time to investigate?,PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1622369,5,"Looks link the Chrome team updated that test to a ""mechanism ... that is well behaved across browsers"" ;)
https://hg.mozilla.org/mozilla-central/rev/1f66d281b8ce3b572f364f86102f3c132ec64c8d
I'm afraid I won't have time to look at this. Maybe Boris can?
(All my Gecko and spec work is volunteer-based and I currently have quite a pile of spec reviews and other Gecko work unfortunately.)",PROBLEM_REVIEW,0,FULL_TOKEN
1622369,6,"22 failures in 920 pushes (0.024 failures/push) were associated with this bug yesterday.
Repository breakdown:
* autoland: 17
* mozilla-central: 4
* try: 1
Platform breakdown:
* android-em-7-0-x86_64: 18
* windows10-64-qr: 1
* linux1804-64-shippable-qr: 2
* windows10-64-shippable-qr: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1622369&startday=2020-03-16&endday=2020-03-16&tree=all",UNCODED,0,UNMATCHED
1622369,7,I keep the ni for now until I finish my current work (Bug 1621007). Will check this bug later.,STATUS_UPDATE,0,FULL_TEXT
1622369,8,"18 failures in 966 pushes (0.019 failures/push) were associated with this bug yesterday.
Repository breakdown:
* try: 3
* autoland: 10
* mozilla-central: 5
Platform breakdown:
* linux1804-64-qr: 2
* android-em-7-0-x86_64: 10
* windows10-64-qr: 4
* linux1804-64-shippable-qr: 1
* windows10-64-shippable-qr: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1622369&startday=2020-03-17&endday=2020-03-17&tree=all",UNCODED,0,UNMATCHED
1622369,9,"45 failures in 4955 pushes (0.009 failures/push) were associated with this bug in the last 7 days.
This is the #31 most frequent failure this week.
** This failure happened more than 30 times this week! Resolving this bug is a high priority. **
** Try to resolve this bug as soon as possible. If unresolved for 2 weeks, the affected test(s) may be disabled. ** 
Repository breakdown:
* autoland: 29
* mozilla-central: 11
* try: 5
Platform breakdown:
* android-em-7-0-x86_64: 28
* windows10-64-qr: 8
* linux1804-64-shippable-qr: 3
* windows10-64-shippable-qr: 2
* linux1804-64-qr: 2
* linux1804-64-shippable: 1
* macosx1014-64-shippable: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1622369&startday=2020-03-16&endday=2020-03-22&tree=all",UNCODED,0,UNMATCHED
1622369,10,Failures here started decreasing since the 18th of March.,ADDITIONAL_CONSIDERATION,0,FULL_TEXT
1622369,11,"Various wpt-syncbot pushes have tweaked the annotations for this test. I don't think there have been any behavioral changes in Gecko itself.
https://hg.mozilla.org/mozilla-central/rev/9ee1a15632f89853a5ab28ef60566f5508c62783#l47.24
https://hg.mozilla.org/mozilla-central/rev/bce0bdab8c42f018c13f4d071dc03cf713d14847#l101.23
https://hg.mozilla.org/mozilla-central/rev/bbb78f71a5de9849f6697da61a062f59ec960f97#l108.23",PROBLEM_REVIEW,0,FULL_TOKEN
1622369,12,"In fact, as a result we now have unexpected passes too: bug 1625015",PROBLEM_REVIEW,0,FULL_TEXT
1622369,13,"Just notice ""Performs removal in deeply nested iframes"" is easy to be reproduced on mac, becase of time-out or failed on my local build.",REPRODUCTION_ATTEMPT,0,FULL_TEXT
1622369,14,"Created attachment 9136102
Bug 1622369 - Await the async function to make sure any async steps inside the function will be blocked.
It's easy to get time out on mac if we await the promise inside
insertFrameAndAwaitLoad(), so move it out and let's see if there is
still timeout or intermittent.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1622369,15,"Pushed by bchiou@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/254999e1d761
Await the async function to make sure any async steps inside the function will be blocked. r=birtles",UNCODED,0,UNMATCHED
1622369,16,Created web-platform-tests PR https://github.com/web-platform-tests/wpt/pull/22502 for changes under testing/web-platform/tests,UNCODED,0,UNMATCHED
1622369,17,https://hg.mozilla.org/mozilla-central/rev/254999e1d761,UNCODED,0,UNMATCHED
1622369,18,"Can't merge web-platform-tests PR due to failing upstream checks:
Github PR https://github.com/web-platform-tests/wpt/pull/22502
* Community-TC (pull_request) (https://community-tc.services.mozilla.com/tasks/groups/JLR2aBL_RI25gvsSU3HWiA)",UNCODED,0,UNMATCHED
1622369,19,"3 failures in 4773 pushes (0.001 failures/push) were associated with this bug in the last 7 days.
Repository breakdown:
* try: 3
Platform breakdown:
* linux1804-64-asan: 1
* windows10-64-qr: 1
* linux1804-64-qr: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures.html#/bugdetails?bug=1622369&startday=2020-03-23&endday=2020-03-29&tree=all",UNCODED,0,UNMATCHED
1622369,20,Upstream PR merged by stephenmcgruer,UNCODED,0,UNMATCHED
1622369,21,*** Bug 1625015 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1753765,1,"Replace the %includes with either @import or by inlining the included stylesheets. See bug 1659584 for details. This bug should cover:
* browser/themes/{platform}/customizableui/panelUI.css
  * browser/themes/shared/customizableui/panelUI.inc.css",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1753765,2,"Created attachment 9265525
Bug 1753765 - Remove preprocessor includes from Customizeable PanelUI r=Dao!
- Replaced preprocessor includes with CSS imports
- Removed .inc from CSS files names where all preprocessor code was removed.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1753765,3,"Pushed by bigiri@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/c83c8662c973
Remove preprocessor includes from Customizeable PanelUI r=dao",UNCODED,0,UNMATCHED
1753765,4,"Backed out changeset c83c8662c973 (Bug 1753765) for causing bc failures on browser_parsable_css.js.
[Backout link](https://hg.mozilla.org/integration/autoland/rev/14aabd37675e47901d07eb5302eb58bd1e615437)
[Push with failures](https://treeherder.mozilla.org/jobs?repo=autoland&searchStr=os%2Cx%2C10.15%2Cwebrender%2Copt%2Cmochitests%2Cwith%2Cnetworking%2Con%2Csocket%2Cprocess%2Cwith%2Cfission%2Cenabled%2Ctest-macosx1015-64-qr%2Fopt-mochitest-browser-chrome-spi-nw-fis-e10s%2Cbc7&group_state=expanded&fromchange=7db1f6191571217201f78e5423c71989d47d2e08&selectedTaskRun=dNOFcG-6Tze-lJac4hqwJg.0&tochange=14aabd37675e47901d07eb5302eb58bd1e615437)
[Failure Log](https://treeherder.mozilla.org/logviewer?job_id=369469081&repo=autoland&lineNumber=2198)",IMPLEMENTATION_REVERSION,0,90_PCT_MATCH
1753765,5,"This is flagging up conditionals in `panelUI.inc.css`. You could either fix that here or just add a `*` to the `jar.mn` entry for the `panelUI.inc.css` file in the shared `jar.mn`, so that it gets preprocessed and the conditions in there continue to work.",COLLATERAL_POTENTIAL_SOLUTION,0,FULL_TOKEN
1753765,6,The updated patch including @Gijs' suggestion should resolve this error.,STATUS_UPDATE,0,FULL_TEXT
1753765,7,"Pushed by bigiri@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/a6d7a4d3a374
Remove preprocessor includes from Customizeable PanelUI r=dao",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1753765,8,https://hg.mozilla.org/mozilla-central/rev/a6d7a4d3a374,UNCODED,0,UNMATCHED
1647930,1,"We should add prefs to control the new one-off/tab-to-search behaviour we're adding to the Urlbar in bug 1647886 and bug 1647921. 
UX considers these features to be a part of ""Urlbar update 2"" as opposed to the ""megabar"" design update, which was update 1. The pref names should reflect that.",PROBLEM_MOTIVATION,0,FULL_TEXT
1647930,2,"We should also decide what to do with update2.expandTextOnFocus, to avoid confusion. I'd be prone to rename it to browser.urlbar.experimental.expandTextOnFocus and hide it. I've seen various cases of people mis-switching it on and then complaining the text was moving.",REQUIREMENT,0,FULL_TEXT
1647930,3,"Created attachment 9163246
Bug 1647930 - Create urlbar.update2 prefs. r?adw",UNCODED,0,UNMATCHED
1647930,4,"Pushed by htwyford@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/3c4b72b9610d
Create urlbar.update2 prefs. r=adw",UNCODED,0,UNMATCHED
1647930,5,https://hg.mozilla.org/mozilla-central/rev/3c4b72b9610d,UNCODED,0,UNMATCHED
1647930,6,"I verified this issue using 82.0a1 (2020-09-14) on macOS 10.13 and Windows 10 x64.
Adrian could you help me with Ubuntu verification?",VERIFICATION_REQUEST,0,FULL_TEXT
1647930,7,"Verified on Ubuntu 18.04 64-bit, the update2 prefs are disabled on non-Nightly builds.",SOLUTION_VERIFICATION,0,FULL_TEXT
869069,2,"Created attachment 745940
Patch v1",UNCODED,0,UNMATCHED
869069,3,"Comment on attachment 745940
Patch v1
How's my driving?",CODE_REVIEW,0,FULL_TEXT
869069,4,"Does this also cover removing the dupe widgets (cut/copy/paste, Zoom) and the ""activity"" indicator ?",QUESTION,0,FULL_TEXT
869069,5,"I only meant to remove the obviously dummy widgets in this patch (the demo widgets that don't really do anything), and make the default set in the panel more or less work as expected.
For Cut/Copy/Paste, we still need to de-dupe those, and nobody has started on that yet. I think we should leave them for now. For the activity throbber... maybe we could remove that at the same time as the old cut/copy/paste buttons. A general clean-out. :)",ANSWER_TO_QUESTION,0,FULL_TOKEN
869069,6,"Comment on attachment 745940
Patch v1
Review of attachment 745940:
-----------------------------------------------------------------
Siri, please call 1-800-SAF-DRVR.
** Calling 1-800-SAF-DRVR **
""Hello, welcome to the safe driver hotline. How can I help you?""
I'd like to report that :mconley is a safe driver. That is all.
""Thank you, have a nice day""
r=me",CODE_REVIEW,0,FULL_TOKEN
869069,7,"Woo! Thanks for the quick turnaround time!
https://hg.mozilla.org/projects/jamun/rev/8791cdcd0758
\o/",CODE_IMPLEMENTATION,1,FULL_TOKEN
869069,8,https://hg.mozilla.org/mozilla-central/rev/8791cdcd0758,UNCODED,0,UNMATCHED
852135,2,"Created attachment 729437
Patch v1",UNCODED,0,UNMATCHED
852135,3,"Created attachment 732225
Patch v1.1",UNCODED,0,UNMATCHED
852135,4,*** Bug 858606 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
852135,5,"Created attachment 734285
Patch v1.2",UNCODED,0,UNMATCHED
852135,6,"Comment on attachment 734285
Patch v1.2
Going to wait until Attr lands.",STATUS_UPDATE,0,FULL_TEXT
852135,7,"Created attachment 737234
Part a: Reindent some code in nsDOMAttributeMap",CODE_REVIEW,0,FULL_TEXT
852135,8,"Created attachment 737235
Part a -w",UNCODED,0,UNMATCHED
852135,9,"Created attachment 737236
Part b: Get rid of some explicit namespace qualifications",CODE_REVIEW,0,FULL_TEXT
852135,10,"Created attachment 737238
Part c: Implement the remainder of the WebIDL API",CODE_REVIEW,0,FULL_TEXT
852135,11,"Created attachment 737239
Part d: Move to WebIDL bindings, remove CI and QS",UNCODED,0,UNMATCHED
852135,12,"Comment on attachment 737234
Part a: Reindent some code in nsDOMAttributeMap
r=me",UNCODED,0,UNMATCHED
852135,13,"Comment on attachment 737236
Part b: Get rid of some explicit namespace qualifications
r=me",UNCODED,0,UNMATCHED
852135,14,"Comment on attachment 737238
Part c: Implement the remainder of the WebIDL API
r=me",UNCODED,0,UNMATCHED
852135,15,"Comment on attachment 737239
Part d: Move to WebIDL bindings, remove CI and QS
WrapObject takes a handle for the scope now.
r=me with that",CODE_REVIEW,0,FULL_TOKEN
852135,16,"https://hg.mozilla.org/mozilla-central/rev/0fa3623e2a71
https://hg.mozilla.org/mozilla-central/rev/61e10c9a711f
https://hg.mozilla.org/mozilla-central/rev/e0b3fa32b67a
https://hg.mozilla.org/mozilla-central/rev/12e5adcc5511",AUTO_LINK_CODE_IMPLEMENTATION,0,FULL_TOKEN
1347860,1,"Filed by: cbook [at] mozilla.com
https://treeherder.mozilla.org/logviewer.html#?job_id=84231756&repo=mozilla-inbound
https://archive.mozilla.org/pub/firefox/tinderbox-builds/mozilla-inbound-macosx64-debug/mozilla-inbound_yosemite_r7-debug_test-mochitest-gl-e10s-1-bm107-tests1-macosx-build124.txt.gz",UNCODED,0,UNMATCHED
1347860,2,"Sotaro: could you take a look at this ? Thanks
PROCESS-CRASH | dom/canvas/test/webgl-conf/generated/test_2_conformance2__textures__video__tex-3d-r16f-red-half_float.html | application crashed [@ mozilla::layers::ImageLayerComposite::~ImageLayerComposite()]
01:49:54     INFO - Crash dump filename: /var/folders/fh/gqfg3vms4y13dn0t_fnkbgy000000w/T/tmp6S7rgG.mozrunner/minidumps/0EC1F0EC-825A-4371-AD37-EA8E40CED589.dmp
01:49:54     INFO - Operating system: Mac OS X
01:49:54     INFO -                   10.10.5 14F27
01:49:54     INFO - CPU: amd64
01:49:54     INFO -      family 6 model 69 stepping 1
01:49:54     INFO -      4 CPUs
01:49:54     INFO - 
01:49:54     INFO - GPU: UNKNOWN
01:49:54     INFO - 
01:49:54     INFO - Crash reason:  EXC_BAD_ACCESS / KERN_INVALID_ADDRESS
01:49:54     INFO - Crash address: 0x0
01:49:54     INFO - Process uptime: 1050 seconds
01:49:54     INFO - 
01:49:54     INFO - Thread 20 (crashed)
01:49:54     INFO -  0  XUL!mozilla::layers::ImageLayerComposite::~ImageLayerComposite() [ImageLayerComposite.cpp:109855be8ccb : 44 + 0x0]
01:49:54     INFO -     rax = 0x0000000000000000   rdx = 0x00007fff7d8c81f8
01:49:54     INFO -     rcx = 0x0000000000000000   rbx = 0x000000011cbbcc00
01:49:54     INFO -     rsi = 0x0000d3000000d300   rdi = 0x0000d2000000d303
01:49:54     INFO -     rbp = 0x0000000122d837e0   rsp = 0x0000000122d837c0
01:49:54     INFO -      r8 = 0x0000000122d83770    r9 = 0x0000000122d84000
01:49:54     INFO -     r10 = 0x00007fff94f353ef   r11 = 0x00007fff94f353c0
01:49:54     INFO -     r12 = 0x0000000000000001   r13 = 0x0000000000000001
01:49:54     INFO -     r14 = 0x000000011ef6a970   r15 = 0x0000000000000008
01:49:54     INFO -     rip = 0x00000001107f0f7e
01:49:54     INFO -     Found by: given as instruction pointer in context
01:49:54     INFO -  1  XUL!<name omitted> [ImageLayerComposite.cpp:109855be8ccb : 42 + 0x5]
01:49:54     INFO -     rbx = 0x000000011cbbcc00   rbp = 0x0000000122d83800
01:49:54     INFO -     rsp = 0x0000000122d837f0   r12 = 0x0000000000000001
01:49:54     INFO -     r13 = 0x0000000000000001   r14 = 0x000000011ef6a970
01:49:54     INFO -     r15 = 0x0000000000000008   rip = 0x00000001107f0ffe
01:49:54     INFO -     Found by: call frame info
01:49:54     INFO -  2  XUL!mozilla::layers::Layer::Release() [Layers.h:109855be8ccb : 785 + 0xc]
01:49:54     INFO -     rbx = 0x000000011cbbcc00   rbp = 0x0000000122d83820
01:49:54     INFO -     rsp = 0x0000000122d83810   r12 = 0x0000000000000001
01:49:54     INFO -     r13 = 0x0000000000000001   r14 = 0x000000011ef6a970
01:49:54     INFO -     r15 = 0x0000000000000008   rip = 0x0000000110728445
01:49:54     INFO -     Found by: call frame info
01:49:54     INFO -  3  XUL!mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) [Layers.cpp:109855be8ccb : 1029 + 0x8]
01:49:54     INFO -     rbx = 0x000000011cbbcc00   rbp = 0x0000000122d83840
01:49:54     INFO -     rsp = 0x0000000122d83830   r12 = 0x0000000000000001
01:49:54     INFO -     r13 = 0x0000000000000001   r14 = 0x000000011ef6a970
01:49:54     INFO -     r15 = 0x0000000000000008   rip = 0x00000001107306af
01:49:54     INFO -     Found by: call frame info
01:49:54     INFO -  4  XUL!mozilla::layers::ContainerLayerComposite::~ContainerLayerComposite() [ContainerLayerComposite.cpp:109855be8ccb : 679 + 0xc]
01:49:54     INFO -     rbx = 0x000000011b6e8400   rbp = 0x0000000122d83860
01:49:54     INFO -     rsp = 0x0000000122d83850   r12 = 0x0000000000000001
01:49:54     INFO -     r13 = 0x0000000000000001   r14 = 0x000000011ef6a970
01:49:54     INFO -     r15 = 0x0000000000000008   rip = 0x00000001107e70ac
01:49:54     INFO -     Found by: call frame info
01:49:54     INFO -  5  XUL!mozilla::layers::Layer::Release() [Layers.h:109855be8ccb : 785 + 0xc]
01:49:54     INFO -     rbx = 0x000000011b6e8400   rbp = 0x0000000122d83880
01:49:54     INFO -     rsp = 0x0000000122d83870   r12 = 0x0000000000000001
01:49:54     INFO -     r13 = 0x0000000000000001   r14 = 0x000000011ef6a970
01:49:54     INFO -     r15 = 0x0000000000000008   rip = 0x0000000110728445
01:49:54     INFO -     Found by: call frame info
01:49:54     INFO -  6  XUL!mozilla::layers::ContainerLayer::RemoveChild(mozilla::layers::Layer*) [Layers.cpp:109855be8ccb : 1029 + 0x8]",STACK_TRACE,0,FULL_TOKEN
1347860,3,"From the source, returned pointer of HTMLMediaElement::GetCurrentImage() seems not safe.
  https://dxr.mozilla.org/mozilla-central/source/dom/html/HTMLMediaElement.cpp#1531",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1347860,4,It seems like a regression of Bug 1345403.,PROBLEM_REVIEW,0,FULL_TEXT
1347860,5,":kaku, can you take a look?",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1347860,6,Image is locked only within GetCurrentImage().,PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1347860,7,It might be better to return already_AddRefed<>.,POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1347860,8,"Bug 1347836 handled this issue and has already landed into m-c few hours ago, let's seek if Bug 1347836 solves this crash.",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1347860,9,"10 failures in 777 pushes (0.013 failures/push) were associated with this bug in the last 7 days.   
Repository breakdown:
* autoland: 6
* try: 2
* mozilla-inbound: 2
Platform breakdown:
* osx-10-10: 10
For more details, see:
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1347860&startday=2017-03-13&endday=2017-03-19&tree=all",UNCODED,0,UNMATCHED
1347860,10,"This does not happen for 1 week. 
https://brasstacks.mozilla.com/orangefactor/?display=Bug&bugid=1347860&startday=2017-03-13&endday=2017-03-24&tree=all
Bug 1347836 should already fix this bug.",SOLUTION_VERIFICATION,0,FULL_TOKEN
686900,1,"Object and Function initialization are intricately intertwined.  To initialize Object, you need Function to be initialized for the function properties on Object.prototype and Object.  But to initialize Function, you need Object.prototype for Function.prototype's [[Prototype]]!  Since the two are so intricately interdependent, their bootstrapping should be one-off and not use functionality that thinks that these things have already been bootstrapped -- they should do it from scratch.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
686900,2,"Created attachment 560385
1 - Move js_InitObjectClass to GlobalObject code
All this stuff will live in vm/GlobalObject.cpp, so first I'm moving the sub-bits of this to there.",CODE_IMPLEMENTATION,1,FULL_TEXT
686900,3,"Created attachment 560386
2 - Move js_InitFunctionClass to GlobalObject code",UNCODED,0,UNMATCHED
686900,4,"Created attachment 560387
3 - Rewrite js_InitFunctionAndObjectClasses
The pice de rsistance!  The sine qua non!  The cliched concluding phrase!",UNCODED,0,UNMATCHED
686900,5,"Or: ""Object initialization shouldn't involve a fixed-point computation"" :)",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
686900,6,"Comment on attachment 560387
3 - Rewrite js_InitFunctionAndObjectClasses
Looks great. The new code is a little longer but the strange loops in the old code were far from obvious. I don't suppose we can rip out the protection around resolve hooks now, can we?",CODE_REVIEW,0,FULL_TEXT
686900,7,Filed bug 687113 for simplifying that stuff. Someone take it--it's a nice opportunity to improve behavior and delete code at the same time!,NEW_ISSUE_FILING,0,FULL_TEXT
686900,8,"https://hg.mozilla.org/integration/mozilla-inbound/rev/2778cb07c697
https://hg.mozilla.org/integration/mozilla-inbound/rev/ae99d33a2290
https://hg.mozilla.org/integration/mozilla-inbound/rev/be380e98f383",UNCODED,0,UNMATCHED
686900,9,"https://hg.mozilla.org/mozilla-central/rev/2778cb07c697
https://hg.mozilla.org/mozilla-central/rev/ae99d33a2290
https://hg.mozilla.org/mozilla-central/rev/be380e98f383",UNCODED,0,UNMATCHED
1670911,1,"Created attachment 9181260
StrictVSStandard.png
**Environment:**
Browser / Version: Firefox Nightly 83.0a1 (2020-10-12)
Operating System: Windows 10 Pro
**Steps to reproduce:**
1. Navigate to https://ifttt.com/join
2. Click ""Continue with Facebook"" button.
3. Observe behavior.
**Expected result:**
Facebook login page is triggered.
**Actual result:**
Nothing happens, Facebook login page is not triggered.
**Note: **
1. With ETP - Standard login with Facebook works.",S2R,0,90_PCT_MATCH
1670911,2,This breakage can be fixed by adding `connect.facebook.net` to `urlclassifier.features.socialtracking.skipURLs` and `urlclassifier.trackingSkipURLs`,POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1670911,3,"The issue still occurs, with ETP - Strict, Facebook login page is not triggered.
**Tested with:**
Browser / Version: Firefox Nightly 210221 ( 87.0a1-20210218092411)
Operating System: Samsung Galaxy S8 (Android 9) - 1440 x 2960 pixels, 18.5:9 ratio (~570 ppi density)",REPRODUCTION_ATTEMPT,0,FULL_TOKEN
1670911,4,Fixed by our Facebook login shim (riding the release trains on desktop Firefox as of bug 1703829).,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1486074,1,"In my try run [1] to enable ""layout.css.column-span.enabled"", I notice the following error.
TEST-UNEXPECTED-FAIL | layout/style/test/test_ch_ex_no_infloops.html | uncaught exception - TypeError: value_list is undefined at test_replaced_values@http://mochi.test:8888/tests/layout/style/test/test_ch_ex_no_infloops.html:40:21
It turns out -moz-column-span are defined _after_ the logic that processes the alias properties. 
[1] https://treeherder.mozilla.org/#/jobs?repo=try&revision=077243bccedb472c81457a7710724e52065dc5d5&selectedJob=195621048
[2] https://searchfox.org/mozilla-central/rev/c45b9755593ce6cc91f558b21e544f5165752de7/layout/style/test/property_database.js#7952-7996",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1486074,2,"Created attachment 9003861
Bug 1486074 - Move logic for copying aliased properties' fields to the bottom of property_database.js.",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1486074,3,"Comment on attachment 9003861
Bug 1486074 - Move logic for copying aliased properties' fields to the bottom of property_database.js.
Emilio Cobos lvarez (:emilio) has approved the revision.",CODE_REVIEW,0,FULL_TOKEN
1486074,4,"Pushed by aethanyc@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/d8b05de1fa30
Move logic for copying aliased properties' fields to the bottom of property_database.js. r=emilio",UNCODED,0,UNMATCHED
1486074,5,https://hg.mozilla.org/mozilla-central/rev/d8b05de1fa30,UNCODED,0,UNMATCHED
1685379,1,"Created attachment 9195716
Screenshot",UNCODED,0,UNMATCHED
1685379,2,Set release status flags based on info from the regressing bug 1680531,UNCODED,0,UNMATCHED
1685379,3,Can y'all prioritize this? Thx!,QUESTION,0,FULL_TEXT
1685379,4,"Erica, do you have plans wrt to this bug for 86? Thanks",QUESTION,0,FULL_TEXT
1685379,5,This was fixed by Bug 1686384,SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1685379,6,Marking firefox86 as fixed based on [comment 4](https://bugzilla.mozilla.org/show_bug.cgi?id=1685379#c4).,ISSUE_METADATA_CHANGE,0,FULL_TOKEN
1685379,7,Marking this as Resolved based on [Robert's comment from bug 1686384](https://bugzilla.mozilla.org/show_bug.cgi?id=1686384#c4).,SOLUTION_VERIFICATION,0,FULL_TOKEN
713597,1,"Created attachment 584371
testcase
The first assertion is like in bug 698340, but the other issues are new.
###!!! ASSERTION: Unnecessary MakeFullScreen call: 'mFullScreen != aFullScreen', file widget/src/cocoa/nsCocoaWindow.mm, line 1163
###!!! ASSERTION: Full-screen element should be the requested element!: 'GetFullScreenElement() == aElement', file content/base/src/nsDocument.cpp, line 8921
###!!! ASSERTION: Should be full-screen doc: 'IsFullScreenDoc()', file content/base/src/nsDocument.cpp, line 8922
Null deref crash [@ nsDocument::RequestFullScreen], but only in debug builds?",TEST_CASES,0,95_PCT_MATCH_PROCESSED
713597,2,"Created attachment 584372
stack traces",UNCODED,0,UNMATCHED
713597,3,"This crash only occurs in debug builds. In nsDocument::RequestFullScreen My assertions need to be before the call to SetWindowFullScreen(), as that can run script which cancels full-screen, invalidating the assertions.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
713597,4,"Created attachment 585967
Patch - move assertions",UNCODED,0,UNMATCHED
713597,5,https://hg.mozilla.org/integration/mozilla-inbound/rev/f6928624a1ce,UNCODED,0,UNMATCHED
713597,6,https://hg.mozilla.org/mozilla-central/rev/f6928624a1ce,UNCODED,0,UNMATCHED
1516605,1,"LibPNG has NEON support using intrinsics, not assembler, so we should use it.
(MSVC support is already in upstream, but it isn't in stable version)",PROBLEM_MOTIVATION,0,FULL_TOKEN
1516605,2,"Created attachment 9033510
Bug 1516605 - Turn on NEON on aarch64 when using gcc or clang. r?aosmond
libpng has NEON support using intrinsics, not assembler, so we should use it
even if aarch64.
MSVC build still turns off NEON since libpng doesn't support it on stable
version although upstream has it.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1516605,3,"Pushed by m_kato@ga2.so-net.ne.jp:
https://hg.mozilla.org/integration/autoland/rev/129f8c60783c
Turn on NEON on aarch64 when using gcc or clang. r=aosmond",UNCODED,0,UNMATCHED
1516605,4,"Oh, I actually already did this in the libpng 1.6.36 update bug (bug 1513236)...",SOLVED_BY_OTHER_ISSUE,0,FULL_TEXT
1516605,5,https://hg.mozilla.org/mozilla-central/rev/129f8c60783c,UNCODED,0,UNMATCHED
1571124,1,"The JSScript::dataSize_ field provides little value and we should be able to remove it. Currently it computes the size of the PrivateScriptData / JSScript::data_ structure. With the current simplified format of PrivateScriptData, we can quickly compute the size on demand.
1) Add a PrivateScriptData::allocationSize() public method (similar to LazyScriptData::allocationSize())
2) Update the definition of JSScript::computedSizeOfData() to use this
3) Remove JSScript::dataSize_ / dataSize()",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1571124,2,"Created attachment 9084216
Bug 1571124: Calculate the data size of a JSScript dynamically.",UNCODED,0,UNMATCHED
1571124,3,"Pushed by archaeopteryx@coole-files.de:
https://hg.mozilla.org/integration/autoland/rev/9e3f6c988710
Calculate the data size of a JSScript dynamically. r=tcampbell",UNCODED,0,UNMATCHED
1571124,4,https://hg.mozilla.org/mozilla-central/rev/9e3f6c988710,UNCODED,0,UNMATCHED
1571124,5,"== Change summary for alert #22427 (as of Tue, 13 Aug 2019 06:27:55 GMT) ==
Improvements:
0.25%  Base Content JS windows7-32-shippable opt      3,249,493.33 -> 3,241,301.33
0.25%  Base Content JS windows7-32-shippable opt      3,249,509.33 -> 3,241,269.33
For up to date results, see: https://treeherder.mozilla.org/perf.html#/alerts?id=22427",UNCODED,0,UNMATCHED
1821213,1,"**Filed by:** abutkovits [at] mozilla.com
**Parsed log:** https://treeherder.mozilla.org/logviewer?job_id=408328494&repo=autoland
**Full log:** https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/eeU5GmAvSpKZrhH-Xfe1Vg/runs/0/artifacts/public/logs/live_backing.log
**Reftest URL:** https://hg.mozilla.org/mozilla-central/raw-file/tip/layout/tools/reftest/reftest-analyzer.xhtml#logurl=https://firefox-ci-tc.services.mozilla.com/api/queue/v1/task/eeU5GmAvSpKZrhH-Xfe1Vg/runs/0/artifacts/public/logs/live_backing.log&only_show_unexpected=1
---
```
[task 2023-03-08T22:00:54.184Z] 22:00:54     INFO - [Child 1373, Main Thread] WARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80520012 (NS_ERROR_FILE_NOT_FOUND): file /builds/worker/checkouts/gecko/layout/style/Loader.cpp:2085
[task 2023-03-08T22:00:54.199Z] 22:00:54     INFO - [Child 1373, Main Thread] WARNING: NS_ENSURE_SUCCESS(rv, rv) failed with result 0x80004005 (NS_ERROR_FAILURE): file /builds/worker/checkouts/gecko/toolkit/xre/nsXREDirProvider.cpp:475
[task 2023-03-08T22:00:54.268Z] 22:00:54    ERROR - REFTEST ERROR | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-1.html | can't drawWindow remote content
[task 2023-03-08T22:00:54.269Z] 22:00:54    ERROR - REFTEST ERROR | Screen resolution is too low - USE_WIDGET_LAYERS was disabled. Since E10s is enabled, there is no fallback rendering path!
[task 2023-03-08T22:00:54.270Z] 22:00:54    ERROR - REFTEST ERROR | If you cannot increase your screen resolution you can try reducing gecko's pixel scaling by adding something like '--setpref layout.css.devPixelsPerPx=1.0' to your './mach reftest' command (possibly as an alias in ~/.mozbuild/machrc). Note that this is inconsistent with CI testing, and may interfere with HighDPI/reftest-zoom tests.
[task 2023-03-08T22:00:54.270Z] 22:00:54     INFO - REFTEST INFO | drawWindow flags = DRAWWINDOW_DRAW_CARET | DRAWWINDOW_DRAW_VIEW; window size = 760,960; test browser size = 800,1000
[task 2023-03-08T22:00:54.272Z] 22:00:54     INFO - [Parent 1366, Main Thread] WARNING: Remote iframe not rendered: file /builds/worker/checkouts/gecko/layout/generic/nsSubDocumentFrame.cpp:1317
[task 2023-03-08T22:00:54.274Z] 22:00:54     INFO - REFTEST TEST-LOAD | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-1-ref.html | 0 / 716 (0%)
[task 2023-03-08T22:00:54.318Z] 22:00:54    ERROR - REFTEST ERROR | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-1-ref.html | can't drawWindow remote content
[task 2023-03-08T22:00:54.321Z] 22:00:54     INFO - [Parent 1366, Main Thread] WARNING: Remote iframe not rendered: file /builds/worker/checkouts/gecko/layout/generic/nsSubDocumentFrame.cpp:1317
[task 2023-03-08T22:00:54.323Z] 22:00:54     INFO - REFTEST TEST-PASS | layout/reftests/margin-collapsing/inline-horizontal-1.html == layout/reftests/margin-collapsing/inline-horizontal-1-ref.html | image comparison, max difference: 0, number of differing pixels: 0
[task 2023-03-08T22:00:54.324Z] 22:00:54     INFO - REFTEST TEST-END | layout/reftests/margin-collapsing/inline-horizontal-1.html == layout/reftests/margin-collapsing/inline-horizontal-1-ref.html
[task 2023-03-08T22:00:54.340Z] 22:00:54     INFO - REFTEST TEST-START | layout/reftests/margin-collapsing/inline-horizontal-1.html != layout/reftests/margin-collapsing/inline-horizontal-1-noref.html
[task 2023-03-08T22:00:54.341Z] 22:00:54     INFO - REFTEST TEST-LOAD | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-1-noref.html | 1 / 716 (0%)
[task 2023-03-08T22:00:54.384Z] 22:00:54    ERROR - REFTEST ERROR | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-1-noref.html | can't drawWindow remote content
[task 2023-03-08T22:00:54.387Z] 22:00:54     INFO - [Parent 1366, Main Thread] WARNING: Remote iframe not rendered: file /builds/worker/checkouts/gecko/layout/generic/nsSubDocumentFrame.cpp:1317
[task 2023-03-08T22:00:54.485Z] 22:00:54     INFO - REFTEST TEST-UNEXPECTED-FAIL | layout/reftests/margin-collapsing/inline-horizontal-1.html != layout/reftests/margin-collapsing/inline-horizontal-1-noref.html | image comparison, max difference: 0, number of differing pixels: 0
[task 2023-03-08T22:00:54.485Z] 22:00:54     INFO - REFTEST   IMAGE: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAPoCAYAAAAmy5qxAAAgAElEQVR4Xu3XsQ3DMBAEQbP/om21sLqEMIbxH2CNoz3f5308AgQIECBAgAABAgT+QuA87+YPOQLk5r/HbyNAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTF8W0hoAACAASURBVAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSYgQJqXawIECBAgQIAAAQIEBgEBMuCZEiBAgAABAgQIECDQBARI83JNgAABAgQIECBAgMAgIEAGPFMCBAgQIECAAAECBJqAAGlergkQIECAAAECBAgQGAQEyIBnSoAAAQIECBAgQIBAExAgzcs1AQIECBAgQIAAAQKDgAAZ8EwJECBAgAABAgQIEGgCAqR5uSZAgAABAgQIECBAYBAQIAOeKQECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIcMZ2PQAAA8tJREFUECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSZwfYC0z3FNgAABAgQIECBAgACB9wLn/dSSAAECBAgQIECAAAECTUCANC/XBAgQIECAAAECBAgMAgJkwDMlQIAAAQIECBAgQKAJCJDm5ZoAAQIECBAgQIAAgUFAgAx4pgQIECBAgAABAgQINAEB0rxcEyBAgAABAgQIECAwCAiQAc+UAAECBAgQIECAAIEmIECal2sCBAgQIECAAAECBAYBATLgmRIgQIAAAQIECBAg0AQESPNyTYAAAQIECBAgQIDAICBABjxTAgQIECBAgAABAgSagABpXq4JECBAgAABAgQIEBgEBMiAZ0qAAAECBAgQIECAQBMQIM3LNQECBAgQIECAAAECg4AAGfBMCRAgQIAAAQIECBBoAgKkebkmQIAAAQIECBAgQGAQECADnikBAgQIECBAgAABAk1AgDQv1wQIECBAgAABAgQIDAICZMAzJUCAAAECBAgQIECgCQiQ5uWaAAECBAgQIECAAIFBQIAMeKYECBAgQIAAAQIECDQBAdK8XBMgQIAAAQIECBAgMAgIkAHPlAABAgQIECBAgACBJiBAmpdrAgQIECBAgAABAgQGAQEy4JkSIECAAAECBAgQINAEBEjzck2AAAECBAgQIECAwCAgQAY8UwIECBAgQIAAAQIEmoAAaV6uCRAgQIAAAQIECBAYBATIgGdKgAABAgQIECBAgEATECDNyzUBAgQIECBAgAABAoOAABnwTAkQIECAAAECBAgQaAICpHm5JkCAAAECBAgQIEBgEBAgA54pAQIECBAgQIAAAQJNQIA0L9cECBAgQIAAAQIECAwCAmTAMyVAgAABAgQIECBAoAkIkOblmgABAgQIECBAgACBQUCADHimBAgQIECAAAECBAg0AQHSvFwTIECAAAECBAgQIDAICJABz5QAAQIECBAgQIAAgSbwA97XBMqfNlXFAAAAAElFTkSuQmCC
[task 2023-03-08T22:00:54.485Z] 22:00:54     INFO - REFTEST INFO | Saved log: RecordResult fired
[task 2023-03-08T22:00:54.486Z] 22:00:54     INFO - REFTEST INFO | Saved log: START file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-1-noref.html
[task 2023-03-08T22:00:54.486Z] 22:00:54     INFO - REFTEST INFO | Saved log: [CONTENT] OnDocumentLoad triggering AfterOnLoadScripts
[task 2023-03-08T22:00:54.486Z] 22:00:54     INFO - REFTEST INFO | Saved log: Initializing canvas snapshot
[task 2023-03-08T22:00:54.487Z] 22:00:54     INFO - REFTEST INFO | Saved log: DoDrawWindow 0,0,800,1000
[task 2023-03-08T22:00:54.487Z] 22:00:54     INFO - REFTEST INFO | Saved log: [CONTENT] RecordResult fired
[task 2023-03-08T22:00:54.487Z] 22:00:54     INFO - REFTEST INFO | Saved log: RecordResult fired
[task 2023-03-08T22:00:54.488Z] 22:00:54     INFO - REFTEST TEST-END | layout/reftests/margin-collapsing/inline-horizontal-1.html != layout/reftests/margin-collapsing/inline-horizontal-1-noref.html
[task 2023-03-08T22:00:54.489Z] 22:00:54     INFO - REFTEST TEST-START | layout/reftests/margin-collapsing/inline-horizontal-2.html == layout/reftests/margin-collapsing/inline-horizontal-2-ref.html
[task 2023-03-08T22:00:54.489Z] 22:00:54     INFO - REFTEST TEST-LOAD | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-2.html | 2 / 716 (0%)
[task 2023-03-08T22:00:54.491Z] 22:00:54    ERROR - REFTEST ERROR | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-2.html | can't drawWindow remote content
[task 2023-03-08T22:00:54.491Z] 22:00:54     INFO - [Parent 1366, Main Thread] WARNING: Remote iframe not rendered: file /builds/worker/checkouts/gecko/layout/generic/nsSubDocumentFrame.cpp:1317
[task 2023-03-08T22:00:54.492Z] 22:00:54     INFO - REFTEST TEST-LOAD | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-2-ref.html | 2 / 716 (0%)
[task 2023-03-08T22:00:54.494Z] 22:00:54    ERROR - REFTEST ERROR | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-2-ref.html | can't drawWindow remote content
[task 2023-03-08T22:00:54.494Z] 22:00:54     INFO - [Parent 1366, Main Thread] WARNING: Remote iframe not rendered: file /builds/worker/checkouts/gecko/layout/generic/nsSubDocumentFrame.cpp:1317
[task 2023-03-08T22:00:54.495Z] 22:00:54     INFO - REFTEST TEST-PASS | layout/reftests/margin-collapsing/inline-horizontal-2.html == layout/reftests/margin-collapsing/inline-horizontal-2-ref.html | image comparison, max difference: 0, number of differing pixels: 0
[task 2023-03-08T22:00:54.496Z] 22:00:54     INFO - REFTEST TEST-END | layout/reftests/margin-collapsing/inline-horizontal-2.html == layout/reftests/margin-collapsing/inline-horizontal-2-ref.html
[task 2023-03-08T22:00:54.503Z] 22:00:54     INFO - REFTEST TEST-START | layout/reftests/margin-collapsing/inline-horizontal-2.html != layout/reftests/margin-collapsing/inline-horizontal-2-noref.html
[task 2023-03-08T22:00:54.504Z] 22:00:54     INFO - REFTEST TEST-LOAD | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-2-noref.html | 3 / 716 (0%)
[task 2023-03-08T22:00:54.534Z] 22:00:54    ERROR - REFTEST ERROR | file:///opt/worker/tasks/task_167831266994318/build/tests/reftest/tests/layout/reftests/margin-collapsing/inline-horizontal-2-noref.html | can't drawWindow remote content
[task 2023-03-08T22:00:54.537Z] 22:00:54     INFO - [Parent 1366, Main Thread] WARNING: Remote iframe not rendered: file /builds/worker/checkouts/gecko/layout/generic/nsSubDocumentFrame.cpp:1317
[task 2023-03-08T22:00:54.634Z] 22:00:54     INFO - REFTEST TEST-UNEXPECTED-FAIL | layout/reftests/margin-collapsing/inline-horizontal-2.html != layout/reftests/margin-collapsing/inline-horizontal-2-noref.html | image comparison, max difference: 0, number of differing pixels: 0
```",STACK_TRACE,0,FULL_TOKEN
1821213,2,"Retriggers & backfills point to Bug 1820699 after [45e7b3ea7ae3](https://hg.mozilla.org/integration/autoland/rev/45e7b3ea7ae3) landed as [seen here](https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=success%2Ctestfailed%2Cbusted%2Cexception&fromchange=649252a678394a69b2b6aa58aa63616cbe8e99d2&searchStr=os%2Cx%2C10.15%2Cwebrender%2Cdebug%2Creftests%2Ctest-macosx1015-64-qr%2Fdebug-reftest%2Cr1&tochange=45e7b3ea7ae37091a234148ac0b659a157c5da67&selectedTaskRun=NZeL4pVxQr6gdZtTcdR0Wg.0). Brad, could you take a look at it please? Thank you!",ISSUE_IMPACT,0,90_PCT_MATCH
1821213,3,Changing summary to a more general one as there are multiple reftest failures with same fail error but different test paths.,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1821213,4,*** Bug 1821154 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1821213,5,"16 failures in 799 pushes (0.02 failures/push) were associated with this bug yesterday.
Repository breakdown:
* autoland: 16
Platform and build breakdown:
* macosx1015-64-qr: 16
  * debug: 14
  * opt: 2
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1821213&startday=2023-03-08&endday=2023-03-08&tree=all",UNCODED,0,UNMATCHED
1821213,6,Set release status flags based on info from the regressing bug 1820699,ISSUE_METADATA_CHANGE,0,FULL_TEXT
1821213,7,Thanks for rolling this up. I'll try to reproduce and develop a fix.,DEVELOPER_SELECTION_DECISION,0,FULL_TEXT
1821213,8,"It looks like implementing `NSWindowDelegate windowWillUseStandardFrame: defaultFrame:` in Bug 1820699 has caused the browser windows opened in reftests to be larger than they were before, causing [this case to be missed](https://searchfox.org/mozilla-central/rev/2af0d81d29bcd264083e04a2473d82a91f0f7eb6/layout/tools/reftest/reftest.jsm#981), which makes the reftest harness think that it's not checking all of the pixels. Something like that. There may be a logic relaxation we can do that will make this work again.",PROBLEM_CAUSE_IDENTIFICATION,0,90_PCT_MATCH
1821213,9,"Rather, either the browsers are bigger or the enclosing windows are smaller.",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TEXT
1821213,10,"The enclosing window, instead of retaining its expected 800 x 1000 size, is being shrunk to 760 x 960 size, which is 20 pixels taken from each edge, which is a magic number used in Bug 1820699. That shrinking is only supposed to happen when there is a request to put the macOS window in ""normal"" state, but the window appears stuck in ""maximized"" state. The maximized state is determined by the window being very close to the bounds of the screen on which it appears. Since the real screen is larger than 800 x 1000, there's perhaps some screen-spoofing that is done in the reftest harness that makes the window think it is filling the screen.
Things I'll try:
1) See if there is screen-spoofing, figure out what to do about it.
2) See how the reftest harness is requesting normal state, and make it not do so if the window is already in maximized state.
3) Make the macOS forced shrink not happen in the reftest harness using some other heuristic.",POTENTIAL_SOLUTION_DESIGN,1,90_PCT_MATCH
1821213,11,"Created attachment 9322217
Bug 1821213: Make CocoaWindow check its maximized state against the screen maximum size.",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1821213,12,"35 failures in 748 pushes (0.047 failures/push) were associated with this bug yesterday.
Repository breakdown:
* autoland: 23
* mozilla-central: 7
* try: 5
Platform and build breakdown:
* macosx1015-64-qr: 29
  * debug: 22
  * opt: 7
* linux1804-64-qr: 1
  * opt: 1
* macosx1015-64-devedition-qr: 4
  * opt: 4
* macosx1015-64-shippable-qr: 1
  * opt: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1821213&startday=2023-03-09&endday=2023-03-09&tree=all",UNCODED,0,UNMATCHED
1821213,13,"Pushed by bwerth@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/ebc6cc2ac67a
Make CocoaWindow check its maximized state against the screen maximum size. r=mstange",UNCODED,0,UNMATCHED
1821213,14,"22 failures in 720 pushes (0.031 failures/push) were associated with this bug yesterday.
Repository breakdown:
* autoland: 11
* mozilla-central: 7
* try: 4
Platform and build breakdown:
* macosx1015-64-qr: 16
  * debug: 15
  * opt: 1
* macosx1015-64-devedition-qr: 3
  * opt: 3
* macosx1015-64-shippable-qr: 2
  * opt: 2
* android-hw-p5-13-0-android-aarch64-qr: 1
  * debug: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1821213&startday=2023-03-10&endday=2023-03-10&tree=all",UNCODED,0,UNMATCHED
1821213,15,https://hg.mozilla.org/mozilla-central/rev/ebc6cc2ac67a,UNCODED,0,UNMATCHED
1821213,16,"73 failures in 3966 pushes (0.018 failures/push) were associated with this bug in the last 7 days.
This is the #17 most frequent failure this week.
** This failure happened more than 30 times this week! Resolving this bug is a high priority. **
** Try to resolve this bug as soon as possible. If unresolved for 2 weeks, the affected test(s) may be disabled. ** 
Repository breakdown:
* autoland: 50
* mozilla-central: 14
* try: 9
Platform and build breakdown:
* macosx1015-64-qr: 61
  * debug: 51
  * opt: 10
* linux1804-64-qr: 1
  * opt: 1
* macosx1015-64-devedition-qr: 7
  * opt: 7
* macosx1015-64-shippable-qr: 3
  * opt: 3
* android-hw-p5-13-0-android-aarch64-qr: 1
  * debug: 1
For more details, see:
https://treeherder.mozilla.org/intermittent-failures/bugdetails?bug=1821213&startday=2023-03-06&endday=2023-03-12&tree=all",UNCODED,0,UNMATCHED
660762,1,"User-Agent:       Mozilla/5.0 (Windows NT 6.1; rv:7.0a1) Gecko/20110530 Firefox/7.0a1
Build Identifier: 
Not a useful killswitch since MathML has shipped for some time now.
Reproducible: Always",PROBLEM_MOTIVATION,0,FULL_TEXT
660762,2,"Created attachment 536247
patch",UNCODED,0,UNMATCHED
660762,3,"Created attachment 536539
patch",UNCODED,0,UNMATCHED
660762,4,"Comment on attachment 536539
patch
Review of attachment 536539:
-----------------------------------------------------------------",UNCODED,0,UNMATCHED
660762,5,"Pushed:
http://hg.mozilla.org/mozilla-central/rev/b8664f450508",UNCODED,0,UNMATCHED
1248726,1,"Created attachment 8719927
simplify_pclocationmap_further-v0.diff
The memory management of this structure is quite weird, so add a comment and assertions detailing how it is all supposed to work.
https://treeherder.mozilla.org/#/jobs?repo=try&revision=852de5cfc93b",CODE_IMPLEMENTATION,1,FULL_TEXT
1248726,2,"Comment on attachment 8719927
simplify_pclocationmap_further-v0.diff
Review of attachment 8719927:
-----------------------------------------------------------------
Thanks!",CODE_REVIEW,0,FULL_TEXT
1248726,3,"https://hg.mozilla.org/integration/mozilla-inbound/rev/1ef77d653c4f7f5ea0452b010a9c6a85c9e87b5d
Bug 1248726 - Simplify PCLocationMap even further; r=fitzgen",UNCODED,0,UNMATCHED
1248726,4,https://hg.mozilla.org/mozilla-central/rev/1ef77d653c4f,UNCODED,0,UNMATCHED
759033,1,"Created attachment 627618
rename nsAccessible to Accessible
I just ran for i in accessible/public/* accessible/src/**/*.cpp accessible/src/**/*.h layout/**/*.h layout/**/*.cpp widget/**/*.cpp widget/**/*.h; do sed -f rename.sed -i $i; done
with the sed script I'll attach in a minute and then hit makefiles and a few things my regexs caught by accident with a hammer till it built.  I'll push this to try now and see how much I broke on other platforms than linxu64.",CODE_IMPLEMENTATION,1,FULL_TOKEN
759033,2,"Created attachment 627619
rename sed script
incase nyone else finds this useful",UNCODED,0,UNMATCHED
759033,3,"Comment on attachment 627618
rename nsAccessible to Accessible
Review of attachment 627618:
-----------------------------------------------------------------
stopped review at TableAccessible.h
::: accessible/public/nsIAccessibilityService.h
@@ +41,1 @@
nit: wrong indent
@@ +52,1 @@
nit: wrong indent
::: accessible/public/nsIAccessibleText.idl
@@ +6,4 @@
ok, not related though
::: accessible/src/atk/nsAccessibleWrap.cpp
@@ +131,3 @@
would you please indent it properly?
@@ +247,2 @@
indent it?
@@ +259,2 @@
same
@@ +259,5 @@
void on new line please
@@ +277,3 @@
indent it?
@@ +280,3 @@
return type on own line pls, here and below in this file
@@ +313,4 @@
type* name
@@ +351,4 @@
same
@@ +600,4 @@
indent it?
@@ +764,2 @@
indent it and no empty line between them?
@@ +955,3 @@
indent pls?
@@ +964,5 @@
type* name
@@ +1262,1 @@
indent pls
@@ +1294,1 @@
same and type* name
@@ +1335,1 @@
same
::: accessible/src/atk/nsAccessibleWrap.h
@@ +48,3 @@
nit: space before :
@@ +51,4 @@
wrong indent and below too
::: accessible/src/atk/ApplicationAccessibleWrap.cpp
@@ +521,4 @@
indent pls
@@ +710,5 @@
type* name
@@ +737,4 @@
same
::: accessible/src/atk/AtkSocketAccessible.h
@@ +22,3 @@
space before :
::: accessible/src/atk/nsMai.h
@@ +46,4 @@
type* name
::: accessible/src/atk/nsMaiHyperlink.cpp
@@ +203,3 @@
type* name
::: accessible/src/atk/nsMaiHyperlink.h
@@ +20,4 @@
indent pls
@@ +29,4 @@
samer
::: accessible/src/atk/nsMaiInterfaceAction.cpp
@@ +23,2 @@
indent pls?
@@ +43,5 @@
indent?
@@ +56,5 @@
same?
::: accessible/src/atk/nsMaiInterfaceComponent.cpp
@@ +56,5 @@
wrong indent
::: accessible/src/atk/nsMaiInterfaceEditableText.cpp
@@ +21,2 @@
indent pls?
@@ +41,2 @@
same?
@@ +61,2 @@
same? and below in this file
::: accessible/src/atk/nsMaiInterfaceHypertext.cpp
@@ +31,1 @@
indent them? and below in the file
::: accessible/src/atk/nsMaiInterfaceSelection.cpp
@@ +20,2 @@
indent here and below?
::: accessible/src/atk/nsMaiInterfaceTable.cpp
@@ +24,2 @@
indent here and below in the file?
@@ +34,4 @@
type* name
::: accessible/src/atk/nsMaiInterfaceText.cpp
@@ +34,2 @@
indent here and below in the file?
::: accessible/src/atk/nsMaiInterfaceValue.cpp
@@ +18,2 @@
same in this file
::: accessible/src/base/AccIterator.h
@@ +68,4 @@
type* name
::: accessible/src/base/nsAccCache.h
@@ +33,4 @@
type& name
@@ +61,4 @@
same
::: accessible/src/base/nsAccTreeWalker.h
@@ +30,4 @@
nit: remove inline pls
::: accessible/src/base/nsAccUtils.h
@@ +136,1 @@
extra space before method name and wrong indentation of second arg
@@ +145,1 @@
wrong indentation
::: accessible/src/base/nsAccessNode.cpp
@@ +35,4 @@
AccessNode
::: accessible/src/base/nsAccessibilityService.cpp
@@ +184,4 @@
space at the end of line
@@ +194,4 @@
same
@@ +204,4 @@
same
@@ +214,4 @@
same
@@ +224,4 @@
space at the end of line
@@ +234,4 @@
space at the end of line
@@ +244,4 @@
space at the end of line
@@ +274,4 @@
space at the end of line
@@ +284,4 @@
space at the end of line
@@ +294,4 @@
same
@@ +337,4 @@
same
@@ +373,4 @@
same
@@ +383,4 @@
same
@@ +393,4 @@
same
@@ +413,4 @@
same
@@ +423,4 @@
same
@@ +433,4 @@
same
@@ +443,4 @@
same
@@ +453,4 @@
same
@@ +463,4 @@
same
@@ +701,4 @@
type* name
@@ +1643,1 @@
wrong indentation
@@ +1701,1 @@
wrong indentation
@@ +1817,1 @@
wrong indentation
::: accessible/src/base/nsAccessibilityService.h
@@ +61,1 @@
wrong indentation
@@ +176,1 @@
same
::: accessible/src/base/nsAccessiblePivot.cpp
@@ +148,1 @@
wrong indentation
@@ +345,3 @@
wrong indentation
@@ +374,4 @@
= nsnull pls
@@ +406,3 @@
wrong indentation
@@ +463,1 @@
wrong indentation
::: accessible/src/base/nsAccessiblePivot.h
@@ +23,4 @@
space before : pls
btw, you rename the class but you don't rename the file
@@ +35,5 @@
pls add const
@@ +62,3 @@
wrong indentation
@@ +70,3 @@
same
::: accessible/src/base/nsBaseWidgetAccessible.h
@@ +33,1 @@
wrong indentation
::: accessible/src/base/nsCoreUtils.cpp
@@ +722,4 @@
type* name
@@ +730,4 @@
same
::: accessible/src/base/nsAccessible.cpp
@@ +107,5 @@
return type on new line pls
@@ +198,5 @@
type* name
@@ +208,4 @@
same
@@ +221,4 @@
same
@@ +435,5 @@
same
@@ +448,4 @@
same
@@ +463,4 @@
same
@@ +478,4 @@
same and below in this file
@@ +738,5 @@
remove this comment pls
@@ +745,1 @@
wrong indentation
@@ +850,1 @@
wrong indentation
@@ +865,1 @@
wrong indentation
@@ +874,4 @@
return type on own line
@@ +965,1 @@
wrong indentation
@@ +1004,4 @@
ret type on own line
@@ +1031,4 @@
same
@@ +1429,2 @@
wrong indentation
@@ +1729,4 @@
return type on own line, name -> aName pls (btw please file gfb bug to remove this method)
@@ +1750,1 @@
wrong indentation
@@ +1751,5 @@
type* name
@@ +2235,4 @@
ret type on own line
@@ +2255,4 @@
ret type on own line, here and below
@@ +2456,1 @@
wrong indentation
::: accessible/src/base/nsAccessible.h
@@ +92,4 @@
wrong indentation
@@ +247,1 @@
wrong indentation
@@ +675,1 @@
wrong indentation
@@ +758,4 @@
type* name
::: accessible/src/generic/ApplicationAccessible.h
@@ +27,4 @@
nit: space before :
@@ +81,1 @@
wrong indentation
@@ +95,1 @@
wrong indentation
::: accessible/src/generic/DocAccessible.h
@@ +52,4 @@
remove that, we aren't in conflict now
@@ +186,4 @@
pls remove inlines here and below
::: accessible/src/generic/Makefile.in
@@ +27,5 @@
two spaces indentation as above?
::: accessible/src/generic/OuterDocAccessible.h
@@ +43,1 @@
wrong indentation",CODE_REVIEW,0,FULL_TEXT
759033,4,"Comment on attachment 627618
rename nsAccessible to Accessible
Review of attachment 627618:
-----------------------------------------------------------------
::: accessible/public/nsIAccessibilityService.h
@@ +41,1 @@
nit: wrong indent
@@ +52,1 @@
nit: wrong indent
::: accessible/public/nsIAccessibleText.idl
@@ +6,4 @@
ok, not related though
::: accessible/src/atk/nsAccessibleWrap.cpp
@@ +131,3 @@
would you please indent it properly?
@@ +247,2 @@
indent it?
@@ +259,2 @@
same
@@ +259,5 @@
void on new line please
@@ +277,3 @@
indent it?
@@ +280,3 @@
return type on own line pls, here and below in this file
@@ +313,4 @@
type* name
@@ +351,4 @@
same
@@ +600,4 @@
indent it?
@@ +764,2 @@
indent it and no empty line between them?
@@ +955,3 @@
indent pls?
@@ +964,5 @@
type* name
@@ +1262,1 @@
indent pls
@@ +1294,1 @@
same and type* name
@@ +1335,1 @@
same
::: accessible/src/atk/nsAccessibleWrap.h
@@ +48,3 @@
nit: space before :
@@ +51,4 @@
wrong indent and below too
::: accessible/src/atk/ApplicationAccessibleWrap.cpp
@@ +521,4 @@
indent pls
@@ +710,5 @@
type* name
@@ +737,4 @@
same
::: accessible/src/atk/AtkSocketAccessible.h
@@ +22,3 @@
space before :
::: accessible/src/atk/nsMai.h
@@ +46,4 @@
type* name
::: accessible/src/atk/nsMaiHyperlink.cpp
@@ +203,3 @@
type* name
::: accessible/src/atk/nsMaiHyperlink.h
@@ +20,4 @@
indent pls
@@ +29,4 @@
samer
::: accessible/src/atk/nsMaiInterfaceAction.cpp
@@ +23,2 @@
indent pls?
@@ +43,5 @@
indent?
@@ +56,5 @@
same?
::: accessible/src/atk/nsMaiInterfaceComponent.cpp
@@ +56,5 @@
wrong indent
::: accessible/src/atk/nsMaiInterfaceEditableText.cpp
@@ +21,2 @@
indent pls?
@@ +41,2 @@
same?
@@ +61,2 @@
same? and below in this file
::: accessible/src/atk/nsMaiInterfaceHypertext.cpp
@@ +31,1 @@
indent them? and below in the file
::: accessible/src/atk/nsMaiInterfaceSelection.cpp
@@ +20,2 @@
indent here and below?
::: accessible/src/atk/nsMaiInterfaceTable.cpp
@@ +24,2 @@
indent here and below in the file?
@@ +34,4 @@
type* name
::: accessible/src/atk/nsMaiInterfaceText.cpp
@@ +34,2 @@
indent here and below in the file?
::: accessible/src/atk/nsMaiInterfaceValue.cpp
@@ +18,2 @@
same in this file
::: accessible/src/base/AccIterator.h
@@ +68,4 @@
type* name
::: accessible/src/base/nsAccCache.h
@@ +33,4 @@
type& name
@@ +61,4 @@
same
::: accessible/src/base/nsAccTreeWalker.h
@@ +30,4 @@
nit: remove inline pls
::: accessible/src/base/nsAccUtils.h
@@ +136,1 @@
extra space before method name and wrong indentation of second arg
@@ +145,1 @@
wrong indentation
::: accessible/src/base/nsAccessNode.cpp
@@ +35,4 @@
AccessNode
::: accessible/src/base/nsAccessibilityService.cpp
@@ +184,4 @@
space at the end of line
@@ +194,4 @@
same
@@ +204,4 @@
same
@@ +214,4 @@
same
@@ +224,4 @@
space at the end of line
@@ +234,4 @@
space at the end of line
@@ +244,4 @@
space at the end of line
@@ +274,4 @@
space at the end of line
@@ +284,4 @@
space at the end of line
@@ +294,4 @@
same
@@ +337,4 @@
same
@@ +373,4 @@
same
@@ +383,4 @@
same
@@ +393,4 @@
same
@@ +413,4 @@
same
@@ +423,4 @@
same
@@ +433,4 @@
same
@@ +443,4 @@
same
@@ +453,4 @@
same
@@ +463,4 @@
same
@@ +701,4 @@
type* name
@@ +1643,1 @@
wrong indentation
@@ +1701,1 @@
wrong indentation
@@ +1817,1 @@
wrong indentation
::: accessible/src/base/nsAccessibilityService.h
@@ +61,1 @@
wrong indentation
@@ +176,1 @@
same
::: accessible/src/base/nsAccessiblePivot.cpp
@@ +148,1 @@
wrong indentation
@@ +345,3 @@
wrong indentation
@@ +374,4 @@
= nsnull pls
@@ +406,3 @@
wrong indentation
@@ +463,1 @@
wrong indentation
::: accessible/src/base/nsAccessiblePivot.h
@@ +23,4 @@
space before : pls
btw, you rename the class but you don't rename the file
@@ +35,5 @@
pls add const
@@ +62,3 @@
wrong indentation
@@ +70,3 @@
same
::: accessible/src/base/nsBaseWidgetAccessible.h
@@ +33,1 @@
wrong indentation
::: accessible/src/base/nsCoreUtils.cpp
@@ +722,4 @@
type* name
@@ +730,4 @@
same
::: accessible/src/base/nsAccessible.cpp
@@ +107,5 @@
return type on new line pls
@@ +198,5 @@
type* name
@@ +208,4 @@
same
@@ +221,4 @@
same
@@ +435,5 @@
same
@@ +448,4 @@
same
@@ +463,4 @@
same
@@ +478,4 @@
same and below in this file
@@ +738,5 @@
remove this comment pls
@@ +745,1 @@
wrong indentation
@@ +850,1 @@
wrong indentation
@@ +865,1 @@
wrong indentation
@@ +874,4 @@
return type on own line
@@ +965,1 @@
wrong indentation
@@ +1004,4 @@
ret type on own line
@@ +1031,4 @@
same
@@ +1429,2 @@
wrong indentation
@@ +1729,4 @@
return type on own line, name -> aName pls (btw please file gfb bug to remove this method)
@@ +1750,1 @@
wrong indentation
@@ +1751,5 @@
type* name
@@ +2235,4 @@
ret type on own line
@@ +2255,4 @@
ret type on own line, here and below
@@ +2456,1 @@
wrong indentation
::: accessible/src/base/nsAccessible.h
@@ +92,4 @@
wrong indentation
@@ +247,1 @@
wrong indentation
@@ +675,1 @@
wrong indentation
@@ +758,4 @@
type* name
::: accessible/src/generic/ApplicationAccessible.h
@@ +27,4 @@
nit: space before :
@@ +81,1 @@
wrong indentation
@@ +95,1 @@
wrong indentation
::: accessible/src/generic/DocAccessible.h
@@ +52,4 @@
remove that, we aren't in conflict now
@@ +186,4 @@
pls remove inlines here and below
::: accessible/src/generic/Makefile.in
@@ +27,5 @@
two spaces indentation as above?
::: accessible/src/generic/OuterDocAccessible.h
@@ +43,1 @@
wrong indentation
::: accessible/src/html/nsHTMLImageMapAccessible.h
@@ +72,1 @@
wrong indentation
::: accessible/src/html/nsHTMLSelectAccessible.cpp
@@ +71,4 @@
wrong indentation
@@ +77,5 @@
wrong indentation
::: accessible/src/html/nsHyperTextAccessible.cpp
@@ +218,5 @@
type* name
@@ +837,2 @@
return type on own line pls
@@ +1019,1 @@
same and 2 below
::: accessible/src/html/nsHyperTextAccessible.h
@@ +84,4 @@
remove inline? here and next one
@@ +138,3 @@
wrong indentation
@@ +342,5 @@
type* name
::: accessible/src/msaa/nsAccessibleWrap.cpp
@@ +71,5 @@
ret type on own line pls, here and below in this file
@@ +286,1 @@
wrong indentation
@@ +1016,1 @@
wrong indentation
@@ +1050,2 @@
wrong indentation
@@ +1132,1 @@
wrong indentation
@@ +1151,2 @@
wrong indentation
@@ +1269,2 @@
wrong indentation
@@ +1282,2 @@
wrong indentation
@@ +1439,1 @@
wrong indentation
@@ +1451,3 @@
wrong indentation
@@ +1608,1 @@
wrong indentation
::: accessible/src/msaa/nsAccessibleWrap.h
@@ +67,4 @@
wrong indentation
::: accessible/src/msaa/CAccessibleText.cpp
@@ +79,1 @@
wrong indentation
::: accessible/src/xforms/nsXFormsFormControlsAccessible.cpp
@@ +119,4 @@
maybe put each of them on own line?
::: accessible/src/xpcom/nsAccessibleRelation.cpp
@@ +15,1 @@
wrong indentation
@@ +34,4 @@
type* name pls
@@ +42,4 @@
same
@@ +52,4 @@
same
::: accessible/src/xpcom/nsAccessibleRelation.h
@@ +16,4 @@
space before : pls
::: accessible/src/xul/nsXULTreeAccessible.cpp
@@ +1227,1 @@
wrong indentation
::: accessible/src/xul/nsXULTreeAccessible.h
@@ +43,1 @@
wrong indentation
@@ +181,4 @@
type* name
@@ +198,1 @@
wrong indentation
@@ +270,1 @@
wrong indentation
::: accessible/src/xul/nsXULTreeGridAccessible.h
@@ +75,1 @@
wrong indentation
@@ +78,4 @@
type* name
@@ +108,4 @@
remove it pls
@@ +167,1 @@
wrong indentation",UNCODED,0,UNMATCHED
759033,5,landed https://hg.mozilla.org/integration/mozilla-inbound/rev/ee5b6efa9bda,CODE_IMPLEMENTATION,1,FULL_TEXT
759033,6,https://hg.mozilla.org/mozilla-central/rev/ee5b6efa9bda,UNCODED,0,UNMATCHED
1645527,1,"Please see bug 1639072 comment 1
`AssociateApplicationCache` and `OverrideReferrerInfoDuringBeginConnect` should be sent along with `PHttpChannel::OnStartRequest` to reduce potential race condition.",PROBLEM_MOTIVATION,0,FULL_TOKEN
1645527,2,"Created attachment 9156460
Bug 1645527 - P1 AssociateApplicationCache should be sent in PHttpChannel::OnStartRequest, r=mayhemer",UNCODED,0,UNMATCHED
1645527,3,"Created attachment 9156461
Bug 1645527 - P2 move OverrideReferrerInfoDuringBeginConnect to PHttpChannel::OnStartRequest, r=baku,valentin
We're going to send OnStartRequest via PHttpBackgroundChannel, anything sending via PHttpChannel before OnStartRequest
would be a race.
https://phabricator.services.mozilla.com/D49773#inline-303635
This link implicates that OverrideReferrerInfoDuringBeginConnect is fine just before OnStartRequest. To reduce the
racy and number of IPCs, I move the referrer info overridden to HttpChannelParent::OnStartRequest.
Depends on D79579",CODE_IMPLEMENTATION,1,FULL_TOKEN
1645527,4,"Pushed by juhsu@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d3412b7655da
P1 AssociateApplicationCache should be sent in PHttpChannel::OnStartRequest, r=mayhemer,necko-reviewers
https://hg.mozilla.org/integration/autoland/rev/7bffad12d441
P2 move OverrideReferrerInfoDuringBeginConnect to PHttpChannel::OnStartRequest, r=baku,valentin,necko-reviewers,mayhemer",UNCODED,0,UNMATCHED
1645527,5,"https://hg.mozilla.org/mozilla-central/rev/d3412b7655da
https://hg.mozilla.org/mozilla-central/rev/7bffad12d441",UNCODED,0,UNMATCHED
1395751,1,layout/style/test/chrome/test_stylesheet_clone_import_rule.html is also failing on Windows 7 / 8 for opt / pgo builds.,PROBLEM_DESCRIPTION,0,FULL_TEXT
1395751,2,"Bug 1395322 is filed for the real fix.
Here's an example of the failures:
https://treeherder.mozilla.org/#/jobs?repo=try&revision=4c2998f33d9a493d9e5350a63da832d61333f24b&filter-searchStr=M(c3",ADDITIONAL_CONSIDERATION,0,FULL_TOKEN
1395751,3,"Created attachment 8903374
Bug 1395751 - Skip test_stylesheet_clone_import_rule.html with Stylo.
Review commit: https://reviewboard.mozilla.org/r/175180/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/175180/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1395751,4,"Comment on attachment 8903374
Bug 1395751 - Skip test_stylesheet_clone_import_rule.html with Stylo.
https://reviewboard.mozilla.org/r/175180/#review180212",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1395751,5,"Pushed by jryans@gmail.com:
https://hg.mozilla.org/integration/autoland/rev/08674a4a6dc1
Skip test_stylesheet_clone_import_rule.html with Stylo. r=manishearth",UNCODED,0,UNMATCHED
1395751,6,https://hg.mozilla.org/mozilla-central/rev/08674a4a6dc1,UNCODED,0,UNMATCHED
587434,1,"(function() {
  function::a(eval(""false""), true);
  function a({}) {}
})()
asserts js debug shell on JM changeset 89b775191b9d without -m nor -j at Assertion failure: IsSaneThisObject(vp[1].toObject()), at ../jsinterp.cpp:4734",PROBLEM_DESCRIPTION,0,FULL_TOKEN
587434,2,"Created attachment 468830
Fix CALLXMLNAME
Slow push thisv on CALLXMLNAME checks to make sure we're not pushing a call object onto the stack, sets |this| to NULL.",CODE_IMPLEMENTATION,1,FULL_TEXT
587434,3,http://hg.mozilla.org/tracemonkey/rev/9ce0b72525ba,UNCODED,0,UNMATCHED
587434,4,A testcase for this bug was automatically identified at js/src/tests/e4x/Regress/regress-587434.js.,STATUS_UPDATE,0,FULL_TEXT
587434,5,Testcases have been landed by virtue of being marked in-testsuite+ -> VERIFIED as well.,SOLUTION_VERIFICATION,0,FULL_TEXT
623742,1,"Currently if you are using the 1.6.1 Sync add-on and you click ""Add a device"" in the Sync Options you are taken to http://support.mozilla.com/kb/How+to+set+up+Firefox+Home+on+your+iPhone
Instead we should send people to https://support.mozilla.com/kb/add-a-device-to-firefox-sync",PROBLEM_DESCRIPTION,0,FULL_TOKEN
623742,2,"Created attachment 503984
v1",UNCODED,0,UNMATCHED
623742,3,"1.6.x: https://hg.mozilla.org/services/fx-sync/rev/0fe88045dccc
default: https://hg.mozilla.org/services/fx-sync/rev/54bbabff19c4",UNCODED,0,UNMATCHED
623742,4,verified with 1.6.2,SOLUTION_VERIFICATION,0,FULL_TEXT
1820814,1,"When the transport is closed or encounters an error, this code is run on the STS thread:
https://searchfox.org/mozilla-central/rev/00ea1649b59d5f427979e2d6ba42be96f62d6e82/dom/media/webrtc/libwebrtcglue/AudioConduit.h#45
Events that are in-flight for this event source are dropped. This occasionally can cause an RTCP BYE to disappear (due to a DTLS CloseNotify arriving immediately after the BYE), and is causing intermittent failures in the webrtc/RTCPeerConnection-remote-track-mute.https.html wpt. We should probably be dispatching the DisconnectIfExists calls to the call thread, so it does not race against the packet events.",POTENTIAL_SOLUTION_DESIGN,1,FULL_TEXT
1820814,2,"Created attachment 9321739
Bug 1820814: Dispatch these DisconnectIfExists calls to the call thread. r?pehrsons
Depends on D171930",UNCODED,0,UNMATCHED
1820814,3,"https://treeherder.mozilla.org/jobs?repo=try&revision=7a71e8a10bb8807213b51f9e42558a667396bed6
https://treeherder.mozilla.org/jobs?repo=try&revision=152c1e935bc82b1f89e2b874fd2a6b686d81f74b",UNCODED,0,UNMATCHED
1820814,4,Wow. That's the squeaky-cleanest try push I've seen in at least a year.,CLARIFICATION,0,FULL_TEXT
1820814,5,"Pushed by bcampen@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/23a43d83ae41
Dispatch these DisconnectIfExists calls to the call thread. r=pehrsons",UNCODED,0,UNMATCHED
1820814,6,https://hg.mozilla.org/mozilla-central/rev/23a43d83ae41,UNCODED,0,UNMATCHED
1704164,1,"On my system I see a white flash between about:blank and the fully loaded about:home. If I force the activity stream bundle js to immediately send the ""LightweightTheme:Set"" event, the white flash goes away. `componentWillMount` on `ASRouterUISurface` runs after first paint - we need to ensure the css variable for the background color is set prior to first paint. This feels particularly noticeable for me with the skeleton UI enabled (default on Nightly).",PROBLEM_CAUSE_IDENTIFICATION,0,FULL_TOKEN
1704164,2,"Created attachment 9214797
Bug 1704164 - Apply darkmode theme to newtab before first paint r?mconley
This prevents a white flash in about:home in dark mode. Particularly obvious
with the skeleton UI enabled. I don't see a reason why we need to do this on
pageshow, if we start doing it on DOMContentLoaded, given that we listen for
theme change events anyway.",CODE_IMPLEMENTATION,1,FULL_TOKEN
1704164,3,"Pushed by dothayer@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/dc67a43df738
Apply darkmode theme to newtab before first paint r=mconley",UNCODED,0,UNMATCHED
1704164,4,https://hg.mozilla.org/mozilla-central/rev/dc67a43df738,UNCODED,0,UNMATCHED
1024256,1,S3TC conformance tests fail on OSX 10.9.,PROBLEM_MOTIVATION,0,FULL_TEXT
1024256,2,"Created attachment 8438826
Blacklist S3TC extension on OSX 10.9 Intel HD 3000 driver because of buggy glCompressedTexSubImage2D with sub-image update",PROBLEM_DESCRIPTION,0,FULL_TEXT
1024256,3,try: https://tbpl.mozilla.org/?tree=Try&rev=5920576888ae,UNCODED,0,UNMATCHED
1024256,4,inbound: https://hg.mozilla.org/integration/mozilla-inbound/rev/1f78f3fe8475,UNCODED,0,UNMATCHED
1024256,5,https://hg.mozilla.org/mozilla-central/rev/1f78f3fe8475,UNCODED,0,UNMATCHED
1024256,6,This will require uplift to Aurora and Beta. I'll check that the patch applies cleanly to both of those.,STATUS_UPDATE,0,FULL_TEXT
1024256,7,I've marked FF31 and FF32 as affected. I've checked and the patch applies to Aurora and Beta. Should let this bake on m-c for a week?,QUESTION,0,FULL_TEXT
1626111,1,It's using xMost and yMost for variables holding width and height.,PROBLEM_MOTIVATION,0,FULL_TEXT
1626111,2,"Created attachment 9136979
Bug 1626111 - Fix two variable names in Matrix4x4TypedFlagged::TransformAndClipBounds. r=bas",PROBLEM_DESCRIPTION,0,FULL_TEXT
1626111,3,"Pushed by mstange@themasta.com:
https://hg.mozilla.org/integration/autoland/rev/b38e8adb5318
Fix two variable names in Matrix4x4TypedFlagged::TransformAndClipBounds. r=bas",UNCODED,0,UNMATCHED
1626111,4,https://hg.mozilla.org/mozilla-central/rev/b38e8adb5318,UNCODED,0,UNMATCHED
1794406,1,"I left a TODO that was pending on a wgpu update, which has happened since.",STATUS_UPDATE,0,FULL_TEXT
1794406,2,"Created attachment 9297829
Bug 1794406 - Report more specific error messages when buffer.mapAsync fails. r=jgilbert,jimb",UNCODED,0,UNMATCHED
1794406,3,"Pushed by nsilva@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/212ff2476899
Report more specific error messages when buffer.mapAsync fails. r=jgilbert",UNCODED,0,UNMATCHED
1794406,4,https://hg.mozilla.org/mozilla-central/rev/212ff2476899,UNCODED,0,UNMATCHED
1600017,1,"The following test case asserts with [`index <= initialLength`](https://searchfox.org/mozilla-central/rev/4df8821c1b824db5f40f381f48432f219d99ae36/js/src/builtin/FinalizationGroupObject.cpp#596).
```js
var group = new FinalizationGroup(x => {
  if (target1 === null) {
      return;
  }
  target1 = null;
  gc();
  print(""targets:"", [...x]); // consume
});
var target1 = {};
group.register(target1, ""target1"");
var target2 = {};
group.register(target2, ""target2"");
target2 = null;
gc();
```
When skimming through the spec proposal, it doesn't look like there's a restriction that additional empty cells can't be added to `finalizationGroup.[[Cells]]` during iteration. In which case the assertion simply needs to be changed from `MOZ_ASSERT(index <= initialLength)` to `MOZ_ASSERT(index <= holdings->length())`?",POTENTIAL_SOLUTION_DESIGN,1,FULL_TOKEN
1600017,2,Nice find!,UNCODED,0,UNMATCHED
1600017,3,"Created attachment 9112285
Bug 1600017 - Fix assertion in FinalizationGroupObject::cleanupQueuedHoldings to take account of the fact that holdings can be added during cleanup r?anba",AUTO_ATTACH_CODE_IMPLEMENTATION,0,80_PCT_MATCH
1600017,4,"Pushed by jcoppeard@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/7818d673556f
Fix assertion in FinalizationGroupObject::cleanupQueuedHoldings to take account of the fact that holdings can be added during cleanup r=anba",UNCODED,0,UNMATCHED
1600017,5,https://hg.mozilla.org/mozilla-central/rev/7818d673556f,UNCODED,0,UNMATCHED
900384,1,"""Redo"" is now defined.",UNCODED,0,UNMATCHED
900384,2,"Created attachment 8445185
Support ""Redo"" key value on GTK
This is now mappable only on GTK build. Qt doesn't have this key name. And also we need more work on Windows (bug 865561).
https://dvcs.w3.org/hg/dom3events/raw-file/tip/html/DOM3Events-key.html#key-Redo",CODE_IMPLEMENTATION,1,FULL_TOKEN
900384,3,https://hg.mozilla.org/integration/mozilla-inbound/rev/7c0ab70d2e40,UNCODED,0,UNMATCHED
900384,4,https://hg.mozilla.org/mozilla-central/rev/7c0ab70d2e40,UNCODED,0,UNMATCHED
1363344,1,"Lately we've had a number of cases where after a merge from m-c to graphics we end up with permafail or high-frequency intermittent failures on QR tests. These take time to bisect and is not a reliable process because of the potential intermittency. Avoid this is one reason I want to start running the QR reftests on autoland/inbound and make them tier-1, so that anything that regresses them gets detected earlier and backed out.
Also eventually we're going to want this anyway because we'd like to stop working on the graphics branch and move to working directly on central. Turning on the tests on central/integration branches is a necessary prerequisite for this.
The downside to doing this, of course, is we'll need more machine time. Right now all we want to enable are linux64 tests which I hear is the cheapest to scale up. If we can use SETA to further reduce the number of times it runs that's fine by me, as long as the sheriffs have the ability to backfill and bisect as needed.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1363344,2,"I also plan to fix bug 1342488 soonish, which will remove the QR builds as a separate build job and just use the regular non-QR build with the pref flipped on. That should save some machine time.",STATUS_UPDATE,0,FULL_TEXT
1363344,3,"Created attachment 8865877
Bug 1363344 - Update linux64-qr test jobs on central and integration branches.
This patch affects the following linux64-qr test jobs (for both opt and debug):
- Stops running reftest-no-accel on central, since they don't seem to provide
  much value over regular reftests.
- Starts running mochitest-gpu on central.
- Starts running crashtests, reftests, jsreftests, mochitest-gpu and
  mochitest-webgl on mozilla-inbound and autoland (this matches the set of
  tests on central).
- Promotes all the tests running on central/autoland/inbound to tier-1.
Review commit: https://reviewboard.mozilla.org/r/137478/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/137478/",CODE_IMPLEMENTATION,1,FULL_TOKEN
1363344,4,"r? to dustin for the actual config file changes, r? to catlee for the fact that this will increase load on AWS and that we're ok with doing this. I talked with Milan about this yesterday and he said to flag you for review on this.",PROBLEM_REVIEW_REQUEST,0,FULL_TEXT
1363344,5,"Comment on attachment 8865877
Bug 1363344 - Update linux64-qr test jobs on central and integration branches.
https://reviewboard.mozilla.org/r/137478/#review140658
I like it -- it's nice to see some of the special-cases going away",CODE_REVIEW,0,FULL_TEXT
1363344,6,"Comment on attachment 8865877
Bug 1363344 - Update linux64-qr test jobs on central and integration branches.
Based on an estimated 23h of additional test load per push, about 3200 pushes on inbound/autoland per month = 73,600h. We pay about $0.02/hr, so that's about an extra $1500 per month, which is fine.",CODE_REVIEW,0,FULL_TEXT
1363344,7,"Pushed by kgupta@mozilla.com:
https://hg.mozilla.org/integration/mozilla-inbound/rev/f4aa943a5bc9
Update linux64-qr test jobs on central and integration branches. r=dustin,catlee",UNCODED,0,UNMATCHED
1363344,8,https://hg.mozilla.org/mozilla-central/rev/f4aa943a5bc9,UNCODED,0,UNMATCHED
874258,1,"What should happen, even with leaks, is that we run the CC twice at shutdown: once to free everything, then another time to confirm that there's nothing to free.
This wasn't actually always true, due to some weirdness that I fixed.
Anyways, warning for this will help figure out which shutdown CC we should log, in leaks like bug 858948.
If I'm feeling a little more brave, I'll make this an assertion.",PROBLEM_MOTIVATION,0,FULL_TOKEN
874258,2,"Created attachment 751891
assert it
Let's see if it fails as an assertion.
https://tbpl.mozilla.org/?tree=Try&rev=847064a62b8f",CODE_IMPLEMENTATION,1,FULL_TOKEN
874258,3,"Created attachment 753896
warn",UNCODED,0,UNMATCHED
874258,4,https://hg.mozilla.org/integration/mozilla-inbound/rev/6d43a8c88ddc,UNCODED,0,UNMATCHED
874258,5,https://hg.mozilla.org/mozilla-central/rev/6d43a8c88ddc,UNCODED,0,UNMATCHED
712870,1,"Created attachment 583721
fix
Skia code will not able to compile for MacPPC and Android-x86 (and Windows/arm).",CODE_IMPLEMENTATION,1,FULL_TEXT
712870,2,https://hg.mozilla.org/integration/mozilla-inbound/rev/1ea94dacda68,UNCODED,0,UNMATCHED
712870,3,https://hg.mozilla.org/mozilla-central/rev/1ea94dacda68,UNCODED,0,UNMATCHED
712870,4,*** Bug 708708 has been marked as a duplicate of this bug. ***,UNCODED,0,UNMATCHED
1221593,1,"So when I saw this bug I remembered that we caught it during code review. I found the old review here:
https://bugzilla.mozilla.org/show_bug.cgi?id=1199885#c97
I recall applying all these changes but perhaps they never got qref into the final patch.",PROBLEM_DESCRIPTION,0,FULL_TOKEN
1221593,2,"Created attachment 8683204
patch
These are the changes asked for in your previous review. They got pushed to try but they got lost somewhere along the way.",CODE_IMPLEMENTATION,1,FULL_TEXT
1221593,3,https://treeherder.mozilla.org/#/jobs?repo=try&revision=05aa755504da,UNCODED,0,UNMATCHED
1221593,4,"https://hg.mozilla.org/integration/mozilla-inbound/rev/e3c1281a9e07a966c4ea06264eaa95ebab928aae
Bug 1221593 - Don't reset other axis' scroll position during APZ drag. r=kats",UNCODED,0,UNMATCHED
1221593,5,https://hg.mozilla.org/mozilla-central/rev/e3c1281a9e07,UNCODED,0,UNMATCHED
734506,2,"Created attachment 604531
Add all types v1
Add the types for nameSetters and make the code more robust.",CODE_IMPLEMENTATION,1,FULL_TEXT
734506,3,"Created attachment 604532
Fix bad throwing code v1",UNCODED,0,UNMATCHED
734506,4,"https://hg.mozilla.org/integration/mozilla-inbound/rev/0d866eb9ac24
https://hg.mozilla.org/integration/mozilla-inbound/rev/a3b40d32ad97",UNCODED,0,UNMATCHED
734506,5,"https://hg.mozilla.org/mozilla-central/rev/0d866eb9ac24
https://hg.mozilla.org/mozilla-central/rev/a3b40d32ad97",UNCODED,0,UNMATCHED
600489,1,"Created attachment 479341
patch (against 54625:7dcc52c49fc4)
insBranch() can return NULL if a conditional branch is optimized so that its condition never succeeds.  jstracer.cpp doesn't account for this, it just calls branch->setTarget(label).  This hasn't mattered up until now, but with bug 600127 doing a better job of optimizing guard/branch conditions, it does matter.
This patch adds label() to handle this.",CODE_IMPLEMENTATION,1,FULL_TEXT
600489,2,http://hg.mozilla.org/tracemonkey/rev/da5a3ef843f8,UNCODED,0,UNMATCHED
600489,3,http://hg.mozilla.org/mozilla-central/rev/da5a3ef843f8,UNCODED,0,UNMATCHED
1528712,1,Just a few more left.,UNCODED,0,UNMATCHED
1528712,2,"Created attachment 9044610
Bug 1528712 - Remove a couple trivial dependencies on nsPresContext. r=#style,jfkthame",UNCODED,0,UNMATCHED
1528712,3,"Created attachment 9044611
Bug 1528712 - Remove nsFont::featureValueLookup. r=#style,jfkthame
It's a global object, it doesn't have to be stored in nsFont. Pass it from the
caller like the user font set and co.
Depends on D20141",CODE_IMPLEMENTATION,1,FULL_TOKEN
1528712,4,"Pushed by ealvarez@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d981515b874b
Remove a couple trivial dependencies on nsPresContext. r=heycam
https://hg.mozilla.org/integration/autoland/rev/2d5c4e71e258
Remove nsFont::featureValueLookup. r=jfkthame",UNCODED,0,UNMATCHED
1528712,5,"Backed out 2 changesets (bug 1528712) for Linux spcshell and reftest failures (test_ext_browserSettings.js, 1022481-1.html)
push that caused the backout: https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&selectedJob=229192047&revision=2d5c4e71e258e24f1a70ed850c619f97e56f2c60
failures: https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&selectedJob=229193147&searchStr=linux%2Copt%2Cxpcshell%2Ctests%2Ctest-linux32%2Fopt-xpcshell-6%2Cx%28x6%29
https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception&classifiedState=unclassified&selectedJob=229194233&searchStr=linux%2Cdebug%2Creftests%2Ctest-linux32%2Fdebug-reftest-8%2Cr%28r8%29
backout: https://hg.mozilla.org/integration/autoland/rev/8a4ad06c05759fe087625f9fd8d047d848bee4c2",IMPLEMENTATION_REVERSION,0,FULL_TOKEN
1528712,6,"Pushed by emilio@crisal.io:
https://hg.mozilla.org/integration/autoland/rev/533f35feb9eb
Remove a couple trivial dependencies on nsPresContext. r=heycam
https://hg.mozilla.org/integration/autoland/rev/d15621c6f424
Remove nsFont::featureValueLookup. r=jfkthame",AUTO_PUSH_CODE_IMPLEMENTATION,0,FULL_TOKEN
1528712,7,"https://hg.mozilla.org/mozilla-central/rev/533f35feb9eb
https://hg.mozilla.org/mozilla-central/rev/d15621c6f424",UNCODED,0,UNMATCHED
1540794,1,"This file does nothing except #include ""nsID.h"", and is not used anywhere in m-c or comm-central.",PROBLEM_MOTIVATION,0,FULL_TEXT
1540794,2,"Created attachment 9054927
Bug 1540794 - Remove nsIID.h.
This file only includes nsID.h, and is unused.",CODE_IMPLEMENTATION,1,FULL_TEXT
1540794,3,"Pushed by amccreight@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/c4ddf15818ae
Remove nsIID.h. r=froydnj",UNCODED,0,UNMATCHED
1540794,4,https://hg.mozilla.org/mozilla-central/rev/c4ddf15818ae,UNCODED,0,UNMATCHED
1079321,1,"Created attachment 8501131
Patch (v1)",UNCODED,0,UNMATCHED
1079321,2,https://hg.mozilla.org/mozilla-central/rev/34b96e14238c,UNCODED,0,UNMATCHED
1424993,1,"I'm working on enabling ESLint for dom/presentation. As part of this, I found some undefined variables in PresentationDataChannelSessionTransport.js, along the lines of:
throw NS_ERROR_NOT_AVAILABLE;
This is meant to be:
throw Cr.NS_ERROR_NOT_AVAILABLE;
I'm not sure if there's any actual bugs caused by this, a brief look makes me think it would just be broken developer debug information.",PROBLEM_REVIEW,0,FULL_TOKEN
1424993,2,"Created attachment 8936562
Bug 1424993 - Fix PresentationTransport to correctly throw NS_ERROR_NOT_AVAILABLE.
Review commit: https://reviewboard.mozilla.org/r/207308/diff/#index_header
See other reviews: https://reviewboard.mozilla.org/r/207308/",AUTO_REV_COM_CODE_IMPLEMENTATION,0,FULL_TOKEN
1424993,3,"Comment on attachment 8936562
Bug 1424993 - Fix PresentationTransport to correctly throw NS_ERROR_NOT_AVAILABLE.
https://reviewboard.mozilla.org/r/207308/#review213110",AUTO_LINK_CODE_REVIEW,0,FULL_TEXT
1424993,4,"Pushed by mbanner@mozilla.com:
https://hg.mozilla.org/integration/autoland/rev/d095359814e9
Fix PresentationTransport to correctly throw NS_ERROR_NOT_AVAILABLE. r=smaug",UNCODED,0,UNMATCHED
1424993,5,https://hg.mozilla.org/mozilla-central/rev/d095359814e9,UNCODED,0,UNMATCHED
